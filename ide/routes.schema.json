{
    "id": "http://www.anakeen.com/entry-schema#",
    "$schema": "http://json-schema.org/draft-06/schema#",
    "description": "schema for routes configuration",
    "type": "object",
    "additionalProperties": false,
    "properties": {
        "routes": {
            "type": "object",
            "description": "Route access list",
            "patternProperties": {
                "^([A-Za-z:0-9_-]+)$": {
                    "anyOf": [
                        {
                            "$ref": "#/definitions/routeComplete"
                        },
                        {
                            "$ref": "#/definitions/routeOverPartial"
                        }
                    ]
                }
            },
            "additionalProperties": false
        },
        "middlewares": {
            "type": "object",
            "description": "Middleware access list",
            "patternProperties": {
                "^([A-Za-z0-9:]+)$": {
                    "anyOf": [
                        {
                            "$ref": "#/definitions/middlewareComplete"
                        },
                        {
                            "$ref": "#/definitions/middlewareOverPartial"
                        }
                    ]
                }
            },
            "additionalProperties": false
        },
        "accesses": {
            "type": "object",
            "description": "Access list",
            "patternProperties": {
                "^([A-Za-z0-9:_]+)$": {
                    "$ref": "#/definitions/access"
                }
            },
            "additionalProperties": false
        },
        "parameters": {
            "type": "object",
            "description": "Parameters list",
            "patternProperties": {
                "^([A-Za-z0-9:_]+)$": {
                    "$ref": "#/definitions/parameter"
                }
            },
            "additionalProperties": false
        },
        "apps": {
            "type": "object",
            "description": "Application information",
            "patternProperties": {
                "^([A-Z_]+)$": {
                    "anyOf": [
                        {
                            "$ref": "#/definitions/appComplete"
                        },
                        {
                            "$ref": "#/definitions/appPartial"
                        }
                    ]
                }
            }
        }
    },
    "definitions": {
        "middleware": {
            "type": "object",
            "properties": {
                "priority": {
                    "description": "Order used in case of multiple matches. The bigger win. (default is zero)",
                    "type": "integer"
                },
                "pattern": {
                    "description": "The uri pattern to route access",
                    "oneOf": [
                        {
                            "type": "array",
                            "minItems": 1,
                            "items": {
                                "type": "string"
                            }
                        },
                        {
                            "type": "string"
                        }
                    ]
                },
                "description": {
                    "type": "string"
                },
                "callable": {
                    "description": "The PHP method to invoke to perform the request",
                    "type": "string"
                },
                "methods": {
                    "type": "array",
                    "description": "HTTP Method needed to perform request",
                    "minItems": 1,
                    "items": {
                        "enum": [
                            "GET",
                            "POST",
                            "PUT",
                            "DELETE",
                            "OPTIONS",
                            "PATCH",
                            "ANY"
                        ]
                    },
                    "uniqueItems": true
                }
            },
            "additionalProperties": false
        },
        "middlewareComplete": {
            "type": "object",
            "description": "Middleware complete definition access",
            "allOf": [
                {
                    "$ref": "#/definitions/middleware"
                }
            ],
            "properties": {
                "override": {
                    "description": "Override route",
                    "enum": [
                        "complete"
                    ]
                }
            },
            "required": [
                "priority",
                "pattern",
                "methods",
                "callable"
            ],
            "additionalProperties": false
        },
        "middlewareOverPartial": {
            "type": "object",
            "description": "Middleware partial definition access",
            "allOf": [
                {
                    "$ref": "#/definitions/middleware"
                }
            ],
            "properties": {
                "override": {
                    "description": "Override route",
                    "enum": [
                        "partial"
                    ]
                }
            },
            "required": [
                "override"
            ],
            "additionalProperties": true
        },
        "route": {
            "type": "object",
            "description": "Route definition access",
            "allOf": [
                {
                    "$ref": "#/definitions/middleware"
                }
            ],
            "properties": {
                "authenticated": {
                    "description": "Is the route need authentication (default is true)",
                    "type": "boolean"
                },
                "applicationContext": {
                    "description": "Application Context",
                    "type": "string"
                }
            },
            "additionalProperties": false
        },
        "routeComplete": {
            "type": "object",
            "description": "Route complete definition access",
            "allOf": [
                {
                    "$ref": "#/definitions/route"
                }
            ],
            "properties": {
                "authenticated": {
                    "description": "Is the route need authentication (default is true)",
                    "type": "boolean"
                },
                "applicationContext": {
                    "description": "Application Context",
                    "type": "string"
                },
                "override": {
                    "description": "Override route",
                    "enum": [
                        "complete"
                    ]
                },
                "requiredAccess": {
                    "oneOf": [
                        {
                            "type": "string",
                            "minLength": 1
                        },
                        {
                            "type": "null"
                        },
                        {
                            "type": "object",
                            "patternProperties": {
                                "^(and)|(or)$": {
                                    "type": "array",
                                    "minItems": 2,
                                    "uniqueItems": true
                                }
                            },
                            "additionalProperties": false
                        }
                    ],
                    "description": "Access right to verify before grant the access"
                }
            },
            "required": [
                "requiredAccess",
                "pattern",
                "methods",
                "callable"
            ],
            "additionalProperties": false
        },
        "routeOverPartial": {
            "type": "object",
            "description": "Route partial definition access",
            "allOf": [
                {
                    "$ref": "#/definitions/route"
                }
            ],
            "properties": {
                "override": {
                    "description": "Override route",
                    "enum": [
                        "partial"
                    ]
                }
            },
            "required": [
                "override"
            ],
            "additionalProperties": true
        },
        "access": {
            "type": "object",
            "description": "Right of access definition",
            "properties": {
                "category": {
                    "description": "Category to classify the access",
                    "type": "string"
                },
                "description": {
                    "description": "Access textual description",
                    "type": "string"
                },
                "applicationContext": {
                    "description": "Application Context",
                    "type": "string"
                }
            },
            "required": [
                "description"
            ],
            "additionalProperties": false
        },
        "app": {
            "type": "object",
            "properties": {
                "shortName": {
                    "description": "Short description",
                    "type": "string"
                },
                "description": {
                    "description": "App textual description",
                    "type": "string"
                },
                "version": {
                    "description": "App version",
                    "type": "string"
                },
                "icon": {
                    "description": "App icon file",
                    "type": "string"
                },
                "displayable": {
                    "description": "App is displayable",
                    "type": "boolean"
                },
                "parentName": {
                    "description": "Parent App (inherit)",
                    "type": "string"
                },
                "parameters": {
                    "description": "App parameters",
                    "type": "object",
                    "patternProperties": {
                        "^([A-Z_]+)$": {
                            "$ref": "#/definitions/parameter"
                        }
                    },
                    "additionalProperties": false
                }
            },
            "additionalProperties": false
        },
        "appPartial" : {
            "type": "object",
            "description": "Route partial definition access",
            "allOf": [
                {
                    "$ref": "#/definitions/app"
                }
            ],
            "properties": {
                "override": {
                    "description": "Override app",
                    "enum": [
                        "partial"
                    ]
                }
            },
            "required": [
                "override"
            ],
            "additionalProperties": true
        },
        "appComplete" : {

            "type": "object",
            "description": "Route partial definition access",
            "allOf": [
                {
                    "$ref": "#/definitions/app"
                }
            ],
            "properties": {
                "override": {
                    "description": "Override app",
                    "enum": [
                        "partial"
                    ]
                }
            },
            "required": [
                "shortName",
                "version"
            ],
            "additionalProperties": true
        },
        "parameter": {
            "type": "object",
            "properties": {
                "value": {
                    "description": "Default value",
                    "oneOf": [
                        {
                            "type": "number"
                        },
                        {
                            "type": "string"
                        }
                    ]
                },
                "description": {
                    "description": "Access textual description",
                    "type": "string"
                },
                "category": {
                    "description": "Access categorisation",
                    "type": "string"
                },
                "isUser": {
                    "description": "Is a user parameter ?",
                    "type": "boolean"
                },
                "type": {
                    "description": "Parameter type",
                    "type": "string"
                },
                "access": {
                    "description": "Admin access",
                    "enum": [
                        "readonly",
                        "admin",
                        "static"
                    ]
                },
                "applicationContext": {
                    "description": "Application Context",
                    "type": "string"
                }
            },
            "required": [
                "value",
                "description"
            ],
            "additionalProperties": false
        }
    }
}