<?php

namespace Anakeen\Components\Grid\Routes;

use Anakeen\Core\ContextManager;
use Anakeen\Core\Internal\Format\FormatAttributeValue;
use Anakeen\Core\Internal\SmartElement;
use Anakeen\Core\Settings;
use Anakeen\Router\URLUtils;
use Anakeen\Ui\DataSource;

class GridContent extends DataSource
{
    protected function getData()
    {
        $data = parent::getData();
        $data["uri"] = URLUtils::generateURL(Settings::ApiV2 . sprintf("grid/content/%s", $this->smartElementId));

        if (ContextManager::getParameterValue("Ui",  "MODE_DEBUG")) {
            $data["debug"]=$this->_searchDoc->getSearchInfo();
        }
        $data["requestParameters"]["pager"]=array(
            "page" => intval($this->page),
            "skip" => intval($this->_searchDoc->start),
            "take" => intval($this->_searchDoc->slice),
            "pageSize" => intval($this->pageSize),
            "total" => intval($this->_searchDoc->onlyCount()),
        );


        return $data;
    }

    protected static function formatProperty($propertyValue, $propertyId, SmartElement $smartEl) {
        switch ($propertyId) {
            case "title":
                $propertyInfo["value"] = $propertyValue;
                $propertyInfo["displayValue"] = $propertyValue;
                $propertyInfo["withIcon"] = $smartEl->getIcon();
                break;
            default:
                return $propertyValue;
        }
        return $propertyInfo;
    }

    protected function prepareDocumentFormatter($documentList)
    {
        $formatter = parent::prepareDocumentFormatter($documentList); // TODO: Change the autogenerated stub
        $formatter->getFormatCollection()->setPropertyRenderHook(function (...$args) {
            return static::formatProperty(...$args);
        });
        return $formatter;
    }
}