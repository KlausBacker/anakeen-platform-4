{"version":3,"sources":["webpack:///./src/Apps/DOCUMENT/IHM/document.js","webpack:///./src/Apps/DOCUMENT/IHM/widgets/attributes/docid/wCreateDocument.js"],"names":["umdRequire","root","factory","define","window","jQuery","_","require_document","$","eventList","ErrorNotLoaded","dcpDocument_ErrorNotLoaded","message","name","prototype","Object","create","Error","constructor","widget","_template","template","defaults","uniqueId","_create","dcpDocument_create","options","extend","eventListener","constraintList","cssToInject","jsToInject","_render","_bindEvents","dcpDocument_render","$iframe","currentWidget","documentWindow","options_encode","JSON","stringify","omit","element","empty","append","iframeName","json_encode","find","length","contentWindow","location","href","data","on","dcpDocument_setReadyEvent","documentLoaded","dcpDocument_loadedCallback","domNode","viewData","_bindInternalWidget","call","initid","dcpDocument_setUnloadEvent","_unbindInternalWidget","dcp","triggerReload","documentReady","_resize","dcpDocument_unbindInternalWidget","_trigger","rebindEvents","dcpDocument_rebindEvents","internalController","each","dcpDocument_bindEvent","currentEvent","addEventListener","currentConstaint","addConstraint","reinjectCSSAndJS","dcpDocument_reinjectCSSAndJS","injectCSS","injectJS","e","dcpDocument_bindInternalWidget","voidLoaded","dcpDocument_bindEvents","withoutResize","eventNamespace","debounce","bind","parseInt","resizeDebounceTime","dcpDocument_resize","event","$documentWrapper","height","innerHeight","resizeMarginHeight","width","innerWidth","resizeMarginWidth","defer","dcpDocument_computeHeight","tryToDestroy","dcpDocument_tryToDestroy","Promise","dcpDocument_tryToDestroy_promise","resolve","reject","internalWidget","isLoaded","then","dcpDocument_destroy_then","_destroy","dcpDocument_destroy_catch","errorMessage","dcpDocument_destroy","off","_super","_checkEventName","documentController_checkEventName","eventName","isString","indexOf","documentController_CheckEventType","currentEventType","join","dcpDocument_options","fetchDocument","dcpDocument_fetchDocument","values","fetchPromise","initWidget","dpcDocument_successWidget","pick","dcpDocument_setNewOptions","value","key","success","wrap","dcpDocument_success","apply","rest","arguments","error","dcpDocument_error","catch","dcpDocument_addEventListener","eventType","callback","isUndefined","isFunction","isObject","once","eventCallback","dcpDocument_onceWrapper","console","removeEventListener","listEventListeners","documentControllerListEvents","dcpDocument_removeEventListener","removed","testRegExp","RegExp","newList","filter","dcpDocument_removeCurrentEvent","test","push","dcp_documentIterateEach","dcpDocument_addConstraint","parameters","dcpDocument_defaultDocumentCheck","dcpDocument_defaultAttributeCheck","constraintCheck","removeConstraint","externalConstraint","listConstraints","documentControllerListConstraint","dcpDocument_removeConstraint","constraintName","newConstraintList","currentConstraint","dcpDocument_reinitConstraint","dcpDocument_isLoaded","documentController_injectCSS","isArray","union","fn","document","dcpDocument_wrap","initialDocumentBridge","methodName","isMethodCall","charAt","wCreateDocument","Mustache","i18n","attributeTemplate","title","attributeId","originDocumentModel","index","wcdCreate","open","wcdOpen","wWidget","config","createLabel","documentModel","attributeModel","get","currentValue","url","$createDocument","getValue","$dialog","renderTitle","render","windowTitle","dw","dcpWindow","windowWidth","windowHeight","content","iframe","close","wcdClose","closeDialog","kendoWindow","center","wAttributeCreateDocumentCreation","addClass","viewId","familyName","wDocidCreateDocumentReady","documentInfo","wOrigin","isPrevented","menuItem","$document","proxyTrigger","getFormValues","wcdCustomGetFormValues","formValues","setFormValues","wcdCustomSetFormValues","customFormValues","setFormValue","documentController","hide","setLabel","attributes","updateLabel","wAttributeCreateDocumentbeforeClose","documentObject","eventId","preventDefault","wAttributeCreateDocumentRecord","currentDocumentObject","newOneValue","displayValue","familyRelation","family","icon","newValue","attributeValue","hasMultipleOption","clone","setValue","wcdSetFormValue","$subDoc","tplData","getTemplateModelInfo","wDocidFormValues","attrValue","attrId","rValue","isAttr","exec","wcdTrigger","triggerName","listener","args","dialogWindow","prevent","confirmClose","wcdConfirmClose","targetProperties","wsdAskConfirmation","confirmWindow","dcpConfirm","___","maxWidth","messages","okMessage","cancelMessage","htmlMessage","textMessage","confirm","cancel","wcdcloseDialog","askConfirm","kDialog","isModified","log","destroy"],"mappings":"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","file":"wCreateDocument.js","sourcesContent":["/*global define, console*/\n(function umdRequire(root, factory)\n{\n    'use strict';\n\n    if (typeof define === 'function' && define.amd) {\n        define([\n            'jquery',\n            'underscore',\n            'dcpDocument/widgets/widget'\n        ], factory);\n    } else {\n        factory(window.jQuery, window._);\n    }\n}(window, function require_document($, _)\n{\n    'use strict';\n\n    var eventList = [\"beforeRender\", \"ready\", \"change\", \"displayMessage\", \"displayError\", \"validate\",\n        \"attributeBeforeRender\", \"attributeReady\",\n        \"attributeHelperSearch\", \"attributeHelperResponse\", \"attributeHelperSelect\",\n        \"attributeArrayChange\", \"actionClick\",\n        \"attributeAnchorClick\",\n        \"beforeClose\", \"close\",\n        \"beforeSave\", \"afterSave\", \"attributeDownloadFile\", \"attributeUploadFile\", \"attributeUploadFileDone\",\n        \"beforeDelete\", \"afterDelete\",\n        \"beforeRestore\", \"afterRestore\",\n        \"failTransition\", \"successTransition\",\n        \"beforeDisplayTransition\", \"afterDisplayTransition\",\n        \"beforeTransition\", \"beforeTransitionClose\",\n        \"destroy\", \"attributeCreateDialogDocumentBeforeSetFormValues\",\n        \"attributeCreateDialogDocumentBeforeSetTargetValue\", \"attributeCreateDialogDocumentReady\",\n        \"attributeCreateDialogDocumentBeforeClose\", \"attributeCreateDialogDocumentBeforeDestroy\"\n    ];\n\n    //Create a new kind of event\n    var ErrorNotLoaded = function dcpDocument_ErrorNotLoaded(message)\n    {\n        this.name = 'WidgetDocumentNotLoaded';\n        this.message = message || 'The document widget is not loaded, wait for the documentloaded event';\n    };\n    ErrorNotLoaded.prototype = Object.create(Error.prototype);\n    ErrorNotLoaded.prototype.constructor = ErrorNotLoaded;\n\n    $.widget(\"dcp.document\", {\n\n        _template: _.template('<iframe class=\"dcpDocumentWrapper\" name=\"<%- options.iframeName %>\" style=\"border : 0;\" data-src=\"api/v1/documents/0.html#widgetValue<%- options.json_encode %>\"></iframe>'),\n\n        defaults: {\n            \"resizeMarginHeight\": 3,\n            \"resizeMarginWidth\": 0,\n            \"resizeDebounceTime\": 50,\n            \"withoutResize\": false,\n            \"iframeName\": _.uniqueId(\"documentFrame\"),\n            \"noRouter\": true,\n            \"eventPrefix\": \"document\"\n        },\n\n        /**\n         * Create the widget\n         *\n         * Check if initid is present\n         */\n        _create: function dcpDocument_create()\n        {\n            this.options = _.extend({}, this.defaults, this.options);\n            this.options.eventListener = {};\n            this.options.constraintList = {};\n            this.options.cssToInject = [];\n            this.options.jsToInject = [];\n            this._render();\n            this._bindEvents();\n        },\n\n        /**\n         * Create the iframe with the content and register to load event\n         */\n        _render: function dcpDocument_render()\n        {\n            var $iframe, currentWidget = this, documentWindow, options_encode;\n            //inject the iframe\n            options_encode = JSON.stringify(_.omit(this.options,\n                \"resizeMarginHeight\", \"resizeMarginWidth\", \"resizeDebounceTime\",\n                \"withoutResize\", \"iframeName\", \"eventPrefix\", \"eventListener\",\n                \"constraintList\"\n            ));\n            this.element.empty().append(this._template({options:  {\n                iframeName : this.options.iframeName,\n                json_encode: options_encode\n            }}));\n            //bind the internal controller to the documentWidget\n            $iframe = this.element.find(\".dcpDocumentWrapper\");\n            //Listen the load to the iframe (initial JS added and page loaded)\n\n            if ($iframe.length > 0) {\n                documentWindow = $iframe[0].contentWindow;\n                //Use this way to set url for firefox (when the document is in iframe in another document)\n                documentWindow.location.href = $iframe.data(\"src\");\n                // This event is used when use a hard link (aka href anchor) to change document\n                // It is load also the first time\n                $iframe.on(\"load\", function dcpDocument_setReadyEvent()\n                {\n                    documentWindow.documentLoaded = function dcpDocument_loadedCallback(domNode, viewData)\n                    {\n                        // Re Bind the internalController function to the current widget\n                        currentWidget._bindInternalWidget.call(currentWidget, domNode.data(\"dcpDocumentController\"), viewData);\n                        // voidLoaded is true when document 0 is loaded\n                        currentWidget.element.data(\"voidLoaded\", !viewData || !viewData.initid );\n                    };\n\n                    $(documentWindow).on(\"unload\", function dcpDocument_setUnloadEvent()\n                    {\n                        currentWidget._unbindInternalWidget.call(currentWidget);\n                    });\n                    if (documentWindow.dcp && documentWindow.dcp.triggerReload && documentWindow.dcp.documentReady === false) {\n                        documentWindow.dcp.triggerReload();\n                    }\n                });\n\n            }\n            this._resize();\n        },\n\n        /**\n         * Suppress internal widget reference\n         */\n        _unbindInternalWidget: function dcpDocument_unbindInternalWidget()\n        {\n            this.element.data(\"internalWidgetInitialised\", false);\n            this.element.data(\"internalWidget\", false);\n            this._trigger(\"internalWidgetUnloaded\");\n            this._trigger(\"unloaded\");\n        },\n\n        rebindEvents: function dcpDocument_rebindEvents()\n        {\n            var internalController = this.element.data(\"internalWidget\");\n            if (internalController) {\n\n                //Rebind event\n                _.each(this.options.eventListener, function dcpDocument_bindEvent(currentEvent)\n                {\n                    internalController.addEventListener(currentEvent);\n                });\n                //Rebind constraint\n                _.each(this.options.constraintList, function dcpDocument_bindEvent(currentConstaint)\n                {\n                    internalController.addConstraint(currentConstaint);\n                });\n            }\n        },\n\n        reinjectCSSAndJS: function dcpDocument_reinjectCSSAndJS()\n        {\n            var internalController = this.element.data(\"internalWidget\");\n            if (internalController) {\n                try {\n                    internalController.injectCSS(this.options.cssToInject);\n                    internalController.injectJS(this.options.jsToInject);\n                } catch(e) {\n\n                }\n            }\n        },\n\n        /**\n         * Bind the internal controller to the current widget\n         * Reinit the constraint and the event\n         *\n         * @param internalController\n         * @param voidLoaded\n         */\n        _bindInternalWidget: function dcpDocument_bindInternalWidget(internalController, voidLoaded)\n        {\n            this.element.data(\"internalWidget\", internalController);\n            if (!voidLoaded) {\n                this.rebindEvents();\n                this.reinjectCSSAndJS();\n            }\n            this.element.data(\"internalWidgetInitialised\", true);\n            if (voidLoaded) {\n                this._trigger(\"loaded\", {}, {\"isEmpty\": true});\n                return this;\n            }\n            this._trigger(\"loaded\");\n            return this;\n        },\n\n        /**\n         * Add resize event\n         */\n        _bindEvents: function dcpDocument_bindEvents()\n        {\n            if (!this.options.withoutResize) {\n                $(window).on(\"resize\" + this.eventNamespace, _.debounce(_.bind(this._resize, this), parseInt(this.options.resizeDebounceTime, 10)));\n                this._resize();\n            }\n        },\n\n        /**\n         * Compute the size of the widget\n         */\n        _resize: function dcpDocument_resize()\n        {\n            var event = this._trigger(\"autoresize\"),\n                $documentWrapper = this.element.find(\".dcpDocumentWrapper\"),\n                currentWidget = this,\n                element = this.element;\n            //the computation can be done by an external function and default prevented\n            if (!this.options.withoutResize && event) {\n                //compute two times height (one for disapear horizontal scrollbar, two to get the actual size)\n                //noinspection JSValidateTypes\n                $documentWrapper.height(element.innerHeight() - parseInt(currentWidget.options.resizeMarginHeight, 10));\n                //noinspection JSValidateTypes\n                $documentWrapper.width(element.innerWidth() - parseInt(currentWidget.options.resizeMarginWidth, 10));\n                //defer height computation to let the time to scrollbar disapear\n                _.defer(function dcpDocument_computeHeight()\n                {\n                    //noinspection JSValidateTypes\n                    $documentWrapper.height(element.innerHeight() - parseInt(currentWidget.options.resizeMarginHeight, 10));\n                });\n            }\n        },\n\n        tryToDestroy: function dcpDocument_tryToDestroy() {\n            var currentWidget = this;\n            return new Promise(function dcpDocument_tryToDestroy_promise(resolve, reject) {\n                var internalWidget;\n                if (currentWidget.isLoaded()) {\n                    internalWidget = currentWidget.element.data(\"internalWidget\");\n                    internalWidget.tryToDestroy().then(function dcpDocument_destroy_then() {\n                        resolve();\n                        currentWidget._destroy();\n                    })[\"catch\"](function dcpDocument_destroy_catch(errorMessage) {\n                        reject(errorMessage);\n                    });\n                    return;\n                }\n                resolve();\n                currentWidget._destroy();\n            });\n        },\n\n        /**\n         * Destroy the widget\n         */\n        _destroy: function dcpDocument_destroy()\n        {\n            $(window).off(this.eventNamespace);\n            this.element.empty();\n            this._unbindInternalWidget();\n            this._trigger(\"destroy\");\n            this._super();\n        },\n\n        /**\n         * Check if event name is valid\n         *\n         * @param eventName string\n         * @private\n         */\n        _checkEventName: function documentController_checkEventName(eventName)\n        {\n            if (_.isString(eventName) &&\n                (eventName.indexOf(\"custom:\") === 0 ||\n                    _.find(eventList, function documentController_CheckEventType(currentEventType)\n                    {\n                        return currentEventType === eventName;\n                    })\n                )) {\n                return true;\n            }\n            throw new Error(\"The event type \" + eventName + \" is not known. It must be one of \" + eventList.join(\" ,\"));\n        },\n\n        /**\n         * Update options\n         */\n        options: function dcpDocument_options()\n        {\n            throw new Error(\"You cannot modify the options, you need to suppress the widget\");\n        },\n\n        /**\n         * Fetch a new document\n         *\n         * Use internal controller if ready\n         * Re-render the widget if internal is not ready\n         *\n         * @param values\n         * @param options\n         */\n        fetchDocument: function dcpDocument_fetchDocument(values, options)\n        {\n            var internalWidget,\n                currentWidget = this,\n                fetchPromise = null,\n                initWidget = function dpcDocument_successWidget()\n                {\n                    currentWidget.rebindEvents.call(currentWidget);\n                    currentWidget.element.data(\"voidLoaded\", false);\n                };\n            options = options || {};\n\n            if (!values.initid) {\n                throw new Error(\"You need to set the initid to fetch the document\");\n            }\n            _.each(_.pick(values, \"initid\", \"revision\", \"viewId\", \"customClientData\"), function dcpDocument_setNewOptions(value, key)\n            {\n                currentWidget.options[key] = value;\n            });\n\n            if (this.element.data(\"internalWidgetInitialised\")) {\n                internalWidget = this.element.data(\"internalWidget\");\n\n                if (options.success) {\n                    // @deprecated : use promise instead\n                    options.success = _.wrap(options.success, function dcpDocument_success(success)\n                    {\n                        initWidget.apply(this, _.rest(arguments));\n                        return success.apply(this, _.rest(arguments));\n                    });\n                }\n                if (options.error) {\n                    // @deprecated : use promise instead\n                    options.error = _.wrap(options.error, function dcpDocument_error(error)\n                    {\n                        initWidget.apply(this, _.rest(arguments));\n                        return error.apply(this, _.rest(arguments));\n                    });\n                }\n                fetchPromise = internalWidget.fetchDocument.call(internalWidget, values, options);\n\n                if (!options.success) {\n                    fetchPromise.then(initWidget);\n                }\n                if (!options.error) {\n                    fetchPromise.catch(initWidget);\n                }\n                return fetchPromise;\n            } else {\n                this._render();\n            }\n        },\n\n        /**\n         * Add a new external event\n         * The event is added in the widget and is auto-rebinded when the internal widget is reloaded\n         *\n         * @param eventType string|object type of the widget or an object event\n         * @param options object|function conf of the event or callback\n         * @param callback function callback\n         * @returns {*}\n         */\n        addEventListener: function dcpDocument_addEventListener(eventType, options, callback)\n        {\n            var currentEvent, currentWidget = this;\n            if (_.isUndefined(callback) && _.isFunction(options)) {\n                callback = options;\n                options = {};\n            }\n            // the first parameters can be the final object (chain removeEvent and addEvent)\n            if (_.isObject(eventType) && _.isUndefined(options) && _.isUndefined(callback)) {\n                currentEvent = eventType;\n                if (!currentEvent.name) {\n                    throw new Error(\"When an event is initiated with a single object, this object needs to have the name property \".JSON.stringify(currentEvent));\n                }\n            } else {\n                currentEvent = _.defaults(options, {\n                    \"name\": _.uniqueId(\"event_\" + eventType),\n                    \"eventType\": eventType,\n                    \"eventCallback\": callback,\n                    \"externalEvent\": true,\n                    \"once\": false\n                });\n            }\n            // the eventType must be one the list\n            this._checkEventName(currentEvent.eventType);\n            if (currentEvent.once === true) {\n                currentEvent.eventCallback = _.wrap(currentEvent.eventCallback, function dcpDocument_onceWrapper(callback)\n                {\n                    try {\n                        callback.apply(this, _.rest(arguments));\n                    } catch (e) {\n                        console.error(e);\n                    }\n                    currentWidget.removeEventListener(currentEvent.name);\n                });\n            }\n            //Remove once property because already wrapped\n            currentEvent.once = false;\n            this.options.eventListener[currentEvent.name] = currentEvent;\n            if (this.element.data(\"internalWidgetInitialised\") && !this.element.data(\"voidLoaded\")) {\n                this.element.data(\"internalWidget\").addEventListener(currentEvent);\n            }\n            return currentEvent.name;\n        },\n\n        /**\n         * List of the events of the current widget\n         *\n         * @returns {*}\n         */\n        listEventListeners: function documentControllerListEvents()\n        {\n            if (this.element.data(\"internalWidgetInitialised\") && !this.element.data(\"voidLoaded\")) {\n                return this.element.data(\"internalWidget\").listEventListeners();\n            } else {\n                return this.options.eventListener;\n            }\n        },\n\n        /**\n         * Remove the event of the widget list and the internal list (if internal is ready)\n         *\n         * @param eventName\n         * @returns {Array}\n         */\n        removeEventListener: function dcpDocument_removeEventListener(eventName)\n        {\n            var removed = [],\n                testRegExp = new RegExp(\"\\\\\" + eventName + \"$\"), newList, eventList;\n            newList = _.filter(this.options.eventListener, function dcpDocument_removeCurrentEvent(currentEvent)\n            {\n                if (currentEvent.name === eventName || testRegExp.test(currentEvent.name)) {\n                    removed.push(currentEvent);\n                    return false;\n                }\n                return true;\n            });\n            eventList = {};\n            _.each(newList, function dcp_documentIterateEach(currentEvent)\n            {\n                eventList[currentEvent.name] = currentEvent;\n            });\n            this.options.eventListener = eventList;\n            if (this.element.data(\"internalWidgetInitialised\") && !this.element.data(\"voidLoaded\")) {\n                this.element.data(\"internalWidget\").removeEventListener(eventName, true);\n            }\n            return removed;\n        },\n\n        /**\n         * Add a constraint\n         * The constraint is added in the widget and is auto-rebinded when the internal widget is reloaded\n         *\n         * @param options\n         * @param callback\n         * @returns {*}\n         */\n        addConstraint: function dcpDocument_addConstraint(options, callback)\n        {\n            var parameters, currentWidget = this;\n            if (_.isUndefined(callback) && _.isFunction(options)) {\n                callback = options;\n                options = {};\n            }\n            if (_.isObject(options) && _.isUndefined(callback)) {\n                if (!options.name) {\n                    throw new Error(\"When a constraint is initiated with a single object, this object needs to have the name property \".JSON.stringify(options));\n                }\n            } else {\n                parameters = _.defaults(options, {\n                    \"documentCheck\": function dcpDocument_defaultDocumentCheck()\n                    {\n                        return true;\n                    },\n                    \"attributeCheck\": function dcpDocument_defaultAttributeCheck()\n                    {\n                        return true;\n                    },\n                    \"constraintCheck\": callback,\n                    \"name\": _.uniqueId(\"constraint\"),\n                    \"externalConstraint\": false,\n                    \"once\": false\n                });\n            }\n            if (!_.isFunction(parameters.constraintCheck)) {\n                throw new Error(\"An event need a callback\");\n            }\n            if (parameters.once === true) {\n                parameters.eventCallback = _.wrap(parameters.constraintCheck, function dcpDocument_onceWrapper(callback)\n                {\n                    try {\n                        callback.apply(this, _.rest(arguments));\n                    } catch (e) {\n                        console.error(e);\n                    }\n                    currentWidget.removeConstraint(parameters.name, parameters.externalConstraint);\n                });\n            }\n            this.options.constraintList[parameters.name] = parameters;\n            if (this.element.data(\"internalWidgetInitialised\") && !this.element.data(\"voidLoaded\")) {\n                this.element.data(\"internalWidget\").addConstraint(parameters);\n            }\n            return parameters.name;\n        },\n        /**\n         * List the constraint of the widget\n         *\n         * @returns {*}\n         */\n        listConstraints: function documentControllerListConstraint()\n        {\n            if (this.element.data(\"internalWidgetInitialised\") && !this.element.data(\"voidLoaded\")) {\n                return this.element.data(\"internalWidget\").listConstraints();\n            } else {\n                return this.options.constraintList;\n            }\n        },\n        /**\n         * Remove the constraint of the widget\n         *\n         * @param constraintName\n         * @returns {Array}\n         */\n        removeConstraint: function dcpDocument_removeConstraint(constraintName)\n        {\n            var removed = [], newConstraintList, constraintList,\n                testRegExp = new RegExp(\"\\\\\" + constraintName + \"$\");\n            newConstraintList = _.filter(this.options.constraintList, function dcpDocument_removeConstraint(currentConstraint)\n            {\n                if (currentConstraint.name === constraintName || testRegExp.test(currentConstraint.name)) {\n                    removed.push(currentConstraint);\n                    return false;\n                }\n                return true;\n            });\n            constraintList = {};\n            _.each(newConstraintList, function dcpDocument_reinitConstraint(currentConstraint)\n            {\n                constraintList[currentConstraint.name] = currentConstraint;\n            });\n            this.options.constraintList = constraintList;\n            if (this.element.data(\"internalWidgetInitialised\") && !this.element.data(\"voidLoaded\")) {\n                this.element.data(\"internalWidget\").removeConstraint(constraintName, true);\n            }\n            return removed;\n        },\n\n        isLoaded: function dcpDocument_isLoaded()\n        {\n            return this.element.data(\"internalWidgetInitialised\") && !this.element.data(\"voidLoaded\");\n        },\n\n        injectCSS: function documentController_injectCSS(cssToInject)\n        {\n            if (!_.isArray(cssToInject) && !_.isString(cssToInject)) {\n                throw new Error(\"The css to inject must be an array string or a string\");\n            }\n            if (_.isString(cssToInject)) {\n                cssToInject = [cssToInject];\n            }\n\n            this.options.cssToInject = _.union(this.options.cssToInject, cssToInject);\n\n            if (this.element.data(\"internalWidgetInitialised\") && !this.element.data(\"voidLoaded\")) {\n                this.element.data(\"internalWidget\").injectCSS(cssToInject);\n            }\n        },\n\n        injectJS: function documentController_injectCSS(jsToInject)\n        {\n            if (!_.isArray(jsToInject) && !_.isString(jsToInject)) {\n                throw new Error(\"The js to inject must be an array string or a string\");\n            }\n            if (_.isString(jsToInject)) {\n                jsToInject = [jsToInject];\n            }\n\n            this.options.jsToInject = _.union(this.options.jsToInject, jsToInject);\n\n            if (this.element.data(\"internalWidgetInitialised\") && !this.element.data(\"voidLoaded\")) {\n                this.element.data(\"internalWidget\").injectJS(jsToInject);\n            }\n        }\n\n    });\n\n    //noinspection JSValidateJSDoc\n    /**\n     * Wrap the bridge that find the function to be executed\n     * Search in the current widget if the function is here\n     * Search in the internal widget (if ready to find the widget)\n     *\n     * @type {Function|function(): Function|function(): _Chain<T>|*}\n     */\n    //noinspection JSUnresolvedVariable\n    $.fn.document = _.wrap($.fn.document, function dcpDocument_wrap(initialDocumentBridge, methodName)\n    { // jshint ignore:line\n        var isMethodCall, internalWidget;\n        try {\n            return initialDocumentBridge.apply(this, _.rest(arguments));\n        } catch (error) {\n            if (error.name === \"noSuchMethodError\") {\n                isMethodCall = typeof methodName === \"string\";\n                if (isMethodCall && !this.data(\"internalWidgetInitialised\")) {\n                    throw new ErrorNotLoaded();\n                }\n                internalWidget = this.data(\"internalWidget\");\n                if (_.isFunction(internalWidget[methodName]) && methodName.charAt(0) !== \"_\") {\n                    return internalWidget[methodName].apply(internalWidget, _.rest(arguments, 2));\n                }\n            }\n            throw error;\n        }\n    });\n\n}));\n\n\n\n// WEBPACK FOOTER //\n// ./src/Apps/DOCUMENT/IHM/document.js","define([\n    'underscore',\n    'jquery',\n    \"mustache\",\n    'dcpDocument/i18n/documentCatalog',\n    'dcpDocument/views/document/attributeTemplate',\n    'dcpDocument/document'\n], function wCreateDocument(_, $, Mustache, i18n, attributeTemplate) {\n    'use strict';\n\n    $.widget(\"dcp.dcpCreateDocument\", {\n        options: {\n            title: \"Document\",\n            width: \"300px\",\n            height: \"400px\",\n            attributeId: null,\n            originDocumentModel: null,\n            index: -1\n\n        },\n\n        _create: function wcdCreate() {\n            this.element.data(\"dcpCreateDocument\", this);\n        },\n\n        open: function wcdOpen() {\n            var wWidget = this;\n            var config = this.options;\n            var index = config.index;\n            if (config.createLabel) {\n                var documentModel = config.originDocumentModel;\n                var attributeModel = documentModel.get('attributes').get(config.attributeId);\n                var currentValue;\n                var url = \"about:blank\";\n                var $createDocument;\n\n                if (index >= 0) {\n                    currentValue = attributeModel.getValue()[index];\n                } else {\n                    currentValue = attributeModel.getValue();\n                }\n\n                this.$dialog = $('<div class=\"dcpDocid-create-window\"/>');\n                $('body').append(this.$dialog);\n                var renderTitle = Mustache.render(config.windowTitle || \"\", currentValue);\n                var dw = this.$dialog.dcpWindow({\n                    title: renderTitle,\n                    width: config.windowWidth,\n                    height: config.windowHeight,\n                    content: url,\n                    iframe: true,\n                    close: function wcdClose(event) {\n                        wWidget.closeDialog(event, true);\n                    }\n                }).data('dcpWindow');\n                dw.kendoWindow().center();\n                dw.open();\n\n                $createDocument = dw.currentWidget;\n                $createDocument.on(\"documentcreate\", function wAttributeCreateDocumentCreation() {\n                    dw.currentWidget.find(\"> iframe\").addClass(\"k-content-frame\");\n                });\n\n                if (currentValue.value) {\n                    $createDocument.document({\n                        initid: currentValue.value,\n                        viewId: \"!defaultEdition\",\n                        withoutResize: true\n                    });\n                } else {\n                    $createDocument.document({\n                        initid: config.familyName || attributeModel.get(\"typeFormat\"),\n                        viewId: \"!defaultCreation\",\n                        withoutResize: true\n                    });\n                }\n\n                $createDocument.on(\"documentloaded\", function () {\n                    $(this).document(\"addEventListener\", \"ready\",\n                        {name: \"ddui:create:ready\"},\n                        function wDocidCreateDocumentReady(event, documentInfo) {\n                            var wOrigin = this;\n                            var isPrevented;\n                            var menuItem;\n                            wWidget.$document = this;\n\n                            isPrevented = wWidget.proxyTrigger(event, \"ready\", {});\n                            if (!isPrevented) {\n                                if (documentInfo.viewId === \"!defaultCreation\") {\n                                    // Set form values\n                                    isPrevented = wWidget.proxyTrigger(event, \"beforeSetFormValues\",\n                                        {\n                                            getFormValues: function wcdCustomGetFormValues() {\n                                                return config.formValues;\n                                            },\n                                            setFormValues: function wcdCustomSetFormValues(customFormValues) {\n                                                wWidget.setFormValue(customFormValues, wOrigin);\n                                            }\n                                        }\n                                    );\n\n                                    if (!isPrevented) {\n                                        wWidget.setFormValue(config.formValues, this);\n                                    }\n                                }\n                                menuItem = this.documentController(\"getMenu\", \"createAndClose\");\n                                if (menuItem) {\n                                    menuItem.hide();\n                                }\n                                menuItem = this.documentController(\"getMenu\", \"saveAndClose\");\n                                if (menuItem) {\n                                    menuItem.hide();\n                                }\n                                menuItem = this.documentController(\"getMenu\", \"create\");\n                                if (menuItem) {\n                                    menuItem.setLabel(Mustache.render(config.createLabel, attributeModel.attributes));\n                                }\n                                menuItem = this.documentController(\"getMenu\", \"save\");\n                                if (menuItem) {\n                                    menuItem.setLabel(Mustache.render(config.updateLabel, attributeModel.attributes));\n                                }\n                            }\n\n\n                        });\n\n                    $(this).document(\"addEventListener\",\n                        \"actionClick\",\n                        {\n                            name: \"ddui:create:close\"\n                        },\n                        function wAttributeCreateDocumentbeforeClose(event, documentObject, options) {\n                            if (options.eventId === \"document.close\") {\n                                event.preventDefault();\n                                wWidget.closeDialog(event, true);\n                            }\n                        }\n                    );\n\n                    $(this).document(\"addEventListener\",\n                        \"afterSave\",\n                        {\n                            name: \"ddui:create:record\"\n                        },\n                        function wAttributeCreateDocumentRecord(event, currentDocumentObject) {\n                            var newOneValue = {\n                                value: currentDocumentObject.initid,\n                                displayValue: currentDocumentObject.title,\n                                familyRelation: currentDocumentObject.family.name,\n                                icon: currentDocumentObject.icon\n                            };\n                            var newValue;\n                            var isPrevented;\n                            isPrevented = wWidget.proxyTrigger(event, \"beforeSetTargetValue\",\n                                {\n                                    attributeValue: newOneValue\n                                }\n                            );\n                            if (isPrevented) {\n                                return;\n                            }\n\n                            if (attributeModel.hasMultipleOption()) {\n                                newValue = attributeModel.getValue();\n                                if (index >= 0) {\n                                    newValue = newValue[index];\n                                }\n                                if (_.isArray(newValue)) {\n                                    newValue = _.clone(newValue); // need to clone to trigger backbone change\n                                    newValue.push(newOneValue);\n                                } else {\n                                    newValue = [newOneValue];\n                                }\n                            } else {\n                                newValue = newOneValue;\n                            }\n                            attributeModel.setValue(newValue, index);\n\n                            isPrevented = wWidget.proxyTrigger(event, \"beforeClose\", {\n                                attributeValue: newValue\n                            });\n                            if (!isPrevented) {\n                                dw.close();\n                            }\n                        }\n                    );\n                });\n            }\n        },\n        setFormValue: function wcdSetFormValue(formValues, $subDoc) {\n\n            var documentModel = this.options.originDocumentModel;\n            var tplData = attributeTemplate.getTemplateModelInfo(documentModel);\n            // Set form values\n            _.each(formValues, function wDocidFormValues(attrValue, attrId) {\n                var rValue;\n                if (_.isObject(attrValue)) {\n                    $subDoc.documentController(\"setValue\", attrId, attrValue);\n                } else {\n                    var isAttr = new RegExp(\"^{{attributes\\.(.+)\\.attributeValue}}$\").exec(attrValue);\n\n                    if (isAttr && documentModel.get(\"attributes\").get(isAttr[1])) {\n                        rValue = documentModel.get(\"attributes\").get(isAttr[1]).getValue();\n                        $subDoc.documentController(\"setValue\", attrId, rValue);\n                    } else {\n                        rValue = Mustache.render(attrValue, tplData);\n                        $subDoc.documentController(\"setValue\", attrId, {\n                            value: rValue,\n                            displayValue: rValue\n                        });\n                    }\n                }\n            });\n        },\n\n        proxyTrigger: function wcdTrigger(event, triggerName, options) {\n            var listener, args;\n            if (this.options[triggerName]) {\n                listener = this.options[triggerName];\n                args = [event, options];\n            } else\n                if (this.options.listener) {\n                    listener = this.options.listener;\n                    args = [event, triggerName, options];\n                }\n            if (listener) {\n                options.index = this.options.index;\n                options.dialogWindow = this.$dialog;\n                listener.apply(this.$document, args);\n                return (event.prevent === true);\n            }\n            return false;\n        },\n\n        confirmClose: function wcdConfirmClose() {\n            var targetProperties = this.$document.documentController(\"getProperties\");\n            return new Promise(function wsdAskConfirmation(resolve, reject) {\n                var confirmWindow = $('body').dcpConfirm({\n                    title: Mustache.render(i18n.___(\"Confirm close form \\\"{{title}}\\\"\", \"ddui\"), targetProperties),\n                    width: \"510px\",\n                    height: \"150px\",\n                    maxWidth: $(window).width(),\n                    messages: {\n                        okMessage: i18n.___(\"Abord modification\", \"ddui\"),\n                        cancelMessage: i18n.___(\"Stay on the form\", \"ddui\"),\n                        htmlMessage: i18n.___(\"The form has been modified without saving\", \"ddui\"),\n                        textMessage: ''\n                    },\n                    confirm: resolve,\n                    cancel: reject\n                });\n                confirmWindow.data('dcpWindow').open();\n            });\n        },\n\n        closeDialog: function wcdcloseDialog(event, askConfirm) {\n            var wWidget = this;\n            var isPrevented = false;\n            var kDialog = this.$dialog.data(\"dcpWindow\");\n            if (this.$document) {\n\n                var targetProperties = this.$document.documentController(\"getProperties\");\n                isPrevented = this.proxyTrigger(event, \"beforeClose\", {});\n\n                if (!isPrevented && askConfirm && targetProperties && targetProperties.isModified) {\n                    console.log(\"modified\", targetProperties);\n                    wWidget.confirmClose().then(function wcdConfirmClose() {\n                        wWidget.closeDialog(event, false);\n                    });\n                    isPrevented = true;\n                }\n            }\n            if (!isPrevented) {\n                isPrevented = wWidget.proxyTrigger(event, \"beforeDestroy\", {});\n                if (!isPrevented) {\n                    kDialog.destroy();\n                }\n            } else {\n                event.preventDefault();\n            }\n        }\n    });\n});\n\n\n// WEBPACK FOOTER //\n// ./src/Apps/DOCUMENT/IHM/widgets/attributes/docid/wCreateDocument.js"],"sourceRoot":""}