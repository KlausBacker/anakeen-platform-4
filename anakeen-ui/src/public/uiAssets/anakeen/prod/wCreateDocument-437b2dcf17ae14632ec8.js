/*! v1.0.0-1098-g48daa27 */
webpackJsonp(["wCreateDocument","wDocument"],{a2b1083ba5d095ec0632:function(e,t,i){"use strict";var n,o,r;!function(a,s){o=[i('external "jQuery"'),i("8e08e542008e4aef1f58"),i("f562ab9f022eef93542c")],void 0===(r="function"==typeof(n=s)?n.apply(t,o):n)||(e.exports=r)}(window,function(e,t){var i=["beforeRender","ready","change","displayMessage","displayError","validate","attributeBeforeRender","attributeReady","attributeHelperSearch","attributeHelperResponse","attributeHelperSelect","attributeArrayChange","actionClick","attributeAnchorClick","beforeClose","close","beforeSave","afterSave","attributeDownloadFile","attributeUploadFile","attributeUploadFileDone","beforeDelete","afterDelete","beforeRestore","afterRestore","failTransition","successTransition","beforeDisplayTransition","afterDisplayTransition","beforeTransition","beforeTransitionClose","destroy","attributeCreateDialogDocumentBeforeSetFormValues","attributeCreateDialogDocumentBeforeSetTargetValue","attributeCreateDialogDocumentReady","attributeCreateDialogDocumentBeforeClose","attributeCreateDialogDocumentBeforeDestroy"],n=function(e){this.name="WidgetDocumentNotLoaded",this.message=e||"The document widget is not loaded, wait for the documentloaded event"};(n.prototype=Object.create(Error.prototype)).constructor=n,e.widget("dcp.document",{_template:t.template('<iframe class="dcpDocumentWrapper" name="<%- options.iframeName %>" style="border : 0;" data-src="api/v1/documents/0.html#widgetValue<%- options.json_encode %>"></iframe>'),defaults:{resizeMarginHeight:3,resizeMarginWidth:0,resizeDebounceTime:50,withoutResize:!1,iframeName:t.uniqueId("documentFrame"),noRouter:!0,eventPrefix:"document"},_create:function(){this.options=t.extend({},this.defaults,this.options),this.options.eventListener={},this.options.constraintList={},this.options.cssToInject=[],this.options.jsToInject=[],this._render(),this._bindEvents()},_render:function(){var i,n,o,r=this;o=JSON.stringify(t.omit(this.options,"resizeMarginHeight","resizeMarginWidth","resizeDebounceTime","withoutResize","iframeName","eventPrefix","eventListener","constraintList")),this.element.empty().append(this._template({options:{iframeName:this.options.iframeName,json_encode:o}})),(i=this.element.find(".dcpDocumentWrapper")).length>0&&((n=i[0].contentWindow).location.href=i.data("src"),i.on("load",function(){n.documentLoaded=function(e,t){r._bindInternalWidget.call(r,e.data("dcpDocumentController"),t),r.element.data("voidLoaded",!t||!t.initid)},e(n).on("unload",function(){r._unbindInternalWidget.call(r)}),n.dcp&&n.dcp.triggerReload&&!1===n.dcp.documentReady&&n.dcp.triggerReload()})),this._resize()},_unbindInternalWidget:function(){this.element.data("internalWidgetInitialised",!1),this.element.data("internalWidget",!1),this._trigger("internalWidgetUnloaded"),this._trigger("unloaded")},rebindEvents:function(){var e=this.element.data("internalWidget");e&&(t.each(this.options.eventListener,function(t){e.addEventListener(t)}),t.each(this.options.constraintList,function(t){e.addConstraint(t)}))},reinjectCSSAndJS:function(){var e=this.element.data("internalWidget");if(e)try{e.injectCSS(this.options.cssToInject),e.injectJS(this.options.jsToInject)}catch(e){}},_bindInternalWidget:function(e,t){return this.element.data("internalWidget",e),t||(this.rebindEvents(),this.reinjectCSSAndJS()),this.element.data("internalWidgetInitialised",!0),t?(this._trigger("loaded",{},{isEmpty:!0}),this):(this._trigger("loaded"),this)},_bindEvents:function(){this.options.withoutResize||(e(window).on("resize"+this.eventNamespace,t.debounce(t.bind(this._resize,this),parseInt(this.options.resizeDebounceTime,10))),this._resize())},_resize:function(){var e=this._trigger("autoresize"),i=this.element.find(".dcpDocumentWrapper"),n=this,o=this.element;!this.options.withoutResize&&e&&(i.height(o.innerHeight()-parseInt(n.options.resizeMarginHeight,10)),i.width(o.innerWidth()-parseInt(n.options.resizeMarginWidth,10)),t.defer(function(){i.height(o.innerHeight()-parseInt(n.options.resizeMarginHeight,10))}))},tryToDestroy:function(){var e=this;return new Promise(function(t,i){e.isLoaded()?e.element.data("internalWidget").tryToDestroy().then(function(){t(),e._destroy()}).catch(function(e){i(e)}):(t(),e._destroy())})},_destroy:function(){e(window).off(this.eventNamespace),this.element.empty(),this._unbindInternalWidget(),this._trigger("destroy"),this._super()},_checkEventName:function(e){if(t.isString(e)&&(0===e.indexOf("custom:")||t.find(i,function(t){return t===e})))return!0;throw new Error("The event type "+e+" is not known. It must be one of "+i.join(" ,"))},options:function(){throw new Error("You cannot modify the options, you need to suppress the widget")},fetchDocument:function(e,i){var n,o=this,r=null,a=function(){o.rebindEvents.call(o),o.element.data("voidLoaded",!1)};if(i=i||{},!e.initid)throw new Error("You need to set the initid to fetch the document");if(t.each(t.pick(e,"initid","revision","viewId","customClientData"),function(e,t){o.options[t]=e}),this.element.data("internalWidgetInitialised"))return n=this.element.data("internalWidget"),i.success&&(i.success=t.wrap(i.success,function(e){return a.apply(this,t.rest(arguments)),e.apply(this,t.rest(arguments))})),i.error&&(i.error=t.wrap(i.error,function(e){return a.apply(this,t.rest(arguments)),e.apply(this,t.rest(arguments))})),r=n.fetchDocument.call(n,e,i),i.success||r.then(a),i.error||r.catch(a),r;this._render()},addEventListener:function(e,i,n){var o,r=this;if(t.isUndefined(n)&&t.isFunction(i)&&(n=i,i={}),t.isObject(e)&&t.isUndefined(i)&&t.isUndefined(n)){if(!(o=e).name)throw new Error("When an event is initiated with a single object, this object needs to have the name property ".JSON.stringify(o))}else o=t.defaults(i,{name:t.uniqueId("event_"+e),eventType:e,eventCallback:n,externalEvent:!0,once:!1});return this._checkEventName(o.eventType),!0===o.once&&(o.eventCallback=t.wrap(o.eventCallback,function(e){try{e.apply(this,t.rest(arguments))}catch(e){console.error(e)}r.removeEventListener(o.name)})),o.once=!1,this.options.eventListener[o.name]=o,this.element.data("internalWidgetInitialised")&&!this.element.data("voidLoaded")&&this.element.data("internalWidget").addEventListener(o),o.name},listEventListeners:function(){return this.element.data("internalWidgetInitialised")&&!this.element.data("voidLoaded")?this.element.data("internalWidget").listEventListeners():this.options.eventListener},removeEventListener:function(e){var i,n,o=[],r=new RegExp("\\"+e+"$");return i=t.filter(this.options.eventListener,function(t){return t.name!==e&&!r.test(t.name)||(o.push(t),!1)}),n={},t.each(i,function(e){n[e.name]=e}),this.options.eventListener=n,this.element.data("internalWidgetInitialised")&&!this.element.data("voidLoaded")&&this.element.data("internalWidget").removeEventListener(e,!0),o},addConstraint:function(e,i){var n,o=this;if(t.isUndefined(i)&&t.isFunction(e)&&(i=e,e={}),t.isObject(e)&&t.isUndefined(i)){if(!e.name)throw new Error("When a constraint is initiated with a single object, this object needs to have the name property ".JSON.stringify(e))}else n=t.defaults(e,{documentCheck:function(){return!0},attributeCheck:function(){return!0},constraintCheck:i,name:t.uniqueId("constraint"),externalConstraint:!1,once:!1});if(!t.isFunction(n.constraintCheck))throw new Error("An event need a callback");return!0===n.once&&(n.eventCallback=t.wrap(n.constraintCheck,function(e){try{e.apply(this,t.rest(arguments))}catch(e){console.error(e)}o.removeConstraint(n.name,n.externalConstraint)})),this.options.constraintList[n.name]=n,this.element.data("internalWidgetInitialised")&&!this.element.data("voidLoaded")&&this.element.data("internalWidget").addConstraint(n),n.name},listConstraints:function(){return this.element.data("internalWidgetInitialised")&&!this.element.data("voidLoaded")?this.element.data("internalWidget").listConstraints():this.options.constraintList},removeConstraint:function(e){var i,n,o=[],r=new RegExp("\\"+e+"$");return i=t.filter(this.options.constraintList,function(t){return t.name!==e&&!r.test(t.name)||(o.push(t),!1)}),n={},t.each(i,function(e){n[e.name]=e}),this.options.constraintList=n,this.element.data("internalWidgetInitialised")&&!this.element.data("voidLoaded")&&this.element.data("internalWidget").removeConstraint(e,!0),o},isLoaded:function(){return this.element.data("internalWidgetInitialised")&&!this.element.data("voidLoaded")},injectCSS:function(e){if(!t.isArray(e)&&!t.isString(e))throw new Error("The css to inject must be an array string or a string");t.isString(e)&&(e=[e]),this.options.cssToInject=t.union(this.options.cssToInject,e),this.element.data("internalWidgetInitialised")&&!this.element.data("voidLoaded")&&this.element.data("internalWidget").injectCSS(e)},injectJS:function(e){if(!t.isArray(e)&&!t.isString(e))throw new Error("The js to inject must be an array string or a string");t.isString(e)&&(e=[e]),this.options.jsToInject=t.union(this.options.jsToInject,e),this.element.data("internalWidgetInitialised")&&!this.element.data("voidLoaded")&&this.element.data("internalWidget").injectJS(e)}}),e.fn.document=t.wrap(e.fn.document,function(e,i){var o;try{return e.apply(this,t.rest(arguments))}catch(e){if("noSuchMethodError"===e.name){if("string"==typeof i&&!this.data("internalWidgetInitialised"))throw new n;if(o=this.data("internalWidget"),t.isFunction(o[i])&&"_"!==i.charAt(0))return o[i].apply(o,t.rest(arguments,2))}throw e}})})},eeea49593fdad50c9212:function(e,t,i){"use strict";var n,o;n=[i("8e08e542008e4aef1f58"),i('external "jQuery"'),i("bcd31d01884fc294fd69"),i("278ba7757aa1904087c6"),i("593c8c94ba4399020f79"),i("a2b1083ba5d095ec0632")],void 0===(o=function(e,t,i,n,o){t.widget("dcp.dcpCreateDocument",{options:{title:"Document",width:"300px",height:"400px",attributeId:null,originDocumentModel:null,index:-1},_create:function(){this.element.data("dcpCreateDocument",this)},open:function(){var n=this,o=this.options,r=o.index;if(o.createLabel){var a,s,d=o.originDocumentModel.get("attributes").get(o.attributeId);a=r>=0?d.getValue()[r]:d.getValue(),this.$dialog=t('<div class="dcpDocid-create-window"/>'),t("body").append(this.$dialog);var c=i.render(o.windowTitle||"",a),l=this.$dialog.dcpWindow({title:c,width:o.windowWidth,height:o.windowHeight,content:"about:blank",iframe:!0,close:function(e){n.closeDialog(e,!0)}}).data("dcpWindow");l.kendoWindow().center(),l.open(),(s=l.currentWidget).on("documentcreate",function(){l.currentWidget.find("> iframe").addClass("k-content-frame")}),a.value?s.document({initid:a.value,viewId:"!defaultEdition",withoutResize:!0}):s.document({initid:o.familyName||d.get("typeFormat"),viewId:"!defaultCreation",withoutResize:!0}),s.on("documentloaded",function(){t(this).document("addEventListener","ready",{name:"ddui:create:ready"},function(e,t){var r,a=this;n.$document=this,n.proxyTrigger(e,"ready",{})||("!defaultCreation"===t.viewId&&(n.proxyTrigger(e,"beforeSetFormValues",{getFormValues:function(){return o.formValues},setFormValues:function(e){n.setFormValue(e,a)}})||n.setFormValue(o.formValues,this)),(r=this.documentController("getMenu","createAndClose"))&&r.hide(),(r=this.documentController("getMenu","saveAndClose"))&&r.hide(),(r=this.documentController("getMenu","create"))&&r.setLabel(i.render(o.createLabel,d.attributes)),(r=this.documentController("getMenu","save"))&&r.setLabel(i.render(o.updateLabel,d.attributes)))}),t(this).document("addEventListener","actionClick",{name:"ddui:create:close"},function(e,t,i){"document.close"===i.eventId&&(e.preventDefault(),n.closeDialog(e,!0))}),t(this).document("addEventListener","afterSave",{name:"ddui:create:record"},function(t,i){var o,a={value:i.initid,displayValue:i.title,familyRelation:i.family.name,icon:i.icon};n.proxyTrigger(t,"beforeSetTargetValue",{attributeValue:a})||(d.hasMultipleOption()?(o=d.getValue(),r>=0&&(o=o[r]),e.isArray(o)?(o=e.clone(o)).push(a):o=[a]):o=a,d.setValue(o,r),n.proxyTrigger(t,"beforeClose",{attributeValue:o})||l.close())})})}},setFormValue:function(t,n){var r=this.options.originDocumentModel,a=o.getTemplateModelInfo(r);e.each(t,function(t,o){var s;if(e.isObject(t))n.documentController("setValue",o,t);else{var d=new RegExp("^{{attributes.(.+).attributeValue}}$").exec(t);d&&r.get("attributes").get(d[1])?(s=r.get("attributes").get(d[1]).getValue(),n.documentController("setValue",o,s)):(s=i.render(t,a),n.documentController("setValue",o,{value:s,displayValue:s}))}})},proxyTrigger:function(e,t,i){var n,o;return this.options[t]?(n=this.options[t],o=[e,i]):this.options.listener&&(n=this.options.listener,o=[e,t,i]),!!n&&(i.index=this.options.index,i.dialogWindow=this.$dialog,n.apply(this.$document,o),!0===e.prevent)},confirmClose:function(){var e=this.$document.documentController("getProperties");return new Promise(function(o,r){t("body").dcpConfirm({title:i.render(n.___('Confirm close form "{{title}}"',"ddui"),e),width:"510px",height:"150px",maxWidth:t(window).width(),messages:{okMessage:n.___("Abord modification","ddui"),cancelMessage:n.___("Stay on the form","ddui"),htmlMessage:n.___("The form has been modified without saving","ddui"),textMessage:""},confirm:o,cancel:r}).data("dcpWindow").open()})},closeDialog:function(e,t){var i=this,n=!1,o=this.$dialog.data("dcpWindow");if(this.$document){var r=this.$document.documentController("getProperties");!(n=this.proxyTrigger(e,"beforeClose",{}))&&t&&r&&r.isModified&&(console.log("modified",r),i.confirmClose().then(function(){i.closeDialog(e,!1)}),n=!0)}n?e.preventDefault():(n=i.proxyTrigger(e,"beforeDestroy",{}))||o.destroy()}})}.apply(t,n))||(e.exports=o)}});
//# sourceMappingURL=wCreateDocument-437b2dcf17ae14632ec8.js.map