<?xml version="1.0" encoding="UTF-8"?>
<smart:config xmlns:smart="http://www.anakeen.com/ns/smart/1.0">
    <smart:structure-configuration name="DIR" id="2" label="Dossier" extends="BASE">
        <smart:icon file="se-dir.png"/>
        <smart:class disable-inheritance-condition="true">Anakeen\SmartStructures\Dir\DirHooks</smart:class>
        <smart:usefor>F</smart:usefor>

        <smart:fields>
            <smart:field-set name="fr_basic" extended="true">
                <smart:field-longtext name="ba_desc" label="Description" visibility="W" is-abstract="true"/>
                <smart:field-color name="gui_color" label="Couleur intercalaire" visibility="O"/>
                <smart:field-enum name="gui_isrss" label="Utilisable comme flux RSS" visibility="W" relation="dir-gui_isrss"/>
                <smart:field-enum name="gui_sysrss" label="Flux RSS système" visibility="R" relation="dir-gui_sysrss"/>
            </smart:field-set>
            <smart:field-set name="fld_fr_rest" type="frame" label="Restrictions" visibility="R">
                <smart:field-enum name="fld_allbut" label="Tout ou rien" visibility="W" relation="dir-fld_allbut"/>
                <smart:field-set name="fld_tfam" type="array" label="Smart structure autorisées" visibility="W">
                    <smart:field-text name="fld_fam" label="Smart structure (titre)" visibility="H"/>
                    <smart:field-docid name="fld_famids" label="Smart structure" visibility="W" relation="-1"/>
                    <smart:field-enum name="fld_subfam" label="Restriction sous Smart structure" visibility="W" relation="dir-fld_subfam"/>
                </smart:field-set>
            </smart:field-set>
            <smart:field-set name="fld_fr_prof" type="frame" label="Profils par défaut" visibility="R">
                <smart:field-text name="fld_pdoc" label="Profil par défaut de document (titre)" visibility="H"/>
                <smart:field-docid name="fld_pdocid" label="Profil par défaut de document" visibility="W" relation="PDOC"/>
                <smart:field-text name="fld_pdir" label="Profil par défaut de dossier (titre)" visibility="H"/>
                <smart:field-docid name="fld_pdirid" label="Profil par défaut de dossier" visibility="W" relation="PDIR"/>
            </smart:field-set>
        </smart:fields>

        <smart:hooks>
            <smart:field-hook event="onPreRefresh" attr="fld_fam">
                <smart:field-callable function="::getTitle"/>
                <smart:field-argument type="attribute">fld_famids</smart:field-argument>
            </smart:field-hook>
            <smart:field-hook event="onPreRefresh" attr="fld_pdoc">
                <smart:field-callable function="::getTitle"/>
                <smart:field-argument type="attribute">fld_pdocid</smart:field-argument>
            </smart:field-hook>
            <smart:field-hook event="onPreRefresh" attr="fld_pdir">
                <smart:field-callable function="::getTitle"/>
                <smart:field-argument type="attribute">fld_pdirid</smart:field-argument>
                <smart:field-return attr="fld_pdir"/>
            </smart:field-hook>
        </smart:hooks>

    </smart:structure-configuration>

    <smart:enumerates>
        <smart:enum-configuration name="dir-fld_allbut">
            <smart:enum name="0" label="tout sauf"/>
            <smart:enum name="1" label="seulement"/>
        </smart:enum-configuration>
        <smart:enum-configuration name="dir-fld_subfam">
            <smart:enum name="yes" label="inclure les sous familles"/>
            <smart:enum name="no" label="ne pas inclure les sous familles"/>
        </smart:enum-configuration>
        <smart:enum-configuration name="dir-gui_isrss">
            <smart:enum name="no" label="non"/>
            <smart:enum name="yes" label="oui"/>
        </smart:enum-configuration>
    </smart:enumerates>
</smart:config>
