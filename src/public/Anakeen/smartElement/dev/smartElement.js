/******/ (function(modules) { // webpackBootstrap
/******/ 	// install a JSONP callback for chunk loading
/******/ 	function webpackJsonpCallback(data) {
/******/ 		var chunkIds = data[0];
/******/ 		var moreModules = data[1];
/******/
/******/
/******/ 		// add "moreModules" to the modules object,
/******/ 		// then flag all "chunkIds" as loaded and fire callback
/******/ 		var moduleId, chunkId, i = 0, resolves = [];
/******/ 		for(;i < chunkIds.length; i++) {
/******/ 			chunkId = chunkIds[i];
/******/ 			if(installedChunks[chunkId]) {
/******/ 				resolves.push(installedChunks[chunkId][0]);
/******/ 			}
/******/ 			installedChunks[chunkId] = 0;
/******/ 		}
/******/ 		for(moduleId in moreModules) {
/******/ 			if(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {
/******/ 				modules[moduleId] = moreModules[moduleId];
/******/ 			}
/******/ 		}
/******/ 		if(parentJsonpFunction) parentJsonpFunction(data);
/******/
/******/ 		while(resolves.length) {
/******/ 			resolves.shift()();
/******/ 		}
/******/
/******/ 	};
/******/
/******/
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// object to store loaded and loading chunks
/******/ 	// undefined = chunk not loaded, null = chunk preloaded/prefetched
/******/ 	// Promise = chunk loading, 0 = chunk loaded
/******/ 	var installedChunks = {
/******/ 		"smartElement": 0
/******/ 	};
/******/
/******/
/******/
/******/ 	// script path function
/******/ 	function jsonpScriptSrc(chunkId) {
/******/ 		return __webpack_require__.p + "" + ({"vendors~documentCkEditor":"vendors~documentCkEditor","documentCkEditor":"documentCkEditor","vendors~ensureDatatables":"vendors~ensureDatatables","wDocument":"wDocument","wCreateDocument":"wCreateDocument"}[chunkId]||chunkId) + ".js"
/******/ 	}
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/ 	// This file contains only the entry chunk.
/******/ 	// The chunk loading function for additional chunks
/******/ 	__webpack_require__.e = function requireEnsure(chunkId) {
/******/ 		var promises = [];
/******/
/******/
/******/ 		// JSONP chunk loading for javascript
/******/
/******/ 		var installedChunkData = installedChunks[chunkId];
/******/ 		if(installedChunkData !== 0) { // 0 means "already installed".
/******/
/******/ 			// a Promise means "currently loading".
/******/ 			if(installedChunkData) {
/******/ 				promises.push(installedChunkData[2]);
/******/ 			} else {
/******/ 				// setup Promise in chunk cache
/******/ 				var promise = new Promise(function(resolve, reject) {
/******/ 					installedChunkData = installedChunks[chunkId] = [resolve, reject];
/******/ 				});
/******/ 				promises.push(installedChunkData[2] = promise);
/******/
/******/ 				// start chunk loading
/******/ 				var head = document.getElementsByTagName('head')[0];
/******/ 				var script = document.createElement('script');
/******/ 				var onScriptComplete;
/******/
/******/ 				script.charset = 'utf-8';
/******/ 				script.timeout = 120;
/******/ 				if (__webpack_require__.nc) {
/******/ 					script.setAttribute("nonce", __webpack_require__.nc);
/******/ 				}
/******/ 				script.src = jsonpScriptSrc(chunkId);
/******/
/******/ 				onScriptComplete = function (event) {
/******/ 					// avoid mem leaks in IE.
/******/ 					script.onerror = script.onload = null;
/******/ 					clearTimeout(timeout);
/******/ 					var chunk = installedChunks[chunkId];
/******/ 					if(chunk !== 0) {
/******/ 						if(chunk) {
/******/ 							var errorType = event && (event.type === 'load' ? 'missing' : event.type);
/******/ 							var realSrc = event && event.target && event.target.src;
/******/ 							var error = new Error('Loading chunk ' + chunkId + ' failed.\n(' + errorType + ': ' + realSrc + ')');
/******/ 							error.type = errorType;
/******/ 							error.request = realSrc;
/******/ 							chunk[1](error);
/******/ 						}
/******/ 						installedChunks[chunkId] = undefined;
/******/ 					}
/******/ 				};
/******/ 				var timeout = setTimeout(function(){
/******/ 					onScriptComplete({ type: 'timeout', target: script });
/******/ 				}, 120000);
/******/ 				script.onerror = script.onload = onScriptComplete;
/******/ 				head.appendChild(script);
/******/ 			}
/******/ 		}
/******/ 		return Promise.all(promises);
/******/ 	};
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, { enumerable: true, get: getter });
/******/ 		}
/******/ 	};
/******/
/******/ 	// define __esModule on exports
/******/ 	__webpack_require__.r = function(exports) {
/******/ 		if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 			Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 		}
/******/ 		Object.defineProperty(exports, '__esModule', { value: true });
/******/ 	};
/******/
/******/ 	// create a fake namespace object
/******/ 	// mode & 1: value is a module id, require it
/******/ 	// mode & 2: merge all properties of value into the ns
/******/ 	// mode & 4: return value when already ns object
/******/ 	// mode & 8|1: behave like require
/******/ 	__webpack_require__.t = function(value, mode) {
/******/ 		if(mode & 1) value = __webpack_require__(value);
/******/ 		if(mode & 8) return value;
/******/ 		if((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;
/******/ 		var ns = Object.create(null);
/******/ 		__webpack_require__.r(ns);
/******/ 		Object.defineProperty(ns, 'default', { enumerable: true, value: value });
/******/ 		if(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));
/******/ 		return ns;
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "/Anakeen/smartElement/dev/";
/******/
/******/ 	// on error function for async loading
/******/ 	__webpack_require__.oe = function(err) { console.error(err); throw err; };
/******/
/******/ 	var jsonpArray = window["webpackJsonp"] = window["webpackJsonp"] || [];
/******/ 	var oldJsonpFunction = jsonpArray.push.bind(jsonpArray);
/******/ 	jsonpArray.push = webpackJsonpCallback;
/******/ 	jsonpArray = jsonpArray.slice();
/******/ 	for(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);
/******/ 	var parentJsonpFunction = oldJsonpFunction;
/******/
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = 0);
/******/ })
/************************************************************************/
/******/ ({

/***/ 0:
/*!*****************************************************!*\
  !*** multi ./src/Apps/DOCUMENT/IHM/mainDocument.js ***!
  \*****************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

module.exports = __webpack_require__(/*! /home/charles/git/user-interfaces/src/Apps/DOCUMENT/IHM/mainDocument.js */"97640554fbb3ff20724f");


/***/ }),

/***/ "05951c2f2bda4691bed3":
/*!***************************************************!*\
  !*** ./node_modules/popper.js/dist/esm/popper.js ***!
  \***************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* WEBPACK VAR INJECTION */(function(global) {/**!\n * @fileOverview Kickass library to create and place poppers near their reference elements.\n * @version 1.14.6\n * @license\n * Copyright (c) 2016 Federico Zivolo and contributors\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\nvar isBrowser = typeof window !== 'undefined' && typeof document !== 'undefined';\n\nvar longerTimeoutBrowsers = ['Edge', 'Trident', 'Firefox'];\nvar timeoutDuration = 0;\nfor (var i = 0; i < longerTimeoutBrowsers.length; i += 1) {\n  if (isBrowser && navigator.userAgent.indexOf(longerTimeoutBrowsers[i]) >= 0) {\n    timeoutDuration = 1;\n    break;\n  }\n}\n\nfunction microtaskDebounce(fn) {\n  var called = false;\n  return function () {\n    if (called) {\n      return;\n    }\n    called = true;\n    window.Promise.resolve().then(function () {\n      called = false;\n      fn();\n    });\n  };\n}\n\nfunction taskDebounce(fn) {\n  var scheduled = false;\n  return function () {\n    if (!scheduled) {\n      scheduled = true;\n      setTimeout(function () {\n        scheduled = false;\n        fn();\n      }, timeoutDuration);\n    }\n  };\n}\n\nvar supportsMicroTasks = isBrowser && window.Promise;\n\n/**\n* Create a debounced version of a method, that's asynchronously deferred\n* but called in the minimum time possible.\n*\n* @method\n* @memberof Popper.Utils\n* @argument {Function} fn\n* @returns {Function}\n*/\nvar debounce = supportsMicroTasks ? microtaskDebounce : taskDebounce;\n\n/**\n * Check if the given variable is a function\n * @method\n * @memberof Popper.Utils\n * @argument {Any} functionToCheck - variable to check\n * @returns {Boolean} answer to: is a function?\n */\nfunction isFunction(functionToCheck) {\n  var getType = {};\n  return functionToCheck && getType.toString.call(functionToCheck) === '[object Function]';\n}\n\n/**\n * Get CSS computed property of the given element\n * @method\n * @memberof Popper.Utils\n * @argument {Eement} element\n * @argument {String} property\n */\nfunction getStyleComputedProperty(element, property) {\n  if (element.nodeType !== 1) {\n    return [];\n  }\n  // NOTE: 1 DOM access here\n  var window = element.ownerDocument.defaultView;\n  var css = window.getComputedStyle(element, null);\n  return property ? css[property] : css;\n}\n\n/**\n * Returns the parentNode or the host of the element\n * @method\n * @memberof Popper.Utils\n * @argument {Element} element\n * @returns {Element} parent\n */\nfunction getParentNode(element) {\n  if (element.nodeName === 'HTML') {\n    return element;\n  }\n  return element.parentNode || element.host;\n}\n\n/**\n * Returns the scrolling parent of the given element\n * @method\n * @memberof Popper.Utils\n * @argument {Element} element\n * @returns {Element} scroll parent\n */\nfunction getScrollParent(element) {\n  // Return body, `getScroll` will take care to get the correct `scrollTop` from it\n  if (!element) {\n    return document.body;\n  }\n\n  switch (element.nodeName) {\n    case 'HTML':\n    case 'BODY':\n      return element.ownerDocument.body;\n    case '#document':\n      return element.body;\n  }\n\n  // Firefox want us to check `-x` and `-y` variations as well\n\n  var _getStyleComputedProp = getStyleComputedProperty(element),\n      overflow = _getStyleComputedProp.overflow,\n      overflowX = _getStyleComputedProp.overflowX,\n      overflowY = _getStyleComputedProp.overflowY;\n\n  if (/(auto|scroll|overlay)/.test(overflow + overflowY + overflowX)) {\n    return element;\n  }\n\n  return getScrollParent(getParentNode(element));\n}\n\nvar isIE11 = isBrowser && !!(window.MSInputMethodContext && document.documentMode);\nvar isIE10 = isBrowser && /MSIE 10/.test(navigator.userAgent);\n\n/**\n * Determines if the browser is Internet Explorer\n * @method\n * @memberof Popper.Utils\n * @param {Number} version to check\n * @returns {Boolean} isIE\n */\nfunction isIE(version) {\n  if (version === 11) {\n    return isIE11;\n  }\n  if (version === 10) {\n    return isIE10;\n  }\n  return isIE11 || isIE10;\n}\n\n/**\n * Returns the offset parent of the given element\n * @method\n * @memberof Popper.Utils\n * @argument {Element} element\n * @returns {Element} offset parent\n */\nfunction getOffsetParent(element) {\n  if (!element) {\n    return document.documentElement;\n  }\n\n  var noOffsetParent = isIE(10) ? document.body : null;\n\n  // NOTE: 1 DOM access here\n  var offsetParent = element.offsetParent || null;\n  // Skip hidden elements which don't have an offsetParent\n  while (offsetParent === noOffsetParent && element.nextElementSibling) {\n    offsetParent = (element = element.nextElementSibling).offsetParent;\n  }\n\n  var nodeName = offsetParent && offsetParent.nodeName;\n\n  if (!nodeName || nodeName === 'BODY' || nodeName === 'HTML') {\n    return element ? element.ownerDocument.documentElement : document.documentElement;\n  }\n\n  // .offsetParent will return the closest TH, TD or TABLE in case\n  // no offsetParent is present, I hate this job...\n  if (['TH', 'TD', 'TABLE'].indexOf(offsetParent.nodeName) !== -1 && getStyleComputedProperty(offsetParent, 'position') === 'static') {\n    return getOffsetParent(offsetParent);\n  }\n\n  return offsetParent;\n}\n\nfunction isOffsetContainer(element) {\n  var nodeName = element.nodeName;\n\n  if (nodeName === 'BODY') {\n    return false;\n  }\n  return nodeName === 'HTML' || getOffsetParent(element.firstElementChild) === element;\n}\n\n/**\n * Finds the root node (document, shadowDOM root) of the given element\n * @method\n * @memberof Popper.Utils\n * @argument {Element} node\n * @returns {Element} root node\n */\nfunction getRoot(node) {\n  if (node.parentNode !== null) {\n    return getRoot(node.parentNode);\n  }\n\n  return node;\n}\n\n/**\n * Finds the offset parent common to the two provided nodes\n * @method\n * @memberof Popper.Utils\n * @argument {Element} element1\n * @argument {Element} element2\n * @returns {Element} common offset parent\n */\nfunction findCommonOffsetParent(element1, element2) {\n  // This check is needed to avoid errors in case one of the elements isn't defined for any reason\n  if (!element1 || !element1.nodeType || !element2 || !element2.nodeType) {\n    return document.documentElement;\n  }\n\n  // Here we make sure to give as \"start\" the element that comes first in the DOM\n  var order = element1.compareDocumentPosition(element2) & Node.DOCUMENT_POSITION_FOLLOWING;\n  var start = order ? element1 : element2;\n  var end = order ? element2 : element1;\n\n  // Get common ancestor container\n  var range = document.createRange();\n  range.setStart(start, 0);\n  range.setEnd(end, 0);\n  var commonAncestorContainer = range.commonAncestorContainer;\n\n  // Both nodes are inside #document\n\n  if (element1 !== commonAncestorContainer && element2 !== commonAncestorContainer || start.contains(end)) {\n    if (isOffsetContainer(commonAncestorContainer)) {\n      return commonAncestorContainer;\n    }\n\n    return getOffsetParent(commonAncestorContainer);\n  }\n\n  // one of the nodes is inside shadowDOM, find which one\n  var element1root = getRoot(element1);\n  if (element1root.host) {\n    return findCommonOffsetParent(element1root.host, element2);\n  } else {\n    return findCommonOffsetParent(element1, getRoot(element2).host);\n  }\n}\n\n/**\n * Gets the scroll value of the given element in the given side (top and left)\n * @method\n * @memberof Popper.Utils\n * @argument {Element} element\n * @argument {String} side `top` or `left`\n * @returns {number} amount of scrolled pixels\n */\nfunction getScroll(element) {\n  var side = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'top';\n\n  var upperSide = side === 'top' ? 'scrollTop' : 'scrollLeft';\n  var nodeName = element.nodeName;\n\n  if (nodeName === 'BODY' || nodeName === 'HTML') {\n    var html = element.ownerDocument.documentElement;\n    var scrollingElement = element.ownerDocument.scrollingElement || html;\n    return scrollingElement[upperSide];\n  }\n\n  return element[upperSide];\n}\n\n/*\n * Sum or subtract the element scroll values (left and top) from a given rect object\n * @method\n * @memberof Popper.Utils\n * @param {Object} rect - Rect object you want to change\n * @param {HTMLElement} element - The element from the function reads the scroll values\n * @param {Boolean} subtract - set to true if you want to subtract the scroll values\n * @return {Object} rect - The modifier rect object\n */\nfunction includeScroll(rect, element) {\n  var subtract = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n\n  var scrollTop = getScroll(element, 'top');\n  var scrollLeft = getScroll(element, 'left');\n  var modifier = subtract ? -1 : 1;\n  rect.top += scrollTop * modifier;\n  rect.bottom += scrollTop * modifier;\n  rect.left += scrollLeft * modifier;\n  rect.right += scrollLeft * modifier;\n  return rect;\n}\n\n/*\n * Helper to detect borders of a given element\n * @method\n * @memberof Popper.Utils\n * @param {CSSStyleDeclaration} styles\n * Result of `getStyleComputedProperty` on the given element\n * @param {String} axis - `x` or `y`\n * @return {number} borders - The borders size of the given axis\n */\n\nfunction getBordersSize(styles, axis) {\n  var sideA = axis === 'x' ? 'Left' : 'Top';\n  var sideB = sideA === 'Left' ? 'Right' : 'Bottom';\n\n  return parseFloat(styles['border' + sideA + 'Width'], 10) + parseFloat(styles['border' + sideB + 'Width'], 10);\n}\n\nfunction getSize(axis, body, html, computedStyle) {\n  return Math.max(body['offset' + axis], body['scroll' + axis], html['client' + axis], html['offset' + axis], html['scroll' + axis], isIE(10) ? parseInt(html['offset' + axis]) + parseInt(computedStyle['margin' + (axis === 'Height' ? 'Top' : 'Left')]) + parseInt(computedStyle['margin' + (axis === 'Height' ? 'Bottom' : 'Right')]) : 0);\n}\n\nfunction getWindowSizes(document) {\n  var body = document.body;\n  var html = document.documentElement;\n  var computedStyle = isIE(10) && getComputedStyle(html);\n\n  return {\n    height: getSize('Height', body, html, computedStyle),\n    width: getSize('Width', body, html, computedStyle)\n  };\n}\n\nvar classCallCheck = function (instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n};\n\nvar createClass = function () {\n  function defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if (\"value\" in descriptor) descriptor.writable = true;\n      Object.defineProperty(target, descriptor.key, descriptor);\n    }\n  }\n\n  return function (Constructor, protoProps, staticProps) {\n    if (protoProps) defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) defineProperties(Constructor, staticProps);\n    return Constructor;\n  };\n}();\n\n\n\n\n\nvar defineProperty = function (obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n};\n\nvar _extends = Object.assign || function (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n\n    for (var key in source) {\n      if (Object.prototype.hasOwnProperty.call(source, key)) {\n        target[key] = source[key];\n      }\n    }\n  }\n\n  return target;\n};\n\n/**\n * Given element offsets, generate an output similar to getBoundingClientRect\n * @method\n * @memberof Popper.Utils\n * @argument {Object} offsets\n * @returns {Object} ClientRect like output\n */\nfunction getClientRect(offsets) {\n  return _extends({}, offsets, {\n    right: offsets.left + offsets.width,\n    bottom: offsets.top + offsets.height\n  });\n}\n\n/**\n * Get bounding client rect of given element\n * @method\n * @memberof Popper.Utils\n * @param {HTMLElement} element\n * @return {Object} client rect\n */\nfunction getBoundingClientRect(element) {\n  var rect = {};\n\n  // IE10 10 FIX: Please, don't ask, the element isn't\n  // considered in DOM in some circumstances...\n  // This isn't reproducible in IE10 compatibility mode of IE11\n  try {\n    if (isIE(10)) {\n      rect = element.getBoundingClientRect();\n      var scrollTop = getScroll(element, 'top');\n      var scrollLeft = getScroll(element, 'left');\n      rect.top += scrollTop;\n      rect.left += scrollLeft;\n      rect.bottom += scrollTop;\n      rect.right += scrollLeft;\n    } else {\n      rect = element.getBoundingClientRect();\n    }\n  } catch (e) {}\n\n  var result = {\n    left: rect.left,\n    top: rect.top,\n    width: rect.right - rect.left,\n    height: rect.bottom - rect.top\n  };\n\n  // subtract scrollbar size from sizes\n  var sizes = element.nodeName === 'HTML' ? getWindowSizes(element.ownerDocument) : {};\n  var width = sizes.width || element.clientWidth || result.right - result.left;\n  var height = sizes.height || element.clientHeight || result.bottom - result.top;\n\n  var horizScrollbar = element.offsetWidth - width;\n  var vertScrollbar = element.offsetHeight - height;\n\n  // if an hypothetical scrollbar is detected, we must be sure it's not a `border`\n  // we make this check conditional for performance reasons\n  if (horizScrollbar || vertScrollbar) {\n    var styles = getStyleComputedProperty(element);\n    horizScrollbar -= getBordersSize(styles, 'x');\n    vertScrollbar -= getBordersSize(styles, 'y');\n\n    result.width -= horizScrollbar;\n    result.height -= vertScrollbar;\n  }\n\n  return getClientRect(result);\n}\n\nfunction getOffsetRectRelativeToArbitraryNode(children, parent) {\n  var fixedPosition = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n\n  var isIE10 = isIE(10);\n  var isHTML = parent.nodeName === 'HTML';\n  var childrenRect = getBoundingClientRect(children);\n  var parentRect = getBoundingClientRect(parent);\n  var scrollParent = getScrollParent(children);\n\n  var styles = getStyleComputedProperty(parent);\n  var borderTopWidth = parseFloat(styles.borderTopWidth, 10);\n  var borderLeftWidth = parseFloat(styles.borderLeftWidth, 10);\n\n  // In cases where the parent is fixed, we must ignore negative scroll in offset calc\n  if (fixedPosition && isHTML) {\n    parentRect.top = Math.max(parentRect.top, 0);\n    parentRect.left = Math.max(parentRect.left, 0);\n  }\n  var offsets = getClientRect({\n    top: childrenRect.top - parentRect.top - borderTopWidth,\n    left: childrenRect.left - parentRect.left - borderLeftWidth,\n    width: childrenRect.width,\n    height: childrenRect.height\n  });\n  offsets.marginTop = 0;\n  offsets.marginLeft = 0;\n\n  // Subtract margins of documentElement in case it's being used as parent\n  // we do this only on HTML because it's the only element that behaves\n  // differently when margins are applied to it. The margins are included in\n  // the box of the documentElement, in the other cases not.\n  if (!isIE10 && isHTML) {\n    var marginTop = parseFloat(styles.marginTop, 10);\n    var marginLeft = parseFloat(styles.marginLeft, 10);\n\n    offsets.top -= borderTopWidth - marginTop;\n    offsets.bottom -= borderTopWidth - marginTop;\n    offsets.left -= borderLeftWidth - marginLeft;\n    offsets.right -= borderLeftWidth - marginLeft;\n\n    // Attach marginTop and marginLeft because in some circumstances we may need them\n    offsets.marginTop = marginTop;\n    offsets.marginLeft = marginLeft;\n  }\n\n  if (isIE10 && !fixedPosition ? parent.contains(scrollParent) : parent === scrollParent && scrollParent.nodeName !== 'BODY') {\n    offsets = includeScroll(offsets, parent);\n  }\n\n  return offsets;\n}\n\nfunction getViewportOffsetRectRelativeToArtbitraryNode(element) {\n  var excludeScroll = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n\n  var html = element.ownerDocument.documentElement;\n  var relativeOffset = getOffsetRectRelativeToArbitraryNode(element, html);\n  var width = Math.max(html.clientWidth, window.innerWidth || 0);\n  var height = Math.max(html.clientHeight, window.innerHeight || 0);\n\n  var scrollTop = !excludeScroll ? getScroll(html) : 0;\n  var scrollLeft = !excludeScroll ? getScroll(html, 'left') : 0;\n\n  var offset = {\n    top: scrollTop - relativeOffset.top + relativeOffset.marginTop,\n    left: scrollLeft - relativeOffset.left + relativeOffset.marginLeft,\n    width: width,\n    height: height\n  };\n\n  return getClientRect(offset);\n}\n\n/**\n * Check if the given element is fixed or is inside a fixed parent\n * @method\n * @memberof Popper.Utils\n * @argument {Element} element\n * @argument {Element} customContainer\n * @returns {Boolean} answer to \"isFixed?\"\n */\nfunction isFixed(element) {\n  var nodeName = element.nodeName;\n  if (nodeName === 'BODY' || nodeName === 'HTML') {\n    return false;\n  }\n  if (getStyleComputedProperty(element, 'position') === 'fixed') {\n    return true;\n  }\n  return isFixed(getParentNode(element));\n}\n\n/**\n * Finds the first parent of an element that has a transformed property defined\n * @method\n * @memberof Popper.Utils\n * @argument {Element} element\n * @returns {Element} first transformed parent or documentElement\n */\n\nfunction getFixedPositionOffsetParent(element) {\n  // This check is needed to avoid errors in case one of the elements isn't defined for any reason\n  if (!element || !element.parentElement || isIE()) {\n    return document.documentElement;\n  }\n  var el = element.parentElement;\n  while (el && getStyleComputedProperty(el, 'transform') === 'none') {\n    el = el.parentElement;\n  }\n  return el || document.documentElement;\n}\n\n/**\n * Computed the boundaries limits and return them\n * @method\n * @memberof Popper.Utils\n * @param {HTMLElement} popper\n * @param {HTMLElement} reference\n * @param {number} padding\n * @param {HTMLElement} boundariesElement - Element used to define the boundaries\n * @param {Boolean} fixedPosition - Is in fixed position mode\n * @returns {Object} Coordinates of the boundaries\n */\nfunction getBoundaries(popper, reference, padding, boundariesElement) {\n  var fixedPosition = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : false;\n\n  // NOTE: 1 DOM access here\n\n  var boundaries = { top: 0, left: 0 };\n  var offsetParent = fixedPosition ? getFixedPositionOffsetParent(popper) : findCommonOffsetParent(popper, reference);\n\n  // Handle viewport case\n  if (boundariesElement === 'viewport') {\n    boundaries = getViewportOffsetRectRelativeToArtbitraryNode(offsetParent, fixedPosition);\n  } else {\n    // Handle other cases based on DOM element used as boundaries\n    var boundariesNode = void 0;\n    if (boundariesElement === 'scrollParent') {\n      boundariesNode = getScrollParent(getParentNode(reference));\n      if (boundariesNode.nodeName === 'BODY') {\n        boundariesNode = popper.ownerDocument.documentElement;\n      }\n    } else if (boundariesElement === 'window') {\n      boundariesNode = popper.ownerDocument.documentElement;\n    } else {\n      boundariesNode = boundariesElement;\n    }\n\n    var offsets = getOffsetRectRelativeToArbitraryNode(boundariesNode, offsetParent, fixedPosition);\n\n    // In case of HTML, we need a different computation\n    if (boundariesNode.nodeName === 'HTML' && !isFixed(offsetParent)) {\n      var _getWindowSizes = getWindowSizes(popper.ownerDocument),\n          height = _getWindowSizes.height,\n          width = _getWindowSizes.width;\n\n      boundaries.top += offsets.top - offsets.marginTop;\n      boundaries.bottom = height + offsets.top;\n      boundaries.left += offsets.left - offsets.marginLeft;\n      boundaries.right = width + offsets.left;\n    } else {\n      // for all the other DOM elements, this one is good\n      boundaries = offsets;\n    }\n  }\n\n  // Add paddings\n  padding = padding || 0;\n  var isPaddingNumber = typeof padding === 'number';\n  boundaries.left += isPaddingNumber ? padding : padding.left || 0;\n  boundaries.top += isPaddingNumber ? padding : padding.top || 0;\n  boundaries.right -= isPaddingNumber ? padding : padding.right || 0;\n  boundaries.bottom -= isPaddingNumber ? padding : padding.bottom || 0;\n\n  return boundaries;\n}\n\nfunction getArea(_ref) {\n  var width = _ref.width,\n      height = _ref.height;\n\n  return width * height;\n}\n\n/**\n * Utility used to transform the `auto` placement to the placement with more\n * available space.\n * @method\n * @memberof Popper.Utils\n * @argument {Object} data - The data object generated by update method\n * @argument {Object} options - Modifiers configuration and options\n * @returns {Object} The data object, properly modified\n */\nfunction computeAutoPlacement(placement, refRect, popper, reference, boundariesElement) {\n  var padding = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : 0;\n\n  if (placement.indexOf('auto') === -1) {\n    return placement;\n  }\n\n  var boundaries = getBoundaries(popper, reference, padding, boundariesElement);\n\n  var rects = {\n    top: {\n      width: boundaries.width,\n      height: refRect.top - boundaries.top\n    },\n    right: {\n      width: boundaries.right - refRect.right,\n      height: boundaries.height\n    },\n    bottom: {\n      width: boundaries.width,\n      height: boundaries.bottom - refRect.bottom\n    },\n    left: {\n      width: refRect.left - boundaries.left,\n      height: boundaries.height\n    }\n  };\n\n  var sortedAreas = Object.keys(rects).map(function (key) {\n    return _extends({\n      key: key\n    }, rects[key], {\n      area: getArea(rects[key])\n    });\n  }).sort(function (a, b) {\n    return b.area - a.area;\n  });\n\n  var filteredAreas = sortedAreas.filter(function (_ref2) {\n    var width = _ref2.width,\n        height = _ref2.height;\n    return width >= popper.clientWidth && height >= popper.clientHeight;\n  });\n\n  var computedPlacement = filteredAreas.length > 0 ? filteredAreas[0].key : sortedAreas[0].key;\n\n  var variation = placement.split('-')[1];\n\n  return computedPlacement + (variation ? '-' + variation : '');\n}\n\n/**\n * Get offsets to the reference element\n * @method\n * @memberof Popper.Utils\n * @param {Object} state\n * @param {Element} popper - the popper element\n * @param {Element} reference - the reference element (the popper will be relative to this)\n * @param {Element} fixedPosition - is in fixed position mode\n * @returns {Object} An object containing the offsets which will be applied to the popper\n */\nfunction getReferenceOffsets(state, popper, reference) {\n  var fixedPosition = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;\n\n  var commonOffsetParent = fixedPosition ? getFixedPositionOffsetParent(popper) : findCommonOffsetParent(popper, reference);\n  return getOffsetRectRelativeToArbitraryNode(reference, commonOffsetParent, fixedPosition);\n}\n\n/**\n * Get the outer sizes of the given element (offset size + margins)\n * @method\n * @memberof Popper.Utils\n * @argument {Element} element\n * @returns {Object} object containing width and height properties\n */\nfunction getOuterSizes(element) {\n  var window = element.ownerDocument.defaultView;\n  var styles = window.getComputedStyle(element);\n  var x = parseFloat(styles.marginTop || 0) + parseFloat(styles.marginBottom || 0);\n  var y = parseFloat(styles.marginLeft || 0) + parseFloat(styles.marginRight || 0);\n  var result = {\n    width: element.offsetWidth + y,\n    height: element.offsetHeight + x\n  };\n  return result;\n}\n\n/**\n * Get the opposite placement of the given one\n * @method\n * @memberof Popper.Utils\n * @argument {String} placement\n * @returns {String} flipped placement\n */\nfunction getOppositePlacement(placement) {\n  var hash = { left: 'right', right: 'left', bottom: 'top', top: 'bottom' };\n  return placement.replace(/left|right|bottom|top/g, function (matched) {\n    return hash[matched];\n  });\n}\n\n/**\n * Get offsets to the popper\n * @method\n * @memberof Popper.Utils\n * @param {Object} position - CSS position the Popper will get applied\n * @param {HTMLElement} popper - the popper element\n * @param {Object} referenceOffsets - the reference offsets (the popper will be relative to this)\n * @param {String} placement - one of the valid placement options\n * @returns {Object} popperOffsets - An object containing the offsets which will be applied to the popper\n */\nfunction getPopperOffsets(popper, referenceOffsets, placement) {\n  placement = placement.split('-')[0];\n\n  // Get popper node sizes\n  var popperRect = getOuterSizes(popper);\n\n  // Add position, width and height to our offsets object\n  var popperOffsets = {\n    width: popperRect.width,\n    height: popperRect.height\n  };\n\n  // depending by the popper placement we have to compute its offsets slightly differently\n  var isHoriz = ['right', 'left'].indexOf(placement) !== -1;\n  var mainSide = isHoriz ? 'top' : 'left';\n  var secondarySide = isHoriz ? 'left' : 'top';\n  var measurement = isHoriz ? 'height' : 'width';\n  var secondaryMeasurement = !isHoriz ? 'height' : 'width';\n\n  popperOffsets[mainSide] = referenceOffsets[mainSide] + referenceOffsets[measurement] / 2 - popperRect[measurement] / 2;\n  if (placement === secondarySide) {\n    popperOffsets[secondarySide] = referenceOffsets[secondarySide] - popperRect[secondaryMeasurement];\n  } else {\n    popperOffsets[secondarySide] = referenceOffsets[getOppositePlacement(secondarySide)];\n  }\n\n  return popperOffsets;\n}\n\n/**\n * Mimics the `find` method of Array\n * @method\n * @memberof Popper.Utils\n * @argument {Array} arr\n * @argument prop\n * @argument value\n * @returns index or -1\n */\nfunction find(arr, check) {\n  // use native find if supported\n  if (Array.prototype.find) {\n    return arr.find(check);\n  }\n\n  // use `filter` to obtain the same behavior of `find`\n  return arr.filter(check)[0];\n}\n\n/**\n * Return the index of the matching object\n * @method\n * @memberof Popper.Utils\n * @argument {Array} arr\n * @argument prop\n * @argument value\n * @returns index or -1\n */\nfunction findIndex(arr, prop, value) {\n  // use native findIndex if supported\n  if (Array.prototype.findIndex) {\n    return arr.findIndex(function (cur) {\n      return cur[prop] === value;\n    });\n  }\n\n  // use `find` + `indexOf` if `findIndex` isn't supported\n  var match = find(arr, function (obj) {\n    return obj[prop] === value;\n  });\n  return arr.indexOf(match);\n}\n\n/**\n * Loop trough the list of modifiers and run them in order,\n * each of them will then edit the data object.\n * @method\n * @memberof Popper.Utils\n * @param {dataObject} data\n * @param {Array} modifiers\n * @param {String} ends - Optional modifier name used as stopper\n * @returns {dataObject}\n */\nfunction runModifiers(modifiers, data, ends) {\n  var modifiersToRun = ends === undefined ? modifiers : modifiers.slice(0, findIndex(modifiers, 'name', ends));\n\n  modifiersToRun.forEach(function (modifier) {\n    if (modifier['function']) {\n      // eslint-disable-line dot-notation\n      console.warn('`modifier.function` is deprecated, use `modifier.fn`!');\n    }\n    var fn = modifier['function'] || modifier.fn; // eslint-disable-line dot-notation\n    if (modifier.enabled && isFunction(fn)) {\n      // Add properties to offsets to make them a complete clientRect object\n      // we do this before each modifier to make sure the previous one doesn't\n      // mess with these values\n      data.offsets.popper = getClientRect(data.offsets.popper);\n      data.offsets.reference = getClientRect(data.offsets.reference);\n\n      data = fn(data, modifier);\n    }\n  });\n\n  return data;\n}\n\n/**\n * Updates the position of the popper, computing the new offsets and applying\n * the new style.<br />\n * Prefer `scheduleUpdate` over `update` because of performance reasons.\n * @method\n * @memberof Popper\n */\nfunction update() {\n  // if popper is destroyed, don't perform any further update\n  if (this.state.isDestroyed) {\n    return;\n  }\n\n  var data = {\n    instance: this,\n    styles: {},\n    arrowStyles: {},\n    attributes: {},\n    flipped: false,\n    offsets: {}\n  };\n\n  // compute reference element offsets\n  data.offsets.reference = getReferenceOffsets(this.state, this.popper, this.reference, this.options.positionFixed);\n\n  // compute auto placement, store placement inside the data object,\n  // modifiers will be able to edit `placement` if needed\n  // and refer to originalPlacement to know the original value\n  data.placement = computeAutoPlacement(this.options.placement, data.offsets.reference, this.popper, this.reference, this.options.modifiers.flip.boundariesElement, this.options.modifiers.flip.padding);\n\n  // store the computed placement inside `originalPlacement`\n  data.originalPlacement = data.placement;\n\n  data.positionFixed = this.options.positionFixed;\n\n  // compute the popper offsets\n  data.offsets.popper = getPopperOffsets(this.popper, data.offsets.reference, data.placement);\n\n  data.offsets.popper.position = this.options.positionFixed ? 'fixed' : 'absolute';\n\n  // run the modifiers\n  data = runModifiers(this.modifiers, data);\n\n  // the first `update` will call `onCreate` callback\n  // the other ones will call `onUpdate` callback\n  if (!this.state.isCreated) {\n    this.state.isCreated = true;\n    this.options.onCreate(data);\n  } else {\n    this.options.onUpdate(data);\n  }\n}\n\n/**\n * Helper used to know if the given modifier is enabled.\n * @method\n * @memberof Popper.Utils\n * @returns {Boolean}\n */\nfunction isModifierEnabled(modifiers, modifierName) {\n  return modifiers.some(function (_ref) {\n    var name = _ref.name,\n        enabled = _ref.enabled;\n    return enabled && name === modifierName;\n  });\n}\n\n/**\n * Get the prefixed supported property name\n * @method\n * @memberof Popper.Utils\n * @argument {String} property (camelCase)\n * @returns {String} prefixed property (camelCase or PascalCase, depending on the vendor prefix)\n */\nfunction getSupportedPropertyName(property) {\n  var prefixes = [false, 'ms', 'Webkit', 'Moz', 'O'];\n  var upperProp = property.charAt(0).toUpperCase() + property.slice(1);\n\n  for (var i = 0; i < prefixes.length; i++) {\n    var prefix = prefixes[i];\n    var toCheck = prefix ? '' + prefix + upperProp : property;\n    if (typeof document.body.style[toCheck] !== 'undefined') {\n      return toCheck;\n    }\n  }\n  return null;\n}\n\n/**\n * Destroys the popper.\n * @method\n * @memberof Popper\n */\nfunction destroy() {\n  this.state.isDestroyed = true;\n\n  // touch DOM only if `applyStyle` modifier is enabled\n  if (isModifierEnabled(this.modifiers, 'applyStyle')) {\n    this.popper.removeAttribute('x-placement');\n    this.popper.style.position = '';\n    this.popper.style.top = '';\n    this.popper.style.left = '';\n    this.popper.style.right = '';\n    this.popper.style.bottom = '';\n    this.popper.style.willChange = '';\n    this.popper.style[getSupportedPropertyName('transform')] = '';\n  }\n\n  this.disableEventListeners();\n\n  // remove the popper if user explicity asked for the deletion on destroy\n  // do not use `remove` because IE11 doesn't support it\n  if (this.options.removeOnDestroy) {\n    this.popper.parentNode.removeChild(this.popper);\n  }\n  return this;\n}\n\n/**\n * Get the window associated with the element\n * @argument {Element} element\n * @returns {Window}\n */\nfunction getWindow(element) {\n  var ownerDocument = element.ownerDocument;\n  return ownerDocument ? ownerDocument.defaultView : window;\n}\n\nfunction attachToScrollParents(scrollParent, event, callback, scrollParents) {\n  var isBody = scrollParent.nodeName === 'BODY';\n  var target = isBody ? scrollParent.ownerDocument.defaultView : scrollParent;\n  target.addEventListener(event, callback, { passive: true });\n\n  if (!isBody) {\n    attachToScrollParents(getScrollParent(target.parentNode), event, callback, scrollParents);\n  }\n  scrollParents.push(target);\n}\n\n/**\n * Setup needed event listeners used to update the popper position\n * @method\n * @memberof Popper.Utils\n * @private\n */\nfunction setupEventListeners(reference, options, state, updateBound) {\n  // Resize event listener on window\n  state.updateBound = updateBound;\n  getWindow(reference).addEventListener('resize', state.updateBound, { passive: true });\n\n  // Scroll event listener on scroll parents\n  var scrollElement = getScrollParent(reference);\n  attachToScrollParents(scrollElement, 'scroll', state.updateBound, state.scrollParents);\n  state.scrollElement = scrollElement;\n  state.eventsEnabled = true;\n\n  return state;\n}\n\n/**\n * It will add resize/scroll events and start recalculating\n * position of the popper element when they are triggered.\n * @method\n * @memberof Popper\n */\nfunction enableEventListeners() {\n  if (!this.state.eventsEnabled) {\n    this.state = setupEventListeners(this.reference, this.options, this.state, this.scheduleUpdate);\n  }\n}\n\n/**\n * Remove event listeners used to update the popper position\n * @method\n * @memberof Popper.Utils\n * @private\n */\nfunction removeEventListeners(reference, state) {\n  // Remove resize event listener on window\n  getWindow(reference).removeEventListener('resize', state.updateBound);\n\n  // Remove scroll event listener on scroll parents\n  state.scrollParents.forEach(function (target) {\n    target.removeEventListener('scroll', state.updateBound);\n  });\n\n  // Reset state\n  state.updateBound = null;\n  state.scrollParents = [];\n  state.scrollElement = null;\n  state.eventsEnabled = false;\n  return state;\n}\n\n/**\n * It will remove resize/scroll events and won't recalculate popper position\n * when they are triggered. It also won't trigger `onUpdate` callback anymore,\n * unless you call `update` method manually.\n * @method\n * @memberof Popper\n */\nfunction disableEventListeners() {\n  if (this.state.eventsEnabled) {\n    cancelAnimationFrame(this.scheduleUpdate);\n    this.state = removeEventListeners(this.reference, this.state);\n  }\n}\n\n/**\n * Tells if a given input is a number\n * @method\n * @memberof Popper.Utils\n * @param {*} input to check\n * @return {Boolean}\n */\nfunction isNumeric(n) {\n  return n !== '' && !isNaN(parseFloat(n)) && isFinite(n);\n}\n\n/**\n * Set the style to the given popper\n * @method\n * @memberof Popper.Utils\n * @argument {Element} element - Element to apply the style to\n * @argument {Object} styles\n * Object with a list of properties and values which will be applied to the element\n */\nfunction setStyles(element, styles) {\n  Object.keys(styles).forEach(function (prop) {\n    var unit = '';\n    // add unit if the value is numeric and is one of the following\n    if (['width', 'height', 'top', 'right', 'bottom', 'left'].indexOf(prop) !== -1 && isNumeric(styles[prop])) {\n      unit = 'px';\n    }\n    element.style[prop] = styles[prop] + unit;\n  });\n}\n\n/**\n * Set the attributes to the given popper\n * @method\n * @memberof Popper.Utils\n * @argument {Element} element - Element to apply the attributes to\n * @argument {Object} styles\n * Object with a list of properties and values which will be applied to the element\n */\nfunction setAttributes(element, attributes) {\n  Object.keys(attributes).forEach(function (prop) {\n    var value = attributes[prop];\n    if (value !== false) {\n      element.setAttribute(prop, attributes[prop]);\n    } else {\n      element.removeAttribute(prop);\n    }\n  });\n}\n\n/**\n * @function\n * @memberof Modifiers\n * @argument {Object} data - The data object generated by `update` method\n * @argument {Object} data.styles - List of style properties - values to apply to popper element\n * @argument {Object} data.attributes - List of attribute properties - values to apply to popper element\n * @argument {Object} options - Modifiers configuration and options\n * @returns {Object} The same data object\n */\nfunction applyStyle(data) {\n  // any property present in `data.styles` will be applied to the popper,\n  // in this way we can make the 3rd party modifiers add custom styles to it\n  // Be aware, modifiers could override the properties defined in the previous\n  // lines of this modifier!\n  setStyles(data.instance.popper, data.styles);\n\n  // any property present in `data.attributes` will be applied to the popper,\n  // they will be set as HTML attributes of the element\n  setAttributes(data.instance.popper, data.attributes);\n\n  // if arrowElement is defined and arrowStyles has some properties\n  if (data.arrowElement && Object.keys(data.arrowStyles).length) {\n    setStyles(data.arrowElement, data.arrowStyles);\n  }\n\n  return data;\n}\n\n/**\n * Set the x-placement attribute before everything else because it could be used\n * to add margins to the popper margins needs to be calculated to get the\n * correct popper offsets.\n * @method\n * @memberof Popper.modifiers\n * @param {HTMLElement} reference - The reference element used to position the popper\n * @param {HTMLElement} popper - The HTML element used as popper\n * @param {Object} options - Popper.js options\n */\nfunction applyStyleOnLoad(reference, popper, options, modifierOptions, state) {\n  // compute reference element offsets\n  var referenceOffsets = getReferenceOffsets(state, popper, reference, options.positionFixed);\n\n  // compute auto placement, store placement inside the data object,\n  // modifiers will be able to edit `placement` if needed\n  // and refer to originalPlacement to know the original value\n  var placement = computeAutoPlacement(options.placement, referenceOffsets, popper, reference, options.modifiers.flip.boundariesElement, options.modifiers.flip.padding);\n\n  popper.setAttribute('x-placement', placement);\n\n  // Apply `position` to popper before anything else because\n  // without the position applied we can't guarantee correct computations\n  setStyles(popper, { position: options.positionFixed ? 'fixed' : 'absolute' });\n\n  return options;\n}\n\n/**\n * @function\n * @memberof Popper.Utils\n * @argument {Object} data - The data object generated by `update` method\n * @argument {Boolean} shouldRound - If the offsets should be rounded at all\n * @returns {Object} The popper's position offsets rounded\n *\n * The tale of pixel-perfect positioning. It's still not 100% perfect, but as\n * good as it can be within reason.\n * Discussion here: https://github.com/FezVrasta/popper.js/pull/715\n *\n * Low DPI screens cause a popper to be blurry if not using full pixels (Safari\n * as well on High DPI screens).\n *\n * Firefox prefers no rounding for positioning and does not have blurriness on\n * high DPI screens.\n *\n * Only horizontal placement and left/right values need to be considered.\n */\nfunction getRoundedOffsets(data, shouldRound) {\n  var _data$offsets = data.offsets,\n      popper = _data$offsets.popper,\n      reference = _data$offsets.reference;\n\n\n  var isVertical = ['left', 'right'].indexOf(data.placement) !== -1;\n  var isVariation = data.placement.indexOf('-') !== -1;\n  var sameWidthOddness = reference.width % 2 === popper.width % 2;\n  var bothOddWidth = reference.width % 2 === 1 && popper.width % 2 === 1;\n  var noRound = function noRound(v) {\n    return v;\n  };\n\n  var horizontalToInteger = !shouldRound ? noRound : isVertical || isVariation || sameWidthOddness ? Math.round : Math.floor;\n  var verticalToInteger = !shouldRound ? noRound : Math.round;\n\n  return {\n    left: horizontalToInteger(bothOddWidth && !isVariation && shouldRound ? popper.left - 1 : popper.left),\n    top: verticalToInteger(popper.top),\n    bottom: verticalToInteger(popper.bottom),\n    right: horizontalToInteger(popper.right)\n  };\n}\n\nvar isFirefox = isBrowser && /Firefox/i.test(navigator.userAgent);\n\n/**\n * @function\n * @memberof Modifiers\n * @argument {Object} data - The data object generated by `update` method\n * @argument {Object} options - Modifiers configuration and options\n * @returns {Object} The data object, properly modified\n */\nfunction computeStyle(data, options) {\n  var x = options.x,\n      y = options.y;\n  var popper = data.offsets.popper;\n\n  // Remove this legacy support in Popper.js v2\n\n  var legacyGpuAccelerationOption = find(data.instance.modifiers, function (modifier) {\n    return modifier.name === 'applyStyle';\n  }).gpuAcceleration;\n  if (legacyGpuAccelerationOption !== undefined) {\n    console.warn('WARNING: `gpuAcceleration` option moved to `computeStyle` modifier and will not be supported in future versions of Popper.js!');\n  }\n  var gpuAcceleration = legacyGpuAccelerationOption !== undefined ? legacyGpuAccelerationOption : options.gpuAcceleration;\n\n  var offsetParent = getOffsetParent(data.instance.popper);\n  var offsetParentRect = getBoundingClientRect(offsetParent);\n\n  // Styles\n  var styles = {\n    position: popper.position\n  };\n\n  var offsets = getRoundedOffsets(data, window.devicePixelRatio < 2 || !isFirefox);\n\n  var sideA = x === 'bottom' ? 'top' : 'bottom';\n  var sideB = y === 'right' ? 'left' : 'right';\n\n  // if gpuAcceleration is set to `true` and transform is supported,\n  //  we use `translate3d` to apply the position to the popper we\n  // automatically use the supported prefixed version if needed\n  var prefixedProperty = getSupportedPropertyName('transform');\n\n  // now, let's make a step back and look at this code closely (wtf?)\n  // If the content of the popper grows once it's been positioned, it\n  // may happen that the popper gets misplaced because of the new content\n  // overflowing its reference element\n  // To avoid this problem, we provide two options (x and y), which allow\n  // the consumer to define the offset origin.\n  // If we position a popper on top of a reference element, we can set\n  // `x` to `top` to make the popper grow towards its top instead of\n  // its bottom.\n  var left = void 0,\n      top = void 0;\n  if (sideA === 'bottom') {\n    // when offsetParent is <html> the positioning is relative to the bottom of the screen (excluding the scrollbar)\n    // and not the bottom of the html element\n    if (offsetParent.nodeName === 'HTML') {\n      top = -offsetParent.clientHeight + offsets.bottom;\n    } else {\n      top = -offsetParentRect.height + offsets.bottom;\n    }\n  } else {\n    top = offsets.top;\n  }\n  if (sideB === 'right') {\n    if (offsetParent.nodeName === 'HTML') {\n      left = -offsetParent.clientWidth + offsets.right;\n    } else {\n      left = -offsetParentRect.width + offsets.right;\n    }\n  } else {\n    left = offsets.left;\n  }\n  if (gpuAcceleration && prefixedProperty) {\n    styles[prefixedProperty] = 'translate3d(' + left + 'px, ' + top + 'px, 0)';\n    styles[sideA] = 0;\n    styles[sideB] = 0;\n    styles.willChange = 'transform';\n  } else {\n    // othwerise, we use the standard `top`, `left`, `bottom` and `right` properties\n    var invertTop = sideA === 'bottom' ? -1 : 1;\n    var invertLeft = sideB === 'right' ? -1 : 1;\n    styles[sideA] = top * invertTop;\n    styles[sideB] = left * invertLeft;\n    styles.willChange = sideA + ', ' + sideB;\n  }\n\n  // Attributes\n  var attributes = {\n    'x-placement': data.placement\n  };\n\n  // Update `data` attributes, styles and arrowStyles\n  data.attributes = _extends({}, attributes, data.attributes);\n  data.styles = _extends({}, styles, data.styles);\n  data.arrowStyles = _extends({}, data.offsets.arrow, data.arrowStyles);\n\n  return data;\n}\n\n/**\n * Helper used to know if the given modifier depends from another one.<br />\n * It checks if the needed modifier is listed and enabled.\n * @method\n * @memberof Popper.Utils\n * @param {Array} modifiers - list of modifiers\n * @param {String} requestingName - name of requesting modifier\n * @param {String} requestedName - name of requested modifier\n * @returns {Boolean}\n */\nfunction isModifierRequired(modifiers, requestingName, requestedName) {\n  var requesting = find(modifiers, function (_ref) {\n    var name = _ref.name;\n    return name === requestingName;\n  });\n\n  var isRequired = !!requesting && modifiers.some(function (modifier) {\n    return modifier.name === requestedName && modifier.enabled && modifier.order < requesting.order;\n  });\n\n  if (!isRequired) {\n    var _requesting = '`' + requestingName + '`';\n    var requested = '`' + requestedName + '`';\n    console.warn(requested + ' modifier is required by ' + _requesting + ' modifier in order to work, be sure to include it before ' + _requesting + '!');\n  }\n  return isRequired;\n}\n\n/**\n * @function\n * @memberof Modifiers\n * @argument {Object} data - The data object generated by update method\n * @argument {Object} options - Modifiers configuration and options\n * @returns {Object} The data object, properly modified\n */\nfunction arrow(data, options) {\n  var _data$offsets$arrow;\n\n  // arrow depends on keepTogether in order to work\n  if (!isModifierRequired(data.instance.modifiers, 'arrow', 'keepTogether')) {\n    return data;\n  }\n\n  var arrowElement = options.element;\n\n  // if arrowElement is a string, suppose it's a CSS selector\n  if (typeof arrowElement === 'string') {\n    arrowElement = data.instance.popper.querySelector(arrowElement);\n\n    // if arrowElement is not found, don't run the modifier\n    if (!arrowElement) {\n      return data;\n    }\n  } else {\n    // if the arrowElement isn't a query selector we must check that the\n    // provided DOM node is child of its popper node\n    if (!data.instance.popper.contains(arrowElement)) {\n      console.warn('WARNING: `arrow.element` must be child of its popper element!');\n      return data;\n    }\n  }\n\n  var placement = data.placement.split('-')[0];\n  var _data$offsets = data.offsets,\n      popper = _data$offsets.popper,\n      reference = _data$offsets.reference;\n\n  var isVertical = ['left', 'right'].indexOf(placement) !== -1;\n\n  var len = isVertical ? 'height' : 'width';\n  var sideCapitalized = isVertical ? 'Top' : 'Left';\n  var side = sideCapitalized.toLowerCase();\n  var altSide = isVertical ? 'left' : 'top';\n  var opSide = isVertical ? 'bottom' : 'right';\n  var arrowElementSize = getOuterSizes(arrowElement)[len];\n\n  //\n  // extends keepTogether behavior making sure the popper and its\n  // reference have enough pixels in conjunction\n  //\n\n  // top/left side\n  if (reference[opSide] - arrowElementSize < popper[side]) {\n    data.offsets.popper[side] -= popper[side] - (reference[opSide] - arrowElementSize);\n  }\n  // bottom/right side\n  if (reference[side] + arrowElementSize > popper[opSide]) {\n    data.offsets.popper[side] += reference[side] + arrowElementSize - popper[opSide];\n  }\n  data.offsets.popper = getClientRect(data.offsets.popper);\n\n  // compute center of the popper\n  var center = reference[side] + reference[len] / 2 - arrowElementSize / 2;\n\n  // Compute the sideValue using the updated popper offsets\n  // take popper margin in account because we don't have this info available\n  var css = getStyleComputedProperty(data.instance.popper);\n  var popperMarginSide = parseFloat(css['margin' + sideCapitalized], 10);\n  var popperBorderSide = parseFloat(css['border' + sideCapitalized + 'Width'], 10);\n  var sideValue = center - data.offsets.popper[side] - popperMarginSide - popperBorderSide;\n\n  // prevent arrowElement from being placed not contiguously to its popper\n  sideValue = Math.max(Math.min(popper[len] - arrowElementSize, sideValue), 0);\n\n  data.arrowElement = arrowElement;\n  data.offsets.arrow = (_data$offsets$arrow = {}, defineProperty(_data$offsets$arrow, side, Math.round(sideValue)), defineProperty(_data$offsets$arrow, altSide, ''), _data$offsets$arrow);\n\n  return data;\n}\n\n/**\n * Get the opposite placement variation of the given one\n * @method\n * @memberof Popper.Utils\n * @argument {String} placement variation\n * @returns {String} flipped placement variation\n */\nfunction getOppositeVariation(variation) {\n  if (variation === 'end') {\n    return 'start';\n  } else if (variation === 'start') {\n    return 'end';\n  }\n  return variation;\n}\n\n/**\n * List of accepted placements to use as values of the `placement` option.<br />\n * Valid placements are:\n * - `auto`\n * - `top`\n * - `right`\n * - `bottom`\n * - `left`\n *\n * Each placement can have a variation from this list:\n * - `-start`\n * - `-end`\n *\n * Variations are interpreted easily if you think of them as the left to right\n * written languages. Horizontally (`top` and `bottom`), `start` is left and `end`\n * is right.<br />\n * Vertically (`left` and `right`), `start` is top and `end` is bottom.\n *\n * Some valid examples are:\n * - `top-end` (on top of reference, right aligned)\n * - `right-start` (on right of reference, top aligned)\n * - `bottom` (on bottom, centered)\n * - `auto-end` (on the side with more space available, alignment depends by placement)\n *\n * @static\n * @type {Array}\n * @enum {String}\n * @readonly\n * @method placements\n * @memberof Popper\n */\nvar placements = ['auto-start', 'auto', 'auto-end', 'top-start', 'top', 'top-end', 'right-start', 'right', 'right-end', 'bottom-end', 'bottom', 'bottom-start', 'left-end', 'left', 'left-start'];\n\n// Get rid of `auto` `auto-start` and `auto-end`\nvar validPlacements = placements.slice(3);\n\n/**\n * Given an initial placement, returns all the subsequent placements\n * clockwise (or counter-clockwise).\n *\n * @method\n * @memberof Popper.Utils\n * @argument {String} placement - A valid placement (it accepts variations)\n * @argument {Boolean} counter - Set to true to walk the placements counterclockwise\n * @returns {Array} placements including their variations\n */\nfunction clockwise(placement) {\n  var counter = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n\n  var index = validPlacements.indexOf(placement);\n  var arr = validPlacements.slice(index + 1).concat(validPlacements.slice(0, index));\n  return counter ? arr.reverse() : arr;\n}\n\nvar BEHAVIORS = {\n  FLIP: 'flip',\n  CLOCKWISE: 'clockwise',\n  COUNTERCLOCKWISE: 'counterclockwise'\n};\n\n/**\n * @function\n * @memberof Modifiers\n * @argument {Object} data - The data object generated by update method\n * @argument {Object} options - Modifiers configuration and options\n * @returns {Object} The data object, properly modified\n */\nfunction flip(data, options) {\n  // if `inner` modifier is enabled, we can't use the `flip` modifier\n  if (isModifierEnabled(data.instance.modifiers, 'inner')) {\n    return data;\n  }\n\n  if (data.flipped && data.placement === data.originalPlacement) {\n    // seems like flip is trying to loop, probably there's not enough space on any of the flippable sides\n    return data;\n  }\n\n  var boundaries = getBoundaries(data.instance.popper, data.instance.reference, options.padding, options.boundariesElement, data.positionFixed);\n\n  var placement = data.placement.split('-')[0];\n  var placementOpposite = getOppositePlacement(placement);\n  var variation = data.placement.split('-')[1] || '';\n\n  var flipOrder = [];\n\n  switch (options.behavior) {\n    case BEHAVIORS.FLIP:\n      flipOrder = [placement, placementOpposite];\n      break;\n    case BEHAVIORS.CLOCKWISE:\n      flipOrder = clockwise(placement);\n      break;\n    case BEHAVIORS.COUNTERCLOCKWISE:\n      flipOrder = clockwise(placement, true);\n      break;\n    default:\n      flipOrder = options.behavior;\n  }\n\n  flipOrder.forEach(function (step, index) {\n    if (placement !== step || flipOrder.length === index + 1) {\n      return data;\n    }\n\n    placement = data.placement.split('-')[0];\n    placementOpposite = getOppositePlacement(placement);\n\n    var popperOffsets = data.offsets.popper;\n    var refOffsets = data.offsets.reference;\n\n    // using floor because the reference offsets may contain decimals we are not going to consider here\n    var floor = Math.floor;\n    var overlapsRef = placement === 'left' && floor(popperOffsets.right) > floor(refOffsets.left) || placement === 'right' && floor(popperOffsets.left) < floor(refOffsets.right) || placement === 'top' && floor(popperOffsets.bottom) > floor(refOffsets.top) || placement === 'bottom' && floor(popperOffsets.top) < floor(refOffsets.bottom);\n\n    var overflowsLeft = floor(popperOffsets.left) < floor(boundaries.left);\n    var overflowsRight = floor(popperOffsets.right) > floor(boundaries.right);\n    var overflowsTop = floor(popperOffsets.top) < floor(boundaries.top);\n    var overflowsBottom = floor(popperOffsets.bottom) > floor(boundaries.bottom);\n\n    var overflowsBoundaries = placement === 'left' && overflowsLeft || placement === 'right' && overflowsRight || placement === 'top' && overflowsTop || placement === 'bottom' && overflowsBottom;\n\n    // flip the variation if required\n    var isVertical = ['top', 'bottom'].indexOf(placement) !== -1;\n    var flippedVariation = !!options.flipVariations && (isVertical && variation === 'start' && overflowsLeft || isVertical && variation === 'end' && overflowsRight || !isVertical && variation === 'start' && overflowsTop || !isVertical && variation === 'end' && overflowsBottom);\n\n    if (overlapsRef || overflowsBoundaries || flippedVariation) {\n      // this boolean to detect any flip loop\n      data.flipped = true;\n\n      if (overlapsRef || overflowsBoundaries) {\n        placement = flipOrder[index + 1];\n      }\n\n      if (flippedVariation) {\n        variation = getOppositeVariation(variation);\n      }\n\n      data.placement = placement + (variation ? '-' + variation : '');\n\n      // this object contains `position`, we want to preserve it along with\n      // any additional property we may add in the future\n      data.offsets.popper = _extends({}, data.offsets.popper, getPopperOffsets(data.instance.popper, data.offsets.reference, data.placement));\n\n      data = runModifiers(data.instance.modifiers, data, 'flip');\n    }\n  });\n  return data;\n}\n\n/**\n * @function\n * @memberof Modifiers\n * @argument {Object} data - The data object generated by update method\n * @argument {Object} options - Modifiers configuration and options\n * @returns {Object} The data object, properly modified\n */\nfunction keepTogether(data) {\n  var _data$offsets = data.offsets,\n      popper = _data$offsets.popper,\n      reference = _data$offsets.reference;\n\n  var placement = data.placement.split('-')[0];\n  var floor = Math.floor;\n  var isVertical = ['top', 'bottom'].indexOf(placement) !== -1;\n  var side = isVertical ? 'right' : 'bottom';\n  var opSide = isVertical ? 'left' : 'top';\n  var measurement = isVertical ? 'width' : 'height';\n\n  if (popper[side] < floor(reference[opSide])) {\n    data.offsets.popper[opSide] = floor(reference[opSide]) - popper[measurement];\n  }\n  if (popper[opSide] > floor(reference[side])) {\n    data.offsets.popper[opSide] = floor(reference[side]);\n  }\n\n  return data;\n}\n\n/**\n * Converts a string containing value + unit into a px value number\n * @function\n * @memberof {modifiers~offset}\n * @private\n * @argument {String} str - Value + unit string\n * @argument {String} measurement - `height` or `width`\n * @argument {Object} popperOffsets\n * @argument {Object} referenceOffsets\n * @returns {Number|String}\n * Value in pixels, or original string if no values were extracted\n */\nfunction toValue(str, measurement, popperOffsets, referenceOffsets) {\n  // separate value from unit\n  var split = str.match(/((?:\\-|\\+)?\\d*\\.?\\d*)(.*)/);\n  var value = +split[1];\n  var unit = split[2];\n\n  // If it's not a number it's an operator, I guess\n  if (!value) {\n    return str;\n  }\n\n  if (unit.indexOf('%') === 0) {\n    var element = void 0;\n    switch (unit) {\n      case '%p':\n        element = popperOffsets;\n        break;\n      case '%':\n      case '%r':\n      default:\n        element = referenceOffsets;\n    }\n\n    var rect = getClientRect(element);\n    return rect[measurement] / 100 * value;\n  } else if (unit === 'vh' || unit === 'vw') {\n    // if is a vh or vw, we calculate the size based on the viewport\n    var size = void 0;\n    if (unit === 'vh') {\n      size = Math.max(document.documentElement.clientHeight, window.innerHeight || 0);\n    } else {\n      size = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);\n    }\n    return size / 100 * value;\n  } else {\n    // if is an explicit pixel unit, we get rid of the unit and keep the value\n    // if is an implicit unit, it's px, and we return just the value\n    return value;\n  }\n}\n\n/**\n * Parse an `offset` string to extrapolate `x` and `y` numeric offsets.\n * @function\n * @memberof {modifiers~offset}\n * @private\n * @argument {String} offset\n * @argument {Object} popperOffsets\n * @argument {Object} referenceOffsets\n * @argument {String} basePlacement\n * @returns {Array} a two cells array with x and y offsets in numbers\n */\nfunction parseOffset(offset, popperOffsets, referenceOffsets, basePlacement) {\n  var offsets = [0, 0];\n\n  // Use height if placement is left or right and index is 0 otherwise use width\n  // in this way the first offset will use an axis and the second one\n  // will use the other one\n  var useHeight = ['right', 'left'].indexOf(basePlacement) !== -1;\n\n  // Split the offset string to obtain a list of values and operands\n  // The regex addresses values with the plus or minus sign in front (+10, -20, etc)\n  var fragments = offset.split(/(\\+|\\-)/).map(function (frag) {\n    return frag.trim();\n  });\n\n  // Detect if the offset string contains a pair of values or a single one\n  // they could be separated by comma or space\n  var divider = fragments.indexOf(find(fragments, function (frag) {\n    return frag.search(/,|\\s/) !== -1;\n  }));\n\n  if (fragments[divider] && fragments[divider].indexOf(',') === -1) {\n    console.warn('Offsets separated by white space(s) are deprecated, use a comma (,) instead.');\n  }\n\n  // If divider is found, we divide the list of values and operands to divide\n  // them by ofset X and Y.\n  var splitRegex = /\\s*,\\s*|\\s+/;\n  var ops = divider !== -1 ? [fragments.slice(0, divider).concat([fragments[divider].split(splitRegex)[0]]), [fragments[divider].split(splitRegex)[1]].concat(fragments.slice(divider + 1))] : [fragments];\n\n  // Convert the values with units to absolute pixels to allow our computations\n  ops = ops.map(function (op, index) {\n    // Most of the units rely on the orientation of the popper\n    var measurement = (index === 1 ? !useHeight : useHeight) ? 'height' : 'width';\n    var mergeWithPrevious = false;\n    return op\n    // This aggregates any `+` or `-` sign that aren't considered operators\n    // e.g.: 10 + +5 => [10, +, +5]\n    .reduce(function (a, b) {\n      if (a[a.length - 1] === '' && ['+', '-'].indexOf(b) !== -1) {\n        a[a.length - 1] = b;\n        mergeWithPrevious = true;\n        return a;\n      } else if (mergeWithPrevious) {\n        a[a.length - 1] += b;\n        mergeWithPrevious = false;\n        return a;\n      } else {\n        return a.concat(b);\n      }\n    }, [])\n    // Here we convert the string values into number values (in px)\n    .map(function (str) {\n      return toValue(str, measurement, popperOffsets, referenceOffsets);\n    });\n  });\n\n  // Loop trough the offsets arrays and execute the operations\n  ops.forEach(function (op, index) {\n    op.forEach(function (frag, index2) {\n      if (isNumeric(frag)) {\n        offsets[index] += frag * (op[index2 - 1] === '-' ? -1 : 1);\n      }\n    });\n  });\n  return offsets;\n}\n\n/**\n * @function\n * @memberof Modifiers\n * @argument {Object} data - The data object generated by update method\n * @argument {Object} options - Modifiers configuration and options\n * @argument {Number|String} options.offset=0\n * The offset value as described in the modifier description\n * @returns {Object} The data object, properly modified\n */\nfunction offset(data, _ref) {\n  var offset = _ref.offset;\n  var placement = data.placement,\n      _data$offsets = data.offsets,\n      popper = _data$offsets.popper,\n      reference = _data$offsets.reference;\n\n  var basePlacement = placement.split('-')[0];\n\n  var offsets = void 0;\n  if (isNumeric(+offset)) {\n    offsets = [+offset, 0];\n  } else {\n    offsets = parseOffset(offset, popper, reference, basePlacement);\n  }\n\n  if (basePlacement === 'left') {\n    popper.top += offsets[0];\n    popper.left -= offsets[1];\n  } else if (basePlacement === 'right') {\n    popper.top += offsets[0];\n    popper.left += offsets[1];\n  } else if (basePlacement === 'top') {\n    popper.left += offsets[0];\n    popper.top -= offsets[1];\n  } else if (basePlacement === 'bottom') {\n    popper.left += offsets[0];\n    popper.top += offsets[1];\n  }\n\n  data.popper = popper;\n  return data;\n}\n\n/**\n * @function\n * @memberof Modifiers\n * @argument {Object} data - The data object generated by `update` method\n * @argument {Object} options - Modifiers configuration and options\n * @returns {Object} The data object, properly modified\n */\nfunction preventOverflow(data, options) {\n  var boundariesElement = options.boundariesElement || getOffsetParent(data.instance.popper);\n\n  // If offsetParent is the reference element, we really want to\n  // go one step up and use the next offsetParent as reference to\n  // avoid to make this modifier completely useless and look like broken\n  if (data.instance.reference === boundariesElement) {\n    boundariesElement = getOffsetParent(boundariesElement);\n  }\n\n  // NOTE: DOM access here\n  // resets the popper's position so that the document size can be calculated excluding\n  // the size of the popper element itself\n  var transformProp = getSupportedPropertyName('transform');\n  var popperStyles = data.instance.popper.style; // assignment to help minification\n  var top = popperStyles.top,\n      left = popperStyles.left,\n      transform = popperStyles[transformProp];\n\n  popperStyles.top = '';\n  popperStyles.left = '';\n  popperStyles[transformProp] = '';\n\n  var boundaries = getBoundaries(data.instance.popper, data.instance.reference, options.padding, boundariesElement, data.positionFixed);\n\n  // NOTE: DOM access here\n  // restores the original style properties after the offsets have been computed\n  popperStyles.top = top;\n  popperStyles.left = left;\n  popperStyles[transformProp] = transform;\n\n  options.boundaries = boundaries;\n\n  var order = options.priority;\n  var popper = data.offsets.popper;\n\n  var check = {\n    primary: function primary(placement) {\n      var value = popper[placement];\n      if (popper[placement] < boundaries[placement] && !options.escapeWithReference) {\n        value = Math.max(popper[placement], boundaries[placement]);\n      }\n      return defineProperty({}, placement, value);\n    },\n    secondary: function secondary(placement) {\n      var mainSide = placement === 'right' ? 'left' : 'top';\n      var value = popper[mainSide];\n      if (popper[placement] > boundaries[placement] && !options.escapeWithReference) {\n        value = Math.min(popper[mainSide], boundaries[placement] - (placement === 'right' ? popper.width : popper.height));\n      }\n      return defineProperty({}, mainSide, value);\n    }\n  };\n\n  order.forEach(function (placement) {\n    var side = ['left', 'top'].indexOf(placement) !== -1 ? 'primary' : 'secondary';\n    popper = _extends({}, popper, check[side](placement));\n  });\n\n  data.offsets.popper = popper;\n\n  return data;\n}\n\n/**\n * @function\n * @memberof Modifiers\n * @argument {Object} data - The data object generated by `update` method\n * @argument {Object} options - Modifiers configuration and options\n * @returns {Object} The data object, properly modified\n */\nfunction shift(data) {\n  var placement = data.placement;\n  var basePlacement = placement.split('-')[0];\n  var shiftvariation = placement.split('-')[1];\n\n  // if shift shiftvariation is specified, run the modifier\n  if (shiftvariation) {\n    var _data$offsets = data.offsets,\n        reference = _data$offsets.reference,\n        popper = _data$offsets.popper;\n\n    var isVertical = ['bottom', 'top'].indexOf(basePlacement) !== -1;\n    var side = isVertical ? 'left' : 'top';\n    var measurement = isVertical ? 'width' : 'height';\n\n    var shiftOffsets = {\n      start: defineProperty({}, side, reference[side]),\n      end: defineProperty({}, side, reference[side] + reference[measurement] - popper[measurement])\n    };\n\n    data.offsets.popper = _extends({}, popper, shiftOffsets[shiftvariation]);\n  }\n\n  return data;\n}\n\n/**\n * @function\n * @memberof Modifiers\n * @argument {Object} data - The data object generated by update method\n * @argument {Object} options - Modifiers configuration and options\n * @returns {Object} The data object, properly modified\n */\nfunction hide(data) {\n  if (!isModifierRequired(data.instance.modifiers, 'hide', 'preventOverflow')) {\n    return data;\n  }\n\n  var refRect = data.offsets.reference;\n  var bound = find(data.instance.modifiers, function (modifier) {\n    return modifier.name === 'preventOverflow';\n  }).boundaries;\n\n  if (refRect.bottom < bound.top || refRect.left > bound.right || refRect.top > bound.bottom || refRect.right < bound.left) {\n    // Avoid unnecessary DOM access if visibility hasn't changed\n    if (data.hide === true) {\n      return data;\n    }\n\n    data.hide = true;\n    data.attributes['x-out-of-boundaries'] = '';\n  } else {\n    // Avoid unnecessary DOM access if visibility hasn't changed\n    if (data.hide === false) {\n      return data;\n    }\n\n    data.hide = false;\n    data.attributes['x-out-of-boundaries'] = false;\n  }\n\n  return data;\n}\n\n/**\n * @function\n * @memberof Modifiers\n * @argument {Object} data - The data object generated by `update` method\n * @argument {Object} options - Modifiers configuration and options\n * @returns {Object} The data object, properly modified\n */\nfunction inner(data) {\n  var placement = data.placement;\n  var basePlacement = placement.split('-')[0];\n  var _data$offsets = data.offsets,\n      popper = _data$offsets.popper,\n      reference = _data$offsets.reference;\n\n  var isHoriz = ['left', 'right'].indexOf(basePlacement) !== -1;\n\n  var subtractLength = ['top', 'left'].indexOf(basePlacement) === -1;\n\n  popper[isHoriz ? 'left' : 'top'] = reference[basePlacement] - (subtractLength ? popper[isHoriz ? 'width' : 'height'] : 0);\n\n  data.placement = getOppositePlacement(placement);\n  data.offsets.popper = getClientRect(popper);\n\n  return data;\n}\n\n/**\n * Modifier function, each modifier can have a function of this type assigned\n * to its `fn` property.<br />\n * These functions will be called on each update, this means that you must\n * make sure they are performant enough to avoid performance bottlenecks.\n *\n * @function ModifierFn\n * @argument {dataObject} data - The data object generated by `update` method\n * @argument {Object} options - Modifiers configuration and options\n * @returns {dataObject} The data object, properly modified\n */\n\n/**\n * Modifiers are plugins used to alter the behavior of your poppers.<br />\n * Popper.js uses a set of 9 modifiers to provide all the basic functionalities\n * needed by the library.\n *\n * Usually you don't want to override the `order`, `fn` and `onLoad` props.\n * All the other properties are configurations that could be tweaked.\n * @namespace modifiers\n */\nvar modifiers = {\n  /**\n   * Modifier used to shift the popper on the start or end of its reference\n   * element.<br />\n   * It will read the variation of the `placement` property.<br />\n   * It can be one either `-end` or `-start`.\n   * @memberof modifiers\n   * @inner\n   */\n  shift: {\n    /** @prop {number} order=100 - Index used to define the order of execution */\n    order: 100,\n    /** @prop {Boolean} enabled=true - Whether the modifier is enabled or not */\n    enabled: true,\n    /** @prop {ModifierFn} */\n    fn: shift\n  },\n\n  /**\n   * The `offset` modifier can shift your popper on both its axis.\n   *\n   * It accepts the following units:\n   * - `px` or unit-less, interpreted as pixels\n   * - `%` or `%r`, percentage relative to the length of the reference element\n   * - `%p`, percentage relative to the length of the popper element\n   * - `vw`, CSS viewport width unit\n   * - `vh`, CSS viewport height unit\n   *\n   * For length is intended the main axis relative to the placement of the popper.<br />\n   * This means that if the placement is `top` or `bottom`, the length will be the\n   * `width`. In case of `left` or `right`, it will be the `height`.\n   *\n   * You can provide a single value (as `Number` or `String`), or a pair of values\n   * as `String` divided by a comma or one (or more) white spaces.<br />\n   * The latter is a deprecated method because it leads to confusion and will be\n   * removed in v2.<br />\n   * Additionally, it accepts additions and subtractions between different units.\n   * Note that multiplications and divisions aren't supported.\n   *\n   * Valid examples are:\n   * ```\n   * 10\n   * '10%'\n   * '10, 10'\n   * '10%, 10'\n   * '10 + 10%'\n   * '10 - 5vh + 3%'\n   * '-10px + 5vh, 5px - 6%'\n   * ```\n   * > **NB**: If you desire to apply offsets to your poppers in a way that may make them overlap\n   * > with their reference element, unfortunately, you will have to disable the `flip` modifier.\n   * > You can read more on this at this [issue](https://github.com/FezVrasta/popper.js/issues/373).\n   *\n   * @memberof modifiers\n   * @inner\n   */\n  offset: {\n    /** @prop {number} order=200 - Index used to define the order of execution */\n    order: 200,\n    /** @prop {Boolean} enabled=true - Whether the modifier is enabled or not */\n    enabled: true,\n    /** @prop {ModifierFn} */\n    fn: offset,\n    /** @prop {Number|String} offset=0\n     * The offset value as described in the modifier description\n     */\n    offset: 0\n  },\n\n  /**\n   * Modifier used to prevent the popper from being positioned outside the boundary.\n   *\n   * A scenario exists where the reference itself is not within the boundaries.<br />\n   * We can say it has \"escaped the boundaries\"  or just \"escaped\".<br />\n   * In this case we need to decide whether the popper should either:\n   *\n   * - detach from the reference and remain \"trapped\" in the boundaries, or\n   * - if it should ignore the boundary and \"escape with its reference\"\n   *\n   * When `escapeWithReference` is set to`true` and reference is completely\n   * outside its boundaries, the popper will overflow (or completely leave)\n   * the boundaries in order to remain attached to the edge of the reference.\n   *\n   * @memberof modifiers\n   * @inner\n   */\n  preventOverflow: {\n    /** @prop {number} order=300 - Index used to define the order of execution */\n    order: 300,\n    /** @prop {Boolean} enabled=true - Whether the modifier is enabled or not */\n    enabled: true,\n    /** @prop {ModifierFn} */\n    fn: preventOverflow,\n    /**\n     * @prop {Array} [priority=['left','right','top','bottom']]\n     * Popper will try to prevent overflow following these priorities by default,\n     * then, it could overflow on the left and on top of the `boundariesElement`\n     */\n    priority: ['left', 'right', 'top', 'bottom'],\n    /**\n     * @prop {number} padding=5\n     * Amount of pixel used to define a minimum distance between the boundaries\n     * and the popper. This makes sure the popper always has a little padding\n     * between the edges of its container\n     */\n    padding: 5,\n    /**\n     * @prop {String|HTMLElement} boundariesElement='scrollParent'\n     * Boundaries used by the modifier. Can be `scrollParent`, `window`,\n     * `viewport` or any DOM element.\n     */\n    boundariesElement: 'scrollParent'\n  },\n\n  /**\n   * Modifier used to make sure the reference and its popper stay near each other\n   * without leaving any gap between the two. Especially useful when the arrow is\n   * enabled and you want to ensure that it points to its reference element.\n   * It cares only about the first axis. You can still have poppers with margin\n   * between the popper and its reference element.\n   * @memberof modifiers\n   * @inner\n   */\n  keepTogether: {\n    /** @prop {number} order=400 - Index used to define the order of execution */\n    order: 400,\n    /** @prop {Boolean} enabled=true - Whether the modifier is enabled or not */\n    enabled: true,\n    /** @prop {ModifierFn} */\n    fn: keepTogether\n  },\n\n  /**\n   * This modifier is used to move the `arrowElement` of the popper to make\n   * sure it is positioned between the reference element and its popper element.\n   * It will read the outer size of the `arrowElement` node to detect how many\n   * pixels of conjunction are needed.\n   *\n   * It has no effect if no `arrowElement` is provided.\n   * @memberof modifiers\n   * @inner\n   */\n  arrow: {\n    /** @prop {number} order=500 - Index used to define the order of execution */\n    order: 500,\n    /** @prop {Boolean} enabled=true - Whether the modifier is enabled or not */\n    enabled: true,\n    /** @prop {ModifierFn} */\n    fn: arrow,\n    /** @prop {String|HTMLElement} element='[x-arrow]' - Selector or node used as arrow */\n    element: '[x-arrow]'\n  },\n\n  /**\n   * Modifier used to flip the popper's placement when it starts to overlap its\n   * reference element.\n   *\n   * Requires the `preventOverflow` modifier before it in order to work.\n   *\n   * **NOTE:** this modifier will interrupt the current update cycle and will\n   * restart it if it detects the need to flip the placement.\n   * @memberof modifiers\n   * @inner\n   */\n  flip: {\n    /** @prop {number} order=600 - Index used to define the order of execution */\n    order: 600,\n    /** @prop {Boolean} enabled=true - Whether the modifier is enabled or not */\n    enabled: true,\n    /** @prop {ModifierFn} */\n    fn: flip,\n    /**\n     * @prop {String|Array} behavior='flip'\n     * The behavior used to change the popper's placement. It can be one of\n     * `flip`, `clockwise`, `counterclockwise` or an array with a list of valid\n     * placements (with optional variations)\n     */\n    behavior: 'flip',\n    /**\n     * @prop {number} padding=5\n     * The popper will flip if it hits the edges of the `boundariesElement`\n     */\n    padding: 5,\n    /**\n     * @prop {String|HTMLElement} boundariesElement='viewport'\n     * The element which will define the boundaries of the popper position.\n     * The popper will never be placed outside of the defined boundaries\n     * (except if `keepTogether` is enabled)\n     */\n    boundariesElement: 'viewport'\n  },\n\n  /**\n   * Modifier used to make the popper flow toward the inner of the reference element.\n   * By default, when this modifier is disabled, the popper will be placed outside\n   * the reference element.\n   * @memberof modifiers\n   * @inner\n   */\n  inner: {\n    /** @prop {number} order=700 - Index used to define the order of execution */\n    order: 700,\n    /** @prop {Boolean} enabled=false - Whether the modifier is enabled or not */\n    enabled: false,\n    /** @prop {ModifierFn} */\n    fn: inner\n  },\n\n  /**\n   * Modifier used to hide the popper when its reference element is outside of the\n   * popper boundaries. It will set a `x-out-of-boundaries` attribute which can\n   * be used to hide with a CSS selector the popper when its reference is\n   * out of boundaries.\n   *\n   * Requires the `preventOverflow` modifier before it in order to work.\n   * @memberof modifiers\n   * @inner\n   */\n  hide: {\n    /** @prop {number} order=800 - Index used to define the order of execution */\n    order: 800,\n    /** @prop {Boolean} enabled=true - Whether the modifier is enabled or not */\n    enabled: true,\n    /** @prop {ModifierFn} */\n    fn: hide\n  },\n\n  /**\n   * Computes the style that will be applied to the popper element to gets\n   * properly positioned.\n   *\n   * Note that this modifier will not touch the DOM, it just prepares the styles\n   * so that `applyStyle` modifier can apply it. This separation is useful\n   * in case you need to replace `applyStyle` with a custom implementation.\n   *\n   * This modifier has `850` as `order` value to maintain backward compatibility\n   * with previous versions of Popper.js. Expect the modifiers ordering method\n   * to change in future major versions of the library.\n   *\n   * @memberof modifiers\n   * @inner\n   */\n  computeStyle: {\n    /** @prop {number} order=850 - Index used to define the order of execution */\n    order: 850,\n    /** @prop {Boolean} enabled=true - Whether the modifier is enabled or not */\n    enabled: true,\n    /** @prop {ModifierFn} */\n    fn: computeStyle,\n    /**\n     * @prop {Boolean} gpuAcceleration=true\n     * If true, it uses the CSS 3D transformation to position the popper.\n     * Otherwise, it will use the `top` and `left` properties\n     */\n    gpuAcceleration: true,\n    /**\n     * @prop {string} [x='bottom']\n     * Where to anchor the X axis (`bottom` or `top`). AKA X offset origin.\n     * Change this if your popper should grow in a direction different from `bottom`\n     */\n    x: 'bottom',\n    /**\n     * @prop {string} [x='left']\n     * Where to anchor the Y axis (`left` or `right`). AKA Y offset origin.\n     * Change this if your popper should grow in a direction different from `right`\n     */\n    y: 'right'\n  },\n\n  /**\n   * Applies the computed styles to the popper element.\n   *\n   * All the DOM manipulations are limited to this modifier. This is useful in case\n   * you want to integrate Popper.js inside a framework or view library and you\n   * want to delegate all the DOM manipulations to it.\n   *\n   * Note that if you disable this modifier, you must make sure the popper element\n   * has its position set to `absolute` before Popper.js can do its work!\n   *\n   * Just disable this modifier and define your own to achieve the desired effect.\n   *\n   * @memberof modifiers\n   * @inner\n   */\n  applyStyle: {\n    /** @prop {number} order=900 - Index used to define the order of execution */\n    order: 900,\n    /** @prop {Boolean} enabled=true - Whether the modifier is enabled or not */\n    enabled: true,\n    /** @prop {ModifierFn} */\n    fn: applyStyle,\n    /** @prop {Function} */\n    onLoad: applyStyleOnLoad,\n    /**\n     * @deprecated since version 1.10.0, the property moved to `computeStyle` modifier\n     * @prop {Boolean} gpuAcceleration=true\n     * If true, it uses the CSS 3D transformation to position the popper.\n     * Otherwise, it will use the `top` and `left` properties\n     */\n    gpuAcceleration: undefined\n  }\n};\n\n/**\n * The `dataObject` is an object containing all the information used by Popper.js.\n * This object is passed to modifiers and to the `onCreate` and `onUpdate` callbacks.\n * @name dataObject\n * @property {Object} data.instance The Popper.js instance\n * @property {String} data.placement Placement applied to popper\n * @property {String} data.originalPlacement Placement originally defined on init\n * @property {Boolean} data.flipped True if popper has been flipped by flip modifier\n * @property {Boolean} data.hide True if the reference element is out of boundaries, useful to know when to hide the popper\n * @property {HTMLElement} data.arrowElement Node used as arrow by arrow modifier\n * @property {Object} data.styles Any CSS property defined here will be applied to the popper. It expects the JavaScript nomenclature (eg. `marginBottom`)\n * @property {Object} data.arrowStyles Any CSS property defined here will be applied to the popper arrow. It expects the JavaScript nomenclature (eg. `marginBottom`)\n * @property {Object} data.boundaries Offsets of the popper boundaries\n * @property {Object} data.offsets The measurements of popper, reference and arrow elements\n * @property {Object} data.offsets.popper `top`, `left`, `width`, `height` values\n * @property {Object} data.offsets.reference `top`, `left`, `width`, `height` values\n * @property {Object} data.offsets.arrow] `top` and `left` offsets, only one of them will be different from 0\n */\n\n/**\n * Default options provided to Popper.js constructor.<br />\n * These can be overridden using the `options` argument of Popper.js.<br />\n * To override an option, simply pass an object with the same\n * structure of the `options` object, as the 3rd argument. For example:\n * ```\n * new Popper(ref, pop, {\n *   modifiers: {\n *     preventOverflow: { enabled: false }\n *   }\n * })\n * ```\n * @type {Object}\n * @static\n * @memberof Popper\n */\nvar Defaults = {\n  /**\n   * Popper's placement.\n   * @prop {Popper.placements} placement='bottom'\n   */\n  placement: 'bottom',\n\n  /**\n   * Set this to true if you want popper to position it self in 'fixed' mode\n   * @prop {Boolean} positionFixed=false\n   */\n  positionFixed: false,\n\n  /**\n   * Whether events (resize, scroll) are initially enabled.\n   * @prop {Boolean} eventsEnabled=true\n   */\n  eventsEnabled: true,\n\n  /**\n   * Set to true if you want to automatically remove the popper when\n   * you call the `destroy` method.\n   * @prop {Boolean} removeOnDestroy=false\n   */\n  removeOnDestroy: false,\n\n  /**\n   * Callback called when the popper is created.<br />\n   * By default, it is set to no-op.<br />\n   * Access Popper.js instance with `data.instance`.\n   * @prop {onCreate}\n   */\n  onCreate: function onCreate() {},\n\n  /**\n   * Callback called when the popper is updated. This callback is not called\n   * on the initialization/creation of the popper, but only on subsequent\n   * updates.<br />\n   * By default, it is set to no-op.<br />\n   * Access Popper.js instance with `data.instance`.\n   * @prop {onUpdate}\n   */\n  onUpdate: function onUpdate() {},\n\n  /**\n   * List of modifiers used to modify the offsets before they are applied to the popper.\n   * They provide most of the functionalities of Popper.js.\n   * @prop {modifiers}\n   */\n  modifiers: modifiers\n};\n\n/**\n * @callback onCreate\n * @param {dataObject} data\n */\n\n/**\n * @callback onUpdate\n * @param {dataObject} data\n */\n\n// Utils\n// Methods\nvar Popper = function () {\n  /**\n   * Creates a new Popper.js instance.\n   * @class Popper\n   * @param {HTMLElement|referenceObject} reference - The reference element used to position the popper\n   * @param {HTMLElement} popper - The HTML element used as the popper\n   * @param {Object} options - Your custom options to override the ones defined in [Defaults](#defaults)\n   * @return {Object} instance - The generated Popper.js instance\n   */\n  function Popper(reference, popper) {\n    var _this = this;\n\n    var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n    classCallCheck(this, Popper);\n\n    this.scheduleUpdate = function () {\n      return requestAnimationFrame(_this.update);\n    };\n\n    // make update() debounced, so that it only runs at most once-per-tick\n    this.update = debounce(this.update.bind(this));\n\n    // with {} we create a new object with the options inside it\n    this.options = _extends({}, Popper.Defaults, options);\n\n    // init state\n    this.state = {\n      isDestroyed: false,\n      isCreated: false,\n      scrollParents: []\n    };\n\n    // get reference and popper elements (allow jQuery wrappers)\n    this.reference = reference && reference.jquery ? reference[0] : reference;\n    this.popper = popper && popper.jquery ? popper[0] : popper;\n\n    // Deep merge modifiers options\n    this.options.modifiers = {};\n    Object.keys(_extends({}, Popper.Defaults.modifiers, options.modifiers)).forEach(function (name) {\n      _this.options.modifiers[name] = _extends({}, Popper.Defaults.modifiers[name] || {}, options.modifiers ? options.modifiers[name] : {});\n    });\n\n    // Refactoring modifiers' list (Object => Array)\n    this.modifiers = Object.keys(this.options.modifiers).map(function (name) {\n      return _extends({\n        name: name\n      }, _this.options.modifiers[name]);\n    })\n    // sort the modifiers by order\n    .sort(function (a, b) {\n      return a.order - b.order;\n    });\n\n    // modifiers have the ability to execute arbitrary code when Popper.js get inited\n    // such code is executed in the same order of its modifier\n    // they could add new properties to their options configuration\n    // BE AWARE: don't add options to `options.modifiers.name` but to `modifierOptions`!\n    this.modifiers.forEach(function (modifierOptions) {\n      if (modifierOptions.enabled && isFunction(modifierOptions.onLoad)) {\n        modifierOptions.onLoad(_this.reference, _this.popper, _this.options, modifierOptions, _this.state);\n      }\n    });\n\n    // fire the first update to position the popper in the right place\n    this.update();\n\n    var eventsEnabled = this.options.eventsEnabled;\n    if (eventsEnabled) {\n      // setup event listeners, they will take care of update the position in specific situations\n      this.enableEventListeners();\n    }\n\n    this.state.eventsEnabled = eventsEnabled;\n  }\n\n  // We can't use class properties because they don't get listed in the\n  // class prototype and break stuff like Sinon stubs\n\n\n  createClass(Popper, [{\n    key: 'update',\n    value: function update$$1() {\n      return update.call(this);\n    }\n  }, {\n    key: 'destroy',\n    value: function destroy$$1() {\n      return destroy.call(this);\n    }\n  }, {\n    key: 'enableEventListeners',\n    value: function enableEventListeners$$1() {\n      return enableEventListeners.call(this);\n    }\n  }, {\n    key: 'disableEventListeners',\n    value: function disableEventListeners$$1() {\n      return disableEventListeners.call(this);\n    }\n\n    /**\n     * Schedules an update. It will run on the next UI update available.\n     * @method scheduleUpdate\n     * @memberof Popper\n     */\n\n\n    /**\n     * Collection of utilities useful when writing custom modifiers.\n     * Starting from version 1.7, this method is available only if you\n     * include `popper-utils.js` before `popper.js`.\n     *\n     * **DEPRECATION**: This way to access PopperUtils is deprecated\n     * and will be removed in v2! Use the PopperUtils module directly instead.\n     * Due to the high instability of the methods contained in Utils, we can't\n     * guarantee them to follow semver. Use them at your own risk!\n     * @static\n     * @private\n     * @type {Object}\n     * @deprecated since version 1.8\n     * @member Utils\n     * @memberof Popper\n     */\n\n  }]);\n  return Popper;\n}();\n\n/**\n * The `referenceObject` is an object that provides an interface compatible with Popper.js\n * and lets you use it as replacement of a real DOM node.<br />\n * You can use this method to position a popper relatively to a set of coordinates\n * in case you don't have a DOM node to use as reference.\n *\n * ```\n * new Popper(referenceObject, popperNode);\n * ```\n *\n * NB: This feature isn't supported in Internet Explorer 10.\n * @name referenceObject\n * @property {Function} data.getBoundingClientRect\n * A function that returns a set of coordinates compatible with the native `getBoundingClientRect` method.\n * @property {number} data.clientWidth\n * An ES6 getter that will return the width of the virtual reference element.\n * @property {number} data.clientHeight\n * An ES6 getter that will return the height of the virtual reference element.\n */\n\n\nPopper.Utils = (typeof window !== 'undefined' ? window : global).PopperUtils;\nPopper.placements = placements;\nPopper.Defaults = Defaults;\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (Popper);\n//# sourceMappingURL=popper.js.map\n\n/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(/*! ./../../../webpack/buildin/global.js */ \"698d75b157f24ae829cc\")))//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMDU5NTFjMmYyYmRhNDY5MWJlZDMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvcG9wcGVyLmpzL2Rpc3QvZXNtL3BvcHBlci5qcz9mMGJkIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKiFcbiAqIEBmaWxlT3ZlcnZpZXcgS2lja2FzcyBsaWJyYXJ5IHRvIGNyZWF0ZSBhbmQgcGxhY2UgcG9wcGVycyBuZWFyIHRoZWlyIHJlZmVyZW5jZSBlbGVtZW50cy5cbiAqIEB2ZXJzaW9uIDEuMTQuNlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAoYykgMjAxNiBGZWRlcmljbyBaaXZvbG8gYW5kIGNvbnRyaWJ1dG9yc1xuICpcbiAqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHlcbiAqIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlIFwiU29mdHdhcmVcIiksIHRvIGRlYWxcbiAqIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHNcbiAqIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGxcbiAqIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpc1xuICogZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczpcbiAqXG4gKiBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpbiBhbGxcbiAqIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuXG4gKlxuICogVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUlxuICogSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksXG4gKiBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEVcbiAqIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVJcbiAqIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sXG4gKiBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOIFRIRVxuICogU09GVFdBUkUuXG4gKi9cbnZhciBpc0Jyb3dzZXIgPSB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyAmJiB0eXBlb2YgZG9jdW1lbnQgIT09ICd1bmRlZmluZWQnO1xuXG52YXIgbG9uZ2VyVGltZW91dEJyb3dzZXJzID0gWydFZGdlJywgJ1RyaWRlbnQnLCAnRmlyZWZveCddO1xudmFyIHRpbWVvdXREdXJhdGlvbiA9IDA7XG5mb3IgKHZhciBpID0gMDsgaSA8IGxvbmdlclRpbWVvdXRCcm93c2Vycy5sZW5ndGg7IGkgKz0gMSkge1xuICBpZiAoaXNCcm93c2VyICYmIG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZihsb25nZXJUaW1lb3V0QnJvd3NlcnNbaV0pID49IDApIHtcbiAgICB0aW1lb3V0RHVyYXRpb24gPSAxO1xuICAgIGJyZWFrO1xuICB9XG59XG5cbmZ1bmN0aW9uIG1pY3JvdGFza0RlYm91bmNlKGZuKSB7XG4gIHZhciBjYWxsZWQgPSBmYWxzZTtcbiAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoY2FsbGVkKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNhbGxlZCA9IHRydWU7XG4gICAgd2luZG93LlByb21pc2UucmVzb2x2ZSgpLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgY2FsbGVkID0gZmFsc2U7XG4gICAgICBmbigpO1xuICAgIH0pO1xuICB9O1xufVxuXG5mdW5jdGlvbiB0YXNrRGVib3VuY2UoZm4pIHtcbiAgdmFyIHNjaGVkdWxlZCA9IGZhbHNlO1xuICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgIGlmICghc2NoZWR1bGVkKSB7XG4gICAgICBzY2hlZHVsZWQgPSB0cnVlO1xuICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHNjaGVkdWxlZCA9IGZhbHNlO1xuICAgICAgICBmbigpO1xuICAgICAgfSwgdGltZW91dER1cmF0aW9uKTtcbiAgICB9XG4gIH07XG59XG5cbnZhciBzdXBwb3J0c01pY3JvVGFza3MgPSBpc0Jyb3dzZXIgJiYgd2luZG93LlByb21pc2U7XG5cbi8qKlxuKiBDcmVhdGUgYSBkZWJvdW5jZWQgdmVyc2lvbiBvZiBhIG1ldGhvZCwgdGhhdCdzIGFzeW5jaHJvbm91c2x5IGRlZmVycmVkXG4qIGJ1dCBjYWxsZWQgaW4gdGhlIG1pbmltdW0gdGltZSBwb3NzaWJsZS5cbipcbiogQG1ldGhvZFxuKiBAbWVtYmVyb2YgUG9wcGVyLlV0aWxzXG4qIEBhcmd1bWVudCB7RnVuY3Rpb259IGZuXG4qIEByZXR1cm5zIHtGdW5jdGlvbn1cbiovXG52YXIgZGVib3VuY2UgPSBzdXBwb3J0c01pY3JvVGFza3MgPyBtaWNyb3Rhc2tEZWJvdW5jZSA6IHRhc2tEZWJvdW5jZTtcblxuLyoqXG4gKiBDaGVjayBpZiB0aGUgZ2l2ZW4gdmFyaWFibGUgaXMgYSBmdW5jdGlvblxuICogQG1ldGhvZFxuICogQG1lbWJlcm9mIFBvcHBlci5VdGlsc1xuICogQGFyZ3VtZW50IHtBbnl9IGZ1bmN0aW9uVG9DaGVjayAtIHZhcmlhYmxlIHRvIGNoZWNrXG4gKiBAcmV0dXJucyB7Qm9vbGVhbn0gYW5zd2VyIHRvOiBpcyBhIGZ1bmN0aW9uP1xuICovXG5mdW5jdGlvbiBpc0Z1bmN0aW9uKGZ1bmN0aW9uVG9DaGVjaykge1xuICB2YXIgZ2V0VHlwZSA9IHt9O1xuICByZXR1cm4gZnVuY3Rpb25Ub0NoZWNrICYmIGdldFR5cGUudG9TdHJpbmcuY2FsbChmdW5jdGlvblRvQ2hlY2spID09PSAnW29iamVjdCBGdW5jdGlvbl0nO1xufVxuXG4vKipcbiAqIEdldCBDU1MgY29tcHV0ZWQgcHJvcGVydHkgb2YgdGhlIGdpdmVuIGVsZW1lbnRcbiAqIEBtZXRob2RcbiAqIEBtZW1iZXJvZiBQb3BwZXIuVXRpbHNcbiAqIEBhcmd1bWVudCB7RWVtZW50fSBlbGVtZW50XG4gKiBAYXJndW1lbnQge1N0cmluZ30gcHJvcGVydHlcbiAqL1xuZnVuY3Rpb24gZ2V0U3R5bGVDb21wdXRlZFByb3BlcnR5KGVsZW1lbnQsIHByb3BlcnR5KSB7XG4gIGlmIChlbGVtZW50Lm5vZGVUeXBlICE9PSAxKSB7XG4gICAgcmV0dXJuIFtdO1xuICB9XG4gIC8vIE5PVEU6IDEgRE9NIGFjY2VzcyBoZXJlXG4gIHZhciB3aW5kb3cgPSBlbGVtZW50Lm93bmVyRG9jdW1lbnQuZGVmYXVsdFZpZXc7XG4gIHZhciBjc3MgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShlbGVtZW50LCBudWxsKTtcbiAgcmV0dXJuIHByb3BlcnR5ID8gY3NzW3Byb3BlcnR5XSA6IGNzcztcbn1cblxuLyoqXG4gKiBSZXR1cm5zIHRoZSBwYXJlbnROb2RlIG9yIHRoZSBob3N0IG9mIHRoZSBlbGVtZW50XG4gKiBAbWV0aG9kXG4gKiBAbWVtYmVyb2YgUG9wcGVyLlV0aWxzXG4gKiBAYXJndW1lbnQge0VsZW1lbnR9IGVsZW1lbnRcbiAqIEByZXR1cm5zIHtFbGVtZW50fSBwYXJlbnRcbiAqL1xuZnVuY3Rpb24gZ2V0UGFyZW50Tm9kZShlbGVtZW50KSB7XG4gIGlmIChlbGVtZW50Lm5vZGVOYW1lID09PSAnSFRNTCcpIHtcbiAgICByZXR1cm4gZWxlbWVudDtcbiAgfVxuICByZXR1cm4gZWxlbWVudC5wYXJlbnROb2RlIHx8IGVsZW1lbnQuaG9zdDtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIHRoZSBzY3JvbGxpbmcgcGFyZW50IG9mIHRoZSBnaXZlbiBlbGVtZW50XG4gKiBAbWV0aG9kXG4gKiBAbWVtYmVyb2YgUG9wcGVyLlV0aWxzXG4gKiBAYXJndW1lbnQge0VsZW1lbnR9IGVsZW1lbnRcbiAqIEByZXR1cm5zIHtFbGVtZW50fSBzY3JvbGwgcGFyZW50XG4gKi9cbmZ1bmN0aW9uIGdldFNjcm9sbFBhcmVudChlbGVtZW50KSB7XG4gIC8vIFJldHVybiBib2R5LCBgZ2V0U2Nyb2xsYCB3aWxsIHRha2UgY2FyZSB0byBnZXQgdGhlIGNvcnJlY3QgYHNjcm9sbFRvcGAgZnJvbSBpdFxuICBpZiAoIWVsZW1lbnQpIHtcbiAgICByZXR1cm4gZG9jdW1lbnQuYm9keTtcbiAgfVxuXG4gIHN3aXRjaCAoZWxlbWVudC5ub2RlTmFtZSkge1xuICAgIGNhc2UgJ0hUTUwnOlxuICAgIGNhc2UgJ0JPRFknOlxuICAgICAgcmV0dXJuIGVsZW1lbnQub3duZXJEb2N1bWVudC5ib2R5O1xuICAgIGNhc2UgJyNkb2N1bWVudCc6XG4gICAgICByZXR1cm4gZWxlbWVudC5ib2R5O1xuICB9XG5cbiAgLy8gRmlyZWZveCB3YW50IHVzIHRvIGNoZWNrIGAteGAgYW5kIGAteWAgdmFyaWF0aW9ucyBhcyB3ZWxsXG5cbiAgdmFyIF9nZXRTdHlsZUNvbXB1dGVkUHJvcCA9IGdldFN0eWxlQ29tcHV0ZWRQcm9wZXJ0eShlbGVtZW50KSxcbiAgICAgIG92ZXJmbG93ID0gX2dldFN0eWxlQ29tcHV0ZWRQcm9wLm92ZXJmbG93LFxuICAgICAgb3ZlcmZsb3dYID0gX2dldFN0eWxlQ29tcHV0ZWRQcm9wLm92ZXJmbG93WCxcbiAgICAgIG92ZXJmbG93WSA9IF9nZXRTdHlsZUNvbXB1dGVkUHJvcC5vdmVyZmxvd1k7XG5cbiAgaWYgKC8oYXV0b3xzY3JvbGx8b3ZlcmxheSkvLnRlc3Qob3ZlcmZsb3cgKyBvdmVyZmxvd1kgKyBvdmVyZmxvd1gpKSB7XG4gICAgcmV0dXJuIGVsZW1lbnQ7XG4gIH1cblxuICByZXR1cm4gZ2V0U2Nyb2xsUGFyZW50KGdldFBhcmVudE5vZGUoZWxlbWVudCkpO1xufVxuXG52YXIgaXNJRTExID0gaXNCcm93c2VyICYmICEhKHdpbmRvdy5NU0lucHV0TWV0aG9kQ29udGV4dCAmJiBkb2N1bWVudC5kb2N1bWVudE1vZGUpO1xudmFyIGlzSUUxMCA9IGlzQnJvd3NlciAmJiAvTVNJRSAxMC8udGVzdChuYXZpZ2F0b3IudXNlckFnZW50KTtcblxuLyoqXG4gKiBEZXRlcm1pbmVzIGlmIHRoZSBicm93c2VyIGlzIEludGVybmV0IEV4cGxvcmVyXG4gKiBAbWV0aG9kXG4gKiBAbWVtYmVyb2YgUG9wcGVyLlV0aWxzXG4gKiBAcGFyYW0ge051bWJlcn0gdmVyc2lvbiB0byBjaGVja1xuICogQHJldHVybnMge0Jvb2xlYW59IGlzSUVcbiAqL1xuZnVuY3Rpb24gaXNJRSh2ZXJzaW9uKSB7XG4gIGlmICh2ZXJzaW9uID09PSAxMSkge1xuICAgIHJldHVybiBpc0lFMTE7XG4gIH1cbiAgaWYgKHZlcnNpb24gPT09IDEwKSB7XG4gICAgcmV0dXJuIGlzSUUxMDtcbiAgfVxuICByZXR1cm4gaXNJRTExIHx8IGlzSUUxMDtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIHRoZSBvZmZzZXQgcGFyZW50IG9mIHRoZSBnaXZlbiBlbGVtZW50XG4gKiBAbWV0aG9kXG4gKiBAbWVtYmVyb2YgUG9wcGVyLlV0aWxzXG4gKiBAYXJndW1lbnQge0VsZW1lbnR9IGVsZW1lbnRcbiAqIEByZXR1cm5zIHtFbGVtZW50fSBvZmZzZXQgcGFyZW50XG4gKi9cbmZ1bmN0aW9uIGdldE9mZnNldFBhcmVudChlbGVtZW50KSB7XG4gIGlmICghZWxlbWVudCkge1xuICAgIHJldHVybiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7XG4gIH1cblxuICB2YXIgbm9PZmZzZXRQYXJlbnQgPSBpc0lFKDEwKSA/IGRvY3VtZW50LmJvZHkgOiBudWxsO1xuXG4gIC8vIE5PVEU6IDEgRE9NIGFjY2VzcyBoZXJlXG4gIHZhciBvZmZzZXRQYXJlbnQgPSBlbGVtZW50Lm9mZnNldFBhcmVudCB8fCBudWxsO1xuICAvLyBTa2lwIGhpZGRlbiBlbGVtZW50cyB3aGljaCBkb24ndCBoYXZlIGFuIG9mZnNldFBhcmVudFxuICB3aGlsZSAob2Zmc2V0UGFyZW50ID09PSBub09mZnNldFBhcmVudCAmJiBlbGVtZW50Lm5leHRFbGVtZW50U2libGluZykge1xuICAgIG9mZnNldFBhcmVudCA9IChlbGVtZW50ID0gZWxlbWVudC5uZXh0RWxlbWVudFNpYmxpbmcpLm9mZnNldFBhcmVudDtcbiAgfVxuXG4gIHZhciBub2RlTmFtZSA9IG9mZnNldFBhcmVudCAmJiBvZmZzZXRQYXJlbnQubm9kZU5hbWU7XG5cbiAgaWYgKCFub2RlTmFtZSB8fCBub2RlTmFtZSA9PT0gJ0JPRFknIHx8IG5vZGVOYW1lID09PSAnSFRNTCcpIHtcbiAgICByZXR1cm4gZWxlbWVudCA/IGVsZW1lbnQub3duZXJEb2N1bWVudC5kb2N1bWVudEVsZW1lbnQgOiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7XG4gIH1cblxuICAvLyAub2Zmc2V0UGFyZW50IHdpbGwgcmV0dXJuIHRoZSBjbG9zZXN0IFRILCBURCBvciBUQUJMRSBpbiBjYXNlXG4gIC8vIG5vIG9mZnNldFBhcmVudCBpcyBwcmVzZW50LCBJIGhhdGUgdGhpcyBqb2IuLi5cbiAgaWYgKFsnVEgnLCAnVEQnLCAnVEFCTEUnXS5pbmRleE9mKG9mZnNldFBhcmVudC5ub2RlTmFtZSkgIT09IC0xICYmIGdldFN0eWxlQ29tcHV0ZWRQcm9wZXJ0eShvZmZzZXRQYXJlbnQsICdwb3NpdGlvbicpID09PSAnc3RhdGljJykge1xuICAgIHJldHVybiBnZXRPZmZzZXRQYXJlbnQob2Zmc2V0UGFyZW50KTtcbiAgfVxuXG4gIHJldHVybiBvZmZzZXRQYXJlbnQ7XG59XG5cbmZ1bmN0aW9uIGlzT2Zmc2V0Q29udGFpbmVyKGVsZW1lbnQpIHtcbiAgdmFyIG5vZGVOYW1lID0gZWxlbWVudC5ub2RlTmFtZTtcblxuICBpZiAobm9kZU5hbWUgPT09ICdCT0RZJykge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICByZXR1cm4gbm9kZU5hbWUgPT09ICdIVE1MJyB8fCBnZXRPZmZzZXRQYXJlbnQoZWxlbWVudC5maXJzdEVsZW1lbnRDaGlsZCkgPT09IGVsZW1lbnQ7XG59XG5cbi8qKlxuICogRmluZHMgdGhlIHJvb3Qgbm9kZSAoZG9jdW1lbnQsIHNoYWRvd0RPTSByb290KSBvZiB0aGUgZ2l2ZW4gZWxlbWVudFxuICogQG1ldGhvZFxuICogQG1lbWJlcm9mIFBvcHBlci5VdGlsc1xuICogQGFyZ3VtZW50IHtFbGVtZW50fSBub2RlXG4gKiBAcmV0dXJucyB7RWxlbWVudH0gcm9vdCBub2RlXG4gKi9cbmZ1bmN0aW9uIGdldFJvb3Qobm9kZSkge1xuICBpZiAobm9kZS5wYXJlbnROb2RlICE9PSBudWxsKSB7XG4gICAgcmV0dXJuIGdldFJvb3Qobm9kZS5wYXJlbnROb2RlKTtcbiAgfVxuXG4gIHJldHVybiBub2RlO1xufVxuXG4vKipcbiAqIEZpbmRzIHRoZSBvZmZzZXQgcGFyZW50IGNvbW1vbiB0byB0aGUgdHdvIHByb3ZpZGVkIG5vZGVzXG4gKiBAbWV0aG9kXG4gKiBAbWVtYmVyb2YgUG9wcGVyLlV0aWxzXG4gKiBAYXJndW1lbnQge0VsZW1lbnR9IGVsZW1lbnQxXG4gKiBAYXJndW1lbnQge0VsZW1lbnR9IGVsZW1lbnQyXG4gKiBAcmV0dXJucyB7RWxlbWVudH0gY29tbW9uIG9mZnNldCBwYXJlbnRcbiAqL1xuZnVuY3Rpb24gZmluZENvbW1vbk9mZnNldFBhcmVudChlbGVtZW50MSwgZWxlbWVudDIpIHtcbiAgLy8gVGhpcyBjaGVjayBpcyBuZWVkZWQgdG8gYXZvaWQgZXJyb3JzIGluIGNhc2Ugb25lIG9mIHRoZSBlbGVtZW50cyBpc24ndCBkZWZpbmVkIGZvciBhbnkgcmVhc29uXG4gIGlmICghZWxlbWVudDEgfHwgIWVsZW1lbnQxLm5vZGVUeXBlIHx8ICFlbGVtZW50MiB8fCAhZWxlbWVudDIubm9kZVR5cGUpIHtcbiAgICByZXR1cm4gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50O1xuICB9XG5cbiAgLy8gSGVyZSB3ZSBtYWtlIHN1cmUgdG8gZ2l2ZSBhcyBcInN0YXJ0XCIgdGhlIGVsZW1lbnQgdGhhdCBjb21lcyBmaXJzdCBpbiB0aGUgRE9NXG4gIHZhciBvcmRlciA9IGVsZW1lbnQxLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uKGVsZW1lbnQyKSAmIE5vZGUuRE9DVU1FTlRfUE9TSVRJT05fRk9MTE9XSU5HO1xuICB2YXIgc3RhcnQgPSBvcmRlciA/IGVsZW1lbnQxIDogZWxlbWVudDI7XG4gIHZhciBlbmQgPSBvcmRlciA/IGVsZW1lbnQyIDogZWxlbWVudDE7XG5cbiAgLy8gR2V0IGNvbW1vbiBhbmNlc3RvciBjb250YWluZXJcbiAgdmFyIHJhbmdlID0gZG9jdW1lbnQuY3JlYXRlUmFuZ2UoKTtcbiAgcmFuZ2Uuc2V0U3RhcnQoc3RhcnQsIDApO1xuICByYW5nZS5zZXRFbmQoZW5kLCAwKTtcbiAgdmFyIGNvbW1vbkFuY2VzdG9yQ29udGFpbmVyID0gcmFuZ2UuY29tbW9uQW5jZXN0b3JDb250YWluZXI7XG5cbiAgLy8gQm90aCBub2RlcyBhcmUgaW5zaWRlICNkb2N1bWVudFxuXG4gIGlmIChlbGVtZW50MSAhPT0gY29tbW9uQW5jZXN0b3JDb250YWluZXIgJiYgZWxlbWVudDIgIT09IGNvbW1vbkFuY2VzdG9yQ29udGFpbmVyIHx8IHN0YXJ0LmNvbnRhaW5zKGVuZCkpIHtcbiAgICBpZiAoaXNPZmZzZXRDb250YWluZXIoY29tbW9uQW5jZXN0b3JDb250YWluZXIpKSB7XG4gICAgICByZXR1cm4gY29tbW9uQW5jZXN0b3JDb250YWluZXI7XG4gICAgfVxuXG4gICAgcmV0dXJuIGdldE9mZnNldFBhcmVudChjb21tb25BbmNlc3RvckNvbnRhaW5lcik7XG4gIH1cblxuICAvLyBvbmUgb2YgdGhlIG5vZGVzIGlzIGluc2lkZSBzaGFkb3dET00sIGZpbmQgd2hpY2ggb25lXG4gIHZhciBlbGVtZW50MXJvb3QgPSBnZXRSb290KGVsZW1lbnQxKTtcbiAgaWYgKGVsZW1lbnQxcm9vdC5ob3N0KSB7XG4gICAgcmV0dXJuIGZpbmRDb21tb25PZmZzZXRQYXJlbnQoZWxlbWVudDFyb290Lmhvc3QsIGVsZW1lbnQyKTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gZmluZENvbW1vbk9mZnNldFBhcmVudChlbGVtZW50MSwgZ2V0Um9vdChlbGVtZW50MikuaG9zdCk7XG4gIH1cbn1cblxuLyoqXG4gKiBHZXRzIHRoZSBzY3JvbGwgdmFsdWUgb2YgdGhlIGdpdmVuIGVsZW1lbnQgaW4gdGhlIGdpdmVuIHNpZGUgKHRvcCBhbmQgbGVmdClcbiAqIEBtZXRob2RcbiAqIEBtZW1iZXJvZiBQb3BwZXIuVXRpbHNcbiAqIEBhcmd1bWVudCB7RWxlbWVudH0gZWxlbWVudFxuICogQGFyZ3VtZW50IHtTdHJpbmd9IHNpZGUgYHRvcGAgb3IgYGxlZnRgXG4gKiBAcmV0dXJucyB7bnVtYmVyfSBhbW91bnQgb2Ygc2Nyb2xsZWQgcGl4ZWxzXG4gKi9cbmZ1bmN0aW9uIGdldFNjcm9sbChlbGVtZW50KSB7XG4gIHZhciBzaWRlID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiAndG9wJztcblxuICB2YXIgdXBwZXJTaWRlID0gc2lkZSA9PT0gJ3RvcCcgPyAnc2Nyb2xsVG9wJyA6ICdzY3JvbGxMZWZ0JztcbiAgdmFyIG5vZGVOYW1lID0gZWxlbWVudC5ub2RlTmFtZTtcblxuICBpZiAobm9kZU5hbWUgPT09ICdCT0RZJyB8fCBub2RlTmFtZSA9PT0gJ0hUTUwnKSB7XG4gICAgdmFyIGh0bWwgPSBlbGVtZW50Lm93bmVyRG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50O1xuICAgIHZhciBzY3JvbGxpbmdFbGVtZW50ID0gZWxlbWVudC5vd25lckRvY3VtZW50LnNjcm9sbGluZ0VsZW1lbnQgfHwgaHRtbDtcbiAgICByZXR1cm4gc2Nyb2xsaW5nRWxlbWVudFt1cHBlclNpZGVdO1xuICB9XG5cbiAgcmV0dXJuIGVsZW1lbnRbdXBwZXJTaWRlXTtcbn1cblxuLypcbiAqIFN1bSBvciBzdWJ0cmFjdCB0aGUgZWxlbWVudCBzY3JvbGwgdmFsdWVzIChsZWZ0IGFuZCB0b3ApIGZyb20gYSBnaXZlbiByZWN0IG9iamVjdFxuICogQG1ldGhvZFxuICogQG1lbWJlcm9mIFBvcHBlci5VdGlsc1xuICogQHBhcmFtIHtPYmplY3R9IHJlY3QgLSBSZWN0IG9iamVjdCB5b3Ugd2FudCB0byBjaGFuZ2VcbiAqIEBwYXJhbSB7SFRNTEVsZW1lbnR9IGVsZW1lbnQgLSBUaGUgZWxlbWVudCBmcm9tIHRoZSBmdW5jdGlvbiByZWFkcyB0aGUgc2Nyb2xsIHZhbHVlc1xuICogQHBhcmFtIHtCb29sZWFufSBzdWJ0cmFjdCAtIHNldCB0byB0cnVlIGlmIHlvdSB3YW50IHRvIHN1YnRyYWN0IHRoZSBzY3JvbGwgdmFsdWVzXG4gKiBAcmV0dXJuIHtPYmplY3R9IHJlY3QgLSBUaGUgbW9kaWZpZXIgcmVjdCBvYmplY3RcbiAqL1xuZnVuY3Rpb24gaW5jbHVkZVNjcm9sbChyZWN0LCBlbGVtZW50KSB7XG4gIHZhciBzdWJ0cmFjdCA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzJdIDogZmFsc2U7XG5cbiAgdmFyIHNjcm9sbFRvcCA9IGdldFNjcm9sbChlbGVtZW50LCAndG9wJyk7XG4gIHZhciBzY3JvbGxMZWZ0ID0gZ2V0U2Nyb2xsKGVsZW1lbnQsICdsZWZ0Jyk7XG4gIHZhciBtb2RpZmllciA9IHN1YnRyYWN0ID8gLTEgOiAxO1xuICByZWN0LnRvcCArPSBzY3JvbGxUb3AgKiBtb2RpZmllcjtcbiAgcmVjdC5ib3R0b20gKz0gc2Nyb2xsVG9wICogbW9kaWZpZXI7XG4gIHJlY3QubGVmdCArPSBzY3JvbGxMZWZ0ICogbW9kaWZpZXI7XG4gIHJlY3QucmlnaHQgKz0gc2Nyb2xsTGVmdCAqIG1vZGlmaWVyO1xuICByZXR1cm4gcmVjdDtcbn1cblxuLypcbiAqIEhlbHBlciB0byBkZXRlY3QgYm9yZGVycyBvZiBhIGdpdmVuIGVsZW1lbnRcbiAqIEBtZXRob2RcbiAqIEBtZW1iZXJvZiBQb3BwZXIuVXRpbHNcbiAqIEBwYXJhbSB7Q1NTU3R5bGVEZWNsYXJhdGlvbn0gc3R5bGVzXG4gKiBSZXN1bHQgb2YgYGdldFN0eWxlQ29tcHV0ZWRQcm9wZXJ0eWAgb24gdGhlIGdpdmVuIGVsZW1lbnRcbiAqIEBwYXJhbSB7U3RyaW5nfSBheGlzIC0gYHhgIG9yIGB5YFxuICogQHJldHVybiB7bnVtYmVyfSBib3JkZXJzIC0gVGhlIGJvcmRlcnMgc2l6ZSBvZiB0aGUgZ2l2ZW4gYXhpc1xuICovXG5cbmZ1bmN0aW9uIGdldEJvcmRlcnNTaXplKHN0eWxlcywgYXhpcykge1xuICB2YXIgc2lkZUEgPSBheGlzID09PSAneCcgPyAnTGVmdCcgOiAnVG9wJztcbiAgdmFyIHNpZGVCID0gc2lkZUEgPT09ICdMZWZ0JyA/ICdSaWdodCcgOiAnQm90dG9tJztcblxuICByZXR1cm4gcGFyc2VGbG9hdChzdHlsZXNbJ2JvcmRlcicgKyBzaWRlQSArICdXaWR0aCddLCAxMCkgKyBwYXJzZUZsb2F0KHN0eWxlc1snYm9yZGVyJyArIHNpZGVCICsgJ1dpZHRoJ10sIDEwKTtcbn1cblxuZnVuY3Rpb24gZ2V0U2l6ZShheGlzLCBib2R5LCBodG1sLCBjb21wdXRlZFN0eWxlKSB7XG4gIHJldHVybiBNYXRoLm1heChib2R5WydvZmZzZXQnICsgYXhpc10sIGJvZHlbJ3Njcm9sbCcgKyBheGlzXSwgaHRtbFsnY2xpZW50JyArIGF4aXNdLCBodG1sWydvZmZzZXQnICsgYXhpc10sIGh0bWxbJ3Njcm9sbCcgKyBheGlzXSwgaXNJRSgxMCkgPyBwYXJzZUludChodG1sWydvZmZzZXQnICsgYXhpc10pICsgcGFyc2VJbnQoY29tcHV0ZWRTdHlsZVsnbWFyZ2luJyArIChheGlzID09PSAnSGVpZ2h0JyA/ICdUb3AnIDogJ0xlZnQnKV0pICsgcGFyc2VJbnQoY29tcHV0ZWRTdHlsZVsnbWFyZ2luJyArIChheGlzID09PSAnSGVpZ2h0JyA/ICdCb3R0b20nIDogJ1JpZ2h0JyldKSA6IDApO1xufVxuXG5mdW5jdGlvbiBnZXRXaW5kb3dTaXplcyhkb2N1bWVudCkge1xuICB2YXIgYm9keSA9IGRvY3VtZW50LmJvZHk7XG4gIHZhciBodG1sID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50O1xuICB2YXIgY29tcHV0ZWRTdHlsZSA9IGlzSUUoMTApICYmIGdldENvbXB1dGVkU3R5bGUoaHRtbCk7XG5cbiAgcmV0dXJuIHtcbiAgICBoZWlnaHQ6IGdldFNpemUoJ0hlaWdodCcsIGJvZHksIGh0bWwsIGNvbXB1dGVkU3R5bGUpLFxuICAgIHdpZHRoOiBnZXRTaXplKCdXaWR0aCcsIGJvZHksIGh0bWwsIGNvbXB1dGVkU3R5bGUpXG4gIH07XG59XG5cbnZhciBjbGFzc0NhbGxDaGVjayA9IGZ1bmN0aW9uIChpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHtcbiAgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHtcbiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uXCIpO1xuICB9XG59O1xuXG52YXIgY3JlYXRlQ2xhc3MgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykge1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHtcbiAgICAgIHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07XG4gICAgICBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7XG4gICAgICBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7XG4gICAgICBpZiAoXCJ2YWx1ZVwiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlO1xuICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBmdW5jdGlvbiAoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7XG4gICAgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTtcbiAgICBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTtcbiAgICByZXR1cm4gQ29uc3RydWN0b3I7XG4gIH07XG59KCk7XG5cblxuXG5cblxudmFyIGRlZmluZVByb3BlcnR5ID0gZnVuY3Rpb24gKG9iaiwga2V5LCB2YWx1ZSkge1xuICBpZiAoa2V5IGluIG9iaikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwge1xuICAgICAgdmFsdWU6IHZhbHVlLFxuICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgIHdyaXRhYmxlOiB0cnVlXG4gICAgfSk7XG4gIH0gZWxzZSB7XG4gICAgb2JqW2tleV0gPSB2YWx1ZTtcbiAgfVxuXG4gIHJldHVybiBvYmo7XG59O1xuXG52YXIgX2V4dGVuZHMgPSBPYmplY3QuYXNzaWduIHx8IGZ1bmN0aW9uICh0YXJnZXQpIHtcbiAgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHtcbiAgICB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldO1xuXG4gICAgZm9yICh2YXIga2V5IGluIHNvdXJjZSkge1xuICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzb3VyY2UsIGtleSkpIHtcbiAgICAgICAgdGFyZ2V0W2tleV0gPSBzb3VyY2Vba2V5XTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICByZXR1cm4gdGFyZ2V0O1xufTtcblxuLyoqXG4gKiBHaXZlbiBlbGVtZW50IG9mZnNldHMsIGdlbmVyYXRlIGFuIG91dHB1dCBzaW1pbGFyIHRvIGdldEJvdW5kaW5nQ2xpZW50UmVjdFxuICogQG1ldGhvZFxuICogQG1lbWJlcm9mIFBvcHBlci5VdGlsc1xuICogQGFyZ3VtZW50IHtPYmplY3R9IG9mZnNldHNcbiAqIEByZXR1cm5zIHtPYmplY3R9IENsaWVudFJlY3QgbGlrZSBvdXRwdXRcbiAqL1xuZnVuY3Rpb24gZ2V0Q2xpZW50UmVjdChvZmZzZXRzKSB7XG4gIHJldHVybiBfZXh0ZW5kcyh7fSwgb2Zmc2V0cywge1xuICAgIHJpZ2h0OiBvZmZzZXRzLmxlZnQgKyBvZmZzZXRzLndpZHRoLFxuICAgIGJvdHRvbTogb2Zmc2V0cy50b3AgKyBvZmZzZXRzLmhlaWdodFxuICB9KTtcbn1cblxuLyoqXG4gKiBHZXQgYm91bmRpbmcgY2xpZW50IHJlY3Qgb2YgZ2l2ZW4gZWxlbWVudFxuICogQG1ldGhvZFxuICogQG1lbWJlcm9mIFBvcHBlci5VdGlsc1xuICogQHBhcmFtIHtIVE1MRWxlbWVudH0gZWxlbWVudFxuICogQHJldHVybiB7T2JqZWN0fSBjbGllbnQgcmVjdFxuICovXG5mdW5jdGlvbiBnZXRCb3VuZGluZ0NsaWVudFJlY3QoZWxlbWVudCkge1xuICB2YXIgcmVjdCA9IHt9O1xuXG4gIC8vIElFMTAgMTAgRklYOiBQbGVhc2UsIGRvbid0IGFzaywgdGhlIGVsZW1lbnQgaXNuJ3RcbiAgLy8gY29uc2lkZXJlZCBpbiBET00gaW4gc29tZSBjaXJjdW1zdGFuY2VzLi4uXG4gIC8vIFRoaXMgaXNuJ3QgcmVwcm9kdWNpYmxlIGluIElFMTAgY29tcGF0aWJpbGl0eSBtb2RlIG9mIElFMTFcbiAgdHJ5IHtcbiAgICBpZiAoaXNJRSgxMCkpIHtcbiAgICAgIHJlY3QgPSBlbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgdmFyIHNjcm9sbFRvcCA9IGdldFNjcm9sbChlbGVtZW50LCAndG9wJyk7XG4gICAgICB2YXIgc2Nyb2xsTGVmdCA9IGdldFNjcm9sbChlbGVtZW50LCAnbGVmdCcpO1xuICAgICAgcmVjdC50b3AgKz0gc2Nyb2xsVG9wO1xuICAgICAgcmVjdC5sZWZ0ICs9IHNjcm9sbExlZnQ7XG4gICAgICByZWN0LmJvdHRvbSArPSBzY3JvbGxUb3A7XG4gICAgICByZWN0LnJpZ2h0ICs9IHNjcm9sbExlZnQ7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJlY3QgPSBlbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgIH1cbiAgfSBjYXRjaCAoZSkge31cblxuICB2YXIgcmVzdWx0ID0ge1xuICAgIGxlZnQ6IHJlY3QubGVmdCxcbiAgICB0b3A6IHJlY3QudG9wLFxuICAgIHdpZHRoOiByZWN0LnJpZ2h0IC0gcmVjdC5sZWZ0LFxuICAgIGhlaWdodDogcmVjdC5ib3R0b20gLSByZWN0LnRvcFxuICB9O1xuXG4gIC8vIHN1YnRyYWN0IHNjcm9sbGJhciBzaXplIGZyb20gc2l6ZXNcbiAgdmFyIHNpemVzID0gZWxlbWVudC5ub2RlTmFtZSA9PT0gJ0hUTUwnID8gZ2V0V2luZG93U2l6ZXMoZWxlbWVudC5vd25lckRvY3VtZW50KSA6IHt9O1xuICB2YXIgd2lkdGggPSBzaXplcy53aWR0aCB8fCBlbGVtZW50LmNsaWVudFdpZHRoIHx8IHJlc3VsdC5yaWdodCAtIHJlc3VsdC5sZWZ0O1xuICB2YXIgaGVpZ2h0ID0gc2l6ZXMuaGVpZ2h0IHx8IGVsZW1lbnQuY2xpZW50SGVpZ2h0IHx8IHJlc3VsdC5ib3R0b20gLSByZXN1bHQudG9wO1xuXG4gIHZhciBob3JpelNjcm9sbGJhciA9IGVsZW1lbnQub2Zmc2V0V2lkdGggLSB3aWR0aDtcbiAgdmFyIHZlcnRTY3JvbGxiYXIgPSBlbGVtZW50Lm9mZnNldEhlaWdodCAtIGhlaWdodDtcblxuICAvLyBpZiBhbiBoeXBvdGhldGljYWwgc2Nyb2xsYmFyIGlzIGRldGVjdGVkLCB3ZSBtdXN0IGJlIHN1cmUgaXQncyBub3QgYSBgYm9yZGVyYFxuICAvLyB3ZSBtYWtlIHRoaXMgY2hlY2sgY29uZGl0aW9uYWwgZm9yIHBlcmZvcm1hbmNlIHJlYXNvbnNcbiAgaWYgKGhvcml6U2Nyb2xsYmFyIHx8IHZlcnRTY3JvbGxiYXIpIHtcbiAgICB2YXIgc3R5bGVzID0gZ2V0U3R5bGVDb21wdXRlZFByb3BlcnR5KGVsZW1lbnQpO1xuICAgIGhvcml6U2Nyb2xsYmFyIC09IGdldEJvcmRlcnNTaXplKHN0eWxlcywgJ3gnKTtcbiAgICB2ZXJ0U2Nyb2xsYmFyIC09IGdldEJvcmRlcnNTaXplKHN0eWxlcywgJ3knKTtcblxuICAgIHJlc3VsdC53aWR0aCAtPSBob3JpelNjcm9sbGJhcjtcbiAgICByZXN1bHQuaGVpZ2h0IC09IHZlcnRTY3JvbGxiYXI7XG4gIH1cblxuICByZXR1cm4gZ2V0Q2xpZW50UmVjdChyZXN1bHQpO1xufVxuXG5mdW5jdGlvbiBnZXRPZmZzZXRSZWN0UmVsYXRpdmVUb0FyYml0cmFyeU5vZGUoY2hpbGRyZW4sIHBhcmVudCkge1xuICB2YXIgZml4ZWRQb3NpdGlvbiA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzJdIDogZmFsc2U7XG5cbiAgdmFyIGlzSUUxMCA9IGlzSUUoMTApO1xuICB2YXIgaXNIVE1MID0gcGFyZW50Lm5vZGVOYW1lID09PSAnSFRNTCc7XG4gIHZhciBjaGlsZHJlblJlY3QgPSBnZXRCb3VuZGluZ0NsaWVudFJlY3QoY2hpbGRyZW4pO1xuICB2YXIgcGFyZW50UmVjdCA9IGdldEJvdW5kaW5nQ2xpZW50UmVjdChwYXJlbnQpO1xuICB2YXIgc2Nyb2xsUGFyZW50ID0gZ2V0U2Nyb2xsUGFyZW50KGNoaWxkcmVuKTtcblxuICB2YXIgc3R5bGVzID0gZ2V0U3R5bGVDb21wdXRlZFByb3BlcnR5KHBhcmVudCk7XG4gIHZhciBib3JkZXJUb3BXaWR0aCA9IHBhcnNlRmxvYXQoc3R5bGVzLmJvcmRlclRvcFdpZHRoLCAxMCk7XG4gIHZhciBib3JkZXJMZWZ0V2lkdGggPSBwYXJzZUZsb2F0KHN0eWxlcy5ib3JkZXJMZWZ0V2lkdGgsIDEwKTtcblxuICAvLyBJbiBjYXNlcyB3aGVyZSB0aGUgcGFyZW50IGlzIGZpeGVkLCB3ZSBtdXN0IGlnbm9yZSBuZWdhdGl2ZSBzY3JvbGwgaW4gb2Zmc2V0IGNhbGNcbiAgaWYgKGZpeGVkUG9zaXRpb24gJiYgaXNIVE1MKSB7XG4gICAgcGFyZW50UmVjdC50b3AgPSBNYXRoLm1heChwYXJlbnRSZWN0LnRvcCwgMCk7XG4gICAgcGFyZW50UmVjdC5sZWZ0ID0gTWF0aC5tYXgocGFyZW50UmVjdC5sZWZ0LCAwKTtcbiAgfVxuICB2YXIgb2Zmc2V0cyA9IGdldENsaWVudFJlY3Qoe1xuICAgIHRvcDogY2hpbGRyZW5SZWN0LnRvcCAtIHBhcmVudFJlY3QudG9wIC0gYm9yZGVyVG9wV2lkdGgsXG4gICAgbGVmdDogY2hpbGRyZW5SZWN0LmxlZnQgLSBwYXJlbnRSZWN0LmxlZnQgLSBib3JkZXJMZWZ0V2lkdGgsXG4gICAgd2lkdGg6IGNoaWxkcmVuUmVjdC53aWR0aCxcbiAgICBoZWlnaHQ6IGNoaWxkcmVuUmVjdC5oZWlnaHRcbiAgfSk7XG4gIG9mZnNldHMubWFyZ2luVG9wID0gMDtcbiAgb2Zmc2V0cy5tYXJnaW5MZWZ0ID0gMDtcblxuICAvLyBTdWJ0cmFjdCBtYXJnaW5zIG9mIGRvY3VtZW50RWxlbWVudCBpbiBjYXNlIGl0J3MgYmVpbmcgdXNlZCBhcyBwYXJlbnRcbiAgLy8gd2UgZG8gdGhpcyBvbmx5IG9uIEhUTUwgYmVjYXVzZSBpdCdzIHRoZSBvbmx5IGVsZW1lbnQgdGhhdCBiZWhhdmVzXG4gIC8vIGRpZmZlcmVudGx5IHdoZW4gbWFyZ2lucyBhcmUgYXBwbGllZCB0byBpdC4gVGhlIG1hcmdpbnMgYXJlIGluY2x1ZGVkIGluXG4gIC8vIHRoZSBib3ggb2YgdGhlIGRvY3VtZW50RWxlbWVudCwgaW4gdGhlIG90aGVyIGNhc2VzIG5vdC5cbiAgaWYgKCFpc0lFMTAgJiYgaXNIVE1MKSB7XG4gICAgdmFyIG1hcmdpblRvcCA9IHBhcnNlRmxvYXQoc3R5bGVzLm1hcmdpblRvcCwgMTApO1xuICAgIHZhciBtYXJnaW5MZWZ0ID0gcGFyc2VGbG9hdChzdHlsZXMubWFyZ2luTGVmdCwgMTApO1xuXG4gICAgb2Zmc2V0cy50b3AgLT0gYm9yZGVyVG9wV2lkdGggLSBtYXJnaW5Ub3A7XG4gICAgb2Zmc2V0cy5ib3R0b20gLT0gYm9yZGVyVG9wV2lkdGggLSBtYXJnaW5Ub3A7XG4gICAgb2Zmc2V0cy5sZWZ0IC09IGJvcmRlckxlZnRXaWR0aCAtIG1hcmdpbkxlZnQ7XG4gICAgb2Zmc2V0cy5yaWdodCAtPSBib3JkZXJMZWZ0V2lkdGggLSBtYXJnaW5MZWZ0O1xuXG4gICAgLy8gQXR0YWNoIG1hcmdpblRvcCBhbmQgbWFyZ2luTGVmdCBiZWNhdXNlIGluIHNvbWUgY2lyY3Vtc3RhbmNlcyB3ZSBtYXkgbmVlZCB0aGVtXG4gICAgb2Zmc2V0cy5tYXJnaW5Ub3AgPSBtYXJnaW5Ub3A7XG4gICAgb2Zmc2V0cy5tYXJnaW5MZWZ0ID0gbWFyZ2luTGVmdDtcbiAgfVxuXG4gIGlmIChpc0lFMTAgJiYgIWZpeGVkUG9zaXRpb24gPyBwYXJlbnQuY29udGFpbnMoc2Nyb2xsUGFyZW50KSA6IHBhcmVudCA9PT0gc2Nyb2xsUGFyZW50ICYmIHNjcm9sbFBhcmVudC5ub2RlTmFtZSAhPT0gJ0JPRFknKSB7XG4gICAgb2Zmc2V0cyA9IGluY2x1ZGVTY3JvbGwob2Zmc2V0cywgcGFyZW50KTtcbiAgfVxuXG4gIHJldHVybiBvZmZzZXRzO1xufVxuXG5mdW5jdGlvbiBnZXRWaWV3cG9ydE9mZnNldFJlY3RSZWxhdGl2ZVRvQXJ0Yml0cmFyeU5vZGUoZWxlbWVudCkge1xuICB2YXIgZXhjbHVkZVNjcm9sbCA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogZmFsc2U7XG5cbiAgdmFyIGh0bWwgPSBlbGVtZW50Lm93bmVyRG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50O1xuICB2YXIgcmVsYXRpdmVPZmZzZXQgPSBnZXRPZmZzZXRSZWN0UmVsYXRpdmVUb0FyYml0cmFyeU5vZGUoZWxlbWVudCwgaHRtbCk7XG4gIHZhciB3aWR0aCA9IE1hdGgubWF4KGh0bWwuY2xpZW50V2lkdGgsIHdpbmRvdy5pbm5lcldpZHRoIHx8IDApO1xuICB2YXIgaGVpZ2h0ID0gTWF0aC5tYXgoaHRtbC5jbGllbnRIZWlnaHQsIHdpbmRvdy5pbm5lckhlaWdodCB8fCAwKTtcblxuICB2YXIgc2Nyb2xsVG9wID0gIWV4Y2x1ZGVTY3JvbGwgPyBnZXRTY3JvbGwoaHRtbCkgOiAwO1xuICB2YXIgc2Nyb2xsTGVmdCA9ICFleGNsdWRlU2Nyb2xsID8gZ2V0U2Nyb2xsKGh0bWwsICdsZWZ0JykgOiAwO1xuXG4gIHZhciBvZmZzZXQgPSB7XG4gICAgdG9wOiBzY3JvbGxUb3AgLSByZWxhdGl2ZU9mZnNldC50b3AgKyByZWxhdGl2ZU9mZnNldC5tYXJnaW5Ub3AsXG4gICAgbGVmdDogc2Nyb2xsTGVmdCAtIHJlbGF0aXZlT2Zmc2V0LmxlZnQgKyByZWxhdGl2ZU9mZnNldC5tYXJnaW5MZWZ0LFxuICAgIHdpZHRoOiB3aWR0aCxcbiAgICBoZWlnaHQ6IGhlaWdodFxuICB9O1xuXG4gIHJldHVybiBnZXRDbGllbnRSZWN0KG9mZnNldCk7XG59XG5cbi8qKlxuICogQ2hlY2sgaWYgdGhlIGdpdmVuIGVsZW1lbnQgaXMgZml4ZWQgb3IgaXMgaW5zaWRlIGEgZml4ZWQgcGFyZW50XG4gKiBAbWV0aG9kXG4gKiBAbWVtYmVyb2YgUG9wcGVyLlV0aWxzXG4gKiBAYXJndW1lbnQge0VsZW1lbnR9IGVsZW1lbnRcbiAqIEBhcmd1bWVudCB7RWxlbWVudH0gY3VzdG9tQ29udGFpbmVyXG4gKiBAcmV0dXJucyB7Qm9vbGVhbn0gYW5zd2VyIHRvIFwiaXNGaXhlZD9cIlxuICovXG5mdW5jdGlvbiBpc0ZpeGVkKGVsZW1lbnQpIHtcbiAgdmFyIG5vZGVOYW1lID0gZWxlbWVudC5ub2RlTmFtZTtcbiAgaWYgKG5vZGVOYW1lID09PSAnQk9EWScgfHwgbm9kZU5hbWUgPT09ICdIVE1MJykge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICBpZiAoZ2V0U3R5bGVDb21wdXRlZFByb3BlcnR5KGVsZW1lbnQsICdwb3NpdGlvbicpID09PSAnZml4ZWQnKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgcmV0dXJuIGlzRml4ZWQoZ2V0UGFyZW50Tm9kZShlbGVtZW50KSk7XG59XG5cbi8qKlxuICogRmluZHMgdGhlIGZpcnN0IHBhcmVudCBvZiBhbiBlbGVtZW50IHRoYXQgaGFzIGEgdHJhbnNmb3JtZWQgcHJvcGVydHkgZGVmaW5lZFxuICogQG1ldGhvZFxuICogQG1lbWJlcm9mIFBvcHBlci5VdGlsc1xuICogQGFyZ3VtZW50IHtFbGVtZW50fSBlbGVtZW50XG4gKiBAcmV0dXJucyB7RWxlbWVudH0gZmlyc3QgdHJhbnNmb3JtZWQgcGFyZW50IG9yIGRvY3VtZW50RWxlbWVudFxuICovXG5cbmZ1bmN0aW9uIGdldEZpeGVkUG9zaXRpb25PZmZzZXRQYXJlbnQoZWxlbWVudCkge1xuICAvLyBUaGlzIGNoZWNrIGlzIG5lZWRlZCB0byBhdm9pZCBlcnJvcnMgaW4gY2FzZSBvbmUgb2YgdGhlIGVsZW1lbnRzIGlzbid0IGRlZmluZWQgZm9yIGFueSByZWFzb25cbiAgaWYgKCFlbGVtZW50IHx8ICFlbGVtZW50LnBhcmVudEVsZW1lbnQgfHwgaXNJRSgpKSB7XG4gICAgcmV0dXJuIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudDtcbiAgfVxuICB2YXIgZWwgPSBlbGVtZW50LnBhcmVudEVsZW1lbnQ7XG4gIHdoaWxlIChlbCAmJiBnZXRTdHlsZUNvbXB1dGVkUHJvcGVydHkoZWwsICd0cmFuc2Zvcm0nKSA9PT0gJ25vbmUnKSB7XG4gICAgZWwgPSBlbC5wYXJlbnRFbGVtZW50O1xuICB9XG4gIHJldHVybiBlbCB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7XG59XG5cbi8qKlxuICogQ29tcHV0ZWQgdGhlIGJvdW5kYXJpZXMgbGltaXRzIGFuZCByZXR1cm4gdGhlbVxuICogQG1ldGhvZFxuICogQG1lbWJlcm9mIFBvcHBlci5VdGlsc1xuICogQHBhcmFtIHtIVE1MRWxlbWVudH0gcG9wcGVyXG4gKiBAcGFyYW0ge0hUTUxFbGVtZW50fSByZWZlcmVuY2VcbiAqIEBwYXJhbSB7bnVtYmVyfSBwYWRkaW5nXG4gKiBAcGFyYW0ge0hUTUxFbGVtZW50fSBib3VuZGFyaWVzRWxlbWVudCAtIEVsZW1lbnQgdXNlZCB0byBkZWZpbmUgdGhlIGJvdW5kYXJpZXNcbiAqIEBwYXJhbSB7Qm9vbGVhbn0gZml4ZWRQb3NpdGlvbiAtIElzIGluIGZpeGVkIHBvc2l0aW9uIG1vZGVcbiAqIEByZXR1cm5zIHtPYmplY3R9IENvb3JkaW5hdGVzIG9mIHRoZSBib3VuZGFyaWVzXG4gKi9cbmZ1bmN0aW9uIGdldEJvdW5kYXJpZXMocG9wcGVyLCByZWZlcmVuY2UsIHBhZGRpbmcsIGJvdW5kYXJpZXNFbGVtZW50KSB7XG4gIHZhciBmaXhlZFBvc2l0aW9uID0gYXJndW1lbnRzLmxlbmd0aCA+IDQgJiYgYXJndW1lbnRzWzRdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbNF0gOiBmYWxzZTtcblxuICAvLyBOT1RFOiAxIERPTSBhY2Nlc3MgaGVyZVxuXG4gIHZhciBib3VuZGFyaWVzID0geyB0b3A6IDAsIGxlZnQ6IDAgfTtcbiAgdmFyIG9mZnNldFBhcmVudCA9IGZpeGVkUG9zaXRpb24gPyBnZXRGaXhlZFBvc2l0aW9uT2Zmc2V0UGFyZW50KHBvcHBlcikgOiBmaW5kQ29tbW9uT2Zmc2V0UGFyZW50KHBvcHBlciwgcmVmZXJlbmNlKTtcblxuICAvLyBIYW5kbGUgdmlld3BvcnQgY2FzZVxuICBpZiAoYm91bmRhcmllc0VsZW1lbnQgPT09ICd2aWV3cG9ydCcpIHtcbiAgICBib3VuZGFyaWVzID0gZ2V0Vmlld3BvcnRPZmZzZXRSZWN0UmVsYXRpdmVUb0FydGJpdHJhcnlOb2RlKG9mZnNldFBhcmVudCwgZml4ZWRQb3NpdGlvbik7XG4gIH0gZWxzZSB7XG4gICAgLy8gSGFuZGxlIG90aGVyIGNhc2VzIGJhc2VkIG9uIERPTSBlbGVtZW50IHVzZWQgYXMgYm91bmRhcmllc1xuICAgIHZhciBib3VuZGFyaWVzTm9kZSA9IHZvaWQgMDtcbiAgICBpZiAoYm91bmRhcmllc0VsZW1lbnQgPT09ICdzY3JvbGxQYXJlbnQnKSB7XG4gICAgICBib3VuZGFyaWVzTm9kZSA9IGdldFNjcm9sbFBhcmVudChnZXRQYXJlbnROb2RlKHJlZmVyZW5jZSkpO1xuICAgICAgaWYgKGJvdW5kYXJpZXNOb2RlLm5vZGVOYW1lID09PSAnQk9EWScpIHtcbiAgICAgICAgYm91bmRhcmllc05vZGUgPSBwb3BwZXIub3duZXJEb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChib3VuZGFyaWVzRWxlbWVudCA9PT0gJ3dpbmRvdycpIHtcbiAgICAgIGJvdW5kYXJpZXNOb2RlID0gcG9wcGVyLm93bmVyRG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50O1xuICAgIH0gZWxzZSB7XG4gICAgICBib3VuZGFyaWVzTm9kZSA9IGJvdW5kYXJpZXNFbGVtZW50O1xuICAgIH1cblxuICAgIHZhciBvZmZzZXRzID0gZ2V0T2Zmc2V0UmVjdFJlbGF0aXZlVG9BcmJpdHJhcnlOb2RlKGJvdW5kYXJpZXNOb2RlLCBvZmZzZXRQYXJlbnQsIGZpeGVkUG9zaXRpb24pO1xuXG4gICAgLy8gSW4gY2FzZSBvZiBIVE1MLCB3ZSBuZWVkIGEgZGlmZmVyZW50IGNvbXB1dGF0aW9uXG4gICAgaWYgKGJvdW5kYXJpZXNOb2RlLm5vZGVOYW1lID09PSAnSFRNTCcgJiYgIWlzRml4ZWQob2Zmc2V0UGFyZW50KSkge1xuICAgICAgdmFyIF9nZXRXaW5kb3dTaXplcyA9IGdldFdpbmRvd1NpemVzKHBvcHBlci5vd25lckRvY3VtZW50KSxcbiAgICAgICAgICBoZWlnaHQgPSBfZ2V0V2luZG93U2l6ZXMuaGVpZ2h0LFxuICAgICAgICAgIHdpZHRoID0gX2dldFdpbmRvd1NpemVzLndpZHRoO1xuXG4gICAgICBib3VuZGFyaWVzLnRvcCArPSBvZmZzZXRzLnRvcCAtIG9mZnNldHMubWFyZ2luVG9wO1xuICAgICAgYm91bmRhcmllcy5ib3R0b20gPSBoZWlnaHQgKyBvZmZzZXRzLnRvcDtcbiAgICAgIGJvdW5kYXJpZXMubGVmdCArPSBvZmZzZXRzLmxlZnQgLSBvZmZzZXRzLm1hcmdpbkxlZnQ7XG4gICAgICBib3VuZGFyaWVzLnJpZ2h0ID0gd2lkdGggKyBvZmZzZXRzLmxlZnQ7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIGZvciBhbGwgdGhlIG90aGVyIERPTSBlbGVtZW50cywgdGhpcyBvbmUgaXMgZ29vZFxuICAgICAgYm91bmRhcmllcyA9IG9mZnNldHM7XG4gICAgfVxuICB9XG5cbiAgLy8gQWRkIHBhZGRpbmdzXG4gIHBhZGRpbmcgPSBwYWRkaW5nIHx8IDA7XG4gIHZhciBpc1BhZGRpbmdOdW1iZXIgPSB0eXBlb2YgcGFkZGluZyA9PT0gJ251bWJlcic7XG4gIGJvdW5kYXJpZXMubGVmdCArPSBpc1BhZGRpbmdOdW1iZXIgPyBwYWRkaW5nIDogcGFkZGluZy5sZWZ0IHx8IDA7XG4gIGJvdW5kYXJpZXMudG9wICs9IGlzUGFkZGluZ051bWJlciA/IHBhZGRpbmcgOiBwYWRkaW5nLnRvcCB8fCAwO1xuICBib3VuZGFyaWVzLnJpZ2h0IC09IGlzUGFkZGluZ051bWJlciA/IHBhZGRpbmcgOiBwYWRkaW5nLnJpZ2h0IHx8IDA7XG4gIGJvdW5kYXJpZXMuYm90dG9tIC09IGlzUGFkZGluZ051bWJlciA/IHBhZGRpbmcgOiBwYWRkaW5nLmJvdHRvbSB8fCAwO1xuXG4gIHJldHVybiBib3VuZGFyaWVzO1xufVxuXG5mdW5jdGlvbiBnZXRBcmVhKF9yZWYpIHtcbiAgdmFyIHdpZHRoID0gX3JlZi53aWR0aCxcbiAgICAgIGhlaWdodCA9IF9yZWYuaGVpZ2h0O1xuXG4gIHJldHVybiB3aWR0aCAqIGhlaWdodDtcbn1cblxuLyoqXG4gKiBVdGlsaXR5IHVzZWQgdG8gdHJhbnNmb3JtIHRoZSBgYXV0b2AgcGxhY2VtZW50IHRvIHRoZSBwbGFjZW1lbnQgd2l0aCBtb3JlXG4gKiBhdmFpbGFibGUgc3BhY2UuXG4gKiBAbWV0aG9kXG4gKiBAbWVtYmVyb2YgUG9wcGVyLlV0aWxzXG4gKiBAYXJndW1lbnQge09iamVjdH0gZGF0YSAtIFRoZSBkYXRhIG9iamVjdCBnZW5lcmF0ZWQgYnkgdXBkYXRlIG1ldGhvZFxuICogQGFyZ3VtZW50IHtPYmplY3R9IG9wdGlvbnMgLSBNb2RpZmllcnMgY29uZmlndXJhdGlvbiBhbmQgb3B0aW9uc1xuICogQHJldHVybnMge09iamVjdH0gVGhlIGRhdGEgb2JqZWN0LCBwcm9wZXJseSBtb2RpZmllZFxuICovXG5mdW5jdGlvbiBjb21wdXRlQXV0b1BsYWNlbWVudChwbGFjZW1lbnQsIHJlZlJlY3QsIHBvcHBlciwgcmVmZXJlbmNlLCBib3VuZGFyaWVzRWxlbWVudCkge1xuICB2YXIgcGFkZGluZyA9IGFyZ3VtZW50cy5sZW5ndGggPiA1ICYmIGFyZ3VtZW50c1s1XSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzVdIDogMDtcblxuICBpZiAocGxhY2VtZW50LmluZGV4T2YoJ2F1dG8nKSA9PT0gLTEpIHtcbiAgICByZXR1cm4gcGxhY2VtZW50O1xuICB9XG5cbiAgdmFyIGJvdW5kYXJpZXMgPSBnZXRCb3VuZGFyaWVzKHBvcHBlciwgcmVmZXJlbmNlLCBwYWRkaW5nLCBib3VuZGFyaWVzRWxlbWVudCk7XG5cbiAgdmFyIHJlY3RzID0ge1xuICAgIHRvcDoge1xuICAgICAgd2lkdGg6IGJvdW5kYXJpZXMud2lkdGgsXG4gICAgICBoZWlnaHQ6IHJlZlJlY3QudG9wIC0gYm91bmRhcmllcy50b3BcbiAgICB9LFxuICAgIHJpZ2h0OiB7XG4gICAgICB3aWR0aDogYm91bmRhcmllcy5yaWdodCAtIHJlZlJlY3QucmlnaHQsXG4gICAgICBoZWlnaHQ6IGJvdW5kYXJpZXMuaGVpZ2h0XG4gICAgfSxcbiAgICBib3R0b206IHtcbiAgICAgIHdpZHRoOiBib3VuZGFyaWVzLndpZHRoLFxuICAgICAgaGVpZ2h0OiBib3VuZGFyaWVzLmJvdHRvbSAtIHJlZlJlY3QuYm90dG9tXG4gICAgfSxcbiAgICBsZWZ0OiB7XG4gICAgICB3aWR0aDogcmVmUmVjdC5sZWZ0IC0gYm91bmRhcmllcy5sZWZ0LFxuICAgICAgaGVpZ2h0OiBib3VuZGFyaWVzLmhlaWdodFxuICAgIH1cbiAgfTtcblxuICB2YXIgc29ydGVkQXJlYXMgPSBPYmplY3Qua2V5cyhyZWN0cykubWFwKGZ1bmN0aW9uIChrZXkpIHtcbiAgICByZXR1cm4gX2V4dGVuZHMoe1xuICAgICAga2V5OiBrZXlcbiAgICB9LCByZWN0c1trZXldLCB7XG4gICAgICBhcmVhOiBnZXRBcmVhKHJlY3RzW2tleV0pXG4gICAgfSk7XG4gIH0pLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHtcbiAgICByZXR1cm4gYi5hcmVhIC0gYS5hcmVhO1xuICB9KTtcblxuICB2YXIgZmlsdGVyZWRBcmVhcyA9IHNvcnRlZEFyZWFzLmZpbHRlcihmdW5jdGlvbiAoX3JlZjIpIHtcbiAgICB2YXIgd2lkdGggPSBfcmVmMi53aWR0aCxcbiAgICAgICAgaGVpZ2h0ID0gX3JlZjIuaGVpZ2h0O1xuICAgIHJldHVybiB3aWR0aCA+PSBwb3BwZXIuY2xpZW50V2lkdGggJiYgaGVpZ2h0ID49IHBvcHBlci5jbGllbnRIZWlnaHQ7XG4gIH0pO1xuXG4gIHZhciBjb21wdXRlZFBsYWNlbWVudCA9IGZpbHRlcmVkQXJlYXMubGVuZ3RoID4gMCA/IGZpbHRlcmVkQXJlYXNbMF0ua2V5IDogc29ydGVkQXJlYXNbMF0ua2V5O1xuXG4gIHZhciB2YXJpYXRpb24gPSBwbGFjZW1lbnQuc3BsaXQoJy0nKVsxXTtcblxuICByZXR1cm4gY29tcHV0ZWRQbGFjZW1lbnQgKyAodmFyaWF0aW9uID8gJy0nICsgdmFyaWF0aW9uIDogJycpO1xufVxuXG4vKipcbiAqIEdldCBvZmZzZXRzIHRvIHRoZSByZWZlcmVuY2UgZWxlbWVudFxuICogQG1ldGhvZFxuICogQG1lbWJlcm9mIFBvcHBlci5VdGlsc1xuICogQHBhcmFtIHtPYmplY3R9IHN0YXRlXG4gKiBAcGFyYW0ge0VsZW1lbnR9IHBvcHBlciAtIHRoZSBwb3BwZXIgZWxlbWVudFxuICogQHBhcmFtIHtFbGVtZW50fSByZWZlcmVuY2UgLSB0aGUgcmVmZXJlbmNlIGVsZW1lbnQgKHRoZSBwb3BwZXIgd2lsbCBiZSByZWxhdGl2ZSB0byB0aGlzKVxuICogQHBhcmFtIHtFbGVtZW50fSBmaXhlZFBvc2l0aW9uIC0gaXMgaW4gZml4ZWQgcG9zaXRpb24gbW9kZVxuICogQHJldHVybnMge09iamVjdH0gQW4gb2JqZWN0IGNvbnRhaW5pbmcgdGhlIG9mZnNldHMgd2hpY2ggd2lsbCBiZSBhcHBsaWVkIHRvIHRoZSBwb3BwZXJcbiAqL1xuZnVuY3Rpb24gZ2V0UmVmZXJlbmNlT2Zmc2V0cyhzdGF0ZSwgcG9wcGVyLCByZWZlcmVuY2UpIHtcbiAgdmFyIGZpeGVkUG9zaXRpb24gPSBhcmd1bWVudHMubGVuZ3RoID4gMyAmJiBhcmd1bWVudHNbM10gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1szXSA6IG51bGw7XG5cbiAgdmFyIGNvbW1vbk9mZnNldFBhcmVudCA9IGZpeGVkUG9zaXRpb24gPyBnZXRGaXhlZFBvc2l0aW9uT2Zmc2V0UGFyZW50KHBvcHBlcikgOiBmaW5kQ29tbW9uT2Zmc2V0UGFyZW50KHBvcHBlciwgcmVmZXJlbmNlKTtcbiAgcmV0dXJuIGdldE9mZnNldFJlY3RSZWxhdGl2ZVRvQXJiaXRyYXJ5Tm9kZShyZWZlcmVuY2UsIGNvbW1vbk9mZnNldFBhcmVudCwgZml4ZWRQb3NpdGlvbik7XG59XG5cbi8qKlxuICogR2V0IHRoZSBvdXRlciBzaXplcyBvZiB0aGUgZ2l2ZW4gZWxlbWVudCAob2Zmc2V0IHNpemUgKyBtYXJnaW5zKVxuICogQG1ldGhvZFxuICogQG1lbWJlcm9mIFBvcHBlci5VdGlsc1xuICogQGFyZ3VtZW50IHtFbGVtZW50fSBlbGVtZW50XG4gKiBAcmV0dXJucyB7T2JqZWN0fSBvYmplY3QgY29udGFpbmluZyB3aWR0aCBhbmQgaGVpZ2h0IHByb3BlcnRpZXNcbiAqL1xuZnVuY3Rpb24gZ2V0T3V0ZXJTaXplcyhlbGVtZW50KSB7XG4gIHZhciB3aW5kb3cgPSBlbGVtZW50Lm93bmVyRG9jdW1lbnQuZGVmYXVsdFZpZXc7XG4gIHZhciBzdHlsZXMgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShlbGVtZW50KTtcbiAgdmFyIHggPSBwYXJzZUZsb2F0KHN0eWxlcy5tYXJnaW5Ub3AgfHwgMCkgKyBwYXJzZUZsb2F0KHN0eWxlcy5tYXJnaW5Cb3R0b20gfHwgMCk7XG4gIHZhciB5ID0gcGFyc2VGbG9hdChzdHlsZXMubWFyZ2luTGVmdCB8fCAwKSArIHBhcnNlRmxvYXQoc3R5bGVzLm1hcmdpblJpZ2h0IHx8IDApO1xuICB2YXIgcmVzdWx0ID0ge1xuICAgIHdpZHRoOiBlbGVtZW50Lm9mZnNldFdpZHRoICsgeSxcbiAgICBoZWlnaHQ6IGVsZW1lbnQub2Zmc2V0SGVpZ2h0ICsgeFxuICB9O1xuICByZXR1cm4gcmVzdWx0O1xufVxuXG4vKipcbiAqIEdldCB0aGUgb3Bwb3NpdGUgcGxhY2VtZW50IG9mIHRoZSBnaXZlbiBvbmVcbiAqIEBtZXRob2RcbiAqIEBtZW1iZXJvZiBQb3BwZXIuVXRpbHNcbiAqIEBhcmd1bWVudCB7U3RyaW5nfSBwbGFjZW1lbnRcbiAqIEByZXR1cm5zIHtTdHJpbmd9IGZsaXBwZWQgcGxhY2VtZW50XG4gKi9cbmZ1bmN0aW9uIGdldE9wcG9zaXRlUGxhY2VtZW50KHBsYWNlbWVudCkge1xuICB2YXIgaGFzaCA9IHsgbGVmdDogJ3JpZ2h0JywgcmlnaHQ6ICdsZWZ0JywgYm90dG9tOiAndG9wJywgdG9wOiAnYm90dG9tJyB9O1xuICByZXR1cm4gcGxhY2VtZW50LnJlcGxhY2UoL2xlZnR8cmlnaHR8Ym90dG9tfHRvcC9nLCBmdW5jdGlvbiAobWF0Y2hlZCkge1xuICAgIHJldHVybiBoYXNoW21hdGNoZWRdO1xuICB9KTtcbn1cblxuLyoqXG4gKiBHZXQgb2Zmc2V0cyB0byB0aGUgcG9wcGVyXG4gKiBAbWV0aG9kXG4gKiBAbWVtYmVyb2YgUG9wcGVyLlV0aWxzXG4gKiBAcGFyYW0ge09iamVjdH0gcG9zaXRpb24gLSBDU1MgcG9zaXRpb24gdGhlIFBvcHBlciB3aWxsIGdldCBhcHBsaWVkXG4gKiBAcGFyYW0ge0hUTUxFbGVtZW50fSBwb3BwZXIgLSB0aGUgcG9wcGVyIGVsZW1lbnRcbiAqIEBwYXJhbSB7T2JqZWN0fSByZWZlcmVuY2VPZmZzZXRzIC0gdGhlIHJlZmVyZW5jZSBvZmZzZXRzICh0aGUgcG9wcGVyIHdpbGwgYmUgcmVsYXRpdmUgdG8gdGhpcylcbiAqIEBwYXJhbSB7U3RyaW5nfSBwbGFjZW1lbnQgLSBvbmUgb2YgdGhlIHZhbGlkIHBsYWNlbWVudCBvcHRpb25zXG4gKiBAcmV0dXJucyB7T2JqZWN0fSBwb3BwZXJPZmZzZXRzIC0gQW4gb2JqZWN0IGNvbnRhaW5pbmcgdGhlIG9mZnNldHMgd2hpY2ggd2lsbCBiZSBhcHBsaWVkIHRvIHRoZSBwb3BwZXJcbiAqL1xuZnVuY3Rpb24gZ2V0UG9wcGVyT2Zmc2V0cyhwb3BwZXIsIHJlZmVyZW5jZU9mZnNldHMsIHBsYWNlbWVudCkge1xuICBwbGFjZW1lbnQgPSBwbGFjZW1lbnQuc3BsaXQoJy0nKVswXTtcblxuICAvLyBHZXQgcG9wcGVyIG5vZGUgc2l6ZXNcbiAgdmFyIHBvcHBlclJlY3QgPSBnZXRPdXRlclNpemVzKHBvcHBlcik7XG5cbiAgLy8gQWRkIHBvc2l0aW9uLCB3aWR0aCBhbmQgaGVpZ2h0IHRvIG91ciBvZmZzZXRzIG9iamVjdFxuICB2YXIgcG9wcGVyT2Zmc2V0cyA9IHtcbiAgICB3aWR0aDogcG9wcGVyUmVjdC53aWR0aCxcbiAgICBoZWlnaHQ6IHBvcHBlclJlY3QuaGVpZ2h0XG4gIH07XG5cbiAgLy8gZGVwZW5kaW5nIGJ5IHRoZSBwb3BwZXIgcGxhY2VtZW50IHdlIGhhdmUgdG8gY29tcHV0ZSBpdHMgb2Zmc2V0cyBzbGlnaHRseSBkaWZmZXJlbnRseVxuICB2YXIgaXNIb3JpeiA9IFsncmlnaHQnLCAnbGVmdCddLmluZGV4T2YocGxhY2VtZW50KSAhPT0gLTE7XG4gIHZhciBtYWluU2lkZSA9IGlzSG9yaXogPyAndG9wJyA6ICdsZWZ0JztcbiAgdmFyIHNlY29uZGFyeVNpZGUgPSBpc0hvcml6ID8gJ2xlZnQnIDogJ3RvcCc7XG4gIHZhciBtZWFzdXJlbWVudCA9IGlzSG9yaXogPyAnaGVpZ2h0JyA6ICd3aWR0aCc7XG4gIHZhciBzZWNvbmRhcnlNZWFzdXJlbWVudCA9ICFpc0hvcml6ID8gJ2hlaWdodCcgOiAnd2lkdGgnO1xuXG4gIHBvcHBlck9mZnNldHNbbWFpblNpZGVdID0gcmVmZXJlbmNlT2Zmc2V0c1ttYWluU2lkZV0gKyByZWZlcmVuY2VPZmZzZXRzW21lYXN1cmVtZW50XSAvIDIgLSBwb3BwZXJSZWN0W21lYXN1cmVtZW50XSAvIDI7XG4gIGlmIChwbGFjZW1lbnQgPT09IHNlY29uZGFyeVNpZGUpIHtcbiAgICBwb3BwZXJPZmZzZXRzW3NlY29uZGFyeVNpZGVdID0gcmVmZXJlbmNlT2Zmc2V0c1tzZWNvbmRhcnlTaWRlXSAtIHBvcHBlclJlY3Rbc2Vjb25kYXJ5TWVhc3VyZW1lbnRdO1xuICB9IGVsc2Uge1xuICAgIHBvcHBlck9mZnNldHNbc2Vjb25kYXJ5U2lkZV0gPSByZWZlcmVuY2VPZmZzZXRzW2dldE9wcG9zaXRlUGxhY2VtZW50KHNlY29uZGFyeVNpZGUpXTtcbiAgfVxuXG4gIHJldHVybiBwb3BwZXJPZmZzZXRzO1xufVxuXG4vKipcbiAqIE1pbWljcyB0aGUgYGZpbmRgIG1ldGhvZCBvZiBBcnJheVxuICogQG1ldGhvZFxuICogQG1lbWJlcm9mIFBvcHBlci5VdGlsc1xuICogQGFyZ3VtZW50IHtBcnJheX0gYXJyXG4gKiBAYXJndW1lbnQgcHJvcFxuICogQGFyZ3VtZW50IHZhbHVlXG4gKiBAcmV0dXJucyBpbmRleCBvciAtMVxuICovXG5mdW5jdGlvbiBmaW5kKGFyciwgY2hlY2spIHtcbiAgLy8gdXNlIG5hdGl2ZSBmaW5kIGlmIHN1cHBvcnRlZFxuICBpZiAoQXJyYXkucHJvdG90eXBlLmZpbmQpIHtcbiAgICByZXR1cm4gYXJyLmZpbmQoY2hlY2spO1xuICB9XG5cbiAgLy8gdXNlIGBmaWx0ZXJgIHRvIG9idGFpbiB0aGUgc2FtZSBiZWhhdmlvciBvZiBgZmluZGBcbiAgcmV0dXJuIGFyci5maWx0ZXIoY2hlY2spWzBdO1xufVxuXG4vKipcbiAqIFJldHVybiB0aGUgaW5kZXggb2YgdGhlIG1hdGNoaW5nIG9iamVjdFxuICogQG1ldGhvZFxuICogQG1lbWJlcm9mIFBvcHBlci5VdGlsc1xuICogQGFyZ3VtZW50IHtBcnJheX0gYXJyXG4gKiBAYXJndW1lbnQgcHJvcFxuICogQGFyZ3VtZW50IHZhbHVlXG4gKiBAcmV0dXJucyBpbmRleCBvciAtMVxuICovXG5mdW5jdGlvbiBmaW5kSW5kZXgoYXJyLCBwcm9wLCB2YWx1ZSkge1xuICAvLyB1c2UgbmF0aXZlIGZpbmRJbmRleCBpZiBzdXBwb3J0ZWRcbiAgaWYgKEFycmF5LnByb3RvdHlwZS5maW5kSW5kZXgpIHtcbiAgICByZXR1cm4gYXJyLmZpbmRJbmRleChmdW5jdGlvbiAoY3VyKSB7XG4gICAgICByZXR1cm4gY3VyW3Byb3BdID09PSB2YWx1ZTtcbiAgICB9KTtcbiAgfVxuXG4gIC8vIHVzZSBgZmluZGAgKyBgaW5kZXhPZmAgaWYgYGZpbmRJbmRleGAgaXNuJ3Qgc3VwcG9ydGVkXG4gIHZhciBtYXRjaCA9IGZpbmQoYXJyLCBmdW5jdGlvbiAob2JqKSB7XG4gICAgcmV0dXJuIG9ialtwcm9wXSA9PT0gdmFsdWU7XG4gIH0pO1xuICByZXR1cm4gYXJyLmluZGV4T2YobWF0Y2gpO1xufVxuXG4vKipcbiAqIExvb3AgdHJvdWdoIHRoZSBsaXN0IG9mIG1vZGlmaWVycyBhbmQgcnVuIHRoZW0gaW4gb3JkZXIsXG4gKiBlYWNoIG9mIHRoZW0gd2lsbCB0aGVuIGVkaXQgdGhlIGRhdGEgb2JqZWN0LlxuICogQG1ldGhvZFxuICogQG1lbWJlcm9mIFBvcHBlci5VdGlsc1xuICogQHBhcmFtIHtkYXRhT2JqZWN0fSBkYXRhXG4gKiBAcGFyYW0ge0FycmF5fSBtb2RpZmllcnNcbiAqIEBwYXJhbSB7U3RyaW5nfSBlbmRzIC0gT3B0aW9uYWwgbW9kaWZpZXIgbmFtZSB1c2VkIGFzIHN0b3BwZXJcbiAqIEByZXR1cm5zIHtkYXRhT2JqZWN0fVxuICovXG5mdW5jdGlvbiBydW5Nb2RpZmllcnMobW9kaWZpZXJzLCBkYXRhLCBlbmRzKSB7XG4gIHZhciBtb2RpZmllcnNUb1J1biA9IGVuZHMgPT09IHVuZGVmaW5lZCA/IG1vZGlmaWVycyA6IG1vZGlmaWVycy5zbGljZSgwLCBmaW5kSW5kZXgobW9kaWZpZXJzLCAnbmFtZScsIGVuZHMpKTtcblxuICBtb2RpZmllcnNUb1J1bi5mb3JFYWNoKGZ1bmN0aW9uIChtb2RpZmllcikge1xuICAgIGlmIChtb2RpZmllclsnZnVuY3Rpb24nXSkge1xuICAgICAgLy8gZXNsaW50LWRpc2FibGUtbGluZSBkb3Qtbm90YXRpb25cbiAgICAgIGNvbnNvbGUud2FybignYG1vZGlmaWVyLmZ1bmN0aW9uYCBpcyBkZXByZWNhdGVkLCB1c2UgYG1vZGlmaWVyLmZuYCEnKTtcbiAgICB9XG4gICAgdmFyIGZuID0gbW9kaWZpZXJbJ2Z1bmN0aW9uJ10gfHwgbW9kaWZpZXIuZm47IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgZG90LW5vdGF0aW9uXG4gICAgaWYgKG1vZGlmaWVyLmVuYWJsZWQgJiYgaXNGdW5jdGlvbihmbikpIHtcbiAgICAgIC8vIEFkZCBwcm9wZXJ0aWVzIHRvIG9mZnNldHMgdG8gbWFrZSB0aGVtIGEgY29tcGxldGUgY2xpZW50UmVjdCBvYmplY3RcbiAgICAgIC8vIHdlIGRvIHRoaXMgYmVmb3JlIGVhY2ggbW9kaWZpZXIgdG8gbWFrZSBzdXJlIHRoZSBwcmV2aW91cyBvbmUgZG9lc24ndFxuICAgICAgLy8gbWVzcyB3aXRoIHRoZXNlIHZhbHVlc1xuICAgICAgZGF0YS5vZmZzZXRzLnBvcHBlciA9IGdldENsaWVudFJlY3QoZGF0YS5vZmZzZXRzLnBvcHBlcik7XG4gICAgICBkYXRhLm9mZnNldHMucmVmZXJlbmNlID0gZ2V0Q2xpZW50UmVjdChkYXRhLm9mZnNldHMucmVmZXJlbmNlKTtcblxuICAgICAgZGF0YSA9IGZuKGRhdGEsIG1vZGlmaWVyKTtcbiAgICB9XG4gIH0pO1xuXG4gIHJldHVybiBkYXRhO1xufVxuXG4vKipcbiAqIFVwZGF0ZXMgdGhlIHBvc2l0aW9uIG9mIHRoZSBwb3BwZXIsIGNvbXB1dGluZyB0aGUgbmV3IG9mZnNldHMgYW5kIGFwcGx5aW5nXG4gKiB0aGUgbmV3IHN0eWxlLjxiciAvPlxuICogUHJlZmVyIGBzY2hlZHVsZVVwZGF0ZWAgb3ZlciBgdXBkYXRlYCBiZWNhdXNlIG9mIHBlcmZvcm1hbmNlIHJlYXNvbnMuXG4gKiBAbWV0aG9kXG4gKiBAbWVtYmVyb2YgUG9wcGVyXG4gKi9cbmZ1bmN0aW9uIHVwZGF0ZSgpIHtcbiAgLy8gaWYgcG9wcGVyIGlzIGRlc3Ryb3llZCwgZG9uJ3QgcGVyZm9ybSBhbnkgZnVydGhlciB1cGRhdGVcbiAgaWYgKHRoaXMuc3RhdGUuaXNEZXN0cm95ZWQpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgZGF0YSA9IHtcbiAgICBpbnN0YW5jZTogdGhpcyxcbiAgICBzdHlsZXM6IHt9LFxuICAgIGFycm93U3R5bGVzOiB7fSxcbiAgICBhdHRyaWJ1dGVzOiB7fSxcbiAgICBmbGlwcGVkOiBmYWxzZSxcbiAgICBvZmZzZXRzOiB7fVxuICB9O1xuXG4gIC8vIGNvbXB1dGUgcmVmZXJlbmNlIGVsZW1lbnQgb2Zmc2V0c1xuICBkYXRhLm9mZnNldHMucmVmZXJlbmNlID0gZ2V0UmVmZXJlbmNlT2Zmc2V0cyh0aGlzLnN0YXRlLCB0aGlzLnBvcHBlciwgdGhpcy5yZWZlcmVuY2UsIHRoaXMub3B0aW9ucy5wb3NpdGlvbkZpeGVkKTtcblxuICAvLyBjb21wdXRlIGF1dG8gcGxhY2VtZW50LCBzdG9yZSBwbGFjZW1lbnQgaW5zaWRlIHRoZSBkYXRhIG9iamVjdCxcbiAgLy8gbW9kaWZpZXJzIHdpbGwgYmUgYWJsZSB0byBlZGl0IGBwbGFjZW1lbnRgIGlmIG5lZWRlZFxuICAvLyBhbmQgcmVmZXIgdG8gb3JpZ2luYWxQbGFjZW1lbnQgdG8ga25vdyB0aGUgb3JpZ2luYWwgdmFsdWVcbiAgZGF0YS5wbGFjZW1lbnQgPSBjb21wdXRlQXV0b1BsYWNlbWVudCh0aGlzLm9wdGlvbnMucGxhY2VtZW50LCBkYXRhLm9mZnNldHMucmVmZXJlbmNlLCB0aGlzLnBvcHBlciwgdGhpcy5yZWZlcmVuY2UsIHRoaXMub3B0aW9ucy5tb2RpZmllcnMuZmxpcC5ib3VuZGFyaWVzRWxlbWVudCwgdGhpcy5vcHRpb25zLm1vZGlmaWVycy5mbGlwLnBhZGRpbmcpO1xuXG4gIC8vIHN0b3JlIHRoZSBjb21wdXRlZCBwbGFjZW1lbnQgaW5zaWRlIGBvcmlnaW5hbFBsYWNlbWVudGBcbiAgZGF0YS5vcmlnaW5hbFBsYWNlbWVudCA9IGRhdGEucGxhY2VtZW50O1xuXG4gIGRhdGEucG9zaXRpb25GaXhlZCA9IHRoaXMub3B0aW9ucy5wb3NpdGlvbkZpeGVkO1xuXG4gIC8vIGNvbXB1dGUgdGhlIHBvcHBlciBvZmZzZXRzXG4gIGRhdGEub2Zmc2V0cy5wb3BwZXIgPSBnZXRQb3BwZXJPZmZzZXRzKHRoaXMucG9wcGVyLCBkYXRhLm9mZnNldHMucmVmZXJlbmNlLCBkYXRhLnBsYWNlbWVudCk7XG5cbiAgZGF0YS5vZmZzZXRzLnBvcHBlci5wb3NpdGlvbiA9IHRoaXMub3B0aW9ucy5wb3NpdGlvbkZpeGVkID8gJ2ZpeGVkJyA6ICdhYnNvbHV0ZSc7XG5cbiAgLy8gcnVuIHRoZSBtb2RpZmllcnNcbiAgZGF0YSA9IHJ1bk1vZGlmaWVycyh0aGlzLm1vZGlmaWVycywgZGF0YSk7XG5cbiAgLy8gdGhlIGZpcnN0IGB1cGRhdGVgIHdpbGwgY2FsbCBgb25DcmVhdGVgIGNhbGxiYWNrXG4gIC8vIHRoZSBvdGhlciBvbmVzIHdpbGwgY2FsbCBgb25VcGRhdGVgIGNhbGxiYWNrXG4gIGlmICghdGhpcy5zdGF0ZS5pc0NyZWF0ZWQpIHtcbiAgICB0aGlzLnN0YXRlLmlzQ3JlYXRlZCA9IHRydWU7XG4gICAgdGhpcy5vcHRpb25zLm9uQ3JlYXRlKGRhdGEpO1xuICB9IGVsc2Uge1xuICAgIHRoaXMub3B0aW9ucy5vblVwZGF0ZShkYXRhKTtcbiAgfVxufVxuXG4vKipcbiAqIEhlbHBlciB1c2VkIHRvIGtub3cgaWYgdGhlIGdpdmVuIG1vZGlmaWVyIGlzIGVuYWJsZWQuXG4gKiBAbWV0aG9kXG4gKiBAbWVtYmVyb2YgUG9wcGVyLlV0aWxzXG4gKiBAcmV0dXJucyB7Qm9vbGVhbn1cbiAqL1xuZnVuY3Rpb24gaXNNb2RpZmllckVuYWJsZWQobW9kaWZpZXJzLCBtb2RpZmllck5hbWUpIHtcbiAgcmV0dXJuIG1vZGlmaWVycy5zb21lKGZ1bmN0aW9uIChfcmVmKSB7XG4gICAgdmFyIG5hbWUgPSBfcmVmLm5hbWUsXG4gICAgICAgIGVuYWJsZWQgPSBfcmVmLmVuYWJsZWQ7XG4gICAgcmV0dXJuIGVuYWJsZWQgJiYgbmFtZSA9PT0gbW9kaWZpZXJOYW1lO1xuICB9KTtcbn1cblxuLyoqXG4gKiBHZXQgdGhlIHByZWZpeGVkIHN1cHBvcnRlZCBwcm9wZXJ0eSBuYW1lXG4gKiBAbWV0aG9kXG4gKiBAbWVtYmVyb2YgUG9wcGVyLlV0aWxzXG4gKiBAYXJndW1lbnQge1N0cmluZ30gcHJvcGVydHkgKGNhbWVsQ2FzZSlcbiAqIEByZXR1cm5zIHtTdHJpbmd9IHByZWZpeGVkIHByb3BlcnR5IChjYW1lbENhc2Ugb3IgUGFzY2FsQ2FzZSwgZGVwZW5kaW5nIG9uIHRoZSB2ZW5kb3IgcHJlZml4KVxuICovXG5mdW5jdGlvbiBnZXRTdXBwb3J0ZWRQcm9wZXJ0eU5hbWUocHJvcGVydHkpIHtcbiAgdmFyIHByZWZpeGVzID0gW2ZhbHNlLCAnbXMnLCAnV2Via2l0JywgJ01veicsICdPJ107XG4gIHZhciB1cHBlclByb3AgPSBwcm9wZXJ0eS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHByb3BlcnR5LnNsaWNlKDEpO1xuXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgcHJlZml4ZXMubGVuZ3RoOyBpKyspIHtcbiAgICB2YXIgcHJlZml4ID0gcHJlZml4ZXNbaV07XG4gICAgdmFyIHRvQ2hlY2sgPSBwcmVmaXggPyAnJyArIHByZWZpeCArIHVwcGVyUHJvcCA6IHByb3BlcnR5O1xuICAgIGlmICh0eXBlb2YgZG9jdW1lbnQuYm9keS5zdHlsZVt0b0NoZWNrXSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIHJldHVybiB0b0NoZWNrO1xuICAgIH1cbiAgfVxuICByZXR1cm4gbnVsbDtcbn1cblxuLyoqXG4gKiBEZXN0cm95cyB0aGUgcG9wcGVyLlxuICogQG1ldGhvZFxuICogQG1lbWJlcm9mIFBvcHBlclxuICovXG5mdW5jdGlvbiBkZXN0cm95KCkge1xuICB0aGlzLnN0YXRlLmlzRGVzdHJveWVkID0gdHJ1ZTtcblxuICAvLyB0b3VjaCBET00gb25seSBpZiBgYXBwbHlTdHlsZWAgbW9kaWZpZXIgaXMgZW5hYmxlZFxuICBpZiAoaXNNb2RpZmllckVuYWJsZWQodGhpcy5tb2RpZmllcnMsICdhcHBseVN0eWxlJykpIHtcbiAgICB0aGlzLnBvcHBlci5yZW1vdmVBdHRyaWJ1dGUoJ3gtcGxhY2VtZW50Jyk7XG4gICAgdGhpcy5wb3BwZXIuc3R5bGUucG9zaXRpb24gPSAnJztcbiAgICB0aGlzLnBvcHBlci5zdHlsZS50b3AgPSAnJztcbiAgICB0aGlzLnBvcHBlci5zdHlsZS5sZWZ0ID0gJyc7XG4gICAgdGhpcy5wb3BwZXIuc3R5bGUucmlnaHQgPSAnJztcbiAgICB0aGlzLnBvcHBlci5zdHlsZS5ib3R0b20gPSAnJztcbiAgICB0aGlzLnBvcHBlci5zdHlsZS53aWxsQ2hhbmdlID0gJyc7XG4gICAgdGhpcy5wb3BwZXIuc3R5bGVbZ2V0U3VwcG9ydGVkUHJvcGVydHlOYW1lKCd0cmFuc2Zvcm0nKV0gPSAnJztcbiAgfVxuXG4gIHRoaXMuZGlzYWJsZUV2ZW50TGlzdGVuZXJzKCk7XG5cbiAgLy8gcmVtb3ZlIHRoZSBwb3BwZXIgaWYgdXNlciBleHBsaWNpdHkgYXNrZWQgZm9yIHRoZSBkZWxldGlvbiBvbiBkZXN0cm95XG4gIC8vIGRvIG5vdCB1c2UgYHJlbW92ZWAgYmVjYXVzZSBJRTExIGRvZXNuJ3Qgc3VwcG9ydCBpdFxuICBpZiAodGhpcy5vcHRpb25zLnJlbW92ZU9uRGVzdHJveSkge1xuICAgIHRoaXMucG9wcGVyLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy5wb3BwZXIpO1xuICB9XG4gIHJldHVybiB0aGlzO1xufVxuXG4vKipcbiAqIEdldCB0aGUgd2luZG93IGFzc29jaWF0ZWQgd2l0aCB0aGUgZWxlbWVudFxuICogQGFyZ3VtZW50IHtFbGVtZW50fSBlbGVtZW50XG4gKiBAcmV0dXJucyB7V2luZG93fVxuICovXG5mdW5jdGlvbiBnZXRXaW5kb3coZWxlbWVudCkge1xuICB2YXIgb3duZXJEb2N1bWVudCA9IGVsZW1lbnQub3duZXJEb2N1bWVudDtcbiAgcmV0dXJuIG93bmVyRG9jdW1lbnQgPyBvd25lckRvY3VtZW50LmRlZmF1bHRWaWV3IDogd2luZG93O1xufVxuXG5mdW5jdGlvbiBhdHRhY2hUb1Njcm9sbFBhcmVudHMoc2Nyb2xsUGFyZW50LCBldmVudCwgY2FsbGJhY2ssIHNjcm9sbFBhcmVudHMpIHtcbiAgdmFyIGlzQm9keSA9IHNjcm9sbFBhcmVudC5ub2RlTmFtZSA9PT0gJ0JPRFknO1xuICB2YXIgdGFyZ2V0ID0gaXNCb2R5ID8gc2Nyb2xsUGFyZW50Lm93bmVyRG9jdW1lbnQuZGVmYXVsdFZpZXcgOiBzY3JvbGxQYXJlbnQ7XG4gIHRhcmdldC5hZGRFdmVudExpc3RlbmVyKGV2ZW50LCBjYWxsYmFjaywgeyBwYXNzaXZlOiB0cnVlIH0pO1xuXG4gIGlmICghaXNCb2R5KSB7XG4gICAgYXR0YWNoVG9TY3JvbGxQYXJlbnRzKGdldFNjcm9sbFBhcmVudCh0YXJnZXQucGFyZW50Tm9kZSksIGV2ZW50LCBjYWxsYmFjaywgc2Nyb2xsUGFyZW50cyk7XG4gIH1cbiAgc2Nyb2xsUGFyZW50cy5wdXNoKHRhcmdldCk7XG59XG5cbi8qKlxuICogU2V0dXAgbmVlZGVkIGV2ZW50IGxpc3RlbmVycyB1c2VkIHRvIHVwZGF0ZSB0aGUgcG9wcGVyIHBvc2l0aW9uXG4gKiBAbWV0aG9kXG4gKiBAbWVtYmVyb2YgUG9wcGVyLlV0aWxzXG4gKiBAcHJpdmF0ZVxuICovXG5mdW5jdGlvbiBzZXR1cEV2ZW50TGlzdGVuZXJzKHJlZmVyZW5jZSwgb3B0aW9ucywgc3RhdGUsIHVwZGF0ZUJvdW5kKSB7XG4gIC8vIFJlc2l6ZSBldmVudCBsaXN0ZW5lciBvbiB3aW5kb3dcbiAgc3RhdGUudXBkYXRlQm91bmQgPSB1cGRhdGVCb3VuZDtcbiAgZ2V0V2luZG93KHJlZmVyZW5jZSkuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgc3RhdGUudXBkYXRlQm91bmQsIHsgcGFzc2l2ZTogdHJ1ZSB9KTtcblxuICAvLyBTY3JvbGwgZXZlbnQgbGlzdGVuZXIgb24gc2Nyb2xsIHBhcmVudHNcbiAgdmFyIHNjcm9sbEVsZW1lbnQgPSBnZXRTY3JvbGxQYXJlbnQocmVmZXJlbmNlKTtcbiAgYXR0YWNoVG9TY3JvbGxQYXJlbnRzKHNjcm9sbEVsZW1lbnQsICdzY3JvbGwnLCBzdGF0ZS51cGRhdGVCb3VuZCwgc3RhdGUuc2Nyb2xsUGFyZW50cyk7XG4gIHN0YXRlLnNjcm9sbEVsZW1lbnQgPSBzY3JvbGxFbGVtZW50O1xuICBzdGF0ZS5ldmVudHNFbmFibGVkID0gdHJ1ZTtcblxuICByZXR1cm4gc3RhdGU7XG59XG5cbi8qKlxuICogSXQgd2lsbCBhZGQgcmVzaXplL3Njcm9sbCBldmVudHMgYW5kIHN0YXJ0IHJlY2FsY3VsYXRpbmdcbiAqIHBvc2l0aW9uIG9mIHRoZSBwb3BwZXIgZWxlbWVudCB3aGVuIHRoZXkgYXJlIHRyaWdnZXJlZC5cbiAqIEBtZXRob2RcbiAqIEBtZW1iZXJvZiBQb3BwZXJcbiAqL1xuZnVuY3Rpb24gZW5hYmxlRXZlbnRMaXN0ZW5lcnMoKSB7XG4gIGlmICghdGhpcy5zdGF0ZS5ldmVudHNFbmFibGVkKSB7XG4gICAgdGhpcy5zdGF0ZSA9IHNldHVwRXZlbnRMaXN0ZW5lcnModGhpcy5yZWZlcmVuY2UsIHRoaXMub3B0aW9ucywgdGhpcy5zdGF0ZSwgdGhpcy5zY2hlZHVsZVVwZGF0ZSk7XG4gIH1cbn1cblxuLyoqXG4gKiBSZW1vdmUgZXZlbnQgbGlzdGVuZXJzIHVzZWQgdG8gdXBkYXRlIHRoZSBwb3BwZXIgcG9zaXRpb25cbiAqIEBtZXRob2RcbiAqIEBtZW1iZXJvZiBQb3BwZXIuVXRpbHNcbiAqIEBwcml2YXRlXG4gKi9cbmZ1bmN0aW9uIHJlbW92ZUV2ZW50TGlzdGVuZXJzKHJlZmVyZW5jZSwgc3RhdGUpIHtcbiAgLy8gUmVtb3ZlIHJlc2l6ZSBldmVudCBsaXN0ZW5lciBvbiB3aW5kb3dcbiAgZ2V0V2luZG93KHJlZmVyZW5jZSkucmVtb3ZlRXZlbnRMaXN0ZW5lcigncmVzaXplJywgc3RhdGUudXBkYXRlQm91bmQpO1xuXG4gIC8vIFJlbW92ZSBzY3JvbGwgZXZlbnQgbGlzdGVuZXIgb24gc2Nyb2xsIHBhcmVudHNcbiAgc3RhdGUuc2Nyb2xsUGFyZW50cy5mb3JFYWNoKGZ1bmN0aW9uICh0YXJnZXQpIHtcbiAgICB0YXJnZXQucmVtb3ZlRXZlbnRMaXN0ZW5lcignc2Nyb2xsJywgc3RhdGUudXBkYXRlQm91bmQpO1xuICB9KTtcblxuICAvLyBSZXNldCBzdGF0ZVxuICBzdGF0ZS51cGRhdGVCb3VuZCA9IG51bGw7XG4gIHN0YXRlLnNjcm9sbFBhcmVudHMgPSBbXTtcbiAgc3RhdGUuc2Nyb2xsRWxlbWVudCA9IG51bGw7XG4gIHN0YXRlLmV2ZW50c0VuYWJsZWQgPSBmYWxzZTtcbiAgcmV0dXJuIHN0YXRlO1xufVxuXG4vKipcbiAqIEl0IHdpbGwgcmVtb3ZlIHJlc2l6ZS9zY3JvbGwgZXZlbnRzIGFuZCB3b24ndCByZWNhbGN1bGF0ZSBwb3BwZXIgcG9zaXRpb25cbiAqIHdoZW4gdGhleSBhcmUgdHJpZ2dlcmVkLiBJdCBhbHNvIHdvbid0IHRyaWdnZXIgYG9uVXBkYXRlYCBjYWxsYmFjayBhbnltb3JlLFxuICogdW5sZXNzIHlvdSBjYWxsIGB1cGRhdGVgIG1ldGhvZCBtYW51YWxseS5cbiAqIEBtZXRob2RcbiAqIEBtZW1iZXJvZiBQb3BwZXJcbiAqL1xuZnVuY3Rpb24gZGlzYWJsZUV2ZW50TGlzdGVuZXJzKCkge1xuICBpZiAodGhpcy5zdGF0ZS5ldmVudHNFbmFibGVkKSB7XG4gICAgY2FuY2VsQW5pbWF0aW9uRnJhbWUodGhpcy5zY2hlZHVsZVVwZGF0ZSk7XG4gICAgdGhpcy5zdGF0ZSA9IHJlbW92ZUV2ZW50TGlzdGVuZXJzKHRoaXMucmVmZXJlbmNlLCB0aGlzLnN0YXRlKTtcbiAgfVxufVxuXG4vKipcbiAqIFRlbGxzIGlmIGEgZ2l2ZW4gaW5wdXQgaXMgYSBudW1iZXJcbiAqIEBtZXRob2RcbiAqIEBtZW1iZXJvZiBQb3BwZXIuVXRpbHNcbiAqIEBwYXJhbSB7Kn0gaW5wdXQgdG8gY2hlY2tcbiAqIEByZXR1cm4ge0Jvb2xlYW59XG4gKi9cbmZ1bmN0aW9uIGlzTnVtZXJpYyhuKSB7XG4gIHJldHVybiBuICE9PSAnJyAmJiAhaXNOYU4ocGFyc2VGbG9hdChuKSkgJiYgaXNGaW5pdGUobik7XG59XG5cbi8qKlxuICogU2V0IHRoZSBzdHlsZSB0byB0aGUgZ2l2ZW4gcG9wcGVyXG4gKiBAbWV0aG9kXG4gKiBAbWVtYmVyb2YgUG9wcGVyLlV0aWxzXG4gKiBAYXJndW1lbnQge0VsZW1lbnR9IGVsZW1lbnQgLSBFbGVtZW50IHRvIGFwcGx5IHRoZSBzdHlsZSB0b1xuICogQGFyZ3VtZW50IHtPYmplY3R9IHN0eWxlc1xuICogT2JqZWN0IHdpdGggYSBsaXN0IG9mIHByb3BlcnRpZXMgYW5kIHZhbHVlcyB3aGljaCB3aWxsIGJlIGFwcGxpZWQgdG8gdGhlIGVsZW1lbnRcbiAqL1xuZnVuY3Rpb24gc2V0U3R5bGVzKGVsZW1lbnQsIHN0eWxlcykge1xuICBPYmplY3Qua2V5cyhzdHlsZXMpLmZvckVhY2goZnVuY3Rpb24gKHByb3ApIHtcbiAgICB2YXIgdW5pdCA9ICcnO1xuICAgIC8vIGFkZCB1bml0IGlmIHRoZSB2YWx1ZSBpcyBudW1lcmljIGFuZCBpcyBvbmUgb2YgdGhlIGZvbGxvd2luZ1xuICAgIGlmIChbJ3dpZHRoJywgJ2hlaWdodCcsICd0b3AnLCAncmlnaHQnLCAnYm90dG9tJywgJ2xlZnQnXS5pbmRleE9mKHByb3ApICE9PSAtMSAmJiBpc051bWVyaWMoc3R5bGVzW3Byb3BdKSkge1xuICAgICAgdW5pdCA9ICdweCc7XG4gICAgfVxuICAgIGVsZW1lbnQuc3R5bGVbcHJvcF0gPSBzdHlsZXNbcHJvcF0gKyB1bml0O1xuICB9KTtcbn1cblxuLyoqXG4gKiBTZXQgdGhlIGF0dHJpYnV0ZXMgdG8gdGhlIGdpdmVuIHBvcHBlclxuICogQG1ldGhvZFxuICogQG1lbWJlcm9mIFBvcHBlci5VdGlsc1xuICogQGFyZ3VtZW50IHtFbGVtZW50fSBlbGVtZW50IC0gRWxlbWVudCB0byBhcHBseSB0aGUgYXR0cmlidXRlcyB0b1xuICogQGFyZ3VtZW50IHtPYmplY3R9IHN0eWxlc1xuICogT2JqZWN0IHdpdGggYSBsaXN0IG9mIHByb3BlcnRpZXMgYW5kIHZhbHVlcyB3aGljaCB3aWxsIGJlIGFwcGxpZWQgdG8gdGhlIGVsZW1lbnRcbiAqL1xuZnVuY3Rpb24gc2V0QXR0cmlidXRlcyhlbGVtZW50LCBhdHRyaWJ1dGVzKSB7XG4gIE9iamVjdC5rZXlzKGF0dHJpYnV0ZXMpLmZvckVhY2goZnVuY3Rpb24gKHByb3ApIHtcbiAgICB2YXIgdmFsdWUgPSBhdHRyaWJ1dGVzW3Byb3BdO1xuICAgIGlmICh2YWx1ZSAhPT0gZmFsc2UpIHtcbiAgICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlKHByb3AsIGF0dHJpYnV0ZXNbcHJvcF0pO1xuICAgIH0gZWxzZSB7XG4gICAgICBlbGVtZW50LnJlbW92ZUF0dHJpYnV0ZShwcm9wKTtcbiAgICB9XG4gIH0pO1xufVxuXG4vKipcbiAqIEBmdW5jdGlvblxuICogQG1lbWJlcm9mIE1vZGlmaWVyc1xuICogQGFyZ3VtZW50IHtPYmplY3R9IGRhdGEgLSBUaGUgZGF0YSBvYmplY3QgZ2VuZXJhdGVkIGJ5IGB1cGRhdGVgIG1ldGhvZFxuICogQGFyZ3VtZW50IHtPYmplY3R9IGRhdGEuc3R5bGVzIC0gTGlzdCBvZiBzdHlsZSBwcm9wZXJ0aWVzIC0gdmFsdWVzIHRvIGFwcGx5IHRvIHBvcHBlciBlbGVtZW50XG4gKiBAYXJndW1lbnQge09iamVjdH0gZGF0YS5hdHRyaWJ1dGVzIC0gTGlzdCBvZiBhdHRyaWJ1dGUgcHJvcGVydGllcyAtIHZhbHVlcyB0byBhcHBseSB0byBwb3BwZXIgZWxlbWVudFxuICogQGFyZ3VtZW50IHtPYmplY3R9IG9wdGlvbnMgLSBNb2RpZmllcnMgY29uZmlndXJhdGlvbiBhbmQgb3B0aW9uc1xuICogQHJldHVybnMge09iamVjdH0gVGhlIHNhbWUgZGF0YSBvYmplY3RcbiAqL1xuZnVuY3Rpb24gYXBwbHlTdHlsZShkYXRhKSB7XG4gIC8vIGFueSBwcm9wZXJ0eSBwcmVzZW50IGluIGBkYXRhLnN0eWxlc2Agd2lsbCBiZSBhcHBsaWVkIHRvIHRoZSBwb3BwZXIsXG4gIC8vIGluIHRoaXMgd2F5IHdlIGNhbiBtYWtlIHRoZSAzcmQgcGFydHkgbW9kaWZpZXJzIGFkZCBjdXN0b20gc3R5bGVzIHRvIGl0XG4gIC8vIEJlIGF3YXJlLCBtb2RpZmllcnMgY291bGQgb3ZlcnJpZGUgdGhlIHByb3BlcnRpZXMgZGVmaW5lZCBpbiB0aGUgcHJldmlvdXNcbiAgLy8gbGluZXMgb2YgdGhpcyBtb2RpZmllciFcbiAgc2V0U3R5bGVzKGRhdGEuaW5zdGFuY2UucG9wcGVyLCBkYXRhLnN0eWxlcyk7XG5cbiAgLy8gYW55IHByb3BlcnR5IHByZXNlbnQgaW4gYGRhdGEuYXR0cmlidXRlc2Agd2lsbCBiZSBhcHBsaWVkIHRvIHRoZSBwb3BwZXIsXG4gIC8vIHRoZXkgd2lsbCBiZSBzZXQgYXMgSFRNTCBhdHRyaWJ1dGVzIG9mIHRoZSBlbGVtZW50XG4gIHNldEF0dHJpYnV0ZXMoZGF0YS5pbnN0YW5jZS5wb3BwZXIsIGRhdGEuYXR0cmlidXRlcyk7XG5cbiAgLy8gaWYgYXJyb3dFbGVtZW50IGlzIGRlZmluZWQgYW5kIGFycm93U3R5bGVzIGhhcyBzb21lIHByb3BlcnRpZXNcbiAgaWYgKGRhdGEuYXJyb3dFbGVtZW50ICYmIE9iamVjdC5rZXlzKGRhdGEuYXJyb3dTdHlsZXMpLmxlbmd0aCkge1xuICAgIHNldFN0eWxlcyhkYXRhLmFycm93RWxlbWVudCwgZGF0YS5hcnJvd1N0eWxlcyk7XG4gIH1cblxuICByZXR1cm4gZGF0YTtcbn1cblxuLyoqXG4gKiBTZXQgdGhlIHgtcGxhY2VtZW50IGF0dHJpYnV0ZSBiZWZvcmUgZXZlcnl0aGluZyBlbHNlIGJlY2F1c2UgaXQgY291bGQgYmUgdXNlZFxuICogdG8gYWRkIG1hcmdpbnMgdG8gdGhlIHBvcHBlciBtYXJnaW5zIG5lZWRzIHRvIGJlIGNhbGN1bGF0ZWQgdG8gZ2V0IHRoZVxuICogY29ycmVjdCBwb3BwZXIgb2Zmc2V0cy5cbiAqIEBtZXRob2RcbiAqIEBtZW1iZXJvZiBQb3BwZXIubW9kaWZpZXJzXG4gKiBAcGFyYW0ge0hUTUxFbGVtZW50fSByZWZlcmVuY2UgLSBUaGUgcmVmZXJlbmNlIGVsZW1lbnQgdXNlZCB0byBwb3NpdGlvbiB0aGUgcG9wcGVyXG4gKiBAcGFyYW0ge0hUTUxFbGVtZW50fSBwb3BwZXIgLSBUaGUgSFRNTCBlbGVtZW50IHVzZWQgYXMgcG9wcGVyXG4gKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucyAtIFBvcHBlci5qcyBvcHRpb25zXG4gKi9cbmZ1bmN0aW9uIGFwcGx5U3R5bGVPbkxvYWQocmVmZXJlbmNlLCBwb3BwZXIsIG9wdGlvbnMsIG1vZGlmaWVyT3B0aW9ucywgc3RhdGUpIHtcbiAgLy8gY29tcHV0ZSByZWZlcmVuY2UgZWxlbWVudCBvZmZzZXRzXG4gIHZhciByZWZlcmVuY2VPZmZzZXRzID0gZ2V0UmVmZXJlbmNlT2Zmc2V0cyhzdGF0ZSwgcG9wcGVyLCByZWZlcmVuY2UsIG9wdGlvbnMucG9zaXRpb25GaXhlZCk7XG5cbiAgLy8gY29tcHV0ZSBhdXRvIHBsYWNlbWVudCwgc3RvcmUgcGxhY2VtZW50IGluc2lkZSB0aGUgZGF0YSBvYmplY3QsXG4gIC8vIG1vZGlmaWVycyB3aWxsIGJlIGFibGUgdG8gZWRpdCBgcGxhY2VtZW50YCBpZiBuZWVkZWRcbiAgLy8gYW5kIHJlZmVyIHRvIG9yaWdpbmFsUGxhY2VtZW50IHRvIGtub3cgdGhlIG9yaWdpbmFsIHZhbHVlXG4gIHZhciBwbGFjZW1lbnQgPSBjb21wdXRlQXV0b1BsYWNlbWVudChvcHRpb25zLnBsYWNlbWVudCwgcmVmZXJlbmNlT2Zmc2V0cywgcG9wcGVyLCByZWZlcmVuY2UsIG9wdGlvbnMubW9kaWZpZXJzLmZsaXAuYm91bmRhcmllc0VsZW1lbnQsIG9wdGlvbnMubW9kaWZpZXJzLmZsaXAucGFkZGluZyk7XG5cbiAgcG9wcGVyLnNldEF0dHJpYnV0ZSgneC1wbGFjZW1lbnQnLCBwbGFjZW1lbnQpO1xuXG4gIC8vIEFwcGx5IGBwb3NpdGlvbmAgdG8gcG9wcGVyIGJlZm9yZSBhbnl0aGluZyBlbHNlIGJlY2F1c2VcbiAgLy8gd2l0aG91dCB0aGUgcG9zaXRpb24gYXBwbGllZCB3ZSBjYW4ndCBndWFyYW50ZWUgY29ycmVjdCBjb21wdXRhdGlvbnNcbiAgc2V0U3R5bGVzKHBvcHBlciwgeyBwb3NpdGlvbjogb3B0aW9ucy5wb3NpdGlvbkZpeGVkID8gJ2ZpeGVkJyA6ICdhYnNvbHV0ZScgfSk7XG5cbiAgcmV0dXJuIG9wdGlvbnM7XG59XG5cbi8qKlxuICogQGZ1bmN0aW9uXG4gKiBAbWVtYmVyb2YgUG9wcGVyLlV0aWxzXG4gKiBAYXJndW1lbnQge09iamVjdH0gZGF0YSAtIFRoZSBkYXRhIG9iamVjdCBnZW5lcmF0ZWQgYnkgYHVwZGF0ZWAgbWV0aG9kXG4gKiBAYXJndW1lbnQge0Jvb2xlYW59IHNob3VsZFJvdW5kIC0gSWYgdGhlIG9mZnNldHMgc2hvdWxkIGJlIHJvdW5kZWQgYXQgYWxsXG4gKiBAcmV0dXJucyB7T2JqZWN0fSBUaGUgcG9wcGVyJ3MgcG9zaXRpb24gb2Zmc2V0cyByb3VuZGVkXG4gKlxuICogVGhlIHRhbGUgb2YgcGl4ZWwtcGVyZmVjdCBwb3NpdGlvbmluZy4gSXQncyBzdGlsbCBub3QgMTAwJSBwZXJmZWN0LCBidXQgYXNcbiAqIGdvb2QgYXMgaXQgY2FuIGJlIHdpdGhpbiByZWFzb24uXG4gKiBEaXNjdXNzaW9uIGhlcmU6IGh0dHBzOi8vZ2l0aHViLmNvbS9GZXpWcmFzdGEvcG9wcGVyLmpzL3B1bGwvNzE1XG4gKlxuICogTG93IERQSSBzY3JlZW5zIGNhdXNlIGEgcG9wcGVyIHRvIGJlIGJsdXJyeSBpZiBub3QgdXNpbmcgZnVsbCBwaXhlbHMgKFNhZmFyaVxuICogYXMgd2VsbCBvbiBIaWdoIERQSSBzY3JlZW5zKS5cbiAqXG4gKiBGaXJlZm94IHByZWZlcnMgbm8gcm91bmRpbmcgZm9yIHBvc2l0aW9uaW5nIGFuZCBkb2VzIG5vdCBoYXZlIGJsdXJyaW5lc3Mgb25cbiAqIGhpZ2ggRFBJIHNjcmVlbnMuXG4gKlxuICogT25seSBob3Jpem9udGFsIHBsYWNlbWVudCBhbmQgbGVmdC9yaWdodCB2YWx1ZXMgbmVlZCB0byBiZSBjb25zaWRlcmVkLlxuICovXG5mdW5jdGlvbiBnZXRSb3VuZGVkT2Zmc2V0cyhkYXRhLCBzaG91bGRSb3VuZCkge1xuICB2YXIgX2RhdGEkb2Zmc2V0cyA9IGRhdGEub2Zmc2V0cyxcbiAgICAgIHBvcHBlciA9IF9kYXRhJG9mZnNldHMucG9wcGVyLFxuICAgICAgcmVmZXJlbmNlID0gX2RhdGEkb2Zmc2V0cy5yZWZlcmVuY2U7XG5cblxuICB2YXIgaXNWZXJ0aWNhbCA9IFsnbGVmdCcsICdyaWdodCddLmluZGV4T2YoZGF0YS5wbGFjZW1lbnQpICE9PSAtMTtcbiAgdmFyIGlzVmFyaWF0aW9uID0gZGF0YS5wbGFjZW1lbnQuaW5kZXhPZignLScpICE9PSAtMTtcbiAgdmFyIHNhbWVXaWR0aE9kZG5lc3MgPSByZWZlcmVuY2Uud2lkdGggJSAyID09PSBwb3BwZXIud2lkdGggJSAyO1xuICB2YXIgYm90aE9kZFdpZHRoID0gcmVmZXJlbmNlLndpZHRoICUgMiA9PT0gMSAmJiBwb3BwZXIud2lkdGggJSAyID09PSAxO1xuICB2YXIgbm9Sb3VuZCA9IGZ1bmN0aW9uIG5vUm91bmQodikge1xuICAgIHJldHVybiB2O1xuICB9O1xuXG4gIHZhciBob3Jpem9udGFsVG9JbnRlZ2VyID0gIXNob3VsZFJvdW5kID8gbm9Sb3VuZCA6IGlzVmVydGljYWwgfHwgaXNWYXJpYXRpb24gfHwgc2FtZVdpZHRoT2RkbmVzcyA/IE1hdGgucm91bmQgOiBNYXRoLmZsb29yO1xuICB2YXIgdmVydGljYWxUb0ludGVnZXIgPSAhc2hvdWxkUm91bmQgPyBub1JvdW5kIDogTWF0aC5yb3VuZDtcblxuICByZXR1cm4ge1xuICAgIGxlZnQ6IGhvcml6b250YWxUb0ludGVnZXIoYm90aE9kZFdpZHRoICYmICFpc1ZhcmlhdGlvbiAmJiBzaG91bGRSb3VuZCA/IHBvcHBlci5sZWZ0IC0gMSA6IHBvcHBlci5sZWZ0KSxcbiAgICB0b3A6IHZlcnRpY2FsVG9JbnRlZ2VyKHBvcHBlci50b3ApLFxuICAgIGJvdHRvbTogdmVydGljYWxUb0ludGVnZXIocG9wcGVyLmJvdHRvbSksXG4gICAgcmlnaHQ6IGhvcml6b250YWxUb0ludGVnZXIocG9wcGVyLnJpZ2h0KVxuICB9O1xufVxuXG52YXIgaXNGaXJlZm94ID0gaXNCcm93c2VyICYmIC9GaXJlZm94L2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KTtcblxuLyoqXG4gKiBAZnVuY3Rpb25cbiAqIEBtZW1iZXJvZiBNb2RpZmllcnNcbiAqIEBhcmd1bWVudCB7T2JqZWN0fSBkYXRhIC0gVGhlIGRhdGEgb2JqZWN0IGdlbmVyYXRlZCBieSBgdXBkYXRlYCBtZXRob2RcbiAqIEBhcmd1bWVudCB7T2JqZWN0fSBvcHRpb25zIC0gTW9kaWZpZXJzIGNvbmZpZ3VyYXRpb24gYW5kIG9wdGlvbnNcbiAqIEByZXR1cm5zIHtPYmplY3R9IFRoZSBkYXRhIG9iamVjdCwgcHJvcGVybHkgbW9kaWZpZWRcbiAqL1xuZnVuY3Rpb24gY29tcHV0ZVN0eWxlKGRhdGEsIG9wdGlvbnMpIHtcbiAgdmFyIHggPSBvcHRpb25zLngsXG4gICAgICB5ID0gb3B0aW9ucy55O1xuICB2YXIgcG9wcGVyID0gZGF0YS5vZmZzZXRzLnBvcHBlcjtcblxuICAvLyBSZW1vdmUgdGhpcyBsZWdhY3kgc3VwcG9ydCBpbiBQb3BwZXIuanMgdjJcblxuICB2YXIgbGVnYWN5R3B1QWNjZWxlcmF0aW9uT3B0aW9uID0gZmluZChkYXRhLmluc3RhbmNlLm1vZGlmaWVycywgZnVuY3Rpb24gKG1vZGlmaWVyKSB7XG4gICAgcmV0dXJuIG1vZGlmaWVyLm5hbWUgPT09ICdhcHBseVN0eWxlJztcbiAgfSkuZ3B1QWNjZWxlcmF0aW9uO1xuICBpZiAobGVnYWN5R3B1QWNjZWxlcmF0aW9uT3B0aW9uICE9PSB1bmRlZmluZWQpIHtcbiAgICBjb25zb2xlLndhcm4oJ1dBUk5JTkc6IGBncHVBY2NlbGVyYXRpb25gIG9wdGlvbiBtb3ZlZCB0byBgY29tcHV0ZVN0eWxlYCBtb2RpZmllciBhbmQgd2lsbCBub3QgYmUgc3VwcG9ydGVkIGluIGZ1dHVyZSB2ZXJzaW9ucyBvZiBQb3BwZXIuanMhJyk7XG4gIH1cbiAgdmFyIGdwdUFjY2VsZXJhdGlvbiA9IGxlZ2FjeUdwdUFjY2VsZXJhdGlvbk9wdGlvbiAhPT0gdW5kZWZpbmVkID8gbGVnYWN5R3B1QWNjZWxlcmF0aW9uT3B0aW9uIDogb3B0aW9ucy5ncHVBY2NlbGVyYXRpb247XG5cbiAgdmFyIG9mZnNldFBhcmVudCA9IGdldE9mZnNldFBhcmVudChkYXRhLmluc3RhbmNlLnBvcHBlcik7XG4gIHZhciBvZmZzZXRQYXJlbnRSZWN0ID0gZ2V0Qm91bmRpbmdDbGllbnRSZWN0KG9mZnNldFBhcmVudCk7XG5cbiAgLy8gU3R5bGVzXG4gIHZhciBzdHlsZXMgPSB7XG4gICAgcG9zaXRpb246IHBvcHBlci5wb3NpdGlvblxuICB9O1xuXG4gIHZhciBvZmZzZXRzID0gZ2V0Um91bmRlZE9mZnNldHMoZGF0YSwgd2luZG93LmRldmljZVBpeGVsUmF0aW8gPCAyIHx8ICFpc0ZpcmVmb3gpO1xuXG4gIHZhciBzaWRlQSA9IHggPT09ICdib3R0b20nID8gJ3RvcCcgOiAnYm90dG9tJztcbiAgdmFyIHNpZGVCID0geSA9PT0gJ3JpZ2h0JyA/ICdsZWZ0JyA6ICdyaWdodCc7XG5cbiAgLy8gaWYgZ3B1QWNjZWxlcmF0aW9uIGlzIHNldCB0byBgdHJ1ZWAgYW5kIHRyYW5zZm9ybSBpcyBzdXBwb3J0ZWQsXG4gIC8vICB3ZSB1c2UgYHRyYW5zbGF0ZTNkYCB0byBhcHBseSB0aGUgcG9zaXRpb24gdG8gdGhlIHBvcHBlciB3ZVxuICAvLyBhdXRvbWF0aWNhbGx5IHVzZSB0aGUgc3VwcG9ydGVkIHByZWZpeGVkIHZlcnNpb24gaWYgbmVlZGVkXG4gIHZhciBwcmVmaXhlZFByb3BlcnR5ID0gZ2V0U3VwcG9ydGVkUHJvcGVydHlOYW1lKCd0cmFuc2Zvcm0nKTtcblxuICAvLyBub3csIGxldCdzIG1ha2UgYSBzdGVwIGJhY2sgYW5kIGxvb2sgYXQgdGhpcyBjb2RlIGNsb3NlbHkgKHd0Zj8pXG4gIC8vIElmIHRoZSBjb250ZW50IG9mIHRoZSBwb3BwZXIgZ3Jvd3Mgb25jZSBpdCdzIGJlZW4gcG9zaXRpb25lZCwgaXRcbiAgLy8gbWF5IGhhcHBlbiB0aGF0IHRoZSBwb3BwZXIgZ2V0cyBtaXNwbGFjZWQgYmVjYXVzZSBvZiB0aGUgbmV3IGNvbnRlbnRcbiAgLy8gb3ZlcmZsb3dpbmcgaXRzIHJlZmVyZW5jZSBlbGVtZW50XG4gIC8vIFRvIGF2b2lkIHRoaXMgcHJvYmxlbSwgd2UgcHJvdmlkZSB0d28gb3B0aW9ucyAoeCBhbmQgeSksIHdoaWNoIGFsbG93XG4gIC8vIHRoZSBjb25zdW1lciB0byBkZWZpbmUgdGhlIG9mZnNldCBvcmlnaW4uXG4gIC8vIElmIHdlIHBvc2l0aW9uIGEgcG9wcGVyIG9uIHRvcCBvZiBhIHJlZmVyZW5jZSBlbGVtZW50LCB3ZSBjYW4gc2V0XG4gIC8vIGB4YCB0byBgdG9wYCB0byBtYWtlIHRoZSBwb3BwZXIgZ3JvdyB0b3dhcmRzIGl0cyB0b3AgaW5zdGVhZCBvZlxuICAvLyBpdHMgYm90dG9tLlxuICB2YXIgbGVmdCA9IHZvaWQgMCxcbiAgICAgIHRvcCA9IHZvaWQgMDtcbiAgaWYgKHNpZGVBID09PSAnYm90dG9tJykge1xuICAgIC8vIHdoZW4gb2Zmc2V0UGFyZW50IGlzIDxodG1sPiB0aGUgcG9zaXRpb25pbmcgaXMgcmVsYXRpdmUgdG8gdGhlIGJvdHRvbSBvZiB0aGUgc2NyZWVuIChleGNsdWRpbmcgdGhlIHNjcm9sbGJhcilcbiAgICAvLyBhbmQgbm90IHRoZSBib3R0b20gb2YgdGhlIGh0bWwgZWxlbWVudFxuICAgIGlmIChvZmZzZXRQYXJlbnQubm9kZU5hbWUgPT09ICdIVE1MJykge1xuICAgICAgdG9wID0gLW9mZnNldFBhcmVudC5jbGllbnRIZWlnaHQgKyBvZmZzZXRzLmJvdHRvbTtcbiAgICB9IGVsc2Uge1xuICAgICAgdG9wID0gLW9mZnNldFBhcmVudFJlY3QuaGVpZ2h0ICsgb2Zmc2V0cy5ib3R0b207XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIHRvcCA9IG9mZnNldHMudG9wO1xuICB9XG4gIGlmIChzaWRlQiA9PT0gJ3JpZ2h0Jykge1xuICAgIGlmIChvZmZzZXRQYXJlbnQubm9kZU5hbWUgPT09ICdIVE1MJykge1xuICAgICAgbGVmdCA9IC1vZmZzZXRQYXJlbnQuY2xpZW50V2lkdGggKyBvZmZzZXRzLnJpZ2h0O1xuICAgIH0gZWxzZSB7XG4gICAgICBsZWZ0ID0gLW9mZnNldFBhcmVudFJlY3Qud2lkdGggKyBvZmZzZXRzLnJpZ2h0O1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBsZWZ0ID0gb2Zmc2V0cy5sZWZ0O1xuICB9XG4gIGlmIChncHVBY2NlbGVyYXRpb24gJiYgcHJlZml4ZWRQcm9wZXJ0eSkge1xuICAgIHN0eWxlc1twcmVmaXhlZFByb3BlcnR5XSA9ICd0cmFuc2xhdGUzZCgnICsgbGVmdCArICdweCwgJyArIHRvcCArICdweCwgMCknO1xuICAgIHN0eWxlc1tzaWRlQV0gPSAwO1xuICAgIHN0eWxlc1tzaWRlQl0gPSAwO1xuICAgIHN0eWxlcy53aWxsQ2hhbmdlID0gJ3RyYW5zZm9ybSc7XG4gIH0gZWxzZSB7XG4gICAgLy8gb3Rod2VyaXNlLCB3ZSB1c2UgdGhlIHN0YW5kYXJkIGB0b3BgLCBgbGVmdGAsIGBib3R0b21gIGFuZCBgcmlnaHRgIHByb3BlcnRpZXNcbiAgICB2YXIgaW52ZXJ0VG9wID0gc2lkZUEgPT09ICdib3R0b20nID8gLTEgOiAxO1xuICAgIHZhciBpbnZlcnRMZWZ0ID0gc2lkZUIgPT09ICdyaWdodCcgPyAtMSA6IDE7XG4gICAgc3R5bGVzW3NpZGVBXSA9IHRvcCAqIGludmVydFRvcDtcbiAgICBzdHlsZXNbc2lkZUJdID0gbGVmdCAqIGludmVydExlZnQ7XG4gICAgc3R5bGVzLndpbGxDaGFuZ2UgPSBzaWRlQSArICcsICcgKyBzaWRlQjtcbiAgfVxuXG4gIC8vIEF0dHJpYnV0ZXNcbiAgdmFyIGF0dHJpYnV0ZXMgPSB7XG4gICAgJ3gtcGxhY2VtZW50JzogZGF0YS5wbGFjZW1lbnRcbiAgfTtcblxuICAvLyBVcGRhdGUgYGRhdGFgIGF0dHJpYnV0ZXMsIHN0eWxlcyBhbmQgYXJyb3dTdHlsZXNcbiAgZGF0YS5hdHRyaWJ1dGVzID0gX2V4dGVuZHMoe30sIGF0dHJpYnV0ZXMsIGRhdGEuYXR0cmlidXRlcyk7XG4gIGRhdGEuc3R5bGVzID0gX2V4dGVuZHMoe30sIHN0eWxlcywgZGF0YS5zdHlsZXMpO1xuICBkYXRhLmFycm93U3R5bGVzID0gX2V4dGVuZHMoe30sIGRhdGEub2Zmc2V0cy5hcnJvdywgZGF0YS5hcnJvd1N0eWxlcyk7XG5cbiAgcmV0dXJuIGRhdGE7XG59XG5cbi8qKlxuICogSGVscGVyIHVzZWQgdG8ga25vdyBpZiB0aGUgZ2l2ZW4gbW9kaWZpZXIgZGVwZW5kcyBmcm9tIGFub3RoZXIgb25lLjxiciAvPlxuICogSXQgY2hlY2tzIGlmIHRoZSBuZWVkZWQgbW9kaWZpZXIgaXMgbGlzdGVkIGFuZCBlbmFibGVkLlxuICogQG1ldGhvZFxuICogQG1lbWJlcm9mIFBvcHBlci5VdGlsc1xuICogQHBhcmFtIHtBcnJheX0gbW9kaWZpZXJzIC0gbGlzdCBvZiBtb2RpZmllcnNcbiAqIEBwYXJhbSB7U3RyaW5nfSByZXF1ZXN0aW5nTmFtZSAtIG5hbWUgb2YgcmVxdWVzdGluZyBtb2RpZmllclxuICogQHBhcmFtIHtTdHJpbmd9IHJlcXVlc3RlZE5hbWUgLSBuYW1lIG9mIHJlcXVlc3RlZCBtb2RpZmllclxuICogQHJldHVybnMge0Jvb2xlYW59XG4gKi9cbmZ1bmN0aW9uIGlzTW9kaWZpZXJSZXF1aXJlZChtb2RpZmllcnMsIHJlcXVlc3RpbmdOYW1lLCByZXF1ZXN0ZWROYW1lKSB7XG4gIHZhciByZXF1ZXN0aW5nID0gZmluZChtb2RpZmllcnMsIGZ1bmN0aW9uIChfcmVmKSB7XG4gICAgdmFyIG5hbWUgPSBfcmVmLm5hbWU7XG4gICAgcmV0dXJuIG5hbWUgPT09IHJlcXVlc3RpbmdOYW1lO1xuICB9KTtcblxuICB2YXIgaXNSZXF1aXJlZCA9ICEhcmVxdWVzdGluZyAmJiBtb2RpZmllcnMuc29tZShmdW5jdGlvbiAobW9kaWZpZXIpIHtcbiAgICByZXR1cm4gbW9kaWZpZXIubmFtZSA9PT0gcmVxdWVzdGVkTmFtZSAmJiBtb2RpZmllci5lbmFibGVkICYmIG1vZGlmaWVyLm9yZGVyIDwgcmVxdWVzdGluZy5vcmRlcjtcbiAgfSk7XG5cbiAgaWYgKCFpc1JlcXVpcmVkKSB7XG4gICAgdmFyIF9yZXF1ZXN0aW5nID0gJ2AnICsgcmVxdWVzdGluZ05hbWUgKyAnYCc7XG4gICAgdmFyIHJlcXVlc3RlZCA9ICdgJyArIHJlcXVlc3RlZE5hbWUgKyAnYCc7XG4gICAgY29uc29sZS53YXJuKHJlcXVlc3RlZCArICcgbW9kaWZpZXIgaXMgcmVxdWlyZWQgYnkgJyArIF9yZXF1ZXN0aW5nICsgJyBtb2RpZmllciBpbiBvcmRlciB0byB3b3JrLCBiZSBzdXJlIHRvIGluY2x1ZGUgaXQgYmVmb3JlICcgKyBfcmVxdWVzdGluZyArICchJyk7XG4gIH1cbiAgcmV0dXJuIGlzUmVxdWlyZWQ7XG59XG5cbi8qKlxuICogQGZ1bmN0aW9uXG4gKiBAbWVtYmVyb2YgTW9kaWZpZXJzXG4gKiBAYXJndW1lbnQge09iamVjdH0gZGF0YSAtIFRoZSBkYXRhIG9iamVjdCBnZW5lcmF0ZWQgYnkgdXBkYXRlIG1ldGhvZFxuICogQGFyZ3VtZW50IHtPYmplY3R9IG9wdGlvbnMgLSBNb2RpZmllcnMgY29uZmlndXJhdGlvbiBhbmQgb3B0aW9uc1xuICogQHJldHVybnMge09iamVjdH0gVGhlIGRhdGEgb2JqZWN0LCBwcm9wZXJseSBtb2RpZmllZFxuICovXG5mdW5jdGlvbiBhcnJvdyhkYXRhLCBvcHRpb25zKSB7XG4gIHZhciBfZGF0YSRvZmZzZXRzJGFycm93O1xuXG4gIC8vIGFycm93IGRlcGVuZHMgb24ga2VlcFRvZ2V0aGVyIGluIG9yZGVyIHRvIHdvcmtcbiAgaWYgKCFpc01vZGlmaWVyUmVxdWlyZWQoZGF0YS5pbnN0YW5jZS5tb2RpZmllcnMsICdhcnJvdycsICdrZWVwVG9nZXRoZXInKSkge1xuICAgIHJldHVybiBkYXRhO1xuICB9XG5cbiAgdmFyIGFycm93RWxlbWVudCA9IG9wdGlvbnMuZWxlbWVudDtcblxuICAvLyBpZiBhcnJvd0VsZW1lbnQgaXMgYSBzdHJpbmcsIHN1cHBvc2UgaXQncyBhIENTUyBzZWxlY3RvclxuICBpZiAodHlwZW9mIGFycm93RWxlbWVudCA9PT0gJ3N0cmluZycpIHtcbiAgICBhcnJvd0VsZW1lbnQgPSBkYXRhLmluc3RhbmNlLnBvcHBlci5xdWVyeVNlbGVjdG9yKGFycm93RWxlbWVudCk7XG5cbiAgICAvLyBpZiBhcnJvd0VsZW1lbnQgaXMgbm90IGZvdW5kLCBkb24ndCBydW4gdGhlIG1vZGlmaWVyXG4gICAgaWYgKCFhcnJvd0VsZW1lbnQpIHtcbiAgICAgIHJldHVybiBkYXRhO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICAvLyBpZiB0aGUgYXJyb3dFbGVtZW50IGlzbid0IGEgcXVlcnkgc2VsZWN0b3Igd2UgbXVzdCBjaGVjayB0aGF0IHRoZVxuICAgIC8vIHByb3ZpZGVkIERPTSBub2RlIGlzIGNoaWxkIG9mIGl0cyBwb3BwZXIgbm9kZVxuICAgIGlmICghZGF0YS5pbnN0YW5jZS5wb3BwZXIuY29udGFpbnMoYXJyb3dFbGVtZW50KSkge1xuICAgICAgY29uc29sZS53YXJuKCdXQVJOSU5HOiBgYXJyb3cuZWxlbWVudGAgbXVzdCBiZSBjaGlsZCBvZiBpdHMgcG9wcGVyIGVsZW1lbnQhJyk7XG4gICAgICByZXR1cm4gZGF0YTtcbiAgICB9XG4gIH1cblxuICB2YXIgcGxhY2VtZW50ID0gZGF0YS5wbGFjZW1lbnQuc3BsaXQoJy0nKVswXTtcbiAgdmFyIF9kYXRhJG9mZnNldHMgPSBkYXRhLm9mZnNldHMsXG4gICAgICBwb3BwZXIgPSBfZGF0YSRvZmZzZXRzLnBvcHBlcixcbiAgICAgIHJlZmVyZW5jZSA9IF9kYXRhJG9mZnNldHMucmVmZXJlbmNlO1xuXG4gIHZhciBpc1ZlcnRpY2FsID0gWydsZWZ0JywgJ3JpZ2h0J10uaW5kZXhPZihwbGFjZW1lbnQpICE9PSAtMTtcblxuICB2YXIgbGVuID0gaXNWZXJ0aWNhbCA/ICdoZWlnaHQnIDogJ3dpZHRoJztcbiAgdmFyIHNpZGVDYXBpdGFsaXplZCA9IGlzVmVydGljYWwgPyAnVG9wJyA6ICdMZWZ0JztcbiAgdmFyIHNpZGUgPSBzaWRlQ2FwaXRhbGl6ZWQudG9Mb3dlckNhc2UoKTtcbiAgdmFyIGFsdFNpZGUgPSBpc1ZlcnRpY2FsID8gJ2xlZnQnIDogJ3RvcCc7XG4gIHZhciBvcFNpZGUgPSBpc1ZlcnRpY2FsID8gJ2JvdHRvbScgOiAncmlnaHQnO1xuICB2YXIgYXJyb3dFbGVtZW50U2l6ZSA9IGdldE91dGVyU2l6ZXMoYXJyb3dFbGVtZW50KVtsZW5dO1xuXG4gIC8vXG4gIC8vIGV4dGVuZHMga2VlcFRvZ2V0aGVyIGJlaGF2aW9yIG1ha2luZyBzdXJlIHRoZSBwb3BwZXIgYW5kIGl0c1xuICAvLyByZWZlcmVuY2UgaGF2ZSBlbm91Z2ggcGl4ZWxzIGluIGNvbmp1bmN0aW9uXG4gIC8vXG5cbiAgLy8gdG9wL2xlZnQgc2lkZVxuICBpZiAocmVmZXJlbmNlW29wU2lkZV0gLSBhcnJvd0VsZW1lbnRTaXplIDwgcG9wcGVyW3NpZGVdKSB7XG4gICAgZGF0YS5vZmZzZXRzLnBvcHBlcltzaWRlXSAtPSBwb3BwZXJbc2lkZV0gLSAocmVmZXJlbmNlW29wU2lkZV0gLSBhcnJvd0VsZW1lbnRTaXplKTtcbiAgfVxuICAvLyBib3R0b20vcmlnaHQgc2lkZVxuICBpZiAocmVmZXJlbmNlW3NpZGVdICsgYXJyb3dFbGVtZW50U2l6ZSA+IHBvcHBlcltvcFNpZGVdKSB7XG4gICAgZGF0YS5vZmZzZXRzLnBvcHBlcltzaWRlXSArPSByZWZlcmVuY2Vbc2lkZV0gKyBhcnJvd0VsZW1lbnRTaXplIC0gcG9wcGVyW29wU2lkZV07XG4gIH1cbiAgZGF0YS5vZmZzZXRzLnBvcHBlciA9IGdldENsaWVudFJlY3QoZGF0YS5vZmZzZXRzLnBvcHBlcik7XG5cbiAgLy8gY29tcHV0ZSBjZW50ZXIgb2YgdGhlIHBvcHBlclxuICB2YXIgY2VudGVyID0gcmVmZXJlbmNlW3NpZGVdICsgcmVmZXJlbmNlW2xlbl0gLyAyIC0gYXJyb3dFbGVtZW50U2l6ZSAvIDI7XG5cbiAgLy8gQ29tcHV0ZSB0aGUgc2lkZVZhbHVlIHVzaW5nIHRoZSB1cGRhdGVkIHBvcHBlciBvZmZzZXRzXG4gIC8vIHRha2UgcG9wcGVyIG1hcmdpbiBpbiBhY2NvdW50IGJlY2F1c2Ugd2UgZG9uJ3QgaGF2ZSB0aGlzIGluZm8gYXZhaWxhYmxlXG4gIHZhciBjc3MgPSBnZXRTdHlsZUNvbXB1dGVkUHJvcGVydHkoZGF0YS5pbnN0YW5jZS5wb3BwZXIpO1xuICB2YXIgcG9wcGVyTWFyZ2luU2lkZSA9IHBhcnNlRmxvYXQoY3NzWydtYXJnaW4nICsgc2lkZUNhcGl0YWxpemVkXSwgMTApO1xuICB2YXIgcG9wcGVyQm9yZGVyU2lkZSA9IHBhcnNlRmxvYXQoY3NzWydib3JkZXInICsgc2lkZUNhcGl0YWxpemVkICsgJ1dpZHRoJ10sIDEwKTtcbiAgdmFyIHNpZGVWYWx1ZSA9IGNlbnRlciAtIGRhdGEub2Zmc2V0cy5wb3BwZXJbc2lkZV0gLSBwb3BwZXJNYXJnaW5TaWRlIC0gcG9wcGVyQm9yZGVyU2lkZTtcblxuICAvLyBwcmV2ZW50IGFycm93RWxlbWVudCBmcm9tIGJlaW5nIHBsYWNlZCBub3QgY29udGlndW91c2x5IHRvIGl0cyBwb3BwZXJcbiAgc2lkZVZhbHVlID0gTWF0aC5tYXgoTWF0aC5taW4ocG9wcGVyW2xlbl0gLSBhcnJvd0VsZW1lbnRTaXplLCBzaWRlVmFsdWUpLCAwKTtcblxuICBkYXRhLmFycm93RWxlbWVudCA9IGFycm93RWxlbWVudDtcbiAgZGF0YS5vZmZzZXRzLmFycm93ID0gKF9kYXRhJG9mZnNldHMkYXJyb3cgPSB7fSwgZGVmaW5lUHJvcGVydHkoX2RhdGEkb2Zmc2V0cyRhcnJvdywgc2lkZSwgTWF0aC5yb3VuZChzaWRlVmFsdWUpKSwgZGVmaW5lUHJvcGVydHkoX2RhdGEkb2Zmc2V0cyRhcnJvdywgYWx0U2lkZSwgJycpLCBfZGF0YSRvZmZzZXRzJGFycm93KTtcblxuICByZXR1cm4gZGF0YTtcbn1cblxuLyoqXG4gKiBHZXQgdGhlIG9wcG9zaXRlIHBsYWNlbWVudCB2YXJpYXRpb24gb2YgdGhlIGdpdmVuIG9uZVxuICogQG1ldGhvZFxuICogQG1lbWJlcm9mIFBvcHBlci5VdGlsc1xuICogQGFyZ3VtZW50IHtTdHJpbmd9IHBsYWNlbWVudCB2YXJpYXRpb25cbiAqIEByZXR1cm5zIHtTdHJpbmd9IGZsaXBwZWQgcGxhY2VtZW50IHZhcmlhdGlvblxuICovXG5mdW5jdGlvbiBnZXRPcHBvc2l0ZVZhcmlhdGlvbih2YXJpYXRpb24pIHtcbiAgaWYgKHZhcmlhdGlvbiA9PT0gJ2VuZCcpIHtcbiAgICByZXR1cm4gJ3N0YXJ0JztcbiAgfSBlbHNlIGlmICh2YXJpYXRpb24gPT09ICdzdGFydCcpIHtcbiAgICByZXR1cm4gJ2VuZCc7XG4gIH1cbiAgcmV0dXJuIHZhcmlhdGlvbjtcbn1cblxuLyoqXG4gKiBMaXN0IG9mIGFjY2VwdGVkIHBsYWNlbWVudHMgdG8gdXNlIGFzIHZhbHVlcyBvZiB0aGUgYHBsYWNlbWVudGAgb3B0aW9uLjxiciAvPlxuICogVmFsaWQgcGxhY2VtZW50cyBhcmU6XG4gKiAtIGBhdXRvYFxuICogLSBgdG9wYFxuICogLSBgcmlnaHRgXG4gKiAtIGBib3R0b21gXG4gKiAtIGBsZWZ0YFxuICpcbiAqIEVhY2ggcGxhY2VtZW50IGNhbiBoYXZlIGEgdmFyaWF0aW9uIGZyb20gdGhpcyBsaXN0OlxuICogLSBgLXN0YXJ0YFxuICogLSBgLWVuZGBcbiAqXG4gKiBWYXJpYXRpb25zIGFyZSBpbnRlcnByZXRlZCBlYXNpbHkgaWYgeW91IHRoaW5rIG9mIHRoZW0gYXMgdGhlIGxlZnQgdG8gcmlnaHRcbiAqIHdyaXR0ZW4gbGFuZ3VhZ2VzLiBIb3Jpem9udGFsbHkgKGB0b3BgIGFuZCBgYm90dG9tYCksIGBzdGFydGAgaXMgbGVmdCBhbmQgYGVuZGBcbiAqIGlzIHJpZ2h0LjxiciAvPlxuICogVmVydGljYWxseSAoYGxlZnRgIGFuZCBgcmlnaHRgKSwgYHN0YXJ0YCBpcyB0b3AgYW5kIGBlbmRgIGlzIGJvdHRvbS5cbiAqXG4gKiBTb21lIHZhbGlkIGV4YW1wbGVzIGFyZTpcbiAqIC0gYHRvcC1lbmRgIChvbiB0b3Agb2YgcmVmZXJlbmNlLCByaWdodCBhbGlnbmVkKVxuICogLSBgcmlnaHQtc3RhcnRgIChvbiByaWdodCBvZiByZWZlcmVuY2UsIHRvcCBhbGlnbmVkKVxuICogLSBgYm90dG9tYCAob24gYm90dG9tLCBjZW50ZXJlZClcbiAqIC0gYGF1dG8tZW5kYCAob24gdGhlIHNpZGUgd2l0aCBtb3JlIHNwYWNlIGF2YWlsYWJsZSwgYWxpZ25tZW50IGRlcGVuZHMgYnkgcGxhY2VtZW50KVxuICpcbiAqIEBzdGF0aWNcbiAqIEB0eXBlIHtBcnJheX1cbiAqIEBlbnVtIHtTdHJpbmd9XG4gKiBAcmVhZG9ubHlcbiAqIEBtZXRob2QgcGxhY2VtZW50c1xuICogQG1lbWJlcm9mIFBvcHBlclxuICovXG52YXIgcGxhY2VtZW50cyA9IFsnYXV0by1zdGFydCcsICdhdXRvJywgJ2F1dG8tZW5kJywgJ3RvcC1zdGFydCcsICd0b3AnLCAndG9wLWVuZCcsICdyaWdodC1zdGFydCcsICdyaWdodCcsICdyaWdodC1lbmQnLCAnYm90dG9tLWVuZCcsICdib3R0b20nLCAnYm90dG9tLXN0YXJ0JywgJ2xlZnQtZW5kJywgJ2xlZnQnLCAnbGVmdC1zdGFydCddO1xuXG4vLyBHZXQgcmlkIG9mIGBhdXRvYCBgYXV0by1zdGFydGAgYW5kIGBhdXRvLWVuZGBcbnZhciB2YWxpZFBsYWNlbWVudHMgPSBwbGFjZW1lbnRzLnNsaWNlKDMpO1xuXG4vKipcbiAqIEdpdmVuIGFuIGluaXRpYWwgcGxhY2VtZW50LCByZXR1cm5zIGFsbCB0aGUgc3Vic2VxdWVudCBwbGFjZW1lbnRzXG4gKiBjbG9ja3dpc2UgKG9yIGNvdW50ZXItY2xvY2t3aXNlKS5cbiAqXG4gKiBAbWV0aG9kXG4gKiBAbWVtYmVyb2YgUG9wcGVyLlV0aWxzXG4gKiBAYXJndW1lbnQge1N0cmluZ30gcGxhY2VtZW50IC0gQSB2YWxpZCBwbGFjZW1lbnQgKGl0IGFjY2VwdHMgdmFyaWF0aW9ucylcbiAqIEBhcmd1bWVudCB7Qm9vbGVhbn0gY291bnRlciAtIFNldCB0byB0cnVlIHRvIHdhbGsgdGhlIHBsYWNlbWVudHMgY291bnRlcmNsb2Nrd2lzZVxuICogQHJldHVybnMge0FycmF5fSBwbGFjZW1lbnRzIGluY2x1ZGluZyB0aGVpciB2YXJpYXRpb25zXG4gKi9cbmZ1bmN0aW9uIGNsb2Nrd2lzZShwbGFjZW1lbnQpIHtcbiAgdmFyIGNvdW50ZXIgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IGZhbHNlO1xuXG4gIHZhciBpbmRleCA9IHZhbGlkUGxhY2VtZW50cy5pbmRleE9mKHBsYWNlbWVudCk7XG4gIHZhciBhcnIgPSB2YWxpZFBsYWNlbWVudHMuc2xpY2UoaW5kZXggKyAxKS5jb25jYXQodmFsaWRQbGFjZW1lbnRzLnNsaWNlKDAsIGluZGV4KSk7XG4gIHJldHVybiBjb3VudGVyID8gYXJyLnJldmVyc2UoKSA6IGFycjtcbn1cblxudmFyIEJFSEFWSU9SUyA9IHtcbiAgRkxJUDogJ2ZsaXAnLFxuICBDTE9DS1dJU0U6ICdjbG9ja3dpc2UnLFxuICBDT1VOVEVSQ0xPQ0tXSVNFOiAnY291bnRlcmNsb2Nrd2lzZSdcbn07XG5cbi8qKlxuICogQGZ1bmN0aW9uXG4gKiBAbWVtYmVyb2YgTW9kaWZpZXJzXG4gKiBAYXJndW1lbnQge09iamVjdH0gZGF0YSAtIFRoZSBkYXRhIG9iamVjdCBnZW5lcmF0ZWQgYnkgdXBkYXRlIG1ldGhvZFxuICogQGFyZ3VtZW50IHtPYmplY3R9IG9wdGlvbnMgLSBNb2RpZmllcnMgY29uZmlndXJhdGlvbiBhbmQgb3B0aW9uc1xuICogQHJldHVybnMge09iamVjdH0gVGhlIGRhdGEgb2JqZWN0LCBwcm9wZXJseSBtb2RpZmllZFxuICovXG5mdW5jdGlvbiBmbGlwKGRhdGEsIG9wdGlvbnMpIHtcbiAgLy8gaWYgYGlubmVyYCBtb2RpZmllciBpcyBlbmFibGVkLCB3ZSBjYW4ndCB1c2UgdGhlIGBmbGlwYCBtb2RpZmllclxuICBpZiAoaXNNb2RpZmllckVuYWJsZWQoZGF0YS5pbnN0YW5jZS5tb2RpZmllcnMsICdpbm5lcicpKSB7XG4gICAgcmV0dXJuIGRhdGE7XG4gIH1cblxuICBpZiAoZGF0YS5mbGlwcGVkICYmIGRhdGEucGxhY2VtZW50ID09PSBkYXRhLm9yaWdpbmFsUGxhY2VtZW50KSB7XG4gICAgLy8gc2VlbXMgbGlrZSBmbGlwIGlzIHRyeWluZyB0byBsb29wLCBwcm9iYWJseSB0aGVyZSdzIG5vdCBlbm91Z2ggc3BhY2Ugb24gYW55IG9mIHRoZSBmbGlwcGFibGUgc2lkZXNcbiAgICByZXR1cm4gZGF0YTtcbiAgfVxuXG4gIHZhciBib3VuZGFyaWVzID0gZ2V0Qm91bmRhcmllcyhkYXRhLmluc3RhbmNlLnBvcHBlciwgZGF0YS5pbnN0YW5jZS5yZWZlcmVuY2UsIG9wdGlvbnMucGFkZGluZywgb3B0aW9ucy5ib3VuZGFyaWVzRWxlbWVudCwgZGF0YS5wb3NpdGlvbkZpeGVkKTtcblxuICB2YXIgcGxhY2VtZW50ID0gZGF0YS5wbGFjZW1lbnQuc3BsaXQoJy0nKVswXTtcbiAgdmFyIHBsYWNlbWVudE9wcG9zaXRlID0gZ2V0T3Bwb3NpdGVQbGFjZW1lbnQocGxhY2VtZW50KTtcbiAgdmFyIHZhcmlhdGlvbiA9IGRhdGEucGxhY2VtZW50LnNwbGl0KCctJylbMV0gfHwgJyc7XG5cbiAgdmFyIGZsaXBPcmRlciA9IFtdO1xuXG4gIHN3aXRjaCAob3B0aW9ucy5iZWhhdmlvcikge1xuICAgIGNhc2UgQkVIQVZJT1JTLkZMSVA6XG4gICAgICBmbGlwT3JkZXIgPSBbcGxhY2VtZW50LCBwbGFjZW1lbnRPcHBvc2l0ZV07XG4gICAgICBicmVhaztcbiAgICBjYXNlIEJFSEFWSU9SUy5DTE9DS1dJU0U6XG4gICAgICBmbGlwT3JkZXIgPSBjbG9ja3dpc2UocGxhY2VtZW50KTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgQkVIQVZJT1JTLkNPVU5URVJDTE9DS1dJU0U6XG4gICAgICBmbGlwT3JkZXIgPSBjbG9ja3dpc2UocGxhY2VtZW50LCB0cnVlKTtcbiAgICAgIGJyZWFrO1xuICAgIGRlZmF1bHQ6XG4gICAgICBmbGlwT3JkZXIgPSBvcHRpb25zLmJlaGF2aW9yO1xuICB9XG5cbiAgZmxpcE9yZGVyLmZvckVhY2goZnVuY3Rpb24gKHN0ZXAsIGluZGV4KSB7XG4gICAgaWYgKHBsYWNlbWVudCAhPT0gc3RlcCB8fCBmbGlwT3JkZXIubGVuZ3RoID09PSBpbmRleCArIDEpIHtcbiAgICAgIHJldHVybiBkYXRhO1xuICAgIH1cblxuICAgIHBsYWNlbWVudCA9IGRhdGEucGxhY2VtZW50LnNwbGl0KCctJylbMF07XG4gICAgcGxhY2VtZW50T3Bwb3NpdGUgPSBnZXRPcHBvc2l0ZVBsYWNlbWVudChwbGFjZW1lbnQpO1xuXG4gICAgdmFyIHBvcHBlck9mZnNldHMgPSBkYXRhLm9mZnNldHMucG9wcGVyO1xuICAgIHZhciByZWZPZmZzZXRzID0gZGF0YS5vZmZzZXRzLnJlZmVyZW5jZTtcblxuICAgIC8vIHVzaW5nIGZsb29yIGJlY2F1c2UgdGhlIHJlZmVyZW5jZSBvZmZzZXRzIG1heSBjb250YWluIGRlY2ltYWxzIHdlIGFyZSBub3QgZ29pbmcgdG8gY29uc2lkZXIgaGVyZVxuICAgIHZhciBmbG9vciA9IE1hdGguZmxvb3I7XG4gICAgdmFyIG92ZXJsYXBzUmVmID0gcGxhY2VtZW50ID09PSAnbGVmdCcgJiYgZmxvb3IocG9wcGVyT2Zmc2V0cy5yaWdodCkgPiBmbG9vcihyZWZPZmZzZXRzLmxlZnQpIHx8IHBsYWNlbWVudCA9PT0gJ3JpZ2h0JyAmJiBmbG9vcihwb3BwZXJPZmZzZXRzLmxlZnQpIDwgZmxvb3IocmVmT2Zmc2V0cy5yaWdodCkgfHwgcGxhY2VtZW50ID09PSAndG9wJyAmJiBmbG9vcihwb3BwZXJPZmZzZXRzLmJvdHRvbSkgPiBmbG9vcihyZWZPZmZzZXRzLnRvcCkgfHwgcGxhY2VtZW50ID09PSAnYm90dG9tJyAmJiBmbG9vcihwb3BwZXJPZmZzZXRzLnRvcCkgPCBmbG9vcihyZWZPZmZzZXRzLmJvdHRvbSk7XG5cbiAgICB2YXIgb3ZlcmZsb3dzTGVmdCA9IGZsb29yKHBvcHBlck9mZnNldHMubGVmdCkgPCBmbG9vcihib3VuZGFyaWVzLmxlZnQpO1xuICAgIHZhciBvdmVyZmxvd3NSaWdodCA9IGZsb29yKHBvcHBlck9mZnNldHMucmlnaHQpID4gZmxvb3IoYm91bmRhcmllcy5yaWdodCk7XG4gICAgdmFyIG92ZXJmbG93c1RvcCA9IGZsb29yKHBvcHBlck9mZnNldHMudG9wKSA8IGZsb29yKGJvdW5kYXJpZXMudG9wKTtcbiAgICB2YXIgb3ZlcmZsb3dzQm90dG9tID0gZmxvb3IocG9wcGVyT2Zmc2V0cy5ib3R0b20pID4gZmxvb3IoYm91bmRhcmllcy5ib3R0b20pO1xuXG4gICAgdmFyIG92ZXJmbG93c0JvdW5kYXJpZXMgPSBwbGFjZW1lbnQgPT09ICdsZWZ0JyAmJiBvdmVyZmxvd3NMZWZ0IHx8IHBsYWNlbWVudCA9PT0gJ3JpZ2h0JyAmJiBvdmVyZmxvd3NSaWdodCB8fCBwbGFjZW1lbnQgPT09ICd0b3AnICYmIG92ZXJmbG93c1RvcCB8fCBwbGFjZW1lbnQgPT09ICdib3R0b20nICYmIG92ZXJmbG93c0JvdHRvbTtcblxuICAgIC8vIGZsaXAgdGhlIHZhcmlhdGlvbiBpZiByZXF1aXJlZFxuICAgIHZhciBpc1ZlcnRpY2FsID0gWyd0b3AnLCAnYm90dG9tJ10uaW5kZXhPZihwbGFjZW1lbnQpICE9PSAtMTtcbiAgICB2YXIgZmxpcHBlZFZhcmlhdGlvbiA9ICEhb3B0aW9ucy5mbGlwVmFyaWF0aW9ucyAmJiAoaXNWZXJ0aWNhbCAmJiB2YXJpYXRpb24gPT09ICdzdGFydCcgJiYgb3ZlcmZsb3dzTGVmdCB8fCBpc1ZlcnRpY2FsICYmIHZhcmlhdGlvbiA9PT0gJ2VuZCcgJiYgb3ZlcmZsb3dzUmlnaHQgfHwgIWlzVmVydGljYWwgJiYgdmFyaWF0aW9uID09PSAnc3RhcnQnICYmIG92ZXJmbG93c1RvcCB8fCAhaXNWZXJ0aWNhbCAmJiB2YXJpYXRpb24gPT09ICdlbmQnICYmIG92ZXJmbG93c0JvdHRvbSk7XG5cbiAgICBpZiAob3ZlcmxhcHNSZWYgfHwgb3ZlcmZsb3dzQm91bmRhcmllcyB8fCBmbGlwcGVkVmFyaWF0aW9uKSB7XG4gICAgICAvLyB0aGlzIGJvb2xlYW4gdG8gZGV0ZWN0IGFueSBmbGlwIGxvb3BcbiAgICAgIGRhdGEuZmxpcHBlZCA9IHRydWU7XG5cbiAgICAgIGlmIChvdmVybGFwc1JlZiB8fCBvdmVyZmxvd3NCb3VuZGFyaWVzKSB7XG4gICAgICAgIHBsYWNlbWVudCA9IGZsaXBPcmRlcltpbmRleCArIDFdO1xuICAgICAgfVxuXG4gICAgICBpZiAoZmxpcHBlZFZhcmlhdGlvbikge1xuICAgICAgICB2YXJpYXRpb24gPSBnZXRPcHBvc2l0ZVZhcmlhdGlvbih2YXJpYXRpb24pO1xuICAgICAgfVxuXG4gICAgICBkYXRhLnBsYWNlbWVudCA9IHBsYWNlbWVudCArICh2YXJpYXRpb24gPyAnLScgKyB2YXJpYXRpb24gOiAnJyk7XG5cbiAgICAgIC8vIHRoaXMgb2JqZWN0IGNvbnRhaW5zIGBwb3NpdGlvbmAsIHdlIHdhbnQgdG8gcHJlc2VydmUgaXQgYWxvbmcgd2l0aFxuICAgICAgLy8gYW55IGFkZGl0aW9uYWwgcHJvcGVydHkgd2UgbWF5IGFkZCBpbiB0aGUgZnV0dXJlXG4gICAgICBkYXRhLm9mZnNldHMucG9wcGVyID0gX2V4dGVuZHMoe30sIGRhdGEub2Zmc2V0cy5wb3BwZXIsIGdldFBvcHBlck9mZnNldHMoZGF0YS5pbnN0YW5jZS5wb3BwZXIsIGRhdGEub2Zmc2V0cy5yZWZlcmVuY2UsIGRhdGEucGxhY2VtZW50KSk7XG5cbiAgICAgIGRhdGEgPSBydW5Nb2RpZmllcnMoZGF0YS5pbnN0YW5jZS5tb2RpZmllcnMsIGRhdGEsICdmbGlwJyk7XG4gICAgfVxuICB9KTtcbiAgcmV0dXJuIGRhdGE7XG59XG5cbi8qKlxuICogQGZ1bmN0aW9uXG4gKiBAbWVtYmVyb2YgTW9kaWZpZXJzXG4gKiBAYXJndW1lbnQge09iamVjdH0gZGF0YSAtIFRoZSBkYXRhIG9iamVjdCBnZW5lcmF0ZWQgYnkgdXBkYXRlIG1ldGhvZFxuICogQGFyZ3VtZW50IHtPYmplY3R9IG9wdGlvbnMgLSBNb2RpZmllcnMgY29uZmlndXJhdGlvbiBhbmQgb3B0aW9uc1xuICogQHJldHVybnMge09iamVjdH0gVGhlIGRhdGEgb2JqZWN0LCBwcm9wZXJseSBtb2RpZmllZFxuICovXG5mdW5jdGlvbiBrZWVwVG9nZXRoZXIoZGF0YSkge1xuICB2YXIgX2RhdGEkb2Zmc2V0cyA9IGRhdGEub2Zmc2V0cyxcbiAgICAgIHBvcHBlciA9IF9kYXRhJG9mZnNldHMucG9wcGVyLFxuICAgICAgcmVmZXJlbmNlID0gX2RhdGEkb2Zmc2V0cy5yZWZlcmVuY2U7XG5cbiAgdmFyIHBsYWNlbWVudCA9IGRhdGEucGxhY2VtZW50LnNwbGl0KCctJylbMF07XG4gIHZhciBmbG9vciA9IE1hdGguZmxvb3I7XG4gIHZhciBpc1ZlcnRpY2FsID0gWyd0b3AnLCAnYm90dG9tJ10uaW5kZXhPZihwbGFjZW1lbnQpICE9PSAtMTtcbiAgdmFyIHNpZGUgPSBpc1ZlcnRpY2FsID8gJ3JpZ2h0JyA6ICdib3R0b20nO1xuICB2YXIgb3BTaWRlID0gaXNWZXJ0aWNhbCA/ICdsZWZ0JyA6ICd0b3AnO1xuICB2YXIgbWVhc3VyZW1lbnQgPSBpc1ZlcnRpY2FsID8gJ3dpZHRoJyA6ICdoZWlnaHQnO1xuXG4gIGlmIChwb3BwZXJbc2lkZV0gPCBmbG9vcihyZWZlcmVuY2Vbb3BTaWRlXSkpIHtcbiAgICBkYXRhLm9mZnNldHMucG9wcGVyW29wU2lkZV0gPSBmbG9vcihyZWZlcmVuY2Vbb3BTaWRlXSkgLSBwb3BwZXJbbWVhc3VyZW1lbnRdO1xuICB9XG4gIGlmIChwb3BwZXJbb3BTaWRlXSA+IGZsb29yKHJlZmVyZW5jZVtzaWRlXSkpIHtcbiAgICBkYXRhLm9mZnNldHMucG9wcGVyW29wU2lkZV0gPSBmbG9vcihyZWZlcmVuY2Vbc2lkZV0pO1xuICB9XG5cbiAgcmV0dXJuIGRhdGE7XG59XG5cbi8qKlxuICogQ29udmVydHMgYSBzdHJpbmcgY29udGFpbmluZyB2YWx1ZSArIHVuaXQgaW50byBhIHB4IHZhbHVlIG51bWJlclxuICogQGZ1bmN0aW9uXG4gKiBAbWVtYmVyb2Yge21vZGlmaWVyc35vZmZzZXR9XG4gKiBAcHJpdmF0ZVxuICogQGFyZ3VtZW50IHtTdHJpbmd9IHN0ciAtIFZhbHVlICsgdW5pdCBzdHJpbmdcbiAqIEBhcmd1bWVudCB7U3RyaW5nfSBtZWFzdXJlbWVudCAtIGBoZWlnaHRgIG9yIGB3aWR0aGBcbiAqIEBhcmd1bWVudCB7T2JqZWN0fSBwb3BwZXJPZmZzZXRzXG4gKiBAYXJndW1lbnQge09iamVjdH0gcmVmZXJlbmNlT2Zmc2V0c1xuICogQHJldHVybnMge051bWJlcnxTdHJpbmd9XG4gKiBWYWx1ZSBpbiBwaXhlbHMsIG9yIG9yaWdpbmFsIHN0cmluZyBpZiBubyB2YWx1ZXMgd2VyZSBleHRyYWN0ZWRcbiAqL1xuZnVuY3Rpb24gdG9WYWx1ZShzdHIsIG1lYXN1cmVtZW50LCBwb3BwZXJPZmZzZXRzLCByZWZlcmVuY2VPZmZzZXRzKSB7XG4gIC8vIHNlcGFyYXRlIHZhbHVlIGZyb20gdW5pdFxuICB2YXIgc3BsaXQgPSBzdHIubWF0Y2goLygoPzpcXC18XFwrKT9cXGQqXFwuP1xcZCopKC4qKS8pO1xuICB2YXIgdmFsdWUgPSArc3BsaXRbMV07XG4gIHZhciB1bml0ID0gc3BsaXRbMl07XG5cbiAgLy8gSWYgaXQncyBub3QgYSBudW1iZXIgaXQncyBhbiBvcGVyYXRvciwgSSBndWVzc1xuICBpZiAoIXZhbHVlKSB7XG4gICAgcmV0dXJuIHN0cjtcbiAgfVxuXG4gIGlmICh1bml0LmluZGV4T2YoJyUnKSA9PT0gMCkge1xuICAgIHZhciBlbGVtZW50ID0gdm9pZCAwO1xuICAgIHN3aXRjaCAodW5pdCkge1xuICAgICAgY2FzZSAnJXAnOlxuICAgICAgICBlbGVtZW50ID0gcG9wcGVyT2Zmc2V0cztcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICclJzpcbiAgICAgIGNhc2UgJyVyJzpcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIGVsZW1lbnQgPSByZWZlcmVuY2VPZmZzZXRzO1xuICAgIH1cblxuICAgIHZhciByZWN0ID0gZ2V0Q2xpZW50UmVjdChlbGVtZW50KTtcbiAgICByZXR1cm4gcmVjdFttZWFzdXJlbWVudF0gLyAxMDAgKiB2YWx1ZTtcbiAgfSBlbHNlIGlmICh1bml0ID09PSAndmgnIHx8IHVuaXQgPT09ICd2dycpIHtcbiAgICAvLyBpZiBpcyBhIHZoIG9yIHZ3LCB3ZSBjYWxjdWxhdGUgdGhlIHNpemUgYmFzZWQgb24gdGhlIHZpZXdwb3J0XG4gICAgdmFyIHNpemUgPSB2b2lkIDA7XG4gICAgaWYgKHVuaXQgPT09ICd2aCcpIHtcbiAgICAgIHNpemUgPSBNYXRoLm1heChkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0LCB3aW5kb3cuaW5uZXJIZWlnaHQgfHwgMCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHNpemUgPSBNYXRoLm1heChkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGgsIHdpbmRvdy5pbm5lcldpZHRoIHx8IDApO1xuICAgIH1cbiAgICByZXR1cm4gc2l6ZSAvIDEwMCAqIHZhbHVlO1xuICB9IGVsc2Uge1xuICAgIC8vIGlmIGlzIGFuIGV4cGxpY2l0IHBpeGVsIHVuaXQsIHdlIGdldCByaWQgb2YgdGhlIHVuaXQgYW5kIGtlZXAgdGhlIHZhbHVlXG4gICAgLy8gaWYgaXMgYW4gaW1wbGljaXQgdW5pdCwgaXQncyBweCwgYW5kIHdlIHJldHVybiBqdXN0IHRoZSB2YWx1ZVxuICAgIHJldHVybiB2YWx1ZTtcbiAgfVxufVxuXG4vKipcbiAqIFBhcnNlIGFuIGBvZmZzZXRgIHN0cmluZyB0byBleHRyYXBvbGF0ZSBgeGAgYW5kIGB5YCBudW1lcmljIG9mZnNldHMuXG4gKiBAZnVuY3Rpb25cbiAqIEBtZW1iZXJvZiB7bW9kaWZpZXJzfm9mZnNldH1cbiAqIEBwcml2YXRlXG4gKiBAYXJndW1lbnQge1N0cmluZ30gb2Zmc2V0XG4gKiBAYXJndW1lbnQge09iamVjdH0gcG9wcGVyT2Zmc2V0c1xuICogQGFyZ3VtZW50IHtPYmplY3R9IHJlZmVyZW5jZU9mZnNldHNcbiAqIEBhcmd1bWVudCB7U3RyaW5nfSBiYXNlUGxhY2VtZW50XG4gKiBAcmV0dXJucyB7QXJyYXl9IGEgdHdvIGNlbGxzIGFycmF5IHdpdGggeCBhbmQgeSBvZmZzZXRzIGluIG51bWJlcnNcbiAqL1xuZnVuY3Rpb24gcGFyc2VPZmZzZXQob2Zmc2V0LCBwb3BwZXJPZmZzZXRzLCByZWZlcmVuY2VPZmZzZXRzLCBiYXNlUGxhY2VtZW50KSB7XG4gIHZhciBvZmZzZXRzID0gWzAsIDBdO1xuXG4gIC8vIFVzZSBoZWlnaHQgaWYgcGxhY2VtZW50IGlzIGxlZnQgb3IgcmlnaHQgYW5kIGluZGV4IGlzIDAgb3RoZXJ3aXNlIHVzZSB3aWR0aFxuICAvLyBpbiB0aGlzIHdheSB0aGUgZmlyc3Qgb2Zmc2V0IHdpbGwgdXNlIGFuIGF4aXMgYW5kIHRoZSBzZWNvbmQgb25lXG4gIC8vIHdpbGwgdXNlIHRoZSBvdGhlciBvbmVcbiAgdmFyIHVzZUhlaWdodCA9IFsncmlnaHQnLCAnbGVmdCddLmluZGV4T2YoYmFzZVBsYWNlbWVudCkgIT09IC0xO1xuXG4gIC8vIFNwbGl0IHRoZSBvZmZzZXQgc3RyaW5nIHRvIG9idGFpbiBhIGxpc3Qgb2YgdmFsdWVzIGFuZCBvcGVyYW5kc1xuICAvLyBUaGUgcmVnZXggYWRkcmVzc2VzIHZhbHVlcyB3aXRoIHRoZSBwbHVzIG9yIG1pbnVzIHNpZ24gaW4gZnJvbnQgKCsxMCwgLTIwLCBldGMpXG4gIHZhciBmcmFnbWVudHMgPSBvZmZzZXQuc3BsaXQoLyhcXCt8XFwtKS8pLm1hcChmdW5jdGlvbiAoZnJhZykge1xuICAgIHJldHVybiBmcmFnLnRyaW0oKTtcbiAgfSk7XG5cbiAgLy8gRGV0ZWN0IGlmIHRoZSBvZmZzZXQgc3RyaW5nIGNvbnRhaW5zIGEgcGFpciBvZiB2YWx1ZXMgb3IgYSBzaW5nbGUgb25lXG4gIC8vIHRoZXkgY291bGQgYmUgc2VwYXJhdGVkIGJ5IGNvbW1hIG9yIHNwYWNlXG4gIHZhciBkaXZpZGVyID0gZnJhZ21lbnRzLmluZGV4T2YoZmluZChmcmFnbWVudHMsIGZ1bmN0aW9uIChmcmFnKSB7XG4gICAgcmV0dXJuIGZyYWcuc2VhcmNoKC8sfFxccy8pICE9PSAtMTtcbiAgfSkpO1xuXG4gIGlmIChmcmFnbWVudHNbZGl2aWRlcl0gJiYgZnJhZ21lbnRzW2RpdmlkZXJdLmluZGV4T2YoJywnKSA9PT0gLTEpIHtcbiAgICBjb25zb2xlLndhcm4oJ09mZnNldHMgc2VwYXJhdGVkIGJ5IHdoaXRlIHNwYWNlKHMpIGFyZSBkZXByZWNhdGVkLCB1c2UgYSBjb21tYSAoLCkgaW5zdGVhZC4nKTtcbiAgfVxuXG4gIC8vIElmIGRpdmlkZXIgaXMgZm91bmQsIHdlIGRpdmlkZSB0aGUgbGlzdCBvZiB2YWx1ZXMgYW5kIG9wZXJhbmRzIHRvIGRpdmlkZVxuICAvLyB0aGVtIGJ5IG9mc2V0IFggYW5kIFkuXG4gIHZhciBzcGxpdFJlZ2V4ID0gL1xccyosXFxzKnxcXHMrLztcbiAgdmFyIG9wcyA9IGRpdmlkZXIgIT09IC0xID8gW2ZyYWdtZW50cy5zbGljZSgwLCBkaXZpZGVyKS5jb25jYXQoW2ZyYWdtZW50c1tkaXZpZGVyXS5zcGxpdChzcGxpdFJlZ2V4KVswXV0pLCBbZnJhZ21lbnRzW2RpdmlkZXJdLnNwbGl0KHNwbGl0UmVnZXgpWzFdXS5jb25jYXQoZnJhZ21lbnRzLnNsaWNlKGRpdmlkZXIgKyAxKSldIDogW2ZyYWdtZW50c107XG5cbiAgLy8gQ29udmVydCB0aGUgdmFsdWVzIHdpdGggdW5pdHMgdG8gYWJzb2x1dGUgcGl4ZWxzIHRvIGFsbG93IG91ciBjb21wdXRhdGlvbnNcbiAgb3BzID0gb3BzLm1hcChmdW5jdGlvbiAob3AsIGluZGV4KSB7XG4gICAgLy8gTW9zdCBvZiB0aGUgdW5pdHMgcmVseSBvbiB0aGUgb3JpZW50YXRpb24gb2YgdGhlIHBvcHBlclxuICAgIHZhciBtZWFzdXJlbWVudCA9IChpbmRleCA9PT0gMSA/ICF1c2VIZWlnaHQgOiB1c2VIZWlnaHQpID8gJ2hlaWdodCcgOiAnd2lkdGgnO1xuICAgIHZhciBtZXJnZVdpdGhQcmV2aW91cyA9IGZhbHNlO1xuICAgIHJldHVybiBvcFxuICAgIC8vIFRoaXMgYWdncmVnYXRlcyBhbnkgYCtgIG9yIGAtYCBzaWduIHRoYXQgYXJlbid0IGNvbnNpZGVyZWQgb3BlcmF0b3JzXG4gICAgLy8gZS5nLjogMTAgKyArNSA9PiBbMTAsICssICs1XVxuICAgIC5yZWR1Y2UoZnVuY3Rpb24gKGEsIGIpIHtcbiAgICAgIGlmIChhW2EubGVuZ3RoIC0gMV0gPT09ICcnICYmIFsnKycsICctJ10uaW5kZXhPZihiKSAhPT0gLTEpIHtcbiAgICAgICAgYVthLmxlbmd0aCAtIDFdID0gYjtcbiAgICAgICAgbWVyZ2VXaXRoUHJldmlvdXMgPSB0cnVlO1xuICAgICAgICByZXR1cm4gYTtcbiAgICAgIH0gZWxzZSBpZiAobWVyZ2VXaXRoUHJldmlvdXMpIHtcbiAgICAgICAgYVthLmxlbmd0aCAtIDFdICs9IGI7XG4gICAgICAgIG1lcmdlV2l0aFByZXZpb3VzID0gZmFsc2U7XG4gICAgICAgIHJldHVybiBhO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGEuY29uY2F0KGIpO1xuICAgICAgfVxuICAgIH0sIFtdKVxuICAgIC8vIEhlcmUgd2UgY29udmVydCB0aGUgc3RyaW5nIHZhbHVlcyBpbnRvIG51bWJlciB2YWx1ZXMgKGluIHB4KVxuICAgIC5tYXAoZnVuY3Rpb24gKHN0cikge1xuICAgICAgcmV0dXJuIHRvVmFsdWUoc3RyLCBtZWFzdXJlbWVudCwgcG9wcGVyT2Zmc2V0cywgcmVmZXJlbmNlT2Zmc2V0cyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIC8vIExvb3AgdHJvdWdoIHRoZSBvZmZzZXRzIGFycmF5cyBhbmQgZXhlY3V0ZSB0aGUgb3BlcmF0aW9uc1xuICBvcHMuZm9yRWFjaChmdW5jdGlvbiAob3AsIGluZGV4KSB7XG4gICAgb3AuZm9yRWFjaChmdW5jdGlvbiAoZnJhZywgaW5kZXgyKSB7XG4gICAgICBpZiAoaXNOdW1lcmljKGZyYWcpKSB7XG4gICAgICAgIG9mZnNldHNbaW5kZXhdICs9IGZyYWcgKiAob3BbaW5kZXgyIC0gMV0gPT09ICctJyA/IC0xIDogMSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0pO1xuICByZXR1cm4gb2Zmc2V0cztcbn1cblxuLyoqXG4gKiBAZnVuY3Rpb25cbiAqIEBtZW1iZXJvZiBNb2RpZmllcnNcbiAqIEBhcmd1bWVudCB7T2JqZWN0fSBkYXRhIC0gVGhlIGRhdGEgb2JqZWN0IGdlbmVyYXRlZCBieSB1cGRhdGUgbWV0aG9kXG4gKiBAYXJndW1lbnQge09iamVjdH0gb3B0aW9ucyAtIE1vZGlmaWVycyBjb25maWd1cmF0aW9uIGFuZCBvcHRpb25zXG4gKiBAYXJndW1lbnQge051bWJlcnxTdHJpbmd9IG9wdGlvbnMub2Zmc2V0PTBcbiAqIFRoZSBvZmZzZXQgdmFsdWUgYXMgZGVzY3JpYmVkIGluIHRoZSBtb2RpZmllciBkZXNjcmlwdGlvblxuICogQHJldHVybnMge09iamVjdH0gVGhlIGRhdGEgb2JqZWN0LCBwcm9wZXJseSBtb2RpZmllZFxuICovXG5mdW5jdGlvbiBvZmZzZXQoZGF0YSwgX3JlZikge1xuICB2YXIgb2Zmc2V0ID0gX3JlZi5vZmZzZXQ7XG4gIHZhciBwbGFjZW1lbnQgPSBkYXRhLnBsYWNlbWVudCxcbiAgICAgIF9kYXRhJG9mZnNldHMgPSBkYXRhLm9mZnNldHMsXG4gICAgICBwb3BwZXIgPSBfZGF0YSRvZmZzZXRzLnBvcHBlcixcbiAgICAgIHJlZmVyZW5jZSA9IF9kYXRhJG9mZnNldHMucmVmZXJlbmNlO1xuXG4gIHZhciBiYXNlUGxhY2VtZW50ID0gcGxhY2VtZW50LnNwbGl0KCctJylbMF07XG5cbiAgdmFyIG9mZnNldHMgPSB2b2lkIDA7XG4gIGlmIChpc051bWVyaWMoK29mZnNldCkpIHtcbiAgICBvZmZzZXRzID0gWytvZmZzZXQsIDBdO1xuICB9IGVsc2Uge1xuICAgIG9mZnNldHMgPSBwYXJzZU9mZnNldChvZmZzZXQsIHBvcHBlciwgcmVmZXJlbmNlLCBiYXNlUGxhY2VtZW50KTtcbiAgfVxuXG4gIGlmIChiYXNlUGxhY2VtZW50ID09PSAnbGVmdCcpIHtcbiAgICBwb3BwZXIudG9wICs9IG9mZnNldHNbMF07XG4gICAgcG9wcGVyLmxlZnQgLT0gb2Zmc2V0c1sxXTtcbiAgfSBlbHNlIGlmIChiYXNlUGxhY2VtZW50ID09PSAncmlnaHQnKSB7XG4gICAgcG9wcGVyLnRvcCArPSBvZmZzZXRzWzBdO1xuICAgIHBvcHBlci5sZWZ0ICs9IG9mZnNldHNbMV07XG4gIH0gZWxzZSBpZiAoYmFzZVBsYWNlbWVudCA9PT0gJ3RvcCcpIHtcbiAgICBwb3BwZXIubGVmdCArPSBvZmZzZXRzWzBdO1xuICAgIHBvcHBlci50b3AgLT0gb2Zmc2V0c1sxXTtcbiAgfSBlbHNlIGlmIChiYXNlUGxhY2VtZW50ID09PSAnYm90dG9tJykge1xuICAgIHBvcHBlci5sZWZ0ICs9IG9mZnNldHNbMF07XG4gICAgcG9wcGVyLnRvcCArPSBvZmZzZXRzWzFdO1xuICB9XG5cbiAgZGF0YS5wb3BwZXIgPSBwb3BwZXI7XG4gIHJldHVybiBkYXRhO1xufVxuXG4vKipcbiAqIEBmdW5jdGlvblxuICogQG1lbWJlcm9mIE1vZGlmaWVyc1xuICogQGFyZ3VtZW50IHtPYmplY3R9IGRhdGEgLSBUaGUgZGF0YSBvYmplY3QgZ2VuZXJhdGVkIGJ5IGB1cGRhdGVgIG1ldGhvZFxuICogQGFyZ3VtZW50IHtPYmplY3R9IG9wdGlvbnMgLSBNb2RpZmllcnMgY29uZmlndXJhdGlvbiBhbmQgb3B0aW9uc1xuICogQHJldHVybnMge09iamVjdH0gVGhlIGRhdGEgb2JqZWN0LCBwcm9wZXJseSBtb2RpZmllZFxuICovXG5mdW5jdGlvbiBwcmV2ZW50T3ZlcmZsb3coZGF0YSwgb3B0aW9ucykge1xuICB2YXIgYm91bmRhcmllc0VsZW1lbnQgPSBvcHRpb25zLmJvdW5kYXJpZXNFbGVtZW50IHx8IGdldE9mZnNldFBhcmVudChkYXRhLmluc3RhbmNlLnBvcHBlcik7XG5cbiAgLy8gSWYgb2Zmc2V0UGFyZW50IGlzIHRoZSByZWZlcmVuY2UgZWxlbWVudCwgd2UgcmVhbGx5IHdhbnQgdG9cbiAgLy8gZ28gb25lIHN0ZXAgdXAgYW5kIHVzZSB0aGUgbmV4dCBvZmZzZXRQYXJlbnQgYXMgcmVmZXJlbmNlIHRvXG4gIC8vIGF2b2lkIHRvIG1ha2UgdGhpcyBtb2RpZmllciBjb21wbGV0ZWx5IHVzZWxlc3MgYW5kIGxvb2sgbGlrZSBicm9rZW5cbiAgaWYgKGRhdGEuaW5zdGFuY2UucmVmZXJlbmNlID09PSBib3VuZGFyaWVzRWxlbWVudCkge1xuICAgIGJvdW5kYXJpZXNFbGVtZW50ID0gZ2V0T2Zmc2V0UGFyZW50KGJvdW5kYXJpZXNFbGVtZW50KTtcbiAgfVxuXG4gIC8vIE5PVEU6IERPTSBhY2Nlc3MgaGVyZVxuICAvLyByZXNldHMgdGhlIHBvcHBlcidzIHBvc2l0aW9uIHNvIHRoYXQgdGhlIGRvY3VtZW50IHNpemUgY2FuIGJlIGNhbGN1bGF0ZWQgZXhjbHVkaW5nXG4gIC8vIHRoZSBzaXplIG9mIHRoZSBwb3BwZXIgZWxlbWVudCBpdHNlbGZcbiAgdmFyIHRyYW5zZm9ybVByb3AgPSBnZXRTdXBwb3J0ZWRQcm9wZXJ0eU5hbWUoJ3RyYW5zZm9ybScpO1xuICB2YXIgcG9wcGVyU3R5bGVzID0gZGF0YS5pbnN0YW5jZS5wb3BwZXIuc3R5bGU7IC8vIGFzc2lnbm1lbnQgdG8gaGVscCBtaW5pZmljYXRpb25cbiAgdmFyIHRvcCA9IHBvcHBlclN0eWxlcy50b3AsXG4gICAgICBsZWZ0ID0gcG9wcGVyU3R5bGVzLmxlZnQsXG4gICAgICB0cmFuc2Zvcm0gPSBwb3BwZXJTdHlsZXNbdHJhbnNmb3JtUHJvcF07XG5cbiAgcG9wcGVyU3R5bGVzLnRvcCA9ICcnO1xuICBwb3BwZXJTdHlsZXMubGVmdCA9ICcnO1xuICBwb3BwZXJTdHlsZXNbdHJhbnNmb3JtUHJvcF0gPSAnJztcblxuICB2YXIgYm91bmRhcmllcyA9IGdldEJvdW5kYXJpZXMoZGF0YS5pbnN0YW5jZS5wb3BwZXIsIGRhdGEuaW5zdGFuY2UucmVmZXJlbmNlLCBvcHRpb25zLnBhZGRpbmcsIGJvdW5kYXJpZXNFbGVtZW50LCBkYXRhLnBvc2l0aW9uRml4ZWQpO1xuXG4gIC8vIE5PVEU6IERPTSBhY2Nlc3MgaGVyZVxuICAvLyByZXN0b3JlcyB0aGUgb3JpZ2luYWwgc3R5bGUgcHJvcGVydGllcyBhZnRlciB0aGUgb2Zmc2V0cyBoYXZlIGJlZW4gY29tcHV0ZWRcbiAgcG9wcGVyU3R5bGVzLnRvcCA9IHRvcDtcbiAgcG9wcGVyU3R5bGVzLmxlZnQgPSBsZWZ0O1xuICBwb3BwZXJTdHlsZXNbdHJhbnNmb3JtUHJvcF0gPSB0cmFuc2Zvcm07XG5cbiAgb3B0aW9ucy5ib3VuZGFyaWVzID0gYm91bmRhcmllcztcblxuICB2YXIgb3JkZXIgPSBvcHRpb25zLnByaW9yaXR5O1xuICB2YXIgcG9wcGVyID0gZGF0YS5vZmZzZXRzLnBvcHBlcjtcblxuICB2YXIgY2hlY2sgPSB7XG4gICAgcHJpbWFyeTogZnVuY3Rpb24gcHJpbWFyeShwbGFjZW1lbnQpIHtcbiAgICAgIHZhciB2YWx1ZSA9IHBvcHBlcltwbGFjZW1lbnRdO1xuICAgICAgaWYgKHBvcHBlcltwbGFjZW1lbnRdIDwgYm91bmRhcmllc1twbGFjZW1lbnRdICYmICFvcHRpb25zLmVzY2FwZVdpdGhSZWZlcmVuY2UpIHtcbiAgICAgICAgdmFsdWUgPSBNYXRoLm1heChwb3BwZXJbcGxhY2VtZW50XSwgYm91bmRhcmllc1twbGFjZW1lbnRdKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBkZWZpbmVQcm9wZXJ0eSh7fSwgcGxhY2VtZW50LCB2YWx1ZSk7XG4gICAgfSxcbiAgICBzZWNvbmRhcnk6IGZ1bmN0aW9uIHNlY29uZGFyeShwbGFjZW1lbnQpIHtcbiAgICAgIHZhciBtYWluU2lkZSA9IHBsYWNlbWVudCA9PT0gJ3JpZ2h0JyA/ICdsZWZ0JyA6ICd0b3AnO1xuICAgICAgdmFyIHZhbHVlID0gcG9wcGVyW21haW5TaWRlXTtcbiAgICAgIGlmIChwb3BwZXJbcGxhY2VtZW50XSA+IGJvdW5kYXJpZXNbcGxhY2VtZW50XSAmJiAhb3B0aW9ucy5lc2NhcGVXaXRoUmVmZXJlbmNlKSB7XG4gICAgICAgIHZhbHVlID0gTWF0aC5taW4ocG9wcGVyW21haW5TaWRlXSwgYm91bmRhcmllc1twbGFjZW1lbnRdIC0gKHBsYWNlbWVudCA9PT0gJ3JpZ2h0JyA/IHBvcHBlci53aWR0aCA6IHBvcHBlci5oZWlnaHQpKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBkZWZpbmVQcm9wZXJ0eSh7fSwgbWFpblNpZGUsIHZhbHVlKTtcbiAgICB9XG4gIH07XG5cbiAgb3JkZXIuZm9yRWFjaChmdW5jdGlvbiAocGxhY2VtZW50KSB7XG4gICAgdmFyIHNpZGUgPSBbJ2xlZnQnLCAndG9wJ10uaW5kZXhPZihwbGFjZW1lbnQpICE9PSAtMSA/ICdwcmltYXJ5JyA6ICdzZWNvbmRhcnknO1xuICAgIHBvcHBlciA9IF9leHRlbmRzKHt9LCBwb3BwZXIsIGNoZWNrW3NpZGVdKHBsYWNlbWVudCkpO1xuICB9KTtcblxuICBkYXRhLm9mZnNldHMucG9wcGVyID0gcG9wcGVyO1xuXG4gIHJldHVybiBkYXRhO1xufVxuXG4vKipcbiAqIEBmdW5jdGlvblxuICogQG1lbWJlcm9mIE1vZGlmaWVyc1xuICogQGFyZ3VtZW50IHtPYmplY3R9IGRhdGEgLSBUaGUgZGF0YSBvYmplY3QgZ2VuZXJhdGVkIGJ5IGB1cGRhdGVgIG1ldGhvZFxuICogQGFyZ3VtZW50IHtPYmplY3R9IG9wdGlvbnMgLSBNb2RpZmllcnMgY29uZmlndXJhdGlvbiBhbmQgb3B0aW9uc1xuICogQHJldHVybnMge09iamVjdH0gVGhlIGRhdGEgb2JqZWN0LCBwcm9wZXJseSBtb2RpZmllZFxuICovXG5mdW5jdGlvbiBzaGlmdChkYXRhKSB7XG4gIHZhciBwbGFjZW1lbnQgPSBkYXRhLnBsYWNlbWVudDtcbiAgdmFyIGJhc2VQbGFjZW1lbnQgPSBwbGFjZW1lbnQuc3BsaXQoJy0nKVswXTtcbiAgdmFyIHNoaWZ0dmFyaWF0aW9uID0gcGxhY2VtZW50LnNwbGl0KCctJylbMV07XG5cbiAgLy8gaWYgc2hpZnQgc2hpZnR2YXJpYXRpb24gaXMgc3BlY2lmaWVkLCBydW4gdGhlIG1vZGlmaWVyXG4gIGlmIChzaGlmdHZhcmlhdGlvbikge1xuICAgIHZhciBfZGF0YSRvZmZzZXRzID0gZGF0YS5vZmZzZXRzLFxuICAgICAgICByZWZlcmVuY2UgPSBfZGF0YSRvZmZzZXRzLnJlZmVyZW5jZSxcbiAgICAgICAgcG9wcGVyID0gX2RhdGEkb2Zmc2V0cy5wb3BwZXI7XG5cbiAgICB2YXIgaXNWZXJ0aWNhbCA9IFsnYm90dG9tJywgJ3RvcCddLmluZGV4T2YoYmFzZVBsYWNlbWVudCkgIT09IC0xO1xuICAgIHZhciBzaWRlID0gaXNWZXJ0aWNhbCA/ICdsZWZ0JyA6ICd0b3AnO1xuICAgIHZhciBtZWFzdXJlbWVudCA9IGlzVmVydGljYWwgPyAnd2lkdGgnIDogJ2hlaWdodCc7XG5cbiAgICB2YXIgc2hpZnRPZmZzZXRzID0ge1xuICAgICAgc3RhcnQ6IGRlZmluZVByb3BlcnR5KHt9LCBzaWRlLCByZWZlcmVuY2Vbc2lkZV0pLFxuICAgICAgZW5kOiBkZWZpbmVQcm9wZXJ0eSh7fSwgc2lkZSwgcmVmZXJlbmNlW3NpZGVdICsgcmVmZXJlbmNlW21lYXN1cmVtZW50XSAtIHBvcHBlclttZWFzdXJlbWVudF0pXG4gICAgfTtcblxuICAgIGRhdGEub2Zmc2V0cy5wb3BwZXIgPSBfZXh0ZW5kcyh7fSwgcG9wcGVyLCBzaGlmdE9mZnNldHNbc2hpZnR2YXJpYXRpb25dKTtcbiAgfVxuXG4gIHJldHVybiBkYXRhO1xufVxuXG4vKipcbiAqIEBmdW5jdGlvblxuICogQG1lbWJlcm9mIE1vZGlmaWVyc1xuICogQGFyZ3VtZW50IHtPYmplY3R9IGRhdGEgLSBUaGUgZGF0YSBvYmplY3QgZ2VuZXJhdGVkIGJ5IHVwZGF0ZSBtZXRob2RcbiAqIEBhcmd1bWVudCB7T2JqZWN0fSBvcHRpb25zIC0gTW9kaWZpZXJzIGNvbmZpZ3VyYXRpb24gYW5kIG9wdGlvbnNcbiAqIEByZXR1cm5zIHtPYmplY3R9IFRoZSBkYXRhIG9iamVjdCwgcHJvcGVybHkgbW9kaWZpZWRcbiAqL1xuZnVuY3Rpb24gaGlkZShkYXRhKSB7XG4gIGlmICghaXNNb2RpZmllclJlcXVpcmVkKGRhdGEuaW5zdGFuY2UubW9kaWZpZXJzLCAnaGlkZScsICdwcmV2ZW50T3ZlcmZsb3cnKSkge1xuICAgIHJldHVybiBkYXRhO1xuICB9XG5cbiAgdmFyIHJlZlJlY3QgPSBkYXRhLm9mZnNldHMucmVmZXJlbmNlO1xuICB2YXIgYm91bmQgPSBmaW5kKGRhdGEuaW5zdGFuY2UubW9kaWZpZXJzLCBmdW5jdGlvbiAobW9kaWZpZXIpIHtcbiAgICByZXR1cm4gbW9kaWZpZXIubmFtZSA9PT0gJ3ByZXZlbnRPdmVyZmxvdyc7XG4gIH0pLmJvdW5kYXJpZXM7XG5cbiAgaWYgKHJlZlJlY3QuYm90dG9tIDwgYm91bmQudG9wIHx8IHJlZlJlY3QubGVmdCA+IGJvdW5kLnJpZ2h0IHx8IHJlZlJlY3QudG9wID4gYm91bmQuYm90dG9tIHx8IHJlZlJlY3QucmlnaHQgPCBib3VuZC5sZWZ0KSB7XG4gICAgLy8gQXZvaWQgdW5uZWNlc3NhcnkgRE9NIGFjY2VzcyBpZiB2aXNpYmlsaXR5IGhhc24ndCBjaGFuZ2VkXG4gICAgaWYgKGRhdGEuaGlkZSA9PT0gdHJ1ZSkge1xuICAgICAgcmV0dXJuIGRhdGE7XG4gICAgfVxuXG4gICAgZGF0YS5oaWRlID0gdHJ1ZTtcbiAgICBkYXRhLmF0dHJpYnV0ZXNbJ3gtb3V0LW9mLWJvdW5kYXJpZXMnXSA9ICcnO1xuICB9IGVsc2Uge1xuICAgIC8vIEF2b2lkIHVubmVjZXNzYXJ5IERPTSBhY2Nlc3MgaWYgdmlzaWJpbGl0eSBoYXNuJ3QgY2hhbmdlZFxuICAgIGlmIChkYXRhLmhpZGUgPT09IGZhbHNlKSB7XG4gICAgICByZXR1cm4gZGF0YTtcbiAgICB9XG5cbiAgICBkYXRhLmhpZGUgPSBmYWxzZTtcbiAgICBkYXRhLmF0dHJpYnV0ZXNbJ3gtb3V0LW9mLWJvdW5kYXJpZXMnXSA9IGZhbHNlO1xuICB9XG5cbiAgcmV0dXJuIGRhdGE7XG59XG5cbi8qKlxuICogQGZ1bmN0aW9uXG4gKiBAbWVtYmVyb2YgTW9kaWZpZXJzXG4gKiBAYXJndW1lbnQge09iamVjdH0gZGF0YSAtIFRoZSBkYXRhIG9iamVjdCBnZW5lcmF0ZWQgYnkgYHVwZGF0ZWAgbWV0aG9kXG4gKiBAYXJndW1lbnQge09iamVjdH0gb3B0aW9ucyAtIE1vZGlmaWVycyBjb25maWd1cmF0aW9uIGFuZCBvcHRpb25zXG4gKiBAcmV0dXJucyB7T2JqZWN0fSBUaGUgZGF0YSBvYmplY3QsIHByb3Blcmx5IG1vZGlmaWVkXG4gKi9cbmZ1bmN0aW9uIGlubmVyKGRhdGEpIHtcbiAgdmFyIHBsYWNlbWVudCA9IGRhdGEucGxhY2VtZW50O1xuICB2YXIgYmFzZVBsYWNlbWVudCA9IHBsYWNlbWVudC5zcGxpdCgnLScpWzBdO1xuICB2YXIgX2RhdGEkb2Zmc2V0cyA9IGRhdGEub2Zmc2V0cyxcbiAgICAgIHBvcHBlciA9IF9kYXRhJG9mZnNldHMucG9wcGVyLFxuICAgICAgcmVmZXJlbmNlID0gX2RhdGEkb2Zmc2V0cy5yZWZlcmVuY2U7XG5cbiAgdmFyIGlzSG9yaXogPSBbJ2xlZnQnLCAncmlnaHQnXS5pbmRleE9mKGJhc2VQbGFjZW1lbnQpICE9PSAtMTtcblxuICB2YXIgc3VidHJhY3RMZW5ndGggPSBbJ3RvcCcsICdsZWZ0J10uaW5kZXhPZihiYXNlUGxhY2VtZW50KSA9PT0gLTE7XG5cbiAgcG9wcGVyW2lzSG9yaXogPyAnbGVmdCcgOiAndG9wJ10gPSByZWZlcmVuY2VbYmFzZVBsYWNlbWVudF0gLSAoc3VidHJhY3RMZW5ndGggPyBwb3BwZXJbaXNIb3JpeiA/ICd3aWR0aCcgOiAnaGVpZ2h0J10gOiAwKTtcblxuICBkYXRhLnBsYWNlbWVudCA9IGdldE9wcG9zaXRlUGxhY2VtZW50KHBsYWNlbWVudCk7XG4gIGRhdGEub2Zmc2V0cy5wb3BwZXIgPSBnZXRDbGllbnRSZWN0KHBvcHBlcik7XG5cbiAgcmV0dXJuIGRhdGE7XG59XG5cbi8qKlxuICogTW9kaWZpZXIgZnVuY3Rpb24sIGVhY2ggbW9kaWZpZXIgY2FuIGhhdmUgYSBmdW5jdGlvbiBvZiB0aGlzIHR5cGUgYXNzaWduZWRcbiAqIHRvIGl0cyBgZm5gIHByb3BlcnR5LjxiciAvPlxuICogVGhlc2UgZnVuY3Rpb25zIHdpbGwgYmUgY2FsbGVkIG9uIGVhY2ggdXBkYXRlLCB0aGlzIG1lYW5zIHRoYXQgeW91IG11c3RcbiAqIG1ha2Ugc3VyZSB0aGV5IGFyZSBwZXJmb3JtYW50IGVub3VnaCB0byBhdm9pZCBwZXJmb3JtYW5jZSBib3R0bGVuZWNrcy5cbiAqXG4gKiBAZnVuY3Rpb24gTW9kaWZpZXJGblxuICogQGFyZ3VtZW50IHtkYXRhT2JqZWN0fSBkYXRhIC0gVGhlIGRhdGEgb2JqZWN0IGdlbmVyYXRlZCBieSBgdXBkYXRlYCBtZXRob2RcbiAqIEBhcmd1bWVudCB7T2JqZWN0fSBvcHRpb25zIC0gTW9kaWZpZXJzIGNvbmZpZ3VyYXRpb24gYW5kIG9wdGlvbnNcbiAqIEByZXR1cm5zIHtkYXRhT2JqZWN0fSBUaGUgZGF0YSBvYmplY3QsIHByb3Blcmx5IG1vZGlmaWVkXG4gKi9cblxuLyoqXG4gKiBNb2RpZmllcnMgYXJlIHBsdWdpbnMgdXNlZCB0byBhbHRlciB0aGUgYmVoYXZpb3Igb2YgeW91ciBwb3BwZXJzLjxiciAvPlxuICogUG9wcGVyLmpzIHVzZXMgYSBzZXQgb2YgOSBtb2RpZmllcnMgdG8gcHJvdmlkZSBhbGwgdGhlIGJhc2ljIGZ1bmN0aW9uYWxpdGllc1xuICogbmVlZGVkIGJ5IHRoZSBsaWJyYXJ5LlxuICpcbiAqIFVzdWFsbHkgeW91IGRvbid0IHdhbnQgdG8gb3ZlcnJpZGUgdGhlIGBvcmRlcmAsIGBmbmAgYW5kIGBvbkxvYWRgIHByb3BzLlxuICogQWxsIHRoZSBvdGhlciBwcm9wZXJ0aWVzIGFyZSBjb25maWd1cmF0aW9ucyB0aGF0IGNvdWxkIGJlIHR3ZWFrZWQuXG4gKiBAbmFtZXNwYWNlIG1vZGlmaWVyc1xuICovXG52YXIgbW9kaWZpZXJzID0ge1xuICAvKipcbiAgICogTW9kaWZpZXIgdXNlZCB0byBzaGlmdCB0aGUgcG9wcGVyIG9uIHRoZSBzdGFydCBvciBlbmQgb2YgaXRzIHJlZmVyZW5jZVxuICAgKiBlbGVtZW50LjxiciAvPlxuICAgKiBJdCB3aWxsIHJlYWQgdGhlIHZhcmlhdGlvbiBvZiB0aGUgYHBsYWNlbWVudGAgcHJvcGVydHkuPGJyIC8+XG4gICAqIEl0IGNhbiBiZSBvbmUgZWl0aGVyIGAtZW5kYCBvciBgLXN0YXJ0YC5cbiAgICogQG1lbWJlcm9mIG1vZGlmaWVyc1xuICAgKiBAaW5uZXJcbiAgICovXG4gIHNoaWZ0OiB7XG4gICAgLyoqIEBwcm9wIHtudW1iZXJ9IG9yZGVyPTEwMCAtIEluZGV4IHVzZWQgdG8gZGVmaW5lIHRoZSBvcmRlciBvZiBleGVjdXRpb24gKi9cbiAgICBvcmRlcjogMTAwLFxuICAgIC8qKiBAcHJvcCB7Qm9vbGVhbn0gZW5hYmxlZD10cnVlIC0gV2hldGhlciB0aGUgbW9kaWZpZXIgaXMgZW5hYmxlZCBvciBub3QgKi9cbiAgICBlbmFibGVkOiB0cnVlLFxuICAgIC8qKiBAcHJvcCB7TW9kaWZpZXJGbn0gKi9cbiAgICBmbjogc2hpZnRcbiAgfSxcblxuICAvKipcbiAgICogVGhlIGBvZmZzZXRgIG1vZGlmaWVyIGNhbiBzaGlmdCB5b3VyIHBvcHBlciBvbiBib3RoIGl0cyBheGlzLlxuICAgKlxuICAgKiBJdCBhY2NlcHRzIHRoZSBmb2xsb3dpbmcgdW5pdHM6XG4gICAqIC0gYHB4YCBvciB1bml0LWxlc3MsIGludGVycHJldGVkIGFzIHBpeGVsc1xuICAgKiAtIGAlYCBvciBgJXJgLCBwZXJjZW50YWdlIHJlbGF0aXZlIHRvIHRoZSBsZW5ndGggb2YgdGhlIHJlZmVyZW5jZSBlbGVtZW50XG4gICAqIC0gYCVwYCwgcGVyY2VudGFnZSByZWxhdGl2ZSB0byB0aGUgbGVuZ3RoIG9mIHRoZSBwb3BwZXIgZWxlbWVudFxuICAgKiAtIGB2d2AsIENTUyB2aWV3cG9ydCB3aWR0aCB1bml0XG4gICAqIC0gYHZoYCwgQ1NTIHZpZXdwb3J0IGhlaWdodCB1bml0XG4gICAqXG4gICAqIEZvciBsZW5ndGggaXMgaW50ZW5kZWQgdGhlIG1haW4gYXhpcyByZWxhdGl2ZSB0byB0aGUgcGxhY2VtZW50IG9mIHRoZSBwb3BwZXIuPGJyIC8+XG4gICAqIFRoaXMgbWVhbnMgdGhhdCBpZiB0aGUgcGxhY2VtZW50IGlzIGB0b3BgIG9yIGBib3R0b21gLCB0aGUgbGVuZ3RoIHdpbGwgYmUgdGhlXG4gICAqIGB3aWR0aGAuIEluIGNhc2Ugb2YgYGxlZnRgIG9yIGByaWdodGAsIGl0IHdpbGwgYmUgdGhlIGBoZWlnaHRgLlxuICAgKlxuICAgKiBZb3UgY2FuIHByb3ZpZGUgYSBzaW5nbGUgdmFsdWUgKGFzIGBOdW1iZXJgIG9yIGBTdHJpbmdgKSwgb3IgYSBwYWlyIG9mIHZhbHVlc1xuICAgKiBhcyBgU3RyaW5nYCBkaXZpZGVkIGJ5IGEgY29tbWEgb3Igb25lIChvciBtb3JlKSB3aGl0ZSBzcGFjZXMuPGJyIC8+XG4gICAqIFRoZSBsYXR0ZXIgaXMgYSBkZXByZWNhdGVkIG1ldGhvZCBiZWNhdXNlIGl0IGxlYWRzIHRvIGNvbmZ1c2lvbiBhbmQgd2lsbCBiZVxuICAgKiByZW1vdmVkIGluIHYyLjxiciAvPlxuICAgKiBBZGRpdGlvbmFsbHksIGl0IGFjY2VwdHMgYWRkaXRpb25zIGFuZCBzdWJ0cmFjdGlvbnMgYmV0d2VlbiBkaWZmZXJlbnQgdW5pdHMuXG4gICAqIE5vdGUgdGhhdCBtdWx0aXBsaWNhdGlvbnMgYW5kIGRpdmlzaW9ucyBhcmVuJ3Qgc3VwcG9ydGVkLlxuICAgKlxuICAgKiBWYWxpZCBleGFtcGxlcyBhcmU6XG4gICAqIGBgYFxuICAgKiAxMFxuICAgKiAnMTAlJ1xuICAgKiAnMTAsIDEwJ1xuICAgKiAnMTAlLCAxMCdcbiAgICogJzEwICsgMTAlJ1xuICAgKiAnMTAgLSA1dmggKyAzJSdcbiAgICogJy0xMHB4ICsgNXZoLCA1cHggLSA2JSdcbiAgICogYGBgXG4gICAqID4gKipOQioqOiBJZiB5b3UgZGVzaXJlIHRvIGFwcGx5IG9mZnNldHMgdG8geW91ciBwb3BwZXJzIGluIGEgd2F5IHRoYXQgbWF5IG1ha2UgdGhlbSBvdmVybGFwXG4gICAqID4gd2l0aCB0aGVpciByZWZlcmVuY2UgZWxlbWVudCwgdW5mb3J0dW5hdGVseSwgeW91IHdpbGwgaGF2ZSB0byBkaXNhYmxlIHRoZSBgZmxpcGAgbW9kaWZpZXIuXG4gICAqID4gWW91IGNhbiByZWFkIG1vcmUgb24gdGhpcyBhdCB0aGlzIFtpc3N1ZV0oaHR0cHM6Ly9naXRodWIuY29tL0ZlelZyYXN0YS9wb3BwZXIuanMvaXNzdWVzLzM3MykuXG4gICAqXG4gICAqIEBtZW1iZXJvZiBtb2RpZmllcnNcbiAgICogQGlubmVyXG4gICAqL1xuICBvZmZzZXQ6IHtcbiAgICAvKiogQHByb3Age251bWJlcn0gb3JkZXI9MjAwIC0gSW5kZXggdXNlZCB0byBkZWZpbmUgdGhlIG9yZGVyIG9mIGV4ZWN1dGlvbiAqL1xuICAgIG9yZGVyOiAyMDAsXG4gICAgLyoqIEBwcm9wIHtCb29sZWFufSBlbmFibGVkPXRydWUgLSBXaGV0aGVyIHRoZSBtb2RpZmllciBpcyBlbmFibGVkIG9yIG5vdCAqL1xuICAgIGVuYWJsZWQ6IHRydWUsXG4gICAgLyoqIEBwcm9wIHtNb2RpZmllckZufSAqL1xuICAgIGZuOiBvZmZzZXQsXG4gICAgLyoqIEBwcm9wIHtOdW1iZXJ8U3RyaW5nfSBvZmZzZXQ9MFxuICAgICAqIFRoZSBvZmZzZXQgdmFsdWUgYXMgZGVzY3JpYmVkIGluIHRoZSBtb2RpZmllciBkZXNjcmlwdGlvblxuICAgICAqL1xuICAgIG9mZnNldDogMFxuICB9LFxuXG4gIC8qKlxuICAgKiBNb2RpZmllciB1c2VkIHRvIHByZXZlbnQgdGhlIHBvcHBlciBmcm9tIGJlaW5nIHBvc2l0aW9uZWQgb3V0c2lkZSB0aGUgYm91bmRhcnkuXG4gICAqXG4gICAqIEEgc2NlbmFyaW8gZXhpc3RzIHdoZXJlIHRoZSByZWZlcmVuY2UgaXRzZWxmIGlzIG5vdCB3aXRoaW4gdGhlIGJvdW5kYXJpZXMuPGJyIC8+XG4gICAqIFdlIGNhbiBzYXkgaXQgaGFzIFwiZXNjYXBlZCB0aGUgYm91bmRhcmllc1wiIOKAlCBvciBqdXN0IFwiZXNjYXBlZFwiLjxiciAvPlxuICAgKiBJbiB0aGlzIGNhc2Ugd2UgbmVlZCB0byBkZWNpZGUgd2hldGhlciB0aGUgcG9wcGVyIHNob3VsZCBlaXRoZXI6XG4gICAqXG4gICAqIC0gZGV0YWNoIGZyb20gdGhlIHJlZmVyZW5jZSBhbmQgcmVtYWluIFwidHJhcHBlZFwiIGluIHRoZSBib3VuZGFyaWVzLCBvclxuICAgKiAtIGlmIGl0IHNob3VsZCBpZ25vcmUgdGhlIGJvdW5kYXJ5IGFuZCBcImVzY2FwZSB3aXRoIGl0cyByZWZlcmVuY2VcIlxuICAgKlxuICAgKiBXaGVuIGBlc2NhcGVXaXRoUmVmZXJlbmNlYCBpcyBzZXQgdG9gdHJ1ZWAgYW5kIHJlZmVyZW5jZSBpcyBjb21wbGV0ZWx5XG4gICAqIG91dHNpZGUgaXRzIGJvdW5kYXJpZXMsIHRoZSBwb3BwZXIgd2lsbCBvdmVyZmxvdyAob3IgY29tcGxldGVseSBsZWF2ZSlcbiAgICogdGhlIGJvdW5kYXJpZXMgaW4gb3JkZXIgdG8gcmVtYWluIGF0dGFjaGVkIHRvIHRoZSBlZGdlIG9mIHRoZSByZWZlcmVuY2UuXG4gICAqXG4gICAqIEBtZW1iZXJvZiBtb2RpZmllcnNcbiAgICogQGlubmVyXG4gICAqL1xuICBwcmV2ZW50T3ZlcmZsb3c6IHtcbiAgICAvKiogQHByb3Age251bWJlcn0gb3JkZXI9MzAwIC0gSW5kZXggdXNlZCB0byBkZWZpbmUgdGhlIG9yZGVyIG9mIGV4ZWN1dGlvbiAqL1xuICAgIG9yZGVyOiAzMDAsXG4gICAgLyoqIEBwcm9wIHtCb29sZWFufSBlbmFibGVkPXRydWUgLSBXaGV0aGVyIHRoZSBtb2RpZmllciBpcyBlbmFibGVkIG9yIG5vdCAqL1xuICAgIGVuYWJsZWQ6IHRydWUsXG4gICAgLyoqIEBwcm9wIHtNb2RpZmllckZufSAqL1xuICAgIGZuOiBwcmV2ZW50T3ZlcmZsb3csXG4gICAgLyoqXG4gICAgICogQHByb3Age0FycmF5fSBbcHJpb3JpdHk9WydsZWZ0JywncmlnaHQnLCd0b3AnLCdib3R0b20nXV1cbiAgICAgKiBQb3BwZXIgd2lsbCB0cnkgdG8gcHJldmVudCBvdmVyZmxvdyBmb2xsb3dpbmcgdGhlc2UgcHJpb3JpdGllcyBieSBkZWZhdWx0LFxuICAgICAqIHRoZW4sIGl0IGNvdWxkIG92ZXJmbG93IG9uIHRoZSBsZWZ0IGFuZCBvbiB0b3Agb2YgdGhlIGBib3VuZGFyaWVzRWxlbWVudGBcbiAgICAgKi9cbiAgICBwcmlvcml0eTogWydsZWZ0JywgJ3JpZ2h0JywgJ3RvcCcsICdib3R0b20nXSxcbiAgICAvKipcbiAgICAgKiBAcHJvcCB7bnVtYmVyfSBwYWRkaW5nPTVcbiAgICAgKiBBbW91bnQgb2YgcGl4ZWwgdXNlZCB0byBkZWZpbmUgYSBtaW5pbXVtIGRpc3RhbmNlIGJldHdlZW4gdGhlIGJvdW5kYXJpZXNcbiAgICAgKiBhbmQgdGhlIHBvcHBlci4gVGhpcyBtYWtlcyBzdXJlIHRoZSBwb3BwZXIgYWx3YXlzIGhhcyBhIGxpdHRsZSBwYWRkaW5nXG4gICAgICogYmV0d2VlbiB0aGUgZWRnZXMgb2YgaXRzIGNvbnRhaW5lclxuICAgICAqL1xuICAgIHBhZGRpbmc6IDUsXG4gICAgLyoqXG4gICAgICogQHByb3Age1N0cmluZ3xIVE1MRWxlbWVudH0gYm91bmRhcmllc0VsZW1lbnQ9J3Njcm9sbFBhcmVudCdcbiAgICAgKiBCb3VuZGFyaWVzIHVzZWQgYnkgdGhlIG1vZGlmaWVyLiBDYW4gYmUgYHNjcm9sbFBhcmVudGAsIGB3aW5kb3dgLFxuICAgICAqIGB2aWV3cG9ydGAgb3IgYW55IERPTSBlbGVtZW50LlxuICAgICAqL1xuICAgIGJvdW5kYXJpZXNFbGVtZW50OiAnc2Nyb2xsUGFyZW50J1xuICB9LFxuXG4gIC8qKlxuICAgKiBNb2RpZmllciB1c2VkIHRvIG1ha2Ugc3VyZSB0aGUgcmVmZXJlbmNlIGFuZCBpdHMgcG9wcGVyIHN0YXkgbmVhciBlYWNoIG90aGVyXG4gICAqIHdpdGhvdXQgbGVhdmluZyBhbnkgZ2FwIGJldHdlZW4gdGhlIHR3by4gRXNwZWNpYWxseSB1c2VmdWwgd2hlbiB0aGUgYXJyb3cgaXNcbiAgICogZW5hYmxlZCBhbmQgeW91IHdhbnQgdG8gZW5zdXJlIHRoYXQgaXQgcG9pbnRzIHRvIGl0cyByZWZlcmVuY2UgZWxlbWVudC5cbiAgICogSXQgY2FyZXMgb25seSBhYm91dCB0aGUgZmlyc3QgYXhpcy4gWW91IGNhbiBzdGlsbCBoYXZlIHBvcHBlcnMgd2l0aCBtYXJnaW5cbiAgICogYmV0d2VlbiB0aGUgcG9wcGVyIGFuZCBpdHMgcmVmZXJlbmNlIGVsZW1lbnQuXG4gICAqIEBtZW1iZXJvZiBtb2RpZmllcnNcbiAgICogQGlubmVyXG4gICAqL1xuICBrZWVwVG9nZXRoZXI6IHtcbiAgICAvKiogQHByb3Age251bWJlcn0gb3JkZXI9NDAwIC0gSW5kZXggdXNlZCB0byBkZWZpbmUgdGhlIG9yZGVyIG9mIGV4ZWN1dGlvbiAqL1xuICAgIG9yZGVyOiA0MDAsXG4gICAgLyoqIEBwcm9wIHtCb29sZWFufSBlbmFibGVkPXRydWUgLSBXaGV0aGVyIHRoZSBtb2RpZmllciBpcyBlbmFibGVkIG9yIG5vdCAqL1xuICAgIGVuYWJsZWQ6IHRydWUsXG4gICAgLyoqIEBwcm9wIHtNb2RpZmllckZufSAqL1xuICAgIGZuOiBrZWVwVG9nZXRoZXJcbiAgfSxcblxuICAvKipcbiAgICogVGhpcyBtb2RpZmllciBpcyB1c2VkIHRvIG1vdmUgdGhlIGBhcnJvd0VsZW1lbnRgIG9mIHRoZSBwb3BwZXIgdG8gbWFrZVxuICAgKiBzdXJlIGl0IGlzIHBvc2l0aW9uZWQgYmV0d2VlbiB0aGUgcmVmZXJlbmNlIGVsZW1lbnQgYW5kIGl0cyBwb3BwZXIgZWxlbWVudC5cbiAgICogSXQgd2lsbCByZWFkIHRoZSBvdXRlciBzaXplIG9mIHRoZSBgYXJyb3dFbGVtZW50YCBub2RlIHRvIGRldGVjdCBob3cgbWFueVxuICAgKiBwaXhlbHMgb2YgY29uanVuY3Rpb24gYXJlIG5lZWRlZC5cbiAgICpcbiAgICogSXQgaGFzIG5vIGVmZmVjdCBpZiBubyBgYXJyb3dFbGVtZW50YCBpcyBwcm92aWRlZC5cbiAgICogQG1lbWJlcm9mIG1vZGlmaWVyc1xuICAgKiBAaW5uZXJcbiAgICovXG4gIGFycm93OiB7XG4gICAgLyoqIEBwcm9wIHtudW1iZXJ9IG9yZGVyPTUwMCAtIEluZGV4IHVzZWQgdG8gZGVmaW5lIHRoZSBvcmRlciBvZiBleGVjdXRpb24gKi9cbiAgICBvcmRlcjogNTAwLFxuICAgIC8qKiBAcHJvcCB7Qm9vbGVhbn0gZW5hYmxlZD10cnVlIC0gV2hldGhlciB0aGUgbW9kaWZpZXIgaXMgZW5hYmxlZCBvciBub3QgKi9cbiAgICBlbmFibGVkOiB0cnVlLFxuICAgIC8qKiBAcHJvcCB7TW9kaWZpZXJGbn0gKi9cbiAgICBmbjogYXJyb3csXG4gICAgLyoqIEBwcm9wIHtTdHJpbmd8SFRNTEVsZW1lbnR9IGVsZW1lbnQ9J1t4LWFycm93XScgLSBTZWxlY3RvciBvciBub2RlIHVzZWQgYXMgYXJyb3cgKi9cbiAgICBlbGVtZW50OiAnW3gtYXJyb3ddJ1xuICB9LFxuXG4gIC8qKlxuICAgKiBNb2RpZmllciB1c2VkIHRvIGZsaXAgdGhlIHBvcHBlcidzIHBsYWNlbWVudCB3aGVuIGl0IHN0YXJ0cyB0byBvdmVybGFwIGl0c1xuICAgKiByZWZlcmVuY2UgZWxlbWVudC5cbiAgICpcbiAgICogUmVxdWlyZXMgdGhlIGBwcmV2ZW50T3ZlcmZsb3dgIG1vZGlmaWVyIGJlZm9yZSBpdCBpbiBvcmRlciB0byB3b3JrLlxuICAgKlxuICAgKiAqKk5PVEU6KiogdGhpcyBtb2RpZmllciB3aWxsIGludGVycnVwdCB0aGUgY3VycmVudCB1cGRhdGUgY3ljbGUgYW5kIHdpbGxcbiAgICogcmVzdGFydCBpdCBpZiBpdCBkZXRlY3RzIHRoZSBuZWVkIHRvIGZsaXAgdGhlIHBsYWNlbWVudC5cbiAgICogQG1lbWJlcm9mIG1vZGlmaWVyc1xuICAgKiBAaW5uZXJcbiAgICovXG4gIGZsaXA6IHtcbiAgICAvKiogQHByb3Age251bWJlcn0gb3JkZXI9NjAwIC0gSW5kZXggdXNlZCB0byBkZWZpbmUgdGhlIG9yZGVyIG9mIGV4ZWN1dGlvbiAqL1xuICAgIG9yZGVyOiA2MDAsXG4gICAgLyoqIEBwcm9wIHtCb29sZWFufSBlbmFibGVkPXRydWUgLSBXaGV0aGVyIHRoZSBtb2RpZmllciBpcyBlbmFibGVkIG9yIG5vdCAqL1xuICAgIGVuYWJsZWQ6IHRydWUsXG4gICAgLyoqIEBwcm9wIHtNb2RpZmllckZufSAqL1xuICAgIGZuOiBmbGlwLFxuICAgIC8qKlxuICAgICAqIEBwcm9wIHtTdHJpbmd8QXJyYXl9IGJlaGF2aW9yPSdmbGlwJ1xuICAgICAqIFRoZSBiZWhhdmlvciB1c2VkIHRvIGNoYW5nZSB0aGUgcG9wcGVyJ3MgcGxhY2VtZW50LiBJdCBjYW4gYmUgb25lIG9mXG4gICAgICogYGZsaXBgLCBgY2xvY2t3aXNlYCwgYGNvdW50ZXJjbG9ja3dpc2VgIG9yIGFuIGFycmF5IHdpdGggYSBsaXN0IG9mIHZhbGlkXG4gICAgICogcGxhY2VtZW50cyAod2l0aCBvcHRpb25hbCB2YXJpYXRpb25zKVxuICAgICAqL1xuICAgIGJlaGF2aW9yOiAnZmxpcCcsXG4gICAgLyoqXG4gICAgICogQHByb3Age251bWJlcn0gcGFkZGluZz01XG4gICAgICogVGhlIHBvcHBlciB3aWxsIGZsaXAgaWYgaXQgaGl0cyB0aGUgZWRnZXMgb2YgdGhlIGBib3VuZGFyaWVzRWxlbWVudGBcbiAgICAgKi9cbiAgICBwYWRkaW5nOiA1LFxuICAgIC8qKlxuICAgICAqIEBwcm9wIHtTdHJpbmd8SFRNTEVsZW1lbnR9IGJvdW5kYXJpZXNFbGVtZW50PSd2aWV3cG9ydCdcbiAgICAgKiBUaGUgZWxlbWVudCB3aGljaCB3aWxsIGRlZmluZSB0aGUgYm91bmRhcmllcyBvZiB0aGUgcG9wcGVyIHBvc2l0aW9uLlxuICAgICAqIFRoZSBwb3BwZXIgd2lsbCBuZXZlciBiZSBwbGFjZWQgb3V0c2lkZSBvZiB0aGUgZGVmaW5lZCBib3VuZGFyaWVzXG4gICAgICogKGV4Y2VwdCBpZiBga2VlcFRvZ2V0aGVyYCBpcyBlbmFibGVkKVxuICAgICAqL1xuICAgIGJvdW5kYXJpZXNFbGVtZW50OiAndmlld3BvcnQnXG4gIH0sXG5cbiAgLyoqXG4gICAqIE1vZGlmaWVyIHVzZWQgdG8gbWFrZSB0aGUgcG9wcGVyIGZsb3cgdG93YXJkIHRoZSBpbm5lciBvZiB0aGUgcmVmZXJlbmNlIGVsZW1lbnQuXG4gICAqIEJ5IGRlZmF1bHQsIHdoZW4gdGhpcyBtb2RpZmllciBpcyBkaXNhYmxlZCwgdGhlIHBvcHBlciB3aWxsIGJlIHBsYWNlZCBvdXRzaWRlXG4gICAqIHRoZSByZWZlcmVuY2UgZWxlbWVudC5cbiAgICogQG1lbWJlcm9mIG1vZGlmaWVyc1xuICAgKiBAaW5uZXJcbiAgICovXG4gIGlubmVyOiB7XG4gICAgLyoqIEBwcm9wIHtudW1iZXJ9IG9yZGVyPTcwMCAtIEluZGV4IHVzZWQgdG8gZGVmaW5lIHRoZSBvcmRlciBvZiBleGVjdXRpb24gKi9cbiAgICBvcmRlcjogNzAwLFxuICAgIC8qKiBAcHJvcCB7Qm9vbGVhbn0gZW5hYmxlZD1mYWxzZSAtIFdoZXRoZXIgdGhlIG1vZGlmaWVyIGlzIGVuYWJsZWQgb3Igbm90ICovXG4gICAgZW5hYmxlZDogZmFsc2UsXG4gICAgLyoqIEBwcm9wIHtNb2RpZmllckZufSAqL1xuICAgIGZuOiBpbm5lclxuICB9LFxuXG4gIC8qKlxuICAgKiBNb2RpZmllciB1c2VkIHRvIGhpZGUgdGhlIHBvcHBlciB3aGVuIGl0cyByZWZlcmVuY2UgZWxlbWVudCBpcyBvdXRzaWRlIG9mIHRoZVxuICAgKiBwb3BwZXIgYm91bmRhcmllcy4gSXQgd2lsbCBzZXQgYSBgeC1vdXQtb2YtYm91bmRhcmllc2AgYXR0cmlidXRlIHdoaWNoIGNhblxuICAgKiBiZSB1c2VkIHRvIGhpZGUgd2l0aCBhIENTUyBzZWxlY3RvciB0aGUgcG9wcGVyIHdoZW4gaXRzIHJlZmVyZW5jZSBpc1xuICAgKiBvdXQgb2YgYm91bmRhcmllcy5cbiAgICpcbiAgICogUmVxdWlyZXMgdGhlIGBwcmV2ZW50T3ZlcmZsb3dgIG1vZGlmaWVyIGJlZm9yZSBpdCBpbiBvcmRlciB0byB3b3JrLlxuICAgKiBAbWVtYmVyb2YgbW9kaWZpZXJzXG4gICAqIEBpbm5lclxuICAgKi9cbiAgaGlkZToge1xuICAgIC8qKiBAcHJvcCB7bnVtYmVyfSBvcmRlcj04MDAgLSBJbmRleCB1c2VkIHRvIGRlZmluZSB0aGUgb3JkZXIgb2YgZXhlY3V0aW9uICovXG4gICAgb3JkZXI6IDgwMCxcbiAgICAvKiogQHByb3Age0Jvb2xlYW59IGVuYWJsZWQ9dHJ1ZSAtIFdoZXRoZXIgdGhlIG1vZGlmaWVyIGlzIGVuYWJsZWQgb3Igbm90ICovXG4gICAgZW5hYmxlZDogdHJ1ZSxcbiAgICAvKiogQHByb3Age01vZGlmaWVyRm59ICovXG4gICAgZm46IGhpZGVcbiAgfSxcblxuICAvKipcbiAgICogQ29tcHV0ZXMgdGhlIHN0eWxlIHRoYXQgd2lsbCBiZSBhcHBsaWVkIHRvIHRoZSBwb3BwZXIgZWxlbWVudCB0byBnZXRzXG4gICAqIHByb3Blcmx5IHBvc2l0aW9uZWQuXG4gICAqXG4gICAqIE5vdGUgdGhhdCB0aGlzIG1vZGlmaWVyIHdpbGwgbm90IHRvdWNoIHRoZSBET00sIGl0IGp1c3QgcHJlcGFyZXMgdGhlIHN0eWxlc1xuICAgKiBzbyB0aGF0IGBhcHBseVN0eWxlYCBtb2RpZmllciBjYW4gYXBwbHkgaXQuIFRoaXMgc2VwYXJhdGlvbiBpcyB1c2VmdWxcbiAgICogaW4gY2FzZSB5b3UgbmVlZCB0byByZXBsYWNlIGBhcHBseVN0eWxlYCB3aXRoIGEgY3VzdG9tIGltcGxlbWVudGF0aW9uLlxuICAgKlxuICAgKiBUaGlzIG1vZGlmaWVyIGhhcyBgODUwYCBhcyBgb3JkZXJgIHZhbHVlIHRvIG1haW50YWluIGJhY2t3YXJkIGNvbXBhdGliaWxpdHlcbiAgICogd2l0aCBwcmV2aW91cyB2ZXJzaW9ucyBvZiBQb3BwZXIuanMuIEV4cGVjdCB0aGUgbW9kaWZpZXJzIG9yZGVyaW5nIG1ldGhvZFxuICAgKiB0byBjaGFuZ2UgaW4gZnV0dXJlIG1ham9yIHZlcnNpb25zIG9mIHRoZSBsaWJyYXJ5LlxuICAgKlxuICAgKiBAbWVtYmVyb2YgbW9kaWZpZXJzXG4gICAqIEBpbm5lclxuICAgKi9cbiAgY29tcHV0ZVN0eWxlOiB7XG4gICAgLyoqIEBwcm9wIHtudW1iZXJ9IG9yZGVyPTg1MCAtIEluZGV4IHVzZWQgdG8gZGVmaW5lIHRoZSBvcmRlciBvZiBleGVjdXRpb24gKi9cbiAgICBvcmRlcjogODUwLFxuICAgIC8qKiBAcHJvcCB7Qm9vbGVhbn0gZW5hYmxlZD10cnVlIC0gV2hldGhlciB0aGUgbW9kaWZpZXIgaXMgZW5hYmxlZCBvciBub3QgKi9cbiAgICBlbmFibGVkOiB0cnVlLFxuICAgIC8qKiBAcHJvcCB7TW9kaWZpZXJGbn0gKi9cbiAgICBmbjogY29tcHV0ZVN0eWxlLFxuICAgIC8qKlxuICAgICAqIEBwcm9wIHtCb29sZWFufSBncHVBY2NlbGVyYXRpb249dHJ1ZVxuICAgICAqIElmIHRydWUsIGl0IHVzZXMgdGhlIENTUyAzRCB0cmFuc2Zvcm1hdGlvbiB0byBwb3NpdGlvbiB0aGUgcG9wcGVyLlxuICAgICAqIE90aGVyd2lzZSwgaXQgd2lsbCB1c2UgdGhlIGB0b3BgIGFuZCBgbGVmdGAgcHJvcGVydGllc1xuICAgICAqL1xuICAgIGdwdUFjY2VsZXJhdGlvbjogdHJ1ZSxcbiAgICAvKipcbiAgICAgKiBAcHJvcCB7c3RyaW5nfSBbeD0nYm90dG9tJ11cbiAgICAgKiBXaGVyZSB0byBhbmNob3IgdGhlIFggYXhpcyAoYGJvdHRvbWAgb3IgYHRvcGApLiBBS0EgWCBvZmZzZXQgb3JpZ2luLlxuICAgICAqIENoYW5nZSB0aGlzIGlmIHlvdXIgcG9wcGVyIHNob3VsZCBncm93IGluIGEgZGlyZWN0aW9uIGRpZmZlcmVudCBmcm9tIGBib3R0b21gXG4gICAgICovXG4gICAgeDogJ2JvdHRvbScsXG4gICAgLyoqXG4gICAgICogQHByb3Age3N0cmluZ30gW3g9J2xlZnQnXVxuICAgICAqIFdoZXJlIHRvIGFuY2hvciB0aGUgWSBheGlzIChgbGVmdGAgb3IgYHJpZ2h0YCkuIEFLQSBZIG9mZnNldCBvcmlnaW4uXG4gICAgICogQ2hhbmdlIHRoaXMgaWYgeW91ciBwb3BwZXIgc2hvdWxkIGdyb3cgaW4gYSBkaXJlY3Rpb24gZGlmZmVyZW50IGZyb20gYHJpZ2h0YFxuICAgICAqL1xuICAgIHk6ICdyaWdodCdcbiAgfSxcblxuICAvKipcbiAgICogQXBwbGllcyB0aGUgY29tcHV0ZWQgc3R5bGVzIHRvIHRoZSBwb3BwZXIgZWxlbWVudC5cbiAgICpcbiAgICogQWxsIHRoZSBET00gbWFuaXB1bGF0aW9ucyBhcmUgbGltaXRlZCB0byB0aGlzIG1vZGlmaWVyLiBUaGlzIGlzIHVzZWZ1bCBpbiBjYXNlXG4gICAqIHlvdSB3YW50IHRvIGludGVncmF0ZSBQb3BwZXIuanMgaW5zaWRlIGEgZnJhbWV3b3JrIG9yIHZpZXcgbGlicmFyeSBhbmQgeW91XG4gICAqIHdhbnQgdG8gZGVsZWdhdGUgYWxsIHRoZSBET00gbWFuaXB1bGF0aW9ucyB0byBpdC5cbiAgICpcbiAgICogTm90ZSB0aGF0IGlmIHlvdSBkaXNhYmxlIHRoaXMgbW9kaWZpZXIsIHlvdSBtdXN0IG1ha2Ugc3VyZSB0aGUgcG9wcGVyIGVsZW1lbnRcbiAgICogaGFzIGl0cyBwb3NpdGlvbiBzZXQgdG8gYGFic29sdXRlYCBiZWZvcmUgUG9wcGVyLmpzIGNhbiBkbyBpdHMgd29yayFcbiAgICpcbiAgICogSnVzdCBkaXNhYmxlIHRoaXMgbW9kaWZpZXIgYW5kIGRlZmluZSB5b3VyIG93biB0byBhY2hpZXZlIHRoZSBkZXNpcmVkIGVmZmVjdC5cbiAgICpcbiAgICogQG1lbWJlcm9mIG1vZGlmaWVyc1xuICAgKiBAaW5uZXJcbiAgICovXG4gIGFwcGx5U3R5bGU6IHtcbiAgICAvKiogQHByb3Age251bWJlcn0gb3JkZXI9OTAwIC0gSW5kZXggdXNlZCB0byBkZWZpbmUgdGhlIG9yZGVyIG9mIGV4ZWN1dGlvbiAqL1xuICAgIG9yZGVyOiA5MDAsXG4gICAgLyoqIEBwcm9wIHtCb29sZWFufSBlbmFibGVkPXRydWUgLSBXaGV0aGVyIHRoZSBtb2RpZmllciBpcyBlbmFibGVkIG9yIG5vdCAqL1xuICAgIGVuYWJsZWQ6IHRydWUsXG4gICAgLyoqIEBwcm9wIHtNb2RpZmllckZufSAqL1xuICAgIGZuOiBhcHBseVN0eWxlLFxuICAgIC8qKiBAcHJvcCB7RnVuY3Rpb259ICovXG4gICAgb25Mb2FkOiBhcHBseVN0eWxlT25Mb2FkLFxuICAgIC8qKlxuICAgICAqIEBkZXByZWNhdGVkIHNpbmNlIHZlcnNpb24gMS4xMC4wLCB0aGUgcHJvcGVydHkgbW92ZWQgdG8gYGNvbXB1dGVTdHlsZWAgbW9kaWZpZXJcbiAgICAgKiBAcHJvcCB7Qm9vbGVhbn0gZ3B1QWNjZWxlcmF0aW9uPXRydWVcbiAgICAgKiBJZiB0cnVlLCBpdCB1c2VzIHRoZSBDU1MgM0QgdHJhbnNmb3JtYXRpb24gdG8gcG9zaXRpb24gdGhlIHBvcHBlci5cbiAgICAgKiBPdGhlcndpc2UsIGl0IHdpbGwgdXNlIHRoZSBgdG9wYCBhbmQgYGxlZnRgIHByb3BlcnRpZXNcbiAgICAgKi9cbiAgICBncHVBY2NlbGVyYXRpb246IHVuZGVmaW5lZFxuICB9XG59O1xuXG4vKipcbiAqIFRoZSBgZGF0YU9iamVjdGAgaXMgYW4gb2JqZWN0IGNvbnRhaW5pbmcgYWxsIHRoZSBpbmZvcm1hdGlvbiB1c2VkIGJ5IFBvcHBlci5qcy5cbiAqIFRoaXMgb2JqZWN0IGlzIHBhc3NlZCB0byBtb2RpZmllcnMgYW5kIHRvIHRoZSBgb25DcmVhdGVgIGFuZCBgb25VcGRhdGVgIGNhbGxiYWNrcy5cbiAqIEBuYW1lIGRhdGFPYmplY3RcbiAqIEBwcm9wZXJ0eSB7T2JqZWN0fSBkYXRhLmluc3RhbmNlIFRoZSBQb3BwZXIuanMgaW5zdGFuY2VcbiAqIEBwcm9wZXJ0eSB7U3RyaW5nfSBkYXRhLnBsYWNlbWVudCBQbGFjZW1lbnQgYXBwbGllZCB0byBwb3BwZXJcbiAqIEBwcm9wZXJ0eSB7U3RyaW5nfSBkYXRhLm9yaWdpbmFsUGxhY2VtZW50IFBsYWNlbWVudCBvcmlnaW5hbGx5IGRlZmluZWQgb24gaW5pdFxuICogQHByb3BlcnR5IHtCb29sZWFufSBkYXRhLmZsaXBwZWQgVHJ1ZSBpZiBwb3BwZXIgaGFzIGJlZW4gZmxpcHBlZCBieSBmbGlwIG1vZGlmaWVyXG4gKiBAcHJvcGVydHkge0Jvb2xlYW59IGRhdGEuaGlkZSBUcnVlIGlmIHRoZSByZWZlcmVuY2UgZWxlbWVudCBpcyBvdXQgb2YgYm91bmRhcmllcywgdXNlZnVsIHRvIGtub3cgd2hlbiB0byBoaWRlIHRoZSBwb3BwZXJcbiAqIEBwcm9wZXJ0eSB7SFRNTEVsZW1lbnR9IGRhdGEuYXJyb3dFbGVtZW50IE5vZGUgdXNlZCBhcyBhcnJvdyBieSBhcnJvdyBtb2RpZmllclxuICogQHByb3BlcnR5IHtPYmplY3R9IGRhdGEuc3R5bGVzIEFueSBDU1MgcHJvcGVydHkgZGVmaW5lZCBoZXJlIHdpbGwgYmUgYXBwbGllZCB0byB0aGUgcG9wcGVyLiBJdCBleHBlY3RzIHRoZSBKYXZhU2NyaXB0IG5vbWVuY2xhdHVyZSAoZWcuIGBtYXJnaW5Cb3R0b21gKVxuICogQHByb3BlcnR5IHtPYmplY3R9IGRhdGEuYXJyb3dTdHlsZXMgQW55IENTUyBwcm9wZXJ0eSBkZWZpbmVkIGhlcmUgd2lsbCBiZSBhcHBsaWVkIHRvIHRoZSBwb3BwZXIgYXJyb3cuIEl0IGV4cGVjdHMgdGhlIEphdmFTY3JpcHQgbm9tZW5jbGF0dXJlIChlZy4gYG1hcmdpbkJvdHRvbWApXG4gKiBAcHJvcGVydHkge09iamVjdH0gZGF0YS5ib3VuZGFyaWVzIE9mZnNldHMgb2YgdGhlIHBvcHBlciBib3VuZGFyaWVzXG4gKiBAcHJvcGVydHkge09iamVjdH0gZGF0YS5vZmZzZXRzIFRoZSBtZWFzdXJlbWVudHMgb2YgcG9wcGVyLCByZWZlcmVuY2UgYW5kIGFycm93IGVsZW1lbnRzXG4gKiBAcHJvcGVydHkge09iamVjdH0gZGF0YS5vZmZzZXRzLnBvcHBlciBgdG9wYCwgYGxlZnRgLCBgd2lkdGhgLCBgaGVpZ2h0YCB2YWx1ZXNcbiAqIEBwcm9wZXJ0eSB7T2JqZWN0fSBkYXRhLm9mZnNldHMucmVmZXJlbmNlIGB0b3BgLCBgbGVmdGAsIGB3aWR0aGAsIGBoZWlnaHRgIHZhbHVlc1xuICogQHByb3BlcnR5IHtPYmplY3R9IGRhdGEub2Zmc2V0cy5hcnJvd10gYHRvcGAgYW5kIGBsZWZ0YCBvZmZzZXRzLCBvbmx5IG9uZSBvZiB0aGVtIHdpbGwgYmUgZGlmZmVyZW50IGZyb20gMFxuICovXG5cbi8qKlxuICogRGVmYXVsdCBvcHRpb25zIHByb3ZpZGVkIHRvIFBvcHBlci5qcyBjb25zdHJ1Y3Rvci48YnIgLz5cbiAqIFRoZXNlIGNhbiBiZSBvdmVycmlkZGVuIHVzaW5nIHRoZSBgb3B0aW9uc2AgYXJndW1lbnQgb2YgUG9wcGVyLmpzLjxiciAvPlxuICogVG8gb3ZlcnJpZGUgYW4gb3B0aW9uLCBzaW1wbHkgcGFzcyBhbiBvYmplY3Qgd2l0aCB0aGUgc2FtZVxuICogc3RydWN0dXJlIG9mIHRoZSBgb3B0aW9uc2Agb2JqZWN0LCBhcyB0aGUgM3JkIGFyZ3VtZW50LiBGb3IgZXhhbXBsZTpcbiAqIGBgYFxuICogbmV3IFBvcHBlcihyZWYsIHBvcCwge1xuICogICBtb2RpZmllcnM6IHtcbiAqICAgICBwcmV2ZW50T3ZlcmZsb3c6IHsgZW5hYmxlZDogZmFsc2UgfVxuICogICB9XG4gKiB9KVxuICogYGBgXG4gKiBAdHlwZSB7T2JqZWN0fVxuICogQHN0YXRpY1xuICogQG1lbWJlcm9mIFBvcHBlclxuICovXG52YXIgRGVmYXVsdHMgPSB7XG4gIC8qKlxuICAgKiBQb3BwZXIncyBwbGFjZW1lbnQuXG4gICAqIEBwcm9wIHtQb3BwZXIucGxhY2VtZW50c30gcGxhY2VtZW50PSdib3R0b20nXG4gICAqL1xuICBwbGFjZW1lbnQ6ICdib3R0b20nLFxuXG4gIC8qKlxuICAgKiBTZXQgdGhpcyB0byB0cnVlIGlmIHlvdSB3YW50IHBvcHBlciB0byBwb3NpdGlvbiBpdCBzZWxmIGluICdmaXhlZCcgbW9kZVxuICAgKiBAcHJvcCB7Qm9vbGVhbn0gcG9zaXRpb25GaXhlZD1mYWxzZVxuICAgKi9cbiAgcG9zaXRpb25GaXhlZDogZmFsc2UsXG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgZXZlbnRzIChyZXNpemUsIHNjcm9sbCkgYXJlIGluaXRpYWxseSBlbmFibGVkLlxuICAgKiBAcHJvcCB7Qm9vbGVhbn0gZXZlbnRzRW5hYmxlZD10cnVlXG4gICAqL1xuICBldmVudHNFbmFibGVkOiB0cnVlLFxuXG4gIC8qKlxuICAgKiBTZXQgdG8gdHJ1ZSBpZiB5b3Ugd2FudCB0byBhdXRvbWF0aWNhbGx5IHJlbW92ZSB0aGUgcG9wcGVyIHdoZW5cbiAgICogeW91IGNhbGwgdGhlIGBkZXN0cm95YCBtZXRob2QuXG4gICAqIEBwcm9wIHtCb29sZWFufSByZW1vdmVPbkRlc3Ryb3k9ZmFsc2VcbiAgICovXG4gIHJlbW92ZU9uRGVzdHJveTogZmFsc2UsXG5cbiAgLyoqXG4gICAqIENhbGxiYWNrIGNhbGxlZCB3aGVuIHRoZSBwb3BwZXIgaXMgY3JlYXRlZC48YnIgLz5cbiAgICogQnkgZGVmYXVsdCwgaXQgaXMgc2V0IHRvIG5vLW9wLjxiciAvPlxuICAgKiBBY2Nlc3MgUG9wcGVyLmpzIGluc3RhbmNlIHdpdGggYGRhdGEuaW5zdGFuY2VgLlxuICAgKiBAcHJvcCB7b25DcmVhdGV9XG4gICAqL1xuICBvbkNyZWF0ZTogZnVuY3Rpb24gb25DcmVhdGUoKSB7fSxcblxuICAvKipcbiAgICogQ2FsbGJhY2sgY2FsbGVkIHdoZW4gdGhlIHBvcHBlciBpcyB1cGRhdGVkLiBUaGlzIGNhbGxiYWNrIGlzIG5vdCBjYWxsZWRcbiAgICogb24gdGhlIGluaXRpYWxpemF0aW9uL2NyZWF0aW9uIG9mIHRoZSBwb3BwZXIsIGJ1dCBvbmx5IG9uIHN1YnNlcXVlbnRcbiAgICogdXBkYXRlcy48YnIgLz5cbiAgICogQnkgZGVmYXVsdCwgaXQgaXMgc2V0IHRvIG5vLW9wLjxiciAvPlxuICAgKiBBY2Nlc3MgUG9wcGVyLmpzIGluc3RhbmNlIHdpdGggYGRhdGEuaW5zdGFuY2VgLlxuICAgKiBAcHJvcCB7b25VcGRhdGV9XG4gICAqL1xuICBvblVwZGF0ZTogZnVuY3Rpb24gb25VcGRhdGUoKSB7fSxcblxuICAvKipcbiAgICogTGlzdCBvZiBtb2RpZmllcnMgdXNlZCB0byBtb2RpZnkgdGhlIG9mZnNldHMgYmVmb3JlIHRoZXkgYXJlIGFwcGxpZWQgdG8gdGhlIHBvcHBlci5cbiAgICogVGhleSBwcm92aWRlIG1vc3Qgb2YgdGhlIGZ1bmN0aW9uYWxpdGllcyBvZiBQb3BwZXIuanMuXG4gICAqIEBwcm9wIHttb2RpZmllcnN9XG4gICAqL1xuICBtb2RpZmllcnM6IG1vZGlmaWVyc1xufTtcblxuLyoqXG4gKiBAY2FsbGJhY2sgb25DcmVhdGVcbiAqIEBwYXJhbSB7ZGF0YU9iamVjdH0gZGF0YVxuICovXG5cbi8qKlxuICogQGNhbGxiYWNrIG9uVXBkYXRlXG4gKiBAcGFyYW0ge2RhdGFPYmplY3R9IGRhdGFcbiAqL1xuXG4vLyBVdGlsc1xuLy8gTWV0aG9kc1xudmFyIFBvcHBlciA9IGZ1bmN0aW9uICgpIHtcbiAgLyoqXG4gICAqIENyZWF0ZXMgYSBuZXcgUG9wcGVyLmpzIGluc3RhbmNlLlxuICAgKiBAY2xhc3MgUG9wcGVyXG4gICAqIEBwYXJhbSB7SFRNTEVsZW1lbnR8cmVmZXJlbmNlT2JqZWN0fSByZWZlcmVuY2UgLSBUaGUgcmVmZXJlbmNlIGVsZW1lbnQgdXNlZCB0byBwb3NpdGlvbiB0aGUgcG9wcGVyXG4gICAqIEBwYXJhbSB7SFRNTEVsZW1lbnR9IHBvcHBlciAtIFRoZSBIVE1MIGVsZW1lbnQgdXNlZCBhcyB0aGUgcG9wcGVyXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zIC0gWW91ciBjdXN0b20gb3B0aW9ucyB0byBvdmVycmlkZSB0aGUgb25lcyBkZWZpbmVkIGluIFtEZWZhdWx0c10oI2RlZmF1bHRzKVxuICAgKiBAcmV0dXJuIHtPYmplY3R9IGluc3RhbmNlIC0gVGhlIGdlbmVyYXRlZCBQb3BwZXIuanMgaW5zdGFuY2VcbiAgICovXG4gIGZ1bmN0aW9uIFBvcHBlcihyZWZlcmVuY2UsIHBvcHBlcikge1xuICAgIHZhciBfdGhpcyA9IHRoaXM7XG5cbiAgICB2YXIgb3B0aW9ucyA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzJdIDoge307XG4gICAgY2xhc3NDYWxsQ2hlY2sodGhpcywgUG9wcGVyKTtcblxuICAgIHRoaXMuc2NoZWR1bGVVcGRhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKF90aGlzLnVwZGF0ZSk7XG4gICAgfTtcblxuICAgIC8vIG1ha2UgdXBkYXRlKCkgZGVib3VuY2VkLCBzbyB0aGF0IGl0IG9ubHkgcnVucyBhdCBtb3N0IG9uY2UtcGVyLXRpY2tcbiAgICB0aGlzLnVwZGF0ZSA9IGRlYm91bmNlKHRoaXMudXBkYXRlLmJpbmQodGhpcykpO1xuXG4gICAgLy8gd2l0aCB7fSB3ZSBjcmVhdGUgYSBuZXcgb2JqZWN0IHdpdGggdGhlIG9wdGlvbnMgaW5zaWRlIGl0XG4gICAgdGhpcy5vcHRpb25zID0gX2V4dGVuZHMoe30sIFBvcHBlci5EZWZhdWx0cywgb3B0aW9ucyk7XG5cbiAgICAvLyBpbml0IHN0YXRlXG4gICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgIGlzRGVzdHJveWVkOiBmYWxzZSxcbiAgICAgIGlzQ3JlYXRlZDogZmFsc2UsXG4gICAgICBzY3JvbGxQYXJlbnRzOiBbXVxuICAgIH07XG5cbiAgICAvLyBnZXQgcmVmZXJlbmNlIGFuZCBwb3BwZXIgZWxlbWVudHMgKGFsbG93IGpRdWVyeSB3cmFwcGVycylcbiAgICB0aGlzLnJlZmVyZW5jZSA9IHJlZmVyZW5jZSAmJiByZWZlcmVuY2UuanF1ZXJ5ID8gcmVmZXJlbmNlWzBdIDogcmVmZXJlbmNlO1xuICAgIHRoaXMucG9wcGVyID0gcG9wcGVyICYmIHBvcHBlci5qcXVlcnkgPyBwb3BwZXJbMF0gOiBwb3BwZXI7XG5cbiAgICAvLyBEZWVwIG1lcmdlIG1vZGlmaWVycyBvcHRpb25zXG4gICAgdGhpcy5vcHRpb25zLm1vZGlmaWVycyA9IHt9O1xuICAgIE9iamVjdC5rZXlzKF9leHRlbmRzKHt9LCBQb3BwZXIuRGVmYXVsdHMubW9kaWZpZXJzLCBvcHRpb25zLm1vZGlmaWVycykpLmZvckVhY2goZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgIF90aGlzLm9wdGlvbnMubW9kaWZpZXJzW25hbWVdID0gX2V4dGVuZHMoe30sIFBvcHBlci5EZWZhdWx0cy5tb2RpZmllcnNbbmFtZV0gfHwge30sIG9wdGlvbnMubW9kaWZpZXJzID8gb3B0aW9ucy5tb2RpZmllcnNbbmFtZV0gOiB7fSk7XG4gICAgfSk7XG5cbiAgICAvLyBSZWZhY3RvcmluZyBtb2RpZmllcnMnIGxpc3QgKE9iamVjdCA9PiBBcnJheSlcbiAgICB0aGlzLm1vZGlmaWVycyA9IE9iamVjdC5rZXlzKHRoaXMub3B0aW9ucy5tb2RpZmllcnMpLm1hcChmdW5jdGlvbiAobmFtZSkge1xuICAgICAgcmV0dXJuIF9leHRlbmRzKHtcbiAgICAgICAgbmFtZTogbmFtZVxuICAgICAgfSwgX3RoaXMub3B0aW9ucy5tb2RpZmllcnNbbmFtZV0pO1xuICAgIH0pXG4gICAgLy8gc29ydCB0aGUgbW9kaWZpZXJzIGJ5IG9yZGVyXG4gICAgLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHtcbiAgICAgIHJldHVybiBhLm9yZGVyIC0gYi5vcmRlcjtcbiAgICB9KTtcblxuICAgIC8vIG1vZGlmaWVycyBoYXZlIHRoZSBhYmlsaXR5IHRvIGV4ZWN1dGUgYXJiaXRyYXJ5IGNvZGUgd2hlbiBQb3BwZXIuanMgZ2V0IGluaXRlZFxuICAgIC8vIHN1Y2ggY29kZSBpcyBleGVjdXRlZCBpbiB0aGUgc2FtZSBvcmRlciBvZiBpdHMgbW9kaWZpZXJcbiAgICAvLyB0aGV5IGNvdWxkIGFkZCBuZXcgcHJvcGVydGllcyB0byB0aGVpciBvcHRpb25zIGNvbmZpZ3VyYXRpb25cbiAgICAvLyBCRSBBV0FSRTogZG9uJ3QgYWRkIG9wdGlvbnMgdG8gYG9wdGlvbnMubW9kaWZpZXJzLm5hbWVgIGJ1dCB0byBgbW9kaWZpZXJPcHRpb25zYCFcbiAgICB0aGlzLm1vZGlmaWVycy5mb3JFYWNoKGZ1bmN0aW9uIChtb2RpZmllck9wdGlvbnMpIHtcbiAgICAgIGlmIChtb2RpZmllck9wdGlvbnMuZW5hYmxlZCAmJiBpc0Z1bmN0aW9uKG1vZGlmaWVyT3B0aW9ucy5vbkxvYWQpKSB7XG4gICAgICAgIG1vZGlmaWVyT3B0aW9ucy5vbkxvYWQoX3RoaXMucmVmZXJlbmNlLCBfdGhpcy5wb3BwZXIsIF90aGlzLm9wdGlvbnMsIG1vZGlmaWVyT3B0aW9ucywgX3RoaXMuc3RhdGUpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gZmlyZSB0aGUgZmlyc3QgdXBkYXRlIHRvIHBvc2l0aW9uIHRoZSBwb3BwZXIgaW4gdGhlIHJpZ2h0IHBsYWNlXG4gICAgdGhpcy51cGRhdGUoKTtcblxuICAgIHZhciBldmVudHNFbmFibGVkID0gdGhpcy5vcHRpb25zLmV2ZW50c0VuYWJsZWQ7XG4gICAgaWYgKGV2ZW50c0VuYWJsZWQpIHtcbiAgICAgIC8vIHNldHVwIGV2ZW50IGxpc3RlbmVycywgdGhleSB3aWxsIHRha2UgY2FyZSBvZiB1cGRhdGUgdGhlIHBvc2l0aW9uIGluIHNwZWNpZmljIHNpdHVhdGlvbnNcbiAgICAgIHRoaXMuZW5hYmxlRXZlbnRMaXN0ZW5lcnMoKTtcbiAgICB9XG5cbiAgICB0aGlzLnN0YXRlLmV2ZW50c0VuYWJsZWQgPSBldmVudHNFbmFibGVkO1xuICB9XG5cbiAgLy8gV2UgY2FuJ3QgdXNlIGNsYXNzIHByb3BlcnRpZXMgYmVjYXVzZSB0aGV5IGRvbid0IGdldCBsaXN0ZWQgaW4gdGhlXG4gIC8vIGNsYXNzIHByb3RvdHlwZSBhbmQgYnJlYWsgc3R1ZmYgbGlrZSBTaW5vbiBzdHVic1xuXG5cbiAgY3JlYXRlQ2xhc3MoUG9wcGVyLCBbe1xuICAgIGtleTogJ3VwZGF0ZScsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIHVwZGF0ZSQkMSgpIHtcbiAgICAgIHJldHVybiB1cGRhdGUuY2FsbCh0aGlzKTtcbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6ICdkZXN0cm95JyxcbiAgICB2YWx1ZTogZnVuY3Rpb24gZGVzdHJveSQkMSgpIHtcbiAgICAgIHJldHVybiBkZXN0cm95LmNhbGwodGhpcyk7XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiAnZW5hYmxlRXZlbnRMaXN0ZW5lcnMnLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBlbmFibGVFdmVudExpc3RlbmVycyQkMSgpIHtcbiAgICAgIHJldHVybiBlbmFibGVFdmVudExpc3RlbmVycy5jYWxsKHRoaXMpO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogJ2Rpc2FibGVFdmVudExpc3RlbmVycycsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGRpc2FibGVFdmVudExpc3RlbmVycyQkMSgpIHtcbiAgICAgIHJldHVybiBkaXNhYmxlRXZlbnRMaXN0ZW5lcnMuY2FsbCh0aGlzKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTY2hlZHVsZXMgYW4gdXBkYXRlLiBJdCB3aWxsIHJ1biBvbiB0aGUgbmV4dCBVSSB1cGRhdGUgYXZhaWxhYmxlLlxuICAgICAqIEBtZXRob2Qgc2NoZWR1bGVVcGRhdGVcbiAgICAgKiBAbWVtYmVyb2YgUG9wcGVyXG4gICAgICovXG5cblxuICAgIC8qKlxuICAgICAqIENvbGxlY3Rpb24gb2YgdXRpbGl0aWVzIHVzZWZ1bCB3aGVuIHdyaXRpbmcgY3VzdG9tIG1vZGlmaWVycy5cbiAgICAgKiBTdGFydGluZyBmcm9tIHZlcnNpb24gMS43LCB0aGlzIG1ldGhvZCBpcyBhdmFpbGFibGUgb25seSBpZiB5b3VcbiAgICAgKiBpbmNsdWRlIGBwb3BwZXItdXRpbHMuanNgIGJlZm9yZSBgcG9wcGVyLmpzYC5cbiAgICAgKlxuICAgICAqICoqREVQUkVDQVRJT04qKjogVGhpcyB3YXkgdG8gYWNjZXNzIFBvcHBlclV0aWxzIGlzIGRlcHJlY2F0ZWRcbiAgICAgKiBhbmQgd2lsbCBiZSByZW1vdmVkIGluIHYyISBVc2UgdGhlIFBvcHBlclV0aWxzIG1vZHVsZSBkaXJlY3RseSBpbnN0ZWFkLlxuICAgICAqIER1ZSB0byB0aGUgaGlnaCBpbnN0YWJpbGl0eSBvZiB0aGUgbWV0aG9kcyBjb250YWluZWQgaW4gVXRpbHMsIHdlIGNhbid0XG4gICAgICogZ3VhcmFudGVlIHRoZW0gdG8gZm9sbG93IHNlbXZlci4gVXNlIHRoZW0gYXQgeW91ciBvd24gcmlzayFcbiAgICAgKiBAc3RhdGljXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAdHlwZSB7T2JqZWN0fVxuICAgICAqIEBkZXByZWNhdGVkIHNpbmNlIHZlcnNpb24gMS44XG4gICAgICogQG1lbWJlciBVdGlsc1xuICAgICAqIEBtZW1iZXJvZiBQb3BwZXJcbiAgICAgKi9cblxuICB9XSk7XG4gIHJldHVybiBQb3BwZXI7XG59KCk7XG5cbi8qKlxuICogVGhlIGByZWZlcmVuY2VPYmplY3RgIGlzIGFuIG9iamVjdCB0aGF0IHByb3ZpZGVzIGFuIGludGVyZmFjZSBjb21wYXRpYmxlIHdpdGggUG9wcGVyLmpzXG4gKiBhbmQgbGV0cyB5b3UgdXNlIGl0IGFzIHJlcGxhY2VtZW50IG9mIGEgcmVhbCBET00gbm9kZS48YnIgLz5cbiAqIFlvdSBjYW4gdXNlIHRoaXMgbWV0aG9kIHRvIHBvc2l0aW9uIGEgcG9wcGVyIHJlbGF0aXZlbHkgdG8gYSBzZXQgb2YgY29vcmRpbmF0ZXNcbiAqIGluIGNhc2UgeW91IGRvbid0IGhhdmUgYSBET00gbm9kZSB0byB1c2UgYXMgcmVmZXJlbmNlLlxuICpcbiAqIGBgYFxuICogbmV3IFBvcHBlcihyZWZlcmVuY2VPYmplY3QsIHBvcHBlck5vZGUpO1xuICogYGBgXG4gKlxuICogTkI6IFRoaXMgZmVhdHVyZSBpc24ndCBzdXBwb3J0ZWQgaW4gSW50ZXJuZXQgRXhwbG9yZXIgMTAuXG4gKiBAbmFtZSByZWZlcmVuY2VPYmplY3RcbiAqIEBwcm9wZXJ0eSB7RnVuY3Rpb259IGRhdGEuZ2V0Qm91bmRpbmdDbGllbnRSZWN0XG4gKiBBIGZ1bmN0aW9uIHRoYXQgcmV0dXJucyBhIHNldCBvZiBjb29yZGluYXRlcyBjb21wYXRpYmxlIHdpdGggdGhlIG5hdGl2ZSBgZ2V0Qm91bmRpbmdDbGllbnRSZWN0YCBtZXRob2QuXG4gKiBAcHJvcGVydHkge251bWJlcn0gZGF0YS5jbGllbnRXaWR0aFxuICogQW4gRVM2IGdldHRlciB0aGF0IHdpbGwgcmV0dXJuIHRoZSB3aWR0aCBvZiB0aGUgdmlydHVhbCByZWZlcmVuY2UgZWxlbWVudC5cbiAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBkYXRhLmNsaWVudEhlaWdodFxuICogQW4gRVM2IGdldHRlciB0aGF0IHdpbGwgcmV0dXJuIHRoZSBoZWlnaHQgb2YgdGhlIHZpcnR1YWwgcmVmZXJlbmNlIGVsZW1lbnQuXG4gKi9cblxuXG5Qb3BwZXIuVXRpbHMgPSAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgPyB3aW5kb3cgOiBnbG9iYWwpLlBvcHBlclV0aWxzO1xuUG9wcGVyLnBsYWNlbWVudHMgPSBwbGFjZW1lbnRzO1xuUG9wcGVyLkRlZmF1bHRzID0gRGVmYXVsdHM7XG5cbmV4cG9ydCBkZWZhdWx0IFBvcHBlcjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXBvcHBlci5qcy5tYXBcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QSIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///05951c2f2bda4691bed3\n");

/***/ }),

/***/ "061678c35a7b82df6628":
/*!******************************************************************!*\
  !*** ./src/Apps/DOCUMENT/IHM/widgets/attributes/color/wColor.js ***!
  \******************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/*global define*/\n\n(function umdRequire(root, factory) {\n  \"use strict\";\n\n  if (true) {\n    !(__WEBPACK_AMD_DEFINE_ARRAY__ = [\n      __webpack_require__(/*! jquery */ \"127c8cf59f228bb01a21\"),\n      __webpack_require__(/*! underscore */ \"8e08e542008e4aef1f58\"),\n      __webpack_require__(/*! dcpDocument/widgets/attributes/text/wText */ \"61b480911316cdda77a4\")\n    ], __WEBPACK_AMD_DEFINE_FACTORY__ = (factory),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?\n\t\t\t\t(__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n  } else {}\n})(window, function require_wColor($, _) {\n  \"use strict\";\n\n  $.widget(\"dcp.dcpColor\", $.dcp.dcpText, {\n    options: {\n      type: \"color\",\n\n      renderOptions: {\n        kendoColorConfiguration: {\n          buttons: false\n        }\n      },\n      labels: {}\n    },\n    /**\n     * The kendoColorPicker widget instance\n     */\n    kendoWidget: null,\n\n    _initDom: function wColorInitDom() {\n      this.element.addClass(\"dcpAttribute__content\");\n      this.element.attr(\"data-type\", this.getType());\n      this.element.attr(\"data-attrid\", this.options.id);\n      if (\n        parseFloat(this.options.attributeValue.displayValue) ===\n        parseFloat(this.options.attributeValue.value)\n      ) {\n        this.options.attributeValue.displayValue = this.formatNumber(\n          this.options.attributeValue.value\n        );\n      }\n\n      //noinspection JSPotentiallyInvalidConstructorUsage,JSAccessibilityCheck\n      $.dcp.dcpAttribute.prototype._initDom.apply(this, []);\n\n      this.kendoWidget = this.element.find(\".dcpAttribute__value--edit\");\n      if (this.kendoWidget) {\n        if (this.options.hasAutocomplete) {\n          this.activateAutocomplete(this.kendoWidget);\n        } else {\n          this._activateColor(this.kendoWidget);\n\n          if (this.kendoWidget.hasClass(\"form-control\")) {\n            this.element.find(\".k-colorpicker\").addClass(\"form-control\");\n          }\n        }\n      }\n      if (\n        this.element.find(\".dcpAttribute__content__buttons button\").length === 0\n      ) {\n        this.element\n          .find(\".k-picker-wrap\")\n          .addClass(\"dcpAttribute__content__nobutton\");\n      }\n      var colorTag = $(\"<div></div>\", {\n        class: \"dcpAttribute__content__color__tag\"\n      });\n      colorTag.css(\"background-color\", this.options.attributeValue.value);\n      this.element.find(\".dcpAttribute__value--read\").prepend(colorTag);\n    },\n\n    _initChangeEvent: function wcolInitChangeEvent() {\n      // set by widget if no autocomplete\n      if (this.options.hasAutocomplete) {\n        this._super();\n      }\n    },\n\n    setValue: function wcolSetValue(value) {\n      // this._super.(value);\n      // Don't call dcpText::setValue()\n\n      value = _.clone(value);\n\n      if (_.has(value, \"value\") && !_.has(value, \"displayValue\")) {\n        value.displayValue = this.formatNumber(value.value);\n      }\n\n      $.dcp.dcpAttribute.prototype.setValue.apply(this, [value]);\n\n      if (this.getMode() === \"write\") {\n        var originalValue = this.kendoWidget.data(\"kendoColorPicker\").value();\n        // : explicit lazy equal\n        //noinspection JSHint\n        if (originalValue != value.value) {\n          this.kendoWidget.data(\"kendoColorPicker\").value(value.value);\n          // Modify value only if different\n          this.flashElement();\n        }\n      } else if (this.getMode() === \"read\") {\n        this.getContentElements().text(value.displayValue);\n        this.element\n          .find(\".dcpAttribute__value--read\")\n          .css(\"border-color\", value.value);\n      } else {\n        throw new Error(\n          \"Attribute \" + this.options.id + \" unkown mode \" + this.getMode()\n        );\n      }\n    },\n\n    _activateColor: function wcolActivateNumber(inputValue) {\n      return inputValue.kendoColorPicker(this.getKendoColorOptions());\n    },\n\n    formatNumber: function wcolFormatNumber(value) {\n      return kendo.toString(value, this.getKendoColorOptions().format);\n    },\n\n    /**\n     * Get kendo option from normal options and from renderOptions.kendoNumeric\n     * @returns {*}\n     */\n    getKendoColorOptions: function wColorgetKendoColorOptions() {\n      var scope = this,\n        kendoOptions = {},\n        defaultOptions = {\n          change: function wColor_onchange() {\n            // Need to set by widget to honor decimals option\n            scope.setValue({ value: this.value() });\n          }\n        };\n\n      if (_.isObject(scope.options.renderOptions.kendoColorConfiguration)) {\n        kendoOptions = scope.options.renderOptions.kendoColorConfiguration;\n      }\n      return _.extend(defaultOptions, kendoOptions);\n    },\n\n    getType: function wcolGetType() {\n      return \"color\";\n    },\n\n    testValue: function wcolTestValue(value) {\n      this._super(value);\n      if (!_.isNumber(value.value)) {\n        throw new Error(\n          \"The value must be a number for (attrid : \" + this.options.id + \")\"\n        );\n      }\n    },\n\n    close: function wColor_close() {\n      if (this.kendoWidget && this.kendoWidget.data(\"kendoColorPicker\")) {\n        this.kendoWidget.data(\"kendoColorPicker\").close();\n      }\n      this._super();\n    },\n\n    _destroy: function _destroy() {\n      if (this.kendoWidget && this.kendoWidget.data(\"kendoColorPicker\")) {\n        this.kendoWidget.data(\"kendoColorPicker\").destroy();\n      }\n      this._super();\n    }\n  });\n\n  return $.fn.dcpColor;\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMDYxNjc4YzM1YTdiODJkZjY2MjguanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvQXBwcy9ET0NVTUVOVC9JSE0vd2lkZ2V0cy9hdHRyaWJ1dGVzL2NvbG9yL3dDb2xvci5qcz8zMmVjIl0sInNvdXJjZXNDb250ZW50IjpbIi8qZ2xvYmFsIGRlZmluZSovXG5cbihmdW5jdGlvbiB1bWRSZXF1aXJlKHJvb3QsIGZhY3RvcnkpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgaWYgKHR5cGVvZiBkZWZpbmUgPT09IFwiZnVuY3Rpb25cIiAmJiBkZWZpbmUuYW1kKSB7XG4gICAgZGVmaW5lKFtcbiAgICAgIFwianF1ZXJ5XCIsXG4gICAgICBcInVuZGVyc2NvcmVcIixcbiAgICAgIFwiZGNwRG9jdW1lbnQvd2lkZ2V0cy9hdHRyaWJ1dGVzL3RleHQvd1RleHRcIlxuICAgIF0sIGZhY3RvcnkpO1xuICB9IGVsc2Uge1xuICAgIC8vbm9pbnNwZWN0aW9uIEpTVW5yZXNvbHZlZFZhcmlhYmxlXG4gICAgZmFjdG9yeSh3aW5kb3cualF1ZXJ5LCB3aW5kb3cuXyk7XG4gIH1cbn0pKHdpbmRvdywgZnVuY3Rpb24gcmVxdWlyZV93Q29sb3IoJCwgXykge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICAkLndpZGdldChcImRjcC5kY3BDb2xvclwiLCAkLmRjcC5kY3BUZXh0LCB7XG4gICAgb3B0aW9uczoge1xuICAgICAgdHlwZTogXCJjb2xvclwiLFxuXG4gICAgICByZW5kZXJPcHRpb25zOiB7XG4gICAgICAgIGtlbmRvQ29sb3JDb25maWd1cmF0aW9uOiB7XG4gICAgICAgICAgYnV0dG9uczogZmFsc2VcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGxhYmVsczoge31cbiAgICB9LFxuICAgIC8qKlxuICAgICAqIFRoZSBrZW5kb0NvbG9yUGlja2VyIHdpZGdldCBpbnN0YW5jZVxuICAgICAqL1xuICAgIGtlbmRvV2lkZ2V0OiBudWxsLFxuXG4gICAgX2luaXREb206IGZ1bmN0aW9uIHdDb2xvckluaXREb20oKSB7XG4gICAgICB0aGlzLmVsZW1lbnQuYWRkQ2xhc3MoXCJkY3BBdHRyaWJ1dGVfX2NvbnRlbnRcIik7XG4gICAgICB0aGlzLmVsZW1lbnQuYXR0cihcImRhdGEtdHlwZVwiLCB0aGlzLmdldFR5cGUoKSk7XG4gICAgICB0aGlzLmVsZW1lbnQuYXR0cihcImRhdGEtYXR0cmlkXCIsIHRoaXMub3B0aW9ucy5pZCk7XG4gICAgICBpZiAoXG4gICAgICAgIHBhcnNlRmxvYXQodGhpcy5vcHRpb25zLmF0dHJpYnV0ZVZhbHVlLmRpc3BsYXlWYWx1ZSkgPT09XG4gICAgICAgIHBhcnNlRmxvYXQodGhpcy5vcHRpb25zLmF0dHJpYnV0ZVZhbHVlLnZhbHVlKVxuICAgICAgKSB7XG4gICAgICAgIHRoaXMub3B0aW9ucy5hdHRyaWJ1dGVWYWx1ZS5kaXNwbGF5VmFsdWUgPSB0aGlzLmZvcm1hdE51bWJlcihcbiAgICAgICAgICB0aGlzLm9wdGlvbnMuYXR0cmlidXRlVmFsdWUudmFsdWVcbiAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgLy9ub2luc3BlY3Rpb24gSlNQb3RlbnRpYWxseUludmFsaWRDb25zdHJ1Y3RvclVzYWdlLEpTQWNjZXNzaWJpbGl0eUNoZWNrXG4gICAgICAkLmRjcC5kY3BBdHRyaWJ1dGUucHJvdG90eXBlLl9pbml0RG9tLmFwcGx5KHRoaXMsIFtdKTtcblxuICAgICAgdGhpcy5rZW5kb1dpZGdldCA9IHRoaXMuZWxlbWVudC5maW5kKFwiLmRjcEF0dHJpYnV0ZV9fdmFsdWUtLWVkaXRcIik7XG4gICAgICBpZiAodGhpcy5rZW5kb1dpZGdldCkge1xuICAgICAgICBpZiAodGhpcy5vcHRpb25zLmhhc0F1dG9jb21wbGV0ZSkge1xuICAgICAgICAgIHRoaXMuYWN0aXZhdGVBdXRvY29tcGxldGUodGhpcy5rZW5kb1dpZGdldCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5fYWN0aXZhdGVDb2xvcih0aGlzLmtlbmRvV2lkZ2V0KTtcblxuICAgICAgICAgIGlmICh0aGlzLmtlbmRvV2lkZ2V0Lmhhc0NsYXNzKFwiZm9ybS1jb250cm9sXCIpKSB7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQuZmluZChcIi5rLWNvbG9ycGlja2VyXCIpLmFkZENsYXNzKFwiZm9ybS1jb250cm9sXCIpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKFxuICAgICAgICB0aGlzLmVsZW1lbnQuZmluZChcIi5kY3BBdHRyaWJ1dGVfX2NvbnRlbnRfX2J1dHRvbnMgYnV0dG9uXCIpLmxlbmd0aCA9PT0gMFxuICAgICAgKSB7XG4gICAgICAgIHRoaXMuZWxlbWVudFxuICAgICAgICAgIC5maW5kKFwiLmstcGlja2VyLXdyYXBcIilcbiAgICAgICAgICAuYWRkQ2xhc3MoXCJkY3BBdHRyaWJ1dGVfX2NvbnRlbnRfX25vYnV0dG9uXCIpO1xuICAgICAgfVxuICAgICAgdmFyIGNvbG9yVGFnID0gJChcIjxkaXY+PC9kaXY+XCIsIHtcbiAgICAgICAgY2xhc3M6IFwiZGNwQXR0cmlidXRlX19jb250ZW50X19jb2xvcl9fdGFnXCJcbiAgICAgIH0pO1xuICAgICAgY29sb3JUYWcuY3NzKFwiYmFja2dyb3VuZC1jb2xvclwiLCB0aGlzLm9wdGlvbnMuYXR0cmlidXRlVmFsdWUudmFsdWUpO1xuICAgICAgdGhpcy5lbGVtZW50LmZpbmQoXCIuZGNwQXR0cmlidXRlX192YWx1ZS0tcmVhZFwiKS5wcmVwZW5kKGNvbG9yVGFnKTtcbiAgICB9LFxuXG4gICAgX2luaXRDaGFuZ2VFdmVudDogZnVuY3Rpb24gd2NvbEluaXRDaGFuZ2VFdmVudCgpIHtcbiAgICAgIC8vIHNldCBieSB3aWRnZXQgaWYgbm8gYXV0b2NvbXBsZXRlXG4gICAgICBpZiAodGhpcy5vcHRpb25zLmhhc0F1dG9jb21wbGV0ZSkge1xuICAgICAgICB0aGlzLl9zdXBlcigpO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICBzZXRWYWx1ZTogZnVuY3Rpb24gd2NvbFNldFZhbHVlKHZhbHVlKSB7XG4gICAgICAvLyB0aGlzLl9zdXBlci4odmFsdWUpO1xuICAgICAgLy8gRG9uJ3QgY2FsbCBkY3BUZXh0OjpzZXRWYWx1ZSgpXG5cbiAgICAgIHZhbHVlID0gXy5jbG9uZSh2YWx1ZSk7XG5cbiAgICAgIGlmIChfLmhhcyh2YWx1ZSwgXCJ2YWx1ZVwiKSAmJiAhXy5oYXModmFsdWUsIFwiZGlzcGxheVZhbHVlXCIpKSB7XG4gICAgICAgIHZhbHVlLmRpc3BsYXlWYWx1ZSA9IHRoaXMuZm9ybWF0TnVtYmVyKHZhbHVlLnZhbHVlKTtcbiAgICAgIH1cblxuICAgICAgJC5kY3AuZGNwQXR0cmlidXRlLnByb3RvdHlwZS5zZXRWYWx1ZS5hcHBseSh0aGlzLCBbdmFsdWVdKTtcblxuICAgICAgaWYgKHRoaXMuZ2V0TW9kZSgpID09PSBcIndyaXRlXCIpIHtcbiAgICAgICAgdmFyIG9yaWdpbmFsVmFsdWUgPSB0aGlzLmtlbmRvV2lkZ2V0LmRhdGEoXCJrZW5kb0NvbG9yUGlja2VyXCIpLnZhbHVlKCk7XG4gICAgICAgIC8vIDogZXhwbGljaXQgbGF6eSBlcXVhbFxuICAgICAgICAvL25vaW5zcGVjdGlvbiBKU0hpbnRcbiAgICAgICAgaWYgKG9yaWdpbmFsVmFsdWUgIT0gdmFsdWUudmFsdWUpIHtcbiAgICAgICAgICB0aGlzLmtlbmRvV2lkZ2V0LmRhdGEoXCJrZW5kb0NvbG9yUGlja2VyXCIpLnZhbHVlKHZhbHVlLnZhbHVlKTtcbiAgICAgICAgICAvLyBNb2RpZnkgdmFsdWUgb25seSBpZiBkaWZmZXJlbnRcbiAgICAgICAgICB0aGlzLmZsYXNoRWxlbWVudCgpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKHRoaXMuZ2V0TW9kZSgpID09PSBcInJlYWRcIikge1xuICAgICAgICB0aGlzLmdldENvbnRlbnRFbGVtZW50cygpLnRleHQodmFsdWUuZGlzcGxheVZhbHVlKTtcbiAgICAgICAgdGhpcy5lbGVtZW50XG4gICAgICAgICAgLmZpbmQoXCIuZGNwQXR0cmlidXRlX192YWx1ZS0tcmVhZFwiKVxuICAgICAgICAgIC5jc3MoXCJib3JkZXItY29sb3JcIiwgdmFsdWUudmFsdWUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgIFwiQXR0cmlidXRlIFwiICsgdGhpcy5vcHRpb25zLmlkICsgXCIgdW5rb3duIG1vZGUgXCIgKyB0aGlzLmdldE1vZGUoKVxuICAgICAgICApO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICBfYWN0aXZhdGVDb2xvcjogZnVuY3Rpb24gd2NvbEFjdGl2YXRlTnVtYmVyKGlucHV0VmFsdWUpIHtcbiAgICAgIHJldHVybiBpbnB1dFZhbHVlLmtlbmRvQ29sb3JQaWNrZXIodGhpcy5nZXRLZW5kb0NvbG9yT3B0aW9ucygpKTtcbiAgICB9LFxuXG4gICAgZm9ybWF0TnVtYmVyOiBmdW5jdGlvbiB3Y29sRm9ybWF0TnVtYmVyKHZhbHVlKSB7XG4gICAgICByZXR1cm4ga2VuZG8udG9TdHJpbmcodmFsdWUsIHRoaXMuZ2V0S2VuZG9Db2xvck9wdGlvbnMoKS5mb3JtYXQpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBHZXQga2VuZG8gb3B0aW9uIGZyb20gbm9ybWFsIG9wdGlvbnMgYW5kIGZyb20gcmVuZGVyT3B0aW9ucy5rZW5kb051bWVyaWNcbiAgICAgKiBAcmV0dXJucyB7Kn1cbiAgICAgKi9cbiAgICBnZXRLZW5kb0NvbG9yT3B0aW9uczogZnVuY3Rpb24gd0NvbG9yZ2V0S2VuZG9Db2xvck9wdGlvbnMoKSB7XG4gICAgICB2YXIgc2NvcGUgPSB0aGlzLFxuICAgICAgICBrZW5kb09wdGlvbnMgPSB7fSxcbiAgICAgICAgZGVmYXVsdE9wdGlvbnMgPSB7XG4gICAgICAgICAgY2hhbmdlOiBmdW5jdGlvbiB3Q29sb3Jfb25jaGFuZ2UoKSB7XG4gICAgICAgICAgICAvLyBOZWVkIHRvIHNldCBieSB3aWRnZXQgdG8gaG9ub3IgZGVjaW1hbHMgb3B0aW9uXG4gICAgICAgICAgICBzY29wZS5zZXRWYWx1ZSh7IHZhbHVlOiB0aGlzLnZhbHVlKCkgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICBpZiAoXy5pc09iamVjdChzY29wZS5vcHRpb25zLnJlbmRlck9wdGlvbnMua2VuZG9Db2xvckNvbmZpZ3VyYXRpb24pKSB7XG4gICAgICAgIGtlbmRvT3B0aW9ucyA9IHNjb3BlLm9wdGlvbnMucmVuZGVyT3B0aW9ucy5rZW5kb0NvbG9yQ29uZmlndXJhdGlvbjtcbiAgICAgIH1cbiAgICAgIHJldHVybiBfLmV4dGVuZChkZWZhdWx0T3B0aW9ucywga2VuZG9PcHRpb25zKTtcbiAgICB9LFxuXG4gICAgZ2V0VHlwZTogZnVuY3Rpb24gd2NvbEdldFR5cGUoKSB7XG4gICAgICByZXR1cm4gXCJjb2xvclwiO1xuICAgIH0sXG5cbiAgICB0ZXN0VmFsdWU6IGZ1bmN0aW9uIHdjb2xUZXN0VmFsdWUodmFsdWUpIHtcbiAgICAgIHRoaXMuX3N1cGVyKHZhbHVlKTtcbiAgICAgIGlmICghXy5pc051bWJlcih2YWx1ZS52YWx1ZSkpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgIFwiVGhlIHZhbHVlIG11c3QgYmUgYSBudW1iZXIgZm9yIChhdHRyaWQgOiBcIiArIHRoaXMub3B0aW9ucy5pZCArIFwiKVwiXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfSxcblxuICAgIGNsb3NlOiBmdW5jdGlvbiB3Q29sb3JfY2xvc2UoKSB7XG4gICAgICBpZiAodGhpcy5rZW5kb1dpZGdldCAmJiB0aGlzLmtlbmRvV2lkZ2V0LmRhdGEoXCJrZW5kb0NvbG9yUGlja2VyXCIpKSB7XG4gICAgICAgIHRoaXMua2VuZG9XaWRnZXQuZGF0YShcImtlbmRvQ29sb3JQaWNrZXJcIikuY2xvc2UoKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuX3N1cGVyKCk7XG4gICAgfSxcblxuICAgIF9kZXN0cm95OiBmdW5jdGlvbiBfZGVzdHJveSgpIHtcbiAgICAgIGlmICh0aGlzLmtlbmRvV2lkZ2V0ICYmIHRoaXMua2VuZG9XaWRnZXQuZGF0YShcImtlbmRvQ29sb3JQaWNrZXJcIikpIHtcbiAgICAgICAgdGhpcy5rZW5kb1dpZGdldC5kYXRhKFwia2VuZG9Db2xvclBpY2tlclwiKS5kZXN0cm95KCk7XG4gICAgICB9XG4gICAgICB0aGlzLl9zdXBlcigpO1xuICAgIH1cbiAgfSk7XG5cbiAgcmV0dXJuICQuZm4uZGNwQ29sb3I7XG59KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUNBLFdBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///061678c35a7b82df6628\n");

/***/ }),

/***/ "0627c604219b27e8bb7c":
/*!**************************************************************!*\
  !*** ./src/Apps/DOCUMENT/IHM/widgets/attributes/int/wInt.js ***!
  \**************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/*global define*/\n(function umdRequire(root, factory) {\n  \"use strict\";\n\n  if (true) {\n    !(__WEBPACK_AMD_DEFINE_ARRAY__ = [\n      __webpack_require__(/*! jquery */ \"127c8cf59f228bb01a21\"),\n      __webpack_require__(/*! underscore */ \"8e08e542008e4aef1f58\"),\n      __webpack_require__(/*! mustache */ \"bcd31d01884fc294fd69\"),\n      __webpack_require__(/*! dcpDocument/widgets/attributes/text/wText */ \"61b480911316cdda77a4\"),\n      __webpack_require__(/*! kendo-culture-fr */ \"3d2e52a160dc74b891c1\")\n    ], __WEBPACK_AMD_DEFINE_FACTORY__ = (factory),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?\n\t\t\t\t(__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n  } else {}\n})(window, function requireWint($, _, Mustache) {\n  \"use strict\";\n\n  $.widget(\"dcp.dcpInt\", $.dcp.dcpText, {\n    options: {\n      type: \"int\",\n\n      renderOptions: {\n        kendoNumericConfiguration: {},\n        max: null,\n        min: null,\n        numberFormat: \"n0\"\n      },\n      labels: {\n        decreaseLabel: \"Decrease value\",\n        increaseLabel: \"Increase value\"\n      }\n    },\n    /**\n     * The kendoNumericTextBox widget instance\n     */\n    kendoWidget: null,\n\n    _initDom: function wIntInitDom() {\n      this.element.addClass(\"dcpAttribute__content\");\n      this.element.attr(\"data-type\", this.getType());\n      this.element.attr(\"data-attrid\", this.options.id);\n      if (\n        this._stringToFloat(this.options.attributeValue.displayValue) ===\n        parseFloat(this.options.attributeValue.value)\n      ) {\n        this.options.attributeValue.displayValue = this.formatNumber(\n          this.options.attributeValue.value\n        );\n      }\n\n      if (this.getMode() === \"read\") {\n        if (this.options.renderOptions.format) {\n          this.options.attributeValue.formatValue = Mustache.render(\n            this.options.renderOptions.format || \"\",\n            this.options.attributeValue\n          );\n        }\n      }\n\n      //noinspection JSPotentiallyInvalidConstructorUsage,JSAccessibilityCheck\n      $.dcp.dcpAttribute.prototype._initDom.apply(this, []);\n\n      this.kendoWidget = this.element.find(\".dcpAttribute__value--edit\");\n      if (this.kendoWidget) {\n        if (this.options.hasAutocomplete) {\n          this.activateAutocomplete(this.kendoWidget);\n        } else {\n          this._activateNumber(this.kendoWidget);\n        }\n      }\n\n      if (\n        this.element.find(\".dcpAttribute__content__buttons button\").length === 0\n      ) {\n        this.element\n          .find(\".k-numeric-wrap\")\n          .addClass(\"dcpAttribute__content__nobutton\");\n      }\n    },\n\n    _initChangeEvent: function wIntInitChangeEvent() {\n      // set by widget if no autocomplete\n      if (this.options.hasAutocomplete) {\n        this._super();\n      }\n    },\n\n    _stringToFloat: function(text) {\n      if (typeof text === \"string\") {\n        return parseFloat(text.replace(\" \", \"\").replace(\",\", \".\"));\n      }\n      return parseFloat(text);\n    },\n\n    setValue: function wIntSetValue(value) {\n      // this._super.(value);\n      // Don't call dcpText::setValue()\n\n      value = _.clone(value);\n\n      if (_.has(value, \"value\") && !_.has(value, \"displayValue\")) {\n        value.displayValue = this.formatNumber(value.value);\n      } else {\n        if (\n          this._stringToFloat(value.displayValue) === parseFloat(value.value)\n        ) {\n          value.displayValue = this.formatNumber(value.value);\n        }\n      }\n\n      //noinspection JSPotentiallyInvalidConstructorUsage\n      $.dcp.dcpAttribute.prototype.setValue.apply(this, [value]);\n\n      if (this.getMode() === \"write\") {\n        var originalValue = this.kendoWidget\n          .data(\"kendoNumericTextBox\")\n          .value();\n        // : explicit lazy equal\n        //noinspection JSHint\n        if (originalValue != value.value) {\n          this.kendoWidget.data(\"kendoNumericTextBox\").value(value.value);\n          // Modify value only if different\n          this.flashElement();\n        }\n      } else {\n        if (this.getMode() === \"read\") {\n          this.getContentElements().text(value.displayValue);\n        } else {\n          throw new Error(\n            \"Attribute \" + this.options.id + \" unkown mode \" + this.getMode()\n          );\n        }\n      }\n    },\n\n    _activateNumber: function wIntActivateNumber(inputValue) {\n      var kendoWidget,\n        currentCSSClass = inputValue.attr(\"class\");\n      inputValue.removeClass(currentCSSClass);\n      //force display inline-block for work with kendo\n      inputValue.css(\"display\", \"inline-block\");\n      kendoWidget = inputValue.kendoNumericTextBox(\n        this.getKendoNumericOptions()\n      );\n      kendoWidget.closest(\".k-widget\").addClass(currentCSSClass);\n\n      if (\n        this.options.renderOptions.max !== undefined ||\n        this.options.renderOptions.min !== undefined\n      ) {\n        if (\n          this.options.attributeValue.value > this.options.renderOptions.max\n        ) {\n          this.element\n            .find(\".k-formatted-value.k-input\")\n            .val(this.formatNumber(this.options.attributeValue.value));\n        }\n        if (\n          this.options.attributeValue.value < this.options.renderOptions.min\n        ) {\n          this.element\n            .find(\".k-formatted-value.k-input\")\n            .val(this.formatNumber(this.options.attributeValue.value));\n        }\n      }\n      return kendoWidget;\n    },\n\n    formatNumber: function wIntFormatNumber(value) {\n      try {\n        value = kendo.toString(value, this.getKendoNumericOptions().format);\n      } catch (e) {\n        if (window.dcp.logger) {\n          window.dcp.logger(e);\n        } else {\n          console.error(e);\n        }\n        console.error(\"Unable to format the number \" + e);\n      }\n      return value;\n    },\n\n    /**\n     * Get kendo option from normal options and from renderOptions.kendoNumeric\n     * @returns {*}\n     */\n    getKendoNumericOptions: function wIntGetKendoNumericOptions() {\n      var scope = this,\n        kendoOptions = {},\n        defaultOptions = {\n          decimals: 0,\n          downArrowText: scope.options.labels.decreaseLabel,\n          upArrowText: scope.options.labels.increaseLabel,\n          format: scope.options.renderOptions.numberFormat,\n          max: scope.options.renderOptions.max,\n          min: scope.options.renderOptions.min,\n          change: function wIntGetKendoNumericOptions_onChange() {\n            // Need to set by widget to honor decimals option\n            scope.setValue({ value: this.value() });\n          }\n        };\n      if (_.isObject(scope.options.renderOptions.kendoNumericConfiguration)) {\n        kendoOptions = scope.options.renderOptions.kendoNumericConfiguration;\n      }\n\n      return _.extend(defaultOptions, kendoOptions);\n    },\n\n    getType: function wIntGetType() {\n      return \"int\";\n    },\n\n    testValue: function wIntTestValue(value) {\n      this._super(value);\n      if (!_.isNumber(value.value)) {\n        throw new Error(\n          \"The value must be a number for (attrid : \" + this.options.id + \")\"\n        );\n      }\n    },\n\n    _destroy: function _destroy() {\n      if (this.kendoWidget && this.kendoWidget.data(\"kendoNumericTextBox\")) {\n        this.kendoWidget.data(\"kendoNumericTextBox\").destroy();\n      }\n      this._super();\n    }\n  });\n\n  return $.fn.dcpInt;\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMDYyN2M2MDQyMTliMjdlOGJiN2MuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvQXBwcy9ET0NVTUVOVC9JSE0vd2lkZ2V0cy9hdHRyaWJ1dGVzL2ludC93SW50LmpzPzRiZjQiXSwic291cmNlc0NvbnRlbnQiOlsiLypnbG9iYWwgZGVmaW5lKi9cbihmdW5jdGlvbiB1bWRSZXF1aXJlKHJvb3QsIGZhY3RvcnkpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgaWYgKHR5cGVvZiBkZWZpbmUgPT09IFwiZnVuY3Rpb25cIiAmJiBkZWZpbmUuYW1kKSB7XG4gICAgZGVmaW5lKFtcbiAgICAgIFwianF1ZXJ5XCIsXG4gICAgICBcInVuZGVyc2NvcmVcIixcbiAgICAgIFwibXVzdGFjaGVcIixcbiAgICAgIFwiZGNwRG9jdW1lbnQvd2lkZ2V0cy9hdHRyaWJ1dGVzL3RleHQvd1RleHRcIixcbiAgICAgIFwia2VuZG8tY3VsdHVyZS1mclwiXG4gICAgXSwgZmFjdG9yeSk7XG4gIH0gZWxzZSB7XG4gICAgLy9ub2luc3BlY3Rpb24gSlNVbnJlc29sdmVkVmFyaWFibGVcbiAgICBmYWN0b3J5KHdpbmRvdy5qUXVlcnksIHdpbmRvdy5fLCB3aW5kb3cuTXVzdGFjaGUpO1xuICB9XG59KSh3aW5kb3csIGZ1bmN0aW9uIHJlcXVpcmVXaW50KCQsIF8sIE11c3RhY2hlKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gICQud2lkZ2V0KFwiZGNwLmRjcEludFwiLCAkLmRjcC5kY3BUZXh0LCB7XG4gICAgb3B0aW9uczoge1xuICAgICAgdHlwZTogXCJpbnRcIixcblxuICAgICAgcmVuZGVyT3B0aW9uczoge1xuICAgICAgICBrZW5kb051bWVyaWNDb25maWd1cmF0aW9uOiB7fSxcbiAgICAgICAgbWF4OiBudWxsLFxuICAgICAgICBtaW46IG51bGwsXG4gICAgICAgIG51bWJlckZvcm1hdDogXCJuMFwiXG4gICAgICB9LFxuICAgICAgbGFiZWxzOiB7XG4gICAgICAgIGRlY3JlYXNlTGFiZWw6IFwiRGVjcmVhc2UgdmFsdWVcIixcbiAgICAgICAgaW5jcmVhc2VMYWJlbDogXCJJbmNyZWFzZSB2YWx1ZVwiXG4gICAgICB9XG4gICAgfSxcbiAgICAvKipcbiAgICAgKiBUaGUga2VuZG9OdW1lcmljVGV4dEJveCB3aWRnZXQgaW5zdGFuY2VcbiAgICAgKi9cbiAgICBrZW5kb1dpZGdldDogbnVsbCxcblxuICAgIF9pbml0RG9tOiBmdW5jdGlvbiB3SW50SW5pdERvbSgpIHtcbiAgICAgIHRoaXMuZWxlbWVudC5hZGRDbGFzcyhcImRjcEF0dHJpYnV0ZV9fY29udGVudFwiKTtcbiAgICAgIHRoaXMuZWxlbWVudC5hdHRyKFwiZGF0YS10eXBlXCIsIHRoaXMuZ2V0VHlwZSgpKTtcbiAgICAgIHRoaXMuZWxlbWVudC5hdHRyKFwiZGF0YS1hdHRyaWRcIiwgdGhpcy5vcHRpb25zLmlkKTtcbiAgICAgIGlmIChcbiAgICAgICAgdGhpcy5fc3RyaW5nVG9GbG9hdCh0aGlzLm9wdGlvbnMuYXR0cmlidXRlVmFsdWUuZGlzcGxheVZhbHVlKSA9PT1cbiAgICAgICAgcGFyc2VGbG9hdCh0aGlzLm9wdGlvbnMuYXR0cmlidXRlVmFsdWUudmFsdWUpXG4gICAgICApIHtcbiAgICAgICAgdGhpcy5vcHRpb25zLmF0dHJpYnV0ZVZhbHVlLmRpc3BsYXlWYWx1ZSA9IHRoaXMuZm9ybWF0TnVtYmVyKFxuICAgICAgICAgIHRoaXMub3B0aW9ucy5hdHRyaWJ1dGVWYWx1ZS52YWx1ZVxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy5nZXRNb2RlKCkgPT09IFwicmVhZFwiKSB7XG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMucmVuZGVyT3B0aW9ucy5mb3JtYXQpIHtcbiAgICAgICAgICB0aGlzLm9wdGlvbnMuYXR0cmlidXRlVmFsdWUuZm9ybWF0VmFsdWUgPSBNdXN0YWNoZS5yZW5kZXIoXG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMucmVuZGVyT3B0aW9ucy5mb3JtYXQgfHwgXCJcIixcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucy5hdHRyaWJ1dGVWYWx1ZVxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy9ub2luc3BlY3Rpb24gSlNQb3RlbnRpYWxseUludmFsaWRDb25zdHJ1Y3RvclVzYWdlLEpTQWNjZXNzaWJpbGl0eUNoZWNrXG4gICAgICAkLmRjcC5kY3BBdHRyaWJ1dGUucHJvdG90eXBlLl9pbml0RG9tLmFwcGx5KHRoaXMsIFtdKTtcblxuICAgICAgdGhpcy5rZW5kb1dpZGdldCA9IHRoaXMuZWxlbWVudC5maW5kKFwiLmRjcEF0dHJpYnV0ZV9fdmFsdWUtLWVkaXRcIik7XG4gICAgICBpZiAodGhpcy5rZW5kb1dpZGdldCkge1xuICAgICAgICBpZiAodGhpcy5vcHRpb25zLmhhc0F1dG9jb21wbGV0ZSkge1xuICAgICAgICAgIHRoaXMuYWN0aXZhdGVBdXRvY29tcGxldGUodGhpcy5rZW5kb1dpZGdldCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5fYWN0aXZhdGVOdW1iZXIodGhpcy5rZW5kb1dpZGdldCk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKFxuICAgICAgICB0aGlzLmVsZW1lbnQuZmluZChcIi5kY3BBdHRyaWJ1dGVfX2NvbnRlbnRfX2J1dHRvbnMgYnV0dG9uXCIpLmxlbmd0aCA9PT0gMFxuICAgICAgKSB7XG4gICAgICAgIHRoaXMuZWxlbWVudFxuICAgICAgICAgIC5maW5kKFwiLmstbnVtZXJpYy13cmFwXCIpXG4gICAgICAgICAgLmFkZENsYXNzKFwiZGNwQXR0cmlidXRlX19jb250ZW50X19ub2J1dHRvblwiKTtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgX2luaXRDaGFuZ2VFdmVudDogZnVuY3Rpb24gd0ludEluaXRDaGFuZ2VFdmVudCgpIHtcbiAgICAgIC8vIHNldCBieSB3aWRnZXQgaWYgbm8gYXV0b2NvbXBsZXRlXG4gICAgICBpZiAodGhpcy5vcHRpb25zLmhhc0F1dG9jb21wbGV0ZSkge1xuICAgICAgICB0aGlzLl9zdXBlcigpO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICBfc3RyaW5nVG9GbG9hdDogZnVuY3Rpb24odGV4dCkge1xuICAgICAgaWYgKHR5cGVvZiB0ZXh0ID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgIHJldHVybiBwYXJzZUZsb2F0KHRleHQucmVwbGFjZShcIiBcIiwgXCJcIikucmVwbGFjZShcIixcIiwgXCIuXCIpKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBwYXJzZUZsb2F0KHRleHQpO1xuICAgIH0sXG5cbiAgICBzZXRWYWx1ZTogZnVuY3Rpb24gd0ludFNldFZhbHVlKHZhbHVlKSB7XG4gICAgICAvLyB0aGlzLl9zdXBlci4odmFsdWUpO1xuICAgICAgLy8gRG9uJ3QgY2FsbCBkY3BUZXh0OjpzZXRWYWx1ZSgpXG5cbiAgICAgIHZhbHVlID0gXy5jbG9uZSh2YWx1ZSk7XG5cbiAgICAgIGlmIChfLmhhcyh2YWx1ZSwgXCJ2YWx1ZVwiKSAmJiAhXy5oYXModmFsdWUsIFwiZGlzcGxheVZhbHVlXCIpKSB7XG4gICAgICAgIHZhbHVlLmRpc3BsYXlWYWx1ZSA9IHRoaXMuZm9ybWF0TnVtYmVyKHZhbHVlLnZhbHVlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmIChcbiAgICAgICAgICB0aGlzLl9zdHJpbmdUb0Zsb2F0KHZhbHVlLmRpc3BsYXlWYWx1ZSkgPT09IHBhcnNlRmxvYXQodmFsdWUudmFsdWUpXG4gICAgICAgICkge1xuICAgICAgICAgIHZhbHVlLmRpc3BsYXlWYWx1ZSA9IHRoaXMuZm9ybWF0TnVtYmVyKHZhbHVlLnZhbHVlKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvL25vaW5zcGVjdGlvbiBKU1BvdGVudGlhbGx5SW52YWxpZENvbnN0cnVjdG9yVXNhZ2VcbiAgICAgICQuZGNwLmRjcEF0dHJpYnV0ZS5wcm90b3R5cGUuc2V0VmFsdWUuYXBwbHkodGhpcywgW3ZhbHVlXSk7XG5cbiAgICAgIGlmICh0aGlzLmdldE1vZGUoKSA9PT0gXCJ3cml0ZVwiKSB7XG4gICAgICAgIHZhciBvcmlnaW5hbFZhbHVlID0gdGhpcy5rZW5kb1dpZGdldFxuICAgICAgICAgIC5kYXRhKFwia2VuZG9OdW1lcmljVGV4dEJveFwiKVxuICAgICAgICAgIC52YWx1ZSgpO1xuICAgICAgICAvLyA6IGV4cGxpY2l0IGxhenkgZXF1YWxcbiAgICAgICAgLy9ub2luc3BlY3Rpb24gSlNIaW50XG4gICAgICAgIGlmIChvcmlnaW5hbFZhbHVlICE9IHZhbHVlLnZhbHVlKSB7XG4gICAgICAgICAgdGhpcy5rZW5kb1dpZGdldC5kYXRhKFwia2VuZG9OdW1lcmljVGV4dEJveFwiKS52YWx1ZSh2YWx1ZS52YWx1ZSk7XG4gICAgICAgICAgLy8gTW9kaWZ5IHZhbHVlIG9ubHkgaWYgZGlmZmVyZW50XG4gICAgICAgICAgdGhpcy5mbGFzaEVsZW1lbnQoKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKHRoaXMuZ2V0TW9kZSgpID09PSBcInJlYWRcIikge1xuICAgICAgICAgIHRoaXMuZ2V0Q29udGVudEVsZW1lbnRzKCkudGV4dCh2YWx1ZS5kaXNwbGF5VmFsdWUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAgIFwiQXR0cmlidXRlIFwiICsgdGhpcy5vcHRpb25zLmlkICsgXCIgdW5rb3duIG1vZGUgXCIgKyB0aGlzLmdldE1vZGUoKVxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuXG4gICAgX2FjdGl2YXRlTnVtYmVyOiBmdW5jdGlvbiB3SW50QWN0aXZhdGVOdW1iZXIoaW5wdXRWYWx1ZSkge1xuICAgICAgdmFyIGtlbmRvV2lkZ2V0LFxuICAgICAgICBjdXJyZW50Q1NTQ2xhc3MgPSBpbnB1dFZhbHVlLmF0dHIoXCJjbGFzc1wiKTtcbiAgICAgIGlucHV0VmFsdWUucmVtb3ZlQ2xhc3MoY3VycmVudENTU0NsYXNzKTtcbiAgICAgIC8vZm9yY2UgZGlzcGxheSBpbmxpbmUtYmxvY2sgZm9yIHdvcmsgd2l0aCBrZW5kb1xuICAgICAgaW5wdXRWYWx1ZS5jc3MoXCJkaXNwbGF5XCIsIFwiaW5saW5lLWJsb2NrXCIpO1xuICAgICAga2VuZG9XaWRnZXQgPSBpbnB1dFZhbHVlLmtlbmRvTnVtZXJpY1RleHRCb3goXG4gICAgICAgIHRoaXMuZ2V0S2VuZG9OdW1lcmljT3B0aW9ucygpXG4gICAgICApO1xuICAgICAga2VuZG9XaWRnZXQuY2xvc2VzdChcIi5rLXdpZGdldFwiKS5hZGRDbGFzcyhjdXJyZW50Q1NTQ2xhc3MpO1xuXG4gICAgICBpZiAoXG4gICAgICAgIHRoaXMub3B0aW9ucy5yZW5kZXJPcHRpb25zLm1heCAhPT0gdW5kZWZpbmVkIHx8XG4gICAgICAgIHRoaXMub3B0aW9ucy5yZW5kZXJPcHRpb25zLm1pbiAhPT0gdW5kZWZpbmVkXG4gICAgICApIHtcbiAgICAgICAgaWYgKFxuICAgICAgICAgIHRoaXMub3B0aW9ucy5hdHRyaWJ1dGVWYWx1ZS52YWx1ZSA+IHRoaXMub3B0aW9ucy5yZW5kZXJPcHRpb25zLm1heFxuICAgICAgICApIHtcbiAgICAgICAgICB0aGlzLmVsZW1lbnRcbiAgICAgICAgICAgIC5maW5kKFwiLmstZm9ybWF0dGVkLXZhbHVlLmstaW5wdXRcIilcbiAgICAgICAgICAgIC52YWwodGhpcy5mb3JtYXROdW1iZXIodGhpcy5vcHRpb25zLmF0dHJpYnV0ZVZhbHVlLnZhbHVlKSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKFxuICAgICAgICAgIHRoaXMub3B0aW9ucy5hdHRyaWJ1dGVWYWx1ZS52YWx1ZSA8IHRoaXMub3B0aW9ucy5yZW5kZXJPcHRpb25zLm1pblxuICAgICAgICApIHtcbiAgICAgICAgICB0aGlzLmVsZW1lbnRcbiAgICAgICAgICAgIC5maW5kKFwiLmstZm9ybWF0dGVkLXZhbHVlLmstaW5wdXRcIilcbiAgICAgICAgICAgIC52YWwodGhpcy5mb3JtYXROdW1iZXIodGhpcy5vcHRpb25zLmF0dHJpYnV0ZVZhbHVlLnZhbHVlKSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBrZW5kb1dpZGdldDtcbiAgICB9LFxuXG4gICAgZm9ybWF0TnVtYmVyOiBmdW5jdGlvbiB3SW50Rm9ybWF0TnVtYmVyKHZhbHVlKSB7XG4gICAgICB0cnkge1xuICAgICAgICB2YWx1ZSA9IGtlbmRvLnRvU3RyaW5nKHZhbHVlLCB0aGlzLmdldEtlbmRvTnVtZXJpY09wdGlvbnMoKS5mb3JtYXQpO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICBpZiAod2luZG93LmRjcC5sb2dnZXIpIHtcbiAgICAgICAgICB3aW5kb3cuZGNwLmxvZ2dlcihlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKGUpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJVbmFibGUgdG8gZm9ybWF0IHRoZSBudW1iZXIgXCIgKyBlKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB2YWx1ZTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogR2V0IGtlbmRvIG9wdGlvbiBmcm9tIG5vcm1hbCBvcHRpb25zIGFuZCBmcm9tIHJlbmRlck9wdGlvbnMua2VuZG9OdW1lcmljXG4gICAgICogQHJldHVybnMgeyp9XG4gICAgICovXG4gICAgZ2V0S2VuZG9OdW1lcmljT3B0aW9uczogZnVuY3Rpb24gd0ludEdldEtlbmRvTnVtZXJpY09wdGlvbnMoKSB7XG4gICAgICB2YXIgc2NvcGUgPSB0aGlzLFxuICAgICAgICBrZW5kb09wdGlvbnMgPSB7fSxcbiAgICAgICAgZGVmYXVsdE9wdGlvbnMgPSB7XG4gICAgICAgICAgZGVjaW1hbHM6IDAsXG4gICAgICAgICAgZG93bkFycm93VGV4dDogc2NvcGUub3B0aW9ucy5sYWJlbHMuZGVjcmVhc2VMYWJlbCxcbiAgICAgICAgICB1cEFycm93VGV4dDogc2NvcGUub3B0aW9ucy5sYWJlbHMuaW5jcmVhc2VMYWJlbCxcbiAgICAgICAgICBmb3JtYXQ6IHNjb3BlLm9wdGlvbnMucmVuZGVyT3B0aW9ucy5udW1iZXJGb3JtYXQsXG4gICAgICAgICAgbWF4OiBzY29wZS5vcHRpb25zLnJlbmRlck9wdGlvbnMubWF4LFxuICAgICAgICAgIG1pbjogc2NvcGUub3B0aW9ucy5yZW5kZXJPcHRpb25zLm1pbixcbiAgICAgICAgICBjaGFuZ2U6IGZ1bmN0aW9uIHdJbnRHZXRLZW5kb051bWVyaWNPcHRpb25zX29uQ2hhbmdlKCkge1xuICAgICAgICAgICAgLy8gTmVlZCB0byBzZXQgYnkgd2lkZ2V0IHRvIGhvbm9yIGRlY2ltYWxzIG9wdGlvblxuICAgICAgICAgICAgc2NvcGUuc2V0VmFsdWUoeyB2YWx1ZTogdGhpcy52YWx1ZSgpIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgIGlmIChfLmlzT2JqZWN0KHNjb3BlLm9wdGlvbnMucmVuZGVyT3B0aW9ucy5rZW5kb051bWVyaWNDb25maWd1cmF0aW9uKSkge1xuICAgICAgICBrZW5kb09wdGlvbnMgPSBzY29wZS5vcHRpb25zLnJlbmRlck9wdGlvbnMua2VuZG9OdW1lcmljQ29uZmlndXJhdGlvbjtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIF8uZXh0ZW5kKGRlZmF1bHRPcHRpb25zLCBrZW5kb09wdGlvbnMpO1xuICAgIH0sXG5cbiAgICBnZXRUeXBlOiBmdW5jdGlvbiB3SW50R2V0VHlwZSgpIHtcbiAgICAgIHJldHVybiBcImludFwiO1xuICAgIH0sXG5cbiAgICB0ZXN0VmFsdWU6IGZ1bmN0aW9uIHdJbnRUZXN0VmFsdWUodmFsdWUpIHtcbiAgICAgIHRoaXMuX3N1cGVyKHZhbHVlKTtcbiAgICAgIGlmICghXy5pc051bWJlcih2YWx1ZS52YWx1ZSkpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgIFwiVGhlIHZhbHVlIG11c3QgYmUgYSBudW1iZXIgZm9yIChhdHRyaWQgOiBcIiArIHRoaXMub3B0aW9ucy5pZCArIFwiKVwiXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfSxcblxuICAgIF9kZXN0cm95OiBmdW5jdGlvbiBfZGVzdHJveSgpIHtcbiAgICAgIGlmICh0aGlzLmtlbmRvV2lkZ2V0ICYmIHRoaXMua2VuZG9XaWRnZXQuZGF0YShcImtlbmRvTnVtZXJpY1RleHRCb3hcIikpIHtcbiAgICAgICAgdGhpcy5rZW5kb1dpZGdldC5kYXRhKFwia2VuZG9OdW1lcmljVGV4dEJveFwiKS5kZXN0cm95KCk7XG4gICAgICB9XG4gICAgICB0aGlzLl9zdXBlcigpO1xuICAgIH1cbiAgfSk7XG5cbiAgcmV0dXJuICQuZm4uZGNwSW50O1xufSk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUNBLFdBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///0627c604219b27e8bb7c\n");

/***/ }),

/***/ "07b96fa8c545aab31dad":
/*!***********************************************************!*\
  !*** ./src/Apps/DOCUMENT/IHM/views/document/vDocument.js ***!
  \***********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/*global define, console*/\n\n!(__WEBPACK_AMD_DEFINE_ARRAY__ = [\n  __webpack_require__(/*! underscore */ \"8e08e542008e4aef1f58\"),\n  __webpack_require__(/*! jquery */ \"127c8cf59f228bb01a21\"),\n  __webpack_require__(/*! backbone */ \"1858b45bf48591489d06\"),\n  __webpack_require__(/*! mustache */ \"bcd31d01884fc294fd69\"),\n  __webpack_require__(/*! dcpDocument/models/mDocumentTab */ \"e3b629bb5804c565e69e\"),\n  __webpack_require__(/*! dcpDocument/views/document/menu/vMenu */ \"30f8a357b2168c64d123\"),\n  __webpack_require__(/*! dcpDocument/views/document/header/vHeader */ \"652c2ab97314f0cc36e3\"),\n  __webpack_require__(/*! dcpDocument/views/attributes/frame/vFrame */ \"7a4c946b6dd0337fa34b\"),\n  __webpack_require__(/*! dcpDocument/views/attributes/tab/vTabLabel */ \"4eae4dcce004a8d344d8\"),\n  __webpack_require__(/*! dcpDocument/views/attributes/tab/vTabContent */ \"b3a839c4520ca8b4b597\"),\n  __webpack_require__(/*! dcpDocument/views/document/attributeTemplate */ \"593c8c94ba4399020f79\"),\n  __webpack_require__(/*! dcpDocument/models/mTransitionGraph */ \"97de2f4cc762b1768ee2\"),\n  __webpack_require__(/*! dcpDocument/views/workflow/vTransitionGraph */ \"0ce7df67ddafeaa3e32e\"),\n  __webpack_require__(/*! dcpDocument/i18n/documentCatalog */ \"278ba7757aa1904087c6\"),\n  __webpack_require__(/*! dcpDocument/widgets/history/wHistory */ \"67953bae88ec8fa1ab26\"),\n  __webpack_require__(/*! dcpDocument/widgets/properties/wProperties */ \"e6944ecc13b0862a73e7\")\n], __WEBPACK_AMD_DEFINE_RESULT__ = (function vDocument(\n  _,\n  $,\n  Backbone,\n  Mustache,\n  ModelDocumentTab,\n  ViewDocumentMenu,\n  ViewDocumentHeader,\n  ViewAttributeFrame,\n  ViewAttributeTabLabel,\n  ViewAttributeTabContent,\n  attributeTemplate,\n  ModelTransitionGraph,\n  ViewTransitionGraph,\n  i18n\n) {\n  \"use strict\";\n\n  var checkTouchEvents = function checkTouchEvents() {\n    //From modernizer\n    var bool = false;\n    if (\n      \"ontouchstart\" in window ||\n      (window.DocumentTouch && window.document instanceof window.DocumentTouch)\n    ) {\n      bool = true;\n    }\n    return bool;\n  };\n\n  return Backbone.View.extend({\n    className: \"dcpDocument container-fluid\",\n\n    events: {\n      'click .dcpDocument__body a[href^=\"#action/\"], .dcpDocument__body a[data-action], .dcpDocument__body button[data-action]':\n        \"propagateActionClick\",\n      'click .dcpDocument__body a[href^=\"#\"]': \"handleHashClick\"\n    },\n\n    /**\n     * Init event\n     */\n    initialize: function vDocumentInitialize() {\n      this.listenTo(this.model, \"destroy\", this.remove);\n      this.listenTo(this.model, \"displayLoading\", this.displayLoading);\n      this.listenTo(this.model, \"invalid\", this.showView);\n      this.listenTo(\n        this.model,\n        \"displayNetworkError\",\n        this.displayNetworkError\n      );\n      this.listenTo(this.model, \"actionAttributeLink\", this.doStandardAction);\n      this.listenTo(this.model, \"loadDocument\", this.loadDocument);\n      this.listenTo(this.model, \"redrawErrorMessages\", this.redrawTootips);\n      this.listenTo(this.model, \"doSelectTab\", this.selectTab);\n      this.listenTo(this.model, \"doDrawTab\", this.drawTab);\n      this.listenTo(this.model, \"dduiDocumentReady\", this.cleanAndRender);\n      this.listenTo(this.model, \"dduiDocumentDisplayView\", this.showView);\n    },\n\n    /**\n     * Clean the associated view and re-render it\n     */\n    cleanAndRender: function vDocumentCleanAndRender() {\n      this.trigger(\"loaderShow\", i18n.___(\"Rendering\", \"ddui\"), 70);\n      $(\".dcpStaticErrorMessage\").attr(\"hidden\", true);\n      this.$el.show();\n      this.$el[0].className = this.$el[0].className.replace(\n        /\\bdcpFamily.*\\b/g,\n        \"\"\n      );\n      this.$el\n        .removeClass(\"dcpDocument--view\")\n        .removeClass(\"dcpDocument--edit\");\n      try {\n        if (this.historyWidget) {\n          this.historyWidget.destroy();\n        }\n        if (this.propertiesWidget) {\n          this.propertiesWidget.destroy();\n        }\n        if (this.helpWidget) {\n          this.helpWidget.destroy();\n        }\n        if (this.transitionGraph && this.transitionGraph.view) {\n          this.transitionGraph.view.remove();\n        }\n      } catch (e) {\n        console.error(e);\n      }\n      //  this.trigger(\"cleanNotification\");\n      this.render();\n    },\n\n    /**\n     * Render the document view\n     * @returns {*}\n     */\n    render: function vDocumentRender() {\n      console.time(\"render document view\");\n      var renderPromises = [];\n      var $content,\n        model = this.model,\n        $el = this.$el,\n        currentView = this;\n      var locale = this.model.get(\"locale\");\n      var documentView = this;\n      var htmlBody =\n        '<div class=\"dcpDocument__form form-horizontal\">' +\n        '<div class=\"dcpDocument__frames\"></div>' +\n        '<div style=\"display:none\" class=\"dcpDocument__tabs\">' +\n        '<ul class=\"dcpDocument__tabs__list\"></ul></div></div>';\n      var $body;\n      var tabPlacement = this.model.getOption(\"tabPlacement\") || \"top\";\n      var event = { prevent: false };\n      var viewMenus = [];\n\n      this.$el.removeClass(\"dcpTouch\");\n      if (checkTouchEvents()) {\n        this.$el.addClass(\"dcpTouch\");\n      }\n\n      this.selectedTab = this.model.getOption(\"openFirstTab\");\n      this.model.trigger(\"beforeRender\", event);\n\n      if (event.prevent) {\n        return this;\n      }\n\n      this.template = this.getTemplates(\"body\").trim();\n      this.partials = this.getTemplates(\"sections\");\n\n      // Hide parasite tooltip if any\n      this.$el.find(\"[aria-describedby*='tooltip']\").tooltip(\"hide\");\n      this.$el.empty();\n\n      this.renderCss();\n      this.publishMessages();\n\n      this.updateTitle();\n      this.updateIcon();\n\n      if (!locale) {\n        locale = \"fr-FR\";\n      }\n      $(window).off(\".v\" + this.model.cid);\n\n      $(window).on(\n        \"resize.v\" + this.model.cid,\n        _.bind(this.resizeForFooter, this)\n      );\n      kendo.culture(locale);\n      //add document base\n      try {\n        var renderData = this.model.toData();\n        renderData.document = attributeTemplate.getTemplateModelInfo(\n          this.model\n        );\n        this.$el.append(\n          $(Mustache.render(this.template || \"\", renderData, this.partials))\n        );\n        attributeTemplate.completeCustomContent(this.$el, this.model, null, {\n          initializeContent: true\n        });\n        $body = this.$el\n          .find(\".dcpDocument__body\")\n          .append(htmlBody)\n          .addClass(\"container-fluid\");\n      } catch (e) {\n        if (window.dcp.logger) {\n          window.dcp.logger(e);\n        } else {\n          console.error(e);\n        }\n      }\n\n      this.$el.removeClass(\"dcpDocument--create\");\n      if (this.model.get(\"creationFamid\")) {\n        this.$el.addClass(\"dcpDocument--create\");\n      }\n      this.$el.addClass(\n        \"dcpDocument dcpDocument--\" + this.model.get(\"renderMode\")\n      );\n      this.$el.addClass(\n        \"dcpFamily--\" + this.model.get(\"properties\").get(\"family\").name\n      );\n      this.trigger(\"loading\", 10);\n      //add menu\n      try {\n        this.$el.find(\".dcpDocument__menu\").each(function vDocumentAddMenu() {\n          var viewMenu = new ViewDocumentMenu({\n            model: currentView.model,\n            el: this\n          });\n          renderPromises.push(viewMenu.render());\n          viewMenus.push(viewMenu);\n        });\n      } catch (e) {\n        if (window.dcp.logger) {\n          window.dcp.logger(e);\n        } else {\n          console.error(e);\n        }\n      }\n      try {\n        this.$el\n          .find(\".dcpDocument__header\")\n          .each(function vDocumentAddHeader() {\n            renderPromises.push(\n              new ViewDocumentHeader({\n                model: currentView.model,\n                el: this\n              }).render()\n            );\n          });\n      } catch (e) {\n        if (window.dcp.logger) {\n          window.dcp.logger(e);\n        } else {\n          console.error(e);\n        }\n      }\n      this.trigger(\"loading\", 20, this.model.get(\"attributes\").length);\n      //add first level attributes\n\n      $content = this.$el.find(\".dcpDocument__frames\");\n      if ($body && $body.length > 0) {\n        this.model\n          .get(\"attributes\")\n          .each(function vDocumentRenderAttribute(currentAttr) {\n            var view, viewTabLabel, viewTabContent;\n            if (!currentAttr.isDisplayable()) {\n              currentView.trigger(\"partRender\");\n              return;\n            }\n            if (\n              currentAttr.get(\"type\") === \"frame\" &&\n              _.isEmpty(currentAttr.get(\"parent\"))\n            ) {\n              try {\n                view = new ViewAttributeFrame({\n                  model: model.get(\"attributes\").get(currentAttr.id)\n                });\n                renderPromises.push(view.render());\n                $content.append(view.$el);\n              } catch (e) {\n                if (window.dcp.logger) {\n                  window.dcp.logger(e);\n                } else {\n                  console.error(e);\n                }\n              }\n            }\n            if (\n              currentAttr.get(\"type\") === \"tab\" &&\n              _.isEmpty(currentAttr.get(\"parent\"))\n            ) {\n              try {\n                var tabModel = model.get(\"attributes\").get(currentAttr.id);\n                var tabContent;\n                viewTabLabel = new ViewAttributeTabLabel({ model: tabModel });\n\n                viewTabContent = new ViewAttributeTabContent({\n                  model: tabModel\n                });\n                renderPromises.push(viewTabContent.render());\n\n                tabContent = viewTabContent.$el;\n\n                $el\n                  .find(\".dcpDocument__tabs__list\")\n                  .append(viewTabLabel.render().$el);\n\n                $el.find(\".dcpDocument__tabs\").append(tabContent);\n                $el.find(\".dcpDocument__tabs\").show();\n              } catch (e) {\n                if (window.dcp.logger) {\n                  window.dcp.logger(e);\n                } else {\n                  console.error(e);\n                }\n              }\n            }\n            currentView.trigger(\"partRender\");\n          });\n\n        this.kendoTabs = this.$(\".dcpDocument__tabs\").kendoTabStrip({\n          tabPosition: tabPlacement,\n          animation: {\n            open: {\n              duration: 100,\n              effects: \"fadeIn\"\n            }\n          },\n          select: function vDocumentKendoSelectTab(event) {\n            var tabId = $(event.item).data(\"attrid\");\n            var tab = currentView.model.get(\"attributes\").get(tabId);\n\n            if (tab) {\n              tab.isRealSelected = true;\n              tab.trigger(\"attributeBeforeTabSelect\", event, tabId);\n            }\n          },\n          activate: function vDocumentShowTab(event) {\n            var tabId = $(event.item).data(\"attrid\");\n            var scrollY = $(window).scrollTop();\n            currentView\n              .$(\".dcpTab__label\")\n              .removeClass(\"dcpLabel--active\")\n              .addClass(\"dcpLabel--default\");\n            currentView\n              .$('.dcpLabel[data-attrid=\"' + tabId + '\"]')\n              .addClass(\"dcpLabel--active\")\n              .removeClass(\"dcpLabel--default\");\n            if (documentView.selectedTab !== tabId) {\n              documentView.selectedTab = tabId;\n              documentView.recordSelectedTab(tabId);\n            }\n            _.defer(function selectOneTab() {\n              if (\n                currentView &&\n                currentView.model &&\n                currentView.model.get(\"attributes\")\n              ) {\n                var tab = currentView.model.get(\"attributes\").get(tabId);\n                if (tab) {\n                  tab.trigger(\"showTab\", event);\n                  _.each(viewMenus, function(viewMenu) {\n                    viewMenu.refresh();\n                  });\n                  _.defer(function() {\n                    $(window).scrollTop(scrollY);\n                  });\n                }\n              }\n            });\n            if (!this._dcpNotFirstactivate) {\n              _.delay(\n                _.bind(documentView.scrollTobVisibleTab, documentView),\n                500\n              );\n              this._dcpNotFirstactivate = true;\n            }\n          }\n        });\n        if (tabPlacement === \"topProportional\") {\n          var tabItems = $el.find(\".dcpDocument__tabs__list li\");\n          if (tabItems.length > 1) {\n            tabItems.css(\n              \"width\",\n              Math.floor(100 / tabItems.length) - 0.5 + \"%\"\n            );\n          } else {\n            tabItems.css(\"width\", \"80%\");\n          }\n        }\n        if (tabPlacement === \"left\") {\n          this.$(\".dcpTab__content\").css(\n            \"min-height\",\n            this.$(\".dcpDocument__tabs__list\").height() + \"px\"\n          );\n          this.$(\".dcpDocument__tabs\").addClass(\"dcpDocument__tabs--left\");\n        }\n\n        if (tabPlacement === \"topFix\" && this.kendoTabs) {\n          this.$(\".dcpDocument__tabs\").addClass(\"dcpDocument__tabs--fixed\");\n\n          $(window).on(\n            \"resize.v\" + this.model.cid,\n            _.debounce(_.bind(this.responsiveTabMenu, this), 100, false)\n          );\n        }\n        if (tabPlacement === \"top\" && this.kendoTabs) {\n          this.$(\".dcpDocument__tabs\").addClass(\"dcpDocument__tabs--fixed\");\n          $(window).on(\n            \"resize.v\" + this.model.cid,\n            _.debounce(_.bind(this.scrollTabList, this), 100, false)\n          );\n          _.delay(_.bind(this.scrollTabList, this), 500);\n        }\n\n        if (this.kendoTabs.length > 0 && this.kendoTabs.data(\"kendoTabStrip\")) {\n          var selectTab = 'li[data-attrid=\"' + this.selectedTab + '\"]';\n          if (this.selectedTab && $(selectTab).length > 0) {\n            this.kendoTabs.data(\"kendoTabStrip\").select(selectTab);\n          } else {\n            this.kendoTabs.data(\"kendoTabStrip\").select(0);\n          }\n        }\n      }\n      $(window.document)\n        .on(\n          \"drop.v\" + this.model.cid + \" dragover.\" + this.model.cid,\n          function vDocumentPreventDragDrop(e) {\n            e.preventDefault();\n          }\n        )\n        .on(\n          \"redrawErrorMessages.v\" + this.model.cid,\n          function vDocumentRedrawErrorMessages() {\n            documentView.redrawTootips();\n          }\n        );\n      $(window).on(\n        \"resize.v\" + this.model.cid,\n        _.debounce(\n          function vDocumentResizeDebounce() {\n            documentView.redrawTootips();\n            documentView.scrollTobVisibleTab();\n          },\n          100,\n          false\n        )\n      );\n\n      $(window).on(\n        \"resize.v\" + this.model.cid,\n        _.debounce(\n          function vDocumentResizeDebounce() {\n            if (documentView.model.get(\"attributes\")) {\n              documentView.model\n                .get(\"attributes\")\n                .each(function vDocument_triggerClose(currentAttributeModel) {\n                  currentAttributeModel.trigger(\"closeWidget\");\n                });\n            }\n          },\n          100,\n          false\n        )\n      );\n\n      this.$el.addClass(\"dcpDocument--show\");\n\n      this.resizeForFooter();\n      console.timeEnd(\"render document view\");\n      Promise.all(renderPromises).then(\n        _.bind(function vDocumentRenderDone() {\n          this.trigger(\"renderDone\");\n        }, this)\n      );\n      this.$el.show();\n      if (tabPlacement === \"topFix\" && this.kendoTabs) {\n        _.defer(_.bind(this.responsiveTabMenu, this)); // need to call here to have good dimensions\n      }\n      if (tabPlacement === \"left\") {\n        this.$(\".dcpTab__content\").css(\n          \"width\",\n          \"calc(100% - \" + ($(\".dcpDocument__tabs__list\").width() + 30) + \"px)\"\n        );\n      }\n\n      _.delay(function vDocumentEndLoading() {\n        $(\".dcpLoading--init\").removeClass(\"dcpLoading--init\");\n        if (tabPlacement === \"topFix\" && documentView.kendoTabs) {\n          documentView.responsiveTabMenu(); // need to call here to have good dimensions\n        }\n      }, 500);\n\n      return this;\n    },\n\n    selectTab: function VDocumentSelectTab(tabId) {\n      if (tabId) {\n        if (!Number.isInteger(tabId)) {\n          tabId = this.$el.find(\n            'li.dcpTab__label[data-attrid=\"' + tabId + '\"]'\n          );\n        }\n        this.kendoTabs.data(\"kendoTabStrip\").select(tabId);\n      }\n    },\n    drawTab: function VDocumentDrawTab(tabId) {\n      if (tabId) {\n        var tab = this.model.get(\"attributes\").get(tabId);\n        if (tab) {\n          tab.trigger(\"showTab\", event);\n        }\n      }\n    },\n\n    resizeForFooter: function vDocumentresizeForFooter() {\n      var $footer = this.$el.find(\".dcpDocument__footer\");\n      if ($footer.length > 0) {\n        var footerHeight = $footer.height();\n        if (footerHeight > 0) {\n          $(\"body\").css(\"margin-bottom\", footerHeight + \"px\");\n        }\n      }\n    },\n\n    /**\n     * Scroll to visible tab label\n     */\n    scrollTobVisibleTab: function vDocumentscrollTobVisibleTab() {\n      var kendoTabStrip = this.kendoTabs\n        ? this.kendoTabs.data(\"kendoTabStrip\")\n        : null;\n      if (kendoTabStrip && kendoTabStrip._scrollableModeActive) {\n        kendoTabStrip._scrollTabsToItem(\n          this.kendoTabs.find(\"li.k-state-active\")\n        );\n      }\n    },\n\n    scrollTabList: function vDocumentScrollTabList() {\n      var kendoTabStrip = this.kendoTabs.data(\"kendoTabStrip\");\n\n      if (kendoTabStrip) {\n        kendoTabStrip.resize();\n      }\n    },\n    /**\n     * Redraw messages for the error displayed\n     * Change placement of tooltips\n     */\n    redrawTootips: function vDocumentredrawTootips() {\n      var $tooltips = $(\".tooltip:visible\");\n\n      $tooltips.each(function() {\n        var bTooltip = $(this).data(\"bs.tooltip\");\n        if (bTooltip) {\n          bTooltip.hide();\n          bTooltip.show();\n        }\n      });\n    },\n    /**\n     * Add menu if needed in topFix placement tab\n     */\n    responsiveTabMenu: function vDocumentTabFixMenu() {\n      var $tabLabel = this.$(\".dcpDocument__tabs__list li\");\n\n      var documentWidth = this.$(\".dcpDocument__tabs\").width() - 12;\n      var currentWidth = 0;\n      var hiddens = [];\n      var lastShow = null;\n      var $dropSelect;\n      var $dropTopSelect;\n      var $kendoTabs = this.kendoTabs.data(\"kendoTabStrip\");\n      var liIndex = 0;\n      var $tabs = this.$(\".dcpDocument__tabs\");\n      var $selectedTabId = this.selectedTab;\n      var hiddenSelected = false;\n      var dataSource = null;\n      var iOS = /(iPad|iPhone|iPod)/g.test(navigator.userAgent);\n\n      // $tabs.find(\".dcpDocument__tabs__list\").css(\"overflow\", \"hidden\").css(\"max-height\", \"2.7em\");\n      // Restore initial tabs\n      $tabLabel.show();\n\n      $tabLabel.each(function vDocumentHideTabWidth() {\n        currentWidth += $(this).outerWidth();\n        if (currentWidth > documentWidth) {\n          $(this).hide();\n          if (hiddens.length === 0) {\n            hiddens.push({\n              tooltipLabel: $(lastShow).data(\"tooltipLabel\"),\n              label: $(lastShow)\n                .find(\".k-link\")\n                .text(),\n              id: $(lastShow).data(\"attrid\"),\n              index: liIndex - 1\n            });\n          }\n          hiddens.push({\n            tooltipLabel: $(this).data(\"tooltipLabel\"),\n            label: $(this)\n              .find(\".k-link\")\n              .text(),\n            id: $(this).data(\"attrid\"),\n            index: liIndex\n          });\n        } else {\n          $kendoTabs.enable && $kendoTabs.enable($(this));\n          lastShow = this;\n        }\n\n        liIndex++;\n      });\n\n      /**\n       * Need to recompute container width\n       */\n      $(\".dcpLabel__select-hide:visible\").each(\n        function vDocumentSelectContainer() {\n          var $container = $(this).closest(\".k-list-container\");\n          var x = $container.offset().left;\n          var maxWidth = $(\"body\").width() - x - 20 + \"px\";\n\n          $container.css(\"max-width\", maxWidth);\n          $container\n            .closest(\".k-animation-container\")\n            .css(\"max-width\", maxWidth);\n          $(this).css(\"max-width\", \"\");\n        }\n      );\n\n      if ($tabs.data(\"hiddenTabsLength\") === hiddens.length) {\n        // Optimization if no new tabs to hide\n        if (hiddens.length > 0) {\n          $kendoTabs && $kendoTabs.disable && $kendoTabs.disable($(lastShow));\n        }\n\n        //$tabs.find(\".dcpDocument__tabs__list\").css(\"overflow\", \"\").css(\"max-height\", \"\");\n        return;\n      }\n\n      // Delete fixed height\n      //$tabLabel.css(\"height\", '');\n      // Record hidden count to optimization\n      $tabs.data(\"hiddenTabsLength\", hiddens.length);\n      $tabLabel.find(\".k-link\").show(); // Restore original link (tab label)\n\n      $dropTopSelect = $tabs.find(\".dcpTab__label__select.k-combobox\").hide();\n      $tabs\n        .find(\"input.dcpTab__label__select[data-role=combobox]\")\n        .each(function vDocumentSelectTabClose() {\n          $(this).data(\"kendoComboBox\") &&\n            $(this).data(\"kendoComboBox\").close &&\n            $(this)\n              .data(\"kendoComboBox\")\n              .close();\n        });\n\n      $tabs\n        .find(\".dcpLabel--select\")\n        .removeClass(\"dcpLabel--select k-state-active\");\n      $tabs\n        .find('.dcpLabel[data-attrid=\"' + $selectedTabId + '\"]')\n        .addClass(\"k-state-active\");\n\n      if (hiddens.length > 0) {\n        // Need to disable tab to use own events managing\n        if (lastShow) {\n          $kendoTabs.disable($(lastShow));\n        }\n\n        // Hide original link\n        $(lastShow)\n          .find(\".k-link\")\n          .hide();\n        // Replace it to a dropdown selector\n        hiddenSelected = _.some(hiddens, function vDocumentSomeHiddens(item) {\n          return item.id === $selectedTabId;\n        });\n\n        if (hiddenSelected) {\n          $(lastShow).addClass(\"k-state-active\");\n        } else {\n          if ($(lastShow).data(\"attrid\") !== $selectedTabId) {\n            $(lastShow).removeClass(\"k-state-active\");\n          }\n        }\n\n        $(lastShow).addClass(\"dcpLabel--select\");\n        //$(lastShow).height(currentHeight - 5);\n        if ($dropTopSelect.length === 0) {\n          $dropSelect = $('<input class=\"dcpTab__label__select\" />');\n          $(lastShow).append($dropSelect);\n          $dropSelect.kendoComboBox({\n            value: hiddenSelected ? $selectedTabId : hiddens[0].id,\n            dataSource: hiddens,\n            dataTextField: \"label\",\n            dataValueField: \"id\",\n            dataBound: function vDocumentTabSelectDatabound() {\n              var myTab = $(this.element).closest(\"li\");\n              var liItem = $tabs.find('li[data-attrid=\"' + this.value() + '\"]');\n              myTab.data(\"tooltipLabelSelect\", liItem.data(\"tooltipLabel\"));\n            },\n            select: function vDocumentTabSelectSelect(event) {\n              var dataItem = this.dataSource.at(event.item.index());\n              var liItem = $tabs.find('li[data-attrid=\"' + dataItem.id + '\"]');\n              var myTab = $(this.element).closest(\"li\");\n\n              myTab.data(\"tooltipLabelSelect\", dataItem.tooltipLabel);\n              // Need to reset class and enable to really trigger show events\n              myTab.removeClass(\"k-state-active\");\n              $kendoTabs.enable(myTab);\n              $kendoTabs.select(liItem);\n              $kendoTabs.disable(myTab);\n              myTab.addClass(\"k-state-active\");\n              myTab.find(\".k-input\").blur(); // Because input is read only\n            },\n            open: function vDocumentTabSelectOpen() {\n              // Need to compute width of container to see elements\n              // Set max-width to not be out of body\n              var $ul = $(this.ul);\n              var $li = $(this.element).closest(\"li\");\n              var x = $li.offset().left;\n              var bodyWidth = $(\"body\").width();\n              $ul.css(\n                \"max-width\",\n                Math.max(bodyWidth - x - 20, $(lastShow).width()) + \"px\"\n              );\n              $ul.css(\"min-width\", $li.width());\n              _.defer(function vDocumentSelectTabOpen() {\n                $ul\n                  .closest(\".k-animation-container\")\n                  .addClass(\"menu__select_container\");\n              });\n            },\n\n            template: function vDocumentTabSelectTemplate(event) {\n              if (event.tooltipLabel) {\n                return Mustache.render(\n                  '<span class=\"dcpLabel__select--tooltip\" data-tooltipLabel=\"{{tooltipLabel}}\">{{label}}</span>',\n                  event\n                );\n              }\n              return event.label;\n            }\n          });\n\n          $dropSelect\n            .data(\"kendoComboBox\")\n            .ul.addClass(\"dcpLabel__select-hide\");\n          // The container width is computed by open event\n          $dropSelect.data(\"kendoComboBox\").list.width(\"auto\");\n          // No use input selector\n          $(lastShow)\n            .find(\"input\")\n            .attr(\"aria-readonly\", \"true\")\n            .prop(\"readonly\", true);\n          $(lastShow)\n            .find(\".k-select\")\n            .prepend($(\"<span/>\").addClass(\"dcpLabel__count\"));\n\n          $dropSelect.data(\"kendoComboBox\").ul.tooltip({\n            selector: \"li.k-item \",\n            placement: \"left\",\n            container: \".dcpDocument\",\n            html: true,\n            title: function vDocumentTabSelectTitle() {\n              return $(this)\n                .find(\".dcpLabel__select--tooltip\")\n                .attr(\"data-tooltipLabel\");\n            }\n          });\n          $dropSelect\n            .parent()\n            .find(\".k-input\")\n            .css(\"width\", \"\");\n        } else {\n          // Reuse dropDown created previously\n          $dropTopSelect.show();\n          $dropSelect = $tabs.find(\n            \"input.dcpTab__label__select[data-role=combobox]\"\n          );\n          $(lastShow).append($dropTopSelect); // Move to new lastShow\n          if ($dropSelect.data(\"kendoComboBox\")) {\n            $dropSelect\n              .data(\"kendoComboBox\")\n              .value(hiddenSelected ? $selectedTabId : hiddens[0].id);\n            dataSource = new kendo.data.DataSource({\n              data: hiddens\n            });\n            $dropSelect.data(\"kendoComboBox\").setDataSource(dataSource);\n          }\n        }\n\n        // Add count in select button\n        $(lastShow)\n          .find(\".dcpLabel__count\")\n          .text(hiddens.length);\n\n        if (!$tabs.data(\"selectFixOn\")) {\n          // Add callback only one time\n          $tabs.on(\n            \"click\",\n            \".dcpLabel--select .k-dropdown-wrap .k-input\",\n            function vDocumentTabSelectClick() {\n              var selectedTab = $kendoTabs.select().data(\"attrid\");\n              var selectedItem = $tabs\n                .data(\"selectFixOn\")\n                .data(\"kendoComboBox\")\n                .value();\n              var liItem = $tabs.find('li[data-attrid=\"' + selectedItem + '\"]');\n              var myTab = $(this).closest(\"li\");\n\n              if (selectedItem !== selectedTab) {\n                myTab.removeClass(\"k-state-active\");\n                $kendoTabs.enable(myTab);\n                $kendoTabs.select(liItem);\n                $kendoTabs.disable(myTab);\n                myTab.addClass(\"k-state-active\");\n              }\n            }\n          );\n\n          $tabs.on(\n            \"focus\",\n            \".dcpLabel--select .k-dropdown-wrap .k-input\",\n            function vDocumentTabFocus() {\n              $(this).blur();\n            }\n          );\n        }\n\n        // Memorize dropdown to reuse it in callback and to listen only one\n        $tabs.data(\"selectFixOn\", $dropSelect);\n      }\n      if (\"ontouchstart\" in document.documentElement && iOS) {\n        $(\"body\")\n          .off(\"show.bs.tooltip\")\n          .on(\n            \"show.bs.tooltip\",\n            \"[data-original-title]\",\n            function vDocumentWorkaroundIosTouch(e) {\n              // prevent ios double tap\n              var $tooltip = $(this);\n              var tooltipObject = $tooltip.data(\"bs.tooltip\");\n\n              if (\n                tooltipObject &&\n                tooltipObject.inState.click === false &&\n                tooltipObject.inState.focus === false &&\n                tooltipObject.inState.hover === false\n              ) {\n                return;\n              }\n\n              if (\"ontouchstart\" in document.documentElement) {\n                if (!$tooltip.data(\"showios\")) {\n                  e.preventDefault();\n                  $tooltip.data(\"showios\", true);\n                  _.delay(function vDocumentWorkaroundIosDelay() {\n                    $tooltip.tooltip(\"show\");\n                    $tooltip.data(\"showios\", false);\n                    _.delay(function vDocumentWorkaroundIosSecondDelay() {\n                      $tooltip.tooltip(\"hide\");\n                    }, 2000);\n                  }, 500);\n                }\n              }\n            }\n          );\n      }\n\n      //$tabs.find(\".dcpDocument__tabs__list\").css(\"overflow\", \"\").css(\"max-height\", \"\");\n    },\n\n    /**\n     *\n     * Register the current tab for the current user\n     *\n     * @param tabId\n     */\n    recordSelectedTab: function vDocumentRecordSelectedTab(tabId) {\n      if (this.model.get(\"initid\")) {\n        var tagTab = new ModelDocumentTab({\n          initid: this.model.get(\"initid\"),\n          tabId: tabId\n        });\n        tagTab.save();\n      }\n    },\n\n    /**\n     * Publish associated model message\n     */\n    publishMessages: function vDocumentPublishMessages() {\n      var currentView = this;\n      _.each(this.model.get(\"messages\"), function vDocumentPublishAMessage(\n        aMessage\n      ) {\n        currentView.trigger(\"showMessage\", {\n          type: aMessage.type,\n          title: aMessage.contentText,\n          htmlMessage: aMessage.contentHtml\n        });\n      });\n    },\n\n    /**\n     * Inject associated CSS in the DOM\n     *\n     * Inject new CSS, remove old CSS\n     */\n    renderCss: function vDocumentRenderCss(noRemove) {\n      // add custom css style\n      var $head = $(\"head\"),\n        cssLinkTemplate = _.template(\n          '<link rel=\"stylesheet\" type=\"text/css\" ' +\n            'href=\"<%= path %>\" data-id=\"<%= key %>\" data-view=\"true\">'\n        ),\n        customCss = this.model.get(\"customCSS\");\n\n      if (noRemove !== true) {\n        //Remove old CSS\n\n        _.each($(\"link[data-view=true]\"), function vDocumentRemoveOldCSS(\n          currentLink\n        ) {\n          var findCss = function vDocumentFindCss(currentCss) {\n            return $(currentLink).data(\"id\") === currentCss.key;\n          };\n          if (_.find(customCss, findCss) === undefined) {\n            $(currentLink).remove();\n          }\n        });\n      }\n      // Inject new CSS\n      _.each(customCss, function vDocumentInjectNewCSS(cssItem) {\n        var $existsLink = $(\n          \"link[rel=stylesheet][data-id=\" + cssItem.key + \"]\"\n        );\n\n        if ($existsLink.length === 0) {\n          if (document.createStyleSheet) {\n            // Special thanks to IE : ! up to 31 css cause errors...\n            document.createStyleSheet(cssItem.path);\n          }\n          $head.append(cssLinkTemplate(cssItem));\n        }\n      });\n    },\n\n    /**\n     * Show the help document in dialog\n     *\n     */\n    showHelp: function vDocumentShowHelp(event, helpId, attrid) {\n      var $document = $(this.el);\n      var scope = this;\n      var $dialogDiv = $document.data(\"dcpHelpDocument-\" + helpId);\n      var currentTarget = event.originalEvent\n        ? event.originalEvent.currentTarget\n        : event.currentTarget;\n      var htmlLink = {\n        target: \"_dialog\",\n        windowWidth: \"400px\",\n        windowHeight: \"300px\",\n        windowTitle:\n          '<span class=\"fa fa-question-circle\"></span> ' +\n          i18n.___(\"Info\", \"ddui\")\n      };\n\n      __webpack_require__.e(/*! require.ensure | wDocument */ \"wDocument\").then((function vDocumentHelp() {\n          __webpack_require__(/*! dcpDocument/document */ \"a2b1083ba5d095ec0632\");\n          var helpX, helpY, bodyH, dialogH, dialogW;\n\n          if (!$dialogDiv || $dialogDiv.is(\":visible\") === false) {\n            if (scope.helpWidget) {\n              scope.helpWidget.destroy();\n            }\n            $dialogDiv = $(\"<div/>\").addClass(\"dcpHelp-wrapper\");\n\n            $dialogDiv.kendoWindow({\n              width: htmlLink.windowWidth,\n              height: htmlLink.windowHeight,\n              iframe: true,\n              content: \"about:blank\",\n              actions: [\"Maximize\", \"Close\"],\n              close: function vDocumentSelectHelpClose() {\n                $(\".dcpLabel__help__link--selected\").removeClass(\n                  \"dcpLabel__help__link--selected\"\n                );\n              }\n            });\n\n            $dialogDiv\n              .closest(\".k-window\")\n              .find(\".k-window-title\")\n              .html(htmlLink.windowTitle);\n            $dialogDiv.on(\"documentcreate\", function vDocumentHelpCreate() {\n              $dialogDiv.find(\"> iframe\").addClass(\"k-content-frame\");\n            });\n\n            $dialogDiv\n              .document({\n                initid: helpId,\n                withoutResize: true\n              })\n              .on(\"documentloaded\", function vDocumentSelectHelpChapter() {\n                _.defer(function vDocumentHelpReady() {\n                  $dialogDiv.document(\n                    \"triggerEvent\",\n                    \"custom:helppageSelect\",\n                    attrid\n                  );\n                });\n              });\n\n            $document.data(\"dcpHelpDocument-\" + helpId, $dialogDiv);\n          } else {\n            $dialogDiv.document(\n              \"triggerEvent\",\n              \"custom:helppageSelect\",\n              attrid\n            );\n          }\n\n          scope.helpWidget = $dialogDiv.data(\"kendoWindow\");\n          $(\".dcpLabel__help__link--selected\").removeClass(\n            \"dcpLabel__help__link--selected\"\n          );\n\n          if ($(currentTarget).length > 0) {\n            $(currentTarget).addClass(\"dcpLabel__help__link--selected\");\n\n            // Compute new position of help dialog window\n            helpX = $(currentTarget).offset().left;\n            helpY = $(currentTarget).offset().top;\n            bodyH = $(\"body\").height();\n            dialogH = $(scope.helpWidget.wrapper)\n              .closest(\".k-window\")\n              .height();\n            dialogW = $(scope.helpWidget.wrapper)\n              .closest(\".k-window\")\n              .width();\n            if (helpX > dialogW + 50) {\n              helpX = helpX - dialogW - 30;\n            } else {\n              helpX = helpX + 30;\n            }\n\n            if (helpY > bodyH - dialogH) {\n              helpY = bodyH - dialogH - 50;\n            }\n\n            helpY = helpY < 0 ? 0 : helpY;\n\n            $(scope.helpWidget.wrapper).css({\n              top: helpY + \"px\",\n              left: helpX + \"px\"\n            });\n          } else {\n            scope.helpWidget.center();\n          }\n          scope.helpWidget.open();\n        }).bind(null, __webpack_require__)).catch(__webpack_require__.oe);\n    },\n\n    /**\n     * Show the history widget\n     *\n     */\n    showHistory: function vDocumentShowHistory(docid) {\n      var scope = this;\n      var $target = $('<div class=\"document-history\"/>');\n      this.historyWidget = $target\n        .dcpDocumentHistory({\n          documentId: docid || this.model.get(\"properties\").get(\"initid\"),\n          window: {\n            width: \"80%\",\n            height: \"80%\",\n            title: i18n.___(\"Document History\", \"historyUi\")\n          },\n          labels: {\n            version: i18n.___(\"Version\", \"historyUi\"),\n            revision: i18n.___(\"Rev\", \"historyUi\"),\n            state: i18n.___(\"State\", \"historyUi\"),\n            activity: i18n.___(\"Activity\", \"historyUi\"),\n            owner: i18n.___(\"Owner\", \"historyUi\"),\n            code: i18n.___(\"Code\", \"historyUi\"),\n            date: i18n.___(\"Date\", \"historyUi\"),\n            diff: i18n.___(\"Diff\", \"historyUi\"),\n            level: i18n.___(\"Level\", \"historyUi\"),\n            message: i18n.___(\"Message\", \"historyUi\"),\n            pastRevision: i18n.___(\"past Revision\", \"historyUi\"),\n            showDetail: i18n.___(\"Show details\", \"historyUi\"),\n            hideDetail: i18n.___(\"Hide details\", \"historyUi\"),\n            showNotice: i18n.___(\"Show notices\", \"historyUi\"),\n            noOneNotice: i18n.___(\"No one notices\", \"historyUi\"),\n            hideNotice: i18n.___(\"Hide notices\", \"historyUi\"),\n            filterMessages: i18n.___(\"Filter messages\", \"historyUi\"),\n            linkRevision: i18n.___(\"See revision number #\", \"historyUi\"),\n            historyTitle: i18n.___(\"History for {{title}}\", \"historyUi\"),\n            loading: i18n.___(\"Loading ...\", \"historyUi\"),\n            revisionDiffLabels: {\n              title: i18n.___(\n                \"Difference between two revisions\",\n                \"historyDiffUi\"\n              ),\n              first: i18n.___(\"First document\", \"historyDiffUi\"),\n              second: i18n.___(\"Second document\", \"historyDiffUi\"),\n              attributeId: i18n.___(\"Attribute id\", \"historyDiffUi\"),\n              attributeLabel: i18n.___(\"Attribute label\", \"historyDiffUi\"),\n              documentHeader: i18n.___(\n                \"{{title}}  (Revision : {{revision}}). <br/>Created on <em>{{mdate}}</em>\",\n                \"historyDiffUi\"\n              ),\n              filterMessages: i18n.___(\"Filter data\", \"historyDiffUi\"),\n              showOnlyDiff: i18n.___(\"Show only differences\", \"historyDiffUi\"),\n              showAll: i18n.___(\"Show all\", \"historyDiffUi\")\n            }\n          }\n        })\n        .data(\"dcpDocumentHistory\");\n\n      this.historyWidget.open();\n      this.historyWidget.element.on(\n        \"viewRevision\",\n        function vDocumentViewRevision(event, data) {\n          scope.model.fetchDocument({\n            initid: data.initid,\n            revision: data.revision\n          });\n        }\n      );\n    },\n\n    /**\n     * Lock document\n     *\n     */\n    lockDocument: function vDocumentLockDocument() {\n      this.model.lockDocument();\n    },\n    /**\n     * Lock document\n     *\n     */\n    unlockDocument: function vDocumentUnLockDocument() {\n      this.model.unlockDocument();\n    },\n    /**\n     * Show the transition view\n     *\n     */\n    showtransition: function vDocumentShowtransition(transition, nextState) {\n      this.model.trigger(\"showTransition\", nextState, transition);\n    },\n\n    /**\n     * Show the transition view\n     *\n     */\n    showTransitionGraph: function vDocumentShowtransitionGraph() {\n      var documentView = this;\n      var transitionGraph = {};\n      var $target = $('<div class=\"dcpTransitionGraph\"/>');\n      //Init transition model\n      transitionGraph.model = new ModelTransitionGraph({\n        documentId: this.model.id,\n        state: this.model.get(\"properties\").get(\"state\")\n      });\n\n      transitionGraph.model.fetch({\n        success: function vDocumentTransitionSuccess() {\n          //Init transition view\n          transitionGraph.view = new ViewTransitionGraph({\n            model: transitionGraph.model,\n            el: $target\n          });\n          transitionGraph.view.render();\n          transitionGraph.view.$el.on(\n            \"viewTransition\",\n            function vDocumentTransitionView(event, nextState) {\n              transitionGraph.view.remove();\n              documentView.model.trigger(\"showTransition\", nextState);\n            }\n          );\n        }\n      });\n\n      this.transitionGraph = transitionGraph;\n    },\n    /**\n     * Show the properties widget\n     *\n     */\n    showProperties: function vDocumentShowProperties(docid) {\n      var scope = this;\n      var $target = $('<div class=\"document-properties\"/>');\n\n      this.propertiesWidget = $target\n        .dcpDocumentProperties({\n          documentId: docid || this.model.get(\"properties\").get(\"initid\"),\n          window: {\n            width: \"500px\",\n            height: \"80%\",\n            title: i18n.___(\"Document properties\", \"propertyUi\")\n          },\n          labels: {\n            identifier: i18n.___(\"Identifier\", \"propertyUi\"),\n            title: i18n.___(\"Title\", \"propertyUi\"),\n            logicalName: i18n.___(\"Logical name\", \"propertyUi\"),\n            revision: i18n.___(\"Revision number\", \"propertyUi\"),\n            version: i18n.___(\"Version\", \"propertyUi\"),\n            family: i18n.___(\"Family\", \"propertyUi\"),\n            lockedBy: i18n.___(\"Locked by\", \"propertyUi\"),\n            createdBy: i18n.___(\"Created by\", \"propertyUi\"),\n            notLocked: i18n.___(\"Not locked\", \"propertyUi\"),\n            confidential: i18n.___(\"Confidential\", \"propertyUi\"),\n            notConfidential: i18n.___(\"Not confidential\", \"propertyUi\"),\n            creationDate: i18n.___(\"Creation date\", \"propertyUi\"),\n            lastModificationDate: i18n.___(\n              \"Last modification date\",\n              \"propertyUi\"\n            ),\n            profil: i18n.___(\"Profil\", \"propertyUi\"),\n            profilReference: i18n.___(\"Profil reference\", \"propertyUi\"),\n            viewController: i18n.___(\"View controller\", \"propertyUi\"),\n            property: i18n.___(\"Property\", \"propertyUi\"),\n            propertiesTitle: i18n.___(\"Properties for {{title}}\", \"propertyUi\"),\n            propertyValue: i18n.___(\"Value\", \"propertyUi\"),\n            workflow: i18n.___(\"Workflow\", \"propertyUi\"),\n            activity: i18n.___(\"Activity\", \"propertyUi\")\n          }\n        })\n        .data(\"dcpDocumentProperties\");\n\n      this.propertiesWidget.open();\n      this.propertiesWidget.element.on(\n        \"viewDocument\",\n        function vDocumentViewDocument(event, data) {\n          scope.model.fetchDocument({ initid: data });\n        }\n      );\n    },\n\n    /**\n     * Update the title of the current page\n     */\n    updateTitle: function vDocumentUpdateTitle() {\n      var title = this.model.get(\"properties\").get(\"title\");\n\n      if (!_.isEmpty(title)) {\n        document.title = title;\n      }\n    },\n\n    /**\n     * Update the icon of the current page\n     */\n    updateIcon: function vDocumentUpdateIcon() {\n      $(\"link[rel='shortcut icon']\").attr(\n        \"href\",\n        this.model.get(\"properties\").get(\"icon\")\n      );\n    },\n\n    /**\n     * Delete the current document\n     *\n     */\n    deleteDocument: function dvDocumentDocumentDelete() {\n      this.model.deleteDocument();\n    },\n\n    /**\n     * Display the loading widget\n     */\n    displayLoading: function vDocumentDisplayLoading(options) {\n      var text = i18n.___(\"Loading\", \"ddui\"),\n        avance = 50;\n      options = options || {};\n      if (this.$el.find(\".dcpDocument--disabled\") === 0) {\n        this.$el.append('<div class=\"dcpDocument--disabled\"/>');\n      }\n      if (options.isSaving) {\n        text = i18n.___(\"Recording\", \"ddui\");\n        avance = 70;\n      }\n      if (options.text) {\n        text = options.text;\n      }\n      this.trigger(\"cleanNotification\");\n      this.trigger(\"loaderShow\", text, avance);\n    },\n\n    /**\n     * Show the view\n     *\n     * Hide the loader, show the view\n     */\n    showView: function vDocumentShowView() {\n      this.$el.hide();\n      this.$el.find(\".dcpDocument--disabled\").remove();\n      this.trigger(\"loaderHide\");\n      this.$el.show();\n      this.redrawTootips();\n    },\n\n    /**\n     * Switch the view\n     *\n     * @param viewId\n     */\n    closeDocument: function vDocumentCloseDocument(viewId) {\n      if (!viewId) {\n        if (this.model.get(\"renderMode\") === \"edit\") {\n          viewId = \"!defaultEdition\";\n        } else {\n          viewId = \"!defaultConsultation\";\n        }\n      }\n      this.loadDocument({\n        initid: this.model.get(\"initid\"),\n        viewId: viewId\n      });\n    },\n\n    /**\n     * Save the current document\n     */\n    saveDocument: function vDocumentSaveDocument() {\n      this.trigger(\"cleanNotification\");\n      var currentView = this,\n        saveDocument = this.model.saveDocument();\n      //Use promise and display success when done\n      if (saveDocument && saveDocument.then) {\n        saveDocument.then(function vDocumentSaveDisplaySuccess() {\n          currentView.trigger(\"showSuccess\", {\n            title: i18n.___(\"Document Recorded\", \"ddui\")\n          });\n        });\n      }\n    },\n\n    /**\n     * Save and close the current document\n     */\n    saveAndCloseDocument: function vDocumentSaveAndCloseDocument(viewId) {\n      this.trigger(\"cleanNotification\");\n      var currentView = this,\n        saveDocument = this.model.saveDocument();\n      if (saveDocument && saveDocument.then) {\n        saveDocument.then(function vDocumentSaveAndCloseSuccess() {\n          var initid = currentView.model.get(\"initid\");\n\n          currentView.model.fetchDocument({\n            initid: initid,\n            viewId: viewId || \"!defaultConsultation\"\n          });\n        });\n      }\n    },\n\n    /**\n     * Create the current document\n     */\n    createDocument: function vDocumentCreateDocument() {\n      var currentView = this,\n        saveDocument = this.model.saveDocument();\n      if (saveDocument && saveDocument.then) {\n        saveDocument.then(function vDocumentCreateDisplaySuccess() {\n          currentView.trigger(\"showSuccess\", {\n            title: i18n.___(\"Document Created\", \"ddui\")\n          });\n        });\n      }\n    },\n\n    /**\n     * Create the current document\n     */\n    createAndCloseDocument: function vDocumentCreateDocument(viewId) {\n      var currentView = this,\n        saveDocument = this.model.saveDocument();\n      if (saveDocument && saveDocument.then) {\n        saveDocument.then(function vDocumentCreateAndCloseSuccess() {\n          var initid = currentView.model.get(\"initid\");\n\n          currentView.model.fetchDocument({\n            initid: initid,\n            viewId: viewId || \"!defaultConsultation\"\n          });\n        });\n      }\n    },\n\n    /**\n     * load another document document  : confirm if modified\n     * options : {initid, viewId, revision}\n     * callbacks : {success, error}\n     */\n    loadDocument: function vDocumentLoadDocument(options, callbacks) {\n      var confirmWindow;\n      var documentView = this;\n\n      callbacks = callbacks || {};\n\n      if (this.model.hasAttributesChanged()) {\n        confirmWindow = $(\"body\").dcpConfirm({\n          title: i18n.___(\"Confirm close document\", \"ddui\"),\n          width: \"45rem\",\n          height: \"12rem\",\n          maxWidth: $(window).width(),\n          messages: {\n            okMessage: i18n.___(\"Abort modification\", \"ddui\"),\n            cancelMessage: i18n.___(\"Stay on the form\", \"ddui\"),\n            htmlMessage: i18n.___(\n              \"The form has been modified without saving\",\n              \"ddui\"\n            ),\n            textMessage: \"\"\n          },\n          confirm: function wMenuConfirm() {\n            documentView.model\n              .fetchDocument({\n                initid: options.initid,\n                viewId: options.viewId,\n                revision: options.revision\n              })\n              .then(callbacks.success, callbacks.error);\n          },\n          cancel: function wLoadCancel() {\n            if (callbacks && _.isFunction(callbacks.error)) {\n              callbacks.error({\n                errorMessage: {\n                  code: \"USERCANCEL\",\n                  contentText: i18n.___(\n                    \"User has cancelled the action.\",\n                    \"ddui\"\n                  )\n                }\n              });\n            }\n          },\n          templateData: { templates: this.model.get(\"templates\") }\n        });\n        confirmWindow.data(\"dcpWindow\").open();\n      } else {\n        this.model\n          .fetchDocument({\n            initid: options.initid,\n            viewId: options.viewId,\n            revision: options.revision\n          })\n          .then(callbacks.success, callbacks.error);\n      }\n    },\n\n    /**\n     * Restore the deleted document\n     *\n     * @returns {exports}\n     */\n    restoreDocument: function vDocumentRestoreDocument() {\n      this.model.restoreDocument();\n    },\n\n    propagateActionClick: function vDocumentPropagateActionClick(event) {\n      var $target = $(event.currentTarget),\n        action,\n        options,\n        eventOptions,\n        internalEvent = {\n          prevent: false\n        };\n\n      event.preventDefault();\n      if (event.stopPropagation) {\n        event.stopPropagation();\n      }\n\n      action = $target.data(\"action\") || $target.attr(\"href\");\n      options = action.substring(8).split(\":\");\n      eventOptions = {\n        target: event.target,\n        eventId: options.shift(),\n        options: options\n      };\n\n      this.model.trigger(\"internalLinkSelected\", internalEvent, eventOptions);\n      if (internalEvent.prevent) {\n        return this;\n      }\n\n      return this.doStandardAction(internalEvent, eventOptions);\n    },\n\n    handleHashClick: function vDocumenthandleHashClick(event) {\n      var $target = $(event.currentTarget),\n        href = $target.attr(\"href\");\n\n      if (!href || !href.substring || href.substring(0, 7) === \"#action\") {\n        return;\n      }\n\n      event.preventDefault();\n      if (event.stopPropagation) {\n        event.stopPropagation();\n      }\n\n      window.location.hash = href;\n    },\n\n    /**\n     * Propagate menu event\n     *test\n     * @param event\n     * @param options\n     * @returns {*}\n     */\n    doStandardAction: function vDocumentdoStandardAction(event, options) {\n      var eventArgs = options.options;\n\n      if (options.eventId === \"document.save\") {\n        return this.saveDocument();\n      }\n      if (options.eventId === \"document.saveAndClose\") {\n        return this.saveAndCloseDocument(eventArgs[0]);\n      }\n      if (options.eventId === \"document.history\") {\n        return this.showHistory(eventArgs[0]);\n      }\n      if (options.eventId === \"document.transition\") {\n        return this.showtransition(eventArgs[0], eventArgs[1]);\n      }\n      if (options.eventId === \"document.transitionGraph\") {\n        return this.showTransitionGraph();\n      }\n      if (options.eventId === \"document.properties\") {\n        return this.showProperties(eventArgs[0]);\n      }\n      if (options.eventId === \"document.delete\") {\n        return this.deleteDocument();\n      }\n      if (options.eventId === \"document.close\") {\n        return this.closeDocument(eventArgs[0]);\n      }\n      if (options.eventId === \"document.edit\") {\n        return this.closeDocument(\"!defaultEdition\");\n      }\n      if (options.eventId === \"document.create\") {\n        return this.createDocument();\n      }\n      if (options.eventId === \"document.createAndClose\") {\n        return this.createAndCloseDocument(eventArgs[0]);\n      }\n      if (options.eventId === \"document.load\") {\n        return this.loadDocument({\n          initid: eventArgs[0],\n          viewId: eventArgs[1],\n          revision: eventArgs[2]\n        });\n      }\n      if (options.eventId === \"document.lock\") {\n        return this.lockDocument();\n      }\n      if (options.eventId === \"document.unlock\") {\n        return this.unlockDocument();\n      }\n      if (options.eventId === \"document.restore\") {\n        return this.restoreDocument();\n      }\n      if (options.eventId === \"document.help\") {\n        return this.showHelp(event, eventArgs[0], eventArgs[1]);\n      }\n    },\n\n    displayNetworkError: function vDocument_displayNetworkError() {\n      this.$el.hide();\n      $(\".dcpStaticErrorMessage\").removeAttr(\"hidden\");\n    },\n\n    /**\n     * Get the template for the current view\n     *\n     * @param key\n     * @returns {*}\n     */\n    getTemplates: function vDocumentGetTemplates(key) {\n      var templates = {};\n      if (this.model && this.model.get(\"templates\")) {\n        templates = this.model.get(\"templates\");\n      }\n      if (!_.isUndefined(templates[key])) {\n        return templates[key];\n      }\n      // Get from a gobal element (for unittest)\n      if (window.dcp && window.dcp.templates && window.dcp.templates[key]) {\n        return window.dcp.templates[key];\n      }\n      throw new Error(\"Unknown template  \" + key);\n    },\n\n    /**\n     * Destroy the associated widget and suppress event listener before remov the dom\n     *\n     * @returns {*}\n     */\n    remove: function vDocumentRemove() {\n      try {\n        if (this.kendoTabs && this.kendoTabs.data(\"kendoTabStrip\")) {\n          this.kendoTabs.data(\"kendoTabStrip\").destroy();\n        }\n      } catch (e) {\n        if (window.dcp.logger) {\n          window.dcp.logger(e);\n        } else {\n          console.error(e);\n        }\n      }\n      $(window).off(\".\" + this.model.cid);\n      $(window.document).off(\".\" + this.model.cid);\n\n      return Backbone.View.prototype.remove.call(this);\n    }\n  });\n}).apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMDdiOTZmYThjNTQ1YWFiMzFkYWQuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvQXBwcy9ET0NVTUVOVC9JSE0vdmlld3MvZG9jdW1lbnQvdkRvY3VtZW50LmpzPzk2MGEiXSwic291cmNlc0NvbnRlbnQiOlsiLypnbG9iYWwgZGVmaW5lLCBjb25zb2xlKi9cblxuZGVmaW5lKFtcbiAgXCJ1bmRlcnNjb3JlXCIsXG4gIFwianF1ZXJ5XCIsXG4gIFwiYmFja2JvbmVcIixcbiAgXCJtdXN0YWNoZVwiLFxuICBcImRjcERvY3VtZW50L21vZGVscy9tRG9jdW1lbnRUYWJcIixcbiAgXCJkY3BEb2N1bWVudC92aWV3cy9kb2N1bWVudC9tZW51L3ZNZW51XCIsXG4gIFwiZGNwRG9jdW1lbnQvdmlld3MvZG9jdW1lbnQvaGVhZGVyL3ZIZWFkZXJcIixcbiAgXCJkY3BEb2N1bWVudC92aWV3cy9hdHRyaWJ1dGVzL2ZyYW1lL3ZGcmFtZVwiLFxuICBcImRjcERvY3VtZW50L3ZpZXdzL2F0dHJpYnV0ZXMvdGFiL3ZUYWJMYWJlbFwiLFxuICBcImRjcERvY3VtZW50L3ZpZXdzL2F0dHJpYnV0ZXMvdGFiL3ZUYWJDb250ZW50XCIsXG4gIFwiZGNwRG9jdW1lbnQvdmlld3MvZG9jdW1lbnQvYXR0cmlidXRlVGVtcGxhdGVcIixcbiAgXCJkY3BEb2N1bWVudC9tb2RlbHMvbVRyYW5zaXRpb25HcmFwaFwiLFxuICBcImRjcERvY3VtZW50L3ZpZXdzL3dvcmtmbG93L3ZUcmFuc2l0aW9uR3JhcGhcIixcbiAgXCJkY3BEb2N1bWVudC9pMThuL2RvY3VtZW50Q2F0YWxvZ1wiLFxuICBcImRjcERvY3VtZW50L3dpZGdldHMvaGlzdG9yeS93SGlzdG9yeVwiLFxuICBcImRjcERvY3VtZW50L3dpZGdldHMvcHJvcGVydGllcy93UHJvcGVydGllc1wiXG5dLCBmdW5jdGlvbiB2RG9jdW1lbnQoXG4gIF8sXG4gICQsXG4gIEJhY2tib25lLFxuICBNdXN0YWNoZSxcbiAgTW9kZWxEb2N1bWVudFRhYixcbiAgVmlld0RvY3VtZW50TWVudSxcbiAgVmlld0RvY3VtZW50SGVhZGVyLFxuICBWaWV3QXR0cmlidXRlRnJhbWUsXG4gIFZpZXdBdHRyaWJ1dGVUYWJMYWJlbCxcbiAgVmlld0F0dHJpYnV0ZVRhYkNvbnRlbnQsXG4gIGF0dHJpYnV0ZVRlbXBsYXRlLFxuICBNb2RlbFRyYW5zaXRpb25HcmFwaCxcbiAgVmlld1RyYW5zaXRpb25HcmFwaCxcbiAgaTE4blxuKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIHZhciBjaGVja1RvdWNoRXZlbnRzID0gZnVuY3Rpb24gY2hlY2tUb3VjaEV2ZW50cygpIHtcbiAgICAvL0Zyb20gbW9kZXJuaXplclxuICAgIHZhciBib29sID0gZmFsc2U7XG4gICAgaWYgKFxuICAgICAgXCJvbnRvdWNoc3RhcnRcIiBpbiB3aW5kb3cgfHxcbiAgICAgICh3aW5kb3cuRG9jdW1lbnRUb3VjaCAmJiB3aW5kb3cuZG9jdW1lbnQgaW5zdGFuY2VvZiB3aW5kb3cuRG9jdW1lbnRUb3VjaClcbiAgICApIHtcbiAgICAgIGJvb2wgPSB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gYm9vbDtcbiAgfTtcblxuICByZXR1cm4gQmFja2JvbmUuVmlldy5leHRlbmQoe1xuICAgIGNsYXNzTmFtZTogXCJkY3BEb2N1bWVudCBjb250YWluZXItZmx1aWRcIixcblxuICAgIGV2ZW50czoge1xuICAgICAgJ2NsaWNrIC5kY3BEb2N1bWVudF9fYm9keSBhW2hyZWZePVwiI2FjdGlvbi9cIl0sIC5kY3BEb2N1bWVudF9fYm9keSBhW2RhdGEtYWN0aW9uXSwgLmRjcERvY3VtZW50X19ib2R5IGJ1dHRvbltkYXRhLWFjdGlvbl0nOlxuICAgICAgICBcInByb3BhZ2F0ZUFjdGlvbkNsaWNrXCIsXG4gICAgICAnY2xpY2sgLmRjcERvY3VtZW50X19ib2R5IGFbaHJlZl49XCIjXCJdJzogXCJoYW5kbGVIYXNoQ2xpY2tcIlxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBJbml0IGV2ZW50XG4gICAgICovXG4gICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gdkRvY3VtZW50SW5pdGlhbGl6ZSgpIHtcbiAgICAgIHRoaXMubGlzdGVuVG8odGhpcy5tb2RlbCwgXCJkZXN0cm95XCIsIHRoaXMucmVtb3ZlKTtcbiAgICAgIHRoaXMubGlzdGVuVG8odGhpcy5tb2RlbCwgXCJkaXNwbGF5TG9hZGluZ1wiLCB0aGlzLmRpc3BsYXlMb2FkaW5nKTtcbiAgICAgIHRoaXMubGlzdGVuVG8odGhpcy5tb2RlbCwgXCJpbnZhbGlkXCIsIHRoaXMuc2hvd1ZpZXcpO1xuICAgICAgdGhpcy5saXN0ZW5UbyhcbiAgICAgICAgdGhpcy5tb2RlbCxcbiAgICAgICAgXCJkaXNwbGF5TmV0d29ya0Vycm9yXCIsXG4gICAgICAgIHRoaXMuZGlzcGxheU5ldHdvcmtFcnJvclxuICAgICAgKTtcbiAgICAgIHRoaXMubGlzdGVuVG8odGhpcy5tb2RlbCwgXCJhY3Rpb25BdHRyaWJ1dGVMaW5rXCIsIHRoaXMuZG9TdGFuZGFyZEFjdGlvbik7XG4gICAgICB0aGlzLmxpc3RlblRvKHRoaXMubW9kZWwsIFwibG9hZERvY3VtZW50XCIsIHRoaXMubG9hZERvY3VtZW50KTtcbiAgICAgIHRoaXMubGlzdGVuVG8odGhpcy5tb2RlbCwgXCJyZWRyYXdFcnJvck1lc3NhZ2VzXCIsIHRoaXMucmVkcmF3VG9vdGlwcyk7XG4gICAgICB0aGlzLmxpc3RlblRvKHRoaXMubW9kZWwsIFwiZG9TZWxlY3RUYWJcIiwgdGhpcy5zZWxlY3RUYWIpO1xuICAgICAgdGhpcy5saXN0ZW5Ubyh0aGlzLm1vZGVsLCBcImRvRHJhd1RhYlwiLCB0aGlzLmRyYXdUYWIpO1xuICAgICAgdGhpcy5saXN0ZW5Ubyh0aGlzLm1vZGVsLCBcImRkdWlEb2N1bWVudFJlYWR5XCIsIHRoaXMuY2xlYW5BbmRSZW5kZXIpO1xuICAgICAgdGhpcy5saXN0ZW5Ubyh0aGlzLm1vZGVsLCBcImRkdWlEb2N1bWVudERpc3BsYXlWaWV3XCIsIHRoaXMuc2hvd1ZpZXcpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBDbGVhbiB0aGUgYXNzb2NpYXRlZCB2aWV3IGFuZCByZS1yZW5kZXIgaXRcbiAgICAgKi9cbiAgICBjbGVhbkFuZFJlbmRlcjogZnVuY3Rpb24gdkRvY3VtZW50Q2xlYW5BbmRSZW5kZXIoKSB7XG4gICAgICB0aGlzLnRyaWdnZXIoXCJsb2FkZXJTaG93XCIsIGkxOG4uX19fKFwiUmVuZGVyaW5nXCIsIFwiZGR1aVwiKSwgNzApO1xuICAgICAgJChcIi5kY3BTdGF0aWNFcnJvck1lc3NhZ2VcIikuYXR0cihcImhpZGRlblwiLCB0cnVlKTtcbiAgICAgIHRoaXMuJGVsLnNob3coKTtcbiAgICAgIHRoaXMuJGVsWzBdLmNsYXNzTmFtZSA9IHRoaXMuJGVsWzBdLmNsYXNzTmFtZS5yZXBsYWNlKFxuICAgICAgICAvXFxiZGNwRmFtaWx5LipcXGIvZyxcbiAgICAgICAgXCJcIlxuICAgICAgKTtcbiAgICAgIHRoaXMuJGVsXG4gICAgICAgIC5yZW1vdmVDbGFzcyhcImRjcERvY3VtZW50LS12aWV3XCIpXG4gICAgICAgIC5yZW1vdmVDbGFzcyhcImRjcERvY3VtZW50LS1lZGl0XCIpO1xuICAgICAgdHJ5IHtcbiAgICAgICAgaWYgKHRoaXMuaGlzdG9yeVdpZGdldCkge1xuICAgICAgICAgIHRoaXMuaGlzdG9yeVdpZGdldC5kZXN0cm95KCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMucHJvcGVydGllc1dpZGdldCkge1xuICAgICAgICAgIHRoaXMucHJvcGVydGllc1dpZGdldC5kZXN0cm95KCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuaGVscFdpZGdldCkge1xuICAgICAgICAgIHRoaXMuaGVscFdpZGdldC5kZXN0cm95KCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMudHJhbnNpdGlvbkdyYXBoICYmIHRoaXMudHJhbnNpdGlvbkdyYXBoLnZpZXcpIHtcbiAgICAgICAgICB0aGlzLnRyYW5zaXRpb25HcmFwaC52aWV3LnJlbW92ZSgpO1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7XG4gICAgICB9XG4gICAgICAvLyAgdGhpcy50cmlnZ2VyKFwiY2xlYW5Ob3RpZmljYXRpb25cIik7XG4gICAgICB0aGlzLnJlbmRlcigpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBSZW5kZXIgdGhlIGRvY3VtZW50IHZpZXdcbiAgICAgKiBAcmV0dXJucyB7Kn1cbiAgICAgKi9cbiAgICByZW5kZXI6IGZ1bmN0aW9uIHZEb2N1bWVudFJlbmRlcigpIHtcbiAgICAgIGNvbnNvbGUudGltZShcInJlbmRlciBkb2N1bWVudCB2aWV3XCIpO1xuICAgICAgdmFyIHJlbmRlclByb21pc2VzID0gW107XG4gICAgICB2YXIgJGNvbnRlbnQsXG4gICAgICAgIG1vZGVsID0gdGhpcy5tb2RlbCxcbiAgICAgICAgJGVsID0gdGhpcy4kZWwsXG4gICAgICAgIGN1cnJlbnRWaWV3ID0gdGhpcztcbiAgICAgIHZhciBsb2NhbGUgPSB0aGlzLm1vZGVsLmdldChcImxvY2FsZVwiKTtcbiAgICAgIHZhciBkb2N1bWVudFZpZXcgPSB0aGlzO1xuICAgICAgdmFyIGh0bWxCb2R5ID1cbiAgICAgICAgJzxkaXYgY2xhc3M9XCJkY3BEb2N1bWVudF9fZm9ybSBmb3JtLWhvcml6b250YWxcIj4nICtcbiAgICAgICAgJzxkaXYgY2xhc3M9XCJkY3BEb2N1bWVudF9fZnJhbWVzXCI+PC9kaXY+JyArXG4gICAgICAgICc8ZGl2IHN0eWxlPVwiZGlzcGxheTpub25lXCIgY2xhc3M9XCJkY3BEb2N1bWVudF9fdGFic1wiPicgK1xuICAgICAgICAnPHVsIGNsYXNzPVwiZGNwRG9jdW1lbnRfX3RhYnNfX2xpc3RcIj48L3VsPjwvZGl2PjwvZGl2Pic7XG4gICAgICB2YXIgJGJvZHk7XG4gICAgICB2YXIgdGFiUGxhY2VtZW50ID0gdGhpcy5tb2RlbC5nZXRPcHRpb24oXCJ0YWJQbGFjZW1lbnRcIikgfHwgXCJ0b3BcIjtcbiAgICAgIHZhciBldmVudCA9IHsgcHJldmVudDogZmFsc2UgfTtcbiAgICAgIHZhciB2aWV3TWVudXMgPSBbXTtcblxuICAgICAgdGhpcy4kZWwucmVtb3ZlQ2xhc3MoXCJkY3BUb3VjaFwiKTtcbiAgICAgIGlmIChjaGVja1RvdWNoRXZlbnRzKCkpIHtcbiAgICAgICAgdGhpcy4kZWwuYWRkQ2xhc3MoXCJkY3BUb3VjaFwiKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5zZWxlY3RlZFRhYiA9IHRoaXMubW9kZWwuZ2V0T3B0aW9uKFwib3BlbkZpcnN0VGFiXCIpO1xuICAgICAgdGhpcy5tb2RlbC50cmlnZ2VyKFwiYmVmb3JlUmVuZGVyXCIsIGV2ZW50KTtcblxuICAgICAgaWYgKGV2ZW50LnByZXZlbnQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICB9XG5cbiAgICAgIHRoaXMudGVtcGxhdGUgPSB0aGlzLmdldFRlbXBsYXRlcyhcImJvZHlcIikudHJpbSgpO1xuICAgICAgdGhpcy5wYXJ0aWFscyA9IHRoaXMuZ2V0VGVtcGxhdGVzKFwic2VjdGlvbnNcIik7XG5cbiAgICAgIC8vIEhpZGUgcGFyYXNpdGUgdG9vbHRpcCBpZiBhbnlcbiAgICAgIHRoaXMuJGVsLmZpbmQoXCJbYXJpYS1kZXNjcmliZWRieSo9J3Rvb2x0aXAnXVwiKS50b29sdGlwKFwiaGlkZVwiKTtcbiAgICAgIHRoaXMuJGVsLmVtcHR5KCk7XG5cbiAgICAgIHRoaXMucmVuZGVyQ3NzKCk7XG4gICAgICB0aGlzLnB1Ymxpc2hNZXNzYWdlcygpO1xuXG4gICAgICB0aGlzLnVwZGF0ZVRpdGxlKCk7XG4gICAgICB0aGlzLnVwZGF0ZUljb24oKTtcblxuICAgICAgaWYgKCFsb2NhbGUpIHtcbiAgICAgICAgbG9jYWxlID0gXCJmci1GUlwiO1xuICAgICAgfVxuICAgICAgJCh3aW5kb3cpLm9mZihcIi52XCIgKyB0aGlzLm1vZGVsLmNpZCk7XG5cbiAgICAgICQod2luZG93KS5vbihcbiAgICAgICAgXCJyZXNpemUudlwiICsgdGhpcy5tb2RlbC5jaWQsXG4gICAgICAgIF8uYmluZCh0aGlzLnJlc2l6ZUZvckZvb3RlciwgdGhpcylcbiAgICAgICk7XG4gICAgICBrZW5kby5jdWx0dXJlKGxvY2FsZSk7XG4gICAgICAvL2FkZCBkb2N1bWVudCBiYXNlXG4gICAgICB0cnkge1xuICAgICAgICB2YXIgcmVuZGVyRGF0YSA9IHRoaXMubW9kZWwudG9EYXRhKCk7XG4gICAgICAgIHJlbmRlckRhdGEuZG9jdW1lbnQgPSBhdHRyaWJ1dGVUZW1wbGF0ZS5nZXRUZW1wbGF0ZU1vZGVsSW5mbyhcbiAgICAgICAgICB0aGlzLm1vZGVsXG4gICAgICAgICk7XG4gICAgICAgIHRoaXMuJGVsLmFwcGVuZChcbiAgICAgICAgICAkKE11c3RhY2hlLnJlbmRlcih0aGlzLnRlbXBsYXRlIHx8IFwiXCIsIHJlbmRlckRhdGEsIHRoaXMucGFydGlhbHMpKVxuICAgICAgICApO1xuICAgICAgICBhdHRyaWJ1dGVUZW1wbGF0ZS5jb21wbGV0ZUN1c3RvbUNvbnRlbnQodGhpcy4kZWwsIHRoaXMubW9kZWwsIG51bGwsIHtcbiAgICAgICAgICBpbml0aWFsaXplQ29udGVudDogdHJ1ZVxuICAgICAgICB9KTtcbiAgICAgICAgJGJvZHkgPSB0aGlzLiRlbFxuICAgICAgICAgIC5maW5kKFwiLmRjcERvY3VtZW50X19ib2R5XCIpXG4gICAgICAgICAgLmFwcGVuZChodG1sQm9keSlcbiAgICAgICAgICAuYWRkQ2xhc3MoXCJjb250YWluZXItZmx1aWRcIik7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIGlmICh3aW5kb3cuZGNwLmxvZ2dlcikge1xuICAgICAgICAgIHdpbmRvdy5kY3AubG9nZ2VyKGUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgdGhpcy4kZWwucmVtb3ZlQ2xhc3MoXCJkY3BEb2N1bWVudC0tY3JlYXRlXCIpO1xuICAgICAgaWYgKHRoaXMubW9kZWwuZ2V0KFwiY3JlYXRpb25GYW1pZFwiKSkge1xuICAgICAgICB0aGlzLiRlbC5hZGRDbGFzcyhcImRjcERvY3VtZW50LS1jcmVhdGVcIik7XG4gICAgICB9XG4gICAgICB0aGlzLiRlbC5hZGRDbGFzcyhcbiAgICAgICAgXCJkY3BEb2N1bWVudCBkY3BEb2N1bWVudC0tXCIgKyB0aGlzLm1vZGVsLmdldChcInJlbmRlck1vZGVcIilcbiAgICAgICk7XG4gICAgICB0aGlzLiRlbC5hZGRDbGFzcyhcbiAgICAgICAgXCJkY3BGYW1pbHktLVwiICsgdGhpcy5tb2RlbC5nZXQoXCJwcm9wZXJ0aWVzXCIpLmdldChcImZhbWlseVwiKS5uYW1lXG4gICAgICApO1xuICAgICAgdGhpcy50cmlnZ2VyKFwibG9hZGluZ1wiLCAxMCk7XG4gICAgICAvL2FkZCBtZW51XG4gICAgICB0cnkge1xuICAgICAgICB0aGlzLiRlbC5maW5kKFwiLmRjcERvY3VtZW50X19tZW51XCIpLmVhY2goZnVuY3Rpb24gdkRvY3VtZW50QWRkTWVudSgpIHtcbiAgICAgICAgICB2YXIgdmlld01lbnUgPSBuZXcgVmlld0RvY3VtZW50TWVudSh7XG4gICAgICAgICAgICBtb2RlbDogY3VycmVudFZpZXcubW9kZWwsXG4gICAgICAgICAgICBlbDogdGhpc1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIHJlbmRlclByb21pc2VzLnB1c2godmlld01lbnUucmVuZGVyKCkpO1xuICAgICAgICAgIHZpZXdNZW51cy5wdXNoKHZpZXdNZW51KTtcbiAgICAgICAgfSk7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIGlmICh3aW5kb3cuZGNwLmxvZ2dlcikge1xuICAgICAgICAgIHdpbmRvdy5kY3AubG9nZ2VyKGUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHRyeSB7XG4gICAgICAgIHRoaXMuJGVsXG4gICAgICAgICAgLmZpbmQoXCIuZGNwRG9jdW1lbnRfX2hlYWRlclwiKVxuICAgICAgICAgIC5lYWNoKGZ1bmN0aW9uIHZEb2N1bWVudEFkZEhlYWRlcigpIHtcbiAgICAgICAgICAgIHJlbmRlclByb21pc2VzLnB1c2goXG4gICAgICAgICAgICAgIG5ldyBWaWV3RG9jdW1lbnRIZWFkZXIoe1xuICAgICAgICAgICAgICAgIG1vZGVsOiBjdXJyZW50Vmlldy5tb2RlbCxcbiAgICAgICAgICAgICAgICBlbDogdGhpc1xuICAgICAgICAgICAgICB9KS5yZW5kZXIoKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9KTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgaWYgKHdpbmRvdy5kY3AubG9nZ2VyKSB7XG4gICAgICAgICAgd2luZG93LmRjcC5sb2dnZXIoZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihlKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgdGhpcy50cmlnZ2VyKFwibG9hZGluZ1wiLCAyMCwgdGhpcy5tb2RlbC5nZXQoXCJhdHRyaWJ1dGVzXCIpLmxlbmd0aCk7XG4gICAgICAvL2FkZCBmaXJzdCBsZXZlbCBhdHRyaWJ1dGVzXG5cbiAgICAgICRjb250ZW50ID0gdGhpcy4kZWwuZmluZChcIi5kY3BEb2N1bWVudF9fZnJhbWVzXCIpO1xuICAgICAgaWYgKCRib2R5ICYmICRib2R5Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgdGhpcy5tb2RlbFxuICAgICAgICAgIC5nZXQoXCJhdHRyaWJ1dGVzXCIpXG4gICAgICAgICAgLmVhY2goZnVuY3Rpb24gdkRvY3VtZW50UmVuZGVyQXR0cmlidXRlKGN1cnJlbnRBdHRyKSB7XG4gICAgICAgICAgICB2YXIgdmlldywgdmlld1RhYkxhYmVsLCB2aWV3VGFiQ29udGVudDtcbiAgICAgICAgICAgIGlmICghY3VycmVudEF0dHIuaXNEaXNwbGF5YWJsZSgpKSB7XG4gICAgICAgICAgICAgIGN1cnJlbnRWaWV3LnRyaWdnZXIoXCJwYXJ0UmVuZGVyXCIpO1xuICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgIGN1cnJlbnRBdHRyLmdldChcInR5cGVcIikgPT09IFwiZnJhbWVcIiAmJlxuICAgICAgICAgICAgICBfLmlzRW1wdHkoY3VycmVudEF0dHIuZ2V0KFwicGFyZW50XCIpKVxuICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgdmlldyA9IG5ldyBWaWV3QXR0cmlidXRlRnJhbWUoe1xuICAgICAgICAgICAgICAgICAgbW9kZWw6IG1vZGVsLmdldChcImF0dHJpYnV0ZXNcIikuZ2V0KGN1cnJlbnRBdHRyLmlkKVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJlbmRlclByb21pc2VzLnB1c2godmlldy5yZW5kZXIoKSk7XG4gICAgICAgICAgICAgICAgJGNvbnRlbnQuYXBwZW5kKHZpZXcuJGVsKTtcbiAgICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuZGNwLmxvZ2dlcikge1xuICAgICAgICAgICAgICAgICAgd2luZG93LmRjcC5sb2dnZXIoZSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgIGN1cnJlbnRBdHRyLmdldChcInR5cGVcIikgPT09IFwidGFiXCIgJiZcbiAgICAgICAgICAgICAgXy5pc0VtcHR5KGN1cnJlbnRBdHRyLmdldChcInBhcmVudFwiKSlcbiAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIHZhciB0YWJNb2RlbCA9IG1vZGVsLmdldChcImF0dHJpYnV0ZXNcIikuZ2V0KGN1cnJlbnRBdHRyLmlkKTtcbiAgICAgICAgICAgICAgICB2YXIgdGFiQ29udGVudDtcbiAgICAgICAgICAgICAgICB2aWV3VGFiTGFiZWwgPSBuZXcgVmlld0F0dHJpYnV0ZVRhYkxhYmVsKHsgbW9kZWw6IHRhYk1vZGVsIH0pO1xuXG4gICAgICAgICAgICAgICAgdmlld1RhYkNvbnRlbnQgPSBuZXcgVmlld0F0dHJpYnV0ZVRhYkNvbnRlbnQoe1xuICAgICAgICAgICAgICAgICAgbW9kZWw6IHRhYk1vZGVsXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmVuZGVyUHJvbWlzZXMucHVzaCh2aWV3VGFiQ29udGVudC5yZW5kZXIoKSk7XG5cbiAgICAgICAgICAgICAgICB0YWJDb250ZW50ID0gdmlld1RhYkNvbnRlbnQuJGVsO1xuXG4gICAgICAgICAgICAgICAgJGVsXG4gICAgICAgICAgICAgICAgICAuZmluZChcIi5kY3BEb2N1bWVudF9fdGFic19fbGlzdFwiKVxuICAgICAgICAgICAgICAgICAgLmFwcGVuZCh2aWV3VGFiTGFiZWwucmVuZGVyKCkuJGVsKTtcblxuICAgICAgICAgICAgICAgICRlbC5maW5kKFwiLmRjcERvY3VtZW50X190YWJzXCIpLmFwcGVuZCh0YWJDb250ZW50KTtcbiAgICAgICAgICAgICAgICAkZWwuZmluZChcIi5kY3BEb2N1bWVudF9fdGFic1wiKS5zaG93KCk7XG4gICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICBpZiAod2luZG93LmRjcC5sb2dnZXIpIHtcbiAgICAgICAgICAgICAgICAgIHdpbmRvdy5kY3AubG9nZ2VyKGUpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY3VycmVudFZpZXcudHJpZ2dlcihcInBhcnRSZW5kZXJcIik7XG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5rZW5kb1RhYnMgPSB0aGlzLiQoXCIuZGNwRG9jdW1lbnRfX3RhYnNcIikua2VuZG9UYWJTdHJpcCh7XG4gICAgICAgICAgdGFiUG9zaXRpb246IHRhYlBsYWNlbWVudCxcbiAgICAgICAgICBhbmltYXRpb246IHtcbiAgICAgICAgICAgIG9wZW46IHtcbiAgICAgICAgICAgICAgZHVyYXRpb246IDEwMCxcbiAgICAgICAgICAgICAgZWZmZWN0czogXCJmYWRlSW5cIlxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgc2VsZWN0OiBmdW5jdGlvbiB2RG9jdW1lbnRLZW5kb1NlbGVjdFRhYihldmVudCkge1xuICAgICAgICAgICAgdmFyIHRhYklkID0gJChldmVudC5pdGVtKS5kYXRhKFwiYXR0cmlkXCIpO1xuICAgICAgICAgICAgdmFyIHRhYiA9IGN1cnJlbnRWaWV3Lm1vZGVsLmdldChcImF0dHJpYnV0ZXNcIikuZ2V0KHRhYklkKTtcblxuICAgICAgICAgICAgaWYgKHRhYikge1xuICAgICAgICAgICAgICB0YWIuaXNSZWFsU2VsZWN0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgICB0YWIudHJpZ2dlcihcImF0dHJpYnV0ZUJlZm9yZVRhYlNlbGVjdFwiLCBldmVudCwgdGFiSWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgYWN0aXZhdGU6IGZ1bmN0aW9uIHZEb2N1bWVudFNob3dUYWIoZXZlbnQpIHtcbiAgICAgICAgICAgIHZhciB0YWJJZCA9ICQoZXZlbnQuaXRlbSkuZGF0YShcImF0dHJpZFwiKTtcbiAgICAgICAgICAgIHZhciBzY3JvbGxZID0gJCh3aW5kb3cpLnNjcm9sbFRvcCgpO1xuICAgICAgICAgICAgY3VycmVudFZpZXdcbiAgICAgICAgICAgICAgLiQoXCIuZGNwVGFiX19sYWJlbFwiKVxuICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3MoXCJkY3BMYWJlbC0tYWN0aXZlXCIpXG4gICAgICAgICAgICAgIC5hZGRDbGFzcyhcImRjcExhYmVsLS1kZWZhdWx0XCIpO1xuICAgICAgICAgICAgY3VycmVudFZpZXdcbiAgICAgICAgICAgICAgLiQoJy5kY3BMYWJlbFtkYXRhLWF0dHJpZD1cIicgKyB0YWJJZCArICdcIl0nKVxuICAgICAgICAgICAgICAuYWRkQ2xhc3MoXCJkY3BMYWJlbC0tYWN0aXZlXCIpXG4gICAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhcImRjcExhYmVsLS1kZWZhdWx0XCIpO1xuICAgICAgICAgICAgaWYgKGRvY3VtZW50Vmlldy5zZWxlY3RlZFRhYiAhPT0gdGFiSWQpIHtcbiAgICAgICAgICAgICAgZG9jdW1lbnRWaWV3LnNlbGVjdGVkVGFiID0gdGFiSWQ7XG4gICAgICAgICAgICAgIGRvY3VtZW50Vmlldy5yZWNvcmRTZWxlY3RlZFRhYih0YWJJZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBfLmRlZmVyKGZ1bmN0aW9uIHNlbGVjdE9uZVRhYigpIHtcbiAgICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICAgIGN1cnJlbnRWaWV3ICYmXG4gICAgICAgICAgICAgICAgY3VycmVudFZpZXcubW9kZWwgJiZcbiAgICAgICAgICAgICAgICBjdXJyZW50Vmlldy5tb2RlbC5nZXQoXCJhdHRyaWJ1dGVzXCIpXG4gICAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgIHZhciB0YWIgPSBjdXJyZW50Vmlldy5tb2RlbC5nZXQoXCJhdHRyaWJ1dGVzXCIpLmdldCh0YWJJZCk7XG4gICAgICAgICAgICAgICAgaWYgKHRhYikge1xuICAgICAgICAgICAgICAgICAgdGFiLnRyaWdnZXIoXCJzaG93VGFiXCIsIGV2ZW50KTtcbiAgICAgICAgICAgICAgICAgIF8uZWFjaCh2aWV3TWVudXMsIGZ1bmN0aW9uKHZpZXdNZW51KSB7XG4gICAgICAgICAgICAgICAgICAgIHZpZXdNZW51LnJlZnJlc2goKTtcbiAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgXy5kZWZlcihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgJCh3aW5kb3cpLnNjcm9sbFRvcChzY3JvbGxZKTtcbiAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpZiAoIXRoaXMuX2RjcE5vdEZpcnN0YWN0aXZhdGUpIHtcbiAgICAgICAgICAgICAgXy5kZWxheShcbiAgICAgICAgICAgICAgICBfLmJpbmQoZG9jdW1lbnRWaWV3LnNjcm9sbFRvYlZpc2libGVUYWIsIGRvY3VtZW50VmlldyksXG4gICAgICAgICAgICAgICAgNTAwXG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgIHRoaXMuX2RjcE5vdEZpcnN0YWN0aXZhdGUgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGlmICh0YWJQbGFjZW1lbnQgPT09IFwidG9wUHJvcG9ydGlvbmFsXCIpIHtcbiAgICAgICAgICB2YXIgdGFiSXRlbXMgPSAkZWwuZmluZChcIi5kY3BEb2N1bWVudF9fdGFic19fbGlzdCBsaVwiKTtcbiAgICAgICAgICBpZiAodGFiSXRlbXMubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgdGFiSXRlbXMuY3NzKFxuICAgICAgICAgICAgICBcIndpZHRoXCIsXG4gICAgICAgICAgICAgIE1hdGguZmxvb3IoMTAwIC8gdGFiSXRlbXMubGVuZ3RoKSAtIDAuNSArIFwiJVwiXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0YWJJdGVtcy5jc3MoXCJ3aWR0aFwiLCBcIjgwJVwiKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRhYlBsYWNlbWVudCA9PT0gXCJsZWZ0XCIpIHtcbiAgICAgICAgICB0aGlzLiQoXCIuZGNwVGFiX19jb250ZW50XCIpLmNzcyhcbiAgICAgICAgICAgIFwibWluLWhlaWdodFwiLFxuICAgICAgICAgICAgdGhpcy4kKFwiLmRjcERvY3VtZW50X190YWJzX19saXN0XCIpLmhlaWdodCgpICsgXCJweFwiXG4gICAgICAgICAgKTtcbiAgICAgICAgICB0aGlzLiQoXCIuZGNwRG9jdW1lbnRfX3RhYnNcIikuYWRkQ2xhc3MoXCJkY3BEb2N1bWVudF9fdGFicy0tbGVmdFwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0YWJQbGFjZW1lbnQgPT09IFwidG9wRml4XCIgJiYgdGhpcy5rZW5kb1RhYnMpIHtcbiAgICAgICAgICB0aGlzLiQoXCIuZGNwRG9jdW1lbnRfX3RhYnNcIikuYWRkQ2xhc3MoXCJkY3BEb2N1bWVudF9fdGFicy0tZml4ZWRcIik7XG5cbiAgICAgICAgICAkKHdpbmRvdykub24oXG4gICAgICAgICAgICBcInJlc2l6ZS52XCIgKyB0aGlzLm1vZGVsLmNpZCxcbiAgICAgICAgICAgIF8uZGVib3VuY2UoXy5iaW5kKHRoaXMucmVzcG9uc2l2ZVRhYk1lbnUsIHRoaXMpLCAxMDAsIGZhbHNlKVxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRhYlBsYWNlbWVudCA9PT0gXCJ0b3BcIiAmJiB0aGlzLmtlbmRvVGFicykge1xuICAgICAgICAgIHRoaXMuJChcIi5kY3BEb2N1bWVudF9fdGFic1wiKS5hZGRDbGFzcyhcImRjcERvY3VtZW50X190YWJzLS1maXhlZFwiKTtcbiAgICAgICAgICAkKHdpbmRvdykub24oXG4gICAgICAgICAgICBcInJlc2l6ZS52XCIgKyB0aGlzLm1vZGVsLmNpZCxcbiAgICAgICAgICAgIF8uZGVib3VuY2UoXy5iaW5kKHRoaXMuc2Nyb2xsVGFiTGlzdCwgdGhpcyksIDEwMCwgZmFsc2UpXG4gICAgICAgICAgKTtcbiAgICAgICAgICBfLmRlbGF5KF8uYmluZCh0aGlzLnNjcm9sbFRhYkxpc3QsIHRoaXMpLCA1MDApO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMua2VuZG9UYWJzLmxlbmd0aCA+IDAgJiYgdGhpcy5rZW5kb1RhYnMuZGF0YShcImtlbmRvVGFiU3RyaXBcIikpIHtcbiAgICAgICAgICB2YXIgc2VsZWN0VGFiID0gJ2xpW2RhdGEtYXR0cmlkPVwiJyArIHRoaXMuc2VsZWN0ZWRUYWIgKyAnXCJdJztcbiAgICAgICAgICBpZiAodGhpcy5zZWxlY3RlZFRhYiAmJiAkKHNlbGVjdFRhYikubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgdGhpcy5rZW5kb1RhYnMuZGF0YShcImtlbmRvVGFiU3RyaXBcIikuc2VsZWN0KHNlbGVjdFRhYik7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMua2VuZG9UYWJzLmRhdGEoXCJrZW5kb1RhYlN0cmlwXCIpLnNlbGVjdCgwKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgICQod2luZG93LmRvY3VtZW50KVxuICAgICAgICAub24oXG4gICAgICAgICAgXCJkcm9wLnZcIiArIHRoaXMubW9kZWwuY2lkICsgXCIgZHJhZ292ZXIuXCIgKyB0aGlzLm1vZGVsLmNpZCxcbiAgICAgICAgICBmdW5jdGlvbiB2RG9jdW1lbnRQcmV2ZW50RHJhZ0Ryb3AoZSkge1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgIH1cbiAgICAgICAgKVxuICAgICAgICAub24oXG4gICAgICAgICAgXCJyZWRyYXdFcnJvck1lc3NhZ2VzLnZcIiArIHRoaXMubW9kZWwuY2lkLFxuICAgICAgICAgIGZ1bmN0aW9uIHZEb2N1bWVudFJlZHJhd0Vycm9yTWVzc2FnZXMoKSB7XG4gICAgICAgICAgICBkb2N1bWVudFZpZXcucmVkcmF3VG9vdGlwcygpO1xuICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICAgICQod2luZG93KS5vbihcbiAgICAgICAgXCJyZXNpemUudlwiICsgdGhpcy5tb2RlbC5jaWQsXG4gICAgICAgIF8uZGVib3VuY2UoXG4gICAgICAgICAgZnVuY3Rpb24gdkRvY3VtZW50UmVzaXplRGVib3VuY2UoKSB7XG4gICAgICAgICAgICBkb2N1bWVudFZpZXcucmVkcmF3VG9vdGlwcygpO1xuICAgICAgICAgICAgZG9jdW1lbnRWaWV3LnNjcm9sbFRvYlZpc2libGVUYWIoKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIDEwMCxcbiAgICAgICAgICBmYWxzZVxuICAgICAgICApXG4gICAgICApO1xuXG4gICAgICAkKHdpbmRvdykub24oXG4gICAgICAgIFwicmVzaXplLnZcIiArIHRoaXMubW9kZWwuY2lkLFxuICAgICAgICBfLmRlYm91bmNlKFxuICAgICAgICAgIGZ1bmN0aW9uIHZEb2N1bWVudFJlc2l6ZURlYm91bmNlKCkge1xuICAgICAgICAgICAgaWYgKGRvY3VtZW50Vmlldy5tb2RlbC5nZXQoXCJhdHRyaWJ1dGVzXCIpKSB7XG4gICAgICAgICAgICAgIGRvY3VtZW50Vmlldy5tb2RlbFxuICAgICAgICAgICAgICAgIC5nZXQoXCJhdHRyaWJ1dGVzXCIpXG4gICAgICAgICAgICAgICAgLmVhY2goZnVuY3Rpb24gdkRvY3VtZW50X3RyaWdnZXJDbG9zZShjdXJyZW50QXR0cmlidXRlTW9kZWwpIHtcbiAgICAgICAgICAgICAgICAgIGN1cnJlbnRBdHRyaWJ1dGVNb2RlbC50cmlnZ2VyKFwiY2xvc2VXaWRnZXRcIik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICAxMDAsXG4gICAgICAgICAgZmFsc2VcbiAgICAgICAgKVxuICAgICAgKTtcblxuICAgICAgdGhpcy4kZWwuYWRkQ2xhc3MoXCJkY3BEb2N1bWVudC0tc2hvd1wiKTtcblxuICAgICAgdGhpcy5yZXNpemVGb3JGb290ZXIoKTtcbiAgICAgIGNvbnNvbGUudGltZUVuZChcInJlbmRlciBkb2N1bWVudCB2aWV3XCIpO1xuICAgICAgUHJvbWlzZS5hbGwocmVuZGVyUHJvbWlzZXMpLnRoZW4oXG4gICAgICAgIF8uYmluZChmdW5jdGlvbiB2RG9jdW1lbnRSZW5kZXJEb25lKCkge1xuICAgICAgICAgIHRoaXMudHJpZ2dlcihcInJlbmRlckRvbmVcIik7XG4gICAgICAgIH0sIHRoaXMpXG4gICAgICApO1xuICAgICAgdGhpcy4kZWwuc2hvdygpO1xuICAgICAgaWYgKHRhYlBsYWNlbWVudCA9PT0gXCJ0b3BGaXhcIiAmJiB0aGlzLmtlbmRvVGFicykge1xuICAgICAgICBfLmRlZmVyKF8uYmluZCh0aGlzLnJlc3BvbnNpdmVUYWJNZW51LCB0aGlzKSk7IC8vIG5lZWQgdG8gY2FsbCBoZXJlIHRvIGhhdmUgZ29vZCBkaW1lbnNpb25zXG4gICAgICB9XG4gICAgICBpZiAodGFiUGxhY2VtZW50ID09PSBcImxlZnRcIikge1xuICAgICAgICB0aGlzLiQoXCIuZGNwVGFiX19jb250ZW50XCIpLmNzcyhcbiAgICAgICAgICBcIndpZHRoXCIsXG4gICAgICAgICAgXCJjYWxjKDEwMCUgLSBcIiArICgkKFwiLmRjcERvY3VtZW50X190YWJzX19saXN0XCIpLndpZHRoKCkgKyAzMCkgKyBcInB4KVwiXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIF8uZGVsYXkoZnVuY3Rpb24gdkRvY3VtZW50RW5kTG9hZGluZygpIHtcbiAgICAgICAgJChcIi5kY3BMb2FkaW5nLS1pbml0XCIpLnJlbW92ZUNsYXNzKFwiZGNwTG9hZGluZy0taW5pdFwiKTtcbiAgICAgICAgaWYgKHRhYlBsYWNlbWVudCA9PT0gXCJ0b3BGaXhcIiAmJiBkb2N1bWVudFZpZXcua2VuZG9UYWJzKSB7XG4gICAgICAgICAgZG9jdW1lbnRWaWV3LnJlc3BvbnNpdmVUYWJNZW51KCk7IC8vIG5lZWQgdG8gY2FsbCBoZXJlIHRvIGhhdmUgZ29vZCBkaW1lbnNpb25zXG4gICAgICAgIH1cbiAgICAgIH0sIDUwMCk7XG5cbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICBzZWxlY3RUYWI6IGZ1bmN0aW9uIFZEb2N1bWVudFNlbGVjdFRhYih0YWJJZCkge1xuICAgICAgaWYgKHRhYklkKSB7XG4gICAgICAgIGlmICghTnVtYmVyLmlzSW50ZWdlcih0YWJJZCkpIHtcbiAgICAgICAgICB0YWJJZCA9IHRoaXMuJGVsLmZpbmQoXG4gICAgICAgICAgICAnbGkuZGNwVGFiX19sYWJlbFtkYXRhLWF0dHJpZD1cIicgKyB0YWJJZCArICdcIl0nXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmtlbmRvVGFicy5kYXRhKFwia2VuZG9UYWJTdHJpcFwiKS5zZWxlY3QodGFiSWQpO1xuICAgICAgfVxuICAgIH0sXG4gICAgZHJhd1RhYjogZnVuY3Rpb24gVkRvY3VtZW50RHJhd1RhYih0YWJJZCkge1xuICAgICAgaWYgKHRhYklkKSB7XG4gICAgICAgIHZhciB0YWIgPSB0aGlzLm1vZGVsLmdldChcImF0dHJpYnV0ZXNcIikuZ2V0KHRhYklkKTtcbiAgICAgICAgaWYgKHRhYikge1xuICAgICAgICAgIHRhYi50cmlnZ2VyKFwic2hvd1RhYlwiLCBldmVudCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuXG4gICAgcmVzaXplRm9yRm9vdGVyOiBmdW5jdGlvbiB2RG9jdW1lbnRyZXNpemVGb3JGb290ZXIoKSB7XG4gICAgICB2YXIgJGZvb3RlciA9IHRoaXMuJGVsLmZpbmQoXCIuZGNwRG9jdW1lbnRfX2Zvb3RlclwiKTtcbiAgICAgIGlmICgkZm9vdGVyLmxlbmd0aCA+IDApIHtcbiAgICAgICAgdmFyIGZvb3RlckhlaWdodCA9ICRmb290ZXIuaGVpZ2h0KCk7XG4gICAgICAgIGlmIChmb290ZXJIZWlnaHQgPiAwKSB7XG4gICAgICAgICAgJChcImJvZHlcIikuY3NzKFwibWFyZ2luLWJvdHRvbVwiLCBmb290ZXJIZWlnaHQgKyBcInB4XCIpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIFNjcm9sbCB0byB2aXNpYmxlIHRhYiBsYWJlbFxuICAgICAqL1xuICAgIHNjcm9sbFRvYlZpc2libGVUYWI6IGZ1bmN0aW9uIHZEb2N1bWVudHNjcm9sbFRvYlZpc2libGVUYWIoKSB7XG4gICAgICB2YXIga2VuZG9UYWJTdHJpcCA9IHRoaXMua2VuZG9UYWJzXG4gICAgICAgID8gdGhpcy5rZW5kb1RhYnMuZGF0YShcImtlbmRvVGFiU3RyaXBcIilcbiAgICAgICAgOiBudWxsO1xuICAgICAgaWYgKGtlbmRvVGFiU3RyaXAgJiYga2VuZG9UYWJTdHJpcC5fc2Nyb2xsYWJsZU1vZGVBY3RpdmUpIHtcbiAgICAgICAga2VuZG9UYWJTdHJpcC5fc2Nyb2xsVGFic1RvSXRlbShcbiAgICAgICAgICB0aGlzLmtlbmRvVGFicy5maW5kKFwibGkuay1zdGF0ZS1hY3RpdmVcIilcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgc2Nyb2xsVGFiTGlzdDogZnVuY3Rpb24gdkRvY3VtZW50U2Nyb2xsVGFiTGlzdCgpIHtcbiAgICAgIHZhciBrZW5kb1RhYlN0cmlwID0gdGhpcy5rZW5kb1RhYnMuZGF0YShcImtlbmRvVGFiU3RyaXBcIik7XG5cbiAgICAgIGlmIChrZW5kb1RhYlN0cmlwKSB7XG4gICAgICAgIGtlbmRvVGFiU3RyaXAucmVzaXplKCk7XG4gICAgICB9XG4gICAgfSxcbiAgICAvKipcbiAgICAgKiBSZWRyYXcgbWVzc2FnZXMgZm9yIHRoZSBlcnJvciBkaXNwbGF5ZWRcbiAgICAgKiBDaGFuZ2UgcGxhY2VtZW50IG9mIHRvb2x0aXBzXG4gICAgICovXG4gICAgcmVkcmF3VG9vdGlwczogZnVuY3Rpb24gdkRvY3VtZW50cmVkcmF3VG9vdGlwcygpIHtcbiAgICAgIHZhciAkdG9vbHRpcHMgPSAkKFwiLnRvb2x0aXA6dmlzaWJsZVwiKTtcblxuICAgICAgJHRvb2x0aXBzLmVhY2goZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBiVG9vbHRpcCA9ICQodGhpcykuZGF0YShcImJzLnRvb2x0aXBcIik7XG4gICAgICAgIGlmIChiVG9vbHRpcCkge1xuICAgICAgICAgIGJUb29sdGlwLmhpZGUoKTtcbiAgICAgICAgICBiVG9vbHRpcC5zaG93KCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0sXG4gICAgLyoqXG4gICAgICogQWRkIG1lbnUgaWYgbmVlZGVkIGluIHRvcEZpeCBwbGFjZW1lbnQgdGFiXG4gICAgICovXG4gICAgcmVzcG9uc2l2ZVRhYk1lbnU6IGZ1bmN0aW9uIHZEb2N1bWVudFRhYkZpeE1lbnUoKSB7XG4gICAgICB2YXIgJHRhYkxhYmVsID0gdGhpcy4kKFwiLmRjcERvY3VtZW50X190YWJzX19saXN0IGxpXCIpO1xuXG4gICAgICB2YXIgZG9jdW1lbnRXaWR0aCA9IHRoaXMuJChcIi5kY3BEb2N1bWVudF9fdGFic1wiKS53aWR0aCgpIC0gMTI7XG4gICAgICB2YXIgY3VycmVudFdpZHRoID0gMDtcbiAgICAgIHZhciBoaWRkZW5zID0gW107XG4gICAgICB2YXIgbGFzdFNob3cgPSBudWxsO1xuICAgICAgdmFyICRkcm9wU2VsZWN0O1xuICAgICAgdmFyICRkcm9wVG9wU2VsZWN0O1xuICAgICAgdmFyICRrZW5kb1RhYnMgPSB0aGlzLmtlbmRvVGFicy5kYXRhKFwia2VuZG9UYWJTdHJpcFwiKTtcbiAgICAgIHZhciBsaUluZGV4ID0gMDtcbiAgICAgIHZhciAkdGFicyA9IHRoaXMuJChcIi5kY3BEb2N1bWVudF9fdGFic1wiKTtcbiAgICAgIHZhciAkc2VsZWN0ZWRUYWJJZCA9IHRoaXMuc2VsZWN0ZWRUYWI7XG4gICAgICB2YXIgaGlkZGVuU2VsZWN0ZWQgPSBmYWxzZTtcbiAgICAgIHZhciBkYXRhU291cmNlID0gbnVsbDtcbiAgICAgIHZhciBpT1MgPSAvKGlQYWR8aVBob25lfGlQb2QpL2cudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KTtcblxuICAgICAgLy8gJHRhYnMuZmluZChcIi5kY3BEb2N1bWVudF9fdGFic19fbGlzdFwiKS5jc3MoXCJvdmVyZmxvd1wiLCBcImhpZGRlblwiKS5jc3MoXCJtYXgtaGVpZ2h0XCIsIFwiMi43ZW1cIik7XG4gICAgICAvLyBSZXN0b3JlIGluaXRpYWwgdGFic1xuICAgICAgJHRhYkxhYmVsLnNob3coKTtcblxuICAgICAgJHRhYkxhYmVsLmVhY2goZnVuY3Rpb24gdkRvY3VtZW50SGlkZVRhYldpZHRoKCkge1xuICAgICAgICBjdXJyZW50V2lkdGggKz0gJCh0aGlzKS5vdXRlcldpZHRoKCk7XG4gICAgICAgIGlmIChjdXJyZW50V2lkdGggPiBkb2N1bWVudFdpZHRoKSB7XG4gICAgICAgICAgJCh0aGlzKS5oaWRlKCk7XG4gICAgICAgICAgaWYgKGhpZGRlbnMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICBoaWRkZW5zLnB1c2goe1xuICAgICAgICAgICAgICB0b29sdGlwTGFiZWw6ICQobGFzdFNob3cpLmRhdGEoXCJ0b29sdGlwTGFiZWxcIiksXG4gICAgICAgICAgICAgIGxhYmVsOiAkKGxhc3RTaG93KVxuICAgICAgICAgICAgICAgIC5maW5kKFwiLmstbGlua1wiKVxuICAgICAgICAgICAgICAgIC50ZXh0KCksXG4gICAgICAgICAgICAgIGlkOiAkKGxhc3RTaG93KS5kYXRhKFwiYXR0cmlkXCIpLFxuICAgICAgICAgICAgICBpbmRleDogbGlJbmRleCAtIDFcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICBoaWRkZW5zLnB1c2goe1xuICAgICAgICAgICAgdG9vbHRpcExhYmVsOiAkKHRoaXMpLmRhdGEoXCJ0b29sdGlwTGFiZWxcIiksXG4gICAgICAgICAgICBsYWJlbDogJCh0aGlzKVxuICAgICAgICAgICAgICAuZmluZChcIi5rLWxpbmtcIilcbiAgICAgICAgICAgICAgLnRleHQoKSxcbiAgICAgICAgICAgIGlkOiAkKHRoaXMpLmRhdGEoXCJhdHRyaWRcIiksXG4gICAgICAgICAgICBpbmRleDogbGlJbmRleFxuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICRrZW5kb1RhYnMuZW5hYmxlICYmICRrZW5kb1RhYnMuZW5hYmxlKCQodGhpcykpO1xuICAgICAgICAgIGxhc3RTaG93ID0gdGhpcztcbiAgICAgICAgfVxuXG4gICAgICAgIGxpSW5kZXgrKztcbiAgICAgIH0pO1xuXG4gICAgICAvKipcbiAgICAgICAqIE5lZWQgdG8gcmVjb21wdXRlIGNvbnRhaW5lciB3aWR0aFxuICAgICAgICovXG4gICAgICAkKFwiLmRjcExhYmVsX19zZWxlY3QtaGlkZTp2aXNpYmxlXCIpLmVhY2goXG4gICAgICAgIGZ1bmN0aW9uIHZEb2N1bWVudFNlbGVjdENvbnRhaW5lcigpIHtcbiAgICAgICAgICB2YXIgJGNvbnRhaW5lciA9ICQodGhpcykuY2xvc2VzdChcIi5rLWxpc3QtY29udGFpbmVyXCIpO1xuICAgICAgICAgIHZhciB4ID0gJGNvbnRhaW5lci5vZmZzZXQoKS5sZWZ0O1xuICAgICAgICAgIHZhciBtYXhXaWR0aCA9ICQoXCJib2R5XCIpLndpZHRoKCkgLSB4IC0gMjAgKyBcInB4XCI7XG5cbiAgICAgICAgICAkY29udGFpbmVyLmNzcyhcIm1heC13aWR0aFwiLCBtYXhXaWR0aCk7XG4gICAgICAgICAgJGNvbnRhaW5lclxuICAgICAgICAgICAgLmNsb3Nlc3QoXCIuay1hbmltYXRpb24tY29udGFpbmVyXCIpXG4gICAgICAgICAgICAuY3NzKFwibWF4LXdpZHRoXCIsIG1heFdpZHRoKTtcbiAgICAgICAgICAkKHRoaXMpLmNzcyhcIm1heC13aWR0aFwiLCBcIlwiKTtcbiAgICAgICAgfVxuICAgICAgKTtcblxuICAgICAgaWYgKCR0YWJzLmRhdGEoXCJoaWRkZW5UYWJzTGVuZ3RoXCIpID09PSBoaWRkZW5zLmxlbmd0aCkge1xuICAgICAgICAvLyBPcHRpbWl6YXRpb24gaWYgbm8gbmV3IHRhYnMgdG8gaGlkZVxuICAgICAgICBpZiAoaGlkZGVucy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgJGtlbmRvVGFicyAmJiAka2VuZG9UYWJzLmRpc2FibGUgJiYgJGtlbmRvVGFicy5kaXNhYmxlKCQobGFzdFNob3cpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vJHRhYnMuZmluZChcIi5kY3BEb2N1bWVudF9fdGFic19fbGlzdFwiKS5jc3MoXCJvdmVyZmxvd1wiLCBcIlwiKS5jc3MoXCJtYXgtaGVpZ2h0XCIsIFwiXCIpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIC8vIERlbGV0ZSBmaXhlZCBoZWlnaHRcbiAgICAgIC8vJHRhYkxhYmVsLmNzcyhcImhlaWdodFwiLCAnJyk7XG4gICAgICAvLyBSZWNvcmQgaGlkZGVuIGNvdW50IHRvIG9wdGltaXphdGlvblxuICAgICAgJHRhYnMuZGF0YShcImhpZGRlblRhYnNMZW5ndGhcIiwgaGlkZGVucy5sZW5ndGgpO1xuICAgICAgJHRhYkxhYmVsLmZpbmQoXCIuay1saW5rXCIpLnNob3coKTsgLy8gUmVzdG9yZSBvcmlnaW5hbCBsaW5rICh0YWIgbGFiZWwpXG5cbiAgICAgICRkcm9wVG9wU2VsZWN0ID0gJHRhYnMuZmluZChcIi5kY3BUYWJfX2xhYmVsX19zZWxlY3Quay1jb21ib2JveFwiKS5oaWRlKCk7XG4gICAgICAkdGFic1xuICAgICAgICAuZmluZChcImlucHV0LmRjcFRhYl9fbGFiZWxfX3NlbGVjdFtkYXRhLXJvbGU9Y29tYm9ib3hdXCIpXG4gICAgICAgIC5lYWNoKGZ1bmN0aW9uIHZEb2N1bWVudFNlbGVjdFRhYkNsb3NlKCkge1xuICAgICAgICAgICQodGhpcykuZGF0YShcImtlbmRvQ29tYm9Cb3hcIikgJiZcbiAgICAgICAgICAgICQodGhpcykuZGF0YShcImtlbmRvQ29tYm9Cb3hcIikuY2xvc2UgJiZcbiAgICAgICAgICAgICQodGhpcylcbiAgICAgICAgICAgICAgLmRhdGEoXCJrZW5kb0NvbWJvQm94XCIpXG4gICAgICAgICAgICAgIC5jbG9zZSgpO1xuICAgICAgICB9KTtcblxuICAgICAgJHRhYnNcbiAgICAgICAgLmZpbmQoXCIuZGNwTGFiZWwtLXNlbGVjdFwiKVxuICAgICAgICAucmVtb3ZlQ2xhc3MoXCJkY3BMYWJlbC0tc2VsZWN0IGstc3RhdGUtYWN0aXZlXCIpO1xuICAgICAgJHRhYnNcbiAgICAgICAgLmZpbmQoJy5kY3BMYWJlbFtkYXRhLWF0dHJpZD1cIicgKyAkc2VsZWN0ZWRUYWJJZCArICdcIl0nKVxuICAgICAgICAuYWRkQ2xhc3MoXCJrLXN0YXRlLWFjdGl2ZVwiKTtcblxuICAgICAgaWYgKGhpZGRlbnMubGVuZ3RoID4gMCkge1xuICAgICAgICAvLyBOZWVkIHRvIGRpc2FibGUgdGFiIHRvIHVzZSBvd24gZXZlbnRzIG1hbmFnaW5nXG4gICAgICAgIGlmIChsYXN0U2hvdykge1xuICAgICAgICAgICRrZW5kb1RhYnMuZGlzYWJsZSgkKGxhc3RTaG93KSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBIaWRlIG9yaWdpbmFsIGxpbmtcbiAgICAgICAgJChsYXN0U2hvdylcbiAgICAgICAgICAuZmluZChcIi5rLWxpbmtcIilcbiAgICAgICAgICAuaGlkZSgpO1xuICAgICAgICAvLyBSZXBsYWNlIGl0IHRvIGEgZHJvcGRvd24gc2VsZWN0b3JcbiAgICAgICAgaGlkZGVuU2VsZWN0ZWQgPSBfLnNvbWUoaGlkZGVucywgZnVuY3Rpb24gdkRvY3VtZW50U29tZUhpZGRlbnMoaXRlbSkge1xuICAgICAgICAgIHJldHVybiBpdGVtLmlkID09PSAkc2VsZWN0ZWRUYWJJZDtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKGhpZGRlblNlbGVjdGVkKSB7XG4gICAgICAgICAgJChsYXN0U2hvdykuYWRkQ2xhc3MoXCJrLXN0YXRlLWFjdGl2ZVwiKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpZiAoJChsYXN0U2hvdykuZGF0YShcImF0dHJpZFwiKSAhPT0gJHNlbGVjdGVkVGFiSWQpIHtcbiAgICAgICAgICAgICQobGFzdFNob3cpLnJlbW92ZUNsYXNzKFwiay1zdGF0ZS1hY3RpdmVcIik7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgJChsYXN0U2hvdykuYWRkQ2xhc3MoXCJkY3BMYWJlbC0tc2VsZWN0XCIpO1xuICAgICAgICAvLyQobGFzdFNob3cpLmhlaWdodChjdXJyZW50SGVpZ2h0IC0gNSk7XG4gICAgICAgIGlmICgkZHJvcFRvcFNlbGVjdC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAkZHJvcFNlbGVjdCA9ICQoJzxpbnB1dCBjbGFzcz1cImRjcFRhYl9fbGFiZWxfX3NlbGVjdFwiIC8+Jyk7XG4gICAgICAgICAgJChsYXN0U2hvdykuYXBwZW5kKCRkcm9wU2VsZWN0KTtcbiAgICAgICAgICAkZHJvcFNlbGVjdC5rZW5kb0NvbWJvQm94KHtcbiAgICAgICAgICAgIHZhbHVlOiBoaWRkZW5TZWxlY3RlZCA/ICRzZWxlY3RlZFRhYklkIDogaGlkZGVuc1swXS5pZCxcbiAgICAgICAgICAgIGRhdGFTb3VyY2U6IGhpZGRlbnMsXG4gICAgICAgICAgICBkYXRhVGV4dEZpZWxkOiBcImxhYmVsXCIsXG4gICAgICAgICAgICBkYXRhVmFsdWVGaWVsZDogXCJpZFwiLFxuICAgICAgICAgICAgZGF0YUJvdW5kOiBmdW5jdGlvbiB2RG9jdW1lbnRUYWJTZWxlY3REYXRhYm91bmQoKSB7XG4gICAgICAgICAgICAgIHZhciBteVRhYiA9ICQodGhpcy5lbGVtZW50KS5jbG9zZXN0KFwibGlcIik7XG4gICAgICAgICAgICAgIHZhciBsaUl0ZW0gPSAkdGFicy5maW5kKCdsaVtkYXRhLWF0dHJpZD1cIicgKyB0aGlzLnZhbHVlKCkgKyAnXCJdJyk7XG4gICAgICAgICAgICAgIG15VGFiLmRhdGEoXCJ0b29sdGlwTGFiZWxTZWxlY3RcIiwgbGlJdGVtLmRhdGEoXCJ0b29sdGlwTGFiZWxcIikpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNlbGVjdDogZnVuY3Rpb24gdkRvY3VtZW50VGFiU2VsZWN0U2VsZWN0KGV2ZW50KSB7XG4gICAgICAgICAgICAgIHZhciBkYXRhSXRlbSA9IHRoaXMuZGF0YVNvdXJjZS5hdChldmVudC5pdGVtLmluZGV4KCkpO1xuICAgICAgICAgICAgICB2YXIgbGlJdGVtID0gJHRhYnMuZmluZCgnbGlbZGF0YS1hdHRyaWQ9XCInICsgZGF0YUl0ZW0uaWQgKyAnXCJdJyk7XG4gICAgICAgICAgICAgIHZhciBteVRhYiA9ICQodGhpcy5lbGVtZW50KS5jbG9zZXN0KFwibGlcIik7XG5cbiAgICAgICAgICAgICAgbXlUYWIuZGF0YShcInRvb2x0aXBMYWJlbFNlbGVjdFwiLCBkYXRhSXRlbS50b29sdGlwTGFiZWwpO1xuICAgICAgICAgICAgICAvLyBOZWVkIHRvIHJlc2V0IGNsYXNzIGFuZCBlbmFibGUgdG8gcmVhbGx5IHRyaWdnZXIgc2hvdyBldmVudHNcbiAgICAgICAgICAgICAgbXlUYWIucmVtb3ZlQ2xhc3MoXCJrLXN0YXRlLWFjdGl2ZVwiKTtcbiAgICAgICAgICAgICAgJGtlbmRvVGFicy5lbmFibGUobXlUYWIpO1xuICAgICAgICAgICAgICAka2VuZG9UYWJzLnNlbGVjdChsaUl0ZW0pO1xuICAgICAgICAgICAgICAka2VuZG9UYWJzLmRpc2FibGUobXlUYWIpO1xuICAgICAgICAgICAgICBteVRhYi5hZGRDbGFzcyhcImstc3RhdGUtYWN0aXZlXCIpO1xuICAgICAgICAgICAgICBteVRhYi5maW5kKFwiLmstaW5wdXRcIikuYmx1cigpOyAvLyBCZWNhdXNlIGlucHV0IGlzIHJlYWQgb25seVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9wZW46IGZ1bmN0aW9uIHZEb2N1bWVudFRhYlNlbGVjdE9wZW4oKSB7XG4gICAgICAgICAgICAgIC8vIE5lZWQgdG8gY29tcHV0ZSB3aWR0aCBvZiBjb250YWluZXIgdG8gc2VlIGVsZW1lbnRzXG4gICAgICAgICAgICAgIC8vIFNldCBtYXgtd2lkdGggdG8gbm90IGJlIG91dCBvZiBib2R5XG4gICAgICAgICAgICAgIHZhciAkdWwgPSAkKHRoaXMudWwpO1xuICAgICAgICAgICAgICB2YXIgJGxpID0gJCh0aGlzLmVsZW1lbnQpLmNsb3Nlc3QoXCJsaVwiKTtcbiAgICAgICAgICAgICAgdmFyIHggPSAkbGkub2Zmc2V0KCkubGVmdDtcbiAgICAgICAgICAgICAgdmFyIGJvZHlXaWR0aCA9ICQoXCJib2R5XCIpLndpZHRoKCk7XG4gICAgICAgICAgICAgICR1bC5jc3MoXG4gICAgICAgICAgICAgICAgXCJtYXgtd2lkdGhcIixcbiAgICAgICAgICAgICAgICBNYXRoLm1heChib2R5V2lkdGggLSB4IC0gMjAsICQobGFzdFNob3cpLndpZHRoKCkpICsgXCJweFwiXG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICR1bC5jc3MoXCJtaW4td2lkdGhcIiwgJGxpLndpZHRoKCkpO1xuICAgICAgICAgICAgICBfLmRlZmVyKGZ1bmN0aW9uIHZEb2N1bWVudFNlbGVjdFRhYk9wZW4oKSB7XG4gICAgICAgICAgICAgICAgJHVsXG4gICAgICAgICAgICAgICAgICAuY2xvc2VzdChcIi5rLWFuaW1hdGlvbi1jb250YWluZXJcIilcbiAgICAgICAgICAgICAgICAgIC5hZGRDbGFzcyhcIm1lbnVfX3NlbGVjdF9jb250YWluZXJcIik7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgdGVtcGxhdGU6IGZ1bmN0aW9uIHZEb2N1bWVudFRhYlNlbGVjdFRlbXBsYXRlKGV2ZW50KSB7XG4gICAgICAgICAgICAgIGlmIChldmVudC50b29sdGlwTGFiZWwpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gTXVzdGFjaGUucmVuZGVyKFxuICAgICAgICAgICAgICAgICAgJzxzcGFuIGNsYXNzPVwiZGNwTGFiZWxfX3NlbGVjdC0tdG9vbHRpcFwiIGRhdGEtdG9vbHRpcExhYmVsPVwie3t0b29sdGlwTGFiZWx9fVwiPnt7bGFiZWx9fTwvc3Bhbj4nLFxuICAgICAgICAgICAgICAgICAgZXZlbnRcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIHJldHVybiBldmVudC5sYWJlbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcblxuICAgICAgICAgICRkcm9wU2VsZWN0XG4gICAgICAgICAgICAuZGF0YShcImtlbmRvQ29tYm9Cb3hcIilcbiAgICAgICAgICAgIC51bC5hZGRDbGFzcyhcImRjcExhYmVsX19zZWxlY3QtaGlkZVwiKTtcbiAgICAgICAgICAvLyBUaGUgY29udGFpbmVyIHdpZHRoIGlzIGNvbXB1dGVkIGJ5IG9wZW4gZXZlbnRcbiAgICAgICAgICAkZHJvcFNlbGVjdC5kYXRhKFwia2VuZG9Db21ib0JveFwiKS5saXN0LndpZHRoKFwiYXV0b1wiKTtcbiAgICAgICAgICAvLyBObyB1c2UgaW5wdXQgc2VsZWN0b3JcbiAgICAgICAgICAkKGxhc3RTaG93KVxuICAgICAgICAgICAgLmZpbmQoXCJpbnB1dFwiKVxuICAgICAgICAgICAgLmF0dHIoXCJhcmlhLXJlYWRvbmx5XCIsIFwidHJ1ZVwiKVxuICAgICAgICAgICAgLnByb3AoXCJyZWFkb25seVwiLCB0cnVlKTtcbiAgICAgICAgICAkKGxhc3RTaG93KVxuICAgICAgICAgICAgLmZpbmQoXCIuay1zZWxlY3RcIilcbiAgICAgICAgICAgIC5wcmVwZW5kKCQoXCI8c3Bhbi8+XCIpLmFkZENsYXNzKFwiZGNwTGFiZWxfX2NvdW50XCIpKTtcblxuICAgICAgICAgICRkcm9wU2VsZWN0LmRhdGEoXCJrZW5kb0NvbWJvQm94XCIpLnVsLnRvb2x0aXAoe1xuICAgICAgICAgICAgc2VsZWN0b3I6IFwibGkuay1pdGVtIFwiLFxuICAgICAgICAgICAgcGxhY2VtZW50OiBcImxlZnRcIixcbiAgICAgICAgICAgIGNvbnRhaW5lcjogXCIuZGNwRG9jdW1lbnRcIixcbiAgICAgICAgICAgIGh0bWw6IHRydWUsXG4gICAgICAgICAgICB0aXRsZTogZnVuY3Rpb24gdkRvY3VtZW50VGFiU2VsZWN0VGl0bGUoKSB7XG4gICAgICAgICAgICAgIHJldHVybiAkKHRoaXMpXG4gICAgICAgICAgICAgICAgLmZpbmQoXCIuZGNwTGFiZWxfX3NlbGVjdC0tdG9vbHRpcFwiKVxuICAgICAgICAgICAgICAgIC5hdHRyKFwiZGF0YS10b29sdGlwTGFiZWxcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgJGRyb3BTZWxlY3RcbiAgICAgICAgICAgIC5wYXJlbnQoKVxuICAgICAgICAgICAgLmZpbmQoXCIuay1pbnB1dFwiKVxuICAgICAgICAgICAgLmNzcyhcIndpZHRoXCIsIFwiXCIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIFJldXNlIGRyb3BEb3duIGNyZWF0ZWQgcHJldmlvdXNseVxuICAgICAgICAgICRkcm9wVG9wU2VsZWN0LnNob3coKTtcbiAgICAgICAgICAkZHJvcFNlbGVjdCA9ICR0YWJzLmZpbmQoXG4gICAgICAgICAgICBcImlucHV0LmRjcFRhYl9fbGFiZWxfX3NlbGVjdFtkYXRhLXJvbGU9Y29tYm9ib3hdXCJcbiAgICAgICAgICApO1xuICAgICAgICAgICQobGFzdFNob3cpLmFwcGVuZCgkZHJvcFRvcFNlbGVjdCk7IC8vIE1vdmUgdG8gbmV3IGxhc3RTaG93XG4gICAgICAgICAgaWYgKCRkcm9wU2VsZWN0LmRhdGEoXCJrZW5kb0NvbWJvQm94XCIpKSB7XG4gICAgICAgICAgICAkZHJvcFNlbGVjdFxuICAgICAgICAgICAgICAuZGF0YShcImtlbmRvQ29tYm9Cb3hcIilcbiAgICAgICAgICAgICAgLnZhbHVlKGhpZGRlblNlbGVjdGVkID8gJHNlbGVjdGVkVGFiSWQgOiBoaWRkZW5zWzBdLmlkKTtcbiAgICAgICAgICAgIGRhdGFTb3VyY2UgPSBuZXcga2VuZG8uZGF0YS5EYXRhU291cmNlKHtcbiAgICAgICAgICAgICAgZGF0YTogaGlkZGVuc1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAkZHJvcFNlbGVjdC5kYXRhKFwia2VuZG9Db21ib0JveFwiKS5zZXREYXRhU291cmNlKGRhdGFTb3VyY2UpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEFkZCBjb3VudCBpbiBzZWxlY3QgYnV0dG9uXG4gICAgICAgICQobGFzdFNob3cpXG4gICAgICAgICAgLmZpbmQoXCIuZGNwTGFiZWxfX2NvdW50XCIpXG4gICAgICAgICAgLnRleHQoaGlkZGVucy5sZW5ndGgpO1xuXG4gICAgICAgIGlmICghJHRhYnMuZGF0YShcInNlbGVjdEZpeE9uXCIpKSB7XG4gICAgICAgICAgLy8gQWRkIGNhbGxiYWNrIG9ubHkgb25lIHRpbWVcbiAgICAgICAgICAkdGFicy5vbihcbiAgICAgICAgICAgIFwiY2xpY2tcIixcbiAgICAgICAgICAgIFwiLmRjcExhYmVsLS1zZWxlY3QgLmstZHJvcGRvd24td3JhcCAuay1pbnB1dFwiLFxuICAgICAgICAgICAgZnVuY3Rpb24gdkRvY3VtZW50VGFiU2VsZWN0Q2xpY2soKSB7XG4gICAgICAgICAgICAgIHZhciBzZWxlY3RlZFRhYiA9ICRrZW5kb1RhYnMuc2VsZWN0KCkuZGF0YShcImF0dHJpZFwiKTtcbiAgICAgICAgICAgICAgdmFyIHNlbGVjdGVkSXRlbSA9ICR0YWJzXG4gICAgICAgICAgICAgICAgLmRhdGEoXCJzZWxlY3RGaXhPblwiKVxuICAgICAgICAgICAgICAgIC5kYXRhKFwia2VuZG9Db21ib0JveFwiKVxuICAgICAgICAgICAgICAgIC52YWx1ZSgpO1xuICAgICAgICAgICAgICB2YXIgbGlJdGVtID0gJHRhYnMuZmluZCgnbGlbZGF0YS1hdHRyaWQ9XCInICsgc2VsZWN0ZWRJdGVtICsgJ1wiXScpO1xuICAgICAgICAgICAgICB2YXIgbXlUYWIgPSAkKHRoaXMpLmNsb3Nlc3QoXCJsaVwiKTtcblxuICAgICAgICAgICAgICBpZiAoc2VsZWN0ZWRJdGVtICE9PSBzZWxlY3RlZFRhYikge1xuICAgICAgICAgICAgICAgIG15VGFiLnJlbW92ZUNsYXNzKFwiay1zdGF0ZS1hY3RpdmVcIik7XG4gICAgICAgICAgICAgICAgJGtlbmRvVGFicy5lbmFibGUobXlUYWIpO1xuICAgICAgICAgICAgICAgICRrZW5kb1RhYnMuc2VsZWN0KGxpSXRlbSk7XG4gICAgICAgICAgICAgICAgJGtlbmRvVGFicy5kaXNhYmxlKG15VGFiKTtcbiAgICAgICAgICAgICAgICBteVRhYi5hZGRDbGFzcyhcImstc3RhdGUtYWN0aXZlXCIpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgKTtcblxuICAgICAgICAgICR0YWJzLm9uKFxuICAgICAgICAgICAgXCJmb2N1c1wiLFxuICAgICAgICAgICAgXCIuZGNwTGFiZWwtLXNlbGVjdCAuay1kcm9wZG93bi13cmFwIC5rLWlucHV0XCIsXG4gICAgICAgICAgICBmdW5jdGlvbiB2RG9jdW1lbnRUYWJGb2N1cygpIHtcbiAgICAgICAgICAgICAgJCh0aGlzKS5ibHVyKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIE1lbW9yaXplIGRyb3Bkb3duIHRvIHJldXNlIGl0IGluIGNhbGxiYWNrIGFuZCB0byBsaXN0ZW4gb25seSBvbmVcbiAgICAgICAgJHRhYnMuZGF0YShcInNlbGVjdEZpeE9uXCIsICRkcm9wU2VsZWN0KTtcbiAgICAgIH1cbiAgICAgIGlmIChcIm9udG91Y2hzdGFydFwiIGluIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCAmJiBpT1MpIHtcbiAgICAgICAgJChcImJvZHlcIilcbiAgICAgICAgICAub2ZmKFwic2hvdy5icy50b29sdGlwXCIpXG4gICAgICAgICAgLm9uKFxuICAgICAgICAgICAgXCJzaG93LmJzLnRvb2x0aXBcIixcbiAgICAgICAgICAgIFwiW2RhdGEtb3JpZ2luYWwtdGl0bGVdXCIsXG4gICAgICAgICAgICBmdW5jdGlvbiB2RG9jdW1lbnRXb3JrYXJvdW5kSW9zVG91Y2goZSkge1xuICAgICAgICAgICAgICAvLyBwcmV2ZW50IGlvcyBkb3VibGUgdGFwXG4gICAgICAgICAgICAgIHZhciAkdG9vbHRpcCA9ICQodGhpcyk7XG4gICAgICAgICAgICAgIHZhciB0b29sdGlwT2JqZWN0ID0gJHRvb2x0aXAuZGF0YShcImJzLnRvb2x0aXBcIik7XG5cbiAgICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICAgIHRvb2x0aXBPYmplY3QgJiZcbiAgICAgICAgICAgICAgICB0b29sdGlwT2JqZWN0LmluU3RhdGUuY2xpY2sgPT09IGZhbHNlICYmXG4gICAgICAgICAgICAgICAgdG9vbHRpcE9iamVjdC5pblN0YXRlLmZvY3VzID09PSBmYWxzZSAmJlxuICAgICAgICAgICAgICAgIHRvb2x0aXBPYmplY3QuaW5TdGF0ZS5ob3ZlciA9PT0gZmFsc2VcbiAgICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgaWYgKFwib250b3VjaHN0YXJ0XCIgaW4gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgaWYgKCEkdG9vbHRpcC5kYXRhKFwic2hvd2lvc1wiKSkge1xuICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgJHRvb2x0aXAuZGF0YShcInNob3dpb3NcIiwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICBfLmRlbGF5KGZ1bmN0aW9uIHZEb2N1bWVudFdvcmthcm91bmRJb3NEZWxheSgpIHtcbiAgICAgICAgICAgICAgICAgICAgJHRvb2x0aXAudG9vbHRpcChcInNob3dcIik7XG4gICAgICAgICAgICAgICAgICAgICR0b29sdGlwLmRhdGEoXCJzaG93aW9zXCIsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgICAgXy5kZWxheShmdW5jdGlvbiB2RG9jdW1lbnRXb3JrYXJvdW5kSW9zU2Vjb25kRGVsYXkoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgJHRvb2x0aXAudG9vbHRpcChcImhpZGVcIik7XG4gICAgICAgICAgICAgICAgICAgIH0sIDIwMDApO1xuICAgICAgICAgICAgICAgICAgfSwgNTAwKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICAvLyR0YWJzLmZpbmQoXCIuZGNwRG9jdW1lbnRfX3RhYnNfX2xpc3RcIikuY3NzKFwib3ZlcmZsb3dcIiwgXCJcIikuY3NzKFwibWF4LWhlaWdodFwiLCBcIlwiKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKiBSZWdpc3RlciB0aGUgY3VycmVudCB0YWIgZm9yIHRoZSBjdXJyZW50IHVzZXJcbiAgICAgKlxuICAgICAqIEBwYXJhbSB0YWJJZFxuICAgICAqL1xuICAgIHJlY29yZFNlbGVjdGVkVGFiOiBmdW5jdGlvbiB2RG9jdW1lbnRSZWNvcmRTZWxlY3RlZFRhYih0YWJJZCkge1xuICAgICAgaWYgKHRoaXMubW9kZWwuZ2V0KFwiaW5pdGlkXCIpKSB7XG4gICAgICAgIHZhciB0YWdUYWIgPSBuZXcgTW9kZWxEb2N1bWVudFRhYih7XG4gICAgICAgICAgaW5pdGlkOiB0aGlzLm1vZGVsLmdldChcImluaXRpZFwiKSxcbiAgICAgICAgICB0YWJJZDogdGFiSWRcbiAgICAgICAgfSk7XG4gICAgICAgIHRhZ1RhYi5zYXZlKCk7XG4gICAgICB9XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIFB1Ymxpc2ggYXNzb2NpYXRlZCBtb2RlbCBtZXNzYWdlXG4gICAgICovXG4gICAgcHVibGlzaE1lc3NhZ2VzOiBmdW5jdGlvbiB2RG9jdW1lbnRQdWJsaXNoTWVzc2FnZXMoKSB7XG4gICAgICB2YXIgY3VycmVudFZpZXcgPSB0aGlzO1xuICAgICAgXy5lYWNoKHRoaXMubW9kZWwuZ2V0KFwibWVzc2FnZXNcIiksIGZ1bmN0aW9uIHZEb2N1bWVudFB1Ymxpc2hBTWVzc2FnZShcbiAgICAgICAgYU1lc3NhZ2VcbiAgICAgICkge1xuICAgICAgICBjdXJyZW50Vmlldy50cmlnZ2VyKFwic2hvd01lc3NhZ2VcIiwge1xuICAgICAgICAgIHR5cGU6IGFNZXNzYWdlLnR5cGUsXG4gICAgICAgICAgdGl0bGU6IGFNZXNzYWdlLmNvbnRlbnRUZXh0LFxuICAgICAgICAgIGh0bWxNZXNzYWdlOiBhTWVzc2FnZS5jb250ZW50SHRtbFxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBJbmplY3QgYXNzb2NpYXRlZCBDU1MgaW4gdGhlIERPTVxuICAgICAqXG4gICAgICogSW5qZWN0IG5ldyBDU1MsIHJlbW92ZSBvbGQgQ1NTXG4gICAgICovXG4gICAgcmVuZGVyQ3NzOiBmdW5jdGlvbiB2RG9jdW1lbnRSZW5kZXJDc3Mobm9SZW1vdmUpIHtcbiAgICAgIC8vIGFkZCBjdXN0b20gY3NzIHN0eWxlXG4gICAgICB2YXIgJGhlYWQgPSAkKFwiaGVhZFwiKSxcbiAgICAgICAgY3NzTGlua1RlbXBsYXRlID0gXy50ZW1wbGF0ZShcbiAgICAgICAgICAnPGxpbmsgcmVsPVwic3R5bGVzaGVldFwiIHR5cGU9XCJ0ZXh0L2Nzc1wiICcgK1xuICAgICAgICAgICAgJ2hyZWY9XCI8JT0gcGF0aCAlPlwiIGRhdGEtaWQ9XCI8JT0ga2V5ICU+XCIgZGF0YS12aWV3PVwidHJ1ZVwiPidcbiAgICAgICAgKSxcbiAgICAgICAgY3VzdG9tQ3NzID0gdGhpcy5tb2RlbC5nZXQoXCJjdXN0b21DU1NcIik7XG5cbiAgICAgIGlmIChub1JlbW92ZSAhPT0gdHJ1ZSkge1xuICAgICAgICAvL1JlbW92ZSBvbGQgQ1NTXG5cbiAgICAgICAgXy5lYWNoKCQoXCJsaW5rW2RhdGEtdmlldz10cnVlXVwiKSwgZnVuY3Rpb24gdkRvY3VtZW50UmVtb3ZlT2xkQ1NTKFxuICAgICAgICAgIGN1cnJlbnRMaW5rXG4gICAgICAgICkge1xuICAgICAgICAgIHZhciBmaW5kQ3NzID0gZnVuY3Rpb24gdkRvY3VtZW50RmluZENzcyhjdXJyZW50Q3NzKSB7XG4gICAgICAgICAgICByZXR1cm4gJChjdXJyZW50TGluaykuZGF0YShcImlkXCIpID09PSBjdXJyZW50Q3NzLmtleTtcbiAgICAgICAgICB9O1xuICAgICAgICAgIGlmIChfLmZpbmQoY3VzdG9tQ3NzLCBmaW5kQ3NzKSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAkKGN1cnJlbnRMaW5rKS5yZW1vdmUoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgLy8gSW5qZWN0IG5ldyBDU1NcbiAgICAgIF8uZWFjaChjdXN0b21Dc3MsIGZ1bmN0aW9uIHZEb2N1bWVudEluamVjdE5ld0NTUyhjc3NJdGVtKSB7XG4gICAgICAgIHZhciAkZXhpc3RzTGluayA9ICQoXG4gICAgICAgICAgXCJsaW5rW3JlbD1zdHlsZXNoZWV0XVtkYXRhLWlkPVwiICsgY3NzSXRlbS5rZXkgKyBcIl1cIlxuICAgICAgICApO1xuXG4gICAgICAgIGlmICgkZXhpc3RzTGluay5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICBpZiAoZG9jdW1lbnQuY3JlYXRlU3R5bGVTaGVldCkge1xuICAgICAgICAgICAgLy8gU3BlY2lhbCB0aGFua3MgdG8gSUUgOiAhIHVwIHRvIDMxIGNzcyBjYXVzZSBlcnJvcnMuLi5cbiAgICAgICAgICAgIGRvY3VtZW50LmNyZWF0ZVN0eWxlU2hlZXQoY3NzSXRlbS5wYXRoKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgJGhlYWQuYXBwZW5kKGNzc0xpbmtUZW1wbGF0ZShjc3NJdGVtKSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBTaG93IHRoZSBoZWxwIGRvY3VtZW50IGluIGRpYWxvZ1xuICAgICAqXG4gICAgICovXG4gICAgc2hvd0hlbHA6IGZ1bmN0aW9uIHZEb2N1bWVudFNob3dIZWxwKGV2ZW50LCBoZWxwSWQsIGF0dHJpZCkge1xuICAgICAgdmFyICRkb2N1bWVudCA9ICQodGhpcy5lbCk7XG4gICAgICB2YXIgc2NvcGUgPSB0aGlzO1xuICAgICAgdmFyICRkaWFsb2dEaXYgPSAkZG9jdW1lbnQuZGF0YShcImRjcEhlbHBEb2N1bWVudC1cIiArIGhlbHBJZCk7XG4gICAgICB2YXIgY3VycmVudFRhcmdldCA9IGV2ZW50Lm9yaWdpbmFsRXZlbnRcbiAgICAgICAgPyBldmVudC5vcmlnaW5hbEV2ZW50LmN1cnJlbnRUYXJnZXRcbiAgICAgICAgOiBldmVudC5jdXJyZW50VGFyZ2V0O1xuICAgICAgdmFyIGh0bWxMaW5rID0ge1xuICAgICAgICB0YXJnZXQ6IFwiX2RpYWxvZ1wiLFxuICAgICAgICB3aW5kb3dXaWR0aDogXCI0MDBweFwiLFxuICAgICAgICB3aW5kb3dIZWlnaHQ6IFwiMzAwcHhcIixcbiAgICAgICAgd2luZG93VGl0bGU6XG4gICAgICAgICAgJzxzcGFuIGNsYXNzPVwiZmEgZmEtcXVlc3Rpb24tY2lyY2xlXCI+PC9zcGFuPiAnICtcbiAgICAgICAgICBpMThuLl9fXyhcIkluZm9cIiwgXCJkZHVpXCIpXG4gICAgICB9O1xuXG4gICAgICByZXF1aXJlLmVuc3VyZShcbiAgICAgICAgW1wiZGNwRG9jdW1lbnQvZG9jdW1lbnRcIl0sXG4gICAgICAgIGZ1bmN0aW9uIHZEb2N1bWVudEhlbHAoKSB7XG4gICAgICAgICAgcmVxdWlyZShcImRjcERvY3VtZW50L2RvY3VtZW50XCIpO1xuICAgICAgICAgIHZhciBoZWxwWCwgaGVscFksIGJvZHlILCBkaWFsb2dILCBkaWFsb2dXO1xuXG4gICAgICAgICAgaWYgKCEkZGlhbG9nRGl2IHx8ICRkaWFsb2dEaXYuaXMoXCI6dmlzaWJsZVwiKSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgIGlmIChzY29wZS5oZWxwV2lkZ2V0KSB7XG4gICAgICAgICAgICAgIHNjb3BlLmhlbHBXaWRnZXQuZGVzdHJveSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJGRpYWxvZ0RpdiA9ICQoXCI8ZGl2Lz5cIikuYWRkQ2xhc3MoXCJkY3BIZWxwLXdyYXBwZXJcIik7XG5cbiAgICAgICAgICAgICRkaWFsb2dEaXYua2VuZG9XaW5kb3coe1xuICAgICAgICAgICAgICB3aWR0aDogaHRtbExpbmsud2luZG93V2lkdGgsXG4gICAgICAgICAgICAgIGhlaWdodDogaHRtbExpbmsud2luZG93SGVpZ2h0LFxuICAgICAgICAgICAgICBpZnJhbWU6IHRydWUsXG4gICAgICAgICAgICAgIGNvbnRlbnQ6IFwiYWJvdXQ6YmxhbmtcIixcbiAgICAgICAgICAgICAgYWN0aW9uczogW1wiTWF4aW1pemVcIiwgXCJDbG9zZVwiXSxcbiAgICAgICAgICAgICAgY2xvc2U6IGZ1bmN0aW9uIHZEb2N1bWVudFNlbGVjdEhlbHBDbG9zZSgpIHtcbiAgICAgICAgICAgICAgICAkKFwiLmRjcExhYmVsX19oZWxwX19saW5rLS1zZWxlY3RlZFwiKS5yZW1vdmVDbGFzcyhcbiAgICAgICAgICAgICAgICAgIFwiZGNwTGFiZWxfX2hlbHBfX2xpbmstLXNlbGVjdGVkXCJcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgJGRpYWxvZ0RpdlxuICAgICAgICAgICAgICAuY2xvc2VzdChcIi5rLXdpbmRvd1wiKVxuICAgICAgICAgICAgICAuZmluZChcIi5rLXdpbmRvdy10aXRsZVwiKVxuICAgICAgICAgICAgICAuaHRtbChodG1sTGluay53aW5kb3dUaXRsZSk7XG4gICAgICAgICAgICAkZGlhbG9nRGl2Lm9uKFwiZG9jdW1lbnRjcmVhdGVcIiwgZnVuY3Rpb24gdkRvY3VtZW50SGVscENyZWF0ZSgpIHtcbiAgICAgICAgICAgICAgJGRpYWxvZ0Rpdi5maW5kKFwiPiBpZnJhbWVcIikuYWRkQ2xhc3MoXCJrLWNvbnRlbnQtZnJhbWVcIik7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgJGRpYWxvZ0RpdlxuICAgICAgICAgICAgICAuZG9jdW1lbnQoe1xuICAgICAgICAgICAgICAgIGluaXRpZDogaGVscElkLFxuICAgICAgICAgICAgICAgIHdpdGhvdXRSZXNpemU6IHRydWVcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgLm9uKFwiZG9jdW1lbnRsb2FkZWRcIiwgZnVuY3Rpb24gdkRvY3VtZW50U2VsZWN0SGVscENoYXB0ZXIoKSB7XG4gICAgICAgICAgICAgICAgXy5kZWZlcihmdW5jdGlvbiB2RG9jdW1lbnRIZWxwUmVhZHkoKSB7XG4gICAgICAgICAgICAgICAgICAkZGlhbG9nRGl2LmRvY3VtZW50KFxuICAgICAgICAgICAgICAgICAgICBcInRyaWdnZXJFdmVudFwiLFxuICAgICAgICAgICAgICAgICAgICBcImN1c3RvbTpoZWxwcGFnZVNlbGVjdFwiLFxuICAgICAgICAgICAgICAgICAgICBhdHRyaWRcbiAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAkZG9jdW1lbnQuZGF0YShcImRjcEhlbHBEb2N1bWVudC1cIiArIGhlbHBJZCwgJGRpYWxvZ0Rpdik7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICRkaWFsb2dEaXYuZG9jdW1lbnQoXG4gICAgICAgICAgICAgIFwidHJpZ2dlckV2ZW50XCIsXG4gICAgICAgICAgICAgIFwiY3VzdG9tOmhlbHBwYWdlU2VsZWN0XCIsXG4gICAgICAgICAgICAgIGF0dHJpZFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBzY29wZS5oZWxwV2lkZ2V0ID0gJGRpYWxvZ0Rpdi5kYXRhKFwia2VuZG9XaW5kb3dcIik7XG4gICAgICAgICAgJChcIi5kY3BMYWJlbF9faGVscF9fbGluay0tc2VsZWN0ZWRcIikucmVtb3ZlQ2xhc3MoXG4gICAgICAgICAgICBcImRjcExhYmVsX19oZWxwX19saW5rLS1zZWxlY3RlZFwiXG4gICAgICAgICAgKTtcblxuICAgICAgICAgIGlmICgkKGN1cnJlbnRUYXJnZXQpLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICQoY3VycmVudFRhcmdldCkuYWRkQ2xhc3MoXCJkY3BMYWJlbF9faGVscF9fbGluay0tc2VsZWN0ZWRcIik7XG5cbiAgICAgICAgICAgIC8vIENvbXB1dGUgbmV3IHBvc2l0aW9uIG9mIGhlbHAgZGlhbG9nIHdpbmRvd1xuICAgICAgICAgICAgaGVscFggPSAkKGN1cnJlbnRUYXJnZXQpLm9mZnNldCgpLmxlZnQ7XG4gICAgICAgICAgICBoZWxwWSA9ICQoY3VycmVudFRhcmdldCkub2Zmc2V0KCkudG9wO1xuICAgICAgICAgICAgYm9keUggPSAkKFwiYm9keVwiKS5oZWlnaHQoKTtcbiAgICAgICAgICAgIGRpYWxvZ0ggPSAkKHNjb3BlLmhlbHBXaWRnZXQud3JhcHBlcilcbiAgICAgICAgICAgICAgLmNsb3Nlc3QoXCIuay13aW5kb3dcIilcbiAgICAgICAgICAgICAgLmhlaWdodCgpO1xuICAgICAgICAgICAgZGlhbG9nVyA9ICQoc2NvcGUuaGVscFdpZGdldC53cmFwcGVyKVxuICAgICAgICAgICAgICAuY2xvc2VzdChcIi5rLXdpbmRvd1wiKVxuICAgICAgICAgICAgICAud2lkdGgoKTtcbiAgICAgICAgICAgIGlmIChoZWxwWCA+IGRpYWxvZ1cgKyA1MCkge1xuICAgICAgICAgICAgICBoZWxwWCA9IGhlbHBYIC0gZGlhbG9nVyAtIDMwO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgaGVscFggPSBoZWxwWCArIDMwO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoaGVscFkgPiBib2R5SCAtIGRpYWxvZ0gpIHtcbiAgICAgICAgICAgICAgaGVscFkgPSBib2R5SCAtIGRpYWxvZ0ggLSA1MDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaGVscFkgPSBoZWxwWSA8IDAgPyAwIDogaGVscFk7XG5cbiAgICAgICAgICAgICQoc2NvcGUuaGVscFdpZGdldC53cmFwcGVyKS5jc3Moe1xuICAgICAgICAgICAgICB0b3A6IGhlbHBZICsgXCJweFwiLFxuICAgICAgICAgICAgICBsZWZ0OiBoZWxwWCArIFwicHhcIlxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHNjb3BlLmhlbHBXaWRnZXQuY2VudGVyKCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHNjb3BlLmhlbHBXaWRnZXQub3BlbigpO1xuICAgICAgICB9LFxuICAgICAgICBcIndEb2N1bWVudFwiXG4gICAgICApO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBTaG93IHRoZSBoaXN0b3J5IHdpZGdldFxuICAgICAqXG4gICAgICovXG4gICAgc2hvd0hpc3Rvcnk6IGZ1bmN0aW9uIHZEb2N1bWVudFNob3dIaXN0b3J5KGRvY2lkKSB7XG4gICAgICB2YXIgc2NvcGUgPSB0aGlzO1xuICAgICAgdmFyICR0YXJnZXQgPSAkKCc8ZGl2IGNsYXNzPVwiZG9jdW1lbnQtaGlzdG9yeVwiLz4nKTtcbiAgICAgIHRoaXMuaGlzdG9yeVdpZGdldCA9ICR0YXJnZXRcbiAgICAgICAgLmRjcERvY3VtZW50SGlzdG9yeSh7XG4gICAgICAgICAgZG9jdW1lbnRJZDogZG9jaWQgfHwgdGhpcy5tb2RlbC5nZXQoXCJwcm9wZXJ0aWVzXCIpLmdldChcImluaXRpZFwiKSxcbiAgICAgICAgICB3aW5kb3c6IHtcbiAgICAgICAgICAgIHdpZHRoOiBcIjgwJVwiLFxuICAgICAgICAgICAgaGVpZ2h0OiBcIjgwJVwiLFxuICAgICAgICAgICAgdGl0bGU6IGkxOG4uX19fKFwiRG9jdW1lbnQgSGlzdG9yeVwiLCBcImhpc3RvcnlVaVwiKVxuICAgICAgICAgIH0sXG4gICAgICAgICAgbGFiZWxzOiB7XG4gICAgICAgICAgICB2ZXJzaW9uOiBpMThuLl9fXyhcIlZlcnNpb25cIiwgXCJoaXN0b3J5VWlcIiksXG4gICAgICAgICAgICByZXZpc2lvbjogaTE4bi5fX18oXCJSZXZcIiwgXCJoaXN0b3J5VWlcIiksXG4gICAgICAgICAgICBzdGF0ZTogaTE4bi5fX18oXCJTdGF0ZVwiLCBcImhpc3RvcnlVaVwiKSxcbiAgICAgICAgICAgIGFjdGl2aXR5OiBpMThuLl9fXyhcIkFjdGl2aXR5XCIsIFwiaGlzdG9yeVVpXCIpLFxuICAgICAgICAgICAgb3duZXI6IGkxOG4uX19fKFwiT3duZXJcIiwgXCJoaXN0b3J5VWlcIiksXG4gICAgICAgICAgICBjb2RlOiBpMThuLl9fXyhcIkNvZGVcIiwgXCJoaXN0b3J5VWlcIiksXG4gICAgICAgICAgICBkYXRlOiBpMThuLl9fXyhcIkRhdGVcIiwgXCJoaXN0b3J5VWlcIiksXG4gICAgICAgICAgICBkaWZmOiBpMThuLl9fXyhcIkRpZmZcIiwgXCJoaXN0b3J5VWlcIiksXG4gICAgICAgICAgICBsZXZlbDogaTE4bi5fX18oXCJMZXZlbFwiLCBcImhpc3RvcnlVaVwiKSxcbiAgICAgICAgICAgIG1lc3NhZ2U6IGkxOG4uX19fKFwiTWVzc2FnZVwiLCBcImhpc3RvcnlVaVwiKSxcbiAgICAgICAgICAgIHBhc3RSZXZpc2lvbjogaTE4bi5fX18oXCJwYXN0IFJldmlzaW9uXCIsIFwiaGlzdG9yeVVpXCIpLFxuICAgICAgICAgICAgc2hvd0RldGFpbDogaTE4bi5fX18oXCJTaG93IGRldGFpbHNcIiwgXCJoaXN0b3J5VWlcIiksXG4gICAgICAgICAgICBoaWRlRGV0YWlsOiBpMThuLl9fXyhcIkhpZGUgZGV0YWlsc1wiLCBcImhpc3RvcnlVaVwiKSxcbiAgICAgICAgICAgIHNob3dOb3RpY2U6IGkxOG4uX19fKFwiU2hvdyBub3RpY2VzXCIsIFwiaGlzdG9yeVVpXCIpLFxuICAgICAgICAgICAgbm9PbmVOb3RpY2U6IGkxOG4uX19fKFwiTm8gb25lIG5vdGljZXNcIiwgXCJoaXN0b3J5VWlcIiksXG4gICAgICAgICAgICBoaWRlTm90aWNlOiBpMThuLl9fXyhcIkhpZGUgbm90aWNlc1wiLCBcImhpc3RvcnlVaVwiKSxcbiAgICAgICAgICAgIGZpbHRlck1lc3NhZ2VzOiBpMThuLl9fXyhcIkZpbHRlciBtZXNzYWdlc1wiLCBcImhpc3RvcnlVaVwiKSxcbiAgICAgICAgICAgIGxpbmtSZXZpc2lvbjogaTE4bi5fX18oXCJTZWUgcmV2aXNpb24gbnVtYmVyICNcIiwgXCJoaXN0b3J5VWlcIiksXG4gICAgICAgICAgICBoaXN0b3J5VGl0bGU6IGkxOG4uX19fKFwiSGlzdG9yeSBmb3Ige3t0aXRsZX19XCIsIFwiaGlzdG9yeVVpXCIpLFxuICAgICAgICAgICAgbG9hZGluZzogaTE4bi5fX18oXCJMb2FkaW5nIC4uLlwiLCBcImhpc3RvcnlVaVwiKSxcbiAgICAgICAgICAgIHJldmlzaW9uRGlmZkxhYmVsczoge1xuICAgICAgICAgICAgICB0aXRsZTogaTE4bi5fX18oXG4gICAgICAgICAgICAgICAgXCJEaWZmZXJlbmNlIGJldHdlZW4gdHdvIHJldmlzaW9uc1wiLFxuICAgICAgICAgICAgICAgIFwiaGlzdG9yeURpZmZVaVwiXG4gICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgIGZpcnN0OiBpMThuLl9fXyhcIkZpcnN0IGRvY3VtZW50XCIsIFwiaGlzdG9yeURpZmZVaVwiKSxcbiAgICAgICAgICAgICAgc2Vjb25kOiBpMThuLl9fXyhcIlNlY29uZCBkb2N1bWVudFwiLCBcImhpc3RvcnlEaWZmVWlcIiksXG4gICAgICAgICAgICAgIGF0dHJpYnV0ZUlkOiBpMThuLl9fXyhcIkF0dHJpYnV0ZSBpZFwiLCBcImhpc3RvcnlEaWZmVWlcIiksXG4gICAgICAgICAgICAgIGF0dHJpYnV0ZUxhYmVsOiBpMThuLl9fXyhcIkF0dHJpYnV0ZSBsYWJlbFwiLCBcImhpc3RvcnlEaWZmVWlcIiksXG4gICAgICAgICAgICAgIGRvY3VtZW50SGVhZGVyOiBpMThuLl9fXyhcbiAgICAgICAgICAgICAgICBcInt7dGl0bGV9fSAgKFJldmlzaW9uIDoge3tyZXZpc2lvbn19KS4gPGJyLz5DcmVhdGVkIG9uIDxlbT57e21kYXRlfX08L2VtPlwiLFxuICAgICAgICAgICAgICAgIFwiaGlzdG9yeURpZmZVaVwiXG4gICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgIGZpbHRlck1lc3NhZ2VzOiBpMThuLl9fXyhcIkZpbHRlciBkYXRhXCIsIFwiaGlzdG9yeURpZmZVaVwiKSxcbiAgICAgICAgICAgICAgc2hvd09ubHlEaWZmOiBpMThuLl9fXyhcIlNob3cgb25seSBkaWZmZXJlbmNlc1wiLCBcImhpc3RvcnlEaWZmVWlcIiksXG4gICAgICAgICAgICAgIHNob3dBbGw6IGkxOG4uX19fKFwiU2hvdyBhbGxcIiwgXCJoaXN0b3J5RGlmZlVpXCIpXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgICAuZGF0YShcImRjcERvY3VtZW50SGlzdG9yeVwiKTtcblxuICAgICAgdGhpcy5oaXN0b3J5V2lkZ2V0Lm9wZW4oKTtcbiAgICAgIHRoaXMuaGlzdG9yeVdpZGdldC5lbGVtZW50Lm9uKFxuICAgICAgICBcInZpZXdSZXZpc2lvblwiLFxuICAgICAgICBmdW5jdGlvbiB2RG9jdW1lbnRWaWV3UmV2aXNpb24oZXZlbnQsIGRhdGEpIHtcbiAgICAgICAgICBzY29wZS5tb2RlbC5mZXRjaERvY3VtZW50KHtcbiAgICAgICAgICAgIGluaXRpZDogZGF0YS5pbml0aWQsXG4gICAgICAgICAgICByZXZpc2lvbjogZGF0YS5yZXZpc2lvblxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICApO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBMb2NrIGRvY3VtZW50XG4gICAgICpcbiAgICAgKi9cbiAgICBsb2NrRG9jdW1lbnQ6IGZ1bmN0aW9uIHZEb2N1bWVudExvY2tEb2N1bWVudCgpIHtcbiAgICAgIHRoaXMubW9kZWwubG9ja0RvY3VtZW50KCk7XG4gICAgfSxcbiAgICAvKipcbiAgICAgKiBMb2NrIGRvY3VtZW50XG4gICAgICpcbiAgICAgKi9cbiAgICB1bmxvY2tEb2N1bWVudDogZnVuY3Rpb24gdkRvY3VtZW50VW5Mb2NrRG9jdW1lbnQoKSB7XG4gICAgICB0aGlzLm1vZGVsLnVubG9ja0RvY3VtZW50KCk7XG4gICAgfSxcbiAgICAvKipcbiAgICAgKiBTaG93IHRoZSB0cmFuc2l0aW9uIHZpZXdcbiAgICAgKlxuICAgICAqL1xuICAgIHNob3d0cmFuc2l0aW9uOiBmdW5jdGlvbiB2RG9jdW1lbnRTaG93dHJhbnNpdGlvbih0cmFuc2l0aW9uLCBuZXh0U3RhdGUpIHtcbiAgICAgIHRoaXMubW9kZWwudHJpZ2dlcihcInNob3dUcmFuc2l0aW9uXCIsIG5leHRTdGF0ZSwgdHJhbnNpdGlvbik7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIFNob3cgdGhlIHRyYW5zaXRpb24gdmlld1xuICAgICAqXG4gICAgICovXG4gICAgc2hvd1RyYW5zaXRpb25HcmFwaDogZnVuY3Rpb24gdkRvY3VtZW50U2hvd3RyYW5zaXRpb25HcmFwaCgpIHtcbiAgICAgIHZhciBkb2N1bWVudFZpZXcgPSB0aGlzO1xuICAgICAgdmFyIHRyYW5zaXRpb25HcmFwaCA9IHt9O1xuICAgICAgdmFyICR0YXJnZXQgPSAkKCc8ZGl2IGNsYXNzPVwiZGNwVHJhbnNpdGlvbkdyYXBoXCIvPicpO1xuICAgICAgLy9Jbml0IHRyYW5zaXRpb24gbW9kZWxcbiAgICAgIHRyYW5zaXRpb25HcmFwaC5tb2RlbCA9IG5ldyBNb2RlbFRyYW5zaXRpb25HcmFwaCh7XG4gICAgICAgIGRvY3VtZW50SWQ6IHRoaXMubW9kZWwuaWQsXG4gICAgICAgIHN0YXRlOiB0aGlzLm1vZGVsLmdldChcInByb3BlcnRpZXNcIikuZ2V0KFwic3RhdGVcIilcbiAgICAgIH0pO1xuXG4gICAgICB0cmFuc2l0aW9uR3JhcGgubW9kZWwuZmV0Y2goe1xuICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiB2RG9jdW1lbnRUcmFuc2l0aW9uU3VjY2VzcygpIHtcbiAgICAgICAgICAvL0luaXQgdHJhbnNpdGlvbiB2aWV3XG4gICAgICAgICAgdHJhbnNpdGlvbkdyYXBoLnZpZXcgPSBuZXcgVmlld1RyYW5zaXRpb25HcmFwaCh7XG4gICAgICAgICAgICBtb2RlbDogdHJhbnNpdGlvbkdyYXBoLm1vZGVsLFxuICAgICAgICAgICAgZWw6ICR0YXJnZXRcbiAgICAgICAgICB9KTtcbiAgICAgICAgICB0cmFuc2l0aW9uR3JhcGgudmlldy5yZW5kZXIoKTtcbiAgICAgICAgICB0cmFuc2l0aW9uR3JhcGgudmlldy4kZWwub24oXG4gICAgICAgICAgICBcInZpZXdUcmFuc2l0aW9uXCIsXG4gICAgICAgICAgICBmdW5jdGlvbiB2RG9jdW1lbnRUcmFuc2l0aW9uVmlldyhldmVudCwgbmV4dFN0YXRlKSB7XG4gICAgICAgICAgICAgIHRyYW5zaXRpb25HcmFwaC52aWV3LnJlbW92ZSgpO1xuICAgICAgICAgICAgICBkb2N1bWVudFZpZXcubW9kZWwudHJpZ2dlcihcInNob3dUcmFuc2l0aW9uXCIsIG5leHRTdGF0ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIHRoaXMudHJhbnNpdGlvbkdyYXBoID0gdHJhbnNpdGlvbkdyYXBoO1xuICAgIH0sXG4gICAgLyoqXG4gICAgICogU2hvdyB0aGUgcHJvcGVydGllcyB3aWRnZXRcbiAgICAgKlxuICAgICAqL1xuICAgIHNob3dQcm9wZXJ0aWVzOiBmdW5jdGlvbiB2RG9jdW1lbnRTaG93UHJvcGVydGllcyhkb2NpZCkge1xuICAgICAgdmFyIHNjb3BlID0gdGhpcztcbiAgICAgIHZhciAkdGFyZ2V0ID0gJCgnPGRpdiBjbGFzcz1cImRvY3VtZW50LXByb3BlcnRpZXNcIi8+Jyk7XG5cbiAgICAgIHRoaXMucHJvcGVydGllc1dpZGdldCA9ICR0YXJnZXRcbiAgICAgICAgLmRjcERvY3VtZW50UHJvcGVydGllcyh7XG4gICAgICAgICAgZG9jdW1lbnRJZDogZG9jaWQgfHwgdGhpcy5tb2RlbC5nZXQoXCJwcm9wZXJ0aWVzXCIpLmdldChcImluaXRpZFwiKSxcbiAgICAgICAgICB3aW5kb3c6IHtcbiAgICAgICAgICAgIHdpZHRoOiBcIjUwMHB4XCIsXG4gICAgICAgICAgICBoZWlnaHQ6IFwiODAlXCIsXG4gICAgICAgICAgICB0aXRsZTogaTE4bi5fX18oXCJEb2N1bWVudCBwcm9wZXJ0aWVzXCIsIFwicHJvcGVydHlVaVwiKVxuICAgICAgICAgIH0sXG4gICAgICAgICAgbGFiZWxzOiB7XG4gICAgICAgICAgICBpZGVudGlmaWVyOiBpMThuLl9fXyhcIklkZW50aWZpZXJcIiwgXCJwcm9wZXJ0eVVpXCIpLFxuICAgICAgICAgICAgdGl0bGU6IGkxOG4uX19fKFwiVGl0bGVcIiwgXCJwcm9wZXJ0eVVpXCIpLFxuICAgICAgICAgICAgbG9naWNhbE5hbWU6IGkxOG4uX19fKFwiTG9naWNhbCBuYW1lXCIsIFwicHJvcGVydHlVaVwiKSxcbiAgICAgICAgICAgIHJldmlzaW9uOiBpMThuLl9fXyhcIlJldmlzaW9uIG51bWJlclwiLCBcInByb3BlcnR5VWlcIiksXG4gICAgICAgICAgICB2ZXJzaW9uOiBpMThuLl9fXyhcIlZlcnNpb25cIiwgXCJwcm9wZXJ0eVVpXCIpLFxuICAgICAgICAgICAgZmFtaWx5OiBpMThuLl9fXyhcIkZhbWlseVwiLCBcInByb3BlcnR5VWlcIiksXG4gICAgICAgICAgICBsb2NrZWRCeTogaTE4bi5fX18oXCJMb2NrZWQgYnlcIiwgXCJwcm9wZXJ0eVVpXCIpLFxuICAgICAgICAgICAgY3JlYXRlZEJ5OiBpMThuLl9fXyhcIkNyZWF0ZWQgYnlcIiwgXCJwcm9wZXJ0eVVpXCIpLFxuICAgICAgICAgICAgbm90TG9ja2VkOiBpMThuLl9fXyhcIk5vdCBsb2NrZWRcIiwgXCJwcm9wZXJ0eVVpXCIpLFxuICAgICAgICAgICAgY29uZmlkZW50aWFsOiBpMThuLl9fXyhcIkNvbmZpZGVudGlhbFwiLCBcInByb3BlcnR5VWlcIiksXG4gICAgICAgICAgICBub3RDb25maWRlbnRpYWw6IGkxOG4uX19fKFwiTm90IGNvbmZpZGVudGlhbFwiLCBcInByb3BlcnR5VWlcIiksXG4gICAgICAgICAgICBjcmVhdGlvbkRhdGU6IGkxOG4uX19fKFwiQ3JlYXRpb24gZGF0ZVwiLCBcInByb3BlcnR5VWlcIiksXG4gICAgICAgICAgICBsYXN0TW9kaWZpY2F0aW9uRGF0ZTogaTE4bi5fX18oXG4gICAgICAgICAgICAgIFwiTGFzdCBtb2RpZmljYXRpb24gZGF0ZVwiLFxuICAgICAgICAgICAgICBcInByb3BlcnR5VWlcIlxuICAgICAgICAgICAgKSxcbiAgICAgICAgICAgIHByb2ZpbDogaTE4bi5fX18oXCJQcm9maWxcIiwgXCJwcm9wZXJ0eVVpXCIpLFxuICAgICAgICAgICAgcHJvZmlsUmVmZXJlbmNlOiBpMThuLl9fXyhcIlByb2ZpbCByZWZlcmVuY2VcIiwgXCJwcm9wZXJ0eVVpXCIpLFxuICAgICAgICAgICAgdmlld0NvbnRyb2xsZXI6IGkxOG4uX19fKFwiVmlldyBjb250cm9sbGVyXCIsIFwicHJvcGVydHlVaVwiKSxcbiAgICAgICAgICAgIHByb3BlcnR5OiBpMThuLl9fXyhcIlByb3BlcnR5XCIsIFwicHJvcGVydHlVaVwiKSxcbiAgICAgICAgICAgIHByb3BlcnRpZXNUaXRsZTogaTE4bi5fX18oXCJQcm9wZXJ0aWVzIGZvciB7e3RpdGxlfX1cIiwgXCJwcm9wZXJ0eVVpXCIpLFxuICAgICAgICAgICAgcHJvcGVydHlWYWx1ZTogaTE4bi5fX18oXCJWYWx1ZVwiLCBcInByb3BlcnR5VWlcIiksXG4gICAgICAgICAgICB3b3JrZmxvdzogaTE4bi5fX18oXCJXb3JrZmxvd1wiLCBcInByb3BlcnR5VWlcIiksXG4gICAgICAgICAgICBhY3Rpdml0eTogaTE4bi5fX18oXCJBY3Rpdml0eVwiLCBcInByb3BlcnR5VWlcIilcbiAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICAgIC5kYXRhKFwiZGNwRG9jdW1lbnRQcm9wZXJ0aWVzXCIpO1xuXG4gICAgICB0aGlzLnByb3BlcnRpZXNXaWRnZXQub3BlbigpO1xuICAgICAgdGhpcy5wcm9wZXJ0aWVzV2lkZ2V0LmVsZW1lbnQub24oXG4gICAgICAgIFwidmlld0RvY3VtZW50XCIsXG4gICAgICAgIGZ1bmN0aW9uIHZEb2N1bWVudFZpZXdEb2N1bWVudChldmVudCwgZGF0YSkge1xuICAgICAgICAgIHNjb3BlLm1vZGVsLmZldGNoRG9jdW1lbnQoeyBpbml0aWQ6IGRhdGEgfSk7XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIFVwZGF0ZSB0aGUgdGl0bGUgb2YgdGhlIGN1cnJlbnQgcGFnZVxuICAgICAqL1xuICAgIHVwZGF0ZVRpdGxlOiBmdW5jdGlvbiB2RG9jdW1lbnRVcGRhdGVUaXRsZSgpIHtcbiAgICAgIHZhciB0aXRsZSA9IHRoaXMubW9kZWwuZ2V0KFwicHJvcGVydGllc1wiKS5nZXQoXCJ0aXRsZVwiKTtcblxuICAgICAgaWYgKCFfLmlzRW1wdHkodGl0bGUpKSB7XG4gICAgICAgIGRvY3VtZW50LnRpdGxlID0gdGl0bGU7XG4gICAgICB9XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIFVwZGF0ZSB0aGUgaWNvbiBvZiB0aGUgY3VycmVudCBwYWdlXG4gICAgICovXG4gICAgdXBkYXRlSWNvbjogZnVuY3Rpb24gdkRvY3VtZW50VXBkYXRlSWNvbigpIHtcbiAgICAgICQoXCJsaW5rW3JlbD0nc2hvcnRjdXQgaWNvbiddXCIpLmF0dHIoXG4gICAgICAgIFwiaHJlZlwiLFxuICAgICAgICB0aGlzLm1vZGVsLmdldChcInByb3BlcnRpZXNcIikuZ2V0KFwiaWNvblwiKVxuICAgICAgKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogRGVsZXRlIHRoZSBjdXJyZW50IGRvY3VtZW50XG4gICAgICpcbiAgICAgKi9cbiAgICBkZWxldGVEb2N1bWVudDogZnVuY3Rpb24gZHZEb2N1bWVudERvY3VtZW50RGVsZXRlKCkge1xuICAgICAgdGhpcy5tb2RlbC5kZWxldGVEb2N1bWVudCgpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBEaXNwbGF5IHRoZSBsb2FkaW5nIHdpZGdldFxuICAgICAqL1xuICAgIGRpc3BsYXlMb2FkaW5nOiBmdW5jdGlvbiB2RG9jdW1lbnREaXNwbGF5TG9hZGluZyhvcHRpb25zKSB7XG4gICAgICB2YXIgdGV4dCA9IGkxOG4uX19fKFwiTG9hZGluZ1wiLCBcImRkdWlcIiksXG4gICAgICAgIGF2YW5jZSA9IDUwO1xuICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG4gICAgICBpZiAodGhpcy4kZWwuZmluZChcIi5kY3BEb2N1bWVudC0tZGlzYWJsZWRcIikgPT09IDApIHtcbiAgICAgICAgdGhpcy4kZWwuYXBwZW5kKCc8ZGl2IGNsYXNzPVwiZGNwRG9jdW1lbnQtLWRpc2FibGVkXCIvPicpO1xuICAgICAgfVxuICAgICAgaWYgKG9wdGlvbnMuaXNTYXZpbmcpIHtcbiAgICAgICAgdGV4dCA9IGkxOG4uX19fKFwiUmVjb3JkaW5nXCIsIFwiZGR1aVwiKTtcbiAgICAgICAgYXZhbmNlID0gNzA7XG4gICAgICB9XG4gICAgICBpZiAob3B0aW9ucy50ZXh0KSB7XG4gICAgICAgIHRleHQgPSBvcHRpb25zLnRleHQ7XG4gICAgICB9XG4gICAgICB0aGlzLnRyaWdnZXIoXCJjbGVhbk5vdGlmaWNhdGlvblwiKTtcbiAgICAgIHRoaXMudHJpZ2dlcihcImxvYWRlclNob3dcIiwgdGV4dCwgYXZhbmNlKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogU2hvdyB0aGUgdmlld1xuICAgICAqXG4gICAgICogSGlkZSB0aGUgbG9hZGVyLCBzaG93IHRoZSB2aWV3XG4gICAgICovXG4gICAgc2hvd1ZpZXc6IGZ1bmN0aW9uIHZEb2N1bWVudFNob3dWaWV3KCkge1xuICAgICAgdGhpcy4kZWwuaGlkZSgpO1xuICAgICAgdGhpcy4kZWwuZmluZChcIi5kY3BEb2N1bWVudC0tZGlzYWJsZWRcIikucmVtb3ZlKCk7XG4gICAgICB0aGlzLnRyaWdnZXIoXCJsb2FkZXJIaWRlXCIpO1xuICAgICAgdGhpcy4kZWwuc2hvdygpO1xuICAgICAgdGhpcy5yZWRyYXdUb290aXBzKCk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIFN3aXRjaCB0aGUgdmlld1xuICAgICAqXG4gICAgICogQHBhcmFtIHZpZXdJZFxuICAgICAqL1xuICAgIGNsb3NlRG9jdW1lbnQ6IGZ1bmN0aW9uIHZEb2N1bWVudENsb3NlRG9jdW1lbnQodmlld0lkKSB7XG4gICAgICBpZiAoIXZpZXdJZCkge1xuICAgICAgICBpZiAodGhpcy5tb2RlbC5nZXQoXCJyZW5kZXJNb2RlXCIpID09PSBcImVkaXRcIikge1xuICAgICAgICAgIHZpZXdJZCA9IFwiIWRlZmF1bHRFZGl0aW9uXCI7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdmlld0lkID0gXCIhZGVmYXVsdENvbnN1bHRhdGlvblwiO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICB0aGlzLmxvYWREb2N1bWVudCh7XG4gICAgICAgIGluaXRpZDogdGhpcy5tb2RlbC5nZXQoXCJpbml0aWRcIiksXG4gICAgICAgIHZpZXdJZDogdmlld0lkXG4gICAgICB9KTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogU2F2ZSB0aGUgY3VycmVudCBkb2N1bWVudFxuICAgICAqL1xuICAgIHNhdmVEb2N1bWVudDogZnVuY3Rpb24gdkRvY3VtZW50U2F2ZURvY3VtZW50KCkge1xuICAgICAgdGhpcy50cmlnZ2VyKFwiY2xlYW5Ob3RpZmljYXRpb25cIik7XG4gICAgICB2YXIgY3VycmVudFZpZXcgPSB0aGlzLFxuICAgICAgICBzYXZlRG9jdW1lbnQgPSB0aGlzLm1vZGVsLnNhdmVEb2N1bWVudCgpO1xuICAgICAgLy9Vc2UgcHJvbWlzZSBhbmQgZGlzcGxheSBzdWNjZXNzIHdoZW4gZG9uZVxuICAgICAgaWYgKHNhdmVEb2N1bWVudCAmJiBzYXZlRG9jdW1lbnQudGhlbikge1xuICAgICAgICBzYXZlRG9jdW1lbnQudGhlbihmdW5jdGlvbiB2RG9jdW1lbnRTYXZlRGlzcGxheVN1Y2Nlc3MoKSB7XG4gICAgICAgICAgY3VycmVudFZpZXcudHJpZ2dlcihcInNob3dTdWNjZXNzXCIsIHtcbiAgICAgICAgICAgIHRpdGxlOiBpMThuLl9fXyhcIkRvY3VtZW50IFJlY29yZGVkXCIsIFwiZGR1aVwiKVxuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogU2F2ZSBhbmQgY2xvc2UgdGhlIGN1cnJlbnQgZG9jdW1lbnRcbiAgICAgKi9cbiAgICBzYXZlQW5kQ2xvc2VEb2N1bWVudDogZnVuY3Rpb24gdkRvY3VtZW50U2F2ZUFuZENsb3NlRG9jdW1lbnQodmlld0lkKSB7XG4gICAgICB0aGlzLnRyaWdnZXIoXCJjbGVhbk5vdGlmaWNhdGlvblwiKTtcbiAgICAgIHZhciBjdXJyZW50VmlldyA9IHRoaXMsXG4gICAgICAgIHNhdmVEb2N1bWVudCA9IHRoaXMubW9kZWwuc2F2ZURvY3VtZW50KCk7XG4gICAgICBpZiAoc2F2ZURvY3VtZW50ICYmIHNhdmVEb2N1bWVudC50aGVuKSB7XG4gICAgICAgIHNhdmVEb2N1bWVudC50aGVuKGZ1bmN0aW9uIHZEb2N1bWVudFNhdmVBbmRDbG9zZVN1Y2Nlc3MoKSB7XG4gICAgICAgICAgdmFyIGluaXRpZCA9IGN1cnJlbnRWaWV3Lm1vZGVsLmdldChcImluaXRpZFwiKTtcblxuICAgICAgICAgIGN1cnJlbnRWaWV3Lm1vZGVsLmZldGNoRG9jdW1lbnQoe1xuICAgICAgICAgICAgaW5pdGlkOiBpbml0aWQsXG4gICAgICAgICAgICB2aWV3SWQ6IHZpZXdJZCB8fCBcIiFkZWZhdWx0Q29uc3VsdGF0aW9uXCJcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIENyZWF0ZSB0aGUgY3VycmVudCBkb2N1bWVudFxuICAgICAqL1xuICAgIGNyZWF0ZURvY3VtZW50OiBmdW5jdGlvbiB2RG9jdW1lbnRDcmVhdGVEb2N1bWVudCgpIHtcbiAgICAgIHZhciBjdXJyZW50VmlldyA9IHRoaXMsXG4gICAgICAgIHNhdmVEb2N1bWVudCA9IHRoaXMubW9kZWwuc2F2ZURvY3VtZW50KCk7XG4gICAgICBpZiAoc2F2ZURvY3VtZW50ICYmIHNhdmVEb2N1bWVudC50aGVuKSB7XG4gICAgICAgIHNhdmVEb2N1bWVudC50aGVuKGZ1bmN0aW9uIHZEb2N1bWVudENyZWF0ZURpc3BsYXlTdWNjZXNzKCkge1xuICAgICAgICAgIGN1cnJlbnRWaWV3LnRyaWdnZXIoXCJzaG93U3VjY2Vzc1wiLCB7XG4gICAgICAgICAgICB0aXRsZTogaTE4bi5fX18oXCJEb2N1bWVudCBDcmVhdGVkXCIsIFwiZGR1aVwiKVxuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlIHRoZSBjdXJyZW50IGRvY3VtZW50XG4gICAgICovXG4gICAgY3JlYXRlQW5kQ2xvc2VEb2N1bWVudDogZnVuY3Rpb24gdkRvY3VtZW50Q3JlYXRlRG9jdW1lbnQodmlld0lkKSB7XG4gICAgICB2YXIgY3VycmVudFZpZXcgPSB0aGlzLFxuICAgICAgICBzYXZlRG9jdW1lbnQgPSB0aGlzLm1vZGVsLnNhdmVEb2N1bWVudCgpO1xuICAgICAgaWYgKHNhdmVEb2N1bWVudCAmJiBzYXZlRG9jdW1lbnQudGhlbikge1xuICAgICAgICBzYXZlRG9jdW1lbnQudGhlbihmdW5jdGlvbiB2RG9jdW1lbnRDcmVhdGVBbmRDbG9zZVN1Y2Nlc3MoKSB7XG4gICAgICAgICAgdmFyIGluaXRpZCA9IGN1cnJlbnRWaWV3Lm1vZGVsLmdldChcImluaXRpZFwiKTtcblxuICAgICAgICAgIGN1cnJlbnRWaWV3Lm1vZGVsLmZldGNoRG9jdW1lbnQoe1xuICAgICAgICAgICAgaW5pdGlkOiBpbml0aWQsXG4gICAgICAgICAgICB2aWV3SWQ6IHZpZXdJZCB8fCBcIiFkZWZhdWx0Q29uc3VsdGF0aW9uXCJcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIGxvYWQgYW5vdGhlciBkb2N1bWVudCBkb2N1bWVudCAgOiBjb25maXJtIGlmIG1vZGlmaWVkXG4gICAgICogb3B0aW9ucyA6IHtpbml0aWQsIHZpZXdJZCwgcmV2aXNpb259XG4gICAgICogY2FsbGJhY2tzIDoge3N1Y2Nlc3MsIGVycm9yfVxuICAgICAqL1xuICAgIGxvYWREb2N1bWVudDogZnVuY3Rpb24gdkRvY3VtZW50TG9hZERvY3VtZW50KG9wdGlvbnMsIGNhbGxiYWNrcykge1xuICAgICAgdmFyIGNvbmZpcm1XaW5kb3c7XG4gICAgICB2YXIgZG9jdW1lbnRWaWV3ID0gdGhpcztcblxuICAgICAgY2FsbGJhY2tzID0gY2FsbGJhY2tzIHx8IHt9O1xuXG4gICAgICBpZiAodGhpcy5tb2RlbC5oYXNBdHRyaWJ1dGVzQ2hhbmdlZCgpKSB7XG4gICAgICAgIGNvbmZpcm1XaW5kb3cgPSAkKFwiYm9keVwiKS5kY3BDb25maXJtKHtcbiAgICAgICAgICB0aXRsZTogaTE4bi5fX18oXCJDb25maXJtIGNsb3NlIGRvY3VtZW50XCIsIFwiZGR1aVwiKSxcbiAgICAgICAgICB3aWR0aDogXCI0NXJlbVwiLFxuICAgICAgICAgIGhlaWdodDogXCIxMnJlbVwiLFxuICAgICAgICAgIG1heFdpZHRoOiAkKHdpbmRvdykud2lkdGgoKSxcbiAgICAgICAgICBtZXNzYWdlczoge1xuICAgICAgICAgICAgb2tNZXNzYWdlOiBpMThuLl9fXyhcIkFib3J0IG1vZGlmaWNhdGlvblwiLCBcImRkdWlcIiksXG4gICAgICAgICAgICBjYW5jZWxNZXNzYWdlOiBpMThuLl9fXyhcIlN0YXkgb24gdGhlIGZvcm1cIiwgXCJkZHVpXCIpLFxuICAgICAgICAgICAgaHRtbE1lc3NhZ2U6IGkxOG4uX19fKFxuICAgICAgICAgICAgICBcIlRoZSBmb3JtIGhhcyBiZWVuIG1vZGlmaWVkIHdpdGhvdXQgc2F2aW5nXCIsXG4gICAgICAgICAgICAgIFwiZGR1aVwiXG4gICAgICAgICAgICApLFxuICAgICAgICAgICAgdGV4dE1lc3NhZ2U6IFwiXCJcbiAgICAgICAgICB9LFxuICAgICAgICAgIGNvbmZpcm06IGZ1bmN0aW9uIHdNZW51Q29uZmlybSgpIHtcbiAgICAgICAgICAgIGRvY3VtZW50Vmlldy5tb2RlbFxuICAgICAgICAgICAgICAuZmV0Y2hEb2N1bWVudCh7XG4gICAgICAgICAgICAgICAgaW5pdGlkOiBvcHRpb25zLmluaXRpZCxcbiAgICAgICAgICAgICAgICB2aWV3SWQ6IG9wdGlvbnMudmlld0lkLFxuICAgICAgICAgICAgICAgIHJldmlzaW9uOiBvcHRpb25zLnJldmlzaW9uXG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgIC50aGVuKGNhbGxiYWNrcy5zdWNjZXNzLCBjYWxsYmFja3MuZXJyb3IpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgY2FuY2VsOiBmdW5jdGlvbiB3TG9hZENhbmNlbCgpIHtcbiAgICAgICAgICAgIGlmIChjYWxsYmFja3MgJiYgXy5pc0Z1bmN0aW9uKGNhbGxiYWNrcy5lcnJvcikpIHtcbiAgICAgICAgICAgICAgY2FsbGJhY2tzLmVycm9yKHtcbiAgICAgICAgICAgICAgICBlcnJvck1lc3NhZ2U6IHtcbiAgICAgICAgICAgICAgICAgIGNvZGU6IFwiVVNFUkNBTkNFTFwiLFxuICAgICAgICAgICAgICAgICAgY29udGVudFRleHQ6IGkxOG4uX19fKFxuICAgICAgICAgICAgICAgICAgICBcIlVzZXIgaGFzIGNhbmNlbGxlZCB0aGUgYWN0aW9uLlwiLFxuICAgICAgICAgICAgICAgICAgICBcImRkdWlcIlxuICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICB0ZW1wbGF0ZURhdGE6IHsgdGVtcGxhdGVzOiB0aGlzLm1vZGVsLmdldChcInRlbXBsYXRlc1wiKSB9XG4gICAgICAgIH0pO1xuICAgICAgICBjb25maXJtV2luZG93LmRhdGEoXCJkY3BXaW5kb3dcIikub3BlbigpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5tb2RlbFxuICAgICAgICAgIC5mZXRjaERvY3VtZW50KHtcbiAgICAgICAgICAgIGluaXRpZDogb3B0aW9ucy5pbml0aWQsXG4gICAgICAgICAgICB2aWV3SWQ6IG9wdGlvbnMudmlld0lkLFxuICAgICAgICAgICAgcmV2aXNpb246IG9wdGlvbnMucmV2aXNpb25cbiAgICAgICAgICB9KVxuICAgICAgICAgIC50aGVuKGNhbGxiYWNrcy5zdWNjZXNzLCBjYWxsYmFja3MuZXJyb3IpO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBSZXN0b3JlIHRoZSBkZWxldGVkIGRvY3VtZW50XG4gICAgICpcbiAgICAgKiBAcmV0dXJucyB7ZXhwb3J0c31cbiAgICAgKi9cbiAgICByZXN0b3JlRG9jdW1lbnQ6IGZ1bmN0aW9uIHZEb2N1bWVudFJlc3RvcmVEb2N1bWVudCgpIHtcbiAgICAgIHRoaXMubW9kZWwucmVzdG9yZURvY3VtZW50KCk7XG4gICAgfSxcblxuICAgIHByb3BhZ2F0ZUFjdGlvbkNsaWNrOiBmdW5jdGlvbiB2RG9jdW1lbnRQcm9wYWdhdGVBY3Rpb25DbGljayhldmVudCkge1xuICAgICAgdmFyICR0YXJnZXQgPSAkKGV2ZW50LmN1cnJlbnRUYXJnZXQpLFxuICAgICAgICBhY3Rpb24sXG4gICAgICAgIG9wdGlvbnMsXG4gICAgICAgIGV2ZW50T3B0aW9ucyxcbiAgICAgICAgaW50ZXJuYWxFdmVudCA9IHtcbiAgICAgICAgICBwcmV2ZW50OiBmYWxzZVxuICAgICAgICB9O1xuXG4gICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgaWYgKGV2ZW50LnN0b3BQcm9wYWdhdGlvbikge1xuICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgIH1cblxuICAgICAgYWN0aW9uID0gJHRhcmdldC5kYXRhKFwiYWN0aW9uXCIpIHx8ICR0YXJnZXQuYXR0cihcImhyZWZcIik7XG4gICAgICBvcHRpb25zID0gYWN0aW9uLnN1YnN0cmluZyg4KS5zcGxpdChcIjpcIik7XG4gICAgICBldmVudE9wdGlvbnMgPSB7XG4gICAgICAgIHRhcmdldDogZXZlbnQudGFyZ2V0LFxuICAgICAgICBldmVudElkOiBvcHRpb25zLnNoaWZ0KCksXG4gICAgICAgIG9wdGlvbnM6IG9wdGlvbnNcbiAgICAgIH07XG5cbiAgICAgIHRoaXMubW9kZWwudHJpZ2dlcihcImludGVybmFsTGlua1NlbGVjdGVkXCIsIGludGVybmFsRXZlbnQsIGV2ZW50T3B0aW9ucyk7XG4gICAgICBpZiAoaW50ZXJuYWxFdmVudC5wcmV2ZW50KSB7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gdGhpcy5kb1N0YW5kYXJkQWN0aW9uKGludGVybmFsRXZlbnQsIGV2ZW50T3B0aW9ucyk7XG4gICAgfSxcblxuICAgIGhhbmRsZUhhc2hDbGljazogZnVuY3Rpb24gdkRvY3VtZW50aGFuZGxlSGFzaENsaWNrKGV2ZW50KSB7XG4gICAgICB2YXIgJHRhcmdldCA9ICQoZXZlbnQuY3VycmVudFRhcmdldCksXG4gICAgICAgIGhyZWYgPSAkdGFyZ2V0LmF0dHIoXCJocmVmXCIpO1xuXG4gICAgICBpZiAoIWhyZWYgfHwgIWhyZWYuc3Vic3RyaW5nIHx8IGhyZWYuc3Vic3RyaW5nKDAsIDcpID09PSBcIiNhY3Rpb25cIikge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBpZiAoZXZlbnQuc3RvcFByb3BhZ2F0aW9uKSB7XG4gICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgfVxuXG4gICAgICB3aW5kb3cubG9jYXRpb24uaGFzaCA9IGhyZWY7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIFByb3BhZ2F0ZSBtZW51IGV2ZW50XG4gICAgICp0ZXN0XG4gICAgICogQHBhcmFtIGV2ZW50XG4gICAgICogQHBhcmFtIG9wdGlvbnNcbiAgICAgKiBAcmV0dXJucyB7Kn1cbiAgICAgKi9cbiAgICBkb1N0YW5kYXJkQWN0aW9uOiBmdW5jdGlvbiB2RG9jdW1lbnRkb1N0YW5kYXJkQWN0aW9uKGV2ZW50LCBvcHRpb25zKSB7XG4gICAgICB2YXIgZXZlbnRBcmdzID0gb3B0aW9ucy5vcHRpb25zO1xuXG4gICAgICBpZiAob3B0aW9ucy5ldmVudElkID09PSBcImRvY3VtZW50LnNhdmVcIikge1xuICAgICAgICByZXR1cm4gdGhpcy5zYXZlRG9jdW1lbnQoKTtcbiAgICAgIH1cbiAgICAgIGlmIChvcHRpb25zLmV2ZW50SWQgPT09IFwiZG9jdW1lbnQuc2F2ZUFuZENsb3NlXCIpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2F2ZUFuZENsb3NlRG9jdW1lbnQoZXZlbnRBcmdzWzBdKTtcbiAgICAgIH1cbiAgICAgIGlmIChvcHRpb25zLmV2ZW50SWQgPT09IFwiZG9jdW1lbnQuaGlzdG9yeVwiKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNob3dIaXN0b3J5KGV2ZW50QXJnc1swXSk7XG4gICAgICB9XG4gICAgICBpZiAob3B0aW9ucy5ldmVudElkID09PSBcImRvY3VtZW50LnRyYW5zaXRpb25cIikge1xuICAgICAgICByZXR1cm4gdGhpcy5zaG93dHJhbnNpdGlvbihldmVudEFyZ3NbMF0sIGV2ZW50QXJnc1sxXSk7XG4gICAgICB9XG4gICAgICBpZiAob3B0aW9ucy5ldmVudElkID09PSBcImRvY3VtZW50LnRyYW5zaXRpb25HcmFwaFwiKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNob3dUcmFuc2l0aW9uR3JhcGgoKTtcbiAgICAgIH1cbiAgICAgIGlmIChvcHRpb25zLmV2ZW50SWQgPT09IFwiZG9jdW1lbnQucHJvcGVydGllc1wiKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNob3dQcm9wZXJ0aWVzKGV2ZW50QXJnc1swXSk7XG4gICAgICB9XG4gICAgICBpZiAob3B0aW9ucy5ldmVudElkID09PSBcImRvY3VtZW50LmRlbGV0ZVwiKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmRlbGV0ZURvY3VtZW50KCk7XG4gICAgICB9XG4gICAgICBpZiAob3B0aW9ucy5ldmVudElkID09PSBcImRvY3VtZW50LmNsb3NlXCIpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY2xvc2VEb2N1bWVudChldmVudEFyZ3NbMF0pO1xuICAgICAgfVxuICAgICAgaWYgKG9wdGlvbnMuZXZlbnRJZCA9PT0gXCJkb2N1bWVudC5lZGl0XCIpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY2xvc2VEb2N1bWVudChcIiFkZWZhdWx0RWRpdGlvblwiKTtcbiAgICAgIH1cbiAgICAgIGlmIChvcHRpb25zLmV2ZW50SWQgPT09IFwiZG9jdW1lbnQuY3JlYXRlXCIpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlRG9jdW1lbnQoKTtcbiAgICAgIH1cbiAgICAgIGlmIChvcHRpb25zLmV2ZW50SWQgPT09IFwiZG9jdW1lbnQuY3JlYXRlQW5kQ2xvc2VcIikge1xuICAgICAgICByZXR1cm4gdGhpcy5jcmVhdGVBbmRDbG9zZURvY3VtZW50KGV2ZW50QXJnc1swXSk7XG4gICAgICB9XG4gICAgICBpZiAob3B0aW9ucy5ldmVudElkID09PSBcImRvY3VtZW50LmxvYWRcIikge1xuICAgICAgICByZXR1cm4gdGhpcy5sb2FkRG9jdW1lbnQoe1xuICAgICAgICAgIGluaXRpZDogZXZlbnRBcmdzWzBdLFxuICAgICAgICAgIHZpZXdJZDogZXZlbnRBcmdzWzFdLFxuICAgICAgICAgIHJldmlzaW9uOiBldmVudEFyZ3NbMl1cbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBpZiAob3B0aW9ucy5ldmVudElkID09PSBcImRvY3VtZW50LmxvY2tcIikge1xuICAgICAgICByZXR1cm4gdGhpcy5sb2NrRG9jdW1lbnQoKTtcbiAgICAgIH1cbiAgICAgIGlmIChvcHRpb25zLmV2ZW50SWQgPT09IFwiZG9jdW1lbnQudW5sb2NrXCIpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudW5sb2NrRG9jdW1lbnQoKTtcbiAgICAgIH1cbiAgICAgIGlmIChvcHRpb25zLmV2ZW50SWQgPT09IFwiZG9jdW1lbnQucmVzdG9yZVwiKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJlc3RvcmVEb2N1bWVudCgpO1xuICAgICAgfVxuICAgICAgaWYgKG9wdGlvbnMuZXZlbnRJZCA9PT0gXCJkb2N1bWVudC5oZWxwXCIpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2hvd0hlbHAoZXZlbnQsIGV2ZW50QXJnc1swXSwgZXZlbnRBcmdzWzFdKTtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgZGlzcGxheU5ldHdvcmtFcnJvcjogZnVuY3Rpb24gdkRvY3VtZW50X2Rpc3BsYXlOZXR3b3JrRXJyb3IoKSB7XG4gICAgICB0aGlzLiRlbC5oaWRlKCk7XG4gICAgICAkKFwiLmRjcFN0YXRpY0Vycm9yTWVzc2FnZVwiKS5yZW1vdmVBdHRyKFwiaGlkZGVuXCIpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBHZXQgdGhlIHRlbXBsYXRlIGZvciB0aGUgY3VycmVudCB2aWV3XG4gICAgICpcbiAgICAgKiBAcGFyYW0ga2V5XG4gICAgICogQHJldHVybnMgeyp9XG4gICAgICovXG4gICAgZ2V0VGVtcGxhdGVzOiBmdW5jdGlvbiB2RG9jdW1lbnRHZXRUZW1wbGF0ZXMoa2V5KSB7XG4gICAgICB2YXIgdGVtcGxhdGVzID0ge307XG4gICAgICBpZiAodGhpcy5tb2RlbCAmJiB0aGlzLm1vZGVsLmdldChcInRlbXBsYXRlc1wiKSkge1xuICAgICAgICB0ZW1wbGF0ZXMgPSB0aGlzLm1vZGVsLmdldChcInRlbXBsYXRlc1wiKTtcbiAgICAgIH1cbiAgICAgIGlmICghXy5pc1VuZGVmaW5lZCh0ZW1wbGF0ZXNba2V5XSkpIHtcbiAgICAgICAgcmV0dXJuIHRlbXBsYXRlc1trZXldO1xuICAgICAgfVxuICAgICAgLy8gR2V0IGZyb20gYSBnb2JhbCBlbGVtZW50IChmb3IgdW5pdHRlc3QpXG4gICAgICBpZiAod2luZG93LmRjcCAmJiB3aW5kb3cuZGNwLnRlbXBsYXRlcyAmJiB3aW5kb3cuZGNwLnRlbXBsYXRlc1trZXldKSB7XG4gICAgICAgIHJldHVybiB3aW5kb3cuZGNwLnRlbXBsYXRlc1trZXldO1xuICAgICAgfVxuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVW5rbm93biB0ZW1wbGF0ZSAgXCIgKyBrZXkpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBEZXN0cm95IHRoZSBhc3NvY2lhdGVkIHdpZGdldCBhbmQgc3VwcHJlc3MgZXZlbnQgbGlzdGVuZXIgYmVmb3JlIHJlbW92IHRoZSBkb21cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIHsqfVxuICAgICAqL1xuICAgIHJlbW92ZTogZnVuY3Rpb24gdkRvY3VtZW50UmVtb3ZlKCkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgaWYgKHRoaXMua2VuZG9UYWJzICYmIHRoaXMua2VuZG9UYWJzLmRhdGEoXCJrZW5kb1RhYlN0cmlwXCIpKSB7XG4gICAgICAgICAgdGhpcy5rZW5kb1RhYnMuZGF0YShcImtlbmRvVGFiU3RyaXBcIikuZGVzdHJveSgpO1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIGlmICh3aW5kb3cuZGNwLmxvZ2dlcikge1xuICAgICAgICAgIHdpbmRvdy5kY3AubG9nZ2VyKGUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgICQod2luZG93KS5vZmYoXCIuXCIgKyB0aGlzLm1vZGVsLmNpZCk7XG4gICAgICAkKHdpbmRvdy5kb2N1bWVudCkub2ZmKFwiLlwiICsgdGhpcy5tb2RlbC5jaWQpO1xuXG4gICAgICByZXR1cm4gQmFja2JvbmUuVmlldy5wcm90b3R5cGUucmVtb3ZlLmNhbGwodGhpcyk7XG4gICAgfVxuICB9KTtcbn0pO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpRkFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5RUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///07b96fa8c545aab31dad\n");

/***/ }),

/***/ "0a26bdc45fd66878f3b9":
/*!****************************************************!*\
  !*** ./src/Apps/DOCUMENT/IHM/models/mAttribute.js ***!
  \****************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/*global define*/\n!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(/*! underscore */ \"8e08e542008e4aef1f58\"), __webpack_require__(/*! jquery */ \"127c8cf59f228bb01a21\"), __webpack_require__(/*! backbone */ \"1858b45bf48591489d06\")], __WEBPACK_AMD_DEFINE_RESULT__ = (function require_mAttribute(\n  _,\n  $,\n  Backbone\n) {\n  \"use strict\";\n\n  return Backbone.Model.extend({\n    typeModel: \"ddui:attribute\",\n    defaults: {\n      title: null,\n      isValueAttribute: false,\n      parent: undefined,\n      mode: \"read\",\n      errorMessage: null\n    },\n\n    initialize: function mAttributeinitialize() {\n      this.listenTo(this, \"change:documentMode\", this._computeMode);\n      this.listenTo(this, \"change:visibility\", this._computeMode);\n      this._computeValueMode();\n      this._computeMode();\n      this.set(\"title\", this.id + \"(\" + this.get(\"label\") + \")\");\n      this.set(\"errorMessage\", null);\n    },\n\n    toData: function mAttributetoData(index, extended) {\n      var content = this.toJSON();\n      if (\n        typeof index !== \"undefined\" &&\n        index !== null &&\n        this.get(\"multiple\") === false\n      ) {\n        throw new Error(\"You need to be multiple\");\n      }\n      if (_.isNumber(index)) {\n        content.attributeValue = content.attributeValue\n          ? content.attributeValue[index]\n          : null;\n        content.index = index;\n      }\n      content.isDisplayable = this.isDisplayable();\n      content.content = [];\n      if (this.get(\"content\") && _.isFunction(this.get(\"content\").toData)) {\n        content.content = this.get(\"content\").toData(index, extended);\n      }\n      if (extended) {\n        content.renderOptions = this.getOptions();\n        content.labels = content.labels || {};\n        content.locale = this.getDocumentModel().get(\"locale\");\n        content.templates = {};\n        if (this.getTemplates().attribute) {\n          if (this.getTemplates().attribute[this.get(\"type\")]) {\n            content.templates = this.getTemplates().attribute[this.get(\"type\")];\n          } else {\n            // fallback in case of no specific templates\n            content.templates = this.getTemplates().attribute[\"default\"];\n          }\n        }\n        content.deleteButton = true;\n        content.sourceValues = this.get(\"enumItems\");\n        content.sourceUri = this.get(\"enumUrl\");\n        if (!content.templates.label) {\n          content.templates.label = this.getTemplates().attribute.label;\n        }\n      }\n      return content;\n    },\n\n    isDisplayable: function mAttributeisDisplayable() {\n      var canBeDisplayable;\n      if (this.get(\"mode\") === \"hidden\") {\n        return false;\n      }\n      if (this.get(\"isValueAttribute\")) {\n        if (this.get(\"mode\") === \"read\") {\n          if (this.getOption(\"showEmptyContent\") !== null) {\n            return true;\n          }\n          if (\n            this.get(\"visibility\") === \"S\" &&\n            this.getDocumentModel().get(\"renderMode\") === \"edit\"\n          ) {\n            return true;\n          }\n\n          canBeDisplayable =\n            this.get(\"attributeValue\") &&\n            this.get(\"attributeValue\").value !== null;\n          if (_.isArray(this.get(\"attributeValue\"))) {\n            canBeDisplayable =\n              _.isArray(this.get(\"attributeValue\")) &&\n              this.get(\"attributeValue\").length > 0;\n          }\n          return canBeDisplayable;\n        } else if (this.get(\"mode\") === \"write\") {\n          return true;\n        }\n      }\n      if (this.get(\"content\").length === 0) {\n        return false;\n      }\n      if (this.getOption(\"showEmptyContent\") === null) {\n        if (this.get(\"content\").some) {\n          return this.get(\"content\").some(function mAttribute_checkDisplayable(\n            value\n          ) {\n            return value.isDisplayable();\n          });\n        }\n        return false;\n      }\n      return true;\n    },\n\n    hasMultipleOption: function mAttributehasMultipleOption() {\n      return (\n        this.attributes.options && this.attributes.options.multiple === \"yes\"\n      );\n    },\n\n    isDoubleMultiple: function mAttributehasMultipleOption() {\n      return (\n        this.hasMultipleOption() && this.getParent().get(\"type\") === \"array\"\n      );\n    },\n\n    getParent: function mAttributegetParent() {\n      if (this.attributes.parent) {\n        return this.getDocumentModel()\n          .get(\"attributes\")\n          .get(this.attributes.parent);\n      }\n      return null;\n    },\n\n    hasValueChanged: function mAttributehasReallyChanged() {\n      return (\n        this.get(\"attributeValue\") &&\n        ((this.get(\"attributeValue\").value !== undefined &&\n          ((this._initialAttributeValue || {}).value || \"\") !==\n            (this.get(\"attributeValue\").value || \"\")) ||\n          !_.isEqual(\n            _.pluck(_.flatten(this._initialAttributeValue), \"value\"),\n            _.pluck(_.flatten(this.get(\"attributeValue\")), \"value\")\n          ))\n      );\n    },\n\n    _computeMode: function mAttribute_computeMode() {\n      var visibility = this.get(\"visibility\"),\n        documentMode = this.collection.renderMode;\n      if (visibility === \"H\" || visibility === \"I\") {\n        this.set(\"mode\", \"hidden\");\n        return;\n      }\n      if (documentMode === \"view\") {\n        if (visibility === \"O\") {\n          this.set(\"mode\", \"hidden\");\n          return;\n        }\n        if (\n          this.get(\"isValueAttribute\") &&\n          (_.isEmpty(this.get(\"attributeValue\")) ||\n            _.isUndefined(\n              this.get(\"attributeValue\") ||\n                this.get(\"attributeValue\").value === null\n            ))\n        ) {\n          if (this.getOption(\"showEmptyContent\") === null) {\n            this.set(\"mode\", \"hidden\");\n            return;\n          }\n        }\n        this.set(\"mode\", \"read\");\n        return;\n      }\n      if (documentMode === \"edit\") {\n        if (visibility === \"W\" || visibility === \"O\") {\n          this.set(\"mode\", \"write\");\n          return;\n        }\n        if (visibility === \"R\") {\n          this.set(\"mode\", \"hidden\");\n          return;\n        }\n        if (visibility === \"R\" || visibility === \"S\") {\n          this.set(\"mode\", \"read\");\n          return;\n        }\n        if (visibility === \"U\") {\n          this.set(\"mode\", \"write\");\n          this.set(\"addTool\", false);\n          return;\n        }\n      }\n      throw new Error(\n        \"unkown mode \" +\n          documentMode +\n          \" or visibility \" +\n          visibility +\n          \" \" +\n          this.get(\"id\")\n      );\n    },\n\n    _computeValueMode: function mAttribute_computeValueMode() {\n      var type = this.get(\"type\"),\n        visibility = this.get(\"visibility\");\n      if (\n        type === \"frame\" ||\n        type === \"array\" ||\n        type === \"tab\" ||\n        visibility === \"I\"\n      ) {\n        this.set(\"isValueAttribute\", false);\n      }\n    },\n    /**\n     * Return all options for an attribute\n     *\n     * @returns {{}}\n     */\n    getOptions: function mAttributegetOptions() {\n      var optionsCommon = {},\n        optionsValue = {},\n        optionsAttribute = {},\n        renderOptions,\n        labels = {};\n      this._options = this._options || false;\n\n      if (this._options === false) {\n        renderOptions = this.collection.renderOptions;\n        if (renderOptions.common) {\n          optionsCommon = renderOptions.common || {};\n          labels = _.clone(optionsCommon.translatedLabels) || {};\n        }\n\n        if (renderOptions.types) {\n          optionsValue = renderOptions.types[this.get(\"type\")] || {};\n          labels = _.extend(labels, _.clone(optionsValue.translatedLabels));\n        }\n        if (renderOptions.attributes) {\n          optionsAttribute = renderOptions.attributes[this.id] || {};\n        }\n        // labels must be merged\n        optionsAttribute.labels = _.extend(\n          labels,\n          optionsAttribute.translatedLabels\n        );\n        this._options = {};\n      }\n\n      _.extend(this._options, optionsCommon, optionsValue, optionsAttribute);\n\n      return this._options;\n    },\n\n    /**\n     * Get value for an option\n     *\n     * @param key option identifier\n     * @returns {*}\n     */\n    getOption: function mAttributegetOption(key) {\n      var options = this.getOptions();\n      if (typeof options[key] !== \"undefined\") {\n        return options[key];\n      }\n      return null;\n    },\n\n    /**\n     * Set the value of an option\n     *\n     * @param key\n     * @param value\n     * @returns {*}\n     */\n    setOption: function mAttributesetOption(key, value) {\n      var options = this.getOptions();\n      options[key] = value;\n      this._options = options;\n      this.trigger(\"optionModified\", key);\n      return this;\n    },\n\n    getDocumentModel: function mAttributegetDocumentModelgetDocumentModel() {\n      return this.collection.documentModel;\n    },\n\n    getTemplates: function mAttributegetTemplatesgetTemplates() {\n      var templates = this.getDocumentModel().get(\"templates\");\n      if (!templates) {\n        templates = window.dcp.templates;\n      }\n      return templates;\n    },\n\n    setErrorMessage: function mAttributesetErrorMessage(message, index) {\n      var parentId = this.get(\"parent\");\n      if (this.get(\"multiple\") && typeof index !== \"undefined\") {\n        var errorMessage = this.get(\"errorMessage\") || [];\n        // delete duplicate\n        _.reject(errorMessage, function mAttribute_reindex(indexMessage) {\n          return indexMessage.index === index;\n        });\n        this.set(\n          \"errorMessage\",\n          [{ message: message, index: index }].concat(errorMessage)\n        );\n      } else {\n        this.set(\"errorMessage\", message);\n      }\n      if (parentId) {\n        // Propagate error message on parent structure\n        var parentModel = this.getDocumentModel()\n          .get(\"attributes\")\n          .get(parentId);\n        if (parentModel) {\n          parentModel.setErrorMessage(message);\n        }\n      }\n    },\n\n    checkConstraint: function mAttributecheckConstraint() {\n      return true;\n    },\n\n    haveView: function mAttributeHaveView() {\n      var view = { haveView: false, elements: $() };\n      this.trigger(\"haveView\", view);\n      return view;\n    },\n    /**\n     * Attribute model are not linked to REST element so always new\n     * @returns {boolean}\n     */\n    isNew: function mAttribute_isNew() {\n      return true;\n    }\n  });\n}).apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMGEyNmJkYzQ1ZmQ2Njg3OGYzYjkuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvQXBwcy9ET0NVTUVOVC9JSE0vbW9kZWxzL21BdHRyaWJ1dGUuanM/YWVhZCJdLCJzb3VyY2VzQ29udGVudCI6WyIvKmdsb2JhbCBkZWZpbmUqL1xuZGVmaW5lKFtcInVuZGVyc2NvcmVcIiwgXCJqcXVlcnlcIiwgXCJiYWNrYm9uZVwiXSwgZnVuY3Rpb24gcmVxdWlyZV9tQXR0cmlidXRlKFxuICBfLFxuICAkLFxuICBCYWNrYm9uZVxuKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIHJldHVybiBCYWNrYm9uZS5Nb2RlbC5leHRlbmQoe1xuICAgIHR5cGVNb2RlbDogXCJkZHVpOmF0dHJpYnV0ZVwiLFxuICAgIGRlZmF1bHRzOiB7XG4gICAgICB0aXRsZTogbnVsbCxcbiAgICAgIGlzVmFsdWVBdHRyaWJ1dGU6IGZhbHNlLFxuICAgICAgcGFyZW50OiB1bmRlZmluZWQsXG4gICAgICBtb2RlOiBcInJlYWRcIixcbiAgICAgIGVycm9yTWVzc2FnZTogbnVsbFxuICAgIH0sXG5cbiAgICBpbml0aWFsaXplOiBmdW5jdGlvbiBtQXR0cmlidXRlaW5pdGlhbGl6ZSgpIHtcbiAgICAgIHRoaXMubGlzdGVuVG8odGhpcywgXCJjaGFuZ2U6ZG9jdW1lbnRNb2RlXCIsIHRoaXMuX2NvbXB1dGVNb2RlKTtcbiAgICAgIHRoaXMubGlzdGVuVG8odGhpcywgXCJjaGFuZ2U6dmlzaWJpbGl0eVwiLCB0aGlzLl9jb21wdXRlTW9kZSk7XG4gICAgICB0aGlzLl9jb21wdXRlVmFsdWVNb2RlKCk7XG4gICAgICB0aGlzLl9jb21wdXRlTW9kZSgpO1xuICAgICAgdGhpcy5zZXQoXCJ0aXRsZVwiLCB0aGlzLmlkICsgXCIoXCIgKyB0aGlzLmdldChcImxhYmVsXCIpICsgXCIpXCIpO1xuICAgICAgdGhpcy5zZXQoXCJlcnJvck1lc3NhZ2VcIiwgbnVsbCk7XG4gICAgfSxcblxuICAgIHRvRGF0YTogZnVuY3Rpb24gbUF0dHJpYnV0ZXRvRGF0YShpbmRleCwgZXh0ZW5kZWQpIHtcbiAgICAgIHZhciBjb250ZW50ID0gdGhpcy50b0pTT04oKTtcbiAgICAgIGlmIChcbiAgICAgICAgdHlwZW9mIGluZGV4ICE9PSBcInVuZGVmaW5lZFwiICYmXG4gICAgICAgIGluZGV4ICE9PSBudWxsICYmXG4gICAgICAgIHRoaXMuZ2V0KFwibXVsdGlwbGVcIikgPT09IGZhbHNlXG4gICAgICApIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiWW91IG5lZWQgdG8gYmUgbXVsdGlwbGVcIik7XG4gICAgICB9XG4gICAgICBpZiAoXy5pc051bWJlcihpbmRleCkpIHtcbiAgICAgICAgY29udGVudC5hdHRyaWJ1dGVWYWx1ZSA9IGNvbnRlbnQuYXR0cmlidXRlVmFsdWVcbiAgICAgICAgICA/IGNvbnRlbnQuYXR0cmlidXRlVmFsdWVbaW5kZXhdXG4gICAgICAgICAgOiBudWxsO1xuICAgICAgICBjb250ZW50LmluZGV4ID0gaW5kZXg7XG4gICAgICB9XG4gICAgICBjb250ZW50LmlzRGlzcGxheWFibGUgPSB0aGlzLmlzRGlzcGxheWFibGUoKTtcbiAgICAgIGNvbnRlbnQuY29udGVudCA9IFtdO1xuICAgICAgaWYgKHRoaXMuZ2V0KFwiY29udGVudFwiKSAmJiBfLmlzRnVuY3Rpb24odGhpcy5nZXQoXCJjb250ZW50XCIpLnRvRGF0YSkpIHtcbiAgICAgICAgY29udGVudC5jb250ZW50ID0gdGhpcy5nZXQoXCJjb250ZW50XCIpLnRvRGF0YShpbmRleCwgZXh0ZW5kZWQpO1xuICAgICAgfVxuICAgICAgaWYgKGV4dGVuZGVkKSB7XG4gICAgICAgIGNvbnRlbnQucmVuZGVyT3B0aW9ucyA9IHRoaXMuZ2V0T3B0aW9ucygpO1xuICAgICAgICBjb250ZW50LmxhYmVscyA9IGNvbnRlbnQubGFiZWxzIHx8IHt9O1xuICAgICAgICBjb250ZW50LmxvY2FsZSA9IHRoaXMuZ2V0RG9jdW1lbnRNb2RlbCgpLmdldChcImxvY2FsZVwiKTtcbiAgICAgICAgY29udGVudC50ZW1wbGF0ZXMgPSB7fTtcbiAgICAgICAgaWYgKHRoaXMuZ2V0VGVtcGxhdGVzKCkuYXR0cmlidXRlKSB7XG4gICAgICAgICAgaWYgKHRoaXMuZ2V0VGVtcGxhdGVzKCkuYXR0cmlidXRlW3RoaXMuZ2V0KFwidHlwZVwiKV0pIHtcbiAgICAgICAgICAgIGNvbnRlbnQudGVtcGxhdGVzID0gdGhpcy5nZXRUZW1wbGF0ZXMoKS5hdHRyaWJ1dGVbdGhpcy5nZXQoXCJ0eXBlXCIpXTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gZmFsbGJhY2sgaW4gY2FzZSBvZiBubyBzcGVjaWZpYyB0ZW1wbGF0ZXNcbiAgICAgICAgICAgIGNvbnRlbnQudGVtcGxhdGVzID0gdGhpcy5nZXRUZW1wbGF0ZXMoKS5hdHRyaWJ1dGVbXCJkZWZhdWx0XCJdO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjb250ZW50LmRlbGV0ZUJ1dHRvbiA9IHRydWU7XG4gICAgICAgIGNvbnRlbnQuc291cmNlVmFsdWVzID0gdGhpcy5nZXQoXCJlbnVtSXRlbXNcIik7XG4gICAgICAgIGNvbnRlbnQuc291cmNlVXJpID0gdGhpcy5nZXQoXCJlbnVtVXJsXCIpO1xuICAgICAgICBpZiAoIWNvbnRlbnQudGVtcGxhdGVzLmxhYmVsKSB7XG4gICAgICAgICAgY29udGVudC50ZW1wbGF0ZXMubGFiZWwgPSB0aGlzLmdldFRlbXBsYXRlcygpLmF0dHJpYnV0ZS5sYWJlbDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIGNvbnRlbnQ7XG4gICAgfSxcblxuICAgIGlzRGlzcGxheWFibGU6IGZ1bmN0aW9uIG1BdHRyaWJ1dGVpc0Rpc3BsYXlhYmxlKCkge1xuICAgICAgdmFyIGNhbkJlRGlzcGxheWFibGU7XG4gICAgICBpZiAodGhpcy5nZXQoXCJtb2RlXCIpID09PSBcImhpZGRlblwiKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLmdldChcImlzVmFsdWVBdHRyaWJ1dGVcIikpIHtcbiAgICAgICAgaWYgKHRoaXMuZ2V0KFwibW9kZVwiKSA9PT0gXCJyZWFkXCIpIHtcbiAgICAgICAgICBpZiAodGhpcy5nZXRPcHRpb24oXCJzaG93RW1wdHlDb250ZW50XCIpICE9PSBudWxsKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKFxuICAgICAgICAgICAgdGhpcy5nZXQoXCJ2aXNpYmlsaXR5XCIpID09PSBcIlNcIiAmJlxuICAgICAgICAgICAgdGhpcy5nZXREb2N1bWVudE1vZGVsKCkuZ2V0KFwicmVuZGVyTW9kZVwiKSA9PT0gXCJlZGl0XCJcbiAgICAgICAgICApIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGNhbkJlRGlzcGxheWFibGUgPVxuICAgICAgICAgICAgdGhpcy5nZXQoXCJhdHRyaWJ1dGVWYWx1ZVwiKSAmJlxuICAgICAgICAgICAgdGhpcy5nZXQoXCJhdHRyaWJ1dGVWYWx1ZVwiKS52YWx1ZSAhPT0gbnVsbDtcbiAgICAgICAgICBpZiAoXy5pc0FycmF5KHRoaXMuZ2V0KFwiYXR0cmlidXRlVmFsdWVcIikpKSB7XG4gICAgICAgICAgICBjYW5CZURpc3BsYXlhYmxlID1cbiAgICAgICAgICAgICAgXy5pc0FycmF5KHRoaXMuZ2V0KFwiYXR0cmlidXRlVmFsdWVcIikpICYmXG4gICAgICAgICAgICAgIHRoaXMuZ2V0KFwiYXR0cmlidXRlVmFsdWVcIikubGVuZ3RoID4gMDtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIGNhbkJlRGlzcGxheWFibGU7XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5nZXQoXCJtb2RlXCIpID09PSBcIndyaXRlXCIpIHtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKHRoaXMuZ2V0KFwiY29udGVudFwiKS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMuZ2V0T3B0aW9uKFwic2hvd0VtcHR5Q29udGVudFwiKSA9PT0gbnVsbCkge1xuICAgICAgICBpZiAodGhpcy5nZXQoXCJjb250ZW50XCIpLnNvbWUpIHtcbiAgICAgICAgICByZXR1cm4gdGhpcy5nZXQoXCJjb250ZW50XCIpLnNvbWUoZnVuY3Rpb24gbUF0dHJpYnV0ZV9jaGVja0Rpc3BsYXlhYmxlKFxuICAgICAgICAgICAgdmFsdWVcbiAgICAgICAgICApIHtcbiAgICAgICAgICAgIHJldHVybiB2YWx1ZS5pc0Rpc3BsYXlhYmxlKCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSxcblxuICAgIGhhc011bHRpcGxlT3B0aW9uOiBmdW5jdGlvbiBtQXR0cmlidXRlaGFzTXVsdGlwbGVPcHRpb24oKSB7XG4gICAgICByZXR1cm4gKFxuICAgICAgICB0aGlzLmF0dHJpYnV0ZXMub3B0aW9ucyAmJiB0aGlzLmF0dHJpYnV0ZXMub3B0aW9ucy5tdWx0aXBsZSA9PT0gXCJ5ZXNcIlxuICAgICAgKTtcbiAgICB9LFxuXG4gICAgaXNEb3VibGVNdWx0aXBsZTogZnVuY3Rpb24gbUF0dHJpYnV0ZWhhc011bHRpcGxlT3B0aW9uKCkge1xuICAgICAgcmV0dXJuIChcbiAgICAgICAgdGhpcy5oYXNNdWx0aXBsZU9wdGlvbigpICYmIHRoaXMuZ2V0UGFyZW50KCkuZ2V0KFwidHlwZVwiKSA9PT0gXCJhcnJheVwiXG4gICAgICApO1xuICAgIH0sXG5cbiAgICBnZXRQYXJlbnQ6IGZ1bmN0aW9uIG1BdHRyaWJ1dGVnZXRQYXJlbnQoKSB7XG4gICAgICBpZiAodGhpcy5hdHRyaWJ1dGVzLnBhcmVudCkge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXREb2N1bWVudE1vZGVsKClcbiAgICAgICAgICAuZ2V0KFwiYXR0cmlidXRlc1wiKVxuICAgICAgICAgIC5nZXQodGhpcy5hdHRyaWJ1dGVzLnBhcmVudCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9LFxuXG4gICAgaGFzVmFsdWVDaGFuZ2VkOiBmdW5jdGlvbiBtQXR0cmlidXRlaGFzUmVhbGx5Q2hhbmdlZCgpIHtcbiAgICAgIHJldHVybiAoXG4gICAgICAgIHRoaXMuZ2V0KFwiYXR0cmlidXRlVmFsdWVcIikgJiZcbiAgICAgICAgKCh0aGlzLmdldChcImF0dHJpYnV0ZVZhbHVlXCIpLnZhbHVlICE9PSB1bmRlZmluZWQgJiZcbiAgICAgICAgICAoKHRoaXMuX2luaXRpYWxBdHRyaWJ1dGVWYWx1ZSB8fCB7fSkudmFsdWUgfHwgXCJcIikgIT09XG4gICAgICAgICAgICAodGhpcy5nZXQoXCJhdHRyaWJ1dGVWYWx1ZVwiKS52YWx1ZSB8fCBcIlwiKSkgfHxcbiAgICAgICAgICAhXy5pc0VxdWFsKFxuICAgICAgICAgICAgXy5wbHVjayhfLmZsYXR0ZW4odGhpcy5faW5pdGlhbEF0dHJpYnV0ZVZhbHVlKSwgXCJ2YWx1ZVwiKSxcbiAgICAgICAgICAgIF8ucGx1Y2soXy5mbGF0dGVuKHRoaXMuZ2V0KFwiYXR0cmlidXRlVmFsdWVcIikpLCBcInZhbHVlXCIpXG4gICAgICAgICAgKSlcbiAgICAgICk7XG4gICAgfSxcblxuICAgIF9jb21wdXRlTW9kZTogZnVuY3Rpb24gbUF0dHJpYnV0ZV9jb21wdXRlTW9kZSgpIHtcbiAgICAgIHZhciB2aXNpYmlsaXR5ID0gdGhpcy5nZXQoXCJ2aXNpYmlsaXR5XCIpLFxuICAgICAgICBkb2N1bWVudE1vZGUgPSB0aGlzLmNvbGxlY3Rpb24ucmVuZGVyTW9kZTtcbiAgICAgIGlmICh2aXNpYmlsaXR5ID09PSBcIkhcIiB8fCB2aXNpYmlsaXR5ID09PSBcIklcIikge1xuICAgICAgICB0aGlzLnNldChcIm1vZGVcIiwgXCJoaWRkZW5cIik7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGlmIChkb2N1bWVudE1vZGUgPT09IFwidmlld1wiKSB7XG4gICAgICAgIGlmICh2aXNpYmlsaXR5ID09PSBcIk9cIikge1xuICAgICAgICAgIHRoaXMuc2V0KFwibW9kZVwiLCBcImhpZGRlblwiKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKFxuICAgICAgICAgIHRoaXMuZ2V0KFwiaXNWYWx1ZUF0dHJpYnV0ZVwiKSAmJlxuICAgICAgICAgIChfLmlzRW1wdHkodGhpcy5nZXQoXCJhdHRyaWJ1dGVWYWx1ZVwiKSkgfHxcbiAgICAgICAgICAgIF8uaXNVbmRlZmluZWQoXG4gICAgICAgICAgICAgIHRoaXMuZ2V0KFwiYXR0cmlidXRlVmFsdWVcIikgfHxcbiAgICAgICAgICAgICAgICB0aGlzLmdldChcImF0dHJpYnV0ZVZhbHVlXCIpLnZhbHVlID09PSBudWxsXG4gICAgICAgICAgICApKVxuICAgICAgICApIHtcbiAgICAgICAgICBpZiAodGhpcy5nZXRPcHRpb24oXCJzaG93RW1wdHlDb250ZW50XCIpID09PSBudWxsKSB7XG4gICAgICAgICAgICB0aGlzLnNldChcIm1vZGVcIiwgXCJoaWRkZW5cIik7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMuc2V0KFwibW9kZVwiLCBcInJlYWRcIik7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGlmIChkb2N1bWVudE1vZGUgPT09IFwiZWRpdFwiKSB7XG4gICAgICAgIGlmICh2aXNpYmlsaXR5ID09PSBcIldcIiB8fCB2aXNpYmlsaXR5ID09PSBcIk9cIikge1xuICAgICAgICAgIHRoaXMuc2V0KFwibW9kZVwiLCBcIndyaXRlXCIpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAodmlzaWJpbGl0eSA9PT0gXCJSXCIpIHtcbiAgICAgICAgICB0aGlzLnNldChcIm1vZGVcIiwgXCJoaWRkZW5cIik7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmICh2aXNpYmlsaXR5ID09PSBcIlJcIiB8fCB2aXNpYmlsaXR5ID09PSBcIlNcIikge1xuICAgICAgICAgIHRoaXMuc2V0KFwibW9kZVwiLCBcInJlYWRcIik7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmICh2aXNpYmlsaXR5ID09PSBcIlVcIikge1xuICAgICAgICAgIHRoaXMuc2V0KFwibW9kZVwiLCBcIndyaXRlXCIpO1xuICAgICAgICAgIHRoaXMuc2V0KFwiYWRkVG9vbFwiLCBmYWxzZSk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgIFwidW5rb3duIG1vZGUgXCIgK1xuICAgICAgICAgIGRvY3VtZW50TW9kZSArXG4gICAgICAgICAgXCIgb3IgdmlzaWJpbGl0eSBcIiArXG4gICAgICAgICAgdmlzaWJpbGl0eSArXG4gICAgICAgICAgXCIgXCIgK1xuICAgICAgICAgIHRoaXMuZ2V0KFwiaWRcIilcbiAgICAgICk7XG4gICAgfSxcblxuICAgIF9jb21wdXRlVmFsdWVNb2RlOiBmdW5jdGlvbiBtQXR0cmlidXRlX2NvbXB1dGVWYWx1ZU1vZGUoKSB7XG4gICAgICB2YXIgdHlwZSA9IHRoaXMuZ2V0KFwidHlwZVwiKSxcbiAgICAgICAgdmlzaWJpbGl0eSA9IHRoaXMuZ2V0KFwidmlzaWJpbGl0eVwiKTtcbiAgICAgIGlmIChcbiAgICAgICAgdHlwZSA9PT0gXCJmcmFtZVwiIHx8XG4gICAgICAgIHR5cGUgPT09IFwiYXJyYXlcIiB8fFxuICAgICAgICB0eXBlID09PSBcInRhYlwiIHx8XG4gICAgICAgIHZpc2liaWxpdHkgPT09IFwiSVwiXG4gICAgICApIHtcbiAgICAgICAgdGhpcy5zZXQoXCJpc1ZhbHVlQXR0cmlidXRlXCIsIGZhbHNlKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIC8qKlxuICAgICAqIFJldHVybiBhbGwgb3B0aW9ucyBmb3IgYW4gYXR0cmlidXRlXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyB7e319XG4gICAgICovXG4gICAgZ2V0T3B0aW9uczogZnVuY3Rpb24gbUF0dHJpYnV0ZWdldE9wdGlvbnMoKSB7XG4gICAgICB2YXIgb3B0aW9uc0NvbW1vbiA9IHt9LFxuICAgICAgICBvcHRpb25zVmFsdWUgPSB7fSxcbiAgICAgICAgb3B0aW9uc0F0dHJpYnV0ZSA9IHt9LFxuICAgICAgICByZW5kZXJPcHRpb25zLFxuICAgICAgICBsYWJlbHMgPSB7fTtcbiAgICAgIHRoaXMuX29wdGlvbnMgPSB0aGlzLl9vcHRpb25zIHx8IGZhbHNlO1xuXG4gICAgICBpZiAodGhpcy5fb3B0aW9ucyA9PT0gZmFsc2UpIHtcbiAgICAgICAgcmVuZGVyT3B0aW9ucyA9IHRoaXMuY29sbGVjdGlvbi5yZW5kZXJPcHRpb25zO1xuICAgICAgICBpZiAocmVuZGVyT3B0aW9ucy5jb21tb24pIHtcbiAgICAgICAgICBvcHRpb25zQ29tbW9uID0gcmVuZGVyT3B0aW9ucy5jb21tb24gfHwge307XG4gICAgICAgICAgbGFiZWxzID0gXy5jbG9uZShvcHRpb25zQ29tbW9uLnRyYW5zbGF0ZWRMYWJlbHMpIHx8IHt9O1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHJlbmRlck9wdGlvbnMudHlwZXMpIHtcbiAgICAgICAgICBvcHRpb25zVmFsdWUgPSByZW5kZXJPcHRpb25zLnR5cGVzW3RoaXMuZ2V0KFwidHlwZVwiKV0gfHwge307XG4gICAgICAgICAgbGFiZWxzID0gXy5leHRlbmQobGFiZWxzLCBfLmNsb25lKG9wdGlvbnNWYWx1ZS50cmFuc2xhdGVkTGFiZWxzKSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHJlbmRlck9wdGlvbnMuYXR0cmlidXRlcykge1xuICAgICAgICAgIG9wdGlvbnNBdHRyaWJ1dGUgPSByZW5kZXJPcHRpb25zLmF0dHJpYnV0ZXNbdGhpcy5pZF0gfHwge307XG4gICAgICAgIH1cbiAgICAgICAgLy8gbGFiZWxzIG11c3QgYmUgbWVyZ2VkXG4gICAgICAgIG9wdGlvbnNBdHRyaWJ1dGUubGFiZWxzID0gXy5leHRlbmQoXG4gICAgICAgICAgbGFiZWxzLFxuICAgICAgICAgIG9wdGlvbnNBdHRyaWJ1dGUudHJhbnNsYXRlZExhYmVsc1xuICAgICAgICApO1xuICAgICAgICB0aGlzLl9vcHRpb25zID0ge307XG4gICAgICB9XG5cbiAgICAgIF8uZXh0ZW5kKHRoaXMuX29wdGlvbnMsIG9wdGlvbnNDb21tb24sIG9wdGlvbnNWYWx1ZSwgb3B0aW9uc0F0dHJpYnV0ZSk7XG5cbiAgICAgIHJldHVybiB0aGlzLl9vcHRpb25zO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBHZXQgdmFsdWUgZm9yIGFuIG9wdGlvblxuICAgICAqXG4gICAgICogQHBhcmFtIGtleSBvcHRpb24gaWRlbnRpZmllclxuICAgICAqIEByZXR1cm5zIHsqfVxuICAgICAqL1xuICAgIGdldE9wdGlvbjogZnVuY3Rpb24gbUF0dHJpYnV0ZWdldE9wdGlvbihrZXkpIHtcbiAgICAgIHZhciBvcHRpb25zID0gdGhpcy5nZXRPcHRpb25zKCk7XG4gICAgICBpZiAodHlwZW9mIG9wdGlvbnNba2V5XSAhPT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgICByZXR1cm4gb3B0aW9uc1trZXldO1xuICAgICAgfVxuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIFNldCB0aGUgdmFsdWUgb2YgYW4gb3B0aW9uXG4gICAgICpcbiAgICAgKiBAcGFyYW0ga2V5XG4gICAgICogQHBhcmFtIHZhbHVlXG4gICAgICogQHJldHVybnMgeyp9XG4gICAgICovXG4gICAgc2V0T3B0aW9uOiBmdW5jdGlvbiBtQXR0cmlidXRlc2V0T3B0aW9uKGtleSwgdmFsdWUpIHtcbiAgICAgIHZhciBvcHRpb25zID0gdGhpcy5nZXRPcHRpb25zKCk7XG4gICAgICBvcHRpb25zW2tleV0gPSB2YWx1ZTtcbiAgICAgIHRoaXMuX29wdGlvbnMgPSBvcHRpb25zO1xuICAgICAgdGhpcy50cmlnZ2VyKFwib3B0aW9uTW9kaWZpZWRcIiwga2V5KTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICBnZXREb2N1bWVudE1vZGVsOiBmdW5jdGlvbiBtQXR0cmlidXRlZ2V0RG9jdW1lbnRNb2RlbGdldERvY3VtZW50TW9kZWwoKSB7XG4gICAgICByZXR1cm4gdGhpcy5jb2xsZWN0aW9uLmRvY3VtZW50TW9kZWw7XG4gICAgfSxcblxuICAgIGdldFRlbXBsYXRlczogZnVuY3Rpb24gbUF0dHJpYnV0ZWdldFRlbXBsYXRlc2dldFRlbXBsYXRlcygpIHtcbiAgICAgIHZhciB0ZW1wbGF0ZXMgPSB0aGlzLmdldERvY3VtZW50TW9kZWwoKS5nZXQoXCJ0ZW1wbGF0ZXNcIik7XG4gICAgICBpZiAoIXRlbXBsYXRlcykge1xuICAgICAgICB0ZW1wbGF0ZXMgPSB3aW5kb3cuZGNwLnRlbXBsYXRlcztcbiAgICAgIH1cbiAgICAgIHJldHVybiB0ZW1wbGF0ZXM7XG4gICAgfSxcblxuICAgIHNldEVycm9yTWVzc2FnZTogZnVuY3Rpb24gbUF0dHJpYnV0ZXNldEVycm9yTWVzc2FnZShtZXNzYWdlLCBpbmRleCkge1xuICAgICAgdmFyIHBhcmVudElkID0gdGhpcy5nZXQoXCJwYXJlbnRcIik7XG4gICAgICBpZiAodGhpcy5nZXQoXCJtdWx0aXBsZVwiKSAmJiB0eXBlb2YgaW5kZXggIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgdmFyIGVycm9yTWVzc2FnZSA9IHRoaXMuZ2V0KFwiZXJyb3JNZXNzYWdlXCIpIHx8IFtdO1xuICAgICAgICAvLyBkZWxldGUgZHVwbGljYXRlXG4gICAgICAgIF8ucmVqZWN0KGVycm9yTWVzc2FnZSwgZnVuY3Rpb24gbUF0dHJpYnV0ZV9yZWluZGV4KGluZGV4TWVzc2FnZSkge1xuICAgICAgICAgIHJldHVybiBpbmRleE1lc3NhZ2UuaW5kZXggPT09IGluZGV4O1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5zZXQoXG4gICAgICAgICAgXCJlcnJvck1lc3NhZ2VcIixcbiAgICAgICAgICBbeyBtZXNzYWdlOiBtZXNzYWdlLCBpbmRleDogaW5kZXggfV0uY29uY2F0KGVycm9yTWVzc2FnZSlcbiAgICAgICAgKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuc2V0KFwiZXJyb3JNZXNzYWdlXCIsIG1lc3NhZ2UpO1xuICAgICAgfVxuICAgICAgaWYgKHBhcmVudElkKSB7XG4gICAgICAgIC8vIFByb3BhZ2F0ZSBlcnJvciBtZXNzYWdlIG9uIHBhcmVudCBzdHJ1Y3R1cmVcbiAgICAgICAgdmFyIHBhcmVudE1vZGVsID0gdGhpcy5nZXREb2N1bWVudE1vZGVsKClcbiAgICAgICAgICAuZ2V0KFwiYXR0cmlidXRlc1wiKVxuICAgICAgICAgIC5nZXQocGFyZW50SWQpO1xuICAgICAgICBpZiAocGFyZW50TW9kZWwpIHtcbiAgICAgICAgICBwYXJlbnRNb2RlbC5zZXRFcnJvck1lc3NhZ2UobWVzc2FnZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuXG4gICAgY2hlY2tDb25zdHJhaW50OiBmdW5jdGlvbiBtQXR0cmlidXRlY2hlY2tDb25zdHJhaW50KCkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSxcblxuICAgIGhhdmVWaWV3OiBmdW5jdGlvbiBtQXR0cmlidXRlSGF2ZVZpZXcoKSB7XG4gICAgICB2YXIgdmlldyA9IHsgaGF2ZVZpZXc6IGZhbHNlLCBlbGVtZW50czogJCgpIH07XG4gICAgICB0aGlzLnRyaWdnZXIoXCJoYXZlVmlld1wiLCB2aWV3KTtcbiAgICAgIHJldHVybiB2aWV3O1xuICAgIH0sXG4gICAgLyoqXG4gICAgICogQXR0cmlidXRlIG1vZGVsIGFyZSBub3QgbGlua2VkIHRvIFJFU1QgZWxlbWVudCBzbyBhbHdheXMgbmV3XG4gICAgICogQHJldHVybnMge2Jvb2xlYW59XG4gICAgICovXG4gICAgaXNOZXc6IGZ1bmN0aW9uIG1BdHRyaWJ1dGVfaXNOZXcoKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gIH0pO1xufSk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///0a26bdc45fd66878f3b9\n");

/***/ }),

/***/ "0bd0aa4c1909a49f67bb":
/*!*********************************************************!*\
  !*** ./src/Apps/DOCUMENT/IHM/widgets/window/wDialog.js ***!
  \*********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(/*! jquery */ \"127c8cf59f228bb01a21\"), __webpack_require__(/*! underscore */ \"8e08e542008e4aef1f58\"), __webpack_require__(/*! dcpDocument/widgets/widget */ \"f562ab9f022eef93542c\")], __WEBPACK_AMD_DEFINE_RESULT__ = (function wDialog(\n  $,\n  _\n) {\n  \"use strict\";\n\n  $.widget(\"dcp.dcpDialog\", {\n    options: {\n      window: {\n        modal: true,\n        actions: [\"Maximize\", \"Close\"],\n        visible: false,\n        height: \"300px\",\n        width: \"500px\",\n        title: \"-\"\n      },\n      maximizeWidth: 768 // Limit in px to open with maximize\n    },\n\n    dialogWindow: null,\n\n    _create: function dcpDialog_create() {\n      var currentWidget = this;\n      this.element.data(\"dcpDialog\", this);\n      if (!this.options.window.close) {\n        this.options.window.close = function dcpDialog_onclose() {\n          _.defer(_.bind(currentWidget.destroy, currentWidget));\n        };\n      } else {\n        this.options.window.close = _.wrap(\n          this.options.window.close,\n          function dcpDialog_closeWrap(close) {\n            var event = arguments[1];\n            close.apply(this, _.rest(arguments));\n            if (!event.isDefaultPrevented()) {\n              _.defer(_.bind(currentWidget.destroy, currentWidget));\n            }\n          }\n        );\n      }\n\n      if ($(window).width() <= this.options.maximizeWidth) {\n        this.options.window.width = \"auto\";\n        this.options.window.heigth = \"auto\";\n      }\n      this.dialogWindow = this.element\n        .kendoWindow(this.options.window)\n        .data(\"kendoWindow\");\n    },\n\n    open: function dcpDialog_Open() {\n      var kWindow = this.dialogWindow;\n      if ($(window).width() <= this.options.maximizeWidth) {\n        kWindow.setOptions({\n          actions: [\"Close\"],\n          animation: false\n        });\n\n        kWindow.open();\n        _.delay(function wDialogMaximize() {\n          kWindow.maximize(); // Need to defer to wait window to be really opened\n        }, 100);\n      } else {\n        kWindow.setOptions({\n          actions: this.options.window.actions\n        });\n        kWindow.center();\n        kWindow.open();\n      }\n    },\n\n    close: function dcpDialog_close() {\n      var kendoWindow = this.dialogWindow;\n      if (kendoWindow) {\n        kendoWindow.close();\n      }\n    },\n\n    _destroy: function dcpDialog_destroy() {\n      if (\n        this.element &&\n        this.dialogWindow &&\n        this.element.data(\"kendoWindow\")\n      ) {\n        this.dialogWindow.destroy();\n        this.dialogWindow = null;\n      } else {\n        this._super();\n      }\n    }\n  });\n}).apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMGJkMGFhNGMxOTA5YTQ5ZjY3YmIuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvQXBwcy9ET0NVTUVOVC9JSE0vd2lkZ2V0cy93aW5kb3cvd0RpYWxvZy5qcz84MzdmIl0sInNvdXJjZXNDb250ZW50IjpbImRlZmluZShbXCJqcXVlcnlcIiwgXCJ1bmRlcnNjb3JlXCIsIFwiZGNwRG9jdW1lbnQvd2lkZ2V0cy93aWRnZXRcIl0sIGZ1bmN0aW9uIHdEaWFsb2coXG4gICQsXG4gIF9cbikge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICAkLndpZGdldChcImRjcC5kY3BEaWFsb2dcIiwge1xuICAgIG9wdGlvbnM6IHtcbiAgICAgIHdpbmRvdzoge1xuICAgICAgICBtb2RhbDogdHJ1ZSxcbiAgICAgICAgYWN0aW9uczogW1wiTWF4aW1pemVcIiwgXCJDbG9zZVwiXSxcbiAgICAgICAgdmlzaWJsZTogZmFsc2UsXG4gICAgICAgIGhlaWdodDogXCIzMDBweFwiLFxuICAgICAgICB3aWR0aDogXCI1MDBweFwiLFxuICAgICAgICB0aXRsZTogXCItXCJcbiAgICAgIH0sXG4gICAgICBtYXhpbWl6ZVdpZHRoOiA3NjggLy8gTGltaXQgaW4gcHggdG8gb3BlbiB3aXRoIG1heGltaXplXG4gICAgfSxcblxuICAgIGRpYWxvZ1dpbmRvdzogbnVsbCxcblxuICAgIF9jcmVhdGU6IGZ1bmN0aW9uIGRjcERpYWxvZ19jcmVhdGUoKSB7XG4gICAgICB2YXIgY3VycmVudFdpZGdldCA9IHRoaXM7XG4gICAgICB0aGlzLmVsZW1lbnQuZGF0YShcImRjcERpYWxvZ1wiLCB0aGlzKTtcbiAgICAgIGlmICghdGhpcy5vcHRpb25zLndpbmRvdy5jbG9zZSkge1xuICAgICAgICB0aGlzLm9wdGlvbnMud2luZG93LmNsb3NlID0gZnVuY3Rpb24gZGNwRGlhbG9nX29uY2xvc2UoKSB7XG4gICAgICAgICAgXy5kZWZlcihfLmJpbmQoY3VycmVudFdpZGdldC5kZXN0cm95LCBjdXJyZW50V2lkZ2V0KSk7XG4gICAgICAgIH07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLm9wdGlvbnMud2luZG93LmNsb3NlID0gXy53cmFwKFxuICAgICAgICAgIHRoaXMub3B0aW9ucy53aW5kb3cuY2xvc2UsXG4gICAgICAgICAgZnVuY3Rpb24gZGNwRGlhbG9nX2Nsb3NlV3JhcChjbG9zZSkge1xuICAgICAgICAgICAgdmFyIGV2ZW50ID0gYXJndW1lbnRzWzFdO1xuICAgICAgICAgICAgY2xvc2UuYXBwbHkodGhpcywgXy5yZXN0KGFyZ3VtZW50cykpO1xuICAgICAgICAgICAgaWYgKCFldmVudC5pc0RlZmF1bHRQcmV2ZW50ZWQoKSkge1xuICAgICAgICAgICAgICBfLmRlZmVyKF8uYmluZChjdXJyZW50V2lkZ2V0LmRlc3Ryb3ksIGN1cnJlbnRXaWRnZXQpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIGlmICgkKHdpbmRvdykud2lkdGgoKSA8PSB0aGlzLm9wdGlvbnMubWF4aW1pemVXaWR0aCkge1xuICAgICAgICB0aGlzLm9wdGlvbnMud2luZG93LndpZHRoID0gXCJhdXRvXCI7XG4gICAgICAgIHRoaXMub3B0aW9ucy53aW5kb3cuaGVpZ3RoID0gXCJhdXRvXCI7XG4gICAgICB9XG4gICAgICB0aGlzLmRpYWxvZ1dpbmRvdyA9IHRoaXMuZWxlbWVudFxuICAgICAgICAua2VuZG9XaW5kb3codGhpcy5vcHRpb25zLndpbmRvdylcbiAgICAgICAgLmRhdGEoXCJrZW5kb1dpbmRvd1wiKTtcbiAgICB9LFxuXG4gICAgb3BlbjogZnVuY3Rpb24gZGNwRGlhbG9nX09wZW4oKSB7XG4gICAgICB2YXIga1dpbmRvdyA9IHRoaXMuZGlhbG9nV2luZG93O1xuICAgICAgaWYgKCQod2luZG93KS53aWR0aCgpIDw9IHRoaXMub3B0aW9ucy5tYXhpbWl6ZVdpZHRoKSB7XG4gICAgICAgIGtXaW5kb3cuc2V0T3B0aW9ucyh7XG4gICAgICAgICAgYWN0aW9uczogW1wiQ2xvc2VcIl0sXG4gICAgICAgICAgYW5pbWF0aW9uOiBmYWxzZVxuICAgICAgICB9KTtcblxuICAgICAgICBrV2luZG93Lm9wZW4oKTtcbiAgICAgICAgXy5kZWxheShmdW5jdGlvbiB3RGlhbG9nTWF4aW1pemUoKSB7XG4gICAgICAgICAga1dpbmRvdy5tYXhpbWl6ZSgpOyAvLyBOZWVkIHRvIGRlZmVyIHRvIHdhaXQgd2luZG93IHRvIGJlIHJlYWxseSBvcGVuZWRcbiAgICAgICAgfSwgMTAwKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGtXaW5kb3cuc2V0T3B0aW9ucyh7XG4gICAgICAgICAgYWN0aW9uczogdGhpcy5vcHRpb25zLndpbmRvdy5hY3Rpb25zXG4gICAgICAgIH0pO1xuICAgICAgICBrV2luZG93LmNlbnRlcigpO1xuICAgICAgICBrV2luZG93Lm9wZW4oKTtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgY2xvc2U6IGZ1bmN0aW9uIGRjcERpYWxvZ19jbG9zZSgpIHtcbiAgICAgIHZhciBrZW5kb1dpbmRvdyA9IHRoaXMuZGlhbG9nV2luZG93O1xuICAgICAgaWYgKGtlbmRvV2luZG93KSB7XG4gICAgICAgIGtlbmRvV2luZG93LmNsb3NlKCk7XG4gICAgICB9XG4gICAgfSxcblxuICAgIF9kZXN0cm95OiBmdW5jdGlvbiBkY3BEaWFsb2dfZGVzdHJveSgpIHtcbiAgICAgIGlmIChcbiAgICAgICAgdGhpcy5lbGVtZW50ICYmXG4gICAgICAgIHRoaXMuZGlhbG9nV2luZG93ICYmXG4gICAgICAgIHRoaXMuZWxlbWVudC5kYXRhKFwia2VuZG9XaW5kb3dcIilcbiAgICAgICkge1xuICAgICAgICB0aGlzLmRpYWxvZ1dpbmRvdy5kZXN0cm95KCk7XG4gICAgICAgIHRoaXMuZGlhbG9nV2luZG93ID0gbnVsbDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuX3N1cGVyKCk7XG4gICAgICB9XG4gICAgfVxuICB9KTtcbn0pO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///0bd0aa4c1909a49f67bb\n");

/***/ }),

/***/ "0ce7df67ddafeaa3e32e":
/*!******************************************************************!*\
  !*** ./src/Apps/DOCUMENT/IHM/views/workflow/vTransitionGraph.js ***!
  \******************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;!(__WEBPACK_AMD_DEFINE_ARRAY__ = [\n  __webpack_require__(/*! underscore */ \"8e08e542008e4aef1f58\"),\n  __webpack_require__(/*! jquery */ \"127c8cf59f228bb01a21\"),\n  __webpack_require__(/*! backbone */ \"1858b45bf48591489d06\"),\n  __webpack_require__(/*! mustache */ \"bcd31d01884fc294fd69\"),\n  __webpack_require__(/*! dcpDocument/i18n/documentCatalog */ \"278ba7757aa1904087c6\"),\n  __webpack_require__(/*! dcpDocument/widgets/window/wDialog */ \"0bd0aa4c1909a49f67bb\")\n], __WEBPACK_AMD_DEFINE_RESULT__ = (function vTransitionGraph(_, $, Backbone, Mustache, i18n) {\n  \"use strict\";\n\n  return Backbone.View.extend({\n    messages: [],\n\n    remove: function vTransitionGraph_remove() {\n      if (this.transitionGraphWindow && this.$el.data(\"kendoWindow\")) {\n        this.transitionGraphWindow.destroy();\n      }\n\n      //Call parent\n      Backbone.View.prototype.remove.apply(this, arguments);\n    },\n\n    /**\n     * Render the document view\n     * @returns {*}\n     */\n    render: function vTransitionGraph_render() {\n      var currentView = this;\n\n      this.$el.append(\n        $(\n          '<div class=\"dcpTransitionGraph--from\"/>' +\n            '<div class=\"dcpTransitionGraph--to\"/>'\n        )\n      );\n\n      this.displayCurrentState();\n\n      // Init Events\n      this.$el.on(\n        \"mouseover\",\n        \".dcpTransitionGraph--to .dcpTransitionGraph_state\",\n        function vTransitionGraph_renderMouseOver() {\n          var to = $(this).data(\"to\");\n          if (!$(this).hasClass(\"dcpTransitionGraph_state--error\")) {\n            currentView.$el\n              .find(\".dcpTransitionGraph__arrow--\" + to)\n              .addClass(\"dcpTransitionGraph__arrow--selected\");\n          }\n        }\n      );\n      this.$el.on(\n        \"mouseout\",\n        \".dcpTransitionGraph--to .dcpTransitionGraph_state\",\n        function vTransitionGraph_renderMouseOut() {\n          currentView.$el\n            .find(\".dcpTransitionGraph__arrow\")\n            .removeClass(\"dcpTransitionGraph__arrow--selected\");\n        }\n      );\n\n      this.$el.on(\n        \"click\",\n        \".dcpTransitionGraph--to .dcpTransitionGraph_state\",\n        function vTransitionGraph_renderClick() {\n          var to = $(this).data(\"to\");\n\n          if (!$(this).hasClass(\"dcpTransitionGraph_state--error\")) {\n            currentView.$el.trigger(\"viewTransition\", to);\n          }\n        }\n      );\n\n      this.$el.find(\".dcpTransitionGraph_state \").tooltip({\n        placement: \"top\",\n        html: true\n      });\n\n      if (!this.transitionGraphWindow) {\n        this.transitionGraphWindow = this.$el\n          .dcpDialog({\n            window: {\n              height: \"auto\",\n              width: \"600px\",\n              close: function registerCloseEvent() {\n                currentView.remove();\n              },\n              activate: function vTransitionGraph_windowActivate() {\n                currentView.displayArrows();\n                currentView.previousHeight = currentView.$el.height();\n              },\n              resize: function vTransitionGraph_windowResize() {\n                var isMaximized = currentView.$el.data(\"kendoWindow\").options\n                  .isMaximized;\n\n                if (!isMaximized && currentView.isMaximizedNow) {\n                  currentView.$el\n                    .find(\".dcpTransitionGraph--to\")\n                    .height(currentView.previousHeight);\n                  currentView.$el\n                    .find(\".dcpTransitionGraph--from\")\n                    .height(currentView.previousHeight);\n                  currentView.isMaximizedNow = false;\n                }\n                currentView.displayArrows();\n\n                if (!isMaximized) {\n                  currentView.previousHeight = currentView.$el.height();\n                } else {\n                  currentView.isMaximizedNow = true;\n                }\n              }\n            }\n          })\n          .data(\"dcpDialog\");\n        this.$el.kendoWindow(\"title\", i18n.___(\"Transition Graph\", \"ddui\"));\n        this.transitionGraphWindow.open();\n      }\n    },\n\n    displayCurrentState: function vTransitionGraphdisplayCurrentState() {\n      var tpl =\n        '<div class=\"dcpTransitionGraph_state {{#transition.error}}dcpTransitionGraph_state--error{{/transition.error}}\" ' +\n        'data-to=\"{{id}}\" {{^transition.error}}title=\"{{title}}{{transition.error}}\"{{/transition.error}} style=\"border-color:{{color}}\">{{displayValue}}' +\n        '{{#transition.error}}<div class=\"dcpTransitionGraph_state_message\">{{transition.error}}</div>{{/transition.error}}' +\n        \"</div>\";\n      var states = this.model.get(\"workflowStates\");\n      var currentState = this.model.get(\"state\");\n      var currentView = this;\n\n      this.$el.find(\".dcpTransitionGraph--from\").append(\n        Mustache.render(\n          tpl || \"\",\n          _.extend(currentState, {\n            title: i18n.___(\"Current workflow activity\", \"ddui\")\n          })\n        )\n      );\n\n      _.each(states, function vTransitionGraphdisplayCurrentStateEach(item) {\n        if (item.transition && item.transition.authorized !== false) {\n          item.title = Mustache.render(\n            i18n.___(\"Next step. Apply transition {{label}}\", \"ddui\"),\n            { label: item.transition.label }\n          );\n          currentView.$el\n            .find(\".dcpTransitionGraph--to\")\n            .append(Mustache.render(tpl, item));\n        }\n      });\n    },\n\n    displayArrows: function vTransitionGraph_displayArrows() {\n      var states = this.model.get(\"workflowStates\");\n      var currentView = this;\n\n      var $from = this.$el.find(\n        \".dcpTransitionGraph--from .dcpTransitionGraph_state\"\n      );\n      var $to;\n\n      this.$el.find(\".dcpTransitionGraph__arrow\").remove();\n\n      this.$el.find(\".dcpTransitionGraph--to\").height(this.$el.height());\n      this.$el.find(\".dcpTransitionGraph--from\").height(this.$el.height());\n      _.each(states, function vTransitionGraph_connectStates(item) {\n        if (item.transition && item.transition.authorized !== false) {\n          $to = currentView.$el.find(\n            \".dcpTransitionGraph--to .dcpTransitionGraph_state[data-to=\" +\n              item.id +\n              \"]\"\n          );\n          currentView.connect(\n            $from.get(0),\n            $to.get(0),\n            2,\n            item\n          );\n        }\n      });\n    },\n\n    /**\n     * return element top, left, width, height\n     * @param el DOM element\n     * @returns {*|jQuery}\n     */\n    getOffset: function vTransitionGraph_getOffset(el) {\n      var offset = $(el).offset();\n      offset.width = $(el).outerWidth();\n      offset.height = $(el).outerHeight();\n      return offset;\n    },\n\n    /**\n     * draw a line connecting elements\n     * @param div1 from div\n     * @param div2 to div\n     * @param thickness of the arraow\n     * @param item transition info\n     */\n    connect: function vTransitionGraph_connect(div1, div2, thickness, item) {\n      var off1 = this.getOffset(div1);\n      var off2 = this.getOffset(div2);\n      var origin = this.getOffset(this.$el.get(0));\n\n      // bottom right\n      var x2 = off1.left + off1.width - origin.left;\n      var y2 = off1.top + off1.height / 2 - origin.top;\n      // top right\n      var x1 = off2.left - origin.left;\n      var y1 = off2.top + off2.height / 2 - origin.top;\n      // distance\n      var length = Math.sqrt((x2 - x1) * (x2 - x1) + (y2 - y1) * (y2 - y1));\n      // center\n      var cx = (x1 + x2) / 2 - length / 2;\n      var cy = (y1 + y2) / 2 - thickness / 2;\n      // angle\n      var angle = Math.atan2(y1 - y2, x1 - x2) * (180 / Math.PI);\n\n      //\n      var htmlLine =\n        \"<div class='dcpTransitionGraph__arrow dcpTransitionGraph__arrow--{{id}} {{#error}}dcpTransitionGraph__arrow--error{{/error}}' \" +\n        \"style=' height:{{height}}px;left:{{left}}px; top:{{top}}px; width:{{width}}px;\" +\n        \" -moz-transform:rotate({{angle}}deg); \" +\n        \"-webkit-transform:rotate({{angle}}deg); \" +\n        \"-o-transform:rotate({{angle}}deg); \" +\n        \"-ms-transform:rotate({{angle}}deg); \" +\n        \"transform:rotate({{angle}}deg);' ><div class='dcpTransitionGraph__arrow__label'>{{text}}</div>\" +\n        \"<span class='dcpTransitionGraph__arrow__end fa fa-2x fa-caret-right'></span> </div>\";\n\n      this.$el.append(\n        Mustache.render(htmlLine || \"\", {\n          error: item.transition.error,\n          id: item.id,\n          height: thickness,\n          width: length,\n          top: cy,\n          left: cx,\n          angle: angle,\n          text: item.transition.label\n        })\n      );\n    }\n  });\n}).apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMGNlN2RmNjdkZGFmZWFhM2UzMmUuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvQXBwcy9ET0NVTUVOVC9JSE0vdmlld3Mvd29ya2Zsb3cvdlRyYW5zaXRpb25HcmFwaC5qcz84MTg2Il0sInNvdXJjZXNDb250ZW50IjpbImRlZmluZShbXG4gIFwidW5kZXJzY29yZVwiLFxuICBcImpxdWVyeVwiLFxuICBcImJhY2tib25lXCIsXG4gIFwibXVzdGFjaGVcIixcbiAgXCJkY3BEb2N1bWVudC9pMThuL2RvY3VtZW50Q2F0YWxvZ1wiLFxuICBcImRjcERvY3VtZW50L3dpZGdldHMvd2luZG93L3dEaWFsb2dcIlxuXSwgZnVuY3Rpb24gdlRyYW5zaXRpb25HcmFwaChfLCAkLCBCYWNrYm9uZSwgTXVzdGFjaGUsIGkxOG4pIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgcmV0dXJuIEJhY2tib25lLlZpZXcuZXh0ZW5kKHtcbiAgICBtZXNzYWdlczogW10sXG5cbiAgICByZW1vdmU6IGZ1bmN0aW9uIHZUcmFuc2l0aW9uR3JhcGhfcmVtb3ZlKCkge1xuICAgICAgaWYgKHRoaXMudHJhbnNpdGlvbkdyYXBoV2luZG93ICYmIHRoaXMuJGVsLmRhdGEoXCJrZW5kb1dpbmRvd1wiKSkge1xuICAgICAgICB0aGlzLnRyYW5zaXRpb25HcmFwaFdpbmRvdy5kZXN0cm95KCk7XG4gICAgICB9XG5cbiAgICAgIC8vQ2FsbCBwYXJlbnRcbiAgICAgIEJhY2tib25lLlZpZXcucHJvdG90eXBlLnJlbW92ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBSZW5kZXIgdGhlIGRvY3VtZW50IHZpZXdcbiAgICAgKiBAcmV0dXJucyB7Kn1cbiAgICAgKi9cbiAgICByZW5kZXI6IGZ1bmN0aW9uIHZUcmFuc2l0aW9uR3JhcGhfcmVuZGVyKCkge1xuICAgICAgdmFyIGN1cnJlbnRWaWV3ID0gdGhpcztcblxuICAgICAgdGhpcy4kZWwuYXBwZW5kKFxuICAgICAgICAkKFxuICAgICAgICAgICc8ZGl2IGNsYXNzPVwiZGNwVHJhbnNpdGlvbkdyYXBoLS1mcm9tXCIvPicgK1xuICAgICAgICAgICAgJzxkaXYgY2xhc3M9XCJkY3BUcmFuc2l0aW9uR3JhcGgtLXRvXCIvPidcbiAgICAgICAgKVxuICAgICAgKTtcblxuICAgICAgdGhpcy5kaXNwbGF5Q3VycmVudFN0YXRlKCk7XG5cbiAgICAgIC8vIEluaXQgRXZlbnRzXG4gICAgICB0aGlzLiRlbC5vbihcbiAgICAgICAgXCJtb3VzZW92ZXJcIixcbiAgICAgICAgXCIuZGNwVHJhbnNpdGlvbkdyYXBoLS10byAuZGNwVHJhbnNpdGlvbkdyYXBoX3N0YXRlXCIsXG4gICAgICAgIGZ1bmN0aW9uIHZUcmFuc2l0aW9uR3JhcGhfcmVuZGVyTW91c2VPdmVyKCkge1xuICAgICAgICAgIHZhciB0byA9ICQodGhpcykuZGF0YShcInRvXCIpO1xuICAgICAgICAgIGlmICghJCh0aGlzKS5oYXNDbGFzcyhcImRjcFRyYW5zaXRpb25HcmFwaF9zdGF0ZS0tZXJyb3JcIikpIHtcbiAgICAgICAgICAgIGN1cnJlbnRWaWV3LiRlbFxuICAgICAgICAgICAgICAuZmluZChcIi5kY3BUcmFuc2l0aW9uR3JhcGhfX2Fycm93LS1cIiArIHRvKVxuICAgICAgICAgICAgICAuYWRkQ2xhc3MoXCJkY3BUcmFuc2l0aW9uR3JhcGhfX2Fycm93LS1zZWxlY3RlZFwiKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgICB0aGlzLiRlbC5vbihcbiAgICAgICAgXCJtb3VzZW91dFwiLFxuICAgICAgICBcIi5kY3BUcmFuc2l0aW9uR3JhcGgtLXRvIC5kY3BUcmFuc2l0aW9uR3JhcGhfc3RhdGVcIixcbiAgICAgICAgZnVuY3Rpb24gdlRyYW5zaXRpb25HcmFwaF9yZW5kZXJNb3VzZU91dCgpIHtcbiAgICAgICAgICBjdXJyZW50Vmlldy4kZWxcbiAgICAgICAgICAgIC5maW5kKFwiLmRjcFRyYW5zaXRpb25HcmFwaF9fYXJyb3dcIilcbiAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhcImRjcFRyYW5zaXRpb25HcmFwaF9fYXJyb3ctLXNlbGVjdGVkXCIpO1xuICAgICAgICB9XG4gICAgICApO1xuXG4gICAgICB0aGlzLiRlbC5vbihcbiAgICAgICAgXCJjbGlja1wiLFxuICAgICAgICBcIi5kY3BUcmFuc2l0aW9uR3JhcGgtLXRvIC5kY3BUcmFuc2l0aW9uR3JhcGhfc3RhdGVcIixcbiAgICAgICAgZnVuY3Rpb24gdlRyYW5zaXRpb25HcmFwaF9yZW5kZXJDbGljaygpIHtcbiAgICAgICAgICB2YXIgdG8gPSAkKHRoaXMpLmRhdGEoXCJ0b1wiKTtcblxuICAgICAgICAgIGlmICghJCh0aGlzKS5oYXNDbGFzcyhcImRjcFRyYW5zaXRpb25HcmFwaF9zdGF0ZS0tZXJyb3JcIikpIHtcbiAgICAgICAgICAgIGN1cnJlbnRWaWV3LiRlbC50cmlnZ2VyKFwidmlld1RyYW5zaXRpb25cIiwgdG8pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgKTtcblxuICAgICAgdGhpcy4kZWwuZmluZChcIi5kY3BUcmFuc2l0aW9uR3JhcGhfc3RhdGUgXCIpLnRvb2x0aXAoe1xuICAgICAgICBwbGFjZW1lbnQ6IFwidG9wXCIsXG4gICAgICAgIGh0bWw6IHRydWVcbiAgICAgIH0pO1xuXG4gICAgICBpZiAoIXRoaXMudHJhbnNpdGlvbkdyYXBoV2luZG93KSB7XG4gICAgICAgIHRoaXMudHJhbnNpdGlvbkdyYXBoV2luZG93ID0gdGhpcy4kZWxcbiAgICAgICAgICAuZGNwRGlhbG9nKHtcbiAgICAgICAgICAgIHdpbmRvdzoge1xuICAgICAgICAgICAgICBoZWlnaHQ6IFwiYXV0b1wiLFxuICAgICAgICAgICAgICB3aWR0aDogXCI2MDBweFwiLFxuICAgICAgICAgICAgICBjbG9zZTogZnVuY3Rpb24gcmVnaXN0ZXJDbG9zZUV2ZW50KCkge1xuICAgICAgICAgICAgICAgIGN1cnJlbnRWaWV3LnJlbW92ZSgpO1xuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBhY3RpdmF0ZTogZnVuY3Rpb24gdlRyYW5zaXRpb25HcmFwaF93aW5kb3dBY3RpdmF0ZSgpIHtcbiAgICAgICAgICAgICAgICBjdXJyZW50Vmlldy5kaXNwbGF5QXJyb3dzKCk7XG4gICAgICAgICAgICAgICAgY3VycmVudFZpZXcucHJldmlvdXNIZWlnaHQgPSBjdXJyZW50Vmlldy4kZWwuaGVpZ2h0KCk7XG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIHJlc2l6ZTogZnVuY3Rpb24gdlRyYW5zaXRpb25HcmFwaF93aW5kb3dSZXNpemUoKSB7XG4gICAgICAgICAgICAgICAgdmFyIGlzTWF4aW1pemVkID0gY3VycmVudFZpZXcuJGVsLmRhdGEoXCJrZW5kb1dpbmRvd1wiKS5vcHRpb25zXG4gICAgICAgICAgICAgICAgICAuaXNNYXhpbWl6ZWQ7XG5cbiAgICAgICAgICAgICAgICBpZiAoIWlzTWF4aW1pemVkICYmIGN1cnJlbnRWaWV3LmlzTWF4aW1pemVkTm93KSB7XG4gICAgICAgICAgICAgICAgICBjdXJyZW50Vmlldy4kZWxcbiAgICAgICAgICAgICAgICAgICAgLmZpbmQoXCIuZGNwVHJhbnNpdGlvbkdyYXBoLS10b1wiKVxuICAgICAgICAgICAgICAgICAgICAuaGVpZ2h0KGN1cnJlbnRWaWV3LnByZXZpb3VzSGVpZ2h0KTtcbiAgICAgICAgICAgICAgICAgIGN1cnJlbnRWaWV3LiRlbFxuICAgICAgICAgICAgICAgICAgICAuZmluZChcIi5kY3BUcmFuc2l0aW9uR3JhcGgtLWZyb21cIilcbiAgICAgICAgICAgICAgICAgICAgLmhlaWdodChjdXJyZW50Vmlldy5wcmV2aW91c0hlaWdodCk7XG4gICAgICAgICAgICAgICAgICBjdXJyZW50Vmlldy5pc01heGltaXplZE5vdyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjdXJyZW50Vmlldy5kaXNwbGF5QXJyb3dzKCk7XG5cbiAgICAgICAgICAgICAgICBpZiAoIWlzTWF4aW1pemVkKSB7XG4gICAgICAgICAgICAgICAgICBjdXJyZW50Vmlldy5wcmV2aW91c0hlaWdodCA9IGN1cnJlbnRWaWV3LiRlbC5oZWlnaHQoKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgY3VycmVudFZpZXcuaXNNYXhpbWl6ZWROb3cgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pXG4gICAgICAgICAgLmRhdGEoXCJkY3BEaWFsb2dcIik7XG4gICAgICAgIHRoaXMuJGVsLmtlbmRvV2luZG93KFwidGl0bGVcIiwgaTE4bi5fX18oXCJUcmFuc2l0aW9uIEdyYXBoXCIsIFwiZGR1aVwiKSk7XG4gICAgICAgIHRoaXMudHJhbnNpdGlvbkdyYXBoV2luZG93Lm9wZW4oKTtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgZGlzcGxheUN1cnJlbnRTdGF0ZTogZnVuY3Rpb24gdlRyYW5zaXRpb25HcmFwaGRpc3BsYXlDdXJyZW50U3RhdGUoKSB7XG4gICAgICB2YXIgdHBsID1cbiAgICAgICAgJzxkaXYgY2xhc3M9XCJkY3BUcmFuc2l0aW9uR3JhcGhfc3RhdGUge3sjdHJhbnNpdGlvbi5lcnJvcn19ZGNwVHJhbnNpdGlvbkdyYXBoX3N0YXRlLS1lcnJvcnt7L3RyYW5zaXRpb24uZXJyb3J9fVwiICcgK1xuICAgICAgICAnZGF0YS10bz1cInt7aWR9fVwiIHt7XnRyYW5zaXRpb24uZXJyb3J9fXRpdGxlPVwie3t0aXRsZX19e3t0cmFuc2l0aW9uLmVycm9yfX1cInt7L3RyYW5zaXRpb24uZXJyb3J9fSBzdHlsZT1cImJvcmRlci1jb2xvcjp7e2NvbG9yfX1cIj57e2Rpc3BsYXlWYWx1ZX19JyArXG4gICAgICAgICd7eyN0cmFuc2l0aW9uLmVycm9yfX08ZGl2IGNsYXNzPVwiZGNwVHJhbnNpdGlvbkdyYXBoX3N0YXRlX21lc3NhZ2VcIj57e3RyYW5zaXRpb24uZXJyb3J9fTwvZGl2Pnt7L3RyYW5zaXRpb24uZXJyb3J9fScgK1xuICAgICAgICBcIjwvZGl2PlwiO1xuICAgICAgdmFyIHN0YXRlcyA9IHRoaXMubW9kZWwuZ2V0KFwid29ya2Zsb3dTdGF0ZXNcIik7XG4gICAgICB2YXIgY3VycmVudFN0YXRlID0gdGhpcy5tb2RlbC5nZXQoXCJzdGF0ZVwiKTtcbiAgICAgIHZhciBjdXJyZW50VmlldyA9IHRoaXM7XG5cbiAgICAgIHRoaXMuJGVsLmZpbmQoXCIuZGNwVHJhbnNpdGlvbkdyYXBoLS1mcm9tXCIpLmFwcGVuZChcbiAgICAgICAgTXVzdGFjaGUucmVuZGVyKFxuICAgICAgICAgIHRwbCB8fCBcIlwiLFxuICAgICAgICAgIF8uZXh0ZW5kKGN1cnJlbnRTdGF0ZSwge1xuICAgICAgICAgICAgdGl0bGU6IGkxOG4uX19fKFwiQ3VycmVudCB3b3JrZmxvdyBhY3Rpdml0eVwiLCBcImRkdWlcIilcbiAgICAgICAgICB9KVxuICAgICAgICApXG4gICAgICApO1xuXG4gICAgICBfLmVhY2goc3RhdGVzLCBmdW5jdGlvbiB2VHJhbnNpdGlvbkdyYXBoZGlzcGxheUN1cnJlbnRTdGF0ZUVhY2goaXRlbSkge1xuICAgICAgICBpZiAoaXRlbS50cmFuc2l0aW9uICYmIGl0ZW0udHJhbnNpdGlvbi5hdXRob3JpemVkICE9PSBmYWxzZSkge1xuICAgICAgICAgIGl0ZW0udGl0bGUgPSBNdXN0YWNoZS5yZW5kZXIoXG4gICAgICAgICAgICBpMThuLl9fXyhcIk5leHQgc3RlcC4gQXBwbHkgdHJhbnNpdGlvbiB7e2xhYmVsfX1cIiwgXCJkZHVpXCIpLFxuICAgICAgICAgICAgeyBsYWJlbDogaXRlbS50cmFuc2l0aW9uLmxhYmVsIH1cbiAgICAgICAgICApO1xuICAgICAgICAgIGN1cnJlbnRWaWV3LiRlbFxuICAgICAgICAgICAgLmZpbmQoXCIuZGNwVHJhbnNpdGlvbkdyYXBoLS10b1wiKVxuICAgICAgICAgICAgLmFwcGVuZChNdXN0YWNoZS5yZW5kZXIodHBsLCBpdGVtKSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBkaXNwbGF5QXJyb3dzOiBmdW5jdGlvbiB2VHJhbnNpdGlvbkdyYXBoX2Rpc3BsYXlBcnJvd3MoKSB7XG4gICAgICB2YXIgc3RhdGVzID0gdGhpcy5tb2RlbC5nZXQoXCJ3b3JrZmxvd1N0YXRlc1wiKTtcbiAgICAgIHZhciBjdXJyZW50VmlldyA9IHRoaXM7XG5cbiAgICAgIHZhciAkZnJvbSA9IHRoaXMuJGVsLmZpbmQoXG4gICAgICAgIFwiLmRjcFRyYW5zaXRpb25HcmFwaC0tZnJvbSAuZGNwVHJhbnNpdGlvbkdyYXBoX3N0YXRlXCJcbiAgICAgICk7XG4gICAgICB2YXIgJHRvO1xuXG4gICAgICB0aGlzLiRlbC5maW5kKFwiLmRjcFRyYW5zaXRpb25HcmFwaF9fYXJyb3dcIikucmVtb3ZlKCk7XG5cbiAgICAgIHRoaXMuJGVsLmZpbmQoXCIuZGNwVHJhbnNpdGlvbkdyYXBoLS10b1wiKS5oZWlnaHQodGhpcy4kZWwuaGVpZ2h0KCkpO1xuICAgICAgdGhpcy4kZWwuZmluZChcIi5kY3BUcmFuc2l0aW9uR3JhcGgtLWZyb21cIikuaGVpZ2h0KHRoaXMuJGVsLmhlaWdodCgpKTtcbiAgICAgIF8uZWFjaChzdGF0ZXMsIGZ1bmN0aW9uIHZUcmFuc2l0aW9uR3JhcGhfY29ubmVjdFN0YXRlcyhpdGVtKSB7XG4gICAgICAgIGlmIChpdGVtLnRyYW5zaXRpb24gJiYgaXRlbS50cmFuc2l0aW9uLmF1dGhvcml6ZWQgIT09IGZhbHNlKSB7XG4gICAgICAgICAgJHRvID0gY3VycmVudFZpZXcuJGVsLmZpbmQoXG4gICAgICAgICAgICBcIi5kY3BUcmFuc2l0aW9uR3JhcGgtLXRvIC5kY3BUcmFuc2l0aW9uR3JhcGhfc3RhdGVbZGF0YS10bz1cIiArXG4gICAgICAgICAgICAgIGl0ZW0uaWQgK1xuICAgICAgICAgICAgICBcIl1cIlxuICAgICAgICAgICk7XG4gICAgICAgICAgY3VycmVudFZpZXcuY29ubmVjdChcbiAgICAgICAgICAgICRmcm9tLmdldCgwKSxcbiAgICAgICAgICAgICR0by5nZXQoMCksXG4gICAgICAgICAgICAyLFxuICAgICAgICAgICAgaXRlbVxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiByZXR1cm4gZWxlbWVudCB0b3AsIGxlZnQsIHdpZHRoLCBoZWlnaHRcbiAgICAgKiBAcGFyYW0gZWwgRE9NIGVsZW1lbnRcbiAgICAgKiBAcmV0dXJucyB7KnxqUXVlcnl9XG4gICAgICovXG4gICAgZ2V0T2Zmc2V0OiBmdW5jdGlvbiB2VHJhbnNpdGlvbkdyYXBoX2dldE9mZnNldChlbCkge1xuICAgICAgdmFyIG9mZnNldCA9ICQoZWwpLm9mZnNldCgpO1xuICAgICAgb2Zmc2V0LndpZHRoID0gJChlbCkub3V0ZXJXaWR0aCgpO1xuICAgICAgb2Zmc2V0LmhlaWdodCA9ICQoZWwpLm91dGVySGVpZ2h0KCk7XG4gICAgICByZXR1cm4gb2Zmc2V0O1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBkcmF3IGEgbGluZSBjb25uZWN0aW5nIGVsZW1lbnRzXG4gICAgICogQHBhcmFtIGRpdjEgZnJvbSBkaXZcbiAgICAgKiBAcGFyYW0gZGl2MiB0byBkaXZcbiAgICAgKiBAcGFyYW0gdGhpY2tuZXNzIG9mIHRoZSBhcnJhb3dcbiAgICAgKiBAcGFyYW0gaXRlbSB0cmFuc2l0aW9uIGluZm9cbiAgICAgKi9cbiAgICBjb25uZWN0OiBmdW5jdGlvbiB2VHJhbnNpdGlvbkdyYXBoX2Nvbm5lY3QoZGl2MSwgZGl2MiwgdGhpY2tuZXNzLCBpdGVtKSB7XG4gICAgICB2YXIgb2ZmMSA9IHRoaXMuZ2V0T2Zmc2V0KGRpdjEpO1xuICAgICAgdmFyIG9mZjIgPSB0aGlzLmdldE9mZnNldChkaXYyKTtcbiAgICAgIHZhciBvcmlnaW4gPSB0aGlzLmdldE9mZnNldCh0aGlzLiRlbC5nZXQoMCkpO1xuXG4gICAgICAvLyBib3R0b20gcmlnaHRcbiAgICAgIHZhciB4MiA9IG9mZjEubGVmdCArIG9mZjEud2lkdGggLSBvcmlnaW4ubGVmdDtcbiAgICAgIHZhciB5MiA9IG9mZjEudG9wICsgb2ZmMS5oZWlnaHQgLyAyIC0gb3JpZ2luLnRvcDtcbiAgICAgIC8vIHRvcCByaWdodFxuICAgICAgdmFyIHgxID0gb2ZmMi5sZWZ0IC0gb3JpZ2luLmxlZnQ7XG4gICAgICB2YXIgeTEgPSBvZmYyLnRvcCArIG9mZjIuaGVpZ2h0IC8gMiAtIG9yaWdpbi50b3A7XG4gICAgICAvLyBkaXN0YW5jZVxuICAgICAgdmFyIGxlbmd0aCA9IE1hdGguc3FydCgoeDIgLSB4MSkgKiAoeDIgLSB4MSkgKyAoeTIgLSB5MSkgKiAoeTIgLSB5MSkpO1xuICAgICAgLy8gY2VudGVyXG4gICAgICB2YXIgY3ggPSAoeDEgKyB4MikgLyAyIC0gbGVuZ3RoIC8gMjtcbiAgICAgIHZhciBjeSA9ICh5MSArIHkyKSAvIDIgLSB0aGlja25lc3MgLyAyO1xuICAgICAgLy8gYW5nbGVcbiAgICAgIHZhciBhbmdsZSA9IE1hdGguYXRhbjIoeTEgLSB5MiwgeDEgLSB4MikgKiAoMTgwIC8gTWF0aC5QSSk7XG5cbiAgICAgIC8vXG4gICAgICB2YXIgaHRtbExpbmUgPVxuICAgICAgICBcIjxkaXYgY2xhc3M9J2RjcFRyYW5zaXRpb25HcmFwaF9fYXJyb3cgZGNwVHJhbnNpdGlvbkdyYXBoX19hcnJvdy0te3tpZH19IHt7I2Vycm9yfX1kY3BUcmFuc2l0aW9uR3JhcGhfX2Fycm93LS1lcnJvcnt7L2Vycm9yfX0nIFwiICtcbiAgICAgICAgXCJzdHlsZT0nIGhlaWdodDp7e2hlaWdodH19cHg7bGVmdDp7e2xlZnR9fXB4OyB0b3A6e3t0b3B9fXB4OyB3aWR0aDp7e3dpZHRofX1weDtcIiArXG4gICAgICAgIFwiIC1tb3otdHJhbnNmb3JtOnJvdGF0ZSh7e2FuZ2xlfX1kZWcpOyBcIiArXG4gICAgICAgIFwiLXdlYmtpdC10cmFuc2Zvcm06cm90YXRlKHt7YW5nbGV9fWRlZyk7IFwiICtcbiAgICAgICAgXCItby10cmFuc2Zvcm06cm90YXRlKHt7YW5nbGV9fWRlZyk7IFwiICtcbiAgICAgICAgXCItbXMtdHJhbnNmb3JtOnJvdGF0ZSh7e2FuZ2xlfX1kZWcpOyBcIiArXG4gICAgICAgIFwidHJhbnNmb3JtOnJvdGF0ZSh7e2FuZ2xlfX1kZWcpOycgPjxkaXYgY2xhc3M9J2RjcFRyYW5zaXRpb25HcmFwaF9fYXJyb3dfX2xhYmVsJz57e3RleHR9fTwvZGl2PlwiICtcbiAgICAgICAgXCI8c3BhbiBjbGFzcz0nZGNwVHJhbnNpdGlvbkdyYXBoX19hcnJvd19fZW5kIGZhIGZhLTJ4IGZhLWNhcmV0LXJpZ2h0Jz48L3NwYW4+IDwvZGl2PlwiO1xuXG4gICAgICB0aGlzLiRlbC5hcHBlbmQoXG4gICAgICAgIE11c3RhY2hlLnJlbmRlcihodG1sTGluZSB8fCBcIlwiLCB7XG4gICAgICAgICAgZXJyb3I6IGl0ZW0udHJhbnNpdGlvbi5lcnJvcixcbiAgICAgICAgICBpZDogaXRlbS5pZCxcbiAgICAgICAgICBoZWlnaHQ6IHRoaWNrbmVzcyxcbiAgICAgICAgICB3aWR0aDogbGVuZ3RoLFxuICAgICAgICAgIHRvcDogY3ksXG4gICAgICAgICAgbGVmdDogY3gsXG4gICAgICAgICAgYW5nbGU6IGFuZ2xlLFxuICAgICAgICAgIHRleHQ6IGl0ZW0udHJhbnNpdGlvbi5sYWJlbFxuICAgICAgICB9KVxuICAgICAgKTtcbiAgICB9XG4gIH0pO1xufSk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///0ce7df67ddafeaa3e32e\n");

/***/ }),

/***/ "0ed68aa34b095f87d8dd":
/*!*********************************************************!*\
  !*** ./src/Apps/DOCUMENT/IHM/models/mAttributeArray.js ***!
  \*********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(/*! underscore */ \"8e08e542008e4aef1f58\"), __webpack_require__(/*! dcpDocument/models/mAttributeStructural */ \"512dac7279589ee7db96\")], __WEBPACK_AMD_DEFINE_RESULT__ = (function(\n  _,\n  AttributeStructuralModel\n) {\n  \"use strict\";\n\n  return AttributeStructuralModel.extend({\n    typeModel: \"ddui:attributeArray\",\n    removeIndexedLine: function mAttributeArrayRemoveIndexLine(index) {\n      this.trigger(\"removeWidgetLine\", { index: index }, { silent: true });\n      this.trigger(\"array\", \"remove\", this, index);\n    },\n\n    addIndexedLine: function mAttributeArrayaddIndexedLine(index) {\n      this.trigger(\"addWidgetLine\", { index: index });\n      this.trigger(\"array\", \"add\", this, index);\n    }\n  });\n}).apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMGVkNjhhYTM0YjA5NWY4N2Q4ZGQuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvQXBwcy9ET0NVTUVOVC9JSE0vbW9kZWxzL21BdHRyaWJ1dGVBcnJheS5qcz82YWU4Il0sInNvdXJjZXNDb250ZW50IjpbImRlZmluZShbXCJ1bmRlcnNjb3JlXCIsIFwiZGNwRG9jdW1lbnQvbW9kZWxzL21BdHRyaWJ1dGVTdHJ1Y3R1cmFsXCJdLCBmdW5jdGlvbihcbiAgXyxcbiAgQXR0cmlidXRlU3RydWN0dXJhbE1vZGVsXG4pIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgcmV0dXJuIEF0dHJpYnV0ZVN0cnVjdHVyYWxNb2RlbC5leHRlbmQoe1xuICAgIHR5cGVNb2RlbDogXCJkZHVpOmF0dHJpYnV0ZUFycmF5XCIsXG4gICAgcmVtb3ZlSW5kZXhlZExpbmU6IGZ1bmN0aW9uIG1BdHRyaWJ1dGVBcnJheVJlbW92ZUluZGV4TGluZShpbmRleCkge1xuICAgICAgdGhpcy50cmlnZ2VyKFwicmVtb3ZlV2lkZ2V0TGluZVwiLCB7IGluZGV4OiBpbmRleCB9LCB7IHNpbGVudDogdHJ1ZSB9KTtcbiAgICAgIHRoaXMudHJpZ2dlcihcImFycmF5XCIsIFwicmVtb3ZlXCIsIHRoaXMsIGluZGV4KTtcbiAgICB9LFxuXG4gICAgYWRkSW5kZXhlZExpbmU6IGZ1bmN0aW9uIG1BdHRyaWJ1dGVBcnJheWFkZEluZGV4ZWRMaW5lKGluZGV4KSB7XG4gICAgICB0aGlzLnRyaWdnZXIoXCJhZGRXaWRnZXRMaW5lXCIsIHsgaW5kZXg6IGluZGV4IH0pO1xuICAgICAgdGhpcy50cmlnZ2VyKFwiYXJyYXlcIiwgXCJhZGRcIiwgdGhpcywgaW5kZXgpO1xuICAgIH1cbiAgfSk7XG59KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///0ed68aa34b095f87d8dd\n");

/***/ }),

/***/ "102a2812abe6ba802db9":
/*!***********************************************************************!*\
  !*** ./src/Apps/DOCUMENT/IHM/controllerObjects/attributeInterface.js ***!
  \***********************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/*global define*/\n!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(/*! underscore */ \"8e08e542008e4aef1f58\")], __WEBPACK_AMD_DEFINE_RESULT__ = (function attributeInterface(_) {\n  \"use strict\";\n\n  var AttributPrototype = function AttributePrototype() {\n    this.id = this._attributeModel.id;\n  };\n  /**\n   * Get the property of the current attribute\n   *\n   * @returns {*}\n   */\n  AttributPrototype.prototype.getProperties = function AttributeInterfaceGetProperties() {\n    var properties = _.clone(this._attributeModel.attributes),\n      content = properties.content;\n    properties = _.omit(\n      properties,\n      \"isValueAttribute\",\n      \"title\",\n      \"attributeValue\",\n      \"content\"\n    );\n    properties.content = [];\n    if (content && content.length) {\n      properties.content = content.map(function attributeInterface_convertChild(\n        currentAttribute\n      ) {\n        return new AttributeInterface(currentAttribute);\n      });\n    }\n    return properties;\n  };\n\n  /**\n   * Change the label of an attribute\n   *\n   * @returns {*}\n   */\n  AttributPrototype.prototype.setLabel = function AttributeInterfaceSetLabel(\n    label\n  ) {\n    this._attributeModel.set(\"label\", label);\n  };\n\n  /**\n   * Get the data to build a widget\n   *\n   * @returns {*}\n   */\n  AttributPrototype.prototype.getWidgetData = function AttributeInterfaceGetWidgetData(\n    index\n  ) {\n    return _.clone(this._attributeModel.toData(index, true));\n  };\n\n  /**\n   * Get the attribute label\n   *\n   * @returns string\n   */\n  AttributPrototype.prototype.getLabel = function AttributeInterfaceGetLabel() {\n    return this._attributeModel.get(\"label\");\n  };\n\n  /**\n   * Get the options of the current attribute\n   * @returns {*}\n   */\n  AttributPrototype.prototype.getOptions = function AttributeInterfaceGetOptions() {\n    var options = this._attributeModel.getOptions();\n    return _.clone(options);\n  };\n\n  /**\n   * Get an option of the current attribute\n   *\n   * @param name\n   * @returns {*}\n   */\n  AttributPrototype.prototype.getOption = function AttributeInterfaceGetOption(\n    name\n  ) {\n    return this._attributeModel.getOption(name);\n  };\n\n  /**\n   * Return true if attribute value is changed since last record\n   *\n   * @returns bool\n   */\n  AttributPrototype.prototype.isModified = function AttributeInterfaceisModified() {\n    return this._attributeModel.hasValueChanged();\n  };\n\n  /**\n   * Set an option of the current\n   * Add an effect only on beforeRender\n   * @param name\n   * @param value\n   * @constructor\n   */\n  AttributPrototype.prototype.setOption = function AttributeInterfaceSetOption(\n    name,\n    value\n  ) {\n    this._attributeModel.setOption(name, value);\n  };\n\n  AttributPrototype.prototype.getValue = function AttributeInterfaceGetValue(\n    type\n  ) {\n    if (_.isUndefined(type) || type === \"current\") {\n      return this._attributeModel.get(\"attributeValue\");\n    }\n    if (type === \"previous\") {\n      return this._attributeModel.previous(\"attributeValue\");\n    }\n    if (type === \"initial\") {\n      return this._attributeModel._initialAttributeValue;\n    }\n    if (type === \"all\") {\n      return {\n        current: this._attributeModel.get(\"attributeValue\"),\n        previous: this._attributeModel.previous(\"attributeValue\"),\n        initial: this._attributeModel._initialAttributeValue\n      };\n    }\n    throw new Error(\n      \"Unknown type of getValue (current, previous, initial, all\"\n    );\n  };\n\n  AttributPrototype.prototype.setValue = function AttributeInterfaceSetValue(\n    value,\n    dryRun\n  ) {\n    var index;\n    var currentValue;\n    if (this._attributeModel.get(\"multiple\")) {\n      if (_.isArray(value)) {\n        _.each(value, function AttributeInterfaceSetValueVerify(singleValue) {\n          if (!_.isObject(singleValue) || _.isUndefined(singleValue.value)) {\n            throw new Error(\n              \"Each values must be an object with at least value properties\"\n            );\n          }\n          if (_.isUndefined(singleValue.displayValue)) {\n            singleValue.displayValue =\n              singleValue.value !== null ? String(singleValue.value) : \"\";\n          }\n        });\n      } else {\n        if (\n          !_.isObject(value) ||\n          _.isUndefined(value.value) ||\n          _.isUndefined(value.index) ||\n          value.index === null\n        ) {\n          throw new Error(\n            \"Value must be an object with at least value and index properties\"\n          );\n        }\n\n        index = parseInt(value.index);\n        if (index < 0) {\n          throw new Error(\"Index value must be positive or null\");\n        }\n\n        if (this._attributeModel.isDoubleMultiple()) {\n          if (!_.isArray(value.value)) {\n            throw new Error(\"Value must be an array for multiple in arrays\");\n          }\n          value = value.value;\n        } else {\n          value = _.defaults(value, {\n            displayValue: value.value !== null ? String(value.value) : \"\"\n          });\n        }\n\n        currentValue = this._attributeModel.get(\"attributeValue\").slice();\n        currentValue[index] = _.clone(value);\n        value = currentValue;\n      }\n    } else {\n      if (!_.isObject(value) || _.isUndefined(value.value)) {\n        throw new Error(\n          \"Value must be an object with at least value properties\"\n        );\n      }\n\n      value = _.defaults(value, {\n        displayValue: value.value !== null ? String(value.value) : \"\"\n      });\n    }\n    if (!dryRun) {\n      this._attributeModel.set(\"attributeValue\", value);\n    }\n  };\n\n  AttributPrototype.prototype.toJSON = function AttributeInterfacetoJSON() {\n    return {\n      id: this._attributeModel.id,\n      properties: _.omit(\n        this._attributeModel.attributes,\n        \"isValueAttribute\",\n        \"title\",\n        \"options\",\n        \"attributeValue\"\n      ),\n      options: this._attributeModel.getOptions()\n    };\n  };\n\n  var AttributeInterface = function AttributeInterface(attributeModel) {\n    this._attributeModel = attributeModel;\n    AttributPrototype.call(this);\n  };\n\n  AttributeInterface.prototype = Object.create(AttributPrototype.prototype);\n  AttributeInterface.prototype.constructor = AttributPrototype;\n\n  return AttributeInterface;\n}).apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTAyYTI4MTJhYmU2YmE4MDJkYjkuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvQXBwcy9ET0NVTUVOVC9JSE0vY29udHJvbGxlck9iamVjdHMvYXR0cmlidXRlSW50ZXJmYWNlLmpzPzQ0YTMiXSwic291cmNlc0NvbnRlbnQiOlsiLypnbG9iYWwgZGVmaW5lKi9cbmRlZmluZShbXCJ1bmRlcnNjb3JlXCJdLCBmdW5jdGlvbiBhdHRyaWJ1dGVJbnRlcmZhY2UoXykge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICB2YXIgQXR0cmlidXRQcm90b3R5cGUgPSBmdW5jdGlvbiBBdHRyaWJ1dGVQcm90b3R5cGUoKSB7XG4gICAgdGhpcy5pZCA9IHRoaXMuX2F0dHJpYnV0ZU1vZGVsLmlkO1xuICB9O1xuICAvKipcbiAgICogR2V0IHRoZSBwcm9wZXJ0eSBvZiB0aGUgY3VycmVudCBhdHRyaWJ1dGVcbiAgICpcbiAgICogQHJldHVybnMgeyp9XG4gICAqL1xuICBBdHRyaWJ1dFByb3RvdHlwZS5wcm90b3R5cGUuZ2V0UHJvcGVydGllcyA9IGZ1bmN0aW9uIEF0dHJpYnV0ZUludGVyZmFjZUdldFByb3BlcnRpZXMoKSB7XG4gICAgdmFyIHByb3BlcnRpZXMgPSBfLmNsb25lKHRoaXMuX2F0dHJpYnV0ZU1vZGVsLmF0dHJpYnV0ZXMpLFxuICAgICAgY29udGVudCA9IHByb3BlcnRpZXMuY29udGVudDtcbiAgICBwcm9wZXJ0aWVzID0gXy5vbWl0KFxuICAgICAgcHJvcGVydGllcyxcbiAgICAgIFwiaXNWYWx1ZUF0dHJpYnV0ZVwiLFxuICAgICAgXCJ0aXRsZVwiLFxuICAgICAgXCJhdHRyaWJ1dGVWYWx1ZVwiLFxuICAgICAgXCJjb250ZW50XCJcbiAgICApO1xuICAgIHByb3BlcnRpZXMuY29udGVudCA9IFtdO1xuICAgIGlmIChjb250ZW50ICYmIGNvbnRlbnQubGVuZ3RoKSB7XG4gICAgICBwcm9wZXJ0aWVzLmNvbnRlbnQgPSBjb250ZW50Lm1hcChmdW5jdGlvbiBhdHRyaWJ1dGVJbnRlcmZhY2VfY29udmVydENoaWxkKFxuICAgICAgICBjdXJyZW50QXR0cmlidXRlXG4gICAgICApIHtcbiAgICAgICAgcmV0dXJuIG5ldyBBdHRyaWJ1dGVJbnRlcmZhY2UoY3VycmVudEF0dHJpYnV0ZSk7XG4gICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIHByb3BlcnRpZXM7XG4gIH07XG5cbiAgLyoqXG4gICAqIENoYW5nZSB0aGUgbGFiZWwgb2YgYW4gYXR0cmlidXRlXG4gICAqXG4gICAqIEByZXR1cm5zIHsqfVxuICAgKi9cbiAgQXR0cmlidXRQcm90b3R5cGUucHJvdG90eXBlLnNldExhYmVsID0gZnVuY3Rpb24gQXR0cmlidXRlSW50ZXJmYWNlU2V0TGFiZWwoXG4gICAgbGFiZWxcbiAgKSB7XG4gICAgdGhpcy5fYXR0cmlidXRlTW9kZWwuc2V0KFwibGFiZWxcIiwgbGFiZWwpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBHZXQgdGhlIGRhdGEgdG8gYnVpbGQgYSB3aWRnZXRcbiAgICpcbiAgICogQHJldHVybnMgeyp9XG4gICAqL1xuICBBdHRyaWJ1dFByb3RvdHlwZS5wcm90b3R5cGUuZ2V0V2lkZ2V0RGF0YSA9IGZ1bmN0aW9uIEF0dHJpYnV0ZUludGVyZmFjZUdldFdpZGdldERhdGEoXG4gICAgaW5kZXhcbiAgKSB7XG4gICAgcmV0dXJuIF8uY2xvbmUodGhpcy5fYXR0cmlidXRlTW9kZWwudG9EYXRhKGluZGV4LCB0cnVlKSk7XG4gIH07XG5cbiAgLyoqXG4gICAqIEdldCB0aGUgYXR0cmlidXRlIGxhYmVsXG4gICAqXG4gICAqIEByZXR1cm5zIHN0cmluZ1xuICAgKi9cbiAgQXR0cmlidXRQcm90b3R5cGUucHJvdG90eXBlLmdldExhYmVsID0gZnVuY3Rpb24gQXR0cmlidXRlSW50ZXJmYWNlR2V0TGFiZWwoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2F0dHJpYnV0ZU1vZGVsLmdldChcImxhYmVsXCIpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBHZXQgdGhlIG9wdGlvbnMgb2YgdGhlIGN1cnJlbnQgYXR0cmlidXRlXG4gICAqIEByZXR1cm5zIHsqfVxuICAgKi9cbiAgQXR0cmlidXRQcm90b3R5cGUucHJvdG90eXBlLmdldE9wdGlvbnMgPSBmdW5jdGlvbiBBdHRyaWJ1dGVJbnRlcmZhY2VHZXRPcHRpb25zKCkge1xuICAgIHZhciBvcHRpb25zID0gdGhpcy5fYXR0cmlidXRlTW9kZWwuZ2V0T3B0aW9ucygpO1xuICAgIHJldHVybiBfLmNsb25lKG9wdGlvbnMpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBHZXQgYW4gb3B0aW9uIG9mIHRoZSBjdXJyZW50IGF0dHJpYnV0ZVxuICAgKlxuICAgKiBAcGFyYW0gbmFtZVxuICAgKiBAcmV0dXJucyB7Kn1cbiAgICovXG4gIEF0dHJpYnV0UHJvdG90eXBlLnByb3RvdHlwZS5nZXRPcHRpb24gPSBmdW5jdGlvbiBBdHRyaWJ1dGVJbnRlcmZhY2VHZXRPcHRpb24oXG4gICAgbmFtZVxuICApIHtcbiAgICByZXR1cm4gdGhpcy5fYXR0cmlidXRlTW9kZWwuZ2V0T3B0aW9uKG5hbWUpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBSZXR1cm4gdHJ1ZSBpZiBhdHRyaWJ1dGUgdmFsdWUgaXMgY2hhbmdlZCBzaW5jZSBsYXN0IHJlY29yZFxuICAgKlxuICAgKiBAcmV0dXJucyBib29sXG4gICAqL1xuICBBdHRyaWJ1dFByb3RvdHlwZS5wcm90b3R5cGUuaXNNb2RpZmllZCA9IGZ1bmN0aW9uIEF0dHJpYnV0ZUludGVyZmFjZWlzTW9kaWZpZWQoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2F0dHJpYnV0ZU1vZGVsLmhhc1ZhbHVlQ2hhbmdlZCgpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBTZXQgYW4gb3B0aW9uIG9mIHRoZSBjdXJyZW50XG4gICAqIEFkZCBhbiBlZmZlY3Qgb25seSBvbiBiZWZvcmVSZW5kZXJcbiAgICogQHBhcmFtIG5hbWVcbiAgICogQHBhcmFtIHZhbHVlXG4gICAqIEBjb25zdHJ1Y3RvclxuICAgKi9cbiAgQXR0cmlidXRQcm90b3R5cGUucHJvdG90eXBlLnNldE9wdGlvbiA9IGZ1bmN0aW9uIEF0dHJpYnV0ZUludGVyZmFjZVNldE9wdGlvbihcbiAgICBuYW1lLFxuICAgIHZhbHVlXG4gICkge1xuICAgIHRoaXMuX2F0dHJpYnV0ZU1vZGVsLnNldE9wdGlvbihuYW1lLCB2YWx1ZSk7XG4gIH07XG5cbiAgQXR0cmlidXRQcm90b3R5cGUucHJvdG90eXBlLmdldFZhbHVlID0gZnVuY3Rpb24gQXR0cmlidXRlSW50ZXJmYWNlR2V0VmFsdWUoXG4gICAgdHlwZVxuICApIHtcbiAgICBpZiAoXy5pc1VuZGVmaW5lZCh0eXBlKSB8fCB0eXBlID09PSBcImN1cnJlbnRcIikge1xuICAgICAgcmV0dXJuIHRoaXMuX2F0dHJpYnV0ZU1vZGVsLmdldChcImF0dHJpYnV0ZVZhbHVlXCIpO1xuICAgIH1cbiAgICBpZiAodHlwZSA9PT0gXCJwcmV2aW91c1wiKSB7XG4gICAgICByZXR1cm4gdGhpcy5fYXR0cmlidXRlTW9kZWwucHJldmlvdXMoXCJhdHRyaWJ1dGVWYWx1ZVwiKTtcbiAgICB9XG4gICAgaWYgKHR5cGUgPT09IFwiaW5pdGlhbFwiKSB7XG4gICAgICByZXR1cm4gdGhpcy5fYXR0cmlidXRlTW9kZWwuX2luaXRpYWxBdHRyaWJ1dGVWYWx1ZTtcbiAgICB9XG4gICAgaWYgKHR5cGUgPT09IFwiYWxsXCIpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGN1cnJlbnQ6IHRoaXMuX2F0dHJpYnV0ZU1vZGVsLmdldChcImF0dHJpYnV0ZVZhbHVlXCIpLFxuICAgICAgICBwcmV2aW91czogdGhpcy5fYXR0cmlidXRlTW9kZWwucHJldmlvdXMoXCJhdHRyaWJ1dGVWYWx1ZVwiKSxcbiAgICAgICAgaW5pdGlhbDogdGhpcy5fYXR0cmlidXRlTW9kZWwuX2luaXRpYWxBdHRyaWJ1dGVWYWx1ZVxuICAgICAgfTtcbiAgICB9XG4gICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgXCJVbmtub3duIHR5cGUgb2YgZ2V0VmFsdWUgKGN1cnJlbnQsIHByZXZpb3VzLCBpbml0aWFsLCBhbGxcIlxuICAgICk7XG4gIH07XG5cbiAgQXR0cmlidXRQcm90b3R5cGUucHJvdG90eXBlLnNldFZhbHVlID0gZnVuY3Rpb24gQXR0cmlidXRlSW50ZXJmYWNlU2V0VmFsdWUoXG4gICAgdmFsdWUsXG4gICAgZHJ5UnVuXG4gICkge1xuICAgIHZhciBpbmRleDtcbiAgICB2YXIgY3VycmVudFZhbHVlO1xuICAgIGlmICh0aGlzLl9hdHRyaWJ1dGVNb2RlbC5nZXQoXCJtdWx0aXBsZVwiKSkge1xuICAgICAgaWYgKF8uaXNBcnJheSh2YWx1ZSkpIHtcbiAgICAgICAgXy5lYWNoKHZhbHVlLCBmdW5jdGlvbiBBdHRyaWJ1dGVJbnRlcmZhY2VTZXRWYWx1ZVZlcmlmeShzaW5nbGVWYWx1ZSkge1xuICAgICAgICAgIGlmICghXy5pc09iamVjdChzaW5nbGVWYWx1ZSkgfHwgXy5pc1VuZGVmaW5lZChzaW5nbGVWYWx1ZS52YWx1ZSkpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAgICAgXCJFYWNoIHZhbHVlcyBtdXN0IGJlIGFuIG9iamVjdCB3aXRoIGF0IGxlYXN0IHZhbHVlIHByb3BlcnRpZXNcIlxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKF8uaXNVbmRlZmluZWQoc2luZ2xlVmFsdWUuZGlzcGxheVZhbHVlKSkge1xuICAgICAgICAgICAgc2luZ2xlVmFsdWUuZGlzcGxheVZhbHVlID1cbiAgICAgICAgICAgICAgc2luZ2xlVmFsdWUudmFsdWUgIT09IG51bGwgPyBTdHJpbmcoc2luZ2xlVmFsdWUudmFsdWUpIDogXCJcIjtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKFxuICAgICAgICAgICFfLmlzT2JqZWN0KHZhbHVlKSB8fFxuICAgICAgICAgIF8uaXNVbmRlZmluZWQodmFsdWUudmFsdWUpIHx8XG4gICAgICAgICAgXy5pc1VuZGVmaW5lZCh2YWx1ZS5pbmRleCkgfHxcbiAgICAgICAgICB2YWx1ZS5pbmRleCA9PT0gbnVsbFxuICAgICAgICApIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgICBcIlZhbHVlIG11c3QgYmUgYW4gb2JqZWN0IHdpdGggYXQgbGVhc3QgdmFsdWUgYW5kIGluZGV4IHByb3BlcnRpZXNcIlxuICAgICAgICAgICk7XG4gICAgICAgIH1cblxuICAgICAgICBpbmRleCA9IHBhcnNlSW50KHZhbHVlLmluZGV4KTtcbiAgICAgICAgaWYgKGluZGV4IDwgMCkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkluZGV4IHZhbHVlIG11c3QgYmUgcG9zaXRpdmUgb3IgbnVsbFwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLl9hdHRyaWJ1dGVNb2RlbC5pc0RvdWJsZU11bHRpcGxlKCkpIHtcbiAgICAgICAgICBpZiAoIV8uaXNBcnJheSh2YWx1ZS52YWx1ZSkpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlZhbHVlIG11c3QgYmUgYW4gYXJyYXkgZm9yIG11bHRpcGxlIGluIGFycmF5c1wiKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgdmFsdWUgPSB2YWx1ZS52YWx1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB2YWx1ZSA9IF8uZGVmYXVsdHModmFsdWUsIHtcbiAgICAgICAgICAgIGRpc3BsYXlWYWx1ZTogdmFsdWUudmFsdWUgIT09IG51bGwgPyBTdHJpbmcodmFsdWUudmFsdWUpIDogXCJcIlxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgY3VycmVudFZhbHVlID0gdGhpcy5fYXR0cmlidXRlTW9kZWwuZ2V0KFwiYXR0cmlidXRlVmFsdWVcIikuc2xpY2UoKTtcbiAgICAgICAgY3VycmVudFZhbHVlW2luZGV4XSA9IF8uY2xvbmUodmFsdWUpO1xuICAgICAgICB2YWx1ZSA9IGN1cnJlbnRWYWx1ZTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKCFfLmlzT2JqZWN0KHZhbHVlKSB8fCBfLmlzVW5kZWZpbmVkKHZhbHVlLnZhbHVlKSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgXCJWYWx1ZSBtdXN0IGJlIGFuIG9iamVjdCB3aXRoIGF0IGxlYXN0IHZhbHVlIHByb3BlcnRpZXNcIlxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICB2YWx1ZSA9IF8uZGVmYXVsdHModmFsdWUsIHtcbiAgICAgICAgZGlzcGxheVZhbHVlOiB2YWx1ZS52YWx1ZSAhPT0gbnVsbCA/IFN0cmluZyh2YWx1ZS52YWx1ZSkgOiBcIlwiXG4gICAgICB9KTtcbiAgICB9XG4gICAgaWYgKCFkcnlSdW4pIHtcbiAgICAgIHRoaXMuX2F0dHJpYnV0ZU1vZGVsLnNldChcImF0dHJpYnV0ZVZhbHVlXCIsIHZhbHVlKTtcbiAgICB9XG4gIH07XG5cbiAgQXR0cmlidXRQcm90b3R5cGUucHJvdG90eXBlLnRvSlNPTiA9IGZ1bmN0aW9uIEF0dHJpYnV0ZUludGVyZmFjZXRvSlNPTigpIHtcbiAgICByZXR1cm4ge1xuICAgICAgaWQ6IHRoaXMuX2F0dHJpYnV0ZU1vZGVsLmlkLFxuICAgICAgcHJvcGVydGllczogXy5vbWl0KFxuICAgICAgICB0aGlzLl9hdHRyaWJ1dGVNb2RlbC5hdHRyaWJ1dGVzLFxuICAgICAgICBcImlzVmFsdWVBdHRyaWJ1dGVcIixcbiAgICAgICAgXCJ0aXRsZVwiLFxuICAgICAgICBcIm9wdGlvbnNcIixcbiAgICAgICAgXCJhdHRyaWJ1dGVWYWx1ZVwiXG4gICAgICApLFxuICAgICAgb3B0aW9uczogdGhpcy5fYXR0cmlidXRlTW9kZWwuZ2V0T3B0aW9ucygpXG4gICAgfTtcbiAgfTtcblxuICB2YXIgQXR0cmlidXRlSW50ZXJmYWNlID0gZnVuY3Rpb24gQXR0cmlidXRlSW50ZXJmYWNlKGF0dHJpYnV0ZU1vZGVsKSB7XG4gICAgdGhpcy5fYXR0cmlidXRlTW9kZWwgPSBhdHRyaWJ1dGVNb2RlbDtcbiAgICBBdHRyaWJ1dFByb3RvdHlwZS5jYWxsKHRoaXMpO1xuICB9O1xuXG4gIEF0dHJpYnV0ZUludGVyZmFjZS5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKEF0dHJpYnV0UHJvdG90eXBlLnByb3RvdHlwZSk7XG4gIEF0dHJpYnV0ZUludGVyZmFjZS5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBBdHRyaWJ1dFByb3RvdHlwZTtcblxuICByZXR1cm4gQXR0cmlidXRlSW50ZXJmYWNlO1xufSk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///102a2812abe6ba802db9\n");

/***/ }),

/***/ "11e1c9c4ee0385434097":
/*!*************************************************************!*\
  !*** ./src/Apps/DOCUMENT/IHM/models/mDocumentProperties.js ***!
  \*************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/*global define*/\n!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(/*! underscore */ \"8e08e542008e4aef1f58\"), __webpack_require__(/*! backbone */ \"1858b45bf48591489d06\")], __WEBPACK_AMD_DEFINE_RESULT__ = (function(_, Backbone) {\n  \"use strict\";\n\n  return Backbone.Model.extend({\n    typeModel: \"ddui:properties\"\n  });\n}).apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTFlMWM5YzRlZTAzODU0MzQwOTcuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvQXBwcy9ET0NVTUVOVC9JSE0vbW9kZWxzL21Eb2N1bWVudFByb3BlcnRpZXMuanM/YTI5MSJdLCJzb3VyY2VzQ29udGVudCI6WyIvKmdsb2JhbCBkZWZpbmUqL1xuZGVmaW5lKFtcInVuZGVyc2NvcmVcIiwgXCJiYWNrYm9uZVwiXSwgZnVuY3Rpb24oXywgQmFja2JvbmUpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgcmV0dXJuIEJhY2tib25lLk1vZGVsLmV4dGVuZCh7XG4gICAgdHlwZU1vZGVsOiBcImRkdWk6cHJvcGVydGllc1wiXG4gIH0pO1xufSk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///11e1c9c4ee0385434097\n");

/***/ }),

/***/ "127c8cf59f228bb01a21":
/*!*************************!*\
  !*** external "jQuery" ***!
  \*************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("module.exports = jQuery;//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTI3YzhjZjU5ZjIyOGJiMDFhMjEuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vZXh0ZXJuYWwgXCJqUXVlcnlcIj9jZDBjIl0sInNvdXJjZXNDb250ZW50IjpbIm1vZHVsZS5leHBvcnRzID0galF1ZXJ5OyJdLCJtYXBwaW5ncyI6IkFBQUEiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///127c8cf59f228bb01a21\n");

/***/ }),

/***/ "1858b45bf48591489d06":
/*!*******************************************!*\
  !*** ./node_modules/backbone/backbone.js ***!
  \*******************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("/* WEBPACK VAR INJECTION */(function(global) {var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;//     Backbone.js 1.3.3\n\n//     (c) 2010-2016 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors\n//     Backbone may be freely distributed under the MIT license.\n//     For all details and documentation:\n//     http://backbonejs.org\n\n(function(factory) {\n\n  // Establish the root object, `window` (`self`) in the browser, or `global` on the server.\n  // We use `self` instead of `window` for `WebWorker` support.\n  var root = (typeof self == 'object' && self.self === self && self) ||\n            (typeof global == 'object' && global.global === global && global);\n\n  // Set up Backbone appropriately for the environment. Start with AMD.\n  if (true) {\n    !(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(/*! underscore */ \"8e08e542008e4aef1f58\"), __webpack_require__(/*! jquery */ \"127c8cf59f228bb01a21\"), exports], __WEBPACK_AMD_DEFINE_RESULT__ = (function(_, $, exports) {\n      // Export global even in AMD case in case this script is loaded with\n      // others that may still expect a global Backbone.\n      root.Backbone = factory(root, exports, _, $);\n    }).apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\n  // Next for Node.js or CommonJS. jQuery may not be needed as a module.\n  } else { var _, $; }\n\n})(function(root, Backbone, _, $) {\n\n  // Initial Setup\n  // -------------\n\n  // Save the previous value of the `Backbone` variable, so that it can be\n  // restored later on, if `noConflict` is used.\n  var previousBackbone = root.Backbone;\n\n  // Create a local reference to a common array method we'll want to use later.\n  var slice = Array.prototype.slice;\n\n  // Current version of the library. Keep in sync with `package.json`.\n  Backbone.VERSION = '1.3.3';\n\n  // For Backbone's purposes, jQuery, Zepto, Ender, or My Library (kidding) owns\n  // the `$` variable.\n  Backbone.$ = $;\n\n  // Runs Backbone.js in *noConflict* mode, returning the `Backbone` variable\n  // to its previous owner. Returns a reference to this Backbone object.\n  Backbone.noConflict = function() {\n    root.Backbone = previousBackbone;\n    return this;\n  };\n\n  // Turn on `emulateHTTP` to support legacy HTTP servers. Setting this option\n  // will fake `\"PATCH\"`, `\"PUT\"` and `\"DELETE\"` requests via the `_method` parameter and\n  // set a `X-Http-Method-Override` header.\n  Backbone.emulateHTTP = false;\n\n  // Turn on `emulateJSON` to support legacy servers that can't deal with direct\n  // `application/json` requests ... this will encode the body as\n  // `application/x-www-form-urlencoded` instead and will send the model in a\n  // form param named `model`.\n  Backbone.emulateJSON = false;\n\n  // Proxy Backbone class methods to Underscore functions, wrapping the model's\n  // `attributes` object or collection's `models` array behind the scenes.\n  //\n  // collection.filter(function(model) { return model.get('age') > 10 });\n  // collection.each(this.addView);\n  //\n  // `Function#apply` can be slow so we use the method's arg count, if we know it.\n  var addMethod = function(length, method, attribute) {\n    switch (length) {\n      case 1: return function() {\n        return _[method](this[attribute]);\n      };\n      case 2: return function(value) {\n        return _[method](this[attribute], value);\n      };\n      case 3: return function(iteratee, context) {\n        return _[method](this[attribute], cb(iteratee, this), context);\n      };\n      case 4: return function(iteratee, defaultVal, context) {\n        return _[method](this[attribute], cb(iteratee, this), defaultVal, context);\n      };\n      default: return function() {\n        var args = slice.call(arguments);\n        args.unshift(this[attribute]);\n        return _[method].apply(_, args);\n      };\n    }\n  };\n  var addUnderscoreMethods = function(Class, methods, attribute) {\n    _.each(methods, function(length, method) {\n      if (_[method]) Class.prototype[method] = addMethod(length, method, attribute);\n    });\n  };\n\n  // Support `collection.sortBy('attr')` and `collection.findWhere({id: 1})`.\n  var cb = function(iteratee, instance) {\n    if (_.isFunction(iteratee)) return iteratee;\n    if (_.isObject(iteratee) && !instance._isModel(iteratee)) return modelMatcher(iteratee);\n    if (_.isString(iteratee)) return function(model) { return model.get(iteratee); };\n    return iteratee;\n  };\n  var modelMatcher = function(attrs) {\n    var matcher = _.matches(attrs);\n    return function(model) {\n      return matcher(model.attributes);\n    };\n  };\n\n  // Backbone.Events\n  // ---------------\n\n  // A module that can be mixed in to *any object* in order to provide it with\n  // a custom event channel. You may bind a callback to an event with `on` or\n  // remove with `off`; `trigger`-ing an event fires all callbacks in\n  // succession.\n  //\n  //     var object = {};\n  //     _.extend(object, Backbone.Events);\n  //     object.on('expand', function(){ alert('expanded'); });\n  //     object.trigger('expand');\n  //\n  var Events = Backbone.Events = {};\n\n  // Regular expression used to split event strings.\n  var eventSplitter = /\\s+/;\n\n  // Iterates over the standard `event, callback` (as well as the fancy multiple\n  // space-separated events `\"change blur\", callback` and jQuery-style event\n  // maps `{event: callback}`).\n  var eventsApi = function(iteratee, events, name, callback, opts) {\n    var i = 0, names;\n    if (name && typeof name === 'object') {\n      // Handle event maps.\n      if (callback !== void 0 && 'context' in opts && opts.context === void 0) opts.context = callback;\n      for (names = _.keys(name); i < names.length ; i++) {\n        events = eventsApi(iteratee, events, names[i], name[names[i]], opts);\n      }\n    } else if (name && eventSplitter.test(name)) {\n      // Handle space-separated event names by delegating them individually.\n      for (names = name.split(eventSplitter); i < names.length; i++) {\n        events = iteratee(events, names[i], callback, opts);\n      }\n    } else {\n      // Finally, standard events.\n      events = iteratee(events, name, callback, opts);\n    }\n    return events;\n  };\n\n  // Bind an event to a `callback` function. Passing `\"all\"` will bind\n  // the callback to all events fired.\n  Events.on = function(name, callback, context) {\n    return internalOn(this, name, callback, context);\n  };\n\n  // Guard the `listening` argument from the public API.\n  var internalOn = function(obj, name, callback, context, listening) {\n    obj._events = eventsApi(onApi, obj._events || {}, name, callback, {\n      context: context,\n      ctx: obj,\n      listening: listening\n    });\n\n    if (listening) {\n      var listeners = obj._listeners || (obj._listeners = {});\n      listeners[listening.id] = listening;\n    }\n\n    return obj;\n  };\n\n  // Inversion-of-control versions of `on`. Tell *this* object to listen to\n  // an event in another object... keeping track of what it's listening to\n  // for easier unbinding later.\n  Events.listenTo = function(obj, name, callback) {\n    if (!obj) return this;\n    var id = obj._listenId || (obj._listenId = _.uniqueId('l'));\n    var listeningTo = this._listeningTo || (this._listeningTo = {});\n    var listening = listeningTo[id];\n\n    // This object is not listening to any other events on `obj` yet.\n    // Setup the necessary references to track the listening callbacks.\n    if (!listening) {\n      var thisId = this._listenId || (this._listenId = _.uniqueId('l'));\n      listening = listeningTo[id] = {obj: obj, objId: id, id: thisId, listeningTo: listeningTo, count: 0};\n    }\n\n    // Bind callbacks on obj, and keep track of them on listening.\n    internalOn(obj, name, callback, this, listening);\n    return this;\n  };\n\n  // The reducing API that adds a callback to the `events` object.\n  var onApi = function(events, name, callback, options) {\n    if (callback) {\n      var handlers = events[name] || (events[name] = []);\n      var context = options.context, ctx = options.ctx, listening = options.listening;\n      if (listening) listening.count++;\n\n      handlers.push({callback: callback, context: context, ctx: context || ctx, listening: listening});\n    }\n    return events;\n  };\n\n  // Remove one or many callbacks. If `context` is null, removes all\n  // callbacks with that function. If `callback` is null, removes all\n  // callbacks for the event. If `name` is null, removes all bound\n  // callbacks for all events.\n  Events.off = function(name, callback, context) {\n    if (!this._events) return this;\n    this._events = eventsApi(offApi, this._events, name, callback, {\n      context: context,\n      listeners: this._listeners\n    });\n    return this;\n  };\n\n  // Tell this object to stop listening to either specific events ... or\n  // to every object it's currently listening to.\n  Events.stopListening = function(obj, name, callback) {\n    var listeningTo = this._listeningTo;\n    if (!listeningTo) return this;\n\n    var ids = obj ? [obj._listenId] : _.keys(listeningTo);\n\n    for (var i = 0; i < ids.length; i++) {\n      var listening = listeningTo[ids[i]];\n\n      // If listening doesn't exist, this object is not currently\n      // listening to obj. Break out early.\n      if (!listening) break;\n\n      listening.obj.off(name, callback, this);\n    }\n\n    return this;\n  };\n\n  // The reducing API that removes a callback from the `events` object.\n  var offApi = function(events, name, callback, options) {\n    if (!events) return;\n\n    var i = 0, listening;\n    var context = options.context, listeners = options.listeners;\n\n    // Delete all events listeners and \"drop\" events.\n    if (!name && !callback && !context) {\n      var ids = _.keys(listeners);\n      for (; i < ids.length; i++) {\n        listening = listeners[ids[i]];\n        delete listeners[listening.id];\n        delete listening.listeningTo[listening.objId];\n      }\n      return;\n    }\n\n    var names = name ? [name] : _.keys(events);\n    for (; i < names.length; i++) {\n      name = names[i];\n      var handlers = events[name];\n\n      // Bail out if there are no events stored.\n      if (!handlers) break;\n\n      // Replace events if there are any remaining.  Otherwise, clean up.\n      var remaining = [];\n      for (var j = 0; j < handlers.length; j++) {\n        var handler = handlers[j];\n        if (\n          callback && callback !== handler.callback &&\n            callback !== handler.callback._callback ||\n              context && context !== handler.context\n        ) {\n          remaining.push(handler);\n        } else {\n          listening = handler.listening;\n          if (listening && --listening.count === 0) {\n            delete listeners[listening.id];\n            delete listening.listeningTo[listening.objId];\n          }\n        }\n      }\n\n      // Update tail event if the list has any events.  Otherwise, clean up.\n      if (remaining.length) {\n        events[name] = remaining;\n      } else {\n        delete events[name];\n      }\n    }\n    return events;\n  };\n\n  // Bind an event to only be triggered a single time. After the first time\n  // the callback is invoked, its listener will be removed. If multiple events\n  // are passed in using the space-separated syntax, the handler will fire\n  // once for each event, not once for a combination of all events.\n  Events.once = function(name, callback, context) {\n    // Map the event into a `{event: once}` object.\n    var events = eventsApi(onceMap, {}, name, callback, _.bind(this.off, this));\n    if (typeof name === 'string' && context == null) callback = void 0;\n    return this.on(events, callback, context);\n  };\n\n  // Inversion-of-control versions of `once`.\n  Events.listenToOnce = function(obj, name, callback) {\n    // Map the event into a `{event: once}` object.\n    var events = eventsApi(onceMap, {}, name, callback, _.bind(this.stopListening, this, obj));\n    return this.listenTo(obj, events);\n  };\n\n  // Reduces the event callbacks into a map of `{event: onceWrapper}`.\n  // `offer` unbinds the `onceWrapper` after it has been called.\n  var onceMap = function(map, name, callback, offer) {\n    if (callback) {\n      var once = map[name] = _.once(function() {\n        offer(name, once);\n        callback.apply(this, arguments);\n      });\n      once._callback = callback;\n    }\n    return map;\n  };\n\n  // Trigger one or many events, firing all bound callbacks. Callbacks are\n  // passed the same arguments as `trigger` is, apart from the event name\n  // (unless you're listening on `\"all\"`, which will cause your callback to\n  // receive the true name of the event as the first argument).\n  Events.trigger = function(name) {\n    if (!this._events) return this;\n\n    var length = Math.max(0, arguments.length - 1);\n    var args = Array(length);\n    for (var i = 0; i < length; i++) args[i] = arguments[i + 1];\n\n    eventsApi(triggerApi, this._events, name, void 0, args);\n    return this;\n  };\n\n  // Handles triggering the appropriate event callbacks.\n  var triggerApi = function(objEvents, name, callback, args) {\n    if (objEvents) {\n      var events = objEvents[name];\n      var allEvents = objEvents.all;\n      if (events && allEvents) allEvents = allEvents.slice();\n      if (events) triggerEvents(events, args);\n      if (allEvents) triggerEvents(allEvents, [name].concat(args));\n    }\n    return objEvents;\n  };\n\n  // A difficult-to-believe, but optimized internal dispatch function for\n  // triggering events. Tries to keep the usual cases speedy (most internal\n  // Backbone events have 3 arguments).\n  var triggerEvents = function(events, args) {\n    var ev, i = -1, l = events.length, a1 = args[0], a2 = args[1], a3 = args[2];\n    switch (args.length) {\n      case 0: while (++i < l) (ev = events[i]).callback.call(ev.ctx); return;\n      case 1: while (++i < l) (ev = events[i]).callback.call(ev.ctx, a1); return;\n      case 2: while (++i < l) (ev = events[i]).callback.call(ev.ctx, a1, a2); return;\n      case 3: while (++i < l) (ev = events[i]).callback.call(ev.ctx, a1, a2, a3); return;\n      default: while (++i < l) (ev = events[i]).callback.apply(ev.ctx, args); return;\n    }\n  };\n\n  // Aliases for backwards compatibility.\n  Events.bind   = Events.on;\n  Events.unbind = Events.off;\n\n  // Allow the `Backbone` object to serve as a global event bus, for folks who\n  // want global \"pubsub\" in a convenient place.\n  _.extend(Backbone, Events);\n\n  // Backbone.Model\n  // --------------\n\n  // Backbone **Models** are the basic data object in the framework --\n  // frequently representing a row in a table in a database on your server.\n  // A discrete chunk of data and a bunch of useful, related methods for\n  // performing computations and transformations on that data.\n\n  // Create a new model with the specified attributes. A client id (`cid`)\n  // is automatically generated and assigned for you.\n  var Model = Backbone.Model = function(attributes, options) {\n    var attrs = attributes || {};\n    options || (options = {});\n    this.cid = _.uniqueId(this.cidPrefix);\n    this.attributes = {};\n    if (options.collection) this.collection = options.collection;\n    if (options.parse) attrs = this.parse(attrs, options) || {};\n    var defaults = _.result(this, 'defaults');\n    attrs = _.defaults(_.extend({}, defaults, attrs), defaults);\n    this.set(attrs, options);\n    this.changed = {};\n    this.initialize.apply(this, arguments);\n  };\n\n  // Attach all inheritable methods to the Model prototype.\n  _.extend(Model.prototype, Events, {\n\n    // A hash of attributes whose current and previous value differ.\n    changed: null,\n\n    // The value returned during the last failed validation.\n    validationError: null,\n\n    // The default name for the JSON `id` attribute is `\"id\"`. MongoDB and\n    // CouchDB users may want to set this to `\"_id\"`.\n    idAttribute: 'id',\n\n    // The prefix is used to create the client id which is used to identify models locally.\n    // You may want to override this if you're experiencing name clashes with model ids.\n    cidPrefix: 'c',\n\n    // Initialize is an empty function by default. Override it with your own\n    // initialization logic.\n    initialize: function(){},\n\n    // Return a copy of the model's `attributes` object.\n    toJSON: function(options) {\n      return _.clone(this.attributes);\n    },\n\n    // Proxy `Backbone.sync` by default -- but override this if you need\n    // custom syncing semantics for *this* particular model.\n    sync: function() {\n      return Backbone.sync.apply(this, arguments);\n    },\n\n    // Get the value of an attribute.\n    get: function(attr) {\n      return this.attributes[attr];\n    },\n\n    // Get the HTML-escaped value of an attribute.\n    escape: function(attr) {\n      return _.escape(this.get(attr));\n    },\n\n    // Returns `true` if the attribute contains a value that is not null\n    // or undefined.\n    has: function(attr) {\n      return this.get(attr) != null;\n    },\n\n    // Special-cased proxy to underscore's `_.matches` method.\n    matches: function(attrs) {\n      return !!_.iteratee(attrs, this)(this.attributes);\n    },\n\n    // Set a hash of model attributes on the object, firing `\"change\"`. This is\n    // the core primitive operation of a model, updating the data and notifying\n    // anyone who needs to know about the change in state. The heart of the beast.\n    set: function(key, val, options) {\n      if (key == null) return this;\n\n      // Handle both `\"key\", value` and `{key: value}` -style arguments.\n      var attrs;\n      if (typeof key === 'object') {\n        attrs = key;\n        options = val;\n      } else {\n        (attrs = {})[key] = val;\n      }\n\n      options || (options = {});\n\n      // Run validation.\n      if (!this._validate(attrs, options)) return false;\n\n      // Extract attributes and options.\n      var unset      = options.unset;\n      var silent     = options.silent;\n      var changes    = [];\n      var changing   = this._changing;\n      this._changing = true;\n\n      if (!changing) {\n        this._previousAttributes = _.clone(this.attributes);\n        this.changed = {};\n      }\n\n      var current = this.attributes;\n      var changed = this.changed;\n      var prev    = this._previousAttributes;\n\n      // For each `set` attribute, update or delete the current value.\n      for (var attr in attrs) {\n        val = attrs[attr];\n        if (!_.isEqual(current[attr], val)) changes.push(attr);\n        if (!_.isEqual(prev[attr], val)) {\n          changed[attr] = val;\n        } else {\n          delete changed[attr];\n        }\n        unset ? delete current[attr] : current[attr] = val;\n      }\n\n      // Update the `id`.\n      if (this.idAttribute in attrs) this.id = this.get(this.idAttribute);\n\n      // Trigger all relevant attribute changes.\n      if (!silent) {\n        if (changes.length) this._pending = options;\n        for (var i = 0; i < changes.length; i++) {\n          this.trigger('change:' + changes[i], this, current[changes[i]], options);\n        }\n      }\n\n      // You might be wondering why there's a `while` loop here. Changes can\n      // be recursively nested within `\"change\"` events.\n      if (changing) return this;\n      if (!silent) {\n        while (this._pending) {\n          options = this._pending;\n          this._pending = false;\n          this.trigger('change', this, options);\n        }\n      }\n      this._pending = false;\n      this._changing = false;\n      return this;\n    },\n\n    // Remove an attribute from the model, firing `\"change\"`. `unset` is a noop\n    // if the attribute doesn't exist.\n    unset: function(attr, options) {\n      return this.set(attr, void 0, _.extend({}, options, {unset: true}));\n    },\n\n    // Clear all attributes on the model, firing `\"change\"`.\n    clear: function(options) {\n      var attrs = {};\n      for (var key in this.attributes) attrs[key] = void 0;\n      return this.set(attrs, _.extend({}, options, {unset: true}));\n    },\n\n    // Determine if the model has changed since the last `\"change\"` event.\n    // If you specify an attribute name, determine if that attribute has changed.\n    hasChanged: function(attr) {\n      if (attr == null) return !_.isEmpty(this.changed);\n      return _.has(this.changed, attr);\n    },\n\n    // Return an object containing all the attributes that have changed, or\n    // false if there are no changed attributes. Useful for determining what\n    // parts of a view need to be updated and/or what attributes need to be\n    // persisted to the server. Unset attributes will be set to undefined.\n    // You can also pass an attributes object to diff against the model,\n    // determining if there *would be* a change.\n    changedAttributes: function(diff) {\n      if (!diff) return this.hasChanged() ? _.clone(this.changed) : false;\n      var old = this._changing ? this._previousAttributes : this.attributes;\n      var changed = {};\n      for (var attr in diff) {\n        var val = diff[attr];\n        if (_.isEqual(old[attr], val)) continue;\n        changed[attr] = val;\n      }\n      return _.size(changed) ? changed : false;\n    },\n\n    // Get the previous value of an attribute, recorded at the time the last\n    // `\"change\"` event was fired.\n    previous: function(attr) {\n      if (attr == null || !this._previousAttributes) return null;\n      return this._previousAttributes[attr];\n    },\n\n    // Get all of the attributes of the model at the time of the previous\n    // `\"change\"` event.\n    previousAttributes: function() {\n      return _.clone(this._previousAttributes);\n    },\n\n    // Fetch the model from the server, merging the response with the model's\n    // local attributes. Any changed attributes will trigger a \"change\" event.\n    fetch: function(options) {\n      options = _.extend({parse: true}, options);\n      var model = this;\n      var success = options.success;\n      options.success = function(resp) {\n        var serverAttrs = options.parse ? model.parse(resp, options) : resp;\n        if (!model.set(serverAttrs, options)) return false;\n        if (success) success.call(options.context, model, resp, options);\n        model.trigger('sync', model, resp, options);\n      };\n      wrapError(this, options);\n      return this.sync('read', this, options);\n    },\n\n    // Set a hash of model attributes, and sync the model to the server.\n    // If the server returns an attributes hash that differs, the model's\n    // state will be `set` again.\n    save: function(key, val, options) {\n      // Handle both `\"key\", value` and `{key: value}` -style arguments.\n      var attrs;\n      if (key == null || typeof key === 'object') {\n        attrs = key;\n        options = val;\n      } else {\n        (attrs = {})[key] = val;\n      }\n\n      options = _.extend({validate: true, parse: true}, options);\n      var wait = options.wait;\n\n      // If we're not waiting and attributes exist, save acts as\n      // `set(attr).save(null, opts)` with validation. Otherwise, check if\n      // the model will be valid when the attributes, if any, are set.\n      if (attrs && !wait) {\n        if (!this.set(attrs, options)) return false;\n      } else if (!this._validate(attrs, options)) {\n        return false;\n      }\n\n      // After a successful server-side save, the client is (optionally)\n      // updated with the server-side state.\n      var model = this;\n      var success = options.success;\n      var attributes = this.attributes;\n      options.success = function(resp) {\n        // Ensure attributes are restored during synchronous saves.\n        model.attributes = attributes;\n        var serverAttrs = options.parse ? model.parse(resp, options) : resp;\n        if (wait) serverAttrs = _.extend({}, attrs, serverAttrs);\n        if (serverAttrs && !model.set(serverAttrs, options)) return false;\n        if (success) success.call(options.context, model, resp, options);\n        model.trigger('sync', model, resp, options);\n      };\n      wrapError(this, options);\n\n      // Set temporary attributes if `{wait: true}` to properly find new ids.\n      if (attrs && wait) this.attributes = _.extend({}, attributes, attrs);\n\n      var method = this.isNew() ? 'create' : (options.patch ? 'patch' : 'update');\n      if (method === 'patch' && !options.attrs) options.attrs = attrs;\n      var xhr = this.sync(method, this, options);\n\n      // Restore attributes.\n      this.attributes = attributes;\n\n      return xhr;\n    },\n\n    // Destroy this model on the server if it was already persisted.\n    // Optimistically removes the model from its collection, if it has one.\n    // If `wait: true` is passed, waits for the server to respond before removal.\n    destroy: function(options) {\n      options = options ? _.clone(options) : {};\n      var model = this;\n      var success = options.success;\n      var wait = options.wait;\n\n      var destroy = function() {\n        model.stopListening();\n        model.trigger('destroy', model, model.collection, options);\n      };\n\n      options.success = function(resp) {\n        if (wait) destroy();\n        if (success) success.call(options.context, model, resp, options);\n        if (!model.isNew()) model.trigger('sync', model, resp, options);\n      };\n\n      var xhr = false;\n      if (this.isNew()) {\n        _.defer(options.success);\n      } else {\n        wrapError(this, options);\n        xhr = this.sync('delete', this, options);\n      }\n      if (!wait) destroy();\n      return xhr;\n    },\n\n    // Default URL for the model's representation on the server -- if you're\n    // using Backbone's restful methods, override this to change the endpoint\n    // that will be called.\n    url: function() {\n      var base =\n        _.result(this, 'urlRoot') ||\n        _.result(this.collection, 'url') ||\n        urlError();\n      if (this.isNew()) return base;\n      var id = this.get(this.idAttribute);\n      return base.replace(/[^\\/]$/, '$&/') + encodeURIComponent(id);\n    },\n\n    // **parse** converts a response into the hash of attributes to be `set` on\n    // the model. The default implementation is just to pass the response along.\n    parse: function(resp, options) {\n      return resp;\n    },\n\n    // Create a new model with identical attributes to this one.\n    clone: function() {\n      return new this.constructor(this.attributes);\n    },\n\n    // A model is new if it has never been saved to the server, and lacks an id.\n    isNew: function() {\n      return !this.has(this.idAttribute);\n    },\n\n    // Check if the model is currently in a valid state.\n    isValid: function(options) {\n      return this._validate({}, _.extend({}, options, {validate: true}));\n    },\n\n    // Run validation against the next complete set of model attributes,\n    // returning `true` if all is well. Otherwise, fire an `\"invalid\"` event.\n    _validate: function(attrs, options) {\n      if (!options.validate || !this.validate) return true;\n      attrs = _.extend({}, this.attributes, attrs);\n      var error = this.validationError = this.validate(attrs, options) || null;\n      if (!error) return true;\n      this.trigger('invalid', this, error, _.extend(options, {validationError: error}));\n      return false;\n    }\n\n  });\n\n  // Underscore methods that we want to implement on the Model, mapped to the\n  // number of arguments they take.\n  var modelMethods = {keys: 1, values: 1, pairs: 1, invert: 1, pick: 0,\n      omit: 0, chain: 1, isEmpty: 1};\n\n  // Mix in each Underscore method as a proxy to `Model#attributes`.\n  addUnderscoreMethods(Model, modelMethods, 'attributes');\n\n  // Backbone.Collection\n  // -------------------\n\n  // If models tend to represent a single row of data, a Backbone Collection is\n  // more analogous to a table full of data ... or a small slice or page of that\n  // table, or a collection of rows that belong together for a particular reason\n  // -- all of the messages in this particular folder, all of the documents\n  // belonging to this particular author, and so on. Collections maintain\n  // indexes of their models, both in order, and for lookup by `id`.\n\n  // Create a new **Collection**, perhaps to contain a specific type of `model`.\n  // If a `comparator` is specified, the Collection will maintain\n  // its models in sort order, as they're added and removed.\n  var Collection = Backbone.Collection = function(models, options) {\n    options || (options = {});\n    if (options.model) this.model = options.model;\n    if (options.comparator !== void 0) this.comparator = options.comparator;\n    this._reset();\n    this.initialize.apply(this, arguments);\n    if (models) this.reset(models, _.extend({silent: true}, options));\n  };\n\n  // Default options for `Collection#set`.\n  var setOptions = {add: true, remove: true, merge: true};\n  var addOptions = {add: true, remove: false};\n\n  // Splices `insert` into `array` at index `at`.\n  var splice = function(array, insert, at) {\n    at = Math.min(Math.max(at, 0), array.length);\n    var tail = Array(array.length - at);\n    var length = insert.length;\n    var i;\n    for (i = 0; i < tail.length; i++) tail[i] = array[i + at];\n    for (i = 0; i < length; i++) array[i + at] = insert[i];\n    for (i = 0; i < tail.length; i++) array[i + length + at] = tail[i];\n  };\n\n  // Define the Collection's inheritable methods.\n  _.extend(Collection.prototype, Events, {\n\n    // The default model for a collection is just a **Backbone.Model**.\n    // This should be overridden in most cases.\n    model: Model,\n\n    // Initialize is an empty function by default. Override it with your own\n    // initialization logic.\n    initialize: function(){},\n\n    // The JSON representation of a Collection is an array of the\n    // models' attributes.\n    toJSON: function(options) {\n      return this.map(function(model) { return model.toJSON(options); });\n    },\n\n    // Proxy `Backbone.sync` by default.\n    sync: function() {\n      return Backbone.sync.apply(this, arguments);\n    },\n\n    // Add a model, or list of models to the set. `models` may be Backbone\n    // Models or raw JavaScript objects to be converted to Models, or any\n    // combination of the two.\n    add: function(models, options) {\n      return this.set(models, _.extend({merge: false}, options, addOptions));\n    },\n\n    // Remove a model, or a list of models from the set.\n    remove: function(models, options) {\n      options = _.extend({}, options);\n      var singular = !_.isArray(models);\n      models = singular ? [models] : models.slice();\n      var removed = this._removeModels(models, options);\n      if (!options.silent && removed.length) {\n        options.changes = {added: [], merged: [], removed: removed};\n        this.trigger('update', this, options);\n      }\n      return singular ? removed[0] : removed;\n    },\n\n    // Update a collection by `set`-ing a new list of models, adding new ones,\n    // removing models that are no longer present, and merging models that\n    // already exist in the collection, as necessary. Similar to **Model#set**,\n    // the core operation for updating the data contained by the collection.\n    set: function(models, options) {\n      if (models == null) return;\n\n      options = _.extend({}, setOptions, options);\n      if (options.parse && !this._isModel(models)) {\n        models = this.parse(models, options) || [];\n      }\n\n      var singular = !_.isArray(models);\n      models = singular ? [models] : models.slice();\n\n      var at = options.at;\n      if (at != null) at = +at;\n      if (at > this.length) at = this.length;\n      if (at < 0) at += this.length + 1;\n\n      var set = [];\n      var toAdd = [];\n      var toMerge = [];\n      var toRemove = [];\n      var modelMap = {};\n\n      var add = options.add;\n      var merge = options.merge;\n      var remove = options.remove;\n\n      var sort = false;\n      var sortable = this.comparator && at == null && options.sort !== false;\n      var sortAttr = _.isString(this.comparator) ? this.comparator : null;\n\n      // Turn bare objects into model references, and prevent invalid models\n      // from being added.\n      var model, i;\n      for (i = 0; i < models.length; i++) {\n        model = models[i];\n\n        // If a duplicate is found, prevent it from being added and\n        // optionally merge it into the existing model.\n        var existing = this.get(model);\n        if (existing) {\n          if (merge && model !== existing) {\n            var attrs = this._isModel(model) ? model.attributes : model;\n            if (options.parse) attrs = existing.parse(attrs, options);\n            existing.set(attrs, options);\n            toMerge.push(existing);\n            if (sortable && !sort) sort = existing.hasChanged(sortAttr);\n          }\n          if (!modelMap[existing.cid]) {\n            modelMap[existing.cid] = true;\n            set.push(existing);\n          }\n          models[i] = existing;\n\n        // If this is a new, valid model, push it to the `toAdd` list.\n        } else if (add) {\n          model = models[i] = this._prepareModel(model, options);\n          if (model) {\n            toAdd.push(model);\n            this._addReference(model, options);\n            modelMap[model.cid] = true;\n            set.push(model);\n          }\n        }\n      }\n\n      // Remove stale models.\n      if (remove) {\n        for (i = 0; i < this.length; i++) {\n          model = this.models[i];\n          if (!modelMap[model.cid]) toRemove.push(model);\n        }\n        if (toRemove.length) this._removeModels(toRemove, options);\n      }\n\n      // See if sorting is needed, update `length` and splice in new models.\n      var orderChanged = false;\n      var replace = !sortable && add && remove;\n      if (set.length && replace) {\n        orderChanged = this.length !== set.length || _.some(this.models, function(m, index) {\n          return m !== set[index];\n        });\n        this.models.length = 0;\n        splice(this.models, set, 0);\n        this.length = this.models.length;\n      } else if (toAdd.length) {\n        if (sortable) sort = true;\n        splice(this.models, toAdd, at == null ? this.length : at);\n        this.length = this.models.length;\n      }\n\n      // Silently sort the collection if appropriate.\n      if (sort) this.sort({silent: true});\n\n      // Unless silenced, it's time to fire all appropriate add/sort/update events.\n      if (!options.silent) {\n        for (i = 0; i < toAdd.length; i++) {\n          if (at != null) options.index = at + i;\n          model = toAdd[i];\n          model.trigger('add', model, this, options);\n        }\n        if (sort || orderChanged) this.trigger('sort', this, options);\n        if (toAdd.length || toRemove.length || toMerge.length) {\n          options.changes = {\n            added: toAdd,\n            removed: toRemove,\n            merged: toMerge\n          };\n          this.trigger('update', this, options);\n        }\n      }\n\n      // Return the added (or merged) model (or models).\n      return singular ? models[0] : models;\n    },\n\n    // When you have more items than you want to add or remove individually,\n    // you can reset the entire set with a new list of models, without firing\n    // any granular `add` or `remove` events. Fires `reset` when finished.\n    // Useful for bulk operations and optimizations.\n    reset: function(models, options) {\n      options = options ? _.clone(options) : {};\n      for (var i = 0; i < this.models.length; i++) {\n        this._removeReference(this.models[i], options);\n      }\n      options.previousModels = this.models;\n      this._reset();\n      models = this.add(models, _.extend({silent: true}, options));\n      if (!options.silent) this.trigger('reset', this, options);\n      return models;\n    },\n\n    // Add a model to the end of the collection.\n    push: function(model, options) {\n      return this.add(model, _.extend({at: this.length}, options));\n    },\n\n    // Remove a model from the end of the collection.\n    pop: function(options) {\n      var model = this.at(this.length - 1);\n      return this.remove(model, options);\n    },\n\n    // Add a model to the beginning of the collection.\n    unshift: function(model, options) {\n      return this.add(model, _.extend({at: 0}, options));\n    },\n\n    // Remove a model from the beginning of the collection.\n    shift: function(options) {\n      var model = this.at(0);\n      return this.remove(model, options);\n    },\n\n    // Slice out a sub-array of models from the collection.\n    slice: function() {\n      return slice.apply(this.models, arguments);\n    },\n\n    // Get a model from the set by id, cid, model object with id or cid\n    // properties, or an attributes object that is transformed through modelId.\n    get: function(obj) {\n      if (obj == null) return void 0;\n      return this._byId[obj] ||\n        this._byId[this.modelId(obj.attributes || obj)] ||\n        obj.cid && this._byId[obj.cid];\n    },\n\n    // Returns `true` if the model is in the collection.\n    has: function(obj) {\n      return this.get(obj) != null;\n    },\n\n    // Get the model at the given index.\n    at: function(index) {\n      if (index < 0) index += this.length;\n      return this.models[index];\n    },\n\n    // Return models with matching attributes. Useful for simple cases of\n    // `filter`.\n    where: function(attrs, first) {\n      return this[first ? 'find' : 'filter'](attrs);\n    },\n\n    // Return the first model with matching attributes. Useful for simple cases\n    // of `find`.\n    findWhere: function(attrs) {\n      return this.where(attrs, true);\n    },\n\n    // Force the collection to re-sort itself. You don't need to call this under\n    // normal circumstances, as the set will maintain sort order as each item\n    // is added.\n    sort: function(options) {\n      var comparator = this.comparator;\n      if (!comparator) throw new Error('Cannot sort a set without a comparator');\n      options || (options = {});\n\n      var length = comparator.length;\n      if (_.isFunction(comparator)) comparator = _.bind(comparator, this);\n\n      // Run sort based on type of `comparator`.\n      if (length === 1 || _.isString(comparator)) {\n        this.models = this.sortBy(comparator);\n      } else {\n        this.models.sort(comparator);\n      }\n      if (!options.silent) this.trigger('sort', this, options);\n      return this;\n    },\n\n    // Pluck an attribute from each model in the collection.\n    pluck: function(attr) {\n      return this.map(attr + '');\n    },\n\n    // Fetch the default set of models for this collection, resetting the\n    // collection when they arrive. If `reset: true` is passed, the response\n    // data will be passed through the `reset` method instead of `set`.\n    fetch: function(options) {\n      options = _.extend({parse: true}, options);\n      var success = options.success;\n      var collection = this;\n      options.success = function(resp) {\n        var method = options.reset ? 'reset' : 'set';\n        collection[method](resp, options);\n        if (success) success.call(options.context, collection, resp, options);\n        collection.trigger('sync', collection, resp, options);\n      };\n      wrapError(this, options);\n      return this.sync('read', this, options);\n    },\n\n    // Create a new instance of a model in this collection. Add the model to the\n    // collection immediately, unless `wait: true` is passed, in which case we\n    // wait for the server to agree.\n    create: function(model, options) {\n      options = options ? _.clone(options) : {};\n      var wait = options.wait;\n      model = this._prepareModel(model, options);\n      if (!model) return false;\n      if (!wait) this.add(model, options);\n      var collection = this;\n      var success = options.success;\n      options.success = function(m, resp, callbackOpts) {\n        if (wait) collection.add(m, callbackOpts);\n        if (success) success.call(callbackOpts.context, m, resp, callbackOpts);\n      };\n      model.save(null, options);\n      return model;\n    },\n\n    // **parse** converts a response into a list of models to be added to the\n    // collection. The default implementation is just to pass it through.\n    parse: function(resp, options) {\n      return resp;\n    },\n\n    // Create a new collection with an identical list of models as this one.\n    clone: function() {\n      return new this.constructor(this.models, {\n        model: this.model,\n        comparator: this.comparator\n      });\n    },\n\n    // Define how to uniquely identify models in the collection.\n    modelId: function(attrs) {\n      return attrs[this.model.prototype.idAttribute || 'id'];\n    },\n\n    // Private method to reset all internal state. Called when the collection\n    // is first initialized or reset.\n    _reset: function() {\n      this.length = 0;\n      this.models = [];\n      this._byId  = {};\n    },\n\n    // Prepare a hash of attributes (or other model) to be added to this\n    // collection.\n    _prepareModel: function(attrs, options) {\n      if (this._isModel(attrs)) {\n        if (!attrs.collection) attrs.collection = this;\n        return attrs;\n      }\n      options = options ? _.clone(options) : {};\n      options.collection = this;\n      var model = new this.model(attrs, options);\n      if (!model.validationError) return model;\n      this.trigger('invalid', this, model.validationError, options);\n      return false;\n    },\n\n    // Internal method called by both remove and set.\n    _removeModels: function(models, options) {\n      var removed = [];\n      for (var i = 0; i < models.length; i++) {\n        var model = this.get(models[i]);\n        if (!model) continue;\n\n        var index = this.indexOf(model);\n        this.models.splice(index, 1);\n        this.length--;\n\n        // Remove references before triggering 'remove' event to prevent an\n        // infinite loop. #3693\n        delete this._byId[model.cid];\n        var id = this.modelId(model.attributes);\n        if (id != null) delete this._byId[id];\n\n        if (!options.silent) {\n          options.index = index;\n          model.trigger('remove', model, this, options);\n        }\n\n        removed.push(model);\n        this._removeReference(model, options);\n      }\n      return removed;\n    },\n\n    // Method for checking whether an object should be considered a model for\n    // the purposes of adding to the collection.\n    _isModel: function(model) {\n      return model instanceof Model;\n    },\n\n    // Internal method to create a model's ties to a collection.\n    _addReference: function(model, options) {\n      this._byId[model.cid] = model;\n      var id = this.modelId(model.attributes);\n      if (id != null) this._byId[id] = model;\n      model.on('all', this._onModelEvent, this);\n    },\n\n    // Internal method to sever a model's ties to a collection.\n    _removeReference: function(model, options) {\n      delete this._byId[model.cid];\n      var id = this.modelId(model.attributes);\n      if (id != null) delete this._byId[id];\n      if (this === model.collection) delete model.collection;\n      model.off('all', this._onModelEvent, this);\n    },\n\n    // Internal method called every time a model in the set fires an event.\n    // Sets need to update their indexes when models change ids. All other\n    // events simply proxy through. \"add\" and \"remove\" events that originate\n    // in other collections are ignored.\n    _onModelEvent: function(event, model, collection, options) {\n      if (model) {\n        if ((event === 'add' || event === 'remove') && collection !== this) return;\n        if (event === 'destroy') this.remove(model, options);\n        if (event === 'change') {\n          var prevId = this.modelId(model.previousAttributes());\n          var id = this.modelId(model.attributes);\n          if (prevId !== id) {\n            if (prevId != null) delete this._byId[prevId];\n            if (id != null) this._byId[id] = model;\n          }\n        }\n      }\n      this.trigger.apply(this, arguments);\n    }\n\n  });\n\n  // Underscore methods that we want to implement on the Collection.\n  // 90% of the core usefulness of Backbone Collections is actually implemented\n  // right here:\n  var collectionMethods = {forEach: 3, each: 3, map: 3, collect: 3, reduce: 0,\n      foldl: 0, inject: 0, reduceRight: 0, foldr: 0, find: 3, detect: 3, filter: 3,\n      select: 3, reject: 3, every: 3, all: 3, some: 3, any: 3, include: 3, includes: 3,\n      contains: 3, invoke: 0, max: 3, min: 3, toArray: 1, size: 1, first: 3,\n      head: 3, take: 3, initial: 3, rest: 3, tail: 3, drop: 3, last: 3,\n      without: 0, difference: 0, indexOf: 3, shuffle: 1, lastIndexOf: 3,\n      isEmpty: 1, chain: 1, sample: 3, partition: 3, groupBy: 3, countBy: 3,\n      sortBy: 3, indexBy: 3, findIndex: 3, findLastIndex: 3};\n\n  // Mix in each Underscore method as a proxy to `Collection#models`.\n  addUnderscoreMethods(Collection, collectionMethods, 'models');\n\n  // Backbone.View\n  // -------------\n\n  // Backbone Views are almost more convention than they are actual code. A View\n  // is simply a JavaScript object that represents a logical chunk of UI in the\n  // DOM. This might be a single item, an entire list, a sidebar or panel, or\n  // even the surrounding frame which wraps your whole app. Defining a chunk of\n  // UI as a **View** allows you to define your DOM events declaratively, without\n  // having to worry about render order ... and makes it easy for the view to\n  // react to specific changes in the state of your models.\n\n  // Creating a Backbone.View creates its initial element outside of the DOM,\n  // if an existing element is not provided...\n  var View = Backbone.View = function(options) {\n    this.cid = _.uniqueId('view');\n    _.extend(this, _.pick(options, viewOptions));\n    this._ensureElement();\n    this.initialize.apply(this, arguments);\n  };\n\n  // Cached regex to split keys for `delegate`.\n  var delegateEventSplitter = /^(\\S+)\\s*(.*)$/;\n\n  // List of view options to be set as properties.\n  var viewOptions = ['model', 'collection', 'el', 'id', 'attributes', 'className', 'tagName', 'events'];\n\n  // Set up all inheritable **Backbone.View** properties and methods.\n  _.extend(View.prototype, Events, {\n\n    // The default `tagName` of a View's element is `\"div\"`.\n    tagName: 'div',\n\n    // jQuery delegate for element lookup, scoped to DOM elements within the\n    // current view. This should be preferred to global lookups where possible.\n    $: function(selector) {\n      return this.$el.find(selector);\n    },\n\n    // Initialize is an empty function by default. Override it with your own\n    // initialization logic.\n    initialize: function(){},\n\n    // **render** is the core function that your view should override, in order\n    // to populate its element (`this.el`), with the appropriate HTML. The\n    // convention is for **render** to always return `this`.\n    render: function() {\n      return this;\n    },\n\n    // Remove this view by taking the element out of the DOM, and removing any\n    // applicable Backbone.Events listeners.\n    remove: function() {\n      this._removeElement();\n      this.stopListening();\n      return this;\n    },\n\n    // Remove this view's element from the document and all event listeners\n    // attached to it. Exposed for subclasses using an alternative DOM\n    // manipulation API.\n    _removeElement: function() {\n      this.$el.remove();\n    },\n\n    // Change the view's element (`this.el` property) and re-delegate the\n    // view's events on the new element.\n    setElement: function(element) {\n      this.undelegateEvents();\n      this._setElement(element);\n      this.delegateEvents();\n      return this;\n    },\n\n    // Creates the `this.el` and `this.$el` references for this view using the\n    // given `el`. `el` can be a CSS selector or an HTML string, a jQuery\n    // context or an element. Subclasses can override this to utilize an\n    // alternative DOM manipulation API and are only required to set the\n    // `this.el` property.\n    _setElement: function(el) {\n      this.$el = el instanceof Backbone.$ ? el : Backbone.$(el);\n      this.el = this.$el[0];\n    },\n\n    // Set callbacks, where `this.events` is a hash of\n    //\n    // *{\"event selector\": \"callback\"}*\n    //\n    //     {\n    //       'mousedown .title':  'edit',\n    //       'click .button':     'save',\n    //       'click .open':       function(e) { ... }\n    //     }\n    //\n    // pairs. Callbacks will be bound to the view, with `this` set properly.\n    // Uses event delegation for efficiency.\n    // Omitting the selector binds the event to `this.el`.\n    delegateEvents: function(events) {\n      events || (events = _.result(this, 'events'));\n      if (!events) return this;\n      this.undelegateEvents();\n      for (var key in events) {\n        var method = events[key];\n        if (!_.isFunction(method)) method = this[method];\n        if (!method) continue;\n        var match = key.match(delegateEventSplitter);\n        this.delegate(match[1], match[2], _.bind(method, this));\n      }\n      return this;\n    },\n\n    // Add a single event listener to the view's element (or a child element\n    // using `selector`). This only works for delegate-able events: not `focus`,\n    // `blur`, and not `change`, `submit`, and `reset` in Internet Explorer.\n    delegate: function(eventName, selector, listener) {\n      this.$el.on(eventName + '.delegateEvents' + this.cid, selector, listener);\n      return this;\n    },\n\n    // Clears all callbacks previously bound to the view by `delegateEvents`.\n    // You usually don't need to use this, but may wish to if you have multiple\n    // Backbone views attached to the same DOM element.\n    undelegateEvents: function() {\n      if (this.$el) this.$el.off('.delegateEvents' + this.cid);\n      return this;\n    },\n\n    // A finer-grained `undelegateEvents` for removing a single delegated event.\n    // `selector` and `listener` are both optional.\n    undelegate: function(eventName, selector, listener) {\n      this.$el.off(eventName + '.delegateEvents' + this.cid, selector, listener);\n      return this;\n    },\n\n    // Produces a DOM element to be assigned to your view. Exposed for\n    // subclasses using an alternative DOM manipulation API.\n    _createElement: function(tagName) {\n      return document.createElement(tagName);\n    },\n\n    // Ensure that the View has a DOM element to render into.\n    // If `this.el` is a string, pass it through `$()`, take the first\n    // matching element, and re-assign it to `el`. Otherwise, create\n    // an element from the `id`, `className` and `tagName` properties.\n    _ensureElement: function() {\n      if (!this.el) {\n        var attrs = _.extend({}, _.result(this, 'attributes'));\n        if (this.id) attrs.id = _.result(this, 'id');\n        if (this.className) attrs['class'] = _.result(this, 'className');\n        this.setElement(this._createElement(_.result(this, 'tagName')));\n        this._setAttributes(attrs);\n      } else {\n        this.setElement(_.result(this, 'el'));\n      }\n    },\n\n    // Set attributes from a hash on this view's element.  Exposed for\n    // subclasses using an alternative DOM manipulation API.\n    _setAttributes: function(attributes) {\n      this.$el.attr(attributes);\n    }\n\n  });\n\n  // Backbone.sync\n  // -------------\n\n  // Override this function to change the manner in which Backbone persists\n  // models to the server. You will be passed the type of request, and the\n  // model in question. By default, makes a RESTful Ajax request\n  // to the model's `url()`. Some possible customizations could be:\n  //\n  // * Use `setTimeout` to batch rapid-fire updates into a single request.\n  // * Send up the models as XML instead of JSON.\n  // * Persist models via WebSockets instead of Ajax.\n  //\n  // Turn on `Backbone.emulateHTTP` in order to send `PUT` and `DELETE` requests\n  // as `POST`, with a `_method` parameter containing the true HTTP method,\n  // as well as all requests with the body as `application/x-www-form-urlencoded`\n  // instead of `application/json` with the model in a param named `model`.\n  // Useful when interfacing with server-side languages like **PHP** that make\n  // it difficult to read the body of `PUT` requests.\n  Backbone.sync = function(method, model, options) {\n    var type = methodMap[method];\n\n    // Default options, unless specified.\n    _.defaults(options || (options = {}), {\n      emulateHTTP: Backbone.emulateHTTP,\n      emulateJSON: Backbone.emulateJSON\n    });\n\n    // Default JSON-request options.\n    var params = {type: type, dataType: 'json'};\n\n    // Ensure that we have a URL.\n    if (!options.url) {\n      params.url = _.result(model, 'url') || urlError();\n    }\n\n    // Ensure that we have the appropriate request data.\n    if (options.data == null && model && (method === 'create' || method === 'update' || method === 'patch')) {\n      params.contentType = 'application/json';\n      params.data = JSON.stringify(options.attrs || model.toJSON(options));\n    }\n\n    // For older servers, emulate JSON by encoding the request into an HTML-form.\n    if (options.emulateJSON) {\n      params.contentType = 'application/x-www-form-urlencoded';\n      params.data = params.data ? {model: params.data} : {};\n    }\n\n    // For older servers, emulate HTTP by mimicking the HTTP method with `_method`\n    // And an `X-HTTP-Method-Override` header.\n    if (options.emulateHTTP && (type === 'PUT' || type === 'DELETE' || type === 'PATCH')) {\n      params.type = 'POST';\n      if (options.emulateJSON) params.data._method = type;\n      var beforeSend = options.beforeSend;\n      options.beforeSend = function(xhr) {\n        xhr.setRequestHeader('X-HTTP-Method-Override', type);\n        if (beforeSend) return beforeSend.apply(this, arguments);\n      };\n    }\n\n    // Don't process data on a non-GET request.\n    if (params.type !== 'GET' && !options.emulateJSON) {\n      params.processData = false;\n    }\n\n    // Pass along `textStatus` and `errorThrown` from jQuery.\n    var error = options.error;\n    options.error = function(xhr, textStatus, errorThrown) {\n      options.textStatus = textStatus;\n      options.errorThrown = errorThrown;\n      if (error) error.call(options.context, xhr, textStatus, errorThrown);\n    };\n\n    // Make the request, allowing the user to override any Ajax options.\n    var xhr = options.xhr = Backbone.ajax(_.extend(params, options));\n    model.trigger('request', model, xhr, options);\n    return xhr;\n  };\n\n  // Map from CRUD to HTTP for our default `Backbone.sync` implementation.\n  var methodMap = {\n    'create': 'POST',\n    'update': 'PUT',\n    'patch': 'PATCH',\n    'delete': 'DELETE',\n    'read': 'GET'\n  };\n\n  // Set the default implementation of `Backbone.ajax` to proxy through to `$`.\n  // Override this if you'd like to use a different library.\n  Backbone.ajax = function() {\n    return Backbone.$.ajax.apply(Backbone.$, arguments);\n  };\n\n  // Backbone.Router\n  // ---------------\n\n  // Routers map faux-URLs to actions, and fire events when routes are\n  // matched. Creating a new one sets its `routes` hash, if not set statically.\n  var Router = Backbone.Router = function(options) {\n    options || (options = {});\n    if (options.routes) this.routes = options.routes;\n    this._bindRoutes();\n    this.initialize.apply(this, arguments);\n  };\n\n  // Cached regular expressions for matching named param parts and splatted\n  // parts of route strings.\n  var optionalParam = /\\((.*?)\\)/g;\n  var namedParam    = /(\\(\\?)?:\\w+/g;\n  var splatParam    = /\\*\\w+/g;\n  var escapeRegExp  = /[\\-{}\\[\\]+?.,\\\\\\^$|#\\s]/g;\n\n  // Set up all inheritable **Backbone.Router** properties and methods.\n  _.extend(Router.prototype, Events, {\n\n    // Initialize is an empty function by default. Override it with your own\n    // initialization logic.\n    initialize: function(){},\n\n    // Manually bind a single named route to a callback. For example:\n    //\n    //     this.route('search/:query/p:num', 'search', function(query, num) {\n    //       ...\n    //     });\n    //\n    route: function(route, name, callback) {\n      if (!_.isRegExp(route)) route = this._routeToRegExp(route);\n      if (_.isFunction(name)) {\n        callback = name;\n        name = '';\n      }\n      if (!callback) callback = this[name];\n      var router = this;\n      Backbone.history.route(route, function(fragment) {\n        var args = router._extractParameters(route, fragment);\n        if (router.execute(callback, args, name) !== false) {\n          router.trigger.apply(router, ['route:' + name].concat(args));\n          router.trigger('route', name, args);\n          Backbone.history.trigger('route', router, name, args);\n        }\n      });\n      return this;\n    },\n\n    // Execute a route handler with the provided parameters.  This is an\n    // excellent place to do pre-route setup or post-route cleanup.\n    execute: function(callback, args, name) {\n      if (callback) callback.apply(this, args);\n    },\n\n    // Simple proxy to `Backbone.history` to save a fragment into the history.\n    navigate: function(fragment, options) {\n      Backbone.history.navigate(fragment, options);\n      return this;\n    },\n\n    // Bind all defined routes to `Backbone.history`. We have to reverse the\n    // order of the routes here to support behavior where the most general\n    // routes can be defined at the bottom of the route map.\n    _bindRoutes: function() {\n      if (!this.routes) return;\n      this.routes = _.result(this, 'routes');\n      var route, routes = _.keys(this.routes);\n      while ((route = routes.pop()) != null) {\n        this.route(route, this.routes[route]);\n      }\n    },\n\n    // Convert a route string into a regular expression, suitable for matching\n    // against the current location hash.\n    _routeToRegExp: function(route) {\n      route = route.replace(escapeRegExp, '\\\\$&')\n                   .replace(optionalParam, '(?:$1)?')\n                   .replace(namedParam, function(match, optional) {\n                     return optional ? match : '([^/?]+)';\n                   })\n                   .replace(splatParam, '([^?]*?)');\n      return new RegExp('^' + route + '(?:\\\\?([\\\\s\\\\S]*))?$');\n    },\n\n    // Given a route, and a URL fragment that it matches, return the array of\n    // extracted decoded parameters. Empty or unmatched parameters will be\n    // treated as `null` to normalize cross-browser behavior.\n    _extractParameters: function(route, fragment) {\n      var params = route.exec(fragment).slice(1);\n      return _.map(params, function(param, i) {\n        // Don't decode the search params.\n        if (i === params.length - 1) return param || null;\n        return param ? decodeURIComponent(param) : null;\n      });\n    }\n\n  });\n\n  // Backbone.History\n  // ----------------\n\n  // Handles cross-browser history management, based on either\n  // [pushState](http://diveintohtml5.info/history.html) and real URLs, or\n  // [onhashchange](https://developer.mozilla.org/en-US/docs/DOM/window.onhashchange)\n  // and URL fragments. If the browser supports neither (old IE, natch),\n  // falls back to polling.\n  var History = Backbone.History = function() {\n    this.handlers = [];\n    this.checkUrl = _.bind(this.checkUrl, this);\n\n    // Ensure that `History` can be used outside of the browser.\n    if (typeof window !== 'undefined') {\n      this.location = window.location;\n      this.history = window.history;\n    }\n  };\n\n  // Cached regex for stripping a leading hash/slash and trailing space.\n  var routeStripper = /^[#\\/]|\\s+$/g;\n\n  // Cached regex for stripping leading and trailing slashes.\n  var rootStripper = /^\\/+|\\/+$/g;\n\n  // Cached regex for stripping urls of hash.\n  var pathStripper = /#.*$/;\n\n  // Has the history handling already been started?\n  History.started = false;\n\n  // Set up all inheritable **Backbone.History** properties and methods.\n  _.extend(History.prototype, Events, {\n\n    // The default interval to poll for hash changes, if necessary, is\n    // twenty times a second.\n    interval: 50,\n\n    // Are we at the app root?\n    atRoot: function() {\n      var path = this.location.pathname.replace(/[^\\/]$/, '$&/');\n      return path === this.root && !this.getSearch();\n    },\n\n    // Does the pathname match the root?\n    matchRoot: function() {\n      var path = this.decodeFragment(this.location.pathname);\n      var rootPath = path.slice(0, this.root.length - 1) + '/';\n      return rootPath === this.root;\n    },\n\n    // Unicode characters in `location.pathname` are percent encoded so they're\n    // decoded for comparison. `%25` should not be decoded since it may be part\n    // of an encoded parameter.\n    decodeFragment: function(fragment) {\n      return decodeURI(fragment.replace(/%25/g, '%2525'));\n    },\n\n    // In IE6, the hash fragment and search params are incorrect if the\n    // fragment contains `?`.\n    getSearch: function() {\n      var match = this.location.href.replace(/#.*/, '').match(/\\?.+/);\n      return match ? match[0] : '';\n    },\n\n    // Gets the true hash value. Cannot use location.hash directly due to bug\n    // in Firefox where location.hash will always be decoded.\n    getHash: function(window) {\n      var match = (window || this).location.href.match(/#(.*)$/);\n      return match ? match[1] : '';\n    },\n\n    // Get the pathname and search params, without the root.\n    getPath: function() {\n      var path = this.decodeFragment(\n        this.location.pathname + this.getSearch()\n      ).slice(this.root.length - 1);\n      return path.charAt(0) === '/' ? path.slice(1) : path;\n    },\n\n    // Get the cross-browser normalized URL fragment from the path or hash.\n    getFragment: function(fragment) {\n      if (fragment == null) {\n        if (this._usePushState || !this._wantsHashChange) {\n          fragment = this.getPath();\n        } else {\n          fragment = this.getHash();\n        }\n      }\n      return fragment.replace(routeStripper, '');\n    },\n\n    // Start the hash change handling, returning `true` if the current URL matches\n    // an existing route, and `false` otherwise.\n    start: function(options) {\n      if (History.started) throw new Error('Backbone.history has already been started');\n      History.started = true;\n\n      // Figure out the initial configuration. Do we need an iframe?\n      // Is pushState desired ... is it available?\n      this.options          = _.extend({root: '/'}, this.options, options);\n      this.root             = this.options.root;\n      this._wantsHashChange = this.options.hashChange !== false;\n      this._hasHashChange   = 'onhashchange' in window && (document.documentMode === void 0 || document.documentMode > 7);\n      this._useHashChange   = this._wantsHashChange && this._hasHashChange;\n      this._wantsPushState  = !!this.options.pushState;\n      this._hasPushState    = !!(this.history && this.history.pushState);\n      this._usePushState    = this._wantsPushState && this._hasPushState;\n      this.fragment         = this.getFragment();\n\n      // Normalize root to always include a leading and trailing slash.\n      this.root = ('/' + this.root + '/').replace(rootStripper, '/');\n\n      // Transition from hashChange to pushState or vice versa if both are\n      // requested.\n      if (this._wantsHashChange && this._wantsPushState) {\n\n        // If we've started off with a route from a `pushState`-enabled\n        // browser, but we're currently in a browser that doesn't support it...\n        if (!this._hasPushState && !this.atRoot()) {\n          var rootPath = this.root.slice(0, -1) || '/';\n          this.location.replace(rootPath + '#' + this.getPath());\n          // Return immediately as browser will do redirect to new url\n          return true;\n\n        // Or if we've started out with a hash-based route, but we're currently\n        // in a browser where it could be `pushState`-based instead...\n        } else if (this._hasPushState && this.atRoot()) {\n          this.navigate(this.getHash(), {replace: true});\n        }\n\n      }\n\n      // Proxy an iframe to handle location events if the browser doesn't\n      // support the `hashchange` event, HTML5 history, or the user wants\n      // `hashChange` but not `pushState`.\n      if (!this._hasHashChange && this._wantsHashChange && !this._usePushState) {\n        this.iframe = document.createElement('iframe');\n        this.iframe.src = 'javascript:0';\n        this.iframe.style.display = 'none';\n        this.iframe.tabIndex = -1;\n        var body = document.body;\n        // Using `appendChild` will throw on IE < 9 if the document is not ready.\n        var iWindow = body.insertBefore(this.iframe, body.firstChild).contentWindow;\n        iWindow.document.open();\n        iWindow.document.close();\n        iWindow.location.hash = '#' + this.fragment;\n      }\n\n      // Add a cross-platform `addEventListener` shim for older browsers.\n      var addEventListener = window.addEventListener || function(eventName, listener) {\n        return attachEvent('on' + eventName, listener);\n      };\n\n      // Depending on whether we're using pushState or hashes, and whether\n      // 'onhashchange' is supported, determine how we check the URL state.\n      if (this._usePushState) {\n        addEventListener('popstate', this.checkUrl, false);\n      } else if (this._useHashChange && !this.iframe) {\n        addEventListener('hashchange', this.checkUrl, false);\n      } else if (this._wantsHashChange) {\n        this._checkUrlInterval = setInterval(this.checkUrl, this.interval);\n      }\n\n      if (!this.options.silent) return this.loadUrl();\n    },\n\n    // Disable Backbone.history, perhaps temporarily. Not useful in a real app,\n    // but possibly useful for unit testing Routers.\n    stop: function() {\n      // Add a cross-platform `removeEventListener` shim for older browsers.\n      var removeEventListener = window.removeEventListener || function(eventName, listener) {\n        return detachEvent('on' + eventName, listener);\n      };\n\n      // Remove window listeners.\n      if (this._usePushState) {\n        removeEventListener('popstate', this.checkUrl, false);\n      } else if (this._useHashChange && !this.iframe) {\n        removeEventListener('hashchange', this.checkUrl, false);\n      }\n\n      // Clean up the iframe if necessary.\n      if (this.iframe) {\n        document.body.removeChild(this.iframe);\n        this.iframe = null;\n      }\n\n      // Some environments will throw when clearing an undefined interval.\n      if (this._checkUrlInterval) clearInterval(this._checkUrlInterval);\n      History.started = false;\n    },\n\n    // Add a route to be tested when the fragment changes. Routes added later\n    // may override previous routes.\n    route: function(route, callback) {\n      this.handlers.unshift({route: route, callback: callback});\n    },\n\n    // Checks the current URL to see if it has changed, and if it has,\n    // calls `loadUrl`, normalizing across the hidden iframe.\n    checkUrl: function(e) {\n      var current = this.getFragment();\n\n      // If the user pressed the back button, the iframe's hash will have\n      // changed and we should use that for comparison.\n      if (current === this.fragment && this.iframe) {\n        current = this.getHash(this.iframe.contentWindow);\n      }\n\n      if (current === this.fragment) return false;\n      if (this.iframe) this.navigate(current);\n      this.loadUrl();\n    },\n\n    // Attempt to load the current URL fragment. If a route succeeds with a\n    // match, returns `true`. If no defined routes matches the fragment,\n    // returns `false`.\n    loadUrl: function(fragment) {\n      // If the root doesn't match, no routes can match either.\n      if (!this.matchRoot()) return false;\n      fragment = this.fragment = this.getFragment(fragment);\n      return _.some(this.handlers, function(handler) {\n        if (handler.route.test(fragment)) {\n          handler.callback(fragment);\n          return true;\n        }\n      });\n    },\n\n    // Save a fragment into the hash history, or replace the URL state if the\n    // 'replace' option is passed. You are responsible for properly URL-encoding\n    // the fragment in advance.\n    //\n    // The options object can contain `trigger: true` if you wish to have the\n    // route callback be fired (not usually desirable), or `replace: true`, if\n    // you wish to modify the current URL without adding an entry to the history.\n    navigate: function(fragment, options) {\n      if (!History.started) return false;\n      if (!options || options === true) options = {trigger: !!options};\n\n      // Normalize the fragment.\n      fragment = this.getFragment(fragment || '');\n\n      // Don't include a trailing slash on the root.\n      var rootPath = this.root;\n      if (fragment === '' || fragment.charAt(0) === '?') {\n        rootPath = rootPath.slice(0, -1) || '/';\n      }\n      var url = rootPath + fragment;\n\n      // Strip the hash and decode for matching.\n      fragment = this.decodeFragment(fragment.replace(pathStripper, ''));\n\n      if (this.fragment === fragment) return;\n      this.fragment = fragment;\n\n      // If pushState is available, we use it to set the fragment as a real URL.\n      if (this._usePushState) {\n        this.history[options.replace ? 'replaceState' : 'pushState']({}, document.title, url);\n\n      // If hash changes haven't been explicitly disabled, update the hash\n      // fragment to store history.\n      } else if (this._wantsHashChange) {\n        this._updateHash(this.location, fragment, options.replace);\n        if (this.iframe && fragment !== this.getHash(this.iframe.contentWindow)) {\n          var iWindow = this.iframe.contentWindow;\n\n          // Opening and closing the iframe tricks IE7 and earlier to push a\n          // history entry on hash-tag change.  When replace is true, we don't\n          // want this.\n          if (!options.replace) {\n            iWindow.document.open();\n            iWindow.document.close();\n          }\n\n          this._updateHash(iWindow.location, fragment, options.replace);\n        }\n\n      // If you've told us that you explicitly don't want fallback hashchange-\n      // based history, then `navigate` becomes a page refresh.\n      } else {\n        return this.location.assign(url);\n      }\n      if (options.trigger) return this.loadUrl(fragment);\n    },\n\n    // Update the hash location, either replacing the current entry, or adding\n    // a new one to the browser history.\n    _updateHash: function(location, fragment, replace) {\n      if (replace) {\n        var href = location.href.replace(/(javascript:|#).*$/, '');\n        location.replace(href + '#' + fragment);\n      } else {\n        // Some browsers require that `hash` contains a leading #.\n        location.hash = '#' + fragment;\n      }\n    }\n\n  });\n\n  // Create the default Backbone.history.\n  Backbone.history = new History;\n\n  // Helpers\n  // -------\n\n  // Helper function to correctly set up the prototype chain for subclasses.\n  // Similar to `goog.inherits`, but uses a hash of prototype properties and\n  // class properties to be extended.\n  var extend = function(protoProps, staticProps) {\n    var parent = this;\n    var child;\n\n    // The constructor function for the new subclass is either defined by you\n    // (the \"constructor\" property in your `extend` definition), or defaulted\n    // by us to simply call the parent constructor.\n    if (protoProps && _.has(protoProps, 'constructor')) {\n      child = protoProps.constructor;\n    } else {\n      child = function(){ return parent.apply(this, arguments); };\n    }\n\n    // Add static properties to the constructor function, if supplied.\n    _.extend(child, parent, staticProps);\n\n    // Set the prototype chain to inherit from `parent`, without calling\n    // `parent`'s constructor function and add the prototype properties.\n    child.prototype = _.create(parent.prototype, protoProps);\n    child.prototype.constructor = child;\n\n    // Set a convenience property in case the parent's prototype is needed\n    // later.\n    child.__super__ = parent.prototype;\n\n    return child;\n  };\n\n  // Set up inheritance for the model, collection, router, view and history.\n  Model.extend = Collection.extend = Router.extend = View.extend = History.extend = extend;\n\n  // Throw an error when a URL is needed, and none is supplied.\n  var urlError = function() {\n    throw new Error('A \"url\" property or function must be specified');\n  };\n\n  // Wrap an optional error callback with a fallback error event.\n  var wrapError = function(model, options) {\n    var error = options.error;\n    options.error = function(resp) {\n      if (error) error.call(options.context, model, resp, options);\n      model.trigger('error', model, resp, options);\n    };\n  };\n\n  return Backbone;\n});\n\n/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(/*! ./../webpack/buildin/global.js */ \"698d75b157f24ae829cc\")))//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMTg1OGI0NWJmNDg1OTE0ODlkMDYuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvYmFja2JvbmUvYmFja2JvbmUuanM/YWI1YyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyAgICAgQmFja2JvbmUuanMgMS4zLjNcblxuLy8gICAgIChjKSAyMDEwLTIwMTYgSmVyZW15IEFzaGtlbmFzLCBEb2N1bWVudENsb3VkIGFuZCBJbnZlc3RpZ2F0aXZlIFJlcG9ydGVycyAmIEVkaXRvcnNcbi8vICAgICBCYWNrYm9uZSBtYXkgYmUgZnJlZWx5IGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBNSVQgbGljZW5zZS5cbi8vICAgICBGb3IgYWxsIGRldGFpbHMgYW5kIGRvY3VtZW50YXRpb246XG4vLyAgICAgaHR0cDovL2JhY2tib25lanMub3JnXG5cbihmdW5jdGlvbihmYWN0b3J5KSB7XG5cbiAgLy8gRXN0YWJsaXNoIHRoZSByb290IG9iamVjdCwgYHdpbmRvd2AgKGBzZWxmYCkgaW4gdGhlIGJyb3dzZXIsIG9yIGBnbG9iYWxgIG9uIHRoZSBzZXJ2ZXIuXG4gIC8vIFdlIHVzZSBgc2VsZmAgaW5zdGVhZCBvZiBgd2luZG93YCBmb3IgYFdlYldvcmtlcmAgc3VwcG9ydC5cbiAgdmFyIHJvb3QgPSAodHlwZW9mIHNlbGYgPT0gJ29iamVjdCcgJiYgc2VsZi5zZWxmID09PSBzZWxmICYmIHNlbGYpIHx8XG4gICAgICAgICAgICAodHlwZW9mIGdsb2JhbCA9PSAnb2JqZWN0JyAmJiBnbG9iYWwuZ2xvYmFsID09PSBnbG9iYWwgJiYgZ2xvYmFsKTtcblxuICAvLyBTZXQgdXAgQmFja2JvbmUgYXBwcm9wcmlhdGVseSBmb3IgdGhlIGVudmlyb25tZW50LiBTdGFydCB3aXRoIEFNRC5cbiAgaWYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkge1xuICAgIGRlZmluZShbJ3VuZGVyc2NvcmUnLCAnanF1ZXJ5JywgJ2V4cG9ydHMnXSwgZnVuY3Rpb24oXywgJCwgZXhwb3J0cykge1xuICAgICAgLy8gRXhwb3J0IGdsb2JhbCBldmVuIGluIEFNRCBjYXNlIGluIGNhc2UgdGhpcyBzY3JpcHQgaXMgbG9hZGVkIHdpdGhcbiAgICAgIC8vIG90aGVycyB0aGF0IG1heSBzdGlsbCBleHBlY3QgYSBnbG9iYWwgQmFja2JvbmUuXG4gICAgICByb290LkJhY2tib25lID0gZmFjdG9yeShyb290LCBleHBvcnRzLCBfLCAkKTtcbiAgICB9KTtcblxuICAvLyBOZXh0IGZvciBOb2RlLmpzIG9yIENvbW1vbkpTLiBqUXVlcnkgbWF5IG5vdCBiZSBuZWVkZWQgYXMgYSBtb2R1bGUuXG4gIH0gZWxzZSBpZiAodHlwZW9mIGV4cG9ydHMgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgdmFyIF8gPSByZXF1aXJlKCd1bmRlcnNjb3JlJyksICQ7XG4gICAgdHJ5IHsgJCA9IHJlcXVpcmUoJ2pxdWVyeScpOyB9IGNhdGNoIChlKSB7fVxuICAgIGZhY3Rvcnkocm9vdCwgZXhwb3J0cywgXywgJCk7XG5cbiAgLy8gRmluYWxseSwgYXMgYSBicm93c2VyIGdsb2JhbC5cbiAgfSBlbHNlIHtcbiAgICByb290LkJhY2tib25lID0gZmFjdG9yeShyb290LCB7fSwgcm9vdC5fLCAocm9vdC5qUXVlcnkgfHwgcm9vdC5aZXB0byB8fCByb290LmVuZGVyIHx8IHJvb3QuJCkpO1xuICB9XG5cbn0pKGZ1bmN0aW9uKHJvb3QsIEJhY2tib25lLCBfLCAkKSB7XG5cbiAgLy8gSW5pdGlhbCBTZXR1cFxuICAvLyAtLS0tLS0tLS0tLS0tXG5cbiAgLy8gU2F2ZSB0aGUgcHJldmlvdXMgdmFsdWUgb2YgdGhlIGBCYWNrYm9uZWAgdmFyaWFibGUsIHNvIHRoYXQgaXQgY2FuIGJlXG4gIC8vIHJlc3RvcmVkIGxhdGVyIG9uLCBpZiBgbm9Db25mbGljdGAgaXMgdXNlZC5cbiAgdmFyIHByZXZpb3VzQmFja2JvbmUgPSByb290LkJhY2tib25lO1xuXG4gIC8vIENyZWF0ZSBhIGxvY2FsIHJlZmVyZW5jZSB0byBhIGNvbW1vbiBhcnJheSBtZXRob2Qgd2UnbGwgd2FudCB0byB1c2UgbGF0ZXIuXG4gIHZhciBzbGljZSA9IEFycmF5LnByb3RvdHlwZS5zbGljZTtcblxuICAvLyBDdXJyZW50IHZlcnNpb24gb2YgdGhlIGxpYnJhcnkuIEtlZXAgaW4gc3luYyB3aXRoIGBwYWNrYWdlLmpzb25gLlxuICBCYWNrYm9uZS5WRVJTSU9OID0gJzEuMy4zJztcblxuICAvLyBGb3IgQmFja2JvbmUncyBwdXJwb3NlcywgalF1ZXJ5LCBaZXB0bywgRW5kZXIsIG9yIE15IExpYnJhcnkgKGtpZGRpbmcpIG93bnNcbiAgLy8gdGhlIGAkYCB2YXJpYWJsZS5cbiAgQmFja2JvbmUuJCA9ICQ7XG5cbiAgLy8gUnVucyBCYWNrYm9uZS5qcyBpbiAqbm9Db25mbGljdCogbW9kZSwgcmV0dXJuaW5nIHRoZSBgQmFja2JvbmVgIHZhcmlhYmxlXG4gIC8vIHRvIGl0cyBwcmV2aW91cyBvd25lci4gUmV0dXJucyBhIHJlZmVyZW5jZSB0byB0aGlzIEJhY2tib25lIG9iamVjdC5cbiAgQmFja2JvbmUubm9Db25mbGljdCA9IGZ1bmN0aW9uKCkge1xuICAgIHJvb3QuQmFja2JvbmUgPSBwcmV2aW91c0JhY2tib25lO1xuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIC8vIFR1cm4gb24gYGVtdWxhdGVIVFRQYCB0byBzdXBwb3J0IGxlZ2FjeSBIVFRQIHNlcnZlcnMuIFNldHRpbmcgdGhpcyBvcHRpb25cbiAgLy8gd2lsbCBmYWtlIGBcIlBBVENIXCJgLCBgXCJQVVRcImAgYW5kIGBcIkRFTEVURVwiYCByZXF1ZXN0cyB2aWEgdGhlIGBfbWV0aG9kYCBwYXJhbWV0ZXIgYW5kXG4gIC8vIHNldCBhIGBYLUh0dHAtTWV0aG9kLU92ZXJyaWRlYCBoZWFkZXIuXG4gIEJhY2tib25lLmVtdWxhdGVIVFRQID0gZmFsc2U7XG5cbiAgLy8gVHVybiBvbiBgZW11bGF0ZUpTT05gIHRvIHN1cHBvcnQgbGVnYWN5IHNlcnZlcnMgdGhhdCBjYW4ndCBkZWFsIHdpdGggZGlyZWN0XG4gIC8vIGBhcHBsaWNhdGlvbi9qc29uYCByZXF1ZXN0cyAuLi4gdGhpcyB3aWxsIGVuY29kZSB0aGUgYm9keSBhc1xuICAvLyBgYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkYCBpbnN0ZWFkIGFuZCB3aWxsIHNlbmQgdGhlIG1vZGVsIGluIGFcbiAgLy8gZm9ybSBwYXJhbSBuYW1lZCBgbW9kZWxgLlxuICBCYWNrYm9uZS5lbXVsYXRlSlNPTiA9IGZhbHNlO1xuXG4gIC8vIFByb3h5IEJhY2tib25lIGNsYXNzIG1ldGhvZHMgdG8gVW5kZXJzY29yZSBmdW5jdGlvbnMsIHdyYXBwaW5nIHRoZSBtb2RlbCdzXG4gIC8vIGBhdHRyaWJ1dGVzYCBvYmplY3Qgb3IgY29sbGVjdGlvbidzIGBtb2RlbHNgIGFycmF5IGJlaGluZCB0aGUgc2NlbmVzLlxuICAvL1xuICAvLyBjb2xsZWN0aW9uLmZpbHRlcihmdW5jdGlvbihtb2RlbCkgeyByZXR1cm4gbW9kZWwuZ2V0KCdhZ2UnKSA+IDEwIH0pO1xuICAvLyBjb2xsZWN0aW9uLmVhY2godGhpcy5hZGRWaWV3KTtcbiAgLy9cbiAgLy8gYEZ1bmN0aW9uI2FwcGx5YCBjYW4gYmUgc2xvdyBzbyB3ZSB1c2UgdGhlIG1ldGhvZCdzIGFyZyBjb3VudCwgaWYgd2Uga25vdyBpdC5cbiAgdmFyIGFkZE1ldGhvZCA9IGZ1bmN0aW9uKGxlbmd0aCwgbWV0aG9kLCBhdHRyaWJ1dGUpIHtcbiAgICBzd2l0Y2ggKGxlbmd0aCkge1xuICAgICAgY2FzZSAxOiByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiBfW21ldGhvZF0odGhpc1thdHRyaWJ1dGVdKTtcbiAgICAgIH07XG4gICAgICBjYXNlIDI6IHJldHVybiBmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgICByZXR1cm4gX1ttZXRob2RdKHRoaXNbYXR0cmlidXRlXSwgdmFsdWUpO1xuICAgICAgfTtcbiAgICAgIGNhc2UgMzogcmV0dXJuIGZ1bmN0aW9uKGl0ZXJhdGVlLCBjb250ZXh0KSB7XG4gICAgICAgIHJldHVybiBfW21ldGhvZF0odGhpc1thdHRyaWJ1dGVdLCBjYihpdGVyYXRlZSwgdGhpcyksIGNvbnRleHQpO1xuICAgICAgfTtcbiAgICAgIGNhc2UgNDogcmV0dXJuIGZ1bmN0aW9uKGl0ZXJhdGVlLCBkZWZhdWx0VmFsLCBjb250ZXh0KSB7XG4gICAgICAgIHJldHVybiBfW21ldGhvZF0odGhpc1thdHRyaWJ1dGVdLCBjYihpdGVyYXRlZSwgdGhpcyksIGRlZmF1bHRWYWwsIGNvbnRleHQpO1xuICAgICAgfTtcbiAgICAgIGRlZmF1bHQ6IHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGFyZ3MgPSBzbGljZS5jYWxsKGFyZ3VtZW50cyk7XG4gICAgICAgIGFyZ3MudW5zaGlmdCh0aGlzW2F0dHJpYnV0ZV0pO1xuICAgICAgICByZXR1cm4gX1ttZXRob2RdLmFwcGx5KF8sIGFyZ3MpO1xuICAgICAgfTtcbiAgICB9XG4gIH07XG4gIHZhciBhZGRVbmRlcnNjb3JlTWV0aG9kcyA9IGZ1bmN0aW9uKENsYXNzLCBtZXRob2RzLCBhdHRyaWJ1dGUpIHtcbiAgICBfLmVhY2gobWV0aG9kcywgZnVuY3Rpb24obGVuZ3RoLCBtZXRob2QpIHtcbiAgICAgIGlmIChfW21ldGhvZF0pIENsYXNzLnByb3RvdHlwZVttZXRob2RdID0gYWRkTWV0aG9kKGxlbmd0aCwgbWV0aG9kLCBhdHRyaWJ1dGUpO1xuICAgIH0pO1xuICB9O1xuXG4gIC8vIFN1cHBvcnQgYGNvbGxlY3Rpb24uc29ydEJ5KCdhdHRyJylgIGFuZCBgY29sbGVjdGlvbi5maW5kV2hlcmUoe2lkOiAxfSlgLlxuICB2YXIgY2IgPSBmdW5jdGlvbihpdGVyYXRlZSwgaW5zdGFuY2UpIHtcbiAgICBpZiAoXy5pc0Z1bmN0aW9uKGl0ZXJhdGVlKSkgcmV0dXJuIGl0ZXJhdGVlO1xuICAgIGlmIChfLmlzT2JqZWN0KGl0ZXJhdGVlKSAmJiAhaW5zdGFuY2UuX2lzTW9kZWwoaXRlcmF0ZWUpKSByZXR1cm4gbW9kZWxNYXRjaGVyKGl0ZXJhdGVlKTtcbiAgICBpZiAoXy5pc1N0cmluZyhpdGVyYXRlZSkpIHJldHVybiBmdW5jdGlvbihtb2RlbCkgeyByZXR1cm4gbW9kZWwuZ2V0KGl0ZXJhdGVlKTsgfTtcbiAgICByZXR1cm4gaXRlcmF0ZWU7XG4gIH07XG4gIHZhciBtb2RlbE1hdGNoZXIgPSBmdW5jdGlvbihhdHRycykge1xuICAgIHZhciBtYXRjaGVyID0gXy5tYXRjaGVzKGF0dHJzKTtcbiAgICByZXR1cm4gZnVuY3Rpb24obW9kZWwpIHtcbiAgICAgIHJldHVybiBtYXRjaGVyKG1vZGVsLmF0dHJpYnV0ZXMpO1xuICAgIH07XG4gIH07XG5cbiAgLy8gQmFja2JvbmUuRXZlbnRzXG4gIC8vIC0tLS0tLS0tLS0tLS0tLVxuXG4gIC8vIEEgbW9kdWxlIHRoYXQgY2FuIGJlIG1peGVkIGluIHRvICphbnkgb2JqZWN0KiBpbiBvcmRlciB0byBwcm92aWRlIGl0IHdpdGhcbiAgLy8gYSBjdXN0b20gZXZlbnQgY2hhbm5lbC4gWW91IG1heSBiaW5kIGEgY2FsbGJhY2sgdG8gYW4gZXZlbnQgd2l0aCBgb25gIG9yXG4gIC8vIHJlbW92ZSB3aXRoIGBvZmZgOyBgdHJpZ2dlcmAtaW5nIGFuIGV2ZW50IGZpcmVzIGFsbCBjYWxsYmFja3MgaW5cbiAgLy8gc3VjY2Vzc2lvbi5cbiAgLy9cbiAgLy8gICAgIHZhciBvYmplY3QgPSB7fTtcbiAgLy8gICAgIF8uZXh0ZW5kKG9iamVjdCwgQmFja2JvbmUuRXZlbnRzKTtcbiAgLy8gICAgIG9iamVjdC5vbignZXhwYW5kJywgZnVuY3Rpb24oKXsgYWxlcnQoJ2V4cGFuZGVkJyk7IH0pO1xuICAvLyAgICAgb2JqZWN0LnRyaWdnZXIoJ2V4cGFuZCcpO1xuICAvL1xuICB2YXIgRXZlbnRzID0gQmFja2JvbmUuRXZlbnRzID0ge307XG5cbiAgLy8gUmVndWxhciBleHByZXNzaW9uIHVzZWQgdG8gc3BsaXQgZXZlbnQgc3RyaW5ncy5cbiAgdmFyIGV2ZW50U3BsaXR0ZXIgPSAvXFxzKy87XG5cbiAgLy8gSXRlcmF0ZXMgb3ZlciB0aGUgc3RhbmRhcmQgYGV2ZW50LCBjYWxsYmFja2AgKGFzIHdlbGwgYXMgdGhlIGZhbmN5IG11bHRpcGxlXG4gIC8vIHNwYWNlLXNlcGFyYXRlZCBldmVudHMgYFwiY2hhbmdlIGJsdXJcIiwgY2FsbGJhY2tgIGFuZCBqUXVlcnktc3R5bGUgZXZlbnRcbiAgLy8gbWFwcyBge2V2ZW50OiBjYWxsYmFja31gKS5cbiAgdmFyIGV2ZW50c0FwaSA9IGZ1bmN0aW9uKGl0ZXJhdGVlLCBldmVudHMsIG5hbWUsIGNhbGxiYWNrLCBvcHRzKSB7XG4gICAgdmFyIGkgPSAwLCBuYW1lcztcbiAgICBpZiAobmFtZSAmJiB0eXBlb2YgbmFtZSA9PT0gJ29iamVjdCcpIHtcbiAgICAgIC8vIEhhbmRsZSBldmVudCBtYXBzLlxuICAgICAgaWYgKGNhbGxiYWNrICE9PSB2b2lkIDAgJiYgJ2NvbnRleHQnIGluIG9wdHMgJiYgb3B0cy5jb250ZXh0ID09PSB2b2lkIDApIG9wdHMuY29udGV4dCA9IGNhbGxiYWNrO1xuICAgICAgZm9yIChuYW1lcyA9IF8ua2V5cyhuYW1lKTsgaSA8IG5hbWVzLmxlbmd0aCA7IGkrKykge1xuICAgICAgICBldmVudHMgPSBldmVudHNBcGkoaXRlcmF0ZWUsIGV2ZW50cywgbmFtZXNbaV0sIG5hbWVbbmFtZXNbaV1dLCBvcHRzKTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKG5hbWUgJiYgZXZlbnRTcGxpdHRlci50ZXN0KG5hbWUpKSB7XG4gICAgICAvLyBIYW5kbGUgc3BhY2Utc2VwYXJhdGVkIGV2ZW50IG5hbWVzIGJ5IGRlbGVnYXRpbmcgdGhlbSBpbmRpdmlkdWFsbHkuXG4gICAgICBmb3IgKG5hbWVzID0gbmFtZS5zcGxpdChldmVudFNwbGl0dGVyKTsgaSA8IG5hbWVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGV2ZW50cyA9IGl0ZXJhdGVlKGV2ZW50cywgbmFtZXNbaV0sIGNhbGxiYWNrLCBvcHRzKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgLy8gRmluYWxseSwgc3RhbmRhcmQgZXZlbnRzLlxuICAgICAgZXZlbnRzID0gaXRlcmF0ZWUoZXZlbnRzLCBuYW1lLCBjYWxsYmFjaywgb3B0cyk7XG4gICAgfVxuICAgIHJldHVybiBldmVudHM7XG4gIH07XG5cbiAgLy8gQmluZCBhbiBldmVudCB0byBhIGBjYWxsYmFja2AgZnVuY3Rpb24uIFBhc3NpbmcgYFwiYWxsXCJgIHdpbGwgYmluZFxuICAvLyB0aGUgY2FsbGJhY2sgdG8gYWxsIGV2ZW50cyBmaXJlZC5cbiAgRXZlbnRzLm9uID0gZnVuY3Rpb24obmFtZSwgY2FsbGJhY2ssIGNvbnRleHQpIHtcbiAgICByZXR1cm4gaW50ZXJuYWxPbih0aGlzLCBuYW1lLCBjYWxsYmFjaywgY29udGV4dCk7XG4gIH07XG5cbiAgLy8gR3VhcmQgdGhlIGBsaXN0ZW5pbmdgIGFyZ3VtZW50IGZyb20gdGhlIHB1YmxpYyBBUEkuXG4gIHZhciBpbnRlcm5hbE9uID0gZnVuY3Rpb24ob2JqLCBuYW1lLCBjYWxsYmFjaywgY29udGV4dCwgbGlzdGVuaW5nKSB7XG4gICAgb2JqLl9ldmVudHMgPSBldmVudHNBcGkob25BcGksIG9iai5fZXZlbnRzIHx8IHt9LCBuYW1lLCBjYWxsYmFjaywge1xuICAgICAgY29udGV4dDogY29udGV4dCxcbiAgICAgIGN0eDogb2JqLFxuICAgICAgbGlzdGVuaW5nOiBsaXN0ZW5pbmdcbiAgICB9KTtcblxuICAgIGlmIChsaXN0ZW5pbmcpIHtcbiAgICAgIHZhciBsaXN0ZW5lcnMgPSBvYmouX2xpc3RlbmVycyB8fCAob2JqLl9saXN0ZW5lcnMgPSB7fSk7XG4gICAgICBsaXN0ZW5lcnNbbGlzdGVuaW5nLmlkXSA9IGxpc3RlbmluZztcbiAgICB9XG5cbiAgICByZXR1cm4gb2JqO1xuICB9O1xuXG4gIC8vIEludmVyc2lvbi1vZi1jb250cm9sIHZlcnNpb25zIG9mIGBvbmAuIFRlbGwgKnRoaXMqIG9iamVjdCB0byBsaXN0ZW4gdG9cbiAgLy8gYW4gZXZlbnQgaW4gYW5vdGhlciBvYmplY3QuLi4ga2VlcGluZyB0cmFjayBvZiB3aGF0IGl0J3MgbGlzdGVuaW5nIHRvXG4gIC8vIGZvciBlYXNpZXIgdW5iaW5kaW5nIGxhdGVyLlxuICBFdmVudHMubGlzdGVuVG8gPSBmdW5jdGlvbihvYmosIG5hbWUsIGNhbGxiYWNrKSB7XG4gICAgaWYgKCFvYmopIHJldHVybiB0aGlzO1xuICAgIHZhciBpZCA9IG9iai5fbGlzdGVuSWQgfHwgKG9iai5fbGlzdGVuSWQgPSBfLnVuaXF1ZUlkKCdsJykpO1xuICAgIHZhciBsaXN0ZW5pbmdUbyA9IHRoaXMuX2xpc3RlbmluZ1RvIHx8ICh0aGlzLl9saXN0ZW5pbmdUbyA9IHt9KTtcbiAgICB2YXIgbGlzdGVuaW5nID0gbGlzdGVuaW5nVG9baWRdO1xuXG4gICAgLy8gVGhpcyBvYmplY3QgaXMgbm90IGxpc3RlbmluZyB0byBhbnkgb3RoZXIgZXZlbnRzIG9uIGBvYmpgIHlldC5cbiAgICAvLyBTZXR1cCB0aGUgbmVjZXNzYXJ5IHJlZmVyZW5jZXMgdG8gdHJhY2sgdGhlIGxpc3RlbmluZyBjYWxsYmFja3MuXG4gICAgaWYgKCFsaXN0ZW5pbmcpIHtcbiAgICAgIHZhciB0aGlzSWQgPSB0aGlzLl9saXN0ZW5JZCB8fCAodGhpcy5fbGlzdGVuSWQgPSBfLnVuaXF1ZUlkKCdsJykpO1xuICAgICAgbGlzdGVuaW5nID0gbGlzdGVuaW5nVG9baWRdID0ge29iajogb2JqLCBvYmpJZDogaWQsIGlkOiB0aGlzSWQsIGxpc3RlbmluZ1RvOiBsaXN0ZW5pbmdUbywgY291bnQ6IDB9O1xuICAgIH1cblxuICAgIC8vIEJpbmQgY2FsbGJhY2tzIG9uIG9iaiwgYW5kIGtlZXAgdHJhY2sgb2YgdGhlbSBvbiBsaXN0ZW5pbmcuXG4gICAgaW50ZXJuYWxPbihvYmosIG5hbWUsIGNhbGxiYWNrLCB0aGlzLCBsaXN0ZW5pbmcpO1xuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIC8vIFRoZSByZWR1Y2luZyBBUEkgdGhhdCBhZGRzIGEgY2FsbGJhY2sgdG8gdGhlIGBldmVudHNgIG9iamVjdC5cbiAgdmFyIG9uQXBpID0gZnVuY3Rpb24oZXZlbnRzLCBuYW1lLCBjYWxsYmFjaywgb3B0aW9ucykge1xuICAgIGlmIChjYWxsYmFjaykge1xuICAgICAgdmFyIGhhbmRsZXJzID0gZXZlbnRzW25hbWVdIHx8IChldmVudHNbbmFtZV0gPSBbXSk7XG4gICAgICB2YXIgY29udGV4dCA9IG9wdGlvbnMuY29udGV4dCwgY3R4ID0gb3B0aW9ucy5jdHgsIGxpc3RlbmluZyA9IG9wdGlvbnMubGlzdGVuaW5nO1xuICAgICAgaWYgKGxpc3RlbmluZykgbGlzdGVuaW5nLmNvdW50Kys7XG5cbiAgICAgIGhhbmRsZXJzLnB1c2goe2NhbGxiYWNrOiBjYWxsYmFjaywgY29udGV4dDogY29udGV4dCwgY3R4OiBjb250ZXh0IHx8IGN0eCwgbGlzdGVuaW5nOiBsaXN0ZW5pbmd9KTtcbiAgICB9XG4gICAgcmV0dXJuIGV2ZW50cztcbiAgfTtcblxuICAvLyBSZW1vdmUgb25lIG9yIG1hbnkgY2FsbGJhY2tzLiBJZiBgY29udGV4dGAgaXMgbnVsbCwgcmVtb3ZlcyBhbGxcbiAgLy8gY2FsbGJhY2tzIHdpdGggdGhhdCBmdW5jdGlvbi4gSWYgYGNhbGxiYWNrYCBpcyBudWxsLCByZW1vdmVzIGFsbFxuICAvLyBjYWxsYmFja3MgZm9yIHRoZSBldmVudC4gSWYgYG5hbWVgIGlzIG51bGwsIHJlbW92ZXMgYWxsIGJvdW5kXG4gIC8vIGNhbGxiYWNrcyBmb3IgYWxsIGV2ZW50cy5cbiAgRXZlbnRzLm9mZiA9IGZ1bmN0aW9uKG5hbWUsIGNhbGxiYWNrLCBjb250ZXh0KSB7XG4gICAgaWYgKCF0aGlzLl9ldmVudHMpIHJldHVybiB0aGlzO1xuICAgIHRoaXMuX2V2ZW50cyA9IGV2ZW50c0FwaShvZmZBcGksIHRoaXMuX2V2ZW50cywgbmFtZSwgY2FsbGJhY2ssIHtcbiAgICAgIGNvbnRleHQ6IGNvbnRleHQsXG4gICAgICBsaXN0ZW5lcnM6IHRoaXMuX2xpc3RlbmVyc1xuICAgIH0pO1xuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIC8vIFRlbGwgdGhpcyBvYmplY3QgdG8gc3RvcCBsaXN0ZW5pbmcgdG8gZWl0aGVyIHNwZWNpZmljIGV2ZW50cyAuLi4gb3JcbiAgLy8gdG8gZXZlcnkgb2JqZWN0IGl0J3MgY3VycmVudGx5IGxpc3RlbmluZyB0by5cbiAgRXZlbnRzLnN0b3BMaXN0ZW5pbmcgPSBmdW5jdGlvbihvYmosIG5hbWUsIGNhbGxiYWNrKSB7XG4gICAgdmFyIGxpc3RlbmluZ1RvID0gdGhpcy5fbGlzdGVuaW5nVG87XG4gICAgaWYgKCFsaXN0ZW5pbmdUbykgcmV0dXJuIHRoaXM7XG5cbiAgICB2YXIgaWRzID0gb2JqID8gW29iai5fbGlzdGVuSWRdIDogXy5rZXlzKGxpc3RlbmluZ1RvKTtcblxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaWRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICB2YXIgbGlzdGVuaW5nID0gbGlzdGVuaW5nVG9baWRzW2ldXTtcblxuICAgICAgLy8gSWYgbGlzdGVuaW5nIGRvZXNuJ3QgZXhpc3QsIHRoaXMgb2JqZWN0IGlzIG5vdCBjdXJyZW50bHlcbiAgICAgIC8vIGxpc3RlbmluZyB0byBvYmouIEJyZWFrIG91dCBlYXJseS5cbiAgICAgIGlmICghbGlzdGVuaW5nKSBicmVhaztcblxuICAgICAgbGlzdGVuaW5nLm9iai5vZmYobmFtZSwgY2FsbGJhY2ssIHRoaXMpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIC8vIFRoZSByZWR1Y2luZyBBUEkgdGhhdCByZW1vdmVzIGEgY2FsbGJhY2sgZnJvbSB0aGUgYGV2ZW50c2Agb2JqZWN0LlxuICB2YXIgb2ZmQXBpID0gZnVuY3Rpb24oZXZlbnRzLCBuYW1lLCBjYWxsYmFjaywgb3B0aW9ucykge1xuICAgIGlmICghZXZlbnRzKSByZXR1cm47XG5cbiAgICB2YXIgaSA9IDAsIGxpc3RlbmluZztcbiAgICB2YXIgY29udGV4dCA9IG9wdGlvbnMuY29udGV4dCwgbGlzdGVuZXJzID0gb3B0aW9ucy5saXN0ZW5lcnM7XG5cbiAgICAvLyBEZWxldGUgYWxsIGV2ZW50cyBsaXN0ZW5lcnMgYW5kIFwiZHJvcFwiIGV2ZW50cy5cbiAgICBpZiAoIW5hbWUgJiYgIWNhbGxiYWNrICYmICFjb250ZXh0KSB7XG4gICAgICB2YXIgaWRzID0gXy5rZXlzKGxpc3RlbmVycyk7XG4gICAgICBmb3IgKDsgaSA8IGlkcy5sZW5ndGg7IGkrKykge1xuICAgICAgICBsaXN0ZW5pbmcgPSBsaXN0ZW5lcnNbaWRzW2ldXTtcbiAgICAgICAgZGVsZXRlIGxpc3RlbmVyc1tsaXN0ZW5pbmcuaWRdO1xuICAgICAgICBkZWxldGUgbGlzdGVuaW5nLmxpc3RlbmluZ1RvW2xpc3RlbmluZy5vYmpJZF07XG4gICAgICB9XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdmFyIG5hbWVzID0gbmFtZSA/IFtuYW1lXSA6IF8ua2V5cyhldmVudHMpO1xuICAgIGZvciAoOyBpIDwgbmFtZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIG5hbWUgPSBuYW1lc1tpXTtcbiAgICAgIHZhciBoYW5kbGVycyA9IGV2ZW50c1tuYW1lXTtcblxuICAgICAgLy8gQmFpbCBvdXQgaWYgdGhlcmUgYXJlIG5vIGV2ZW50cyBzdG9yZWQuXG4gICAgICBpZiAoIWhhbmRsZXJzKSBicmVhaztcblxuICAgICAgLy8gUmVwbGFjZSBldmVudHMgaWYgdGhlcmUgYXJlIGFueSByZW1haW5pbmcuICBPdGhlcndpc2UsIGNsZWFuIHVwLlxuICAgICAgdmFyIHJlbWFpbmluZyA9IFtdO1xuICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBoYW5kbGVycy5sZW5ndGg7IGorKykge1xuICAgICAgICB2YXIgaGFuZGxlciA9IGhhbmRsZXJzW2pdO1xuICAgICAgICBpZiAoXG4gICAgICAgICAgY2FsbGJhY2sgJiYgY2FsbGJhY2sgIT09IGhhbmRsZXIuY2FsbGJhY2sgJiZcbiAgICAgICAgICAgIGNhbGxiYWNrICE9PSBoYW5kbGVyLmNhbGxiYWNrLl9jYWxsYmFjayB8fFxuICAgICAgICAgICAgICBjb250ZXh0ICYmIGNvbnRleHQgIT09IGhhbmRsZXIuY29udGV4dFxuICAgICAgICApIHtcbiAgICAgICAgICByZW1haW5pbmcucHVzaChoYW5kbGVyKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBsaXN0ZW5pbmcgPSBoYW5kbGVyLmxpc3RlbmluZztcbiAgICAgICAgICBpZiAobGlzdGVuaW5nICYmIC0tbGlzdGVuaW5nLmNvdW50ID09PSAwKSB7XG4gICAgICAgICAgICBkZWxldGUgbGlzdGVuZXJzW2xpc3RlbmluZy5pZF07XG4gICAgICAgICAgICBkZWxldGUgbGlzdGVuaW5nLmxpc3RlbmluZ1RvW2xpc3RlbmluZy5vYmpJZF07XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIFVwZGF0ZSB0YWlsIGV2ZW50IGlmIHRoZSBsaXN0IGhhcyBhbnkgZXZlbnRzLiAgT3RoZXJ3aXNlLCBjbGVhbiB1cC5cbiAgICAgIGlmIChyZW1haW5pbmcubGVuZ3RoKSB7XG4gICAgICAgIGV2ZW50c1tuYW1lXSA9IHJlbWFpbmluZztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGRlbGV0ZSBldmVudHNbbmFtZV07XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBldmVudHM7XG4gIH07XG5cbiAgLy8gQmluZCBhbiBldmVudCB0byBvbmx5IGJlIHRyaWdnZXJlZCBhIHNpbmdsZSB0aW1lLiBBZnRlciB0aGUgZmlyc3QgdGltZVxuICAvLyB0aGUgY2FsbGJhY2sgaXMgaW52b2tlZCwgaXRzIGxpc3RlbmVyIHdpbGwgYmUgcmVtb3ZlZC4gSWYgbXVsdGlwbGUgZXZlbnRzXG4gIC8vIGFyZSBwYXNzZWQgaW4gdXNpbmcgdGhlIHNwYWNlLXNlcGFyYXRlZCBzeW50YXgsIHRoZSBoYW5kbGVyIHdpbGwgZmlyZVxuICAvLyBvbmNlIGZvciBlYWNoIGV2ZW50LCBub3Qgb25jZSBmb3IgYSBjb21iaW5hdGlvbiBvZiBhbGwgZXZlbnRzLlxuICBFdmVudHMub25jZSA9IGZ1bmN0aW9uKG5hbWUsIGNhbGxiYWNrLCBjb250ZXh0KSB7XG4gICAgLy8gTWFwIHRoZSBldmVudCBpbnRvIGEgYHtldmVudDogb25jZX1gIG9iamVjdC5cbiAgICB2YXIgZXZlbnRzID0gZXZlbnRzQXBpKG9uY2VNYXAsIHt9LCBuYW1lLCBjYWxsYmFjaywgXy5iaW5kKHRoaXMub2ZmLCB0aGlzKSk7XG4gICAgaWYgKHR5cGVvZiBuYW1lID09PSAnc3RyaW5nJyAmJiBjb250ZXh0ID09IG51bGwpIGNhbGxiYWNrID0gdm9pZCAwO1xuICAgIHJldHVybiB0aGlzLm9uKGV2ZW50cywgY2FsbGJhY2ssIGNvbnRleHQpO1xuICB9O1xuXG4gIC8vIEludmVyc2lvbi1vZi1jb250cm9sIHZlcnNpb25zIG9mIGBvbmNlYC5cbiAgRXZlbnRzLmxpc3RlblRvT25jZSA9IGZ1bmN0aW9uKG9iaiwgbmFtZSwgY2FsbGJhY2spIHtcbiAgICAvLyBNYXAgdGhlIGV2ZW50IGludG8gYSBge2V2ZW50OiBvbmNlfWAgb2JqZWN0LlxuICAgIHZhciBldmVudHMgPSBldmVudHNBcGkob25jZU1hcCwge30sIG5hbWUsIGNhbGxiYWNrLCBfLmJpbmQodGhpcy5zdG9wTGlzdGVuaW5nLCB0aGlzLCBvYmopKTtcbiAgICByZXR1cm4gdGhpcy5saXN0ZW5UbyhvYmosIGV2ZW50cyk7XG4gIH07XG5cbiAgLy8gUmVkdWNlcyB0aGUgZXZlbnQgY2FsbGJhY2tzIGludG8gYSBtYXAgb2YgYHtldmVudDogb25jZVdyYXBwZXJ9YC5cbiAgLy8gYG9mZmVyYCB1bmJpbmRzIHRoZSBgb25jZVdyYXBwZXJgIGFmdGVyIGl0IGhhcyBiZWVuIGNhbGxlZC5cbiAgdmFyIG9uY2VNYXAgPSBmdW5jdGlvbihtYXAsIG5hbWUsIGNhbGxiYWNrLCBvZmZlcikge1xuICAgIGlmIChjYWxsYmFjaykge1xuICAgICAgdmFyIG9uY2UgPSBtYXBbbmFtZV0gPSBfLm9uY2UoZnVuY3Rpb24oKSB7XG4gICAgICAgIG9mZmVyKG5hbWUsIG9uY2UpO1xuICAgICAgICBjYWxsYmFjay5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgfSk7XG4gICAgICBvbmNlLl9jYWxsYmFjayA9IGNhbGxiYWNrO1xuICAgIH1cbiAgICByZXR1cm4gbWFwO1xuICB9O1xuXG4gIC8vIFRyaWdnZXIgb25lIG9yIG1hbnkgZXZlbnRzLCBmaXJpbmcgYWxsIGJvdW5kIGNhbGxiYWNrcy4gQ2FsbGJhY2tzIGFyZVxuICAvLyBwYXNzZWQgdGhlIHNhbWUgYXJndW1lbnRzIGFzIGB0cmlnZ2VyYCBpcywgYXBhcnQgZnJvbSB0aGUgZXZlbnQgbmFtZVxuICAvLyAodW5sZXNzIHlvdSdyZSBsaXN0ZW5pbmcgb24gYFwiYWxsXCJgLCB3aGljaCB3aWxsIGNhdXNlIHlvdXIgY2FsbGJhY2sgdG9cbiAgLy8gcmVjZWl2ZSB0aGUgdHJ1ZSBuYW1lIG9mIHRoZSBldmVudCBhcyB0aGUgZmlyc3QgYXJndW1lbnQpLlxuICBFdmVudHMudHJpZ2dlciA9IGZ1bmN0aW9uKG5hbWUpIHtcbiAgICBpZiAoIXRoaXMuX2V2ZW50cykgcmV0dXJuIHRoaXM7XG5cbiAgICB2YXIgbGVuZ3RoID0gTWF0aC5tYXgoMCwgYXJndW1lbnRzLmxlbmd0aCAtIDEpO1xuICAgIHZhciBhcmdzID0gQXJyYXkobGVuZ3RoKTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSBhcmdzW2ldID0gYXJndW1lbnRzW2kgKyAxXTtcblxuICAgIGV2ZW50c0FwaSh0cmlnZ2VyQXBpLCB0aGlzLl9ldmVudHMsIG5hbWUsIHZvaWQgMCwgYXJncyk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgLy8gSGFuZGxlcyB0cmlnZ2VyaW5nIHRoZSBhcHByb3ByaWF0ZSBldmVudCBjYWxsYmFja3MuXG4gIHZhciB0cmlnZ2VyQXBpID0gZnVuY3Rpb24ob2JqRXZlbnRzLCBuYW1lLCBjYWxsYmFjaywgYXJncykge1xuICAgIGlmIChvYmpFdmVudHMpIHtcbiAgICAgIHZhciBldmVudHMgPSBvYmpFdmVudHNbbmFtZV07XG4gICAgICB2YXIgYWxsRXZlbnRzID0gb2JqRXZlbnRzLmFsbDtcbiAgICAgIGlmIChldmVudHMgJiYgYWxsRXZlbnRzKSBhbGxFdmVudHMgPSBhbGxFdmVudHMuc2xpY2UoKTtcbiAgICAgIGlmIChldmVudHMpIHRyaWdnZXJFdmVudHMoZXZlbnRzLCBhcmdzKTtcbiAgICAgIGlmIChhbGxFdmVudHMpIHRyaWdnZXJFdmVudHMoYWxsRXZlbnRzLCBbbmFtZV0uY29uY2F0KGFyZ3MpKTtcbiAgICB9XG4gICAgcmV0dXJuIG9iakV2ZW50cztcbiAgfTtcblxuICAvLyBBIGRpZmZpY3VsdC10by1iZWxpZXZlLCBidXQgb3B0aW1pemVkIGludGVybmFsIGRpc3BhdGNoIGZ1bmN0aW9uIGZvclxuICAvLyB0cmlnZ2VyaW5nIGV2ZW50cy4gVHJpZXMgdG8ga2VlcCB0aGUgdXN1YWwgY2FzZXMgc3BlZWR5IChtb3N0IGludGVybmFsXG4gIC8vIEJhY2tib25lIGV2ZW50cyBoYXZlIDMgYXJndW1lbnRzKS5cbiAgdmFyIHRyaWdnZXJFdmVudHMgPSBmdW5jdGlvbihldmVudHMsIGFyZ3MpIHtcbiAgICB2YXIgZXYsIGkgPSAtMSwgbCA9IGV2ZW50cy5sZW5ndGgsIGExID0gYXJnc1swXSwgYTIgPSBhcmdzWzFdLCBhMyA9IGFyZ3NbMl07XG4gICAgc3dpdGNoIChhcmdzLmxlbmd0aCkge1xuICAgICAgY2FzZSAwOiB3aGlsZSAoKytpIDwgbCkgKGV2ID0gZXZlbnRzW2ldKS5jYWxsYmFjay5jYWxsKGV2LmN0eCk7IHJldHVybjtcbiAgICAgIGNhc2UgMTogd2hpbGUgKCsraSA8IGwpIChldiA9IGV2ZW50c1tpXSkuY2FsbGJhY2suY2FsbChldi5jdHgsIGExKTsgcmV0dXJuO1xuICAgICAgY2FzZSAyOiB3aGlsZSAoKytpIDwgbCkgKGV2ID0gZXZlbnRzW2ldKS5jYWxsYmFjay5jYWxsKGV2LmN0eCwgYTEsIGEyKTsgcmV0dXJuO1xuICAgICAgY2FzZSAzOiB3aGlsZSAoKytpIDwgbCkgKGV2ID0gZXZlbnRzW2ldKS5jYWxsYmFjay5jYWxsKGV2LmN0eCwgYTEsIGEyLCBhMyk7IHJldHVybjtcbiAgICAgIGRlZmF1bHQ6IHdoaWxlICgrK2kgPCBsKSAoZXYgPSBldmVudHNbaV0pLmNhbGxiYWNrLmFwcGx5KGV2LmN0eCwgYXJncyk7IHJldHVybjtcbiAgICB9XG4gIH07XG5cbiAgLy8gQWxpYXNlcyBmb3IgYmFja3dhcmRzIGNvbXBhdGliaWxpdHkuXG4gIEV2ZW50cy5iaW5kICAgPSBFdmVudHMub247XG4gIEV2ZW50cy51bmJpbmQgPSBFdmVudHMub2ZmO1xuXG4gIC8vIEFsbG93IHRoZSBgQmFja2JvbmVgIG9iamVjdCB0byBzZXJ2ZSBhcyBhIGdsb2JhbCBldmVudCBidXMsIGZvciBmb2xrcyB3aG9cbiAgLy8gd2FudCBnbG9iYWwgXCJwdWJzdWJcIiBpbiBhIGNvbnZlbmllbnQgcGxhY2UuXG4gIF8uZXh0ZW5kKEJhY2tib25lLCBFdmVudHMpO1xuXG4gIC8vIEJhY2tib25lLk1vZGVsXG4gIC8vIC0tLS0tLS0tLS0tLS0tXG5cbiAgLy8gQmFja2JvbmUgKipNb2RlbHMqKiBhcmUgdGhlIGJhc2ljIGRhdGEgb2JqZWN0IGluIHRoZSBmcmFtZXdvcmsgLS1cbiAgLy8gZnJlcXVlbnRseSByZXByZXNlbnRpbmcgYSByb3cgaW4gYSB0YWJsZSBpbiBhIGRhdGFiYXNlIG9uIHlvdXIgc2VydmVyLlxuICAvLyBBIGRpc2NyZXRlIGNodW5rIG9mIGRhdGEgYW5kIGEgYnVuY2ggb2YgdXNlZnVsLCByZWxhdGVkIG1ldGhvZHMgZm9yXG4gIC8vIHBlcmZvcm1pbmcgY29tcHV0YXRpb25zIGFuZCB0cmFuc2Zvcm1hdGlvbnMgb24gdGhhdCBkYXRhLlxuXG4gIC8vIENyZWF0ZSBhIG5ldyBtb2RlbCB3aXRoIHRoZSBzcGVjaWZpZWQgYXR0cmlidXRlcy4gQSBjbGllbnQgaWQgKGBjaWRgKVxuICAvLyBpcyBhdXRvbWF0aWNhbGx5IGdlbmVyYXRlZCBhbmQgYXNzaWduZWQgZm9yIHlvdS5cbiAgdmFyIE1vZGVsID0gQmFja2JvbmUuTW9kZWwgPSBmdW5jdGlvbihhdHRyaWJ1dGVzLCBvcHRpb25zKSB7XG4gICAgdmFyIGF0dHJzID0gYXR0cmlidXRlcyB8fCB7fTtcbiAgICBvcHRpb25zIHx8IChvcHRpb25zID0ge30pO1xuICAgIHRoaXMuY2lkID0gXy51bmlxdWVJZCh0aGlzLmNpZFByZWZpeCk7XG4gICAgdGhpcy5hdHRyaWJ1dGVzID0ge307XG4gICAgaWYgKG9wdGlvbnMuY29sbGVjdGlvbikgdGhpcy5jb2xsZWN0aW9uID0gb3B0aW9ucy5jb2xsZWN0aW9uO1xuICAgIGlmIChvcHRpb25zLnBhcnNlKSBhdHRycyA9IHRoaXMucGFyc2UoYXR0cnMsIG9wdGlvbnMpIHx8IHt9O1xuICAgIHZhciBkZWZhdWx0cyA9IF8ucmVzdWx0KHRoaXMsICdkZWZhdWx0cycpO1xuICAgIGF0dHJzID0gXy5kZWZhdWx0cyhfLmV4dGVuZCh7fSwgZGVmYXVsdHMsIGF0dHJzKSwgZGVmYXVsdHMpO1xuICAgIHRoaXMuc2V0KGF0dHJzLCBvcHRpb25zKTtcbiAgICB0aGlzLmNoYW5nZWQgPSB7fTtcbiAgICB0aGlzLmluaXRpYWxpemUuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgfTtcblxuICAvLyBBdHRhY2ggYWxsIGluaGVyaXRhYmxlIG1ldGhvZHMgdG8gdGhlIE1vZGVsIHByb3RvdHlwZS5cbiAgXy5leHRlbmQoTW9kZWwucHJvdG90eXBlLCBFdmVudHMsIHtcblxuICAgIC8vIEEgaGFzaCBvZiBhdHRyaWJ1dGVzIHdob3NlIGN1cnJlbnQgYW5kIHByZXZpb3VzIHZhbHVlIGRpZmZlci5cbiAgICBjaGFuZ2VkOiBudWxsLFxuXG4gICAgLy8gVGhlIHZhbHVlIHJldHVybmVkIGR1cmluZyB0aGUgbGFzdCBmYWlsZWQgdmFsaWRhdGlvbi5cbiAgICB2YWxpZGF0aW9uRXJyb3I6IG51bGwsXG5cbiAgICAvLyBUaGUgZGVmYXVsdCBuYW1lIGZvciB0aGUgSlNPTiBgaWRgIGF0dHJpYnV0ZSBpcyBgXCJpZFwiYC4gTW9uZ29EQiBhbmRcbiAgICAvLyBDb3VjaERCIHVzZXJzIG1heSB3YW50IHRvIHNldCB0aGlzIHRvIGBcIl9pZFwiYC5cbiAgICBpZEF0dHJpYnV0ZTogJ2lkJyxcblxuICAgIC8vIFRoZSBwcmVmaXggaXMgdXNlZCB0byBjcmVhdGUgdGhlIGNsaWVudCBpZCB3aGljaCBpcyB1c2VkIHRvIGlkZW50aWZ5IG1vZGVscyBsb2NhbGx5LlxuICAgIC8vIFlvdSBtYXkgd2FudCB0byBvdmVycmlkZSB0aGlzIGlmIHlvdSdyZSBleHBlcmllbmNpbmcgbmFtZSBjbGFzaGVzIHdpdGggbW9kZWwgaWRzLlxuICAgIGNpZFByZWZpeDogJ2MnLFxuXG4gICAgLy8gSW5pdGlhbGl6ZSBpcyBhbiBlbXB0eSBmdW5jdGlvbiBieSBkZWZhdWx0LiBPdmVycmlkZSBpdCB3aXRoIHlvdXIgb3duXG4gICAgLy8gaW5pdGlhbGl6YXRpb24gbG9naWMuXG4gICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKXt9LFxuXG4gICAgLy8gUmV0dXJuIGEgY29weSBvZiB0aGUgbW9kZWwncyBgYXR0cmlidXRlc2Agb2JqZWN0LlxuICAgIHRvSlNPTjogZnVuY3Rpb24ob3B0aW9ucykge1xuICAgICAgcmV0dXJuIF8uY2xvbmUodGhpcy5hdHRyaWJ1dGVzKTtcbiAgICB9LFxuXG4gICAgLy8gUHJveHkgYEJhY2tib25lLnN5bmNgIGJ5IGRlZmF1bHQgLS0gYnV0IG92ZXJyaWRlIHRoaXMgaWYgeW91IG5lZWRcbiAgICAvLyBjdXN0b20gc3luY2luZyBzZW1hbnRpY3MgZm9yICp0aGlzKiBwYXJ0aWN1bGFyIG1vZGVsLlxuICAgIHN5bmM6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIEJhY2tib25lLnN5bmMuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICB9LFxuXG4gICAgLy8gR2V0IHRoZSB2YWx1ZSBvZiBhbiBhdHRyaWJ1dGUuXG4gICAgZ2V0OiBmdW5jdGlvbihhdHRyKSB7XG4gICAgICByZXR1cm4gdGhpcy5hdHRyaWJ1dGVzW2F0dHJdO1xuICAgIH0sXG5cbiAgICAvLyBHZXQgdGhlIEhUTUwtZXNjYXBlZCB2YWx1ZSBvZiBhbiBhdHRyaWJ1dGUuXG4gICAgZXNjYXBlOiBmdW5jdGlvbihhdHRyKSB7XG4gICAgICByZXR1cm4gXy5lc2NhcGUodGhpcy5nZXQoYXR0cikpO1xuICAgIH0sXG5cbiAgICAvLyBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgYXR0cmlidXRlIGNvbnRhaW5zIGEgdmFsdWUgdGhhdCBpcyBub3QgbnVsbFxuICAgIC8vIG9yIHVuZGVmaW5lZC5cbiAgICBoYXM6IGZ1bmN0aW9uKGF0dHIpIHtcbiAgICAgIHJldHVybiB0aGlzLmdldChhdHRyKSAhPSBudWxsO1xuICAgIH0sXG5cbiAgICAvLyBTcGVjaWFsLWNhc2VkIHByb3h5IHRvIHVuZGVyc2NvcmUncyBgXy5tYXRjaGVzYCBtZXRob2QuXG4gICAgbWF0Y2hlczogZnVuY3Rpb24oYXR0cnMpIHtcbiAgICAgIHJldHVybiAhIV8uaXRlcmF0ZWUoYXR0cnMsIHRoaXMpKHRoaXMuYXR0cmlidXRlcyk7XG4gICAgfSxcblxuICAgIC8vIFNldCBhIGhhc2ggb2YgbW9kZWwgYXR0cmlidXRlcyBvbiB0aGUgb2JqZWN0LCBmaXJpbmcgYFwiY2hhbmdlXCJgLiBUaGlzIGlzXG4gICAgLy8gdGhlIGNvcmUgcHJpbWl0aXZlIG9wZXJhdGlvbiBvZiBhIG1vZGVsLCB1cGRhdGluZyB0aGUgZGF0YSBhbmQgbm90aWZ5aW5nXG4gICAgLy8gYW55b25lIHdobyBuZWVkcyB0byBrbm93IGFib3V0IHRoZSBjaGFuZ2UgaW4gc3RhdGUuIFRoZSBoZWFydCBvZiB0aGUgYmVhc3QuXG4gICAgc2V0OiBmdW5jdGlvbihrZXksIHZhbCwgb3B0aW9ucykge1xuICAgICAgaWYgKGtleSA9PSBudWxsKSByZXR1cm4gdGhpcztcblxuICAgICAgLy8gSGFuZGxlIGJvdGggYFwia2V5XCIsIHZhbHVlYCBhbmQgYHtrZXk6IHZhbHVlfWAgLXN0eWxlIGFyZ3VtZW50cy5cbiAgICAgIHZhciBhdHRycztcbiAgICAgIGlmICh0eXBlb2Yga2V5ID09PSAnb2JqZWN0Jykge1xuICAgICAgICBhdHRycyA9IGtleTtcbiAgICAgICAgb3B0aW9ucyA9IHZhbDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIChhdHRycyA9IHt9KVtrZXldID0gdmFsO1xuICAgICAgfVxuXG4gICAgICBvcHRpb25zIHx8IChvcHRpb25zID0ge30pO1xuXG4gICAgICAvLyBSdW4gdmFsaWRhdGlvbi5cbiAgICAgIGlmICghdGhpcy5fdmFsaWRhdGUoYXR0cnMsIG9wdGlvbnMpKSByZXR1cm4gZmFsc2U7XG5cbiAgICAgIC8vIEV4dHJhY3QgYXR0cmlidXRlcyBhbmQgb3B0aW9ucy5cbiAgICAgIHZhciB1bnNldCAgICAgID0gb3B0aW9ucy51bnNldDtcbiAgICAgIHZhciBzaWxlbnQgICAgID0gb3B0aW9ucy5zaWxlbnQ7XG4gICAgICB2YXIgY2hhbmdlcyAgICA9IFtdO1xuICAgICAgdmFyIGNoYW5naW5nICAgPSB0aGlzLl9jaGFuZ2luZztcbiAgICAgIHRoaXMuX2NoYW5naW5nID0gdHJ1ZTtcblxuICAgICAgaWYgKCFjaGFuZ2luZykge1xuICAgICAgICB0aGlzLl9wcmV2aW91c0F0dHJpYnV0ZXMgPSBfLmNsb25lKHRoaXMuYXR0cmlidXRlcyk7XG4gICAgICAgIHRoaXMuY2hhbmdlZCA9IHt9O1xuICAgICAgfVxuXG4gICAgICB2YXIgY3VycmVudCA9IHRoaXMuYXR0cmlidXRlcztcbiAgICAgIHZhciBjaGFuZ2VkID0gdGhpcy5jaGFuZ2VkO1xuICAgICAgdmFyIHByZXYgICAgPSB0aGlzLl9wcmV2aW91c0F0dHJpYnV0ZXM7XG5cbiAgICAgIC8vIEZvciBlYWNoIGBzZXRgIGF0dHJpYnV0ZSwgdXBkYXRlIG9yIGRlbGV0ZSB0aGUgY3VycmVudCB2YWx1ZS5cbiAgICAgIGZvciAodmFyIGF0dHIgaW4gYXR0cnMpIHtcbiAgICAgICAgdmFsID0gYXR0cnNbYXR0cl07XG4gICAgICAgIGlmICghXy5pc0VxdWFsKGN1cnJlbnRbYXR0cl0sIHZhbCkpIGNoYW5nZXMucHVzaChhdHRyKTtcbiAgICAgICAgaWYgKCFfLmlzRXF1YWwocHJldlthdHRyXSwgdmFsKSkge1xuICAgICAgICAgIGNoYW5nZWRbYXR0cl0gPSB2YWw7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZGVsZXRlIGNoYW5nZWRbYXR0cl07XG4gICAgICAgIH1cbiAgICAgICAgdW5zZXQgPyBkZWxldGUgY3VycmVudFthdHRyXSA6IGN1cnJlbnRbYXR0cl0gPSB2YWw7XG4gICAgICB9XG5cbiAgICAgIC8vIFVwZGF0ZSB0aGUgYGlkYC5cbiAgICAgIGlmICh0aGlzLmlkQXR0cmlidXRlIGluIGF0dHJzKSB0aGlzLmlkID0gdGhpcy5nZXQodGhpcy5pZEF0dHJpYnV0ZSk7XG5cbiAgICAgIC8vIFRyaWdnZXIgYWxsIHJlbGV2YW50IGF0dHJpYnV0ZSBjaGFuZ2VzLlxuICAgICAgaWYgKCFzaWxlbnQpIHtcbiAgICAgICAgaWYgKGNoYW5nZXMubGVuZ3RoKSB0aGlzLl9wZW5kaW5nID0gb3B0aW9ucztcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjaGFuZ2VzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgdGhpcy50cmlnZ2VyKCdjaGFuZ2U6JyArIGNoYW5nZXNbaV0sIHRoaXMsIGN1cnJlbnRbY2hhbmdlc1tpXV0sIG9wdGlvbnMpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIFlvdSBtaWdodCBiZSB3b25kZXJpbmcgd2h5IHRoZXJlJ3MgYSBgd2hpbGVgIGxvb3AgaGVyZS4gQ2hhbmdlcyBjYW5cbiAgICAgIC8vIGJlIHJlY3Vyc2l2ZWx5IG5lc3RlZCB3aXRoaW4gYFwiY2hhbmdlXCJgIGV2ZW50cy5cbiAgICAgIGlmIChjaGFuZ2luZykgcmV0dXJuIHRoaXM7XG4gICAgICBpZiAoIXNpbGVudCkge1xuICAgICAgICB3aGlsZSAodGhpcy5fcGVuZGluZykge1xuICAgICAgICAgIG9wdGlvbnMgPSB0aGlzLl9wZW5kaW5nO1xuICAgICAgICAgIHRoaXMuX3BlbmRpbmcgPSBmYWxzZTtcbiAgICAgICAgICB0aGlzLnRyaWdnZXIoJ2NoYW5nZScsIHRoaXMsIG9wdGlvbnMpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICB0aGlzLl9wZW5kaW5nID0gZmFsc2U7XG4gICAgICB0aGlzLl9jaGFuZ2luZyA9IGZhbHNlO1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIC8vIFJlbW92ZSBhbiBhdHRyaWJ1dGUgZnJvbSB0aGUgbW9kZWwsIGZpcmluZyBgXCJjaGFuZ2VcImAuIGB1bnNldGAgaXMgYSBub29wXG4gICAgLy8gaWYgdGhlIGF0dHJpYnV0ZSBkb2Vzbid0IGV4aXN0LlxuICAgIHVuc2V0OiBmdW5jdGlvbihhdHRyLCBvcHRpb25zKSB7XG4gICAgICByZXR1cm4gdGhpcy5zZXQoYXR0ciwgdm9pZCAwLCBfLmV4dGVuZCh7fSwgb3B0aW9ucywge3Vuc2V0OiB0cnVlfSkpO1xuICAgIH0sXG5cbiAgICAvLyBDbGVhciBhbGwgYXR0cmlidXRlcyBvbiB0aGUgbW9kZWwsIGZpcmluZyBgXCJjaGFuZ2VcImAuXG4gICAgY2xlYXI6IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICAgIHZhciBhdHRycyA9IHt9O1xuICAgICAgZm9yICh2YXIga2V5IGluIHRoaXMuYXR0cmlidXRlcykgYXR0cnNba2V5XSA9IHZvaWQgMDtcbiAgICAgIHJldHVybiB0aGlzLnNldChhdHRycywgXy5leHRlbmQoe30sIG9wdGlvbnMsIHt1bnNldDogdHJ1ZX0pKTtcbiAgICB9LFxuXG4gICAgLy8gRGV0ZXJtaW5lIGlmIHRoZSBtb2RlbCBoYXMgY2hhbmdlZCBzaW5jZSB0aGUgbGFzdCBgXCJjaGFuZ2VcImAgZXZlbnQuXG4gICAgLy8gSWYgeW91IHNwZWNpZnkgYW4gYXR0cmlidXRlIG5hbWUsIGRldGVybWluZSBpZiB0aGF0IGF0dHJpYnV0ZSBoYXMgY2hhbmdlZC5cbiAgICBoYXNDaGFuZ2VkOiBmdW5jdGlvbihhdHRyKSB7XG4gICAgICBpZiAoYXR0ciA9PSBudWxsKSByZXR1cm4gIV8uaXNFbXB0eSh0aGlzLmNoYW5nZWQpO1xuICAgICAgcmV0dXJuIF8uaGFzKHRoaXMuY2hhbmdlZCwgYXR0cik7XG4gICAgfSxcblxuICAgIC8vIFJldHVybiBhbiBvYmplY3QgY29udGFpbmluZyBhbGwgdGhlIGF0dHJpYnV0ZXMgdGhhdCBoYXZlIGNoYW5nZWQsIG9yXG4gICAgLy8gZmFsc2UgaWYgdGhlcmUgYXJlIG5vIGNoYW5nZWQgYXR0cmlidXRlcy4gVXNlZnVsIGZvciBkZXRlcm1pbmluZyB3aGF0XG4gICAgLy8gcGFydHMgb2YgYSB2aWV3IG5lZWQgdG8gYmUgdXBkYXRlZCBhbmQvb3Igd2hhdCBhdHRyaWJ1dGVzIG5lZWQgdG8gYmVcbiAgICAvLyBwZXJzaXN0ZWQgdG8gdGhlIHNlcnZlci4gVW5zZXQgYXR0cmlidXRlcyB3aWxsIGJlIHNldCB0byB1bmRlZmluZWQuXG4gICAgLy8gWW91IGNhbiBhbHNvIHBhc3MgYW4gYXR0cmlidXRlcyBvYmplY3QgdG8gZGlmZiBhZ2FpbnN0IHRoZSBtb2RlbCxcbiAgICAvLyBkZXRlcm1pbmluZyBpZiB0aGVyZSAqd291bGQgYmUqIGEgY2hhbmdlLlxuICAgIGNoYW5nZWRBdHRyaWJ1dGVzOiBmdW5jdGlvbihkaWZmKSB7XG4gICAgICBpZiAoIWRpZmYpIHJldHVybiB0aGlzLmhhc0NoYW5nZWQoKSA/IF8uY2xvbmUodGhpcy5jaGFuZ2VkKSA6IGZhbHNlO1xuICAgICAgdmFyIG9sZCA9IHRoaXMuX2NoYW5naW5nID8gdGhpcy5fcHJldmlvdXNBdHRyaWJ1dGVzIDogdGhpcy5hdHRyaWJ1dGVzO1xuICAgICAgdmFyIGNoYW5nZWQgPSB7fTtcbiAgICAgIGZvciAodmFyIGF0dHIgaW4gZGlmZikge1xuICAgICAgICB2YXIgdmFsID0gZGlmZlthdHRyXTtcbiAgICAgICAgaWYgKF8uaXNFcXVhbChvbGRbYXR0cl0sIHZhbCkpIGNvbnRpbnVlO1xuICAgICAgICBjaGFuZ2VkW2F0dHJdID0gdmFsO1xuICAgICAgfVxuICAgICAgcmV0dXJuIF8uc2l6ZShjaGFuZ2VkKSA/IGNoYW5nZWQgOiBmYWxzZTtcbiAgICB9LFxuXG4gICAgLy8gR2V0IHRoZSBwcmV2aW91cyB2YWx1ZSBvZiBhbiBhdHRyaWJ1dGUsIHJlY29yZGVkIGF0IHRoZSB0aW1lIHRoZSBsYXN0XG4gICAgLy8gYFwiY2hhbmdlXCJgIGV2ZW50IHdhcyBmaXJlZC5cbiAgICBwcmV2aW91czogZnVuY3Rpb24oYXR0cikge1xuICAgICAgaWYgKGF0dHIgPT0gbnVsbCB8fCAhdGhpcy5fcHJldmlvdXNBdHRyaWJ1dGVzKSByZXR1cm4gbnVsbDtcbiAgICAgIHJldHVybiB0aGlzLl9wcmV2aW91c0F0dHJpYnV0ZXNbYXR0cl07XG4gICAgfSxcblxuICAgIC8vIEdldCBhbGwgb2YgdGhlIGF0dHJpYnV0ZXMgb2YgdGhlIG1vZGVsIGF0IHRoZSB0aW1lIG9mIHRoZSBwcmV2aW91c1xuICAgIC8vIGBcImNoYW5nZVwiYCBldmVudC5cbiAgICBwcmV2aW91c0F0dHJpYnV0ZXM6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIF8uY2xvbmUodGhpcy5fcHJldmlvdXNBdHRyaWJ1dGVzKTtcbiAgICB9LFxuXG4gICAgLy8gRmV0Y2ggdGhlIG1vZGVsIGZyb20gdGhlIHNlcnZlciwgbWVyZ2luZyB0aGUgcmVzcG9uc2Ugd2l0aCB0aGUgbW9kZWwnc1xuICAgIC8vIGxvY2FsIGF0dHJpYnV0ZXMuIEFueSBjaGFuZ2VkIGF0dHJpYnV0ZXMgd2lsbCB0cmlnZ2VyIGEgXCJjaGFuZ2VcIiBldmVudC5cbiAgICBmZXRjaDogZnVuY3Rpb24ob3B0aW9ucykge1xuICAgICAgb3B0aW9ucyA9IF8uZXh0ZW5kKHtwYXJzZTogdHJ1ZX0sIG9wdGlvbnMpO1xuICAgICAgdmFyIG1vZGVsID0gdGhpcztcbiAgICAgIHZhciBzdWNjZXNzID0gb3B0aW9ucy5zdWNjZXNzO1xuICAgICAgb3B0aW9ucy5zdWNjZXNzID0gZnVuY3Rpb24ocmVzcCkge1xuICAgICAgICB2YXIgc2VydmVyQXR0cnMgPSBvcHRpb25zLnBhcnNlID8gbW9kZWwucGFyc2UocmVzcCwgb3B0aW9ucykgOiByZXNwO1xuICAgICAgICBpZiAoIW1vZGVsLnNldChzZXJ2ZXJBdHRycywgb3B0aW9ucykpIHJldHVybiBmYWxzZTtcbiAgICAgICAgaWYgKHN1Y2Nlc3MpIHN1Y2Nlc3MuY2FsbChvcHRpb25zLmNvbnRleHQsIG1vZGVsLCByZXNwLCBvcHRpb25zKTtcbiAgICAgICAgbW9kZWwudHJpZ2dlcignc3luYycsIG1vZGVsLCByZXNwLCBvcHRpb25zKTtcbiAgICAgIH07XG4gICAgICB3cmFwRXJyb3IodGhpcywgb3B0aW9ucyk7XG4gICAgICByZXR1cm4gdGhpcy5zeW5jKCdyZWFkJywgdGhpcywgb3B0aW9ucyk7XG4gICAgfSxcblxuICAgIC8vIFNldCBhIGhhc2ggb2YgbW9kZWwgYXR0cmlidXRlcywgYW5kIHN5bmMgdGhlIG1vZGVsIHRvIHRoZSBzZXJ2ZXIuXG4gICAgLy8gSWYgdGhlIHNlcnZlciByZXR1cm5zIGFuIGF0dHJpYnV0ZXMgaGFzaCB0aGF0IGRpZmZlcnMsIHRoZSBtb2RlbCdzXG4gICAgLy8gc3RhdGUgd2lsbCBiZSBgc2V0YCBhZ2Fpbi5cbiAgICBzYXZlOiBmdW5jdGlvbihrZXksIHZhbCwgb3B0aW9ucykge1xuICAgICAgLy8gSGFuZGxlIGJvdGggYFwia2V5XCIsIHZhbHVlYCBhbmQgYHtrZXk6IHZhbHVlfWAgLXN0eWxlIGFyZ3VtZW50cy5cbiAgICAgIHZhciBhdHRycztcbiAgICAgIGlmIChrZXkgPT0gbnVsbCB8fCB0eXBlb2Yga2V5ID09PSAnb2JqZWN0Jykge1xuICAgICAgICBhdHRycyA9IGtleTtcbiAgICAgICAgb3B0aW9ucyA9IHZhbDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIChhdHRycyA9IHt9KVtrZXldID0gdmFsO1xuICAgICAgfVxuXG4gICAgICBvcHRpb25zID0gXy5leHRlbmQoe3ZhbGlkYXRlOiB0cnVlLCBwYXJzZTogdHJ1ZX0sIG9wdGlvbnMpO1xuICAgICAgdmFyIHdhaXQgPSBvcHRpb25zLndhaXQ7XG5cbiAgICAgIC8vIElmIHdlJ3JlIG5vdCB3YWl0aW5nIGFuZCBhdHRyaWJ1dGVzIGV4aXN0LCBzYXZlIGFjdHMgYXNcbiAgICAgIC8vIGBzZXQoYXR0cikuc2F2ZShudWxsLCBvcHRzKWAgd2l0aCB2YWxpZGF0aW9uLiBPdGhlcndpc2UsIGNoZWNrIGlmXG4gICAgICAvLyB0aGUgbW9kZWwgd2lsbCBiZSB2YWxpZCB3aGVuIHRoZSBhdHRyaWJ1dGVzLCBpZiBhbnksIGFyZSBzZXQuXG4gICAgICBpZiAoYXR0cnMgJiYgIXdhaXQpIHtcbiAgICAgICAgaWYgKCF0aGlzLnNldChhdHRycywgb3B0aW9ucykpIHJldHVybiBmYWxzZTtcbiAgICAgIH0gZWxzZSBpZiAoIXRoaXMuX3ZhbGlkYXRlKGF0dHJzLCBvcHRpb25zKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG5cbiAgICAgIC8vIEFmdGVyIGEgc3VjY2Vzc2Z1bCBzZXJ2ZXItc2lkZSBzYXZlLCB0aGUgY2xpZW50IGlzIChvcHRpb25hbGx5KVxuICAgICAgLy8gdXBkYXRlZCB3aXRoIHRoZSBzZXJ2ZXItc2lkZSBzdGF0ZS5cbiAgICAgIHZhciBtb2RlbCA9IHRoaXM7XG4gICAgICB2YXIgc3VjY2VzcyA9IG9wdGlvbnMuc3VjY2VzcztcbiAgICAgIHZhciBhdHRyaWJ1dGVzID0gdGhpcy5hdHRyaWJ1dGVzO1xuICAgICAgb3B0aW9ucy5zdWNjZXNzID0gZnVuY3Rpb24ocmVzcCkge1xuICAgICAgICAvLyBFbnN1cmUgYXR0cmlidXRlcyBhcmUgcmVzdG9yZWQgZHVyaW5nIHN5bmNocm9ub3VzIHNhdmVzLlxuICAgICAgICBtb2RlbC5hdHRyaWJ1dGVzID0gYXR0cmlidXRlcztcbiAgICAgICAgdmFyIHNlcnZlckF0dHJzID0gb3B0aW9ucy5wYXJzZSA/IG1vZGVsLnBhcnNlKHJlc3AsIG9wdGlvbnMpIDogcmVzcDtcbiAgICAgICAgaWYgKHdhaXQpIHNlcnZlckF0dHJzID0gXy5leHRlbmQoe30sIGF0dHJzLCBzZXJ2ZXJBdHRycyk7XG4gICAgICAgIGlmIChzZXJ2ZXJBdHRycyAmJiAhbW9kZWwuc2V0KHNlcnZlckF0dHJzLCBvcHRpb25zKSkgcmV0dXJuIGZhbHNlO1xuICAgICAgICBpZiAoc3VjY2Vzcykgc3VjY2Vzcy5jYWxsKG9wdGlvbnMuY29udGV4dCwgbW9kZWwsIHJlc3AsIG9wdGlvbnMpO1xuICAgICAgICBtb2RlbC50cmlnZ2VyKCdzeW5jJywgbW9kZWwsIHJlc3AsIG9wdGlvbnMpO1xuICAgICAgfTtcbiAgICAgIHdyYXBFcnJvcih0aGlzLCBvcHRpb25zKTtcblxuICAgICAgLy8gU2V0IHRlbXBvcmFyeSBhdHRyaWJ1dGVzIGlmIGB7d2FpdDogdHJ1ZX1gIHRvIHByb3Blcmx5IGZpbmQgbmV3IGlkcy5cbiAgICAgIGlmIChhdHRycyAmJiB3YWl0KSB0aGlzLmF0dHJpYnV0ZXMgPSBfLmV4dGVuZCh7fSwgYXR0cmlidXRlcywgYXR0cnMpO1xuXG4gICAgICB2YXIgbWV0aG9kID0gdGhpcy5pc05ldygpID8gJ2NyZWF0ZScgOiAob3B0aW9ucy5wYXRjaCA/ICdwYXRjaCcgOiAndXBkYXRlJyk7XG4gICAgICBpZiAobWV0aG9kID09PSAncGF0Y2gnICYmICFvcHRpb25zLmF0dHJzKSBvcHRpb25zLmF0dHJzID0gYXR0cnM7XG4gICAgICB2YXIgeGhyID0gdGhpcy5zeW5jKG1ldGhvZCwgdGhpcywgb3B0aW9ucyk7XG5cbiAgICAgIC8vIFJlc3RvcmUgYXR0cmlidXRlcy5cbiAgICAgIHRoaXMuYXR0cmlidXRlcyA9IGF0dHJpYnV0ZXM7XG5cbiAgICAgIHJldHVybiB4aHI7XG4gICAgfSxcblxuICAgIC8vIERlc3Ryb3kgdGhpcyBtb2RlbCBvbiB0aGUgc2VydmVyIGlmIGl0IHdhcyBhbHJlYWR5IHBlcnNpc3RlZC5cbiAgICAvLyBPcHRpbWlzdGljYWxseSByZW1vdmVzIHRoZSBtb2RlbCBmcm9tIGl0cyBjb2xsZWN0aW9uLCBpZiBpdCBoYXMgb25lLlxuICAgIC8vIElmIGB3YWl0OiB0cnVlYCBpcyBwYXNzZWQsIHdhaXRzIGZvciB0aGUgc2VydmVyIHRvIHJlc3BvbmQgYmVmb3JlIHJlbW92YWwuXG4gICAgZGVzdHJveTogZnVuY3Rpb24ob3B0aW9ucykge1xuICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgPyBfLmNsb25lKG9wdGlvbnMpIDoge307XG4gICAgICB2YXIgbW9kZWwgPSB0aGlzO1xuICAgICAgdmFyIHN1Y2Nlc3MgPSBvcHRpb25zLnN1Y2Nlc3M7XG4gICAgICB2YXIgd2FpdCA9IG9wdGlvbnMud2FpdDtcblxuICAgICAgdmFyIGRlc3Ryb3kgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgbW9kZWwuc3RvcExpc3RlbmluZygpO1xuICAgICAgICBtb2RlbC50cmlnZ2VyKCdkZXN0cm95JywgbW9kZWwsIG1vZGVsLmNvbGxlY3Rpb24sIG9wdGlvbnMpO1xuICAgICAgfTtcblxuICAgICAgb3B0aW9ucy5zdWNjZXNzID0gZnVuY3Rpb24ocmVzcCkge1xuICAgICAgICBpZiAod2FpdCkgZGVzdHJveSgpO1xuICAgICAgICBpZiAoc3VjY2Vzcykgc3VjY2Vzcy5jYWxsKG9wdGlvbnMuY29udGV4dCwgbW9kZWwsIHJlc3AsIG9wdGlvbnMpO1xuICAgICAgICBpZiAoIW1vZGVsLmlzTmV3KCkpIG1vZGVsLnRyaWdnZXIoJ3N5bmMnLCBtb2RlbCwgcmVzcCwgb3B0aW9ucyk7XG4gICAgICB9O1xuXG4gICAgICB2YXIgeGhyID0gZmFsc2U7XG4gICAgICBpZiAodGhpcy5pc05ldygpKSB7XG4gICAgICAgIF8uZGVmZXIob3B0aW9ucy5zdWNjZXNzKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHdyYXBFcnJvcih0aGlzLCBvcHRpb25zKTtcbiAgICAgICAgeGhyID0gdGhpcy5zeW5jKCdkZWxldGUnLCB0aGlzLCBvcHRpb25zKTtcbiAgICAgIH1cbiAgICAgIGlmICghd2FpdCkgZGVzdHJveSgpO1xuICAgICAgcmV0dXJuIHhocjtcbiAgICB9LFxuXG4gICAgLy8gRGVmYXVsdCBVUkwgZm9yIHRoZSBtb2RlbCdzIHJlcHJlc2VudGF0aW9uIG9uIHRoZSBzZXJ2ZXIgLS0gaWYgeW91J3JlXG4gICAgLy8gdXNpbmcgQmFja2JvbmUncyByZXN0ZnVsIG1ldGhvZHMsIG92ZXJyaWRlIHRoaXMgdG8gY2hhbmdlIHRoZSBlbmRwb2ludFxuICAgIC8vIHRoYXQgd2lsbCBiZSBjYWxsZWQuXG4gICAgdXJsOiBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBiYXNlID1cbiAgICAgICAgXy5yZXN1bHQodGhpcywgJ3VybFJvb3QnKSB8fFxuICAgICAgICBfLnJlc3VsdCh0aGlzLmNvbGxlY3Rpb24sICd1cmwnKSB8fFxuICAgICAgICB1cmxFcnJvcigpO1xuICAgICAgaWYgKHRoaXMuaXNOZXcoKSkgcmV0dXJuIGJhc2U7XG4gICAgICB2YXIgaWQgPSB0aGlzLmdldCh0aGlzLmlkQXR0cmlidXRlKTtcbiAgICAgIHJldHVybiBiYXNlLnJlcGxhY2UoL1teXFwvXSQvLCAnJCYvJykgKyBlbmNvZGVVUklDb21wb25lbnQoaWQpO1xuICAgIH0sXG5cbiAgICAvLyAqKnBhcnNlKiogY29udmVydHMgYSByZXNwb25zZSBpbnRvIHRoZSBoYXNoIG9mIGF0dHJpYnV0ZXMgdG8gYmUgYHNldGAgb25cbiAgICAvLyB0aGUgbW9kZWwuIFRoZSBkZWZhdWx0IGltcGxlbWVudGF0aW9uIGlzIGp1c3QgdG8gcGFzcyB0aGUgcmVzcG9uc2UgYWxvbmcuXG4gICAgcGFyc2U6IGZ1bmN0aW9uKHJlc3AsIG9wdGlvbnMpIHtcbiAgICAgIHJldHVybiByZXNwO1xuICAgIH0sXG5cbiAgICAvLyBDcmVhdGUgYSBuZXcgbW9kZWwgd2l0aCBpZGVudGljYWwgYXR0cmlidXRlcyB0byB0aGlzIG9uZS5cbiAgICBjbG9uZTogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IodGhpcy5hdHRyaWJ1dGVzKTtcbiAgICB9LFxuXG4gICAgLy8gQSBtb2RlbCBpcyBuZXcgaWYgaXQgaGFzIG5ldmVyIGJlZW4gc2F2ZWQgdG8gdGhlIHNlcnZlciwgYW5kIGxhY2tzIGFuIGlkLlxuICAgIGlzTmV3OiBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiAhdGhpcy5oYXModGhpcy5pZEF0dHJpYnV0ZSk7XG4gICAgfSxcblxuICAgIC8vIENoZWNrIGlmIHRoZSBtb2RlbCBpcyBjdXJyZW50bHkgaW4gYSB2YWxpZCBzdGF0ZS5cbiAgICBpc1ZhbGlkOiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICByZXR1cm4gdGhpcy5fdmFsaWRhdGUoe30sIF8uZXh0ZW5kKHt9LCBvcHRpb25zLCB7dmFsaWRhdGU6IHRydWV9KSk7XG4gICAgfSxcblxuICAgIC8vIFJ1biB2YWxpZGF0aW9uIGFnYWluc3QgdGhlIG5leHQgY29tcGxldGUgc2V0IG9mIG1vZGVsIGF0dHJpYnV0ZXMsXG4gICAgLy8gcmV0dXJuaW5nIGB0cnVlYCBpZiBhbGwgaXMgd2VsbC4gT3RoZXJ3aXNlLCBmaXJlIGFuIGBcImludmFsaWRcImAgZXZlbnQuXG4gICAgX3ZhbGlkYXRlOiBmdW5jdGlvbihhdHRycywgb3B0aW9ucykge1xuICAgICAgaWYgKCFvcHRpb25zLnZhbGlkYXRlIHx8ICF0aGlzLnZhbGlkYXRlKSByZXR1cm4gdHJ1ZTtcbiAgICAgIGF0dHJzID0gXy5leHRlbmQoe30sIHRoaXMuYXR0cmlidXRlcywgYXR0cnMpO1xuICAgICAgdmFyIGVycm9yID0gdGhpcy52YWxpZGF0aW9uRXJyb3IgPSB0aGlzLnZhbGlkYXRlKGF0dHJzLCBvcHRpb25zKSB8fCBudWxsO1xuICAgICAgaWYgKCFlcnJvcikgcmV0dXJuIHRydWU7XG4gICAgICB0aGlzLnRyaWdnZXIoJ2ludmFsaWQnLCB0aGlzLCBlcnJvciwgXy5leHRlbmQob3B0aW9ucywge3ZhbGlkYXRpb25FcnJvcjogZXJyb3J9KSk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gIH0pO1xuXG4gIC8vIFVuZGVyc2NvcmUgbWV0aG9kcyB0aGF0IHdlIHdhbnQgdG8gaW1wbGVtZW50IG9uIHRoZSBNb2RlbCwgbWFwcGVkIHRvIHRoZVxuICAvLyBudW1iZXIgb2YgYXJndW1lbnRzIHRoZXkgdGFrZS5cbiAgdmFyIG1vZGVsTWV0aG9kcyA9IHtrZXlzOiAxLCB2YWx1ZXM6IDEsIHBhaXJzOiAxLCBpbnZlcnQ6IDEsIHBpY2s6IDAsXG4gICAgICBvbWl0OiAwLCBjaGFpbjogMSwgaXNFbXB0eTogMX07XG5cbiAgLy8gTWl4IGluIGVhY2ggVW5kZXJzY29yZSBtZXRob2QgYXMgYSBwcm94eSB0byBgTW9kZWwjYXR0cmlidXRlc2AuXG4gIGFkZFVuZGVyc2NvcmVNZXRob2RzKE1vZGVsLCBtb2RlbE1ldGhvZHMsICdhdHRyaWJ1dGVzJyk7XG5cbiAgLy8gQmFja2JvbmUuQ29sbGVjdGlvblxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tXG5cbiAgLy8gSWYgbW9kZWxzIHRlbmQgdG8gcmVwcmVzZW50IGEgc2luZ2xlIHJvdyBvZiBkYXRhLCBhIEJhY2tib25lIENvbGxlY3Rpb24gaXNcbiAgLy8gbW9yZSBhbmFsb2dvdXMgdG8gYSB0YWJsZSBmdWxsIG9mIGRhdGEgLi4uIG9yIGEgc21hbGwgc2xpY2Ugb3IgcGFnZSBvZiB0aGF0XG4gIC8vIHRhYmxlLCBvciBhIGNvbGxlY3Rpb24gb2Ygcm93cyB0aGF0IGJlbG9uZyB0b2dldGhlciBmb3IgYSBwYXJ0aWN1bGFyIHJlYXNvblxuICAvLyAtLSBhbGwgb2YgdGhlIG1lc3NhZ2VzIGluIHRoaXMgcGFydGljdWxhciBmb2xkZXIsIGFsbCBvZiB0aGUgZG9jdW1lbnRzXG4gIC8vIGJlbG9uZ2luZyB0byB0aGlzIHBhcnRpY3VsYXIgYXV0aG9yLCBhbmQgc28gb24uIENvbGxlY3Rpb25zIG1haW50YWluXG4gIC8vIGluZGV4ZXMgb2YgdGhlaXIgbW9kZWxzLCBib3RoIGluIG9yZGVyLCBhbmQgZm9yIGxvb2t1cCBieSBgaWRgLlxuXG4gIC8vIENyZWF0ZSBhIG5ldyAqKkNvbGxlY3Rpb24qKiwgcGVyaGFwcyB0byBjb250YWluIGEgc3BlY2lmaWMgdHlwZSBvZiBgbW9kZWxgLlxuICAvLyBJZiBhIGBjb21wYXJhdG9yYCBpcyBzcGVjaWZpZWQsIHRoZSBDb2xsZWN0aW9uIHdpbGwgbWFpbnRhaW5cbiAgLy8gaXRzIG1vZGVscyBpbiBzb3J0IG9yZGVyLCBhcyB0aGV5J3JlIGFkZGVkIGFuZCByZW1vdmVkLlxuICB2YXIgQ29sbGVjdGlvbiA9IEJhY2tib25lLkNvbGxlY3Rpb24gPSBmdW5jdGlvbihtb2RlbHMsIG9wdGlvbnMpIHtcbiAgICBvcHRpb25zIHx8IChvcHRpb25zID0ge30pO1xuICAgIGlmIChvcHRpb25zLm1vZGVsKSB0aGlzLm1vZGVsID0gb3B0aW9ucy5tb2RlbDtcbiAgICBpZiAob3B0aW9ucy5jb21wYXJhdG9yICE9PSB2b2lkIDApIHRoaXMuY29tcGFyYXRvciA9IG9wdGlvbnMuY29tcGFyYXRvcjtcbiAgICB0aGlzLl9yZXNldCgpO1xuICAgIHRoaXMuaW5pdGlhbGl6ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgIGlmIChtb2RlbHMpIHRoaXMucmVzZXQobW9kZWxzLCBfLmV4dGVuZCh7c2lsZW50OiB0cnVlfSwgb3B0aW9ucykpO1xuICB9O1xuXG4gIC8vIERlZmF1bHQgb3B0aW9ucyBmb3IgYENvbGxlY3Rpb24jc2V0YC5cbiAgdmFyIHNldE9wdGlvbnMgPSB7YWRkOiB0cnVlLCByZW1vdmU6IHRydWUsIG1lcmdlOiB0cnVlfTtcbiAgdmFyIGFkZE9wdGlvbnMgPSB7YWRkOiB0cnVlLCByZW1vdmU6IGZhbHNlfTtcblxuICAvLyBTcGxpY2VzIGBpbnNlcnRgIGludG8gYGFycmF5YCBhdCBpbmRleCBgYXRgLlxuICB2YXIgc3BsaWNlID0gZnVuY3Rpb24oYXJyYXksIGluc2VydCwgYXQpIHtcbiAgICBhdCA9IE1hdGgubWluKE1hdGgubWF4KGF0LCAwKSwgYXJyYXkubGVuZ3RoKTtcbiAgICB2YXIgdGFpbCA9IEFycmF5KGFycmF5Lmxlbmd0aCAtIGF0KTtcbiAgICB2YXIgbGVuZ3RoID0gaW5zZXJ0Lmxlbmd0aDtcbiAgICB2YXIgaTtcbiAgICBmb3IgKGkgPSAwOyBpIDwgdGFpbC5sZW5ndGg7IGkrKykgdGFpbFtpXSA9IGFycmF5W2kgKyBhdF07XG4gICAgZm9yIChpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSBhcnJheVtpICsgYXRdID0gaW5zZXJ0W2ldO1xuICAgIGZvciAoaSA9IDA7IGkgPCB0YWlsLmxlbmd0aDsgaSsrKSBhcnJheVtpICsgbGVuZ3RoICsgYXRdID0gdGFpbFtpXTtcbiAgfTtcblxuICAvLyBEZWZpbmUgdGhlIENvbGxlY3Rpb24ncyBpbmhlcml0YWJsZSBtZXRob2RzLlxuICBfLmV4dGVuZChDb2xsZWN0aW9uLnByb3RvdHlwZSwgRXZlbnRzLCB7XG5cbiAgICAvLyBUaGUgZGVmYXVsdCBtb2RlbCBmb3IgYSBjb2xsZWN0aW9uIGlzIGp1c3QgYSAqKkJhY2tib25lLk1vZGVsKiouXG4gICAgLy8gVGhpcyBzaG91bGQgYmUgb3ZlcnJpZGRlbiBpbiBtb3N0IGNhc2VzLlxuICAgIG1vZGVsOiBNb2RlbCxcblxuICAgIC8vIEluaXRpYWxpemUgaXMgYW4gZW1wdHkgZnVuY3Rpb24gYnkgZGVmYXVsdC4gT3ZlcnJpZGUgaXQgd2l0aCB5b3VyIG93blxuICAgIC8vIGluaXRpYWxpemF0aW9uIGxvZ2ljLlxuICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uKCl7fSxcblxuICAgIC8vIFRoZSBKU09OIHJlcHJlc2VudGF0aW9uIG9mIGEgQ29sbGVjdGlvbiBpcyBhbiBhcnJheSBvZiB0aGVcbiAgICAvLyBtb2RlbHMnIGF0dHJpYnV0ZXMuXG4gICAgdG9KU09OOiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICByZXR1cm4gdGhpcy5tYXAoZnVuY3Rpb24obW9kZWwpIHsgcmV0dXJuIG1vZGVsLnRvSlNPTihvcHRpb25zKTsgfSk7XG4gICAgfSxcblxuICAgIC8vIFByb3h5IGBCYWNrYm9uZS5zeW5jYCBieSBkZWZhdWx0LlxuICAgIHN5bmM6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIEJhY2tib25lLnN5bmMuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICB9LFxuXG4gICAgLy8gQWRkIGEgbW9kZWwsIG9yIGxpc3Qgb2YgbW9kZWxzIHRvIHRoZSBzZXQuIGBtb2RlbHNgIG1heSBiZSBCYWNrYm9uZVxuICAgIC8vIE1vZGVscyBvciByYXcgSmF2YVNjcmlwdCBvYmplY3RzIHRvIGJlIGNvbnZlcnRlZCB0byBNb2RlbHMsIG9yIGFueVxuICAgIC8vIGNvbWJpbmF0aW9uIG9mIHRoZSB0d28uXG4gICAgYWRkOiBmdW5jdGlvbihtb2RlbHMsIG9wdGlvbnMpIHtcbiAgICAgIHJldHVybiB0aGlzLnNldChtb2RlbHMsIF8uZXh0ZW5kKHttZXJnZTogZmFsc2V9LCBvcHRpb25zLCBhZGRPcHRpb25zKSk7XG4gICAgfSxcblxuICAgIC8vIFJlbW92ZSBhIG1vZGVsLCBvciBhIGxpc3Qgb2YgbW9kZWxzIGZyb20gdGhlIHNldC5cbiAgICByZW1vdmU6IGZ1bmN0aW9uKG1vZGVscywgb3B0aW9ucykge1xuICAgICAgb3B0aW9ucyA9IF8uZXh0ZW5kKHt9LCBvcHRpb25zKTtcbiAgICAgIHZhciBzaW5ndWxhciA9ICFfLmlzQXJyYXkobW9kZWxzKTtcbiAgICAgIG1vZGVscyA9IHNpbmd1bGFyID8gW21vZGVsc10gOiBtb2RlbHMuc2xpY2UoKTtcbiAgICAgIHZhciByZW1vdmVkID0gdGhpcy5fcmVtb3ZlTW9kZWxzKG1vZGVscywgb3B0aW9ucyk7XG4gICAgICBpZiAoIW9wdGlvbnMuc2lsZW50ICYmIHJlbW92ZWQubGVuZ3RoKSB7XG4gICAgICAgIG9wdGlvbnMuY2hhbmdlcyA9IHthZGRlZDogW10sIG1lcmdlZDogW10sIHJlbW92ZWQ6IHJlbW92ZWR9O1xuICAgICAgICB0aGlzLnRyaWdnZXIoJ3VwZGF0ZScsIHRoaXMsIG9wdGlvbnMpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHNpbmd1bGFyID8gcmVtb3ZlZFswXSA6IHJlbW92ZWQ7XG4gICAgfSxcblxuICAgIC8vIFVwZGF0ZSBhIGNvbGxlY3Rpb24gYnkgYHNldGAtaW5nIGEgbmV3IGxpc3Qgb2YgbW9kZWxzLCBhZGRpbmcgbmV3IG9uZXMsXG4gICAgLy8gcmVtb3ZpbmcgbW9kZWxzIHRoYXQgYXJlIG5vIGxvbmdlciBwcmVzZW50LCBhbmQgbWVyZ2luZyBtb2RlbHMgdGhhdFxuICAgIC8vIGFscmVhZHkgZXhpc3QgaW4gdGhlIGNvbGxlY3Rpb24sIGFzIG5lY2Vzc2FyeS4gU2ltaWxhciB0byAqKk1vZGVsI3NldCoqLFxuICAgIC8vIHRoZSBjb3JlIG9wZXJhdGlvbiBmb3IgdXBkYXRpbmcgdGhlIGRhdGEgY29udGFpbmVkIGJ5IHRoZSBjb2xsZWN0aW9uLlxuICAgIHNldDogZnVuY3Rpb24obW9kZWxzLCBvcHRpb25zKSB7XG4gICAgICBpZiAobW9kZWxzID09IG51bGwpIHJldHVybjtcblxuICAgICAgb3B0aW9ucyA9IF8uZXh0ZW5kKHt9LCBzZXRPcHRpb25zLCBvcHRpb25zKTtcbiAgICAgIGlmIChvcHRpb25zLnBhcnNlICYmICF0aGlzLl9pc01vZGVsKG1vZGVscykpIHtcbiAgICAgICAgbW9kZWxzID0gdGhpcy5wYXJzZShtb2RlbHMsIG9wdGlvbnMpIHx8IFtdO1xuICAgICAgfVxuXG4gICAgICB2YXIgc2luZ3VsYXIgPSAhXy5pc0FycmF5KG1vZGVscyk7XG4gICAgICBtb2RlbHMgPSBzaW5ndWxhciA/IFttb2RlbHNdIDogbW9kZWxzLnNsaWNlKCk7XG5cbiAgICAgIHZhciBhdCA9IG9wdGlvbnMuYXQ7XG4gICAgICBpZiAoYXQgIT0gbnVsbCkgYXQgPSArYXQ7XG4gICAgICBpZiAoYXQgPiB0aGlzLmxlbmd0aCkgYXQgPSB0aGlzLmxlbmd0aDtcbiAgICAgIGlmIChhdCA8IDApIGF0ICs9IHRoaXMubGVuZ3RoICsgMTtcblxuICAgICAgdmFyIHNldCA9IFtdO1xuICAgICAgdmFyIHRvQWRkID0gW107XG4gICAgICB2YXIgdG9NZXJnZSA9IFtdO1xuICAgICAgdmFyIHRvUmVtb3ZlID0gW107XG4gICAgICB2YXIgbW9kZWxNYXAgPSB7fTtcblxuICAgICAgdmFyIGFkZCA9IG9wdGlvbnMuYWRkO1xuICAgICAgdmFyIG1lcmdlID0gb3B0aW9ucy5tZXJnZTtcbiAgICAgIHZhciByZW1vdmUgPSBvcHRpb25zLnJlbW92ZTtcblxuICAgICAgdmFyIHNvcnQgPSBmYWxzZTtcbiAgICAgIHZhciBzb3J0YWJsZSA9IHRoaXMuY29tcGFyYXRvciAmJiBhdCA9PSBudWxsICYmIG9wdGlvbnMuc29ydCAhPT0gZmFsc2U7XG4gICAgICB2YXIgc29ydEF0dHIgPSBfLmlzU3RyaW5nKHRoaXMuY29tcGFyYXRvcikgPyB0aGlzLmNvbXBhcmF0b3IgOiBudWxsO1xuXG4gICAgICAvLyBUdXJuIGJhcmUgb2JqZWN0cyBpbnRvIG1vZGVsIHJlZmVyZW5jZXMsIGFuZCBwcmV2ZW50IGludmFsaWQgbW9kZWxzXG4gICAgICAvLyBmcm9tIGJlaW5nIGFkZGVkLlxuICAgICAgdmFyIG1vZGVsLCBpO1xuICAgICAgZm9yIChpID0gMDsgaSA8IG1vZGVscy5sZW5ndGg7IGkrKykge1xuICAgICAgICBtb2RlbCA9IG1vZGVsc1tpXTtcblxuICAgICAgICAvLyBJZiBhIGR1cGxpY2F0ZSBpcyBmb3VuZCwgcHJldmVudCBpdCBmcm9tIGJlaW5nIGFkZGVkIGFuZFxuICAgICAgICAvLyBvcHRpb25hbGx5IG1lcmdlIGl0IGludG8gdGhlIGV4aXN0aW5nIG1vZGVsLlxuICAgICAgICB2YXIgZXhpc3RpbmcgPSB0aGlzLmdldChtb2RlbCk7XG4gICAgICAgIGlmIChleGlzdGluZykge1xuICAgICAgICAgIGlmIChtZXJnZSAmJiBtb2RlbCAhPT0gZXhpc3RpbmcpIHtcbiAgICAgICAgICAgIHZhciBhdHRycyA9IHRoaXMuX2lzTW9kZWwobW9kZWwpID8gbW9kZWwuYXR0cmlidXRlcyA6IG1vZGVsO1xuICAgICAgICAgICAgaWYgKG9wdGlvbnMucGFyc2UpIGF0dHJzID0gZXhpc3RpbmcucGFyc2UoYXR0cnMsIG9wdGlvbnMpO1xuICAgICAgICAgICAgZXhpc3Rpbmcuc2V0KGF0dHJzLCBvcHRpb25zKTtcbiAgICAgICAgICAgIHRvTWVyZ2UucHVzaChleGlzdGluZyk7XG4gICAgICAgICAgICBpZiAoc29ydGFibGUgJiYgIXNvcnQpIHNvcnQgPSBleGlzdGluZy5oYXNDaGFuZ2VkKHNvcnRBdHRyKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKCFtb2RlbE1hcFtleGlzdGluZy5jaWRdKSB7XG4gICAgICAgICAgICBtb2RlbE1hcFtleGlzdGluZy5jaWRdID0gdHJ1ZTtcbiAgICAgICAgICAgIHNldC5wdXNoKGV4aXN0aW5nKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgbW9kZWxzW2ldID0gZXhpc3Rpbmc7XG5cbiAgICAgICAgLy8gSWYgdGhpcyBpcyBhIG5ldywgdmFsaWQgbW9kZWwsIHB1c2ggaXQgdG8gdGhlIGB0b0FkZGAgbGlzdC5cbiAgICAgICAgfSBlbHNlIGlmIChhZGQpIHtcbiAgICAgICAgICBtb2RlbCA9IG1vZGVsc1tpXSA9IHRoaXMuX3ByZXBhcmVNb2RlbChtb2RlbCwgb3B0aW9ucyk7XG4gICAgICAgICAgaWYgKG1vZGVsKSB7XG4gICAgICAgICAgICB0b0FkZC5wdXNoKG1vZGVsKTtcbiAgICAgICAgICAgIHRoaXMuX2FkZFJlZmVyZW5jZShtb2RlbCwgb3B0aW9ucyk7XG4gICAgICAgICAgICBtb2RlbE1hcFttb2RlbC5jaWRdID0gdHJ1ZTtcbiAgICAgICAgICAgIHNldC5wdXNoKG1vZGVsKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gUmVtb3ZlIHN0YWxlIG1vZGVscy5cbiAgICAgIGlmIChyZW1vdmUpIHtcbiAgICAgICAgZm9yIChpID0gMDsgaSA8IHRoaXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICBtb2RlbCA9IHRoaXMubW9kZWxzW2ldO1xuICAgICAgICAgIGlmICghbW9kZWxNYXBbbW9kZWwuY2lkXSkgdG9SZW1vdmUucHVzaChtb2RlbCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRvUmVtb3ZlLmxlbmd0aCkgdGhpcy5fcmVtb3ZlTW9kZWxzKHRvUmVtb3ZlLCBvcHRpb25zKTtcbiAgICAgIH1cblxuICAgICAgLy8gU2VlIGlmIHNvcnRpbmcgaXMgbmVlZGVkLCB1cGRhdGUgYGxlbmd0aGAgYW5kIHNwbGljZSBpbiBuZXcgbW9kZWxzLlxuICAgICAgdmFyIG9yZGVyQ2hhbmdlZCA9IGZhbHNlO1xuICAgICAgdmFyIHJlcGxhY2UgPSAhc29ydGFibGUgJiYgYWRkICYmIHJlbW92ZTtcbiAgICAgIGlmIChzZXQubGVuZ3RoICYmIHJlcGxhY2UpIHtcbiAgICAgICAgb3JkZXJDaGFuZ2VkID0gdGhpcy5sZW5ndGggIT09IHNldC5sZW5ndGggfHwgXy5zb21lKHRoaXMubW9kZWxzLCBmdW5jdGlvbihtLCBpbmRleCkge1xuICAgICAgICAgIHJldHVybiBtICE9PSBzZXRbaW5kZXhdO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5tb2RlbHMubGVuZ3RoID0gMDtcbiAgICAgICAgc3BsaWNlKHRoaXMubW9kZWxzLCBzZXQsIDApO1xuICAgICAgICB0aGlzLmxlbmd0aCA9IHRoaXMubW9kZWxzLmxlbmd0aDtcbiAgICAgIH0gZWxzZSBpZiAodG9BZGQubGVuZ3RoKSB7XG4gICAgICAgIGlmIChzb3J0YWJsZSkgc29ydCA9IHRydWU7XG4gICAgICAgIHNwbGljZSh0aGlzLm1vZGVscywgdG9BZGQsIGF0ID09IG51bGwgPyB0aGlzLmxlbmd0aCA6IGF0KTtcbiAgICAgICAgdGhpcy5sZW5ndGggPSB0aGlzLm1vZGVscy5sZW5ndGg7XG4gICAgICB9XG5cbiAgICAgIC8vIFNpbGVudGx5IHNvcnQgdGhlIGNvbGxlY3Rpb24gaWYgYXBwcm9wcmlhdGUuXG4gICAgICBpZiAoc29ydCkgdGhpcy5zb3J0KHtzaWxlbnQ6IHRydWV9KTtcblxuICAgICAgLy8gVW5sZXNzIHNpbGVuY2VkLCBpdCdzIHRpbWUgdG8gZmlyZSBhbGwgYXBwcm9wcmlhdGUgYWRkL3NvcnQvdXBkYXRlIGV2ZW50cy5cbiAgICAgIGlmICghb3B0aW9ucy5zaWxlbnQpIHtcbiAgICAgICAgZm9yIChpID0gMDsgaSA8IHRvQWRkLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgaWYgKGF0ICE9IG51bGwpIG9wdGlvbnMuaW5kZXggPSBhdCArIGk7XG4gICAgICAgICAgbW9kZWwgPSB0b0FkZFtpXTtcbiAgICAgICAgICBtb2RlbC50cmlnZ2VyKCdhZGQnLCBtb2RlbCwgdGhpcywgb3B0aW9ucyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHNvcnQgfHwgb3JkZXJDaGFuZ2VkKSB0aGlzLnRyaWdnZXIoJ3NvcnQnLCB0aGlzLCBvcHRpb25zKTtcbiAgICAgICAgaWYgKHRvQWRkLmxlbmd0aCB8fCB0b1JlbW92ZS5sZW5ndGggfHwgdG9NZXJnZS5sZW5ndGgpIHtcbiAgICAgICAgICBvcHRpb25zLmNoYW5nZXMgPSB7XG4gICAgICAgICAgICBhZGRlZDogdG9BZGQsXG4gICAgICAgICAgICByZW1vdmVkOiB0b1JlbW92ZSxcbiAgICAgICAgICAgIG1lcmdlZDogdG9NZXJnZVxuICAgICAgICAgIH07XG4gICAgICAgICAgdGhpcy50cmlnZ2VyKCd1cGRhdGUnLCB0aGlzLCBvcHRpb25zKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBSZXR1cm4gdGhlIGFkZGVkIChvciBtZXJnZWQpIG1vZGVsIChvciBtb2RlbHMpLlxuICAgICAgcmV0dXJuIHNpbmd1bGFyID8gbW9kZWxzWzBdIDogbW9kZWxzO1xuICAgIH0sXG5cbiAgICAvLyBXaGVuIHlvdSBoYXZlIG1vcmUgaXRlbXMgdGhhbiB5b3Ugd2FudCB0byBhZGQgb3IgcmVtb3ZlIGluZGl2aWR1YWxseSxcbiAgICAvLyB5b3UgY2FuIHJlc2V0IHRoZSBlbnRpcmUgc2V0IHdpdGggYSBuZXcgbGlzdCBvZiBtb2RlbHMsIHdpdGhvdXQgZmlyaW5nXG4gICAgLy8gYW55IGdyYW51bGFyIGBhZGRgIG9yIGByZW1vdmVgIGV2ZW50cy4gRmlyZXMgYHJlc2V0YCB3aGVuIGZpbmlzaGVkLlxuICAgIC8vIFVzZWZ1bCBmb3IgYnVsayBvcGVyYXRpb25zIGFuZCBvcHRpbWl6YXRpb25zLlxuICAgIHJlc2V0OiBmdW5jdGlvbihtb2RlbHMsIG9wdGlvbnMpIHtcbiAgICAgIG9wdGlvbnMgPSBvcHRpb25zID8gXy5jbG9uZShvcHRpb25zKSA6IHt9O1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLm1vZGVscy5sZW5ndGg7IGkrKykge1xuICAgICAgICB0aGlzLl9yZW1vdmVSZWZlcmVuY2UodGhpcy5tb2RlbHNbaV0sIG9wdGlvbnMpO1xuICAgICAgfVxuICAgICAgb3B0aW9ucy5wcmV2aW91c01vZGVscyA9IHRoaXMubW9kZWxzO1xuICAgICAgdGhpcy5fcmVzZXQoKTtcbiAgICAgIG1vZGVscyA9IHRoaXMuYWRkKG1vZGVscywgXy5leHRlbmQoe3NpbGVudDogdHJ1ZX0sIG9wdGlvbnMpKTtcbiAgICAgIGlmICghb3B0aW9ucy5zaWxlbnQpIHRoaXMudHJpZ2dlcigncmVzZXQnLCB0aGlzLCBvcHRpb25zKTtcbiAgICAgIHJldHVybiBtb2RlbHM7XG4gICAgfSxcblxuICAgIC8vIEFkZCBhIG1vZGVsIHRvIHRoZSBlbmQgb2YgdGhlIGNvbGxlY3Rpb24uXG4gICAgcHVzaDogZnVuY3Rpb24obW9kZWwsIG9wdGlvbnMpIHtcbiAgICAgIHJldHVybiB0aGlzLmFkZChtb2RlbCwgXy5leHRlbmQoe2F0OiB0aGlzLmxlbmd0aH0sIG9wdGlvbnMpKTtcbiAgICB9LFxuXG4gICAgLy8gUmVtb3ZlIGEgbW9kZWwgZnJvbSB0aGUgZW5kIG9mIHRoZSBjb2xsZWN0aW9uLlxuICAgIHBvcDogZnVuY3Rpb24ob3B0aW9ucykge1xuICAgICAgdmFyIG1vZGVsID0gdGhpcy5hdCh0aGlzLmxlbmd0aCAtIDEpO1xuICAgICAgcmV0dXJuIHRoaXMucmVtb3ZlKG1vZGVsLCBvcHRpb25zKTtcbiAgICB9LFxuXG4gICAgLy8gQWRkIGEgbW9kZWwgdG8gdGhlIGJlZ2lubmluZyBvZiB0aGUgY29sbGVjdGlvbi5cbiAgICB1bnNoaWZ0OiBmdW5jdGlvbihtb2RlbCwgb3B0aW9ucykge1xuICAgICAgcmV0dXJuIHRoaXMuYWRkKG1vZGVsLCBfLmV4dGVuZCh7YXQ6IDB9LCBvcHRpb25zKSk7XG4gICAgfSxcblxuICAgIC8vIFJlbW92ZSBhIG1vZGVsIGZyb20gdGhlIGJlZ2lubmluZyBvZiB0aGUgY29sbGVjdGlvbi5cbiAgICBzaGlmdDogZnVuY3Rpb24ob3B0aW9ucykge1xuICAgICAgdmFyIG1vZGVsID0gdGhpcy5hdCgwKTtcbiAgICAgIHJldHVybiB0aGlzLnJlbW92ZShtb2RlbCwgb3B0aW9ucyk7XG4gICAgfSxcblxuICAgIC8vIFNsaWNlIG91dCBhIHN1Yi1hcnJheSBvZiBtb2RlbHMgZnJvbSB0aGUgY29sbGVjdGlvbi5cbiAgICBzbGljZTogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gc2xpY2UuYXBwbHkodGhpcy5tb2RlbHMsIGFyZ3VtZW50cyk7XG4gICAgfSxcblxuICAgIC8vIEdldCBhIG1vZGVsIGZyb20gdGhlIHNldCBieSBpZCwgY2lkLCBtb2RlbCBvYmplY3Qgd2l0aCBpZCBvciBjaWRcbiAgICAvLyBwcm9wZXJ0aWVzLCBvciBhbiBhdHRyaWJ1dGVzIG9iamVjdCB0aGF0IGlzIHRyYW5zZm9ybWVkIHRocm91Z2ggbW9kZWxJZC5cbiAgICBnZXQ6IGZ1bmN0aW9uKG9iaikge1xuICAgICAgaWYgKG9iaiA9PSBudWxsKSByZXR1cm4gdm9pZCAwO1xuICAgICAgcmV0dXJuIHRoaXMuX2J5SWRbb2JqXSB8fFxuICAgICAgICB0aGlzLl9ieUlkW3RoaXMubW9kZWxJZChvYmouYXR0cmlidXRlcyB8fCBvYmopXSB8fFxuICAgICAgICBvYmouY2lkICYmIHRoaXMuX2J5SWRbb2JqLmNpZF07XG4gICAgfSxcblxuICAgIC8vIFJldHVybnMgYHRydWVgIGlmIHRoZSBtb2RlbCBpcyBpbiB0aGUgY29sbGVjdGlvbi5cbiAgICBoYXM6IGZ1bmN0aW9uKG9iaikge1xuICAgICAgcmV0dXJuIHRoaXMuZ2V0KG9iaikgIT0gbnVsbDtcbiAgICB9LFxuXG4gICAgLy8gR2V0IHRoZSBtb2RlbCBhdCB0aGUgZ2l2ZW4gaW5kZXguXG4gICAgYXQ6IGZ1bmN0aW9uKGluZGV4KSB7XG4gICAgICBpZiAoaW5kZXggPCAwKSBpbmRleCArPSB0aGlzLmxlbmd0aDtcbiAgICAgIHJldHVybiB0aGlzLm1vZGVsc1tpbmRleF07XG4gICAgfSxcblxuICAgIC8vIFJldHVybiBtb2RlbHMgd2l0aCBtYXRjaGluZyBhdHRyaWJ1dGVzLiBVc2VmdWwgZm9yIHNpbXBsZSBjYXNlcyBvZlxuICAgIC8vIGBmaWx0ZXJgLlxuICAgIHdoZXJlOiBmdW5jdGlvbihhdHRycywgZmlyc3QpIHtcbiAgICAgIHJldHVybiB0aGlzW2ZpcnN0ID8gJ2ZpbmQnIDogJ2ZpbHRlciddKGF0dHJzKTtcbiAgICB9LFxuXG4gICAgLy8gUmV0dXJuIHRoZSBmaXJzdCBtb2RlbCB3aXRoIG1hdGNoaW5nIGF0dHJpYnV0ZXMuIFVzZWZ1bCBmb3Igc2ltcGxlIGNhc2VzXG4gICAgLy8gb2YgYGZpbmRgLlxuICAgIGZpbmRXaGVyZTogZnVuY3Rpb24oYXR0cnMpIHtcbiAgICAgIHJldHVybiB0aGlzLndoZXJlKGF0dHJzLCB0cnVlKTtcbiAgICB9LFxuXG4gICAgLy8gRm9yY2UgdGhlIGNvbGxlY3Rpb24gdG8gcmUtc29ydCBpdHNlbGYuIFlvdSBkb24ndCBuZWVkIHRvIGNhbGwgdGhpcyB1bmRlclxuICAgIC8vIG5vcm1hbCBjaXJjdW1zdGFuY2VzLCBhcyB0aGUgc2V0IHdpbGwgbWFpbnRhaW4gc29ydCBvcmRlciBhcyBlYWNoIGl0ZW1cbiAgICAvLyBpcyBhZGRlZC5cbiAgICBzb3J0OiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICB2YXIgY29tcGFyYXRvciA9IHRoaXMuY29tcGFyYXRvcjtcbiAgICAgIGlmICghY29tcGFyYXRvcikgdGhyb3cgbmV3IEVycm9yKCdDYW5ub3Qgc29ydCBhIHNldCB3aXRob3V0IGEgY29tcGFyYXRvcicpO1xuICAgICAgb3B0aW9ucyB8fCAob3B0aW9ucyA9IHt9KTtcblxuICAgICAgdmFyIGxlbmd0aCA9IGNvbXBhcmF0b3IubGVuZ3RoO1xuICAgICAgaWYgKF8uaXNGdW5jdGlvbihjb21wYXJhdG9yKSkgY29tcGFyYXRvciA9IF8uYmluZChjb21wYXJhdG9yLCB0aGlzKTtcblxuICAgICAgLy8gUnVuIHNvcnQgYmFzZWQgb24gdHlwZSBvZiBgY29tcGFyYXRvcmAuXG4gICAgICBpZiAobGVuZ3RoID09PSAxIHx8IF8uaXNTdHJpbmcoY29tcGFyYXRvcikpIHtcbiAgICAgICAgdGhpcy5tb2RlbHMgPSB0aGlzLnNvcnRCeShjb21wYXJhdG9yKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMubW9kZWxzLnNvcnQoY29tcGFyYXRvcik7XG4gICAgICB9XG4gICAgICBpZiAoIW9wdGlvbnMuc2lsZW50KSB0aGlzLnRyaWdnZXIoJ3NvcnQnLCB0aGlzLCBvcHRpb25zKTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICAvLyBQbHVjayBhbiBhdHRyaWJ1dGUgZnJvbSBlYWNoIG1vZGVsIGluIHRoZSBjb2xsZWN0aW9uLlxuICAgIHBsdWNrOiBmdW5jdGlvbihhdHRyKSB7XG4gICAgICByZXR1cm4gdGhpcy5tYXAoYXR0ciArICcnKTtcbiAgICB9LFxuXG4gICAgLy8gRmV0Y2ggdGhlIGRlZmF1bHQgc2V0IG9mIG1vZGVscyBmb3IgdGhpcyBjb2xsZWN0aW9uLCByZXNldHRpbmcgdGhlXG4gICAgLy8gY29sbGVjdGlvbiB3aGVuIHRoZXkgYXJyaXZlLiBJZiBgcmVzZXQ6IHRydWVgIGlzIHBhc3NlZCwgdGhlIHJlc3BvbnNlXG4gICAgLy8gZGF0YSB3aWxsIGJlIHBhc3NlZCB0aHJvdWdoIHRoZSBgcmVzZXRgIG1ldGhvZCBpbnN0ZWFkIG9mIGBzZXRgLlxuICAgIGZldGNoOiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICBvcHRpb25zID0gXy5leHRlbmQoe3BhcnNlOiB0cnVlfSwgb3B0aW9ucyk7XG4gICAgICB2YXIgc3VjY2VzcyA9IG9wdGlvbnMuc3VjY2VzcztcbiAgICAgIHZhciBjb2xsZWN0aW9uID0gdGhpcztcbiAgICAgIG9wdGlvbnMuc3VjY2VzcyA9IGZ1bmN0aW9uKHJlc3ApIHtcbiAgICAgICAgdmFyIG1ldGhvZCA9IG9wdGlvbnMucmVzZXQgPyAncmVzZXQnIDogJ3NldCc7XG4gICAgICAgIGNvbGxlY3Rpb25bbWV0aG9kXShyZXNwLCBvcHRpb25zKTtcbiAgICAgICAgaWYgKHN1Y2Nlc3MpIHN1Y2Nlc3MuY2FsbChvcHRpb25zLmNvbnRleHQsIGNvbGxlY3Rpb24sIHJlc3AsIG9wdGlvbnMpO1xuICAgICAgICBjb2xsZWN0aW9uLnRyaWdnZXIoJ3N5bmMnLCBjb2xsZWN0aW9uLCByZXNwLCBvcHRpb25zKTtcbiAgICAgIH07XG4gICAgICB3cmFwRXJyb3IodGhpcywgb3B0aW9ucyk7XG4gICAgICByZXR1cm4gdGhpcy5zeW5jKCdyZWFkJywgdGhpcywgb3B0aW9ucyk7XG4gICAgfSxcblxuICAgIC8vIENyZWF0ZSBhIG5ldyBpbnN0YW5jZSBvZiBhIG1vZGVsIGluIHRoaXMgY29sbGVjdGlvbi4gQWRkIHRoZSBtb2RlbCB0byB0aGVcbiAgICAvLyBjb2xsZWN0aW9uIGltbWVkaWF0ZWx5LCB1bmxlc3MgYHdhaXQ6IHRydWVgIGlzIHBhc3NlZCwgaW4gd2hpY2ggY2FzZSB3ZVxuICAgIC8vIHdhaXQgZm9yIHRoZSBzZXJ2ZXIgdG8gYWdyZWUuXG4gICAgY3JlYXRlOiBmdW5jdGlvbihtb2RlbCwgb3B0aW9ucykge1xuICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgPyBfLmNsb25lKG9wdGlvbnMpIDoge307XG4gICAgICB2YXIgd2FpdCA9IG9wdGlvbnMud2FpdDtcbiAgICAgIG1vZGVsID0gdGhpcy5fcHJlcGFyZU1vZGVsKG1vZGVsLCBvcHRpb25zKTtcbiAgICAgIGlmICghbW9kZWwpIHJldHVybiBmYWxzZTtcbiAgICAgIGlmICghd2FpdCkgdGhpcy5hZGQobW9kZWwsIG9wdGlvbnMpO1xuICAgICAgdmFyIGNvbGxlY3Rpb24gPSB0aGlzO1xuICAgICAgdmFyIHN1Y2Nlc3MgPSBvcHRpb25zLnN1Y2Nlc3M7XG4gICAgICBvcHRpb25zLnN1Y2Nlc3MgPSBmdW5jdGlvbihtLCByZXNwLCBjYWxsYmFja09wdHMpIHtcbiAgICAgICAgaWYgKHdhaXQpIGNvbGxlY3Rpb24uYWRkKG0sIGNhbGxiYWNrT3B0cyk7XG4gICAgICAgIGlmIChzdWNjZXNzKSBzdWNjZXNzLmNhbGwoY2FsbGJhY2tPcHRzLmNvbnRleHQsIG0sIHJlc3AsIGNhbGxiYWNrT3B0cyk7XG4gICAgICB9O1xuICAgICAgbW9kZWwuc2F2ZShudWxsLCBvcHRpb25zKTtcbiAgICAgIHJldHVybiBtb2RlbDtcbiAgICB9LFxuXG4gICAgLy8gKipwYXJzZSoqIGNvbnZlcnRzIGEgcmVzcG9uc2UgaW50byBhIGxpc3Qgb2YgbW9kZWxzIHRvIGJlIGFkZGVkIHRvIHRoZVxuICAgIC8vIGNvbGxlY3Rpb24uIFRoZSBkZWZhdWx0IGltcGxlbWVudGF0aW9uIGlzIGp1c3QgdG8gcGFzcyBpdCB0aHJvdWdoLlxuICAgIHBhcnNlOiBmdW5jdGlvbihyZXNwLCBvcHRpb25zKSB7XG4gICAgICByZXR1cm4gcmVzcDtcbiAgICB9LFxuXG4gICAgLy8gQ3JlYXRlIGEgbmV3IGNvbGxlY3Rpb24gd2l0aCBhbiBpZGVudGljYWwgbGlzdCBvZiBtb2RlbHMgYXMgdGhpcyBvbmUuXG4gICAgY2xvbmU6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKHRoaXMubW9kZWxzLCB7XG4gICAgICAgIG1vZGVsOiB0aGlzLm1vZGVsLFxuICAgICAgICBjb21wYXJhdG9yOiB0aGlzLmNvbXBhcmF0b3JcbiAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvLyBEZWZpbmUgaG93IHRvIHVuaXF1ZWx5IGlkZW50aWZ5IG1vZGVscyBpbiB0aGUgY29sbGVjdGlvbi5cbiAgICBtb2RlbElkOiBmdW5jdGlvbihhdHRycykge1xuICAgICAgcmV0dXJuIGF0dHJzW3RoaXMubW9kZWwucHJvdG90eXBlLmlkQXR0cmlidXRlIHx8ICdpZCddO1xuICAgIH0sXG5cbiAgICAvLyBQcml2YXRlIG1ldGhvZCB0byByZXNldCBhbGwgaW50ZXJuYWwgc3RhdGUuIENhbGxlZCB3aGVuIHRoZSBjb2xsZWN0aW9uXG4gICAgLy8gaXMgZmlyc3QgaW5pdGlhbGl6ZWQgb3IgcmVzZXQuXG4gICAgX3Jlc2V0OiBmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMubGVuZ3RoID0gMDtcbiAgICAgIHRoaXMubW9kZWxzID0gW107XG4gICAgICB0aGlzLl9ieUlkICA9IHt9O1xuICAgIH0sXG5cbiAgICAvLyBQcmVwYXJlIGEgaGFzaCBvZiBhdHRyaWJ1dGVzIChvciBvdGhlciBtb2RlbCkgdG8gYmUgYWRkZWQgdG8gdGhpc1xuICAgIC8vIGNvbGxlY3Rpb24uXG4gICAgX3ByZXBhcmVNb2RlbDogZnVuY3Rpb24oYXR0cnMsIG9wdGlvbnMpIHtcbiAgICAgIGlmICh0aGlzLl9pc01vZGVsKGF0dHJzKSkge1xuICAgICAgICBpZiAoIWF0dHJzLmNvbGxlY3Rpb24pIGF0dHJzLmNvbGxlY3Rpb24gPSB0aGlzO1xuICAgICAgICByZXR1cm4gYXR0cnM7XG4gICAgICB9XG4gICAgICBvcHRpb25zID0gb3B0aW9ucyA/IF8uY2xvbmUob3B0aW9ucykgOiB7fTtcbiAgICAgIG9wdGlvbnMuY29sbGVjdGlvbiA9IHRoaXM7XG4gICAgICB2YXIgbW9kZWwgPSBuZXcgdGhpcy5tb2RlbChhdHRycywgb3B0aW9ucyk7XG4gICAgICBpZiAoIW1vZGVsLnZhbGlkYXRpb25FcnJvcikgcmV0dXJuIG1vZGVsO1xuICAgICAgdGhpcy50cmlnZ2VyKCdpbnZhbGlkJywgdGhpcywgbW9kZWwudmFsaWRhdGlvbkVycm9yLCBvcHRpb25zKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9LFxuXG4gICAgLy8gSW50ZXJuYWwgbWV0aG9kIGNhbGxlZCBieSBib3RoIHJlbW92ZSBhbmQgc2V0LlxuICAgIF9yZW1vdmVNb2RlbHM6IGZ1bmN0aW9uKG1vZGVscywgb3B0aW9ucykge1xuICAgICAgdmFyIHJlbW92ZWQgPSBbXTtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbW9kZWxzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHZhciBtb2RlbCA9IHRoaXMuZ2V0KG1vZGVsc1tpXSk7XG4gICAgICAgIGlmICghbW9kZWwpIGNvbnRpbnVlO1xuXG4gICAgICAgIHZhciBpbmRleCA9IHRoaXMuaW5kZXhPZihtb2RlbCk7XG4gICAgICAgIHRoaXMubW9kZWxzLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgIHRoaXMubGVuZ3RoLS07XG5cbiAgICAgICAgLy8gUmVtb3ZlIHJlZmVyZW5jZXMgYmVmb3JlIHRyaWdnZXJpbmcgJ3JlbW92ZScgZXZlbnQgdG8gcHJldmVudCBhblxuICAgICAgICAvLyBpbmZpbml0ZSBsb29wLiAjMzY5M1xuICAgICAgICBkZWxldGUgdGhpcy5fYnlJZFttb2RlbC5jaWRdO1xuICAgICAgICB2YXIgaWQgPSB0aGlzLm1vZGVsSWQobW9kZWwuYXR0cmlidXRlcyk7XG4gICAgICAgIGlmIChpZCAhPSBudWxsKSBkZWxldGUgdGhpcy5fYnlJZFtpZF07XG5cbiAgICAgICAgaWYgKCFvcHRpb25zLnNpbGVudCkge1xuICAgICAgICAgIG9wdGlvbnMuaW5kZXggPSBpbmRleDtcbiAgICAgICAgICBtb2RlbC50cmlnZ2VyKCdyZW1vdmUnLCBtb2RlbCwgdGhpcywgb3B0aW9ucyk7XG4gICAgICAgIH1cblxuICAgICAgICByZW1vdmVkLnB1c2gobW9kZWwpO1xuICAgICAgICB0aGlzLl9yZW1vdmVSZWZlcmVuY2UobW9kZWwsIG9wdGlvbnMpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHJlbW92ZWQ7XG4gICAgfSxcblxuICAgIC8vIE1ldGhvZCBmb3IgY2hlY2tpbmcgd2hldGhlciBhbiBvYmplY3Qgc2hvdWxkIGJlIGNvbnNpZGVyZWQgYSBtb2RlbCBmb3JcbiAgICAvLyB0aGUgcHVycG9zZXMgb2YgYWRkaW5nIHRvIHRoZSBjb2xsZWN0aW9uLlxuICAgIF9pc01vZGVsOiBmdW5jdGlvbihtb2RlbCkge1xuICAgICAgcmV0dXJuIG1vZGVsIGluc3RhbmNlb2YgTW9kZWw7XG4gICAgfSxcblxuICAgIC8vIEludGVybmFsIG1ldGhvZCB0byBjcmVhdGUgYSBtb2RlbCdzIHRpZXMgdG8gYSBjb2xsZWN0aW9uLlxuICAgIF9hZGRSZWZlcmVuY2U6IGZ1bmN0aW9uKG1vZGVsLCBvcHRpb25zKSB7XG4gICAgICB0aGlzLl9ieUlkW21vZGVsLmNpZF0gPSBtb2RlbDtcbiAgICAgIHZhciBpZCA9IHRoaXMubW9kZWxJZChtb2RlbC5hdHRyaWJ1dGVzKTtcbiAgICAgIGlmIChpZCAhPSBudWxsKSB0aGlzLl9ieUlkW2lkXSA9IG1vZGVsO1xuICAgICAgbW9kZWwub24oJ2FsbCcsIHRoaXMuX29uTW9kZWxFdmVudCwgdGhpcyk7XG4gICAgfSxcblxuICAgIC8vIEludGVybmFsIG1ldGhvZCB0byBzZXZlciBhIG1vZGVsJ3MgdGllcyB0byBhIGNvbGxlY3Rpb24uXG4gICAgX3JlbW92ZVJlZmVyZW5jZTogZnVuY3Rpb24obW9kZWwsIG9wdGlvbnMpIHtcbiAgICAgIGRlbGV0ZSB0aGlzLl9ieUlkW21vZGVsLmNpZF07XG4gICAgICB2YXIgaWQgPSB0aGlzLm1vZGVsSWQobW9kZWwuYXR0cmlidXRlcyk7XG4gICAgICBpZiAoaWQgIT0gbnVsbCkgZGVsZXRlIHRoaXMuX2J5SWRbaWRdO1xuICAgICAgaWYgKHRoaXMgPT09IG1vZGVsLmNvbGxlY3Rpb24pIGRlbGV0ZSBtb2RlbC5jb2xsZWN0aW9uO1xuICAgICAgbW9kZWwub2ZmKCdhbGwnLCB0aGlzLl9vbk1vZGVsRXZlbnQsIHRoaXMpO1xuICAgIH0sXG5cbiAgICAvLyBJbnRlcm5hbCBtZXRob2QgY2FsbGVkIGV2ZXJ5IHRpbWUgYSBtb2RlbCBpbiB0aGUgc2V0IGZpcmVzIGFuIGV2ZW50LlxuICAgIC8vIFNldHMgbmVlZCB0byB1cGRhdGUgdGhlaXIgaW5kZXhlcyB3aGVuIG1vZGVscyBjaGFuZ2UgaWRzLiBBbGwgb3RoZXJcbiAgICAvLyBldmVudHMgc2ltcGx5IHByb3h5IHRocm91Z2guIFwiYWRkXCIgYW5kIFwicmVtb3ZlXCIgZXZlbnRzIHRoYXQgb3JpZ2luYXRlXG4gICAgLy8gaW4gb3RoZXIgY29sbGVjdGlvbnMgYXJlIGlnbm9yZWQuXG4gICAgX29uTW9kZWxFdmVudDogZnVuY3Rpb24oZXZlbnQsIG1vZGVsLCBjb2xsZWN0aW9uLCBvcHRpb25zKSB7XG4gICAgICBpZiAobW9kZWwpIHtcbiAgICAgICAgaWYgKChldmVudCA9PT0gJ2FkZCcgfHwgZXZlbnQgPT09ICdyZW1vdmUnKSAmJiBjb2xsZWN0aW9uICE9PSB0aGlzKSByZXR1cm47XG4gICAgICAgIGlmIChldmVudCA9PT0gJ2Rlc3Ryb3knKSB0aGlzLnJlbW92ZShtb2RlbCwgb3B0aW9ucyk7XG4gICAgICAgIGlmIChldmVudCA9PT0gJ2NoYW5nZScpIHtcbiAgICAgICAgICB2YXIgcHJldklkID0gdGhpcy5tb2RlbElkKG1vZGVsLnByZXZpb3VzQXR0cmlidXRlcygpKTtcbiAgICAgICAgICB2YXIgaWQgPSB0aGlzLm1vZGVsSWQobW9kZWwuYXR0cmlidXRlcyk7XG4gICAgICAgICAgaWYgKHByZXZJZCAhPT0gaWQpIHtcbiAgICAgICAgICAgIGlmIChwcmV2SWQgIT0gbnVsbCkgZGVsZXRlIHRoaXMuX2J5SWRbcHJldklkXTtcbiAgICAgICAgICAgIGlmIChpZCAhPSBudWxsKSB0aGlzLl9ieUlkW2lkXSA9IG1vZGVsO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgdGhpcy50cmlnZ2VyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgfVxuXG4gIH0pO1xuXG4gIC8vIFVuZGVyc2NvcmUgbWV0aG9kcyB0aGF0IHdlIHdhbnQgdG8gaW1wbGVtZW50IG9uIHRoZSBDb2xsZWN0aW9uLlxuICAvLyA5MCUgb2YgdGhlIGNvcmUgdXNlZnVsbmVzcyBvZiBCYWNrYm9uZSBDb2xsZWN0aW9ucyBpcyBhY3R1YWxseSBpbXBsZW1lbnRlZFxuICAvLyByaWdodCBoZXJlOlxuICB2YXIgY29sbGVjdGlvbk1ldGhvZHMgPSB7Zm9yRWFjaDogMywgZWFjaDogMywgbWFwOiAzLCBjb2xsZWN0OiAzLCByZWR1Y2U6IDAsXG4gICAgICBmb2xkbDogMCwgaW5qZWN0OiAwLCByZWR1Y2VSaWdodDogMCwgZm9sZHI6IDAsIGZpbmQ6IDMsIGRldGVjdDogMywgZmlsdGVyOiAzLFxuICAgICAgc2VsZWN0OiAzLCByZWplY3Q6IDMsIGV2ZXJ5OiAzLCBhbGw6IDMsIHNvbWU6IDMsIGFueTogMywgaW5jbHVkZTogMywgaW5jbHVkZXM6IDMsXG4gICAgICBjb250YWluczogMywgaW52b2tlOiAwLCBtYXg6IDMsIG1pbjogMywgdG9BcnJheTogMSwgc2l6ZTogMSwgZmlyc3Q6IDMsXG4gICAgICBoZWFkOiAzLCB0YWtlOiAzLCBpbml0aWFsOiAzLCByZXN0OiAzLCB0YWlsOiAzLCBkcm9wOiAzLCBsYXN0OiAzLFxuICAgICAgd2l0aG91dDogMCwgZGlmZmVyZW5jZTogMCwgaW5kZXhPZjogMywgc2h1ZmZsZTogMSwgbGFzdEluZGV4T2Y6IDMsXG4gICAgICBpc0VtcHR5OiAxLCBjaGFpbjogMSwgc2FtcGxlOiAzLCBwYXJ0aXRpb246IDMsIGdyb3VwQnk6IDMsIGNvdW50Qnk6IDMsXG4gICAgICBzb3J0Qnk6IDMsIGluZGV4Qnk6IDMsIGZpbmRJbmRleDogMywgZmluZExhc3RJbmRleDogM307XG5cbiAgLy8gTWl4IGluIGVhY2ggVW5kZXJzY29yZSBtZXRob2QgYXMgYSBwcm94eSB0byBgQ29sbGVjdGlvbiNtb2RlbHNgLlxuICBhZGRVbmRlcnNjb3JlTWV0aG9kcyhDb2xsZWN0aW9uLCBjb2xsZWN0aW9uTWV0aG9kcywgJ21vZGVscycpO1xuXG4gIC8vIEJhY2tib25lLlZpZXdcbiAgLy8gLS0tLS0tLS0tLS0tLVxuXG4gIC8vIEJhY2tib25lIFZpZXdzIGFyZSBhbG1vc3QgbW9yZSBjb252ZW50aW9uIHRoYW4gdGhleSBhcmUgYWN0dWFsIGNvZGUuIEEgVmlld1xuICAvLyBpcyBzaW1wbHkgYSBKYXZhU2NyaXB0IG9iamVjdCB0aGF0IHJlcHJlc2VudHMgYSBsb2dpY2FsIGNodW5rIG9mIFVJIGluIHRoZVxuICAvLyBET00uIFRoaXMgbWlnaHQgYmUgYSBzaW5nbGUgaXRlbSwgYW4gZW50aXJlIGxpc3QsIGEgc2lkZWJhciBvciBwYW5lbCwgb3JcbiAgLy8gZXZlbiB0aGUgc3Vycm91bmRpbmcgZnJhbWUgd2hpY2ggd3JhcHMgeW91ciB3aG9sZSBhcHAuIERlZmluaW5nIGEgY2h1bmsgb2ZcbiAgLy8gVUkgYXMgYSAqKlZpZXcqKiBhbGxvd3MgeW91IHRvIGRlZmluZSB5b3VyIERPTSBldmVudHMgZGVjbGFyYXRpdmVseSwgd2l0aG91dFxuICAvLyBoYXZpbmcgdG8gd29ycnkgYWJvdXQgcmVuZGVyIG9yZGVyIC4uLiBhbmQgbWFrZXMgaXQgZWFzeSBmb3IgdGhlIHZpZXcgdG9cbiAgLy8gcmVhY3QgdG8gc3BlY2lmaWMgY2hhbmdlcyBpbiB0aGUgc3RhdGUgb2YgeW91ciBtb2RlbHMuXG5cbiAgLy8gQ3JlYXRpbmcgYSBCYWNrYm9uZS5WaWV3IGNyZWF0ZXMgaXRzIGluaXRpYWwgZWxlbWVudCBvdXRzaWRlIG9mIHRoZSBET00sXG4gIC8vIGlmIGFuIGV4aXN0aW5nIGVsZW1lbnQgaXMgbm90IHByb3ZpZGVkLi4uXG4gIHZhciBWaWV3ID0gQmFja2JvbmUuVmlldyA9IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICB0aGlzLmNpZCA9IF8udW5pcXVlSWQoJ3ZpZXcnKTtcbiAgICBfLmV4dGVuZCh0aGlzLCBfLnBpY2sob3B0aW9ucywgdmlld09wdGlvbnMpKTtcbiAgICB0aGlzLl9lbnN1cmVFbGVtZW50KCk7XG4gICAgdGhpcy5pbml0aWFsaXplLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gIH07XG5cbiAgLy8gQ2FjaGVkIHJlZ2V4IHRvIHNwbGl0IGtleXMgZm9yIGBkZWxlZ2F0ZWAuXG4gIHZhciBkZWxlZ2F0ZUV2ZW50U3BsaXR0ZXIgPSAvXihcXFMrKVxccyooLiopJC87XG5cbiAgLy8gTGlzdCBvZiB2aWV3IG9wdGlvbnMgdG8gYmUgc2V0IGFzIHByb3BlcnRpZXMuXG4gIHZhciB2aWV3T3B0aW9ucyA9IFsnbW9kZWwnLCAnY29sbGVjdGlvbicsICdlbCcsICdpZCcsICdhdHRyaWJ1dGVzJywgJ2NsYXNzTmFtZScsICd0YWdOYW1lJywgJ2V2ZW50cyddO1xuXG4gIC8vIFNldCB1cCBhbGwgaW5oZXJpdGFibGUgKipCYWNrYm9uZS5WaWV3KiogcHJvcGVydGllcyBhbmQgbWV0aG9kcy5cbiAgXy5leHRlbmQoVmlldy5wcm90b3R5cGUsIEV2ZW50cywge1xuXG4gICAgLy8gVGhlIGRlZmF1bHQgYHRhZ05hbWVgIG9mIGEgVmlldydzIGVsZW1lbnQgaXMgYFwiZGl2XCJgLlxuICAgIHRhZ05hbWU6ICdkaXYnLFxuXG4gICAgLy8galF1ZXJ5IGRlbGVnYXRlIGZvciBlbGVtZW50IGxvb2t1cCwgc2NvcGVkIHRvIERPTSBlbGVtZW50cyB3aXRoaW4gdGhlXG4gICAgLy8gY3VycmVudCB2aWV3LiBUaGlzIHNob3VsZCBiZSBwcmVmZXJyZWQgdG8gZ2xvYmFsIGxvb2t1cHMgd2hlcmUgcG9zc2libGUuXG4gICAgJDogZnVuY3Rpb24oc2VsZWN0b3IpIHtcbiAgICAgIHJldHVybiB0aGlzLiRlbC5maW5kKHNlbGVjdG9yKTtcbiAgICB9LFxuXG4gICAgLy8gSW5pdGlhbGl6ZSBpcyBhbiBlbXB0eSBmdW5jdGlvbiBieSBkZWZhdWx0LiBPdmVycmlkZSBpdCB3aXRoIHlvdXIgb3duXG4gICAgLy8gaW5pdGlhbGl6YXRpb24gbG9naWMuXG4gICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKXt9LFxuXG4gICAgLy8gKipyZW5kZXIqKiBpcyB0aGUgY29yZSBmdW5jdGlvbiB0aGF0IHlvdXIgdmlldyBzaG91bGQgb3ZlcnJpZGUsIGluIG9yZGVyXG4gICAgLy8gdG8gcG9wdWxhdGUgaXRzIGVsZW1lbnQgKGB0aGlzLmVsYCksIHdpdGggdGhlIGFwcHJvcHJpYXRlIEhUTUwuIFRoZVxuICAgIC8vIGNvbnZlbnRpb24gaXMgZm9yICoqcmVuZGVyKiogdG8gYWx3YXlzIHJldHVybiBgdGhpc2AuXG4gICAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICAvLyBSZW1vdmUgdGhpcyB2aWV3IGJ5IHRha2luZyB0aGUgZWxlbWVudCBvdXQgb2YgdGhlIERPTSwgYW5kIHJlbW92aW5nIGFueVxuICAgIC8vIGFwcGxpY2FibGUgQmFja2JvbmUuRXZlbnRzIGxpc3RlbmVycy5cbiAgICByZW1vdmU6IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5fcmVtb3ZlRWxlbWVudCgpO1xuICAgICAgdGhpcy5zdG9wTGlzdGVuaW5nKCk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgLy8gUmVtb3ZlIHRoaXMgdmlldydzIGVsZW1lbnQgZnJvbSB0aGUgZG9jdW1lbnQgYW5kIGFsbCBldmVudCBsaXN0ZW5lcnNcbiAgICAvLyBhdHRhY2hlZCB0byBpdC4gRXhwb3NlZCBmb3Igc3ViY2xhc3NlcyB1c2luZyBhbiBhbHRlcm5hdGl2ZSBET01cbiAgICAvLyBtYW5pcHVsYXRpb24gQVBJLlxuICAgIF9yZW1vdmVFbGVtZW50OiBmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMuJGVsLnJlbW92ZSgpO1xuICAgIH0sXG5cbiAgICAvLyBDaGFuZ2UgdGhlIHZpZXcncyBlbGVtZW50IChgdGhpcy5lbGAgcHJvcGVydHkpIGFuZCByZS1kZWxlZ2F0ZSB0aGVcbiAgICAvLyB2aWV3J3MgZXZlbnRzIG9uIHRoZSBuZXcgZWxlbWVudC5cbiAgICBzZXRFbGVtZW50OiBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICB0aGlzLnVuZGVsZWdhdGVFdmVudHMoKTtcbiAgICAgIHRoaXMuX3NldEVsZW1lbnQoZWxlbWVudCk7XG4gICAgICB0aGlzLmRlbGVnYXRlRXZlbnRzKCk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgLy8gQ3JlYXRlcyB0aGUgYHRoaXMuZWxgIGFuZCBgdGhpcy4kZWxgIHJlZmVyZW5jZXMgZm9yIHRoaXMgdmlldyB1c2luZyB0aGVcbiAgICAvLyBnaXZlbiBgZWxgLiBgZWxgIGNhbiBiZSBhIENTUyBzZWxlY3RvciBvciBhbiBIVE1MIHN0cmluZywgYSBqUXVlcnlcbiAgICAvLyBjb250ZXh0IG9yIGFuIGVsZW1lbnQuIFN1YmNsYXNzZXMgY2FuIG92ZXJyaWRlIHRoaXMgdG8gdXRpbGl6ZSBhblxuICAgIC8vIGFsdGVybmF0aXZlIERPTSBtYW5pcHVsYXRpb24gQVBJIGFuZCBhcmUgb25seSByZXF1aXJlZCB0byBzZXQgdGhlXG4gICAgLy8gYHRoaXMuZWxgIHByb3BlcnR5LlxuICAgIF9zZXRFbGVtZW50OiBmdW5jdGlvbihlbCkge1xuICAgICAgdGhpcy4kZWwgPSBlbCBpbnN0YW5jZW9mIEJhY2tib25lLiQgPyBlbCA6IEJhY2tib25lLiQoZWwpO1xuICAgICAgdGhpcy5lbCA9IHRoaXMuJGVsWzBdO1xuICAgIH0sXG5cbiAgICAvLyBTZXQgY2FsbGJhY2tzLCB3aGVyZSBgdGhpcy5ldmVudHNgIGlzIGEgaGFzaCBvZlxuICAgIC8vXG4gICAgLy8gKntcImV2ZW50IHNlbGVjdG9yXCI6IFwiY2FsbGJhY2tcIn0qXG4gICAgLy9cbiAgICAvLyAgICAge1xuICAgIC8vICAgICAgICdtb3VzZWRvd24gLnRpdGxlJzogICdlZGl0JyxcbiAgICAvLyAgICAgICAnY2xpY2sgLmJ1dHRvbic6ICAgICAnc2F2ZScsXG4gICAgLy8gICAgICAgJ2NsaWNrIC5vcGVuJzogICAgICAgZnVuY3Rpb24oZSkgeyAuLi4gfVxuICAgIC8vICAgICB9XG4gICAgLy9cbiAgICAvLyBwYWlycy4gQ2FsbGJhY2tzIHdpbGwgYmUgYm91bmQgdG8gdGhlIHZpZXcsIHdpdGggYHRoaXNgIHNldCBwcm9wZXJseS5cbiAgICAvLyBVc2VzIGV2ZW50IGRlbGVnYXRpb24gZm9yIGVmZmljaWVuY3kuXG4gICAgLy8gT21pdHRpbmcgdGhlIHNlbGVjdG9yIGJpbmRzIHRoZSBldmVudCB0byBgdGhpcy5lbGAuXG4gICAgZGVsZWdhdGVFdmVudHM6IGZ1bmN0aW9uKGV2ZW50cykge1xuICAgICAgZXZlbnRzIHx8IChldmVudHMgPSBfLnJlc3VsdCh0aGlzLCAnZXZlbnRzJykpO1xuICAgICAgaWYgKCFldmVudHMpIHJldHVybiB0aGlzO1xuICAgICAgdGhpcy51bmRlbGVnYXRlRXZlbnRzKCk7XG4gICAgICBmb3IgKHZhciBrZXkgaW4gZXZlbnRzKSB7XG4gICAgICAgIHZhciBtZXRob2QgPSBldmVudHNba2V5XTtcbiAgICAgICAgaWYgKCFfLmlzRnVuY3Rpb24obWV0aG9kKSkgbWV0aG9kID0gdGhpc1ttZXRob2RdO1xuICAgICAgICBpZiAoIW1ldGhvZCkgY29udGludWU7XG4gICAgICAgIHZhciBtYXRjaCA9IGtleS5tYXRjaChkZWxlZ2F0ZUV2ZW50U3BsaXR0ZXIpO1xuICAgICAgICB0aGlzLmRlbGVnYXRlKG1hdGNoWzFdLCBtYXRjaFsyXSwgXy5iaW5kKG1ldGhvZCwgdGhpcykpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIC8vIEFkZCBhIHNpbmdsZSBldmVudCBsaXN0ZW5lciB0byB0aGUgdmlldydzIGVsZW1lbnQgKG9yIGEgY2hpbGQgZWxlbWVudFxuICAgIC8vIHVzaW5nIGBzZWxlY3RvcmApLiBUaGlzIG9ubHkgd29ya3MgZm9yIGRlbGVnYXRlLWFibGUgZXZlbnRzOiBub3QgYGZvY3VzYCxcbiAgICAvLyBgYmx1cmAsIGFuZCBub3QgYGNoYW5nZWAsIGBzdWJtaXRgLCBhbmQgYHJlc2V0YCBpbiBJbnRlcm5ldCBFeHBsb3Jlci5cbiAgICBkZWxlZ2F0ZTogZnVuY3Rpb24oZXZlbnROYW1lLCBzZWxlY3RvciwgbGlzdGVuZXIpIHtcbiAgICAgIHRoaXMuJGVsLm9uKGV2ZW50TmFtZSArICcuZGVsZWdhdGVFdmVudHMnICsgdGhpcy5jaWQsIHNlbGVjdG9yLCBsaXN0ZW5lcik7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgLy8gQ2xlYXJzIGFsbCBjYWxsYmFja3MgcHJldmlvdXNseSBib3VuZCB0byB0aGUgdmlldyBieSBgZGVsZWdhdGVFdmVudHNgLlxuICAgIC8vIFlvdSB1c3VhbGx5IGRvbid0IG5lZWQgdG8gdXNlIHRoaXMsIGJ1dCBtYXkgd2lzaCB0byBpZiB5b3UgaGF2ZSBtdWx0aXBsZVxuICAgIC8vIEJhY2tib25lIHZpZXdzIGF0dGFjaGVkIHRvIHRoZSBzYW1lIERPTSBlbGVtZW50LlxuICAgIHVuZGVsZWdhdGVFdmVudHM6IGZ1bmN0aW9uKCkge1xuICAgICAgaWYgKHRoaXMuJGVsKSB0aGlzLiRlbC5vZmYoJy5kZWxlZ2F0ZUV2ZW50cycgKyB0aGlzLmNpZCk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgLy8gQSBmaW5lci1ncmFpbmVkIGB1bmRlbGVnYXRlRXZlbnRzYCBmb3IgcmVtb3ZpbmcgYSBzaW5nbGUgZGVsZWdhdGVkIGV2ZW50LlxuICAgIC8vIGBzZWxlY3RvcmAgYW5kIGBsaXN0ZW5lcmAgYXJlIGJvdGggb3B0aW9uYWwuXG4gICAgdW5kZWxlZ2F0ZTogZnVuY3Rpb24oZXZlbnROYW1lLCBzZWxlY3RvciwgbGlzdGVuZXIpIHtcbiAgICAgIHRoaXMuJGVsLm9mZihldmVudE5hbWUgKyAnLmRlbGVnYXRlRXZlbnRzJyArIHRoaXMuY2lkLCBzZWxlY3RvciwgbGlzdGVuZXIpO1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIC8vIFByb2R1Y2VzIGEgRE9NIGVsZW1lbnQgdG8gYmUgYXNzaWduZWQgdG8geW91ciB2aWV3LiBFeHBvc2VkIGZvclxuICAgIC8vIHN1YmNsYXNzZXMgdXNpbmcgYW4gYWx0ZXJuYXRpdmUgRE9NIG1hbmlwdWxhdGlvbiBBUEkuXG4gICAgX2NyZWF0ZUVsZW1lbnQ6IGZ1bmN0aW9uKHRhZ05hbWUpIHtcbiAgICAgIHJldHVybiBkb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZ05hbWUpO1xuICAgIH0sXG5cbiAgICAvLyBFbnN1cmUgdGhhdCB0aGUgVmlldyBoYXMgYSBET00gZWxlbWVudCB0byByZW5kZXIgaW50by5cbiAgICAvLyBJZiBgdGhpcy5lbGAgaXMgYSBzdHJpbmcsIHBhc3MgaXQgdGhyb3VnaCBgJCgpYCwgdGFrZSB0aGUgZmlyc3RcbiAgICAvLyBtYXRjaGluZyBlbGVtZW50LCBhbmQgcmUtYXNzaWduIGl0IHRvIGBlbGAuIE90aGVyd2lzZSwgY3JlYXRlXG4gICAgLy8gYW4gZWxlbWVudCBmcm9tIHRoZSBgaWRgLCBgY2xhc3NOYW1lYCBhbmQgYHRhZ05hbWVgIHByb3BlcnRpZXMuXG4gICAgX2Vuc3VyZUVsZW1lbnQ6IGZ1bmN0aW9uKCkge1xuICAgICAgaWYgKCF0aGlzLmVsKSB7XG4gICAgICAgIHZhciBhdHRycyA9IF8uZXh0ZW5kKHt9LCBfLnJlc3VsdCh0aGlzLCAnYXR0cmlidXRlcycpKTtcbiAgICAgICAgaWYgKHRoaXMuaWQpIGF0dHJzLmlkID0gXy5yZXN1bHQodGhpcywgJ2lkJyk7XG4gICAgICAgIGlmICh0aGlzLmNsYXNzTmFtZSkgYXR0cnNbJ2NsYXNzJ10gPSBfLnJlc3VsdCh0aGlzLCAnY2xhc3NOYW1lJyk7XG4gICAgICAgIHRoaXMuc2V0RWxlbWVudCh0aGlzLl9jcmVhdGVFbGVtZW50KF8ucmVzdWx0KHRoaXMsICd0YWdOYW1lJykpKTtcbiAgICAgICAgdGhpcy5fc2V0QXR0cmlidXRlcyhhdHRycyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnNldEVsZW1lbnQoXy5yZXN1bHQodGhpcywgJ2VsJykpO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICAvLyBTZXQgYXR0cmlidXRlcyBmcm9tIGEgaGFzaCBvbiB0aGlzIHZpZXcncyBlbGVtZW50LiAgRXhwb3NlZCBmb3JcbiAgICAvLyBzdWJjbGFzc2VzIHVzaW5nIGFuIGFsdGVybmF0aXZlIERPTSBtYW5pcHVsYXRpb24gQVBJLlxuICAgIF9zZXRBdHRyaWJ1dGVzOiBmdW5jdGlvbihhdHRyaWJ1dGVzKSB7XG4gICAgICB0aGlzLiRlbC5hdHRyKGF0dHJpYnV0ZXMpO1xuICAgIH1cblxuICB9KTtcblxuICAvLyBCYWNrYm9uZS5zeW5jXG4gIC8vIC0tLS0tLS0tLS0tLS1cblxuICAvLyBPdmVycmlkZSB0aGlzIGZ1bmN0aW9uIHRvIGNoYW5nZSB0aGUgbWFubmVyIGluIHdoaWNoIEJhY2tib25lIHBlcnNpc3RzXG4gIC8vIG1vZGVscyB0byB0aGUgc2VydmVyLiBZb3Ugd2lsbCBiZSBwYXNzZWQgdGhlIHR5cGUgb2YgcmVxdWVzdCwgYW5kIHRoZVxuICAvLyBtb2RlbCBpbiBxdWVzdGlvbi4gQnkgZGVmYXVsdCwgbWFrZXMgYSBSRVNUZnVsIEFqYXggcmVxdWVzdFxuICAvLyB0byB0aGUgbW9kZWwncyBgdXJsKClgLiBTb21lIHBvc3NpYmxlIGN1c3RvbWl6YXRpb25zIGNvdWxkIGJlOlxuICAvL1xuICAvLyAqIFVzZSBgc2V0VGltZW91dGAgdG8gYmF0Y2ggcmFwaWQtZmlyZSB1cGRhdGVzIGludG8gYSBzaW5nbGUgcmVxdWVzdC5cbiAgLy8gKiBTZW5kIHVwIHRoZSBtb2RlbHMgYXMgWE1MIGluc3RlYWQgb2YgSlNPTi5cbiAgLy8gKiBQZXJzaXN0IG1vZGVscyB2aWEgV2ViU29ja2V0cyBpbnN0ZWFkIG9mIEFqYXguXG4gIC8vXG4gIC8vIFR1cm4gb24gYEJhY2tib25lLmVtdWxhdGVIVFRQYCBpbiBvcmRlciB0byBzZW5kIGBQVVRgIGFuZCBgREVMRVRFYCByZXF1ZXN0c1xuICAvLyBhcyBgUE9TVGAsIHdpdGggYSBgX21ldGhvZGAgcGFyYW1ldGVyIGNvbnRhaW5pbmcgdGhlIHRydWUgSFRUUCBtZXRob2QsXG4gIC8vIGFzIHdlbGwgYXMgYWxsIHJlcXVlc3RzIHdpdGggdGhlIGJvZHkgYXMgYGFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZGBcbiAgLy8gaW5zdGVhZCBvZiBgYXBwbGljYXRpb24vanNvbmAgd2l0aCB0aGUgbW9kZWwgaW4gYSBwYXJhbSBuYW1lZCBgbW9kZWxgLlxuICAvLyBVc2VmdWwgd2hlbiBpbnRlcmZhY2luZyB3aXRoIHNlcnZlci1zaWRlIGxhbmd1YWdlcyBsaWtlICoqUEhQKiogdGhhdCBtYWtlXG4gIC8vIGl0IGRpZmZpY3VsdCB0byByZWFkIHRoZSBib2R5IG9mIGBQVVRgIHJlcXVlc3RzLlxuICBCYWNrYm9uZS5zeW5jID0gZnVuY3Rpb24obWV0aG9kLCBtb2RlbCwgb3B0aW9ucykge1xuICAgIHZhciB0eXBlID0gbWV0aG9kTWFwW21ldGhvZF07XG5cbiAgICAvLyBEZWZhdWx0IG9wdGlvbnMsIHVubGVzcyBzcGVjaWZpZWQuXG4gICAgXy5kZWZhdWx0cyhvcHRpb25zIHx8IChvcHRpb25zID0ge30pLCB7XG4gICAgICBlbXVsYXRlSFRUUDogQmFja2JvbmUuZW11bGF0ZUhUVFAsXG4gICAgICBlbXVsYXRlSlNPTjogQmFja2JvbmUuZW11bGF0ZUpTT05cbiAgICB9KTtcblxuICAgIC8vIERlZmF1bHQgSlNPTi1yZXF1ZXN0IG9wdGlvbnMuXG4gICAgdmFyIHBhcmFtcyA9IHt0eXBlOiB0eXBlLCBkYXRhVHlwZTogJ2pzb24nfTtcblxuICAgIC8vIEVuc3VyZSB0aGF0IHdlIGhhdmUgYSBVUkwuXG4gICAgaWYgKCFvcHRpb25zLnVybCkge1xuICAgICAgcGFyYW1zLnVybCA9IF8ucmVzdWx0KG1vZGVsLCAndXJsJykgfHwgdXJsRXJyb3IoKTtcbiAgICB9XG5cbiAgICAvLyBFbnN1cmUgdGhhdCB3ZSBoYXZlIHRoZSBhcHByb3ByaWF0ZSByZXF1ZXN0IGRhdGEuXG4gICAgaWYgKG9wdGlvbnMuZGF0YSA9PSBudWxsICYmIG1vZGVsICYmIChtZXRob2QgPT09ICdjcmVhdGUnIHx8IG1ldGhvZCA9PT0gJ3VwZGF0ZScgfHwgbWV0aG9kID09PSAncGF0Y2gnKSkge1xuICAgICAgcGFyYW1zLmNvbnRlbnRUeXBlID0gJ2FwcGxpY2F0aW9uL2pzb24nO1xuICAgICAgcGFyYW1zLmRhdGEgPSBKU09OLnN0cmluZ2lmeShvcHRpb25zLmF0dHJzIHx8IG1vZGVsLnRvSlNPTihvcHRpb25zKSk7XG4gICAgfVxuXG4gICAgLy8gRm9yIG9sZGVyIHNlcnZlcnMsIGVtdWxhdGUgSlNPTiBieSBlbmNvZGluZyB0aGUgcmVxdWVzdCBpbnRvIGFuIEhUTUwtZm9ybS5cbiAgICBpZiAob3B0aW9ucy5lbXVsYXRlSlNPTikge1xuICAgICAgcGFyYW1zLmNvbnRlbnRUeXBlID0gJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCc7XG4gICAgICBwYXJhbXMuZGF0YSA9IHBhcmFtcy5kYXRhID8ge21vZGVsOiBwYXJhbXMuZGF0YX0gOiB7fTtcbiAgICB9XG5cbiAgICAvLyBGb3Igb2xkZXIgc2VydmVycywgZW11bGF0ZSBIVFRQIGJ5IG1pbWlja2luZyB0aGUgSFRUUCBtZXRob2Qgd2l0aCBgX21ldGhvZGBcbiAgICAvLyBBbmQgYW4gYFgtSFRUUC1NZXRob2QtT3ZlcnJpZGVgIGhlYWRlci5cbiAgICBpZiAob3B0aW9ucy5lbXVsYXRlSFRUUCAmJiAodHlwZSA9PT0gJ1BVVCcgfHwgdHlwZSA9PT0gJ0RFTEVURScgfHwgdHlwZSA9PT0gJ1BBVENIJykpIHtcbiAgICAgIHBhcmFtcy50eXBlID0gJ1BPU1QnO1xuICAgICAgaWYgKG9wdGlvbnMuZW11bGF0ZUpTT04pIHBhcmFtcy5kYXRhLl9tZXRob2QgPSB0eXBlO1xuICAgICAgdmFyIGJlZm9yZVNlbmQgPSBvcHRpb25zLmJlZm9yZVNlbmQ7XG4gICAgICBvcHRpb25zLmJlZm9yZVNlbmQgPSBmdW5jdGlvbih4aHIpIHtcbiAgICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoJ1gtSFRUUC1NZXRob2QtT3ZlcnJpZGUnLCB0eXBlKTtcbiAgICAgICAgaWYgKGJlZm9yZVNlbmQpIHJldHVybiBiZWZvcmVTZW5kLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICB9O1xuICAgIH1cblxuICAgIC8vIERvbid0IHByb2Nlc3MgZGF0YSBvbiBhIG5vbi1HRVQgcmVxdWVzdC5cbiAgICBpZiAocGFyYW1zLnR5cGUgIT09ICdHRVQnICYmICFvcHRpb25zLmVtdWxhdGVKU09OKSB7XG4gICAgICBwYXJhbXMucHJvY2Vzc0RhdGEgPSBmYWxzZTtcbiAgICB9XG5cbiAgICAvLyBQYXNzIGFsb25nIGB0ZXh0U3RhdHVzYCBhbmQgYGVycm9yVGhyb3duYCBmcm9tIGpRdWVyeS5cbiAgICB2YXIgZXJyb3IgPSBvcHRpb25zLmVycm9yO1xuICAgIG9wdGlvbnMuZXJyb3IgPSBmdW5jdGlvbih4aHIsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKSB7XG4gICAgICBvcHRpb25zLnRleHRTdGF0dXMgPSB0ZXh0U3RhdHVzO1xuICAgICAgb3B0aW9ucy5lcnJvclRocm93biA9IGVycm9yVGhyb3duO1xuICAgICAgaWYgKGVycm9yKSBlcnJvci5jYWxsKG9wdGlvbnMuY29udGV4dCwgeGhyLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93bik7XG4gICAgfTtcblxuICAgIC8vIE1ha2UgdGhlIHJlcXVlc3QsIGFsbG93aW5nIHRoZSB1c2VyIHRvIG92ZXJyaWRlIGFueSBBamF4IG9wdGlvbnMuXG4gICAgdmFyIHhociA9IG9wdGlvbnMueGhyID0gQmFja2JvbmUuYWpheChfLmV4dGVuZChwYXJhbXMsIG9wdGlvbnMpKTtcbiAgICBtb2RlbC50cmlnZ2VyKCdyZXF1ZXN0JywgbW9kZWwsIHhociwgb3B0aW9ucyk7XG4gICAgcmV0dXJuIHhocjtcbiAgfTtcblxuICAvLyBNYXAgZnJvbSBDUlVEIHRvIEhUVFAgZm9yIG91ciBkZWZhdWx0IGBCYWNrYm9uZS5zeW5jYCBpbXBsZW1lbnRhdGlvbi5cbiAgdmFyIG1ldGhvZE1hcCA9IHtcbiAgICAnY3JlYXRlJzogJ1BPU1QnLFxuICAgICd1cGRhdGUnOiAnUFVUJyxcbiAgICAncGF0Y2gnOiAnUEFUQ0gnLFxuICAgICdkZWxldGUnOiAnREVMRVRFJyxcbiAgICAncmVhZCc6ICdHRVQnXG4gIH07XG5cbiAgLy8gU2V0IHRoZSBkZWZhdWx0IGltcGxlbWVudGF0aW9uIG9mIGBCYWNrYm9uZS5hamF4YCB0byBwcm94eSB0aHJvdWdoIHRvIGAkYC5cbiAgLy8gT3ZlcnJpZGUgdGhpcyBpZiB5b3UnZCBsaWtlIHRvIHVzZSBhIGRpZmZlcmVudCBsaWJyYXJ5LlxuICBCYWNrYm9uZS5hamF4ID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIEJhY2tib25lLiQuYWpheC5hcHBseShCYWNrYm9uZS4kLCBhcmd1bWVudHMpO1xuICB9O1xuXG4gIC8vIEJhY2tib25lLlJvdXRlclxuICAvLyAtLS0tLS0tLS0tLS0tLS1cblxuICAvLyBSb3V0ZXJzIG1hcCBmYXV4LVVSTHMgdG8gYWN0aW9ucywgYW5kIGZpcmUgZXZlbnRzIHdoZW4gcm91dGVzIGFyZVxuICAvLyBtYXRjaGVkLiBDcmVhdGluZyBhIG5ldyBvbmUgc2V0cyBpdHMgYHJvdXRlc2AgaGFzaCwgaWYgbm90IHNldCBzdGF0aWNhbGx5LlxuICB2YXIgUm91dGVyID0gQmFja2JvbmUuUm91dGVyID0gZnVuY3Rpb24ob3B0aW9ucykge1xuICAgIG9wdGlvbnMgfHwgKG9wdGlvbnMgPSB7fSk7XG4gICAgaWYgKG9wdGlvbnMucm91dGVzKSB0aGlzLnJvdXRlcyA9IG9wdGlvbnMucm91dGVzO1xuICAgIHRoaXMuX2JpbmRSb3V0ZXMoKTtcbiAgICB0aGlzLmluaXRpYWxpemUuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgfTtcblxuICAvLyBDYWNoZWQgcmVndWxhciBleHByZXNzaW9ucyBmb3IgbWF0Y2hpbmcgbmFtZWQgcGFyYW0gcGFydHMgYW5kIHNwbGF0dGVkXG4gIC8vIHBhcnRzIG9mIHJvdXRlIHN0cmluZ3MuXG4gIHZhciBvcHRpb25hbFBhcmFtID0gL1xcKCguKj8pXFwpL2c7XG4gIHZhciBuYW1lZFBhcmFtICAgID0gLyhcXChcXD8pPzpcXHcrL2c7XG4gIHZhciBzcGxhdFBhcmFtICAgID0gL1xcKlxcdysvZztcbiAgdmFyIGVzY2FwZVJlZ0V4cCAgPSAvW1xcLXt9XFxbXFxdKz8uLFxcXFxcXF4kfCNcXHNdL2c7XG5cbiAgLy8gU2V0IHVwIGFsbCBpbmhlcml0YWJsZSAqKkJhY2tib25lLlJvdXRlcioqIHByb3BlcnRpZXMgYW5kIG1ldGhvZHMuXG4gIF8uZXh0ZW5kKFJvdXRlci5wcm90b3R5cGUsIEV2ZW50cywge1xuXG4gICAgLy8gSW5pdGlhbGl6ZSBpcyBhbiBlbXB0eSBmdW5jdGlvbiBieSBkZWZhdWx0LiBPdmVycmlkZSBpdCB3aXRoIHlvdXIgb3duXG4gICAgLy8gaW5pdGlhbGl6YXRpb24gbG9naWMuXG4gICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKXt9LFxuXG4gICAgLy8gTWFudWFsbHkgYmluZCBhIHNpbmdsZSBuYW1lZCByb3V0ZSB0byBhIGNhbGxiYWNrLiBGb3IgZXhhbXBsZTpcbiAgICAvL1xuICAgIC8vICAgICB0aGlzLnJvdXRlKCdzZWFyY2gvOnF1ZXJ5L3A6bnVtJywgJ3NlYXJjaCcsIGZ1bmN0aW9uKHF1ZXJ5LCBudW0pIHtcbiAgICAvLyAgICAgICAuLi5cbiAgICAvLyAgICAgfSk7XG4gICAgLy9cbiAgICByb3V0ZTogZnVuY3Rpb24ocm91dGUsIG5hbWUsIGNhbGxiYWNrKSB7XG4gICAgICBpZiAoIV8uaXNSZWdFeHAocm91dGUpKSByb3V0ZSA9IHRoaXMuX3JvdXRlVG9SZWdFeHAocm91dGUpO1xuICAgICAgaWYgKF8uaXNGdW5jdGlvbihuYW1lKSkge1xuICAgICAgICBjYWxsYmFjayA9IG5hbWU7XG4gICAgICAgIG5hbWUgPSAnJztcbiAgICAgIH1cbiAgICAgIGlmICghY2FsbGJhY2spIGNhbGxiYWNrID0gdGhpc1tuYW1lXTtcbiAgICAgIHZhciByb3V0ZXIgPSB0aGlzO1xuICAgICAgQmFja2JvbmUuaGlzdG9yeS5yb3V0ZShyb3V0ZSwgZnVuY3Rpb24oZnJhZ21lbnQpIHtcbiAgICAgICAgdmFyIGFyZ3MgPSByb3V0ZXIuX2V4dHJhY3RQYXJhbWV0ZXJzKHJvdXRlLCBmcmFnbWVudCk7XG4gICAgICAgIGlmIChyb3V0ZXIuZXhlY3V0ZShjYWxsYmFjaywgYXJncywgbmFtZSkgIT09IGZhbHNlKSB7XG4gICAgICAgICAgcm91dGVyLnRyaWdnZXIuYXBwbHkocm91dGVyLCBbJ3JvdXRlOicgKyBuYW1lXS5jb25jYXQoYXJncykpO1xuICAgICAgICAgIHJvdXRlci50cmlnZ2VyKCdyb3V0ZScsIG5hbWUsIGFyZ3MpO1xuICAgICAgICAgIEJhY2tib25lLmhpc3RvcnkudHJpZ2dlcigncm91dGUnLCByb3V0ZXIsIG5hbWUsIGFyZ3MpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICAvLyBFeGVjdXRlIGEgcm91dGUgaGFuZGxlciB3aXRoIHRoZSBwcm92aWRlZCBwYXJhbWV0ZXJzLiAgVGhpcyBpcyBhblxuICAgIC8vIGV4Y2VsbGVudCBwbGFjZSB0byBkbyBwcmUtcm91dGUgc2V0dXAgb3IgcG9zdC1yb3V0ZSBjbGVhbnVwLlxuICAgIGV4ZWN1dGU6IGZ1bmN0aW9uKGNhbGxiYWNrLCBhcmdzLCBuYW1lKSB7XG4gICAgICBpZiAoY2FsbGJhY2spIGNhbGxiYWNrLmFwcGx5KHRoaXMsIGFyZ3MpO1xuICAgIH0sXG5cbiAgICAvLyBTaW1wbGUgcHJveHkgdG8gYEJhY2tib25lLmhpc3RvcnlgIHRvIHNhdmUgYSBmcmFnbWVudCBpbnRvIHRoZSBoaXN0b3J5LlxuICAgIG5hdmlnYXRlOiBmdW5jdGlvbihmcmFnbWVudCwgb3B0aW9ucykge1xuICAgICAgQmFja2JvbmUuaGlzdG9yeS5uYXZpZ2F0ZShmcmFnbWVudCwgb3B0aW9ucyk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgLy8gQmluZCBhbGwgZGVmaW5lZCByb3V0ZXMgdG8gYEJhY2tib25lLmhpc3RvcnlgLiBXZSBoYXZlIHRvIHJldmVyc2UgdGhlXG4gICAgLy8gb3JkZXIgb2YgdGhlIHJvdXRlcyBoZXJlIHRvIHN1cHBvcnQgYmVoYXZpb3Igd2hlcmUgdGhlIG1vc3QgZ2VuZXJhbFxuICAgIC8vIHJvdXRlcyBjYW4gYmUgZGVmaW5lZCBhdCB0aGUgYm90dG9tIG9mIHRoZSByb3V0ZSBtYXAuXG4gICAgX2JpbmRSb3V0ZXM6IGZ1bmN0aW9uKCkge1xuICAgICAgaWYgKCF0aGlzLnJvdXRlcykgcmV0dXJuO1xuICAgICAgdGhpcy5yb3V0ZXMgPSBfLnJlc3VsdCh0aGlzLCAncm91dGVzJyk7XG4gICAgICB2YXIgcm91dGUsIHJvdXRlcyA9IF8ua2V5cyh0aGlzLnJvdXRlcyk7XG4gICAgICB3aGlsZSAoKHJvdXRlID0gcm91dGVzLnBvcCgpKSAhPSBudWxsKSB7XG4gICAgICAgIHRoaXMucm91dGUocm91dGUsIHRoaXMucm91dGVzW3JvdXRlXSk7XG4gICAgICB9XG4gICAgfSxcblxuICAgIC8vIENvbnZlcnQgYSByb3V0ZSBzdHJpbmcgaW50byBhIHJlZ3VsYXIgZXhwcmVzc2lvbiwgc3VpdGFibGUgZm9yIG1hdGNoaW5nXG4gICAgLy8gYWdhaW5zdCB0aGUgY3VycmVudCBsb2NhdGlvbiBoYXNoLlxuICAgIF9yb3V0ZVRvUmVnRXhwOiBmdW5jdGlvbihyb3V0ZSkge1xuICAgICAgcm91dGUgPSByb3V0ZS5yZXBsYWNlKGVzY2FwZVJlZ0V4cCwgJ1xcXFwkJicpXG4gICAgICAgICAgICAgICAgICAgLnJlcGxhY2Uob3B0aW9uYWxQYXJhbSwgJyg/OiQxKT8nKVxuICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKG5hbWVkUGFyYW0sIGZ1bmN0aW9uKG1hdGNoLCBvcHRpb25hbCkge1xuICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9wdGlvbmFsID8gbWF0Y2ggOiAnKFteLz9dKyknO1xuICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgLnJlcGxhY2Uoc3BsYXRQYXJhbSwgJyhbXj9dKj8pJyk7XG4gICAgICByZXR1cm4gbmV3IFJlZ0V4cCgnXicgKyByb3V0ZSArICcoPzpcXFxcPyhbXFxcXHNcXFxcU10qKSk/JCcpO1xuICAgIH0sXG5cbiAgICAvLyBHaXZlbiBhIHJvdXRlLCBhbmQgYSBVUkwgZnJhZ21lbnQgdGhhdCBpdCBtYXRjaGVzLCByZXR1cm4gdGhlIGFycmF5IG9mXG4gICAgLy8gZXh0cmFjdGVkIGRlY29kZWQgcGFyYW1ldGVycy4gRW1wdHkgb3IgdW5tYXRjaGVkIHBhcmFtZXRlcnMgd2lsbCBiZVxuICAgIC8vIHRyZWF0ZWQgYXMgYG51bGxgIHRvIG5vcm1hbGl6ZSBjcm9zcy1icm93c2VyIGJlaGF2aW9yLlxuICAgIF9leHRyYWN0UGFyYW1ldGVyczogZnVuY3Rpb24ocm91dGUsIGZyYWdtZW50KSB7XG4gICAgICB2YXIgcGFyYW1zID0gcm91dGUuZXhlYyhmcmFnbWVudCkuc2xpY2UoMSk7XG4gICAgICByZXR1cm4gXy5tYXAocGFyYW1zLCBmdW5jdGlvbihwYXJhbSwgaSkge1xuICAgICAgICAvLyBEb24ndCBkZWNvZGUgdGhlIHNlYXJjaCBwYXJhbXMuXG4gICAgICAgIGlmIChpID09PSBwYXJhbXMubGVuZ3RoIC0gMSkgcmV0dXJuIHBhcmFtIHx8IG51bGw7XG4gICAgICAgIHJldHVybiBwYXJhbSA/IGRlY29kZVVSSUNvbXBvbmVudChwYXJhbSkgOiBudWxsO1xuICAgICAgfSk7XG4gICAgfVxuXG4gIH0pO1xuXG4gIC8vIEJhY2tib25lLkhpc3RvcnlcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLVxuXG4gIC8vIEhhbmRsZXMgY3Jvc3MtYnJvd3NlciBoaXN0b3J5IG1hbmFnZW1lbnQsIGJhc2VkIG9uIGVpdGhlclxuICAvLyBbcHVzaFN0YXRlXShodHRwOi8vZGl2ZWludG9odG1sNS5pbmZvL2hpc3RvcnkuaHRtbCkgYW5kIHJlYWwgVVJMcywgb3JcbiAgLy8gW29uaGFzaGNoYW5nZV0oaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9ET00vd2luZG93Lm9uaGFzaGNoYW5nZSlcbiAgLy8gYW5kIFVSTCBmcmFnbWVudHMuIElmIHRoZSBicm93c2VyIHN1cHBvcnRzIG5laXRoZXIgKG9sZCBJRSwgbmF0Y2gpLFxuICAvLyBmYWxscyBiYWNrIHRvIHBvbGxpbmcuXG4gIHZhciBIaXN0b3J5ID0gQmFja2JvbmUuSGlzdG9yeSA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuaGFuZGxlcnMgPSBbXTtcbiAgICB0aGlzLmNoZWNrVXJsID0gXy5iaW5kKHRoaXMuY2hlY2tVcmwsIHRoaXMpO1xuXG4gICAgLy8gRW5zdXJlIHRoYXQgYEhpc3RvcnlgIGNhbiBiZSB1c2VkIG91dHNpZGUgb2YgdGhlIGJyb3dzZXIuXG4gICAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICB0aGlzLmxvY2F0aW9uID0gd2luZG93LmxvY2F0aW9uO1xuICAgICAgdGhpcy5oaXN0b3J5ID0gd2luZG93Lmhpc3Rvcnk7XG4gICAgfVxuICB9O1xuXG4gIC8vIENhY2hlZCByZWdleCBmb3Igc3RyaXBwaW5nIGEgbGVhZGluZyBoYXNoL3NsYXNoIGFuZCB0cmFpbGluZyBzcGFjZS5cbiAgdmFyIHJvdXRlU3RyaXBwZXIgPSAvXlsjXFwvXXxcXHMrJC9nO1xuXG4gIC8vIENhY2hlZCByZWdleCBmb3Igc3RyaXBwaW5nIGxlYWRpbmcgYW5kIHRyYWlsaW5nIHNsYXNoZXMuXG4gIHZhciByb290U3RyaXBwZXIgPSAvXlxcLyt8XFwvKyQvZztcblxuICAvLyBDYWNoZWQgcmVnZXggZm9yIHN0cmlwcGluZyB1cmxzIG9mIGhhc2guXG4gIHZhciBwYXRoU3RyaXBwZXIgPSAvIy4qJC87XG5cbiAgLy8gSGFzIHRoZSBoaXN0b3J5IGhhbmRsaW5nIGFscmVhZHkgYmVlbiBzdGFydGVkP1xuICBIaXN0b3J5LnN0YXJ0ZWQgPSBmYWxzZTtcblxuICAvLyBTZXQgdXAgYWxsIGluaGVyaXRhYmxlICoqQmFja2JvbmUuSGlzdG9yeSoqIHByb3BlcnRpZXMgYW5kIG1ldGhvZHMuXG4gIF8uZXh0ZW5kKEhpc3RvcnkucHJvdG90eXBlLCBFdmVudHMsIHtcblxuICAgIC8vIFRoZSBkZWZhdWx0IGludGVydmFsIHRvIHBvbGwgZm9yIGhhc2ggY2hhbmdlcywgaWYgbmVjZXNzYXJ5LCBpc1xuICAgIC8vIHR3ZW50eSB0aW1lcyBhIHNlY29uZC5cbiAgICBpbnRlcnZhbDogNTAsXG5cbiAgICAvLyBBcmUgd2UgYXQgdGhlIGFwcCByb290P1xuICAgIGF0Um9vdDogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgcGF0aCA9IHRoaXMubG9jYXRpb24ucGF0aG5hbWUucmVwbGFjZSgvW15cXC9dJC8sICckJi8nKTtcbiAgICAgIHJldHVybiBwYXRoID09PSB0aGlzLnJvb3QgJiYgIXRoaXMuZ2V0U2VhcmNoKCk7XG4gICAgfSxcblxuICAgIC8vIERvZXMgdGhlIHBhdGhuYW1lIG1hdGNoIHRoZSByb290P1xuICAgIG1hdGNoUm9vdDogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgcGF0aCA9IHRoaXMuZGVjb2RlRnJhZ21lbnQodGhpcy5sb2NhdGlvbi5wYXRobmFtZSk7XG4gICAgICB2YXIgcm9vdFBhdGggPSBwYXRoLnNsaWNlKDAsIHRoaXMucm9vdC5sZW5ndGggLSAxKSArICcvJztcbiAgICAgIHJldHVybiByb290UGF0aCA9PT0gdGhpcy5yb290O1xuICAgIH0sXG5cbiAgICAvLyBVbmljb2RlIGNoYXJhY3RlcnMgaW4gYGxvY2F0aW9uLnBhdGhuYW1lYCBhcmUgcGVyY2VudCBlbmNvZGVkIHNvIHRoZXkncmVcbiAgICAvLyBkZWNvZGVkIGZvciBjb21wYXJpc29uLiBgJTI1YCBzaG91bGQgbm90IGJlIGRlY29kZWQgc2luY2UgaXQgbWF5IGJlIHBhcnRcbiAgICAvLyBvZiBhbiBlbmNvZGVkIHBhcmFtZXRlci5cbiAgICBkZWNvZGVGcmFnbWVudDogZnVuY3Rpb24oZnJhZ21lbnQpIHtcbiAgICAgIHJldHVybiBkZWNvZGVVUkkoZnJhZ21lbnQucmVwbGFjZSgvJTI1L2csICclMjUyNScpKTtcbiAgICB9LFxuXG4gICAgLy8gSW4gSUU2LCB0aGUgaGFzaCBmcmFnbWVudCBhbmQgc2VhcmNoIHBhcmFtcyBhcmUgaW5jb3JyZWN0IGlmIHRoZVxuICAgIC8vIGZyYWdtZW50IGNvbnRhaW5zIGA/YC5cbiAgICBnZXRTZWFyY2g6IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIG1hdGNoID0gdGhpcy5sb2NhdGlvbi5ocmVmLnJlcGxhY2UoLyMuKi8sICcnKS5tYXRjaCgvXFw/LisvKTtcbiAgICAgIHJldHVybiBtYXRjaCA/IG1hdGNoWzBdIDogJyc7XG4gICAgfSxcblxuICAgIC8vIEdldHMgdGhlIHRydWUgaGFzaCB2YWx1ZS4gQ2Fubm90IHVzZSBsb2NhdGlvbi5oYXNoIGRpcmVjdGx5IGR1ZSB0byBidWdcbiAgICAvLyBpbiBGaXJlZm94IHdoZXJlIGxvY2F0aW9uLmhhc2ggd2lsbCBhbHdheXMgYmUgZGVjb2RlZC5cbiAgICBnZXRIYXNoOiBmdW5jdGlvbih3aW5kb3cpIHtcbiAgICAgIHZhciBtYXRjaCA9ICh3aW5kb3cgfHwgdGhpcykubG9jYXRpb24uaHJlZi5tYXRjaCgvIyguKikkLyk7XG4gICAgICByZXR1cm4gbWF0Y2ggPyBtYXRjaFsxXSA6ICcnO1xuICAgIH0sXG5cbiAgICAvLyBHZXQgdGhlIHBhdGhuYW1lIGFuZCBzZWFyY2ggcGFyYW1zLCB3aXRob3V0IHRoZSByb290LlxuICAgIGdldFBhdGg6IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIHBhdGggPSB0aGlzLmRlY29kZUZyYWdtZW50KFxuICAgICAgICB0aGlzLmxvY2F0aW9uLnBhdGhuYW1lICsgdGhpcy5nZXRTZWFyY2goKVxuICAgICAgKS5zbGljZSh0aGlzLnJvb3QubGVuZ3RoIC0gMSk7XG4gICAgICByZXR1cm4gcGF0aC5jaGFyQXQoMCkgPT09ICcvJyA/IHBhdGguc2xpY2UoMSkgOiBwYXRoO1xuICAgIH0sXG5cbiAgICAvLyBHZXQgdGhlIGNyb3NzLWJyb3dzZXIgbm9ybWFsaXplZCBVUkwgZnJhZ21lbnQgZnJvbSB0aGUgcGF0aCBvciBoYXNoLlxuICAgIGdldEZyYWdtZW50OiBmdW5jdGlvbihmcmFnbWVudCkge1xuICAgICAgaWYgKGZyYWdtZW50ID09IG51bGwpIHtcbiAgICAgICAgaWYgKHRoaXMuX3VzZVB1c2hTdGF0ZSB8fCAhdGhpcy5fd2FudHNIYXNoQ2hhbmdlKSB7XG4gICAgICAgICAgZnJhZ21lbnQgPSB0aGlzLmdldFBhdGgoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBmcmFnbWVudCA9IHRoaXMuZ2V0SGFzaCgpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gZnJhZ21lbnQucmVwbGFjZShyb3V0ZVN0cmlwcGVyLCAnJyk7XG4gICAgfSxcblxuICAgIC8vIFN0YXJ0IHRoZSBoYXNoIGNoYW5nZSBoYW5kbGluZywgcmV0dXJuaW5nIGB0cnVlYCBpZiB0aGUgY3VycmVudCBVUkwgbWF0Y2hlc1xuICAgIC8vIGFuIGV4aXN0aW5nIHJvdXRlLCBhbmQgYGZhbHNlYCBvdGhlcndpc2UuXG4gICAgc3RhcnQ6IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICAgIGlmIChIaXN0b3J5LnN0YXJ0ZWQpIHRocm93IG5ldyBFcnJvcignQmFja2JvbmUuaGlzdG9yeSBoYXMgYWxyZWFkeSBiZWVuIHN0YXJ0ZWQnKTtcbiAgICAgIEhpc3Rvcnkuc3RhcnRlZCA9IHRydWU7XG5cbiAgICAgIC8vIEZpZ3VyZSBvdXQgdGhlIGluaXRpYWwgY29uZmlndXJhdGlvbi4gRG8gd2UgbmVlZCBhbiBpZnJhbWU/XG4gICAgICAvLyBJcyBwdXNoU3RhdGUgZGVzaXJlZCAuLi4gaXMgaXQgYXZhaWxhYmxlP1xuICAgICAgdGhpcy5vcHRpb25zICAgICAgICAgID0gXy5leHRlbmQoe3Jvb3Q6ICcvJ30sIHRoaXMub3B0aW9ucywgb3B0aW9ucyk7XG4gICAgICB0aGlzLnJvb3QgICAgICAgICAgICAgPSB0aGlzLm9wdGlvbnMucm9vdDtcbiAgICAgIHRoaXMuX3dhbnRzSGFzaENoYW5nZSA9IHRoaXMub3B0aW9ucy5oYXNoQ2hhbmdlICE9PSBmYWxzZTtcbiAgICAgIHRoaXMuX2hhc0hhc2hDaGFuZ2UgICA9ICdvbmhhc2hjaGFuZ2UnIGluIHdpbmRvdyAmJiAoZG9jdW1lbnQuZG9jdW1lbnRNb2RlID09PSB2b2lkIDAgfHwgZG9jdW1lbnQuZG9jdW1lbnRNb2RlID4gNyk7XG4gICAgICB0aGlzLl91c2VIYXNoQ2hhbmdlICAgPSB0aGlzLl93YW50c0hhc2hDaGFuZ2UgJiYgdGhpcy5faGFzSGFzaENoYW5nZTtcbiAgICAgIHRoaXMuX3dhbnRzUHVzaFN0YXRlICA9ICEhdGhpcy5vcHRpb25zLnB1c2hTdGF0ZTtcbiAgICAgIHRoaXMuX2hhc1B1c2hTdGF0ZSAgICA9ICEhKHRoaXMuaGlzdG9yeSAmJiB0aGlzLmhpc3RvcnkucHVzaFN0YXRlKTtcbiAgICAgIHRoaXMuX3VzZVB1c2hTdGF0ZSAgICA9IHRoaXMuX3dhbnRzUHVzaFN0YXRlICYmIHRoaXMuX2hhc1B1c2hTdGF0ZTtcbiAgICAgIHRoaXMuZnJhZ21lbnQgICAgICAgICA9IHRoaXMuZ2V0RnJhZ21lbnQoKTtcblxuICAgICAgLy8gTm9ybWFsaXplIHJvb3QgdG8gYWx3YXlzIGluY2x1ZGUgYSBsZWFkaW5nIGFuZCB0cmFpbGluZyBzbGFzaC5cbiAgICAgIHRoaXMucm9vdCA9ICgnLycgKyB0aGlzLnJvb3QgKyAnLycpLnJlcGxhY2Uocm9vdFN0cmlwcGVyLCAnLycpO1xuXG4gICAgICAvLyBUcmFuc2l0aW9uIGZyb20gaGFzaENoYW5nZSB0byBwdXNoU3RhdGUgb3IgdmljZSB2ZXJzYSBpZiBib3RoIGFyZVxuICAgICAgLy8gcmVxdWVzdGVkLlxuICAgICAgaWYgKHRoaXMuX3dhbnRzSGFzaENoYW5nZSAmJiB0aGlzLl93YW50c1B1c2hTdGF0ZSkge1xuXG4gICAgICAgIC8vIElmIHdlJ3ZlIHN0YXJ0ZWQgb2ZmIHdpdGggYSByb3V0ZSBmcm9tIGEgYHB1c2hTdGF0ZWAtZW5hYmxlZFxuICAgICAgICAvLyBicm93c2VyLCBidXQgd2UncmUgY3VycmVudGx5IGluIGEgYnJvd3NlciB0aGF0IGRvZXNuJ3Qgc3VwcG9ydCBpdC4uLlxuICAgICAgICBpZiAoIXRoaXMuX2hhc1B1c2hTdGF0ZSAmJiAhdGhpcy5hdFJvb3QoKSkge1xuICAgICAgICAgIHZhciByb290UGF0aCA9IHRoaXMucm9vdC5zbGljZSgwLCAtMSkgfHwgJy8nO1xuICAgICAgICAgIHRoaXMubG9jYXRpb24ucmVwbGFjZShyb290UGF0aCArICcjJyArIHRoaXMuZ2V0UGF0aCgpKTtcbiAgICAgICAgICAvLyBSZXR1cm4gaW1tZWRpYXRlbHkgYXMgYnJvd3NlciB3aWxsIGRvIHJlZGlyZWN0IHRvIG5ldyB1cmxcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcblxuICAgICAgICAvLyBPciBpZiB3ZSd2ZSBzdGFydGVkIG91dCB3aXRoIGEgaGFzaC1iYXNlZCByb3V0ZSwgYnV0IHdlJ3JlIGN1cnJlbnRseVxuICAgICAgICAvLyBpbiBhIGJyb3dzZXIgd2hlcmUgaXQgY291bGQgYmUgYHB1c2hTdGF0ZWAtYmFzZWQgaW5zdGVhZC4uLlxuICAgICAgICB9IGVsc2UgaWYgKHRoaXMuX2hhc1B1c2hTdGF0ZSAmJiB0aGlzLmF0Um9vdCgpKSB7XG4gICAgICAgICAgdGhpcy5uYXZpZ2F0ZSh0aGlzLmdldEhhc2goKSwge3JlcGxhY2U6IHRydWV9KTtcbiAgICAgICAgfVxuXG4gICAgICB9XG5cbiAgICAgIC8vIFByb3h5IGFuIGlmcmFtZSB0byBoYW5kbGUgbG9jYXRpb24gZXZlbnRzIGlmIHRoZSBicm93c2VyIGRvZXNuJ3RcbiAgICAgIC8vIHN1cHBvcnQgdGhlIGBoYXNoY2hhbmdlYCBldmVudCwgSFRNTDUgaGlzdG9yeSwgb3IgdGhlIHVzZXIgd2FudHNcbiAgICAgIC8vIGBoYXNoQ2hhbmdlYCBidXQgbm90IGBwdXNoU3RhdGVgLlxuICAgICAgaWYgKCF0aGlzLl9oYXNIYXNoQ2hhbmdlICYmIHRoaXMuX3dhbnRzSGFzaENoYW5nZSAmJiAhdGhpcy5fdXNlUHVzaFN0YXRlKSB7XG4gICAgICAgIHRoaXMuaWZyYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaWZyYW1lJyk7XG4gICAgICAgIHRoaXMuaWZyYW1lLnNyYyA9ICdqYXZhc2NyaXB0OjAnO1xuICAgICAgICB0aGlzLmlmcmFtZS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICAgICAgICB0aGlzLmlmcmFtZS50YWJJbmRleCA9IC0xO1xuICAgICAgICB2YXIgYm9keSA9IGRvY3VtZW50LmJvZHk7XG4gICAgICAgIC8vIFVzaW5nIGBhcHBlbmRDaGlsZGAgd2lsbCB0aHJvdyBvbiBJRSA8IDkgaWYgdGhlIGRvY3VtZW50IGlzIG5vdCByZWFkeS5cbiAgICAgICAgdmFyIGlXaW5kb3cgPSBib2R5Lmluc2VydEJlZm9yZSh0aGlzLmlmcmFtZSwgYm9keS5maXJzdENoaWxkKS5jb250ZW50V2luZG93O1xuICAgICAgICBpV2luZG93LmRvY3VtZW50Lm9wZW4oKTtcbiAgICAgICAgaVdpbmRvdy5kb2N1bWVudC5jbG9zZSgpO1xuICAgICAgICBpV2luZG93LmxvY2F0aW9uLmhhc2ggPSAnIycgKyB0aGlzLmZyYWdtZW50O1xuICAgICAgfVxuXG4gICAgICAvLyBBZGQgYSBjcm9zcy1wbGF0Zm9ybSBgYWRkRXZlbnRMaXN0ZW5lcmAgc2hpbSBmb3Igb2xkZXIgYnJvd3NlcnMuXG4gICAgICB2YXIgYWRkRXZlbnRMaXN0ZW5lciA9IHdpbmRvdy5hZGRFdmVudExpc3RlbmVyIHx8IGZ1bmN0aW9uKGV2ZW50TmFtZSwgbGlzdGVuZXIpIHtcbiAgICAgICAgcmV0dXJuIGF0dGFjaEV2ZW50KCdvbicgKyBldmVudE5hbWUsIGxpc3RlbmVyKTtcbiAgICAgIH07XG5cbiAgICAgIC8vIERlcGVuZGluZyBvbiB3aGV0aGVyIHdlJ3JlIHVzaW5nIHB1c2hTdGF0ZSBvciBoYXNoZXMsIGFuZCB3aGV0aGVyXG4gICAgICAvLyAnb25oYXNoY2hhbmdlJyBpcyBzdXBwb3J0ZWQsIGRldGVybWluZSBob3cgd2UgY2hlY2sgdGhlIFVSTCBzdGF0ZS5cbiAgICAgIGlmICh0aGlzLl91c2VQdXNoU3RhdGUpIHtcbiAgICAgICAgYWRkRXZlbnRMaXN0ZW5lcigncG9wc3RhdGUnLCB0aGlzLmNoZWNrVXJsLCBmYWxzZSk7XG4gICAgICB9IGVsc2UgaWYgKHRoaXMuX3VzZUhhc2hDaGFuZ2UgJiYgIXRoaXMuaWZyYW1lKSB7XG4gICAgICAgIGFkZEV2ZW50TGlzdGVuZXIoJ2hhc2hjaGFuZ2UnLCB0aGlzLmNoZWNrVXJsLCBmYWxzZSk7XG4gICAgICB9IGVsc2UgaWYgKHRoaXMuX3dhbnRzSGFzaENoYW5nZSkge1xuICAgICAgICB0aGlzLl9jaGVja1VybEludGVydmFsID0gc2V0SW50ZXJ2YWwodGhpcy5jaGVja1VybCwgdGhpcy5pbnRlcnZhbCk7XG4gICAgICB9XG5cbiAgICAgIGlmICghdGhpcy5vcHRpb25zLnNpbGVudCkgcmV0dXJuIHRoaXMubG9hZFVybCgpO1xuICAgIH0sXG5cbiAgICAvLyBEaXNhYmxlIEJhY2tib25lLmhpc3RvcnksIHBlcmhhcHMgdGVtcG9yYXJpbHkuIE5vdCB1c2VmdWwgaW4gYSByZWFsIGFwcCxcbiAgICAvLyBidXQgcG9zc2libHkgdXNlZnVsIGZvciB1bml0IHRlc3RpbmcgUm91dGVycy5cbiAgICBzdG9wOiBmdW5jdGlvbigpIHtcbiAgICAgIC8vIEFkZCBhIGNyb3NzLXBsYXRmb3JtIGByZW1vdmVFdmVudExpc3RlbmVyYCBzaGltIGZvciBvbGRlciBicm93c2Vycy5cbiAgICAgIHZhciByZW1vdmVFdmVudExpc3RlbmVyID0gd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIgfHwgZnVuY3Rpb24oZXZlbnROYW1lLCBsaXN0ZW5lcikge1xuICAgICAgICByZXR1cm4gZGV0YWNoRXZlbnQoJ29uJyArIGV2ZW50TmFtZSwgbGlzdGVuZXIpO1xuICAgICAgfTtcblxuICAgICAgLy8gUmVtb3ZlIHdpbmRvdyBsaXN0ZW5lcnMuXG4gICAgICBpZiAodGhpcy5fdXNlUHVzaFN0YXRlKSB7XG4gICAgICAgIHJlbW92ZUV2ZW50TGlzdGVuZXIoJ3BvcHN0YXRlJywgdGhpcy5jaGVja1VybCwgZmFsc2UpO1xuICAgICAgfSBlbHNlIGlmICh0aGlzLl91c2VIYXNoQ2hhbmdlICYmICF0aGlzLmlmcmFtZSkge1xuICAgICAgICByZW1vdmVFdmVudExpc3RlbmVyKCdoYXNoY2hhbmdlJywgdGhpcy5jaGVja1VybCwgZmFsc2UpO1xuICAgICAgfVxuXG4gICAgICAvLyBDbGVhbiB1cCB0aGUgaWZyYW1lIGlmIG5lY2Vzc2FyeS5cbiAgICAgIGlmICh0aGlzLmlmcmFtZSkge1xuICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKHRoaXMuaWZyYW1lKTtcbiAgICAgICAgdGhpcy5pZnJhbWUgPSBudWxsO1xuICAgICAgfVxuXG4gICAgICAvLyBTb21lIGVudmlyb25tZW50cyB3aWxsIHRocm93IHdoZW4gY2xlYXJpbmcgYW4gdW5kZWZpbmVkIGludGVydmFsLlxuICAgICAgaWYgKHRoaXMuX2NoZWNrVXJsSW50ZXJ2YWwpIGNsZWFySW50ZXJ2YWwodGhpcy5fY2hlY2tVcmxJbnRlcnZhbCk7XG4gICAgICBIaXN0b3J5LnN0YXJ0ZWQgPSBmYWxzZTtcbiAgICB9LFxuXG4gICAgLy8gQWRkIGEgcm91dGUgdG8gYmUgdGVzdGVkIHdoZW4gdGhlIGZyYWdtZW50IGNoYW5nZXMuIFJvdXRlcyBhZGRlZCBsYXRlclxuICAgIC8vIG1heSBvdmVycmlkZSBwcmV2aW91cyByb3V0ZXMuXG4gICAgcm91dGU6IGZ1bmN0aW9uKHJvdXRlLCBjYWxsYmFjaykge1xuICAgICAgdGhpcy5oYW5kbGVycy51bnNoaWZ0KHtyb3V0ZTogcm91dGUsIGNhbGxiYWNrOiBjYWxsYmFja30pO1xuICAgIH0sXG5cbiAgICAvLyBDaGVja3MgdGhlIGN1cnJlbnQgVVJMIHRvIHNlZSBpZiBpdCBoYXMgY2hhbmdlZCwgYW5kIGlmIGl0IGhhcyxcbiAgICAvLyBjYWxscyBgbG9hZFVybGAsIG5vcm1hbGl6aW5nIGFjcm9zcyB0aGUgaGlkZGVuIGlmcmFtZS5cbiAgICBjaGVja1VybDogZnVuY3Rpb24oZSkge1xuICAgICAgdmFyIGN1cnJlbnQgPSB0aGlzLmdldEZyYWdtZW50KCk7XG5cbiAgICAgIC8vIElmIHRoZSB1c2VyIHByZXNzZWQgdGhlIGJhY2sgYnV0dG9uLCB0aGUgaWZyYW1lJ3MgaGFzaCB3aWxsIGhhdmVcbiAgICAgIC8vIGNoYW5nZWQgYW5kIHdlIHNob3VsZCB1c2UgdGhhdCBmb3IgY29tcGFyaXNvbi5cbiAgICAgIGlmIChjdXJyZW50ID09PSB0aGlzLmZyYWdtZW50ICYmIHRoaXMuaWZyYW1lKSB7XG4gICAgICAgIGN1cnJlbnQgPSB0aGlzLmdldEhhc2godGhpcy5pZnJhbWUuY29udGVudFdpbmRvdyk7XG4gICAgICB9XG5cbiAgICAgIGlmIChjdXJyZW50ID09PSB0aGlzLmZyYWdtZW50KSByZXR1cm4gZmFsc2U7XG4gICAgICBpZiAodGhpcy5pZnJhbWUpIHRoaXMubmF2aWdhdGUoY3VycmVudCk7XG4gICAgICB0aGlzLmxvYWRVcmwoKTtcbiAgICB9LFxuXG4gICAgLy8gQXR0ZW1wdCB0byBsb2FkIHRoZSBjdXJyZW50IFVSTCBmcmFnbWVudC4gSWYgYSByb3V0ZSBzdWNjZWVkcyB3aXRoIGFcbiAgICAvLyBtYXRjaCwgcmV0dXJucyBgdHJ1ZWAuIElmIG5vIGRlZmluZWQgcm91dGVzIG1hdGNoZXMgdGhlIGZyYWdtZW50LFxuICAgIC8vIHJldHVybnMgYGZhbHNlYC5cbiAgICBsb2FkVXJsOiBmdW5jdGlvbihmcmFnbWVudCkge1xuICAgICAgLy8gSWYgdGhlIHJvb3QgZG9lc24ndCBtYXRjaCwgbm8gcm91dGVzIGNhbiBtYXRjaCBlaXRoZXIuXG4gICAgICBpZiAoIXRoaXMubWF0Y2hSb290KCkpIHJldHVybiBmYWxzZTtcbiAgICAgIGZyYWdtZW50ID0gdGhpcy5mcmFnbWVudCA9IHRoaXMuZ2V0RnJhZ21lbnQoZnJhZ21lbnQpO1xuICAgICAgcmV0dXJuIF8uc29tZSh0aGlzLmhhbmRsZXJzLCBmdW5jdGlvbihoYW5kbGVyKSB7XG4gICAgICAgIGlmIChoYW5kbGVyLnJvdXRlLnRlc3QoZnJhZ21lbnQpKSB7XG4gICAgICAgICAgaGFuZGxlci5jYWxsYmFjayhmcmFnbWVudCk7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvLyBTYXZlIGEgZnJhZ21lbnQgaW50byB0aGUgaGFzaCBoaXN0b3J5LCBvciByZXBsYWNlIHRoZSBVUkwgc3RhdGUgaWYgdGhlXG4gICAgLy8gJ3JlcGxhY2UnIG9wdGlvbiBpcyBwYXNzZWQuIFlvdSBhcmUgcmVzcG9uc2libGUgZm9yIHByb3Blcmx5IFVSTC1lbmNvZGluZ1xuICAgIC8vIHRoZSBmcmFnbWVudCBpbiBhZHZhbmNlLlxuICAgIC8vXG4gICAgLy8gVGhlIG9wdGlvbnMgb2JqZWN0IGNhbiBjb250YWluIGB0cmlnZ2VyOiB0cnVlYCBpZiB5b3Ugd2lzaCB0byBoYXZlIHRoZVxuICAgIC8vIHJvdXRlIGNhbGxiYWNrIGJlIGZpcmVkIChub3QgdXN1YWxseSBkZXNpcmFibGUpLCBvciBgcmVwbGFjZTogdHJ1ZWAsIGlmXG4gICAgLy8geW91IHdpc2ggdG8gbW9kaWZ5IHRoZSBjdXJyZW50IFVSTCB3aXRob3V0IGFkZGluZyBhbiBlbnRyeSB0byB0aGUgaGlzdG9yeS5cbiAgICBuYXZpZ2F0ZTogZnVuY3Rpb24oZnJhZ21lbnQsIG9wdGlvbnMpIHtcbiAgICAgIGlmICghSGlzdG9yeS5zdGFydGVkKSByZXR1cm4gZmFsc2U7XG4gICAgICBpZiAoIW9wdGlvbnMgfHwgb3B0aW9ucyA9PT0gdHJ1ZSkgb3B0aW9ucyA9IHt0cmlnZ2VyOiAhIW9wdGlvbnN9O1xuXG4gICAgICAvLyBOb3JtYWxpemUgdGhlIGZyYWdtZW50LlxuICAgICAgZnJhZ21lbnQgPSB0aGlzLmdldEZyYWdtZW50KGZyYWdtZW50IHx8ICcnKTtcblxuICAgICAgLy8gRG9uJ3QgaW5jbHVkZSBhIHRyYWlsaW5nIHNsYXNoIG9uIHRoZSByb290LlxuICAgICAgdmFyIHJvb3RQYXRoID0gdGhpcy5yb290O1xuICAgICAgaWYgKGZyYWdtZW50ID09PSAnJyB8fCBmcmFnbWVudC5jaGFyQXQoMCkgPT09ICc/Jykge1xuICAgICAgICByb290UGF0aCA9IHJvb3RQYXRoLnNsaWNlKDAsIC0xKSB8fCAnLyc7XG4gICAgICB9XG4gICAgICB2YXIgdXJsID0gcm9vdFBhdGggKyBmcmFnbWVudDtcblxuICAgICAgLy8gU3RyaXAgdGhlIGhhc2ggYW5kIGRlY29kZSBmb3IgbWF0Y2hpbmcuXG4gICAgICBmcmFnbWVudCA9IHRoaXMuZGVjb2RlRnJhZ21lbnQoZnJhZ21lbnQucmVwbGFjZShwYXRoU3RyaXBwZXIsICcnKSk7XG5cbiAgICAgIGlmICh0aGlzLmZyYWdtZW50ID09PSBmcmFnbWVudCkgcmV0dXJuO1xuICAgICAgdGhpcy5mcmFnbWVudCA9IGZyYWdtZW50O1xuXG4gICAgICAvLyBJZiBwdXNoU3RhdGUgaXMgYXZhaWxhYmxlLCB3ZSB1c2UgaXQgdG8gc2V0IHRoZSBmcmFnbWVudCBhcyBhIHJlYWwgVVJMLlxuICAgICAgaWYgKHRoaXMuX3VzZVB1c2hTdGF0ZSkge1xuICAgICAgICB0aGlzLmhpc3Rvcnlbb3B0aW9ucy5yZXBsYWNlID8gJ3JlcGxhY2VTdGF0ZScgOiAncHVzaFN0YXRlJ10oe30sIGRvY3VtZW50LnRpdGxlLCB1cmwpO1xuXG4gICAgICAvLyBJZiBoYXNoIGNoYW5nZXMgaGF2ZW4ndCBiZWVuIGV4cGxpY2l0bHkgZGlzYWJsZWQsIHVwZGF0ZSB0aGUgaGFzaFxuICAgICAgLy8gZnJhZ21lbnQgdG8gc3RvcmUgaGlzdG9yeS5cbiAgICAgIH0gZWxzZSBpZiAodGhpcy5fd2FudHNIYXNoQ2hhbmdlKSB7XG4gICAgICAgIHRoaXMuX3VwZGF0ZUhhc2godGhpcy5sb2NhdGlvbiwgZnJhZ21lbnQsIG9wdGlvbnMucmVwbGFjZSk7XG4gICAgICAgIGlmICh0aGlzLmlmcmFtZSAmJiBmcmFnbWVudCAhPT0gdGhpcy5nZXRIYXNoKHRoaXMuaWZyYW1lLmNvbnRlbnRXaW5kb3cpKSB7XG4gICAgICAgICAgdmFyIGlXaW5kb3cgPSB0aGlzLmlmcmFtZS5jb250ZW50V2luZG93O1xuXG4gICAgICAgICAgLy8gT3BlbmluZyBhbmQgY2xvc2luZyB0aGUgaWZyYW1lIHRyaWNrcyBJRTcgYW5kIGVhcmxpZXIgdG8gcHVzaCBhXG4gICAgICAgICAgLy8gaGlzdG9yeSBlbnRyeSBvbiBoYXNoLXRhZyBjaGFuZ2UuICBXaGVuIHJlcGxhY2UgaXMgdHJ1ZSwgd2UgZG9uJ3RcbiAgICAgICAgICAvLyB3YW50IHRoaXMuXG4gICAgICAgICAgaWYgKCFvcHRpb25zLnJlcGxhY2UpIHtcbiAgICAgICAgICAgIGlXaW5kb3cuZG9jdW1lbnQub3BlbigpO1xuICAgICAgICAgICAgaVdpbmRvdy5kb2N1bWVudC5jbG9zZSgpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHRoaXMuX3VwZGF0ZUhhc2goaVdpbmRvdy5sb2NhdGlvbiwgZnJhZ21lbnQsIG9wdGlvbnMucmVwbGFjZSk7XG4gICAgICAgIH1cblxuICAgICAgLy8gSWYgeW91J3ZlIHRvbGQgdXMgdGhhdCB5b3UgZXhwbGljaXRseSBkb24ndCB3YW50IGZhbGxiYWNrIGhhc2hjaGFuZ2UtXG4gICAgICAvLyBiYXNlZCBoaXN0b3J5LCB0aGVuIGBuYXZpZ2F0ZWAgYmVjb21lcyBhIHBhZ2UgcmVmcmVzaC5cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiB0aGlzLmxvY2F0aW9uLmFzc2lnbih1cmwpO1xuICAgICAgfVxuICAgICAgaWYgKG9wdGlvbnMudHJpZ2dlcikgcmV0dXJuIHRoaXMubG9hZFVybChmcmFnbWVudCk7XG4gICAgfSxcblxuICAgIC8vIFVwZGF0ZSB0aGUgaGFzaCBsb2NhdGlvbiwgZWl0aGVyIHJlcGxhY2luZyB0aGUgY3VycmVudCBlbnRyeSwgb3IgYWRkaW5nXG4gICAgLy8gYSBuZXcgb25lIHRvIHRoZSBicm93c2VyIGhpc3RvcnkuXG4gICAgX3VwZGF0ZUhhc2g6IGZ1bmN0aW9uKGxvY2F0aW9uLCBmcmFnbWVudCwgcmVwbGFjZSkge1xuICAgICAgaWYgKHJlcGxhY2UpIHtcbiAgICAgICAgdmFyIGhyZWYgPSBsb2NhdGlvbi5ocmVmLnJlcGxhY2UoLyhqYXZhc2NyaXB0OnwjKS4qJC8sICcnKTtcbiAgICAgICAgbG9jYXRpb24ucmVwbGFjZShocmVmICsgJyMnICsgZnJhZ21lbnQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gU29tZSBicm93c2VycyByZXF1aXJlIHRoYXQgYGhhc2hgIGNvbnRhaW5zIGEgbGVhZGluZyAjLlxuICAgICAgICBsb2NhdGlvbi5oYXNoID0gJyMnICsgZnJhZ21lbnQ7XG4gICAgICB9XG4gICAgfVxuXG4gIH0pO1xuXG4gIC8vIENyZWF0ZSB0aGUgZGVmYXVsdCBCYWNrYm9uZS5oaXN0b3J5LlxuICBCYWNrYm9uZS5oaXN0b3J5ID0gbmV3IEhpc3Rvcnk7XG5cbiAgLy8gSGVscGVyc1xuICAvLyAtLS0tLS0tXG5cbiAgLy8gSGVscGVyIGZ1bmN0aW9uIHRvIGNvcnJlY3RseSBzZXQgdXAgdGhlIHByb3RvdHlwZSBjaGFpbiBmb3Igc3ViY2xhc3Nlcy5cbiAgLy8gU2ltaWxhciB0byBgZ29vZy5pbmhlcml0c2AsIGJ1dCB1c2VzIGEgaGFzaCBvZiBwcm90b3R5cGUgcHJvcGVydGllcyBhbmRcbiAgLy8gY2xhc3MgcHJvcGVydGllcyB0byBiZSBleHRlbmRlZC5cbiAgdmFyIGV4dGVuZCA9IGZ1bmN0aW9uKHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7XG4gICAgdmFyIHBhcmVudCA9IHRoaXM7XG4gICAgdmFyIGNoaWxkO1xuXG4gICAgLy8gVGhlIGNvbnN0cnVjdG9yIGZ1bmN0aW9uIGZvciB0aGUgbmV3IHN1YmNsYXNzIGlzIGVpdGhlciBkZWZpbmVkIGJ5IHlvdVxuICAgIC8vICh0aGUgXCJjb25zdHJ1Y3RvclwiIHByb3BlcnR5IGluIHlvdXIgYGV4dGVuZGAgZGVmaW5pdGlvbiksIG9yIGRlZmF1bHRlZFxuICAgIC8vIGJ5IHVzIHRvIHNpbXBseSBjYWxsIHRoZSBwYXJlbnQgY29uc3RydWN0b3IuXG4gICAgaWYgKHByb3RvUHJvcHMgJiYgXy5oYXMocHJvdG9Qcm9wcywgJ2NvbnN0cnVjdG9yJykpIHtcbiAgICAgIGNoaWxkID0gcHJvdG9Qcm9wcy5jb25zdHJ1Y3RvcjtcbiAgICB9IGVsc2Uge1xuICAgICAgY2hpbGQgPSBmdW5jdGlvbigpeyByZXR1cm4gcGFyZW50LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7IH07XG4gICAgfVxuXG4gICAgLy8gQWRkIHN0YXRpYyBwcm9wZXJ0aWVzIHRvIHRoZSBjb25zdHJ1Y3RvciBmdW5jdGlvbiwgaWYgc3VwcGxpZWQuXG4gICAgXy5leHRlbmQoY2hpbGQsIHBhcmVudCwgc3RhdGljUHJvcHMpO1xuXG4gICAgLy8gU2V0IHRoZSBwcm90b3R5cGUgY2hhaW4gdG8gaW5oZXJpdCBmcm9tIGBwYXJlbnRgLCB3aXRob3V0IGNhbGxpbmdcbiAgICAvLyBgcGFyZW50YCdzIGNvbnN0cnVjdG9yIGZ1bmN0aW9uIGFuZCBhZGQgdGhlIHByb3RvdHlwZSBwcm9wZXJ0aWVzLlxuICAgIGNoaWxkLnByb3RvdHlwZSA9IF8uY3JlYXRlKHBhcmVudC5wcm90b3R5cGUsIHByb3RvUHJvcHMpO1xuICAgIGNoaWxkLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IGNoaWxkO1xuXG4gICAgLy8gU2V0IGEgY29udmVuaWVuY2UgcHJvcGVydHkgaW4gY2FzZSB0aGUgcGFyZW50J3MgcHJvdG90eXBlIGlzIG5lZWRlZFxuICAgIC8vIGxhdGVyLlxuICAgIGNoaWxkLl9fc3VwZXJfXyA9IHBhcmVudC5wcm90b3R5cGU7XG5cbiAgICByZXR1cm4gY2hpbGQ7XG4gIH07XG5cbiAgLy8gU2V0IHVwIGluaGVyaXRhbmNlIGZvciB0aGUgbW9kZWwsIGNvbGxlY3Rpb24sIHJvdXRlciwgdmlldyBhbmQgaGlzdG9yeS5cbiAgTW9kZWwuZXh0ZW5kID0gQ29sbGVjdGlvbi5leHRlbmQgPSBSb3V0ZXIuZXh0ZW5kID0gVmlldy5leHRlbmQgPSBIaXN0b3J5LmV4dGVuZCA9IGV4dGVuZDtcblxuICAvLyBUaHJvdyBhbiBlcnJvciB3aGVuIGEgVVJMIGlzIG5lZWRlZCwgYW5kIG5vbmUgaXMgc3VwcGxpZWQuXG4gIHZhciB1cmxFcnJvciA9IGZ1bmN0aW9uKCkge1xuICAgIHRocm93IG5ldyBFcnJvcignQSBcInVybFwiIHByb3BlcnR5IG9yIGZ1bmN0aW9uIG11c3QgYmUgc3BlY2lmaWVkJyk7XG4gIH07XG5cbiAgLy8gV3JhcCBhbiBvcHRpb25hbCBlcnJvciBjYWxsYmFjayB3aXRoIGEgZmFsbGJhY2sgZXJyb3IgZXZlbnQuXG4gIHZhciB3cmFwRXJyb3IgPSBmdW5jdGlvbihtb2RlbCwgb3B0aW9ucykge1xuICAgIHZhciBlcnJvciA9IG9wdGlvbnMuZXJyb3I7XG4gICAgb3B0aW9ucy5lcnJvciA9IGZ1bmN0aW9uKHJlc3ApIHtcbiAgICAgIGlmIChlcnJvcikgZXJyb3IuY2FsbChvcHRpb25zLmNvbnRleHQsIG1vZGVsLCByZXNwLCBvcHRpb25zKTtcbiAgICAgIG1vZGVsLnRyaWdnZXIoJ2Vycm9yJywgbW9kZWwsIHJlc3AsIG9wdGlvbnMpO1xuICAgIH07XG4gIH07XG5cbiAgcmV0dXJuIEJhY2tib25lO1xufSk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBLHNCQVFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0EiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///1858b45bf48591489d06\n");

/***/ }),

/***/ "20a5662e33e2c3e5a9d8":
/*!*********************************************************!*\
  !*** ./src/Apps/DOCUMENT/IHM/widgets/window/wWindow.js ***!
  \*********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(/*! underscore */ \"8e08e542008e4aef1f58\"), __webpack_require__(/*! jquery */ \"127c8cf59f228bb01a21\"), __webpack_require__(/*! dcpDocument/widgets/widget */ \"f562ab9f022eef93542c\")], __WEBPACK_AMD_DEFINE_RESULT__ = (function wWindow(\n  _,\n  $\n) {\n  \"use strict\";\n\n  $.widget(\"dcp.dcpWindow\", {\n    intervalId: 0,\n    options: {\n      animation: {\n        open: {\n          effects: \"fade:in\",\n          duration: 1000\n        },\n        close: {\n          effects: \"fade:out\",\n          duration: 1000\n        }\n      },\n      actions: [\"Maximize\", \"Close\"],\n      visible: false,\n      height: \"300px\",\n      width: \"400px\",\n      /**\n       * Try to add iframe title if no title is set\n       */\n      open: function wWindowOpen() {\n        if (!this.options.title) {\n          try {\n            var kendoWindow = this;\n            var iframeTitle = this.element\n              .find(\"iframe\")\n              .contents()\n              .find(\"title\")\n              .html();\n            if (typeof iframeTitle === \"undefined\") {\n              _.defer(function wWindowOpenSetTitle() {\n                var currentTitle = \"\";\n                var $content = kendoWindow.element.find(\"iframe\").contents();\n                kendoWindow.element\n                  .find(\"iframe\")\n                  .on(\"load\", function wWindowOpenSetTitleNow() {\n                    try {\n                      var $scopeWindow = $(this);\n                      var $content = $scopeWindow.contents();\n\n                      kendoWindow.setOptions({\n                        title: currentTitle\n                      });\n                      $content.find(\"body\").addClass(\"window-dialog\");\n                    } catch (exp) {\n                      //no test here\n                    }\n                  });\n\n                // Verify if need to change title every seconds\n                kendoWindow.intervalId = window.setInterval(\n                  function wWindowOpenSetTitleIsChanged() {\n                    try {\n                      $content = kendoWindow.element.find(\"iframe\").contents();\n                      var newTitle = $content.find(\"title\").html();\n                      var currentIcon = $content\n                        .find('link[rel=\"shortcut icon\"]')\n                        .attr(\"href\");\n\n                      if (newTitle) {\n                        $content.find(\"body\").addClass(\"window-dialog\");\n                        if (currentIcon) {\n                          newTitle =\n                            '<img src=\"' + currentIcon + '\" /> ' + newTitle;\n                        }\n                        if (newTitle !== currentTitle) {\n                          currentTitle = newTitle;\n                          $(kendoWindow.element)\n                            .closest(\".k-window\")\n                            .find(\".k-window-title\")\n                            .html(newTitle);\n                        }\n                      }\n                    } catch (exp) {\n                      //no test here\n                    }\n                  },\n                  1000\n                );\n              });\n            } else {\n              kendoWindow.setOptions({\n                title: $(this)\n                  .contents()\n                  .find(\"title\")\n                  .html()\n              });\n            }\n          } catch (exp) {\n            //no test here\n          }\n        }\n      },\n      close: function wWindowClose() {\n        window.clearInterval(this.intervalId);\n      },\n      destroy: function wWindowDestroy() {\n        window.clearInterval(this.intervalId);\n      }\n    },\n\n    currentWidget: null,\n    _create: function wWindowCreate() {\n      this.currentWidget = $('<div class=\"dialog-window\"/>');\n      this.element.append(this.currentWidget);\n      this.element.data(\"dcpWindow\", this);\n\n      this.currentWidget.kendoWindow(this.options);\n    },\n\n    _getWindowTemplate: function wWindowCreate_getWindowTemplate(templateId) {\n      if (\n        this.options.templateData &&\n        this.options.templateData.templates &&\n        this.options.templateData.templates.window &&\n        this.options.templateData.templates.window[templateId]\n      ) {\n        return this.options.templateData.templates.window[templateId];\n      }\n      if (\n        window.dcp &&\n        window.dcp.templates &&\n        window.dcp.templates.window &&\n        window.dcp.templates.window[templateId]\n      ) {\n        return window.dcp.templates.window[templateId];\n      }\n      throw new Error(\"Unknown window template  \" + templateId);\n    },\n    destroy: function wWindowDestroy() {\n      window.clearInterval(this.intervalId);\n      if (this.currentWidget && this.currentWidget.data(\"kendoWindow\")) {\n        this.currentWidget.data(\"kendoWindow\").destroy();\n      }\n      this._super();\n    },\n    open: function wWindowopen() {\n      this.currentWidget.data(\"kendoWindow\").open();\n    },\n    close: function wWindowClose() {\n      window.clearInterval(this.intervalId);\n      this.currentWidget.data(\"kendoWindow\").close();\n    },\n    kendoWindow: function wWindowkendoWindow() {\n      return this.currentWidget.data(\"kendoWindow\");\n    }\n  });\n}).apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjBhNTY2MmUzM2UyYzNlNWE5ZDguanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvQXBwcy9ET0NVTUVOVC9JSE0vd2lkZ2V0cy93aW5kb3cvd1dpbmRvdy5qcz82ODM4Il0sInNvdXJjZXNDb250ZW50IjpbImRlZmluZShbXCJ1bmRlcnNjb3JlXCIsIFwianF1ZXJ5XCIsIFwiZGNwRG9jdW1lbnQvd2lkZ2V0cy93aWRnZXRcIl0sIGZ1bmN0aW9uIHdXaW5kb3coXG4gIF8sXG4gICRcbikge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICAkLndpZGdldChcImRjcC5kY3BXaW5kb3dcIiwge1xuICAgIGludGVydmFsSWQ6IDAsXG4gICAgb3B0aW9uczoge1xuICAgICAgYW5pbWF0aW9uOiB7XG4gICAgICAgIG9wZW46IHtcbiAgICAgICAgICBlZmZlY3RzOiBcImZhZGU6aW5cIixcbiAgICAgICAgICBkdXJhdGlvbjogMTAwMFxuICAgICAgICB9LFxuICAgICAgICBjbG9zZToge1xuICAgICAgICAgIGVmZmVjdHM6IFwiZmFkZTpvdXRcIixcbiAgICAgICAgICBkdXJhdGlvbjogMTAwMFxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgYWN0aW9uczogW1wiTWF4aW1pemVcIiwgXCJDbG9zZVwiXSxcbiAgICAgIHZpc2libGU6IGZhbHNlLFxuICAgICAgaGVpZ2h0OiBcIjMwMHB4XCIsXG4gICAgICB3aWR0aDogXCI0MDBweFwiLFxuICAgICAgLyoqXG4gICAgICAgKiBUcnkgdG8gYWRkIGlmcmFtZSB0aXRsZSBpZiBubyB0aXRsZSBpcyBzZXRcbiAgICAgICAqL1xuICAgICAgb3BlbjogZnVuY3Rpb24gd1dpbmRvd09wZW4oKSB7XG4gICAgICAgIGlmICghdGhpcy5vcHRpb25zLnRpdGxlKSB7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHZhciBrZW5kb1dpbmRvdyA9IHRoaXM7XG4gICAgICAgICAgICB2YXIgaWZyYW1lVGl0bGUgPSB0aGlzLmVsZW1lbnRcbiAgICAgICAgICAgICAgLmZpbmQoXCJpZnJhbWVcIilcbiAgICAgICAgICAgICAgLmNvbnRlbnRzKClcbiAgICAgICAgICAgICAgLmZpbmQoXCJ0aXRsZVwiKVxuICAgICAgICAgICAgICAuaHRtbCgpO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBpZnJhbWVUaXRsZSA9PT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgICAgICAgICBfLmRlZmVyKGZ1bmN0aW9uIHdXaW5kb3dPcGVuU2V0VGl0bGUoKSB7XG4gICAgICAgICAgICAgICAgdmFyIGN1cnJlbnRUaXRsZSA9IFwiXCI7XG4gICAgICAgICAgICAgICAgdmFyICRjb250ZW50ID0ga2VuZG9XaW5kb3cuZWxlbWVudC5maW5kKFwiaWZyYW1lXCIpLmNvbnRlbnRzKCk7XG4gICAgICAgICAgICAgICAga2VuZG9XaW5kb3cuZWxlbWVudFxuICAgICAgICAgICAgICAgICAgLmZpbmQoXCJpZnJhbWVcIilcbiAgICAgICAgICAgICAgICAgIC5vbihcImxvYWRcIiwgZnVuY3Rpb24gd1dpbmRvd09wZW5TZXRUaXRsZU5vdygpIHtcbiAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICB2YXIgJHNjb3BlV2luZG93ID0gJCh0aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgICB2YXIgJGNvbnRlbnQgPSAkc2NvcGVXaW5kb3cuY29udGVudHMoKTtcblxuICAgICAgICAgICAgICAgICAgICAgIGtlbmRvV2luZG93LnNldE9wdGlvbnMoe1xuICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IGN1cnJlbnRUaXRsZVxuICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICRjb250ZW50LmZpbmQoXCJib2R5XCIpLmFkZENsYXNzKFwid2luZG93LWRpYWxvZ1wiKTtcbiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZXhwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgLy9ubyB0ZXN0IGhlcmVcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAvLyBWZXJpZnkgaWYgbmVlZCB0byBjaGFuZ2UgdGl0bGUgZXZlcnkgc2Vjb25kc1xuICAgICAgICAgICAgICAgIGtlbmRvV2luZG93LmludGVydmFsSWQgPSB3aW5kb3cuc2V0SW50ZXJ2YWwoXG4gICAgICAgICAgICAgICAgICBmdW5jdGlvbiB3V2luZG93T3BlblNldFRpdGxlSXNDaGFuZ2VkKCkge1xuICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICRjb250ZW50ID0ga2VuZG9XaW5kb3cuZWxlbWVudC5maW5kKFwiaWZyYW1lXCIpLmNvbnRlbnRzKCk7XG4gICAgICAgICAgICAgICAgICAgICAgdmFyIG5ld1RpdGxlID0gJGNvbnRlbnQuZmluZChcInRpdGxlXCIpLmh0bWwoKTtcbiAgICAgICAgICAgICAgICAgICAgICB2YXIgY3VycmVudEljb24gPSAkY29udGVudFxuICAgICAgICAgICAgICAgICAgICAgICAgLmZpbmQoJ2xpbmtbcmVsPVwic2hvcnRjdXQgaWNvblwiXScpXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcImhyZWZcIik7XG5cbiAgICAgICAgICAgICAgICAgICAgICBpZiAobmV3VGl0bGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICRjb250ZW50LmZpbmQoXCJib2R5XCIpLmFkZENsYXNzKFwid2luZG93LWRpYWxvZ1wiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50SWNvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdUaXRsZSA9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxpbWcgc3JjPVwiJyArIGN1cnJlbnRJY29uICsgJ1wiIC8+ICcgKyBuZXdUaXRsZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuZXdUaXRsZSAhPT0gY3VycmVudFRpdGxlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRUaXRsZSA9IG5ld1RpdGxlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAkKGtlbmRvV2luZG93LmVsZW1lbnQpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmNsb3Nlc3QoXCIuay13aW5kb3dcIilcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZmluZChcIi5rLXdpbmRvdy10aXRsZVwiKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5odG1sKG5ld1RpdGxlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGV4cCkge1xuICAgICAgICAgICAgICAgICAgICAgIC8vbm8gdGVzdCBoZXJlXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAxMDAwXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBrZW5kb1dpbmRvdy5zZXRPcHRpb25zKHtcbiAgICAgICAgICAgICAgICB0aXRsZTogJCh0aGlzKVxuICAgICAgICAgICAgICAgICAgLmNvbnRlbnRzKClcbiAgICAgICAgICAgICAgICAgIC5maW5kKFwidGl0bGVcIilcbiAgICAgICAgICAgICAgICAgIC5odG1sKClcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBjYXRjaCAoZXhwKSB7XG4gICAgICAgICAgICAvL25vIHRlc3QgaGVyZVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGNsb3NlOiBmdW5jdGlvbiB3V2luZG93Q2xvc2UoKSB7XG4gICAgICAgIHdpbmRvdy5jbGVhckludGVydmFsKHRoaXMuaW50ZXJ2YWxJZCk7XG4gICAgICB9LFxuICAgICAgZGVzdHJveTogZnVuY3Rpb24gd1dpbmRvd0Rlc3Ryb3koKSB7XG4gICAgICAgIHdpbmRvdy5jbGVhckludGVydmFsKHRoaXMuaW50ZXJ2YWxJZCk7XG4gICAgICB9XG4gICAgfSxcblxuICAgIGN1cnJlbnRXaWRnZXQ6IG51bGwsXG4gICAgX2NyZWF0ZTogZnVuY3Rpb24gd1dpbmRvd0NyZWF0ZSgpIHtcbiAgICAgIHRoaXMuY3VycmVudFdpZGdldCA9ICQoJzxkaXYgY2xhc3M9XCJkaWFsb2ctd2luZG93XCIvPicpO1xuICAgICAgdGhpcy5lbGVtZW50LmFwcGVuZCh0aGlzLmN1cnJlbnRXaWRnZXQpO1xuICAgICAgdGhpcy5lbGVtZW50LmRhdGEoXCJkY3BXaW5kb3dcIiwgdGhpcyk7XG5cbiAgICAgIHRoaXMuY3VycmVudFdpZGdldC5rZW5kb1dpbmRvdyh0aGlzLm9wdGlvbnMpO1xuICAgIH0sXG5cbiAgICBfZ2V0V2luZG93VGVtcGxhdGU6IGZ1bmN0aW9uIHdXaW5kb3dDcmVhdGVfZ2V0V2luZG93VGVtcGxhdGUodGVtcGxhdGVJZCkge1xuICAgICAgaWYgKFxuICAgICAgICB0aGlzLm9wdGlvbnMudGVtcGxhdGVEYXRhICYmXG4gICAgICAgIHRoaXMub3B0aW9ucy50ZW1wbGF0ZURhdGEudGVtcGxhdGVzICYmXG4gICAgICAgIHRoaXMub3B0aW9ucy50ZW1wbGF0ZURhdGEudGVtcGxhdGVzLndpbmRvdyAmJlxuICAgICAgICB0aGlzLm9wdGlvbnMudGVtcGxhdGVEYXRhLnRlbXBsYXRlcy53aW5kb3dbdGVtcGxhdGVJZF1cbiAgICAgICkge1xuICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zLnRlbXBsYXRlRGF0YS50ZW1wbGF0ZXMud2luZG93W3RlbXBsYXRlSWRdO1xuICAgICAgfVxuICAgICAgaWYgKFxuICAgICAgICB3aW5kb3cuZGNwICYmXG4gICAgICAgIHdpbmRvdy5kY3AudGVtcGxhdGVzICYmXG4gICAgICAgIHdpbmRvdy5kY3AudGVtcGxhdGVzLndpbmRvdyAmJlxuICAgICAgICB3aW5kb3cuZGNwLnRlbXBsYXRlcy53aW5kb3dbdGVtcGxhdGVJZF1cbiAgICAgICkge1xuICAgICAgICByZXR1cm4gd2luZG93LmRjcC50ZW1wbGF0ZXMud2luZG93W3RlbXBsYXRlSWRdO1xuICAgICAgfVxuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVW5rbm93biB3aW5kb3cgdGVtcGxhdGUgIFwiICsgdGVtcGxhdGVJZCk7XG4gICAgfSxcbiAgICBkZXN0cm95OiBmdW5jdGlvbiB3V2luZG93RGVzdHJveSgpIHtcbiAgICAgIHdpbmRvdy5jbGVhckludGVydmFsKHRoaXMuaW50ZXJ2YWxJZCk7XG4gICAgICBpZiAodGhpcy5jdXJyZW50V2lkZ2V0ICYmIHRoaXMuY3VycmVudFdpZGdldC5kYXRhKFwia2VuZG9XaW5kb3dcIikpIHtcbiAgICAgICAgdGhpcy5jdXJyZW50V2lkZ2V0LmRhdGEoXCJrZW5kb1dpbmRvd1wiKS5kZXN0cm95KCk7XG4gICAgICB9XG4gICAgICB0aGlzLl9zdXBlcigpO1xuICAgIH0sXG4gICAgb3BlbjogZnVuY3Rpb24gd1dpbmRvd29wZW4oKSB7XG4gICAgICB0aGlzLmN1cnJlbnRXaWRnZXQuZGF0YShcImtlbmRvV2luZG93XCIpLm9wZW4oKTtcbiAgICB9LFxuICAgIGNsb3NlOiBmdW5jdGlvbiB3V2luZG93Q2xvc2UoKSB7XG4gICAgICB3aW5kb3cuY2xlYXJJbnRlcnZhbCh0aGlzLmludGVydmFsSWQpO1xuICAgICAgdGhpcy5jdXJyZW50V2lkZ2V0LmRhdGEoXCJrZW5kb1dpbmRvd1wiKS5jbG9zZSgpO1xuICAgIH0sXG4gICAga2VuZG9XaW5kb3c6IGZ1bmN0aW9uIHdXaW5kb3drZW5kb1dpbmRvdygpIHtcbiAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRXaWRnZXQuZGF0YShcImtlbmRvV2luZG93XCIpO1xuICAgIH1cbiAgfSk7XG59KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///20a5662e33e2c3e5a9d8\n");

/***/ }),

/***/ "2396a71337586706882f":
/*!****************************************************************!*\
  !*** ./src/Apps/DOCUMENT/IHM/views/attributes/array/vArray.js ***!
  \****************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/*global define, console*/\n!(__WEBPACK_AMD_DEFINE_ARRAY__ = [\n  __webpack_require__(/*! jquery */ \"127c8cf59f228bb01a21\"),\n  __webpack_require__(/*! underscore */ \"8e08e542008e4aef1f58\"),\n  __webpack_require__(/*! backbone */ \"1858b45bf48591489d06\"),\n  __webpack_require__(/*! mustache */ \"bcd31d01884fc294fd69\"),\n  __webpack_require__(/*! dcpDocument/views/attributes/vAttribute */ \"fde693488ffc947d1881\"),\n  __webpack_require__(/*! dcpDocument/views/attributes/array/vColumn */ \"35dd456a4962187f103a\"),\n  __webpack_require__(/*! dcpDocument/views/document/attributeTemplate */ \"593c8c94ba4399020f79\"),\n  __webpack_require__(/*! dcpDocument/widgets/attributes/array/wArray */ \"3e588fcfb2b891e35e39\")\n], __WEBPACK_AMD_DEFINE_RESULT__ = (function vArray(\n  $,\n  _,\n  Backbone,\n  Mustache,\n  ViewAttribute,\n  ViewColumn,\n  attributeTemplate\n) {\n  \"use strict\";\n\n  return Backbone.View.extend({\n    className: \"row dcpArray\",\n    displayLabel: true,\n    customView: false,\n    customRowView: false,\n    events: {\n      dcparraylineadded: \"addLine\",\n      dcparraylineremoved: \"removeLine\",\n      dcparraylinemoved: \"moveLine\",\n      dcparrayexternallinkselected: \"externalLinkSelected\",\n      \"dcpattributechange .dcpArray__content__cell\": \"updateValue\"\n    },\n\n    columnViews: {},\n\n    initialize: function vArray_initialize(options) {\n      if (\n        options.displayLabel === false ||\n        this.model.getOption(\"labelPosition\") === \"none\"\n      ) {\n        this.displayLabel = false;\n      }\n      this.listenTo(this.model, \"change:label\", this.updateLabel);\n      this.listenTo(this.model, \"destroy\", this.remove);\n      this.listenTo(this.model, \"cleanView\", this.remove);\n      this.listenTo(this.model, \"change:errorMessage\", this.setArrayError);\n      this.listenTo(this.model, \"errorMessage\", this.setError);\n      this.listenTo(this.model, \"hide\", this.hide);\n      this.listenTo(this.model, \"show\", this.show);\n      this.listenTo(this.model, \"removeWidgetLine\", this.removeWidgetLine);\n      this.listenTo(this.model, \"addWidgetLine\", this.addWidgetLine);\n      this.listenTo(this.model, \"haveView\", this._identifyView);\n      this.options = options;\n    },\n\n    render: function vArray_render() {\n      var currentView = this;\n      return new Promise(\n        _.bind(function vArray_renderPromise(resolve, reject) {\n          try {\n            var customRender,\n              data = currentView.model.toData(null, true),\n              event = { prevent: false },\n              promisesColumn = [];\n\n            //Trigger the beforeRender event, and cancel display if asked\n            currentView.model.trigger(\"beforeRender\", event, {\n              model: currentView.model,\n              $el: currentView.$el\n            });\n            if (event.prevent) {\n              resolve(currentView);\n              return currentView;\n            }\n\n            if (currentView.options.originalView !== true) {\n              if (currentView.model.getOption(\"template\")) {\n                customRender = attributeTemplate.renderCustomView(\n                  currentView.model\n                );\n                currentView.customView = customRender.$el;\n                customRender.promise.then(resolve);\n                if (\n                  currentView.model\n                    .getOption(\"template\")\n                    .match(\"dcpArray__table\")\n                ) {\n                  // Two case of custom : custom line or global custom array\n                  currentView.customRowView = true;\n                }\n              }\n            }\n\n            //Extract only the displayable lines\n            data.content = _.filter(\n              data.content,\n              function vArray_filterCurrentElement(currentContent) {\n                return currentContent.isDisplayable;\n              }\n            );\n            data.nbLines = currentView.getNbLines();\n            currentView.padValues(data.nbLines);\n            data.renderOptions = currentView.model.getOptions();\n            data.templates = {};\n            data.displayLabel = currentView.displayLabel;\n            if (\n              currentView.model.getTemplates().attribute[\n                currentView.model.get(\"type\")\n              ]\n            ) {\n              data.templates = currentView.model.getTemplates().attribute[\n                currentView.model.get(\"type\")\n              ];\n            }\n            if (data.nbLines === 0 && data.mode === \"read\") {\n              data.showEmpty = currentView.model.getOption(\"showEmptyContent\");\n            } else {\n              if (!currentView.customView || currentView.customRowView) {\n                currentView.columnViews = [];\n                currentView.model\n                  .get(\"content\")\n                  .each(function vArray_analyzeContent(currentAttr) {\n                    if (!currentAttr.isDisplayable()) {\n                      return;\n                    }\n                    try {\n                      if (currentAttr.getOption(\"attributeLabel\")) {\n                        data.content = _.map(\n                          data.content,\n                          function vArray_changeLabelCurrentElement(\n                            currentContent\n                          ) {\n                            if (currentContent.id === currentAttr.id) {\n                              currentContent.label = currentAttr.getOption(\n                                \"attributeLabel\"\n                              );\n                            }\n                            return currentContent;\n                          }\n                        );\n                      }\n                      if (currentAttr.get(\"isValueAttribute\")) {\n                        currentView.columnViews[\n                          currentAttr.id\n                        ] = new ViewColumn({\n                          el: currentView.el,\n                          els: function vArray_findScope() {\n                            return currentView.$el.find(\n                              '.dcpArray__cell[data-attrid=\"' +\n                                currentAttr.id +\n                                '\"],' +\n                                '.dcpCustomTemplate--row[data-attrid=\"' +\n                                currentAttr.id +\n                                '\"]'\n                            );\n                          },\n                          originalView: true,\n                          model: currentAttr,\n                          parentElement: currentView.$el\n                        });\n                        promisesColumn.push(\n                          currentView.columnViews[currentAttr.id].render()\n                        );\n                      }\n                    } catch (e) {\n                      if (window.dcp.logger) {\n                        window.dcp.logger(e);\n                      } else {\n                        console.error(e);\n                      }\n                    }\n                  });\n              }\n            }\n          } catch (e) {\n            reject(e);\n          }\n\n          if (currentView.customView) {\n            data.customTemplate = currentView.customView;\n            data.customLineCallback = function vArray_callCustomLine(index) {\n              return attributeTemplate.customArrayRowView(\n                index,\n                currentView.model,\n                currentView\n              );\n            };\n          }\n\n          try {\n            promisesColumn.push(\n              new Promise(\n                _.bind(function onArrayReady(resolve, reject) {\n                  try {\n                    currentView.$el\n                      .dcpArray(data)\n                      .one(\"dcparraywidgetready\", resolve);\n                    attributeTemplate.insertDescription(currentView);\n                  } catch (e) {\n                    reject(e);\n                  }\n                }, this)\n              )\n            );\n          } catch (e) {\n            if (window.dcp.logger) {\n              window.dcp.logger(e);\n            } else {\n              console.error(e);\n            }\n          }\n\n          Promise.all(promisesColumn).then(function renderDone() {\n            currentView.$el.attr(\"data-attrid\", currentView.model.id);\n            currentView.model.trigger(\"renderDone\", {\n              model: currentView.model,\n              $el: currentView.$el\n            });\n            if (\n              currentView.$el.find(\n                '.dcpCustomTemplate[data-attrid=\"' +\n                  currentView.model.id +\n                  '\"] .dcpCustomTemplate--content[data-attrid=\"' +\n                  currentView.model.id +\n                  '\"]'\n              ).length > 0\n            ) {\n              // it's a fake array view because template declare itself inside\n              currentView.stopListening(currentView.model, \"addWidgetLine\");\n              currentView.stopListening(currentView.model, \"removeWidgetLine\");\n              currentView.undelegateEvents();\n            }\n            resolve(currentView);\n          });\n\n          return this;\n        }, this)\n      );\n    },\n\n    getNbLines: function vArraygetNbLines() {\n      var nbLigne = this.nbLines || 0;\n      this.model\n        .get(\"content\")\n        .each(function vArray_getCurrentLine(currentAttr) {\n          if (\n            currentAttr.get(\"attributeValue\") &&\n            nbLigne < _.size(currentAttr.get(\"attributeValue\"))\n          ) {\n            nbLigne = _.size(currentAttr.get(\"attributeValue\"));\n          }\n        });\n      return nbLigne;\n    },\n\n    padValues: function vArrayPadValues(lineNumber) {\n      if (lineNumber > 0) {\n        this.model\n          .get(\"content\")\n          .each(function vArray_padCurrentLine(currentAttr) {\n            var currentValue = currentAttr.get(\"attributeValue\");\n            if (\n              currentValue !== null &&\n              currentValue !== undefined &&\n              _.size(currentValue) < lineNumber\n            ) {\n              for (var idx = currentValue.length; idx < lineNumber; idx++) {\n                currentValue.push({ value: null, displayValue: \"\" });\n              }\n            }\n          });\n      }\n    },\n\n    updateLabel: function vArrayupdateLabel() {\n      this.$el.find(\".dcpArray__label\").text(this.model.get(\"label\"));\n    },\n\n    updateValue: function vArray_UpdateValue(event, options) {\n      var attributeModel = this.model.get(\"content\").get(options.id);\n      if (!attributeModel) {\n        throw new Error(\"Unknown attribute \" + options.id);\n      }\n      if (options.index >= 0) {\n        var currentValues = attributeModel.get(\"attributeValue\");\n        var currentValue = currentValues[options.index];\n\n        if (!_.isEqual(currentValue, options.value)) {\n          // Update model only if a change is detected\n          if (\n            !currentValue.value ||\n            !options.value ||\n            !options.value.value ||\n            currentValue.value !== options.value.value\n          ) {\n            attributeModel.setValue(options.value, options.index);\n          }\n        }\n      } else {\n        attributeModel.setValue(options.value, options.index);\n      }\n    },\n\n    refresh: function vArray_Refresh() {\n      this.nbLines = this.$el.dcpArray(\"option\", \"nbLines\");\n      this.$el.dcpArray(\"destroy\");\n      this.render();\n    },\n\n    removeLine: function vArray_removeLine(event, options) {\n      this.model\n        .get(\"content\")\n        .each(function vArray_removeLine(currentContent) {\n          currentContent.removeIndexValue(options.line);\n        });\n      this.model.trigger(\"array\", \"removeLine\", this.model, options.line);\n    },\n\n    removeWidgetLine: function vArray_RemoveWidgetLine(options) {\n      this.$el.dcpArray(\"removeLine\", options.index, { silent: true });\n    },\n\n    addWidgetLine: function vArray_addWidgetLine(options) {\n      this.$el.dcpArray(\"addLine\", options.index);\n    },\n\n    addLine: function vArray_AddLine(event, options) {\n      var currentArrayView = this,\n        customView = null;\n      var allPromiseAttributes = [];\n      this.model\n        .get(\"content\")\n        .each(function vArray_addLineGetContent(currentContent) {\n          var currentViewColumn;\n          if (options.needAddValue || options.copyValue) {\n            currentContent.createIndexedValue(options.line, options.copyValue);\n          }\n          currentViewColumn = currentArrayView.columnViews[currentContent.id];\n          if (currentViewColumn) {\n            customView = null;\n            if (currentContent.getOption(\"template\")) {\n              customView = attributeTemplate.renderCustomView(\n                currentContent,\n                function vArray_customViewInit() {\n                  var $this = $(this),\n                    currentWidgetOption = currentViewColumn.getData(\n                      options.line\n                    );\n                  //Check if the asked attribute is the current attribute\n                  if ($this.data(\"attrid\") !== currentContent.id) {\n                    throw Error(\n                      \"An attribute template in an array cannot asked\" +\n                        \" for another attribute than the current (\" +\n                        $this.data(\"attrid\") +\n                        \" asked instead of \" +\n                        currentContent.id +\n                        \")\"\n                    );\n                  }\n                  currentWidgetOption.viewCid = _.uniqueId(\n                    currentWidgetOption.viewCid\n                  );\n                  currentViewColumn.widgetInit($this, currentWidgetOption);\n                  currentViewColumn.moveValueIndex({});\n                },\n                { index: options.line }\n              );\n              allPromiseAttributes.push(customView.promise);\n            }\n            if (customView && customView.$el) {\n              allPromiseAttributes.push(\n                currentViewColumn.addNewWidget(options.line, customView.$el)\n              );\n            } else {\n              allPromiseAttributes.push(\n                currentViewColumn.addNewWidget(options.line)\n              );\n            }\n          }\n        });\n      Promise.all(allPromiseAttributes)\n        .then(\n          _.bind(function addlinePromiseAllDone() {\n            this.model.trigger(\"array\", \"addLine\", this.model, options.line);\n            options.resolve();\n          }, this)\n        )\n        .catch(options.reject);\n    },\n\n    moveLine: function vArray_moveLine(event, options) {\n      this.model\n        .get(\"content\")\n        .each(function vArray_getMoveLineContent(currentContent) {\n          currentContent.moveIndexValue(options.fromLine, options.toLine);\n        });\n      this.model.trigger(\"array\", \"moveLine\", this.model, options);\n    },\n    getAttributeModel: function vArray_getAttributeModel(attributeId) {\n      var docModel = this.model.getDocumentModel();\n      return docModel.get(\"attributes\").get(attributeId);\n    },\n\n    setError: function vArray_setError(event, message) {\n      var parentId = this.model.get(\"parent\");\n\n      if (message) {\n        this.$el.find(\".dcpArray__label\").addClass(\"has-error\");\n      } else {\n        this.$el.find(\".dcpArray__label\").removeClass(\"has-error\");\n      }\n\n      if (parentId) {\n        var parentModel = this.getAttributeModel(parentId);\n        if (parentModel) {\n          parentModel.trigger(\"errorMessage\", event, message);\n        }\n      }\n    },\n    setArrayError: function vArray_setArrayError(event, message) {\n      this.setError(event, message);\n      // global error on array itself\n      this.$el.dcpArray(\"setError\", message);\n    },\n\n    hide: function vArray_hide() {\n      this.$el.hide();\n    },\n\n    show: function vArray_show() {\n      this.$el.show();\n    },\n\n    _identifyView: function vArray_identifyView(event) {\n      event.haveView = true;\n      //Add the pointer to the current jquery element to a list passed by the event\n      event.elements = event.elements.add(this.$el);\n    },\n    externalLinkSelected: function vArrayExternalLinkSelected(event, options) {\n      var documentModel = this.model.getDocumentModel();\n      options.attrid = this.model.id;\n      this.model.trigger(\"internalLinkSelected\", event, options);\n      if (event.prevent) {\n        return this;\n      }\n      documentModel.trigger(\"actionAttributeLink\", event, options);\n    }\n  });\n}).apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjM5NmE3MTMzNzU4NjcwNjg4MmYuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvQXBwcy9ET0NVTUVOVC9JSE0vdmlld3MvYXR0cmlidXRlcy9hcnJheS92QXJyYXkuanM/YzM4NiJdLCJzb3VyY2VzQ29udGVudCI6WyIvKmdsb2JhbCBkZWZpbmUsIGNvbnNvbGUqL1xuZGVmaW5lKFtcbiAgXCJqcXVlcnlcIixcbiAgXCJ1bmRlcnNjb3JlXCIsXG4gIFwiYmFja2JvbmVcIixcbiAgXCJtdXN0YWNoZVwiLFxuICBcImRjcERvY3VtZW50L3ZpZXdzL2F0dHJpYnV0ZXMvdkF0dHJpYnV0ZVwiLFxuICBcImRjcERvY3VtZW50L3ZpZXdzL2F0dHJpYnV0ZXMvYXJyYXkvdkNvbHVtblwiLFxuICBcImRjcERvY3VtZW50L3ZpZXdzL2RvY3VtZW50L2F0dHJpYnV0ZVRlbXBsYXRlXCIsXG4gIFwiZGNwRG9jdW1lbnQvd2lkZ2V0cy9hdHRyaWJ1dGVzL2FycmF5L3dBcnJheVwiXG5dLCBmdW5jdGlvbiB2QXJyYXkoXG4gICQsXG4gIF8sXG4gIEJhY2tib25lLFxuICBNdXN0YWNoZSxcbiAgVmlld0F0dHJpYnV0ZSxcbiAgVmlld0NvbHVtbixcbiAgYXR0cmlidXRlVGVtcGxhdGVcbikge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICByZXR1cm4gQmFja2JvbmUuVmlldy5leHRlbmQoe1xuICAgIGNsYXNzTmFtZTogXCJyb3cgZGNwQXJyYXlcIixcbiAgICBkaXNwbGF5TGFiZWw6IHRydWUsXG4gICAgY3VzdG9tVmlldzogZmFsc2UsXG4gICAgY3VzdG9tUm93VmlldzogZmFsc2UsXG4gICAgZXZlbnRzOiB7XG4gICAgICBkY3BhcnJheWxpbmVhZGRlZDogXCJhZGRMaW5lXCIsXG4gICAgICBkY3BhcnJheWxpbmVyZW1vdmVkOiBcInJlbW92ZUxpbmVcIixcbiAgICAgIGRjcGFycmF5bGluZW1vdmVkOiBcIm1vdmVMaW5lXCIsXG4gICAgICBkY3BhcnJheWV4dGVybmFsbGlua3NlbGVjdGVkOiBcImV4dGVybmFsTGlua1NlbGVjdGVkXCIsXG4gICAgICBcImRjcGF0dHJpYnV0ZWNoYW5nZSAuZGNwQXJyYXlfX2NvbnRlbnRfX2NlbGxcIjogXCJ1cGRhdGVWYWx1ZVwiXG4gICAgfSxcblxuICAgIGNvbHVtblZpZXdzOiB7fSxcblxuICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uIHZBcnJheV9pbml0aWFsaXplKG9wdGlvbnMpIHtcbiAgICAgIGlmIChcbiAgICAgICAgb3B0aW9ucy5kaXNwbGF5TGFiZWwgPT09IGZhbHNlIHx8XG4gICAgICAgIHRoaXMubW9kZWwuZ2V0T3B0aW9uKFwibGFiZWxQb3NpdGlvblwiKSA9PT0gXCJub25lXCJcbiAgICAgICkge1xuICAgICAgICB0aGlzLmRpc3BsYXlMYWJlbCA9IGZhbHNlO1xuICAgICAgfVxuICAgICAgdGhpcy5saXN0ZW5Ubyh0aGlzLm1vZGVsLCBcImNoYW5nZTpsYWJlbFwiLCB0aGlzLnVwZGF0ZUxhYmVsKTtcbiAgICAgIHRoaXMubGlzdGVuVG8odGhpcy5tb2RlbCwgXCJkZXN0cm95XCIsIHRoaXMucmVtb3ZlKTtcbiAgICAgIHRoaXMubGlzdGVuVG8odGhpcy5tb2RlbCwgXCJjbGVhblZpZXdcIiwgdGhpcy5yZW1vdmUpO1xuICAgICAgdGhpcy5saXN0ZW5Ubyh0aGlzLm1vZGVsLCBcImNoYW5nZTplcnJvck1lc3NhZ2VcIiwgdGhpcy5zZXRBcnJheUVycm9yKTtcbiAgICAgIHRoaXMubGlzdGVuVG8odGhpcy5tb2RlbCwgXCJlcnJvck1lc3NhZ2VcIiwgdGhpcy5zZXRFcnJvcik7XG4gICAgICB0aGlzLmxpc3RlblRvKHRoaXMubW9kZWwsIFwiaGlkZVwiLCB0aGlzLmhpZGUpO1xuICAgICAgdGhpcy5saXN0ZW5Ubyh0aGlzLm1vZGVsLCBcInNob3dcIiwgdGhpcy5zaG93KTtcbiAgICAgIHRoaXMubGlzdGVuVG8odGhpcy5tb2RlbCwgXCJyZW1vdmVXaWRnZXRMaW5lXCIsIHRoaXMucmVtb3ZlV2lkZ2V0TGluZSk7XG4gICAgICB0aGlzLmxpc3RlblRvKHRoaXMubW9kZWwsIFwiYWRkV2lkZ2V0TGluZVwiLCB0aGlzLmFkZFdpZGdldExpbmUpO1xuICAgICAgdGhpcy5saXN0ZW5Ubyh0aGlzLm1vZGVsLCBcImhhdmVWaWV3XCIsIHRoaXMuX2lkZW50aWZ5Vmlldyk7XG4gICAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zO1xuICAgIH0sXG5cbiAgICByZW5kZXI6IGZ1bmN0aW9uIHZBcnJheV9yZW5kZXIoKSB7XG4gICAgICB2YXIgY3VycmVudFZpZXcgPSB0aGlzO1xuICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKFxuICAgICAgICBfLmJpbmQoZnVuY3Rpb24gdkFycmF5X3JlbmRlclByb21pc2UocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHZhciBjdXN0b21SZW5kZXIsXG4gICAgICAgICAgICAgIGRhdGEgPSBjdXJyZW50Vmlldy5tb2RlbC50b0RhdGEobnVsbCwgdHJ1ZSksXG4gICAgICAgICAgICAgIGV2ZW50ID0geyBwcmV2ZW50OiBmYWxzZSB9LFxuICAgICAgICAgICAgICBwcm9taXNlc0NvbHVtbiA9IFtdO1xuXG4gICAgICAgICAgICAvL1RyaWdnZXIgdGhlIGJlZm9yZVJlbmRlciBldmVudCwgYW5kIGNhbmNlbCBkaXNwbGF5IGlmIGFza2VkXG4gICAgICAgICAgICBjdXJyZW50Vmlldy5tb2RlbC50cmlnZ2VyKFwiYmVmb3JlUmVuZGVyXCIsIGV2ZW50LCB7XG4gICAgICAgICAgICAgIG1vZGVsOiBjdXJyZW50Vmlldy5tb2RlbCxcbiAgICAgICAgICAgICAgJGVsOiBjdXJyZW50Vmlldy4kZWxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaWYgKGV2ZW50LnByZXZlbnQpIHtcbiAgICAgICAgICAgICAgcmVzb2x2ZShjdXJyZW50Vmlldyk7XG4gICAgICAgICAgICAgIHJldHVybiBjdXJyZW50VmlldztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGN1cnJlbnRWaWV3Lm9wdGlvbnMub3JpZ2luYWxWaWV3ICE9PSB0cnVlKSB7XG4gICAgICAgICAgICAgIGlmIChjdXJyZW50Vmlldy5tb2RlbC5nZXRPcHRpb24oXCJ0ZW1wbGF0ZVwiKSkge1xuICAgICAgICAgICAgICAgIGN1c3RvbVJlbmRlciA9IGF0dHJpYnV0ZVRlbXBsYXRlLnJlbmRlckN1c3RvbVZpZXcoXG4gICAgICAgICAgICAgICAgICBjdXJyZW50Vmlldy5tb2RlbFxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgY3VycmVudFZpZXcuY3VzdG9tVmlldyA9IGN1c3RvbVJlbmRlci4kZWw7XG4gICAgICAgICAgICAgICAgY3VzdG9tUmVuZGVyLnByb21pc2UudGhlbihyZXNvbHZlKTtcbiAgICAgICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgICBjdXJyZW50Vmlldy5tb2RlbFxuICAgICAgICAgICAgICAgICAgICAuZ2V0T3B0aW9uKFwidGVtcGxhdGVcIilcbiAgICAgICAgICAgICAgICAgICAgLm1hdGNoKFwiZGNwQXJyYXlfX3RhYmxlXCIpXG4gICAgICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgICAvLyBUd28gY2FzZSBvZiBjdXN0b20gOiBjdXN0b20gbGluZSBvciBnbG9iYWwgY3VzdG9tIGFycmF5XG4gICAgICAgICAgICAgICAgICBjdXJyZW50Vmlldy5jdXN0b21Sb3dWaWV3ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy9FeHRyYWN0IG9ubHkgdGhlIGRpc3BsYXlhYmxlIGxpbmVzXG4gICAgICAgICAgICBkYXRhLmNvbnRlbnQgPSBfLmZpbHRlcihcbiAgICAgICAgICAgICAgZGF0YS5jb250ZW50LFxuICAgICAgICAgICAgICBmdW5jdGlvbiB2QXJyYXlfZmlsdGVyQ3VycmVudEVsZW1lbnQoY3VycmVudENvbnRlbnQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gY3VycmVudENvbnRlbnQuaXNEaXNwbGF5YWJsZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIGRhdGEubmJMaW5lcyA9IGN1cnJlbnRWaWV3LmdldE5iTGluZXMoKTtcbiAgICAgICAgICAgIGN1cnJlbnRWaWV3LnBhZFZhbHVlcyhkYXRhLm5iTGluZXMpO1xuICAgICAgICAgICAgZGF0YS5yZW5kZXJPcHRpb25zID0gY3VycmVudFZpZXcubW9kZWwuZ2V0T3B0aW9ucygpO1xuICAgICAgICAgICAgZGF0YS50ZW1wbGF0ZXMgPSB7fTtcbiAgICAgICAgICAgIGRhdGEuZGlzcGxheUxhYmVsID0gY3VycmVudFZpZXcuZGlzcGxheUxhYmVsO1xuICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICBjdXJyZW50Vmlldy5tb2RlbC5nZXRUZW1wbGF0ZXMoKS5hdHRyaWJ1dGVbXG4gICAgICAgICAgICAgICAgY3VycmVudFZpZXcubW9kZWwuZ2V0KFwidHlwZVwiKVxuICAgICAgICAgICAgICBdXG4gICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgZGF0YS50ZW1wbGF0ZXMgPSBjdXJyZW50Vmlldy5tb2RlbC5nZXRUZW1wbGF0ZXMoKS5hdHRyaWJ1dGVbXG4gICAgICAgICAgICAgICAgY3VycmVudFZpZXcubW9kZWwuZ2V0KFwidHlwZVwiKVxuICAgICAgICAgICAgICBdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGRhdGEubmJMaW5lcyA9PT0gMCAmJiBkYXRhLm1vZGUgPT09IFwicmVhZFwiKSB7XG4gICAgICAgICAgICAgIGRhdGEuc2hvd0VtcHR5ID0gY3VycmVudFZpZXcubW9kZWwuZ2V0T3B0aW9uKFwic2hvd0VtcHR5Q29udGVudFwiKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGlmICghY3VycmVudFZpZXcuY3VzdG9tVmlldyB8fCBjdXJyZW50Vmlldy5jdXN0b21Sb3dWaWV3KSB7XG4gICAgICAgICAgICAgICAgY3VycmVudFZpZXcuY29sdW1uVmlld3MgPSBbXTtcbiAgICAgICAgICAgICAgICBjdXJyZW50Vmlldy5tb2RlbFxuICAgICAgICAgICAgICAgICAgLmdldChcImNvbnRlbnRcIilcbiAgICAgICAgICAgICAgICAgIC5lYWNoKGZ1bmN0aW9uIHZBcnJheV9hbmFseXplQ29udGVudChjdXJyZW50QXR0cikge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWN1cnJlbnRBdHRyLmlzRGlzcGxheWFibGUoKSkge1xuICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50QXR0ci5nZXRPcHRpb24oXCJhdHRyaWJ1dGVMYWJlbFwiKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5jb250ZW50ID0gXy5tYXAoXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEuY29udGVudCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gdkFycmF5X2NoYW5nZUxhYmVsQ3VycmVudEVsZW1lbnQoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudENvbnRlbnRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRDb250ZW50LmlkID09PSBjdXJyZW50QXR0ci5pZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudENvbnRlbnQubGFiZWwgPSBjdXJyZW50QXR0ci5nZXRPcHRpb24oXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiYXR0cmlidXRlTGFiZWxcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGN1cnJlbnRDb250ZW50O1xuICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudEF0dHIuZ2V0KFwiaXNWYWx1ZUF0dHJpYnV0ZVwiKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudFZpZXcuY29sdW1uVmlld3NbXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRBdHRyLmlkXG4gICAgICAgICAgICAgICAgICAgICAgICBdID0gbmV3IFZpZXdDb2x1bW4oe1xuICAgICAgICAgICAgICAgICAgICAgICAgICBlbDogY3VycmVudFZpZXcuZWwsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGVsczogZnVuY3Rpb24gdkFycmF5X2ZpbmRTY29wZSgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY3VycmVudFZpZXcuJGVsLmZpbmQoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnLmRjcEFycmF5X19jZWxsW2RhdGEtYXR0cmlkPVwiJyArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRBdHRyLmlkICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1wiXSwnICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJy5kY3BDdXN0b21UZW1wbGF0ZS0tcm93W2RhdGEtYXR0cmlkPVwiJyArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRBdHRyLmlkICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1wiXSdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICBvcmlnaW5hbFZpZXc6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGVsOiBjdXJyZW50QXR0cixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50RWxlbWVudDogY3VycmVudFZpZXcuJGVsXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb21pc2VzQ29sdW1uLnB1c2goXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRWaWV3LmNvbHVtblZpZXdzW2N1cnJlbnRBdHRyLmlkXS5yZW5kZXIoKVxuICAgICAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICBpZiAod2luZG93LmRjcC5sb2dnZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5kY3AubG9nZ2VyKGUpO1xuICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGUpO1xuICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICByZWplY3QoZSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYgKGN1cnJlbnRWaWV3LmN1c3RvbVZpZXcpIHtcbiAgICAgICAgICAgIGRhdGEuY3VzdG9tVGVtcGxhdGUgPSBjdXJyZW50Vmlldy5jdXN0b21WaWV3O1xuICAgICAgICAgICAgZGF0YS5jdXN0b21MaW5lQ2FsbGJhY2sgPSBmdW5jdGlvbiB2QXJyYXlfY2FsbEN1c3RvbUxpbmUoaW5kZXgpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGF0dHJpYnV0ZVRlbXBsYXRlLmN1c3RvbUFycmF5Um93VmlldyhcbiAgICAgICAgICAgICAgICBpbmRleCxcbiAgICAgICAgICAgICAgICBjdXJyZW50Vmlldy5tb2RlbCxcbiAgICAgICAgICAgICAgICBjdXJyZW50Vmlld1xuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgcHJvbWlzZXNDb2x1bW4ucHVzaChcbiAgICAgICAgICAgICAgbmV3IFByb21pc2UoXG4gICAgICAgICAgICAgICAgXy5iaW5kKGZ1bmN0aW9uIG9uQXJyYXlSZWFkeShyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnRWaWV3LiRlbFxuICAgICAgICAgICAgICAgICAgICAgIC5kY3BBcnJheShkYXRhKVxuICAgICAgICAgICAgICAgICAgICAgIC5vbmUoXCJkY3BhcnJheXdpZGdldHJlYWR5XCIsIHJlc29sdmUpO1xuICAgICAgICAgICAgICAgICAgICBhdHRyaWJ1dGVUZW1wbGF0ZS5pbnNlcnREZXNjcmlwdGlvbihjdXJyZW50Vmlldyk7XG4gICAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChlKTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LCB0aGlzKVxuICAgICAgICAgICAgICApXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIGlmICh3aW5kb3cuZGNwLmxvZ2dlcikge1xuICAgICAgICAgICAgICB3aW5kb3cuZGNwLmxvZ2dlcihlKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgUHJvbWlzZS5hbGwocHJvbWlzZXNDb2x1bW4pLnRoZW4oZnVuY3Rpb24gcmVuZGVyRG9uZSgpIHtcbiAgICAgICAgICAgIGN1cnJlbnRWaWV3LiRlbC5hdHRyKFwiZGF0YS1hdHRyaWRcIiwgY3VycmVudFZpZXcubW9kZWwuaWQpO1xuICAgICAgICAgICAgY3VycmVudFZpZXcubW9kZWwudHJpZ2dlcihcInJlbmRlckRvbmVcIiwge1xuICAgICAgICAgICAgICBtb2RlbDogY3VycmVudFZpZXcubW9kZWwsXG4gICAgICAgICAgICAgICRlbDogY3VycmVudFZpZXcuJGVsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgY3VycmVudFZpZXcuJGVsLmZpbmQoXG4gICAgICAgICAgICAgICAgJy5kY3BDdXN0b21UZW1wbGF0ZVtkYXRhLWF0dHJpZD1cIicgK1xuICAgICAgICAgICAgICAgICAgY3VycmVudFZpZXcubW9kZWwuaWQgK1xuICAgICAgICAgICAgICAgICAgJ1wiXSAuZGNwQ3VzdG9tVGVtcGxhdGUtLWNvbnRlbnRbZGF0YS1hdHRyaWQ9XCInICtcbiAgICAgICAgICAgICAgICAgIGN1cnJlbnRWaWV3Lm1vZGVsLmlkICtcbiAgICAgICAgICAgICAgICAgICdcIl0nXG4gICAgICAgICAgICAgICkubGVuZ3RoID4gMFxuICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgIC8vIGl0J3MgYSBmYWtlIGFycmF5IHZpZXcgYmVjYXVzZSB0ZW1wbGF0ZSBkZWNsYXJlIGl0c2VsZiBpbnNpZGVcbiAgICAgICAgICAgICAgY3VycmVudFZpZXcuc3RvcExpc3RlbmluZyhjdXJyZW50Vmlldy5tb2RlbCwgXCJhZGRXaWRnZXRMaW5lXCIpO1xuICAgICAgICAgICAgICBjdXJyZW50Vmlldy5zdG9wTGlzdGVuaW5nKGN1cnJlbnRWaWV3Lm1vZGVsLCBcInJlbW92ZVdpZGdldExpbmVcIik7XG4gICAgICAgICAgICAgIGN1cnJlbnRWaWV3LnVuZGVsZWdhdGVFdmVudHMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJlc29sdmUoY3VycmVudFZpZXcpO1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH0sIHRoaXMpXG4gICAgICApO1xuICAgIH0sXG5cbiAgICBnZXROYkxpbmVzOiBmdW5jdGlvbiB2QXJyYXlnZXROYkxpbmVzKCkge1xuICAgICAgdmFyIG5iTGlnbmUgPSB0aGlzLm5iTGluZXMgfHwgMDtcbiAgICAgIHRoaXMubW9kZWxcbiAgICAgICAgLmdldChcImNvbnRlbnRcIilcbiAgICAgICAgLmVhY2goZnVuY3Rpb24gdkFycmF5X2dldEN1cnJlbnRMaW5lKGN1cnJlbnRBdHRyKSB7XG4gICAgICAgICAgaWYgKFxuICAgICAgICAgICAgY3VycmVudEF0dHIuZ2V0KFwiYXR0cmlidXRlVmFsdWVcIikgJiZcbiAgICAgICAgICAgIG5iTGlnbmUgPCBfLnNpemUoY3VycmVudEF0dHIuZ2V0KFwiYXR0cmlidXRlVmFsdWVcIikpXG4gICAgICAgICAgKSB7XG4gICAgICAgICAgICBuYkxpZ25lID0gXy5zaXplKGN1cnJlbnRBdHRyLmdldChcImF0dHJpYnV0ZVZhbHVlXCIpKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgcmV0dXJuIG5iTGlnbmU7XG4gICAgfSxcblxuICAgIHBhZFZhbHVlczogZnVuY3Rpb24gdkFycmF5UGFkVmFsdWVzKGxpbmVOdW1iZXIpIHtcbiAgICAgIGlmIChsaW5lTnVtYmVyID4gMCkge1xuICAgICAgICB0aGlzLm1vZGVsXG4gICAgICAgICAgLmdldChcImNvbnRlbnRcIilcbiAgICAgICAgICAuZWFjaChmdW5jdGlvbiB2QXJyYXlfcGFkQ3VycmVudExpbmUoY3VycmVudEF0dHIpIHtcbiAgICAgICAgICAgIHZhciBjdXJyZW50VmFsdWUgPSBjdXJyZW50QXR0ci5nZXQoXCJhdHRyaWJ1dGVWYWx1ZVwiKTtcbiAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgY3VycmVudFZhbHVlICE9PSBudWxsICYmXG4gICAgICAgICAgICAgIGN1cnJlbnRWYWx1ZSAhPT0gdW5kZWZpbmVkICYmXG4gICAgICAgICAgICAgIF8uc2l6ZShjdXJyZW50VmFsdWUpIDwgbGluZU51bWJlclxuICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgIGZvciAodmFyIGlkeCA9IGN1cnJlbnRWYWx1ZS5sZW5ndGg7IGlkeCA8IGxpbmVOdW1iZXI7IGlkeCsrKSB7XG4gICAgICAgICAgICAgICAgY3VycmVudFZhbHVlLnB1c2goeyB2YWx1ZTogbnVsbCwgZGlzcGxheVZhbHVlOiBcIlwiIH0pO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSxcblxuICAgIHVwZGF0ZUxhYmVsOiBmdW5jdGlvbiB2QXJyYXl1cGRhdGVMYWJlbCgpIHtcbiAgICAgIHRoaXMuJGVsLmZpbmQoXCIuZGNwQXJyYXlfX2xhYmVsXCIpLnRleHQodGhpcy5tb2RlbC5nZXQoXCJsYWJlbFwiKSk7XG4gICAgfSxcblxuICAgIHVwZGF0ZVZhbHVlOiBmdW5jdGlvbiB2QXJyYXlfVXBkYXRlVmFsdWUoZXZlbnQsIG9wdGlvbnMpIHtcbiAgICAgIHZhciBhdHRyaWJ1dGVNb2RlbCA9IHRoaXMubW9kZWwuZ2V0KFwiY29udGVudFwiKS5nZXQob3B0aW9ucy5pZCk7XG4gICAgICBpZiAoIWF0dHJpYnV0ZU1vZGVsKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIlVua25vd24gYXR0cmlidXRlIFwiICsgb3B0aW9ucy5pZCk7XG4gICAgICB9XG4gICAgICBpZiAob3B0aW9ucy5pbmRleCA+PSAwKSB7XG4gICAgICAgIHZhciBjdXJyZW50VmFsdWVzID0gYXR0cmlidXRlTW9kZWwuZ2V0KFwiYXR0cmlidXRlVmFsdWVcIik7XG4gICAgICAgIHZhciBjdXJyZW50VmFsdWUgPSBjdXJyZW50VmFsdWVzW29wdGlvbnMuaW5kZXhdO1xuXG4gICAgICAgIGlmICghXy5pc0VxdWFsKGN1cnJlbnRWYWx1ZSwgb3B0aW9ucy52YWx1ZSkpIHtcbiAgICAgICAgICAvLyBVcGRhdGUgbW9kZWwgb25seSBpZiBhIGNoYW5nZSBpcyBkZXRlY3RlZFxuICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICFjdXJyZW50VmFsdWUudmFsdWUgfHxcbiAgICAgICAgICAgICFvcHRpb25zLnZhbHVlIHx8XG4gICAgICAgICAgICAhb3B0aW9ucy52YWx1ZS52YWx1ZSB8fFxuICAgICAgICAgICAgY3VycmVudFZhbHVlLnZhbHVlICE9PSBvcHRpb25zLnZhbHVlLnZhbHVlXG4gICAgICAgICAgKSB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVNb2RlbC5zZXRWYWx1ZShvcHRpb25zLnZhbHVlLCBvcHRpb25zLmluZGV4KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGF0dHJpYnV0ZU1vZGVsLnNldFZhbHVlKG9wdGlvbnMudmFsdWUsIG9wdGlvbnMuaW5kZXgpO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICByZWZyZXNoOiBmdW5jdGlvbiB2QXJyYXlfUmVmcmVzaCgpIHtcbiAgICAgIHRoaXMubmJMaW5lcyA9IHRoaXMuJGVsLmRjcEFycmF5KFwib3B0aW9uXCIsIFwibmJMaW5lc1wiKTtcbiAgICAgIHRoaXMuJGVsLmRjcEFycmF5KFwiZGVzdHJveVwiKTtcbiAgICAgIHRoaXMucmVuZGVyKCk7XG4gICAgfSxcblxuICAgIHJlbW92ZUxpbmU6IGZ1bmN0aW9uIHZBcnJheV9yZW1vdmVMaW5lKGV2ZW50LCBvcHRpb25zKSB7XG4gICAgICB0aGlzLm1vZGVsXG4gICAgICAgIC5nZXQoXCJjb250ZW50XCIpXG4gICAgICAgIC5lYWNoKGZ1bmN0aW9uIHZBcnJheV9yZW1vdmVMaW5lKGN1cnJlbnRDb250ZW50KSB7XG4gICAgICAgICAgY3VycmVudENvbnRlbnQucmVtb3ZlSW5kZXhWYWx1ZShvcHRpb25zLmxpbmUpO1xuICAgICAgICB9KTtcbiAgICAgIHRoaXMubW9kZWwudHJpZ2dlcihcImFycmF5XCIsIFwicmVtb3ZlTGluZVwiLCB0aGlzLm1vZGVsLCBvcHRpb25zLmxpbmUpO1xuICAgIH0sXG5cbiAgICByZW1vdmVXaWRnZXRMaW5lOiBmdW5jdGlvbiB2QXJyYXlfUmVtb3ZlV2lkZ2V0TGluZShvcHRpb25zKSB7XG4gICAgICB0aGlzLiRlbC5kY3BBcnJheShcInJlbW92ZUxpbmVcIiwgb3B0aW9ucy5pbmRleCwgeyBzaWxlbnQ6IHRydWUgfSk7XG4gICAgfSxcblxuICAgIGFkZFdpZGdldExpbmU6IGZ1bmN0aW9uIHZBcnJheV9hZGRXaWRnZXRMaW5lKG9wdGlvbnMpIHtcbiAgICAgIHRoaXMuJGVsLmRjcEFycmF5KFwiYWRkTGluZVwiLCBvcHRpb25zLmluZGV4KTtcbiAgICB9LFxuXG4gICAgYWRkTGluZTogZnVuY3Rpb24gdkFycmF5X0FkZExpbmUoZXZlbnQsIG9wdGlvbnMpIHtcbiAgICAgIHZhciBjdXJyZW50QXJyYXlWaWV3ID0gdGhpcyxcbiAgICAgICAgY3VzdG9tVmlldyA9IG51bGw7XG4gICAgICB2YXIgYWxsUHJvbWlzZUF0dHJpYnV0ZXMgPSBbXTtcbiAgICAgIHRoaXMubW9kZWxcbiAgICAgICAgLmdldChcImNvbnRlbnRcIilcbiAgICAgICAgLmVhY2goZnVuY3Rpb24gdkFycmF5X2FkZExpbmVHZXRDb250ZW50KGN1cnJlbnRDb250ZW50KSB7XG4gICAgICAgICAgdmFyIGN1cnJlbnRWaWV3Q29sdW1uO1xuICAgICAgICAgIGlmIChvcHRpb25zLm5lZWRBZGRWYWx1ZSB8fCBvcHRpb25zLmNvcHlWYWx1ZSkge1xuICAgICAgICAgICAgY3VycmVudENvbnRlbnQuY3JlYXRlSW5kZXhlZFZhbHVlKG9wdGlvbnMubGluZSwgb3B0aW9ucy5jb3B5VmFsdWUpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjdXJyZW50Vmlld0NvbHVtbiA9IGN1cnJlbnRBcnJheVZpZXcuY29sdW1uVmlld3NbY3VycmVudENvbnRlbnQuaWRdO1xuICAgICAgICAgIGlmIChjdXJyZW50Vmlld0NvbHVtbikge1xuICAgICAgICAgICAgY3VzdG9tVmlldyA9IG51bGw7XG4gICAgICAgICAgICBpZiAoY3VycmVudENvbnRlbnQuZ2V0T3B0aW9uKFwidGVtcGxhdGVcIikpIHtcbiAgICAgICAgICAgICAgY3VzdG9tVmlldyA9IGF0dHJpYnV0ZVRlbXBsYXRlLnJlbmRlckN1c3RvbVZpZXcoXG4gICAgICAgICAgICAgICAgY3VycmVudENvbnRlbnQsXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gdkFycmF5X2N1c3RvbVZpZXdJbml0KCkge1xuICAgICAgICAgICAgICAgICAgdmFyICR0aGlzID0gJCh0aGlzKSxcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudFdpZGdldE9wdGlvbiA9IGN1cnJlbnRWaWV3Q29sdW1uLmdldERhdGEoXG4gICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5saW5lXG4gICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgICAvL0NoZWNrIGlmIHRoZSBhc2tlZCBhdHRyaWJ1dGUgaXMgdGhlIGN1cnJlbnQgYXR0cmlidXRlXG4gICAgICAgICAgICAgICAgICBpZiAoJHRoaXMuZGF0YShcImF0dHJpZFwiKSAhPT0gY3VycmVudENvbnRlbnQuaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgRXJyb3IoXG4gICAgICAgICAgICAgICAgICAgICAgXCJBbiBhdHRyaWJ1dGUgdGVtcGxhdGUgaW4gYW4gYXJyYXkgY2Fubm90IGFza2VkXCIgK1xuICAgICAgICAgICAgICAgICAgICAgICAgXCIgZm9yIGFub3RoZXIgYXR0cmlidXRlIHRoYW4gdGhlIGN1cnJlbnQgKFwiICtcbiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLmRhdGEoXCJhdHRyaWRcIikgK1xuICAgICAgICAgICAgICAgICAgICAgICAgXCIgYXNrZWQgaW5zdGVhZCBvZiBcIiArXG4gICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50Q29udGVudC5pZCArXG4gICAgICAgICAgICAgICAgICAgICAgICBcIilcIlxuICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgY3VycmVudFdpZGdldE9wdGlvbi52aWV3Q2lkID0gXy51bmlxdWVJZChcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudFdpZGdldE9wdGlvbi52aWV3Q2lkXG4gICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgICAgY3VycmVudFZpZXdDb2x1bW4ud2lkZ2V0SW5pdCgkdGhpcywgY3VycmVudFdpZGdldE9wdGlvbik7XG4gICAgICAgICAgICAgICAgICBjdXJyZW50Vmlld0NvbHVtbi5tb3ZlVmFsdWVJbmRleCh7fSk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB7IGluZGV4OiBvcHRpb25zLmxpbmUgfVxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICBhbGxQcm9taXNlQXR0cmlidXRlcy5wdXNoKGN1c3RvbVZpZXcucHJvbWlzZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoY3VzdG9tVmlldyAmJiBjdXN0b21WaWV3LiRlbCkge1xuICAgICAgICAgICAgICBhbGxQcm9taXNlQXR0cmlidXRlcy5wdXNoKFxuICAgICAgICAgICAgICAgIGN1cnJlbnRWaWV3Q29sdW1uLmFkZE5ld1dpZGdldChvcHRpb25zLmxpbmUsIGN1c3RvbVZpZXcuJGVsKVxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgYWxsUHJvbWlzZUF0dHJpYnV0ZXMucHVzaChcbiAgICAgICAgICAgICAgICBjdXJyZW50Vmlld0NvbHVtbi5hZGROZXdXaWRnZXQob3B0aW9ucy5saW5lKVxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICBQcm9taXNlLmFsbChhbGxQcm9taXNlQXR0cmlidXRlcylcbiAgICAgICAgLnRoZW4oXG4gICAgICAgICAgXy5iaW5kKGZ1bmN0aW9uIGFkZGxpbmVQcm9taXNlQWxsRG9uZSgpIHtcbiAgICAgICAgICAgIHRoaXMubW9kZWwudHJpZ2dlcihcImFycmF5XCIsIFwiYWRkTGluZVwiLCB0aGlzLm1vZGVsLCBvcHRpb25zLmxpbmUpO1xuICAgICAgICAgICAgb3B0aW9ucy5yZXNvbHZlKCk7XG4gICAgICAgICAgfSwgdGhpcylcbiAgICAgICAgKVxuICAgICAgICAuY2F0Y2gob3B0aW9ucy5yZWplY3QpO1xuICAgIH0sXG5cbiAgICBtb3ZlTGluZTogZnVuY3Rpb24gdkFycmF5X21vdmVMaW5lKGV2ZW50LCBvcHRpb25zKSB7XG4gICAgICB0aGlzLm1vZGVsXG4gICAgICAgIC5nZXQoXCJjb250ZW50XCIpXG4gICAgICAgIC5lYWNoKGZ1bmN0aW9uIHZBcnJheV9nZXRNb3ZlTGluZUNvbnRlbnQoY3VycmVudENvbnRlbnQpIHtcbiAgICAgICAgICBjdXJyZW50Q29udGVudC5tb3ZlSW5kZXhWYWx1ZShvcHRpb25zLmZyb21MaW5lLCBvcHRpb25zLnRvTGluZSk7XG4gICAgICAgIH0pO1xuICAgICAgdGhpcy5tb2RlbC50cmlnZ2VyKFwiYXJyYXlcIiwgXCJtb3ZlTGluZVwiLCB0aGlzLm1vZGVsLCBvcHRpb25zKTtcbiAgICB9LFxuICAgIGdldEF0dHJpYnV0ZU1vZGVsOiBmdW5jdGlvbiB2QXJyYXlfZ2V0QXR0cmlidXRlTW9kZWwoYXR0cmlidXRlSWQpIHtcbiAgICAgIHZhciBkb2NNb2RlbCA9IHRoaXMubW9kZWwuZ2V0RG9jdW1lbnRNb2RlbCgpO1xuICAgICAgcmV0dXJuIGRvY01vZGVsLmdldChcImF0dHJpYnV0ZXNcIikuZ2V0KGF0dHJpYnV0ZUlkKTtcbiAgICB9LFxuXG4gICAgc2V0RXJyb3I6IGZ1bmN0aW9uIHZBcnJheV9zZXRFcnJvcihldmVudCwgbWVzc2FnZSkge1xuICAgICAgdmFyIHBhcmVudElkID0gdGhpcy5tb2RlbC5nZXQoXCJwYXJlbnRcIik7XG5cbiAgICAgIGlmIChtZXNzYWdlKSB7XG4gICAgICAgIHRoaXMuJGVsLmZpbmQoXCIuZGNwQXJyYXlfX2xhYmVsXCIpLmFkZENsYXNzKFwiaGFzLWVycm9yXCIpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy4kZWwuZmluZChcIi5kY3BBcnJheV9fbGFiZWxcIikucmVtb3ZlQ2xhc3MoXCJoYXMtZXJyb3JcIik7XG4gICAgICB9XG5cbiAgICAgIGlmIChwYXJlbnRJZCkge1xuICAgICAgICB2YXIgcGFyZW50TW9kZWwgPSB0aGlzLmdldEF0dHJpYnV0ZU1vZGVsKHBhcmVudElkKTtcbiAgICAgICAgaWYgKHBhcmVudE1vZGVsKSB7XG4gICAgICAgICAgcGFyZW50TW9kZWwudHJpZ2dlcihcImVycm9yTWVzc2FnZVwiLCBldmVudCwgbWVzc2FnZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuICAgIHNldEFycmF5RXJyb3I6IGZ1bmN0aW9uIHZBcnJheV9zZXRBcnJheUVycm9yKGV2ZW50LCBtZXNzYWdlKSB7XG4gICAgICB0aGlzLnNldEVycm9yKGV2ZW50LCBtZXNzYWdlKTtcbiAgICAgIC8vIGdsb2JhbCBlcnJvciBvbiBhcnJheSBpdHNlbGZcbiAgICAgIHRoaXMuJGVsLmRjcEFycmF5KFwic2V0RXJyb3JcIiwgbWVzc2FnZSk7XG4gICAgfSxcblxuICAgIGhpZGU6IGZ1bmN0aW9uIHZBcnJheV9oaWRlKCkge1xuICAgICAgdGhpcy4kZWwuaGlkZSgpO1xuICAgIH0sXG5cbiAgICBzaG93OiBmdW5jdGlvbiB2QXJyYXlfc2hvdygpIHtcbiAgICAgIHRoaXMuJGVsLnNob3coKTtcbiAgICB9LFxuXG4gICAgX2lkZW50aWZ5VmlldzogZnVuY3Rpb24gdkFycmF5X2lkZW50aWZ5VmlldyhldmVudCkge1xuICAgICAgZXZlbnQuaGF2ZVZpZXcgPSB0cnVlO1xuICAgICAgLy9BZGQgdGhlIHBvaW50ZXIgdG8gdGhlIGN1cnJlbnQganF1ZXJ5IGVsZW1lbnQgdG8gYSBsaXN0IHBhc3NlZCBieSB0aGUgZXZlbnRcbiAgICAgIGV2ZW50LmVsZW1lbnRzID0gZXZlbnQuZWxlbWVudHMuYWRkKHRoaXMuJGVsKTtcbiAgICB9LFxuICAgIGV4dGVybmFsTGlua1NlbGVjdGVkOiBmdW5jdGlvbiB2QXJyYXlFeHRlcm5hbExpbmtTZWxlY3RlZChldmVudCwgb3B0aW9ucykge1xuICAgICAgdmFyIGRvY3VtZW50TW9kZWwgPSB0aGlzLm1vZGVsLmdldERvY3VtZW50TW9kZWwoKTtcbiAgICAgIG9wdGlvbnMuYXR0cmlkID0gdGhpcy5tb2RlbC5pZDtcbiAgICAgIHRoaXMubW9kZWwudHJpZ2dlcihcImludGVybmFsTGlua1NlbGVjdGVkXCIsIGV2ZW50LCBvcHRpb25zKTtcbiAgICAgIGlmIChldmVudC5wcmV2ZW50KSB7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgfVxuICAgICAgZG9jdW1lbnRNb2RlbC50cmlnZ2VyKFwiYWN0aW9uQXR0cmlidXRlTGlua1wiLCBldmVudCwgb3B0aW9ucyk7XG4gICAgfVxuICB9KTtcbn0pO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///2396a71337586706882f\n");

/***/ }),

/***/ "25094ffcb8bcd2bb587c":
/*!******************************************************************!*\
  !*** ./src/Apps/DOCUMENT/IHM/widgets/attributes/label/wLabel.js ***!
  \******************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;(function umdRequire(root, factory) {\n  \"use strict\";\n\n  if (true) {\n    !(__WEBPACK_AMD_DEFINE_ARRAY__ = [\n      __webpack_require__(/*! jquery */ \"127c8cf59f228bb01a21\"),\n      __webpack_require__(/*! underscore */ \"8e08e542008e4aef1f58\"),\n      __webpack_require__(/*! mustache */ \"bcd31d01884fc294fd69\"),\n      __webpack_require__(/*! dcpDocument/widgets/widget */ \"f562ab9f022eef93542c\")\n    ], __WEBPACK_AMD_DEFINE_FACTORY__ = (factory),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?\n\t\t\t\t(__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n  } else {}\n})(window, function requireDcpLabel($, _, Mustache) {\n  \"use strict\";\n\n  $.widget(\"dcp.dcpLabel\", {\n    options: {\n      renderOptions: {\n        helpLinkIdentifier: 0\n      },\n      labels: {\n        helpTitle: \"Info\"\n      }\n    },\n    _create: function wLabel_create() {\n      this._initDom();\n      this._initActionClickEvent();\n    },\n\n    _initDom: function wLabel_initDom() {\n      this.element.addClass(\"dcpAttribute__label control-label dcpLabel\");\n      this.element.append(\n        Mustache.render(this._getTemplate() || \"\", this.options)\n      );\n      if (\n        this.options.renderOptions &&\n        this.options.renderOptions.attributeLabel\n      ) {\n        this.setLabel(this.options.renderOptions.attributeLabel);\n      }\n    },\n\n    /**\n     * Init event for #action/ links\n     *\n     * @protected\n     */\n    _initActionClickEvent: function wAttributeInitActionClickEvent() {\n      var scopeWidget = this;\n\n      this.element.on(\n        \"click.\" + this.eventNamespace,\n        'a[href^=\"#action/\"], a[data-action], button[data-action]',\n        function wAttributeActionClick(event) {\n          var $this = $(this),\n            action,\n            options,\n            eventOptions;\n\n          event.preventDefault();\n          if (event.stopPropagation) {\n            event.stopPropagation();\n          }\n\n          action = $this.data(\"action\") || $this.attr(\"href\");\n          options = action.substring(8).split(\":\");\n          eventOptions = {\n            target: event.target,\n            index: -1,\n            eventId: options.shift(),\n            options: options\n          };\n\n          scopeWidget._trigger(\"externalLinkSelected\", event, eventOptions);\n          return this;\n        }\n      );\n    },\n\n    setLabel: function wLabelSetLabel(label) {\n      this.element.find(\"label\").text(label);\n    },\n\n    setError: function wLabelSetError(message) {\n      if (message) {\n        this.element.addClass(\"has-error\");\n      } else {\n        this.element.removeClass(\"has-error\");\n      }\n    },\n\n    _getTemplate: function wLabel_getTemplate() {\n      if (this.options.templates && this.options.templates.label) {\n        return this.options.templates.label;\n      }\n      if (window.dcp && window.dcp.templates && window.dcp.templates.label) {\n        return window.dcp.templates.label;\n      }\n      throw new Error(\"Unknown label template \");\n    }\n  });\n\n  return $.fn.dcpLabel;\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjUwOTRmZmNiOGJjZDJiYjU4N2MuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvQXBwcy9ET0NVTUVOVC9JSE0vd2lkZ2V0cy9hdHRyaWJ1dGVzL2xhYmVsL3dMYWJlbC5qcz8zZGU2Il0sInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiB1bWRSZXF1aXJlKHJvb3QsIGZhY3RvcnkpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgaWYgKHR5cGVvZiBkZWZpbmUgPT09IFwiZnVuY3Rpb25cIiAmJiBkZWZpbmUuYW1kKSB7XG4gICAgZGVmaW5lKFtcbiAgICAgIFwianF1ZXJ5XCIsXG4gICAgICBcInVuZGVyc2NvcmVcIixcbiAgICAgIFwibXVzdGFjaGVcIixcbiAgICAgIFwiZGNwRG9jdW1lbnQvd2lkZ2V0cy93aWRnZXRcIlxuICAgIF0sIGZhY3RvcnkpO1xuICB9IGVsc2Uge1xuICAgIC8vbm9pbnNwZWN0aW9uIEpTVW5yZXNvbHZlZFZhcmlhYmxlXG4gICAgZmFjdG9yeSh3aW5kb3cualF1ZXJ5LCB3aW5kb3cuXywgd2luZG93Lk11c3RhY2hlKTtcbiAgfVxufSkod2luZG93LCBmdW5jdGlvbiByZXF1aXJlRGNwTGFiZWwoJCwgXywgTXVzdGFjaGUpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgJC53aWRnZXQoXCJkY3AuZGNwTGFiZWxcIiwge1xuICAgIG9wdGlvbnM6IHtcbiAgICAgIHJlbmRlck9wdGlvbnM6IHtcbiAgICAgICAgaGVscExpbmtJZGVudGlmaWVyOiAwXG4gICAgICB9LFxuICAgICAgbGFiZWxzOiB7XG4gICAgICAgIGhlbHBUaXRsZTogXCJJbmZvXCJcbiAgICAgIH1cbiAgICB9LFxuICAgIF9jcmVhdGU6IGZ1bmN0aW9uIHdMYWJlbF9jcmVhdGUoKSB7XG4gICAgICB0aGlzLl9pbml0RG9tKCk7XG4gICAgICB0aGlzLl9pbml0QWN0aW9uQ2xpY2tFdmVudCgpO1xuICAgIH0sXG5cbiAgICBfaW5pdERvbTogZnVuY3Rpb24gd0xhYmVsX2luaXREb20oKSB7XG4gICAgICB0aGlzLmVsZW1lbnQuYWRkQ2xhc3MoXCJkY3BBdHRyaWJ1dGVfX2xhYmVsIGNvbnRyb2wtbGFiZWwgZGNwTGFiZWxcIik7XG4gICAgICB0aGlzLmVsZW1lbnQuYXBwZW5kKFxuICAgICAgICBNdXN0YWNoZS5yZW5kZXIodGhpcy5fZ2V0VGVtcGxhdGUoKSB8fCBcIlwiLCB0aGlzLm9wdGlvbnMpXG4gICAgICApO1xuICAgICAgaWYgKFxuICAgICAgICB0aGlzLm9wdGlvbnMucmVuZGVyT3B0aW9ucyAmJlxuICAgICAgICB0aGlzLm9wdGlvbnMucmVuZGVyT3B0aW9ucy5hdHRyaWJ1dGVMYWJlbFxuICAgICAgKSB7XG4gICAgICAgIHRoaXMuc2V0TGFiZWwodGhpcy5vcHRpb25zLnJlbmRlck9wdGlvbnMuYXR0cmlidXRlTGFiZWwpO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBJbml0IGV2ZW50IGZvciAjYWN0aW9uLyBsaW5rc1xuICAgICAqXG4gICAgICogQHByb3RlY3RlZFxuICAgICAqL1xuICAgIF9pbml0QWN0aW9uQ2xpY2tFdmVudDogZnVuY3Rpb24gd0F0dHJpYnV0ZUluaXRBY3Rpb25DbGlja0V2ZW50KCkge1xuICAgICAgdmFyIHNjb3BlV2lkZ2V0ID0gdGhpcztcblxuICAgICAgdGhpcy5lbGVtZW50Lm9uKFxuICAgICAgICBcImNsaWNrLlwiICsgdGhpcy5ldmVudE5hbWVzcGFjZSxcbiAgICAgICAgJ2FbaHJlZl49XCIjYWN0aW9uL1wiXSwgYVtkYXRhLWFjdGlvbl0sIGJ1dHRvbltkYXRhLWFjdGlvbl0nLFxuICAgICAgICBmdW5jdGlvbiB3QXR0cmlidXRlQWN0aW9uQ2xpY2soZXZlbnQpIHtcbiAgICAgICAgICB2YXIgJHRoaXMgPSAkKHRoaXMpLFxuICAgICAgICAgICAgYWN0aW9uLFxuICAgICAgICAgICAgb3B0aW9ucyxcbiAgICAgICAgICAgIGV2ZW50T3B0aW9ucztcblxuICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgaWYgKGV2ZW50LnN0b3BQcm9wYWdhdGlvbikge1xuICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgYWN0aW9uID0gJHRoaXMuZGF0YShcImFjdGlvblwiKSB8fCAkdGhpcy5hdHRyKFwiaHJlZlwiKTtcbiAgICAgICAgICBvcHRpb25zID0gYWN0aW9uLnN1YnN0cmluZyg4KS5zcGxpdChcIjpcIik7XG4gICAgICAgICAgZXZlbnRPcHRpb25zID0ge1xuICAgICAgICAgICAgdGFyZ2V0OiBldmVudC50YXJnZXQsXG4gICAgICAgICAgICBpbmRleDogLTEsXG4gICAgICAgICAgICBldmVudElkOiBvcHRpb25zLnNoaWZ0KCksXG4gICAgICAgICAgICBvcHRpb25zOiBvcHRpb25zXG4gICAgICAgICAgfTtcblxuICAgICAgICAgIHNjb3BlV2lkZ2V0Ll90cmlnZ2VyKFwiZXh0ZXJuYWxMaW5rU2VsZWN0ZWRcIiwgZXZlbnQsIGV2ZW50T3B0aW9ucyk7XG4gICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgfSxcblxuICAgIHNldExhYmVsOiBmdW5jdGlvbiB3TGFiZWxTZXRMYWJlbChsYWJlbCkge1xuICAgICAgdGhpcy5lbGVtZW50LmZpbmQoXCJsYWJlbFwiKS50ZXh0KGxhYmVsKTtcbiAgICB9LFxuXG4gICAgc2V0RXJyb3I6IGZ1bmN0aW9uIHdMYWJlbFNldEVycm9yKG1lc3NhZ2UpIHtcbiAgICAgIGlmIChtZXNzYWdlKSB7XG4gICAgICAgIHRoaXMuZWxlbWVudC5hZGRDbGFzcyhcImhhcy1lcnJvclwiKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuZWxlbWVudC5yZW1vdmVDbGFzcyhcImhhcy1lcnJvclwiKTtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgX2dldFRlbXBsYXRlOiBmdW5jdGlvbiB3TGFiZWxfZ2V0VGVtcGxhdGUoKSB7XG4gICAgICBpZiAodGhpcy5vcHRpb25zLnRlbXBsYXRlcyAmJiB0aGlzLm9wdGlvbnMudGVtcGxhdGVzLmxhYmVsKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm9wdGlvbnMudGVtcGxhdGVzLmxhYmVsO1xuICAgICAgfVxuICAgICAgaWYgKHdpbmRvdy5kY3AgJiYgd2luZG93LmRjcC50ZW1wbGF0ZXMgJiYgd2luZG93LmRjcC50ZW1wbGF0ZXMubGFiZWwpIHtcbiAgICAgICAgcmV0dXJuIHdpbmRvdy5kY3AudGVtcGxhdGVzLmxhYmVsO1xuICAgICAgfVxuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVW5rbm93biBsYWJlbCB0ZW1wbGF0ZSBcIik7XG4gICAgfVxuICB9KTtcblxuICByZXR1cm4gJC5mbi5kY3BMYWJlbDtcbn0pO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUNBLFdBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///25094ffcb8bcd2bb587c\n");

/***/ }),

/***/ "278ba7757aa1904087c6":
/*!*******************************************************!*\
  !*** ./src/Apps/DOCUMENT/IHM/i18n/documentCatalog.js ***!
  \*******************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;window.dcp = window.dcp || {};\n\n(function umdRequire(root, factory) {\n  \"use strict\";\n\n  if (true) {\n    !(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(/*! dcpDocument/i18n/translatorFactory */ \"6d281ded32c7dc89e58d\")], __WEBPACK_AMD_DEFINE_FACTORY__ = (factory),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?\n\t\t\t\t(__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n  } else {}\n})(window, function documentCatalog(translatorFactory) {\n  \"use strict\";\n  //Register document translation in the global window.dcp.documentCatalog\n  window.dcp.documentCatalog = translatorFactory(window.dcp.i18n);\n  return window.dcp.documentCatalog;\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjc4YmE3NzU3YWExOTA0MDg3YzYuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvQXBwcy9ET0NVTUVOVC9JSE0vaTE4bi9kb2N1bWVudENhdGFsb2cuanM/ZTcxYiJdLCJzb3VyY2VzQ29udGVudCI6WyJ3aW5kb3cuZGNwID0gd2luZG93LmRjcCB8fCB7fTtcblxuKGZ1bmN0aW9uIHVtZFJlcXVpcmUocm9vdCwgZmFjdG9yeSkge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICBpZiAodHlwZW9mIGRlZmluZSA9PT0gXCJmdW5jdGlvblwiICYmIGRlZmluZS5hbWQpIHtcbiAgICBkZWZpbmUoW1wiZGNwRG9jdW1lbnQvaTE4bi90cmFuc2xhdG9yRmFjdG9yeVwiXSwgZmFjdG9yeSk7XG4gIH0gZWxzZSB7XG4gICAgLy9Mb2FkIHRyYW5zbGF0aW9uIGFuZCBsb2FkIGkxOG4gaGFuZGxlciBmb3Igbm9uIHJlcXVpcmUgcHJvamVjdFxuICAgICQuZ2V0KFwiYXBpL3YyL2kxOG4vRE9DVU1FTlRcIikuZG9uZShmdW5jdGlvbiB0cmFuc2xhdGlvbkxvYWRlZChjYXRhbG9nKSB7XG4gICAgICB3aW5kb3cuZGNwLmkxOG4gPSBjYXRhbG9nO1xuICAgICAgZmFjdG9yeSh3aW5kb3cuZGNwLnRyYW5zbGF0b3JGYWN0b3J5KTtcbiAgICAgIC8vVHJpZ2dlciBhbiBldmVudCB3aGVuIHRyYW5zbGF0aW9uIGxvYWRlZFxuICAgICAgJCh3aW5kb3cpLnRyaWdnZXIoXCJkb2N1bWVudENhdGFsb2dMb2FkZWRcIik7XG4gICAgfSk7XG4gIH1cbn0pKHdpbmRvdywgZnVuY3Rpb24gZG9jdW1lbnRDYXRhbG9nKHRyYW5zbGF0b3JGYWN0b3J5KSB7XG4gIFwidXNlIHN0cmljdFwiO1xuICAvL1JlZ2lzdGVyIGRvY3VtZW50IHRyYW5zbGF0aW9uIGluIHRoZSBnbG9iYWwgd2luZG93LmRjcC5kb2N1bWVudENhdGFsb2dcbiAgd2luZG93LmRjcC5kb2N1bWVudENhdGFsb2cgPSB0cmFuc2xhdG9yRmFjdG9yeSh3aW5kb3cuZGNwLmkxOG4pO1xuICByZXR1cm4gd2luZG93LmRjcC5kb2N1bWVudENhdGFsb2c7XG59KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFDQSxXQVFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///278ba7757aa1904087c6\n");

/***/ }),

/***/ "2b8c963e23b3e828472e":
/*!*************************************************************!*\
  !*** ./src/Apps/DOCUMENT/IHM/views/workflow/vTransition.js ***!
  \*************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;!(__WEBPACK_AMD_DEFINE_ARRAY__ = [\n  __webpack_require__(/*! underscore */ \"8e08e542008e4aef1f58\"),\n  __webpack_require__(/*! jquery */ \"127c8cf59f228bb01a21\"),\n  __webpack_require__(/*! backbone */ \"1858b45bf48591489d06\"),\n  __webpack_require__(/*! mustache */ \"bcd31d01884fc294fd69\"),\n  __webpack_require__(/*! dcpDocument/views/document/vDocument */ \"07b96fa8c545aab31dad\"),\n  __webpack_require__(/*! dcpDocument/widgets/window/wDialog */ \"0bd0aa4c1909a49f67bb\")\n], __WEBPACK_AMD_DEFINE_RESULT__ = (function vTransition(_, $, Backbone, Mustache, ViewDocument) {\n  \"use strict\";\n\n  return ViewDocument.extend({\n    messages: [],\n\n    templates: {\n      htmlContent:\n        '<div class=\"dcpTransition--content-activity\" >' +\n        ' <span class=\"dcpTransition--activity\" style=\"border-color:{{transition.beginState.color}}\">{{transition.beginState.displayValue}}</span>' +\n        '<span class=\"dcpTransition--transition {{^transition.id}}dcpTransition--transition--invalid{{/transition.id}}\" >{{transition.label}}</span>' +\n        '<span class=\"dcpTransition--arrow\"><span class=\"fa fa-caret-right fa-2x {{^transition.id}}dcpTransition--transition--invalid{{/transition.id}}\"></span></span>' +\n        '<span class=\"dcpTransition--activity\" style=\"border-color:{{transition.endState.color}}\">{{transition.endState.displayValue}}</span> ' +\n        \"</div>\",\n\n      htmlStateContent:\n        '<div class=\"dcpTransition--content-activity\">' +\n        '<span class=\"dcpTransition--success\" >{{labels.success}}</span>' +\n        \"</div>\",\n\n      htmlStateButtons:\n        '<button title=\"{{labels.close}}\" class=\"dcpTransition-button-close btn btn-outline-secondary btn-sm\">' +\n        \"{{labels.close}} </button>\",\n\n      htmlLoading:\n        '<div class=\"dcpTransition--loading\"><span class=\"fa fa-2x fa-spinner fa-spin\"></span> {{labels.inprogress}}</div>',\n\n      htmlButtons:\n        '{{#hasAttributes}}<button class=\"dcpTransition-button-cancel btn btn-outline-secondary btn-sm\">{{labels.cancel}}</button>' +\n        '<button title=\"{{transition.label}}\" ' +\n        'class=\"dcpTransition-button-ok btn {{#transition.id}}btn-primary{{/transition.id}}  {{^transition.id}}btn-danger{{/transition.id}} btn-sm\">' +\n        \"{{labels.confirm}}</button>{{/hasAttributes}}\"\n    },\n\n    events: {\n      \"click .dcpTransition-button-ok \": \"clickOnOk\",\n      \"click .dcpTransition-button-cancel\": \"clickOnCancel\",\n      \"click .dcpTransition-button-close\": \"clickOnClose\"\n    },\n\n    initialize: function vTransition_initialize(options) {\n      //Call parent\n      ViewDocument.prototype.initialize.apply(this, arguments);\n      this.listenTo(this.model, \"showError\", this.displayError);\n      //this.listenTo(this.model, 'invalid', this.displayError);\n      this.listenTo(this.model, \"request\", this.transitionDisplayLoading);\n      this.listenTo(this.model, \"hide\", function vTransition_hide() {\n        this.$el.hide();\n      });\n      this.listenTo(this.model, \"show\", function vTransition_show() {\n        this.$el.show();\n      });\n      this.listenTo(this.model, \"close\", function vTransition_close() {\n        if (this.transitionWindow) {\n          this.transitionWindow.close();\n        }\n      });\n      this.options = options;\n    },\n\n    remove: function vTransition_remove() {\n      if (this.transitionWindow) {\n        this.transitionWindow.close();\n      }\n      //Call parent\n      ViewDocument.prototype.remove.apply(this, arguments);\n      //Remove custom CSS\n      var customCss = _.pluck(this.model.get(\"customCSS\"), \"key\");\n      if (customCss.length > 0) {\n        _.each(customCss, function vTransition_removeLink(cssKey) {\n          $('link[data-view=true][data-id=\"' + cssKey + '\"]').remove();\n        });\n      }\n    },\n\n    displayError: function vTransition_displayError(error) {\n      var workflow = this.model.get(\"workflow\"),\n        attributes = this.model.get(\"attributes\"),\n        $okButton = this.$el.find(\".dcpTransition-button-ok\"),\n        $cancelButton = this.$el.find(\".dcpTransition-button-cancel\"),\n        errorMessage;\n      this.reactiveWidget();\n      if (_.isObject(error)) {\n        if (error.errorCode === \"offline\") {\n          errorMessage =\n            '<div class=\"dcpTransition--error\">{{{htmlMessage}}}</div>';\n        } else {\n          errorMessage =\n            '<div class=\"dcpTransition--error\">{{title}} {{{htmlMessage}}}</div>';\n        }\n        $(Mustache.render(errorMessage || \"\", error)).insertBefore(\n          this.$el.find(\".dcpTransition--buttons\")\n        );\n      }\n      if (attributes.length === 0) {\n        $okButton.hide();\n        $cancelButton.text(workflow.labels.close);\n      } else {\n        //noinspection JSUnresolvedVariable\n        $okButton.text(workflow.labels.retry);\n      }\n    },\n\n    cleanAndRender: function vTransition_cleanAndRender() {\n      var workflow = this.model.get(\"workflow\"),\n        transition = workflow.transition,\n        state = workflow.state;\n\n      this.render();\n      this.displayMessages(this.model.get(\"messages\"));\n      this.clearError();\n      this.reactiveWidget();\n      if (!transition && state) {\n        this.model.trigger(\"success\", this.messages);\n      }\n    },\n    /**\n     * Inject associated CSS in the DOM\n     *\n     * Inject new CSS, no remove old CSS\n     */\n    renderCss: function vTransitionRenderCss() {\n      ViewDocument.prototype.renderCss.apply(this, [true]);\n    },\n    updateTitle: function vTransitionupdateTitle() {\n      // No update title\n    },\n    updateIcon: function vTransitionupdateIcon() {\n      // No update icon\n    },\n    clearError: function vTransition_clearError() {\n      this.$el.find(\".dcpTransition--error\").remove();\n    },\n\n    reactiveWidget: function vTransition_reactiveWidget() {\n      var workflow = this.model.get(\"workflow\"),\n        attributes = this.model.get(\"attributes\"),\n        $loading = this.$el.find(\".dcpTransition--loading\"),\n        $okButton = this.$el.find(\".dcpTransition-button-ok\"),\n        $cancelButton = this.$el.find(\".dcpTransition-button-cancel\");\n\n      if (attributes.length > 0) {\n        if (workflow && workflow.labels.confirm) {\n          $okButton.text(workflow.labels.confirm);\n        }\n        $okButton.prop(\"disabled\", false);\n      }\n      $cancelButton.prop(\"disabled\", false);\n\n      this.$el.find(\".dcpDocument--disabled\").remove();\n      $loading.hide();\n    },\n\n    /**\n     * Display the loading widget\n     */\n    transitionDisplayLoading: function vTransition_transitionDisplayLoading() {\n      var $loading = this.$el.find(\".dcpTransition--loading\"),\n        $okButton = this.$el.find(\".dcpTransition-button-ok\"),\n        $cancelButton = this.$el.find(\".dcpTransition-button-cancel\");\n\n      $loading.show();\n      this.clearError();\n      $okButton.prop(\"disabled\", true);\n      $cancelButton.prop(\"disabled\", true);\n    },\n\n    displayMessages: function vTransition_displayMessages(messages) {\n      var currentView = this,\n        template =\n          '<div class=\"dcpTransition--message dcpTransition--message--{{type}}\">{{contentText}} {{{contentHtml}}}</div>',\n        $message = this.$el.find(\".dcpTransition--messages\");\n\n      this.messages = [];\n\n      _.each(messages, function vTransition_analyzeCurrentMessage(message) {\n        $message.append($(Mustache.render(template || \"\", message)));\n        //noinspection JSUnresolvedVariable\n        currentView.messages.push({\n          title: message.contentText,\n          type: message.type,\n          htmlMessage: message.contentHtml\n        });\n      });\n    },\n\n    /**\n     * Render the document view\n     * @returns {*}\n     */\n    render: function vTransition_render() {\n      var currentView = this,\n        workflow = this.model.get(\"workflow\"),\n        attributes = this.model.get(\"attributes\"),\n        transition = workflow.transition,\n        state = workflow.state;\n\n      //Call parent\n      ViewDocument.prototype.render.apply(this, arguments);\n\n      workflow.hasAttributes = attributes.length > 0;\n      if (transition) {\n        // Transition ask\n        this.$el\n          .find(\".dcpTransition--header\")\n          .append(Mustache.render(this.templates.htmlContent || \"\", workflow));\n        this.$el\n          .find(\".dcpTransition--messages\")\n          .append(Mustache.render(this.templates.htmlLoading || \"\", workflow));\n        this.$el\n          .find(\".dcpTransition--buttons\")\n          .append(Mustache.render(this.templates.htmlButtons || \"\", workflow));\n        this.$el.find(\".dcpTransition-button-ok\").tooltip();\n\n        if (attributes.length === 0) {\n          // Direct send transition without user control\n          _.defer(function vTransition_saveForMe() {\n            var event = { prevent: false },\n              saveXhr;\n            currentView.model.trigger(\"beforeChangeState\", event);\n            if (event.prevent === false) {\n              saveXhr = currentView.model.save();\n              if (saveXhr) {\n                saveXhr\n                  .then(function vTransition_direct_afterSave() {\n                    currentView.model.trigger(\n                      \"success\",\n                      currentView.getMessages()\n                    );\n                  })\n                  .fail(function vTransition_direct_error(\n                    response,\n                    statusTxt,\n                    errorTxt\n                  ) {\n                    if (response.responseJSON) {\n                      let userMessage = response.responseJSON.userMessage;\n\n                      response.responseJSON.messages =\n                        response.responseJSON.messages || [];\n                      response.responseJSON.messages.push({\n                        contentText: userMessage\n                      });\n                      _.each(\n                        response.responseJSON.messages,\n                        function vTransition_clickOnOk_displayError(aMessage) {\n                          currentView.displayError({\n                            title: aMessage.contentText\n                          });\n                        }\n                      );\n                    } else {\n                      if (errorTxt && !errorTxt.title && errorTxt.message) {\n                        errorTxt.title = errorTxt.message;\n                        currentView.displayError(errorTxt);\n                      } else if (_.isString(errorTxt)) {\n                        currentView.displayError({ title: errorTxt });\n                      }\n                    }\n                  });\n              }\n            }\n          });\n        }\n        this.$el.attr(\"data-state\", state.id);\n        if (transition.id) {\n          this.$el.attr(\"data-transition\", transition.id);\n        }\n\n        // No use border color if same as background\n        _.defer(function vTransition_renderWhiteOnWhite() {\n          currentView.$el\n            .find(\".dcpTransition--activity\")\n            .each(function vTransition_renderBorderColor() {\n              if (\n                currentView.$el.css(\"background-color\") ===\n                $(this).css(\"border-color\")\n              ) {\n                $(this).css(\"border-color\", \"\");\n              }\n            });\n        });\n      } else if (state) {\n        // Transition success\n        this.$el\n          .find(\".dcpTransition--header\")\n          .append(\n            Mustache.render(this.templates.htmlStateContent || \"\", workflow)\n          );\n        this.$el\n          .find(\".dcpTransition--buttons\")\n          .append(\n            Mustache.render(this.templates.htmlStateButtons || \"\", workflow)\n          );\n        this.$el.find(\".dcpTransition-button-close\").tooltip();\n      }\n\n      if (!this.transitionWindow) {\n        this.transitionWindow = this.$el\n          .dcpDialog({\n            window: {\n              // maxWidth: \"600px\",\n              height: \"auto\",\n              close: function registerCloseEvent(e) {\n                var event = { prevent: false };\n                currentView.model.trigger(\"beforeChangeStateClose\", event);\n                if (event.prevent !== false) {\n                  e.preventDefault();\n                }\n              }\n            }\n          })\n          .data(\"dcpDialog\");\n        this.$el.kendoWindow(\"title\", workflow.transition.label);\n        this.transitionWindow.open();\n      }\n      this.trigger(\"renderTransitionWindowDone\");\n    },\n\n    clickOnOk: function vTransition_clickOnOk() {\n      var event = { prevent: false },\n        currentView = this,\n        saveXhr;\n      this.model.trigger(\"beforeChangeState\", event);\n      this.$el.find(\".dcpTransition-button-ok\").tooltip(\"hide\");\n\n      if (event.prevent === false) {\n        saveXhr = this.model.save();\n        if (saveXhr) {\n          saveXhr\n            .then(function vTransition_clickOnOk_afterSave() {\n              currentView.model.trigger(\"success\", currentView.getMessages());\n            })\n            .fail(function vTransition_clickOnOk_error(\n              response,\n              statusTxt,\n              errorTxt\n            ) {\n              if (response.responseJSON) {\n                let userMessage = response.responseJSON.userMessage;\n\n                response.responseJSON.messages =\n                  response.responseJSON.messages || [];\n                response.responseJSON.messages.push({\n                  contentText: userMessage\n                });\n                _.each(\n                  response.responseJSON.messages,\n                  function vTransition_clickOnOk_displayError(aMessage) {\n                    currentView.displayError({\n                      title: aMessage.contentText\n                    });\n                  }\n                );\n              } else {\n                if (errorTxt && !errorTxt.title && errorTxt.message) {\n                  errorTxt.title = errorTxt.message;\n                  currentView.displayError(errorTxt);\n                } else if (_.isString(errorTxt)) {\n                  currentView.displayError({ title: errorTxt });\n                }\n              }\n            });\n        }\n      }\n    },\n\n    clickOnCancel: function vTransition_clickOnCancel() {\n      this.transitionWindow.close();\n    },\n\n    clickOnClose: function vTransition_clickOnClose() {\n      this.transitionWindow.close();\n    },\n\n    getMessages: function vTransition_getMessages() {\n      var messages = [];\n      _.each(\n        this.model.get(\"messages\"),\n        function vTransition_getMessagesAMessage(aMessage) {\n          messages.push({\n            type: aMessage.type,\n            title: aMessage.contentText,\n            htmlMessage: aMessage.contentHtml\n          });\n        }\n      );\n      return messages;\n    }\n  });\n}).apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMmI4Yzk2M2UyM2IzZTgyODQ3MmUuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvQXBwcy9ET0NVTUVOVC9JSE0vdmlld3Mvd29ya2Zsb3cvdlRyYW5zaXRpb24uanM/YjFmNSJdLCJzb3VyY2VzQ29udGVudCI6WyJkZWZpbmUoW1xuICBcInVuZGVyc2NvcmVcIixcbiAgXCJqcXVlcnlcIixcbiAgXCJiYWNrYm9uZVwiLFxuICBcIm11c3RhY2hlXCIsXG4gIFwiZGNwRG9jdW1lbnQvdmlld3MvZG9jdW1lbnQvdkRvY3VtZW50XCIsXG4gIFwiZGNwRG9jdW1lbnQvd2lkZ2V0cy93aW5kb3cvd0RpYWxvZ1wiXG5dLCBmdW5jdGlvbiB2VHJhbnNpdGlvbihfLCAkLCBCYWNrYm9uZSwgTXVzdGFjaGUsIFZpZXdEb2N1bWVudCkge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICByZXR1cm4gVmlld0RvY3VtZW50LmV4dGVuZCh7XG4gICAgbWVzc2FnZXM6IFtdLFxuXG4gICAgdGVtcGxhdGVzOiB7XG4gICAgICBodG1sQ29udGVudDpcbiAgICAgICAgJzxkaXYgY2xhc3M9XCJkY3BUcmFuc2l0aW9uLS1jb250ZW50LWFjdGl2aXR5XCIgPicgK1xuICAgICAgICAnIDxzcGFuIGNsYXNzPVwiZGNwVHJhbnNpdGlvbi0tYWN0aXZpdHlcIiBzdHlsZT1cImJvcmRlci1jb2xvcjp7e3RyYW5zaXRpb24uYmVnaW5TdGF0ZS5jb2xvcn19XCI+e3t0cmFuc2l0aW9uLmJlZ2luU3RhdGUuZGlzcGxheVZhbHVlfX08L3NwYW4+JyArXG4gICAgICAgICc8c3BhbiBjbGFzcz1cImRjcFRyYW5zaXRpb24tLXRyYW5zaXRpb24ge3tedHJhbnNpdGlvbi5pZH19ZGNwVHJhbnNpdGlvbi0tdHJhbnNpdGlvbi0taW52YWxpZHt7L3RyYW5zaXRpb24uaWR9fVwiID57e3RyYW5zaXRpb24ubGFiZWx9fTwvc3Bhbj4nICtcbiAgICAgICAgJzxzcGFuIGNsYXNzPVwiZGNwVHJhbnNpdGlvbi0tYXJyb3dcIj48c3BhbiBjbGFzcz1cImZhIGZhLWNhcmV0LXJpZ2h0IGZhLTJ4IHt7XnRyYW5zaXRpb24uaWR9fWRjcFRyYW5zaXRpb24tLXRyYW5zaXRpb24tLWludmFsaWR7ey90cmFuc2l0aW9uLmlkfX1cIj48L3NwYW4+PC9zcGFuPicgK1xuICAgICAgICAnPHNwYW4gY2xhc3M9XCJkY3BUcmFuc2l0aW9uLS1hY3Rpdml0eVwiIHN0eWxlPVwiYm9yZGVyLWNvbG9yOnt7dHJhbnNpdGlvbi5lbmRTdGF0ZS5jb2xvcn19XCI+e3t0cmFuc2l0aW9uLmVuZFN0YXRlLmRpc3BsYXlWYWx1ZX19PC9zcGFuPiAnICtcbiAgICAgICAgXCI8L2Rpdj5cIixcblxuICAgICAgaHRtbFN0YXRlQ29udGVudDpcbiAgICAgICAgJzxkaXYgY2xhc3M9XCJkY3BUcmFuc2l0aW9uLS1jb250ZW50LWFjdGl2aXR5XCI+JyArXG4gICAgICAgICc8c3BhbiBjbGFzcz1cImRjcFRyYW5zaXRpb24tLXN1Y2Nlc3NcIiA+e3tsYWJlbHMuc3VjY2Vzc319PC9zcGFuPicgK1xuICAgICAgICBcIjwvZGl2PlwiLFxuXG4gICAgICBodG1sU3RhdGVCdXR0b25zOlxuICAgICAgICAnPGJ1dHRvbiB0aXRsZT1cInt7bGFiZWxzLmNsb3NlfX1cIiBjbGFzcz1cImRjcFRyYW5zaXRpb24tYnV0dG9uLWNsb3NlIGJ0biBidG4tb3V0bGluZS1zZWNvbmRhcnkgYnRuLXNtXCI+JyArXG4gICAgICAgIFwie3tsYWJlbHMuY2xvc2V9fSA8L2J1dHRvbj5cIixcblxuICAgICAgaHRtbExvYWRpbmc6XG4gICAgICAgICc8ZGl2IGNsYXNzPVwiZGNwVHJhbnNpdGlvbi0tbG9hZGluZ1wiPjxzcGFuIGNsYXNzPVwiZmEgZmEtMnggZmEtc3Bpbm5lciBmYS1zcGluXCI+PC9zcGFuPiB7e2xhYmVscy5pbnByb2dyZXNzfX08L2Rpdj4nLFxuXG4gICAgICBodG1sQnV0dG9uczpcbiAgICAgICAgJ3t7I2hhc0F0dHJpYnV0ZXN9fTxidXR0b24gY2xhc3M9XCJkY3BUcmFuc2l0aW9uLWJ1dHRvbi1jYW5jZWwgYnRuIGJ0bi1vdXRsaW5lLXNlY29uZGFyeSBidG4tc21cIj57e2xhYmVscy5jYW5jZWx9fTwvYnV0dG9uPicgK1xuICAgICAgICAnPGJ1dHRvbiB0aXRsZT1cInt7dHJhbnNpdGlvbi5sYWJlbH19XCIgJyArXG4gICAgICAgICdjbGFzcz1cImRjcFRyYW5zaXRpb24tYnV0dG9uLW9rIGJ0biB7eyN0cmFuc2l0aW9uLmlkfX1idG4tcHJpbWFyeXt7L3RyYW5zaXRpb24uaWR9fSAge3tedHJhbnNpdGlvbi5pZH19YnRuLWRhbmdlcnt7L3RyYW5zaXRpb24uaWR9fSBidG4tc21cIj4nICtcbiAgICAgICAgXCJ7e2xhYmVscy5jb25maXJtfX08L2J1dHRvbj57ey9oYXNBdHRyaWJ1dGVzfX1cIlxuICAgIH0sXG5cbiAgICBldmVudHM6IHtcbiAgICAgIFwiY2xpY2sgLmRjcFRyYW5zaXRpb24tYnV0dG9uLW9rIFwiOiBcImNsaWNrT25Pa1wiLFxuICAgICAgXCJjbGljayAuZGNwVHJhbnNpdGlvbi1idXR0b24tY2FuY2VsXCI6IFwiY2xpY2tPbkNhbmNlbFwiLFxuICAgICAgXCJjbGljayAuZGNwVHJhbnNpdGlvbi1idXR0b24tY2xvc2VcIjogXCJjbGlja09uQ2xvc2VcIlxuICAgIH0sXG5cbiAgICBpbml0aWFsaXplOiBmdW5jdGlvbiB2VHJhbnNpdGlvbl9pbml0aWFsaXplKG9wdGlvbnMpIHtcbiAgICAgIC8vQ2FsbCBwYXJlbnRcbiAgICAgIFZpZXdEb2N1bWVudC5wcm90b3R5cGUuaW5pdGlhbGl6ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgdGhpcy5saXN0ZW5Ubyh0aGlzLm1vZGVsLCBcInNob3dFcnJvclwiLCB0aGlzLmRpc3BsYXlFcnJvcik7XG4gICAgICAvL3RoaXMubGlzdGVuVG8odGhpcy5tb2RlbCwgJ2ludmFsaWQnLCB0aGlzLmRpc3BsYXlFcnJvcik7XG4gICAgICB0aGlzLmxpc3RlblRvKHRoaXMubW9kZWwsIFwicmVxdWVzdFwiLCB0aGlzLnRyYW5zaXRpb25EaXNwbGF5TG9hZGluZyk7XG4gICAgICB0aGlzLmxpc3RlblRvKHRoaXMubW9kZWwsIFwiaGlkZVwiLCBmdW5jdGlvbiB2VHJhbnNpdGlvbl9oaWRlKCkge1xuICAgICAgICB0aGlzLiRlbC5oaWRlKCk7XG4gICAgICB9KTtcbiAgICAgIHRoaXMubGlzdGVuVG8odGhpcy5tb2RlbCwgXCJzaG93XCIsIGZ1bmN0aW9uIHZUcmFuc2l0aW9uX3Nob3coKSB7XG4gICAgICAgIHRoaXMuJGVsLnNob3coKTtcbiAgICAgIH0pO1xuICAgICAgdGhpcy5saXN0ZW5Ubyh0aGlzLm1vZGVsLCBcImNsb3NlXCIsIGZ1bmN0aW9uIHZUcmFuc2l0aW9uX2Nsb3NlKCkge1xuICAgICAgICBpZiAodGhpcy50cmFuc2l0aW9uV2luZG93KSB7XG4gICAgICAgICAgdGhpcy50cmFuc2l0aW9uV2luZG93LmNsb3NlKCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucztcbiAgICB9LFxuXG4gICAgcmVtb3ZlOiBmdW5jdGlvbiB2VHJhbnNpdGlvbl9yZW1vdmUoKSB7XG4gICAgICBpZiAodGhpcy50cmFuc2l0aW9uV2luZG93KSB7XG4gICAgICAgIHRoaXMudHJhbnNpdGlvbldpbmRvdy5jbG9zZSgpO1xuICAgICAgfVxuICAgICAgLy9DYWxsIHBhcmVudFxuICAgICAgVmlld0RvY3VtZW50LnByb3RvdHlwZS5yZW1vdmUuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgIC8vUmVtb3ZlIGN1c3RvbSBDU1NcbiAgICAgIHZhciBjdXN0b21Dc3MgPSBfLnBsdWNrKHRoaXMubW9kZWwuZ2V0KFwiY3VzdG9tQ1NTXCIpLCBcImtleVwiKTtcbiAgICAgIGlmIChjdXN0b21Dc3MubGVuZ3RoID4gMCkge1xuICAgICAgICBfLmVhY2goY3VzdG9tQ3NzLCBmdW5jdGlvbiB2VHJhbnNpdGlvbl9yZW1vdmVMaW5rKGNzc0tleSkge1xuICAgICAgICAgICQoJ2xpbmtbZGF0YS12aWV3PXRydWVdW2RhdGEtaWQ9XCInICsgY3NzS2V5ICsgJ1wiXScpLnJlbW92ZSgpO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgZGlzcGxheUVycm9yOiBmdW5jdGlvbiB2VHJhbnNpdGlvbl9kaXNwbGF5RXJyb3IoZXJyb3IpIHtcbiAgICAgIHZhciB3b3JrZmxvdyA9IHRoaXMubW9kZWwuZ2V0KFwid29ya2Zsb3dcIiksXG4gICAgICAgIGF0dHJpYnV0ZXMgPSB0aGlzLm1vZGVsLmdldChcImF0dHJpYnV0ZXNcIiksXG4gICAgICAgICRva0J1dHRvbiA9IHRoaXMuJGVsLmZpbmQoXCIuZGNwVHJhbnNpdGlvbi1idXR0b24tb2tcIiksXG4gICAgICAgICRjYW5jZWxCdXR0b24gPSB0aGlzLiRlbC5maW5kKFwiLmRjcFRyYW5zaXRpb24tYnV0dG9uLWNhbmNlbFwiKSxcbiAgICAgICAgZXJyb3JNZXNzYWdlO1xuICAgICAgdGhpcy5yZWFjdGl2ZVdpZGdldCgpO1xuICAgICAgaWYgKF8uaXNPYmplY3QoZXJyb3IpKSB7XG4gICAgICAgIGlmIChlcnJvci5lcnJvckNvZGUgPT09IFwib2ZmbGluZVwiKSB7XG4gICAgICAgICAgZXJyb3JNZXNzYWdlID1cbiAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwiZGNwVHJhbnNpdGlvbi0tZXJyb3JcIj57e3todG1sTWVzc2FnZX19fTwvZGl2Pic7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZXJyb3JNZXNzYWdlID1cbiAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwiZGNwVHJhbnNpdGlvbi0tZXJyb3JcIj57e3RpdGxlfX0ge3t7aHRtbE1lc3NhZ2V9fX08L2Rpdj4nO1xuICAgICAgICB9XG4gICAgICAgICQoTXVzdGFjaGUucmVuZGVyKGVycm9yTWVzc2FnZSB8fCBcIlwiLCBlcnJvcikpLmluc2VydEJlZm9yZShcbiAgICAgICAgICB0aGlzLiRlbC5maW5kKFwiLmRjcFRyYW5zaXRpb24tLWJ1dHRvbnNcIilcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIGlmIChhdHRyaWJ1dGVzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAkb2tCdXR0b24uaGlkZSgpO1xuICAgICAgICAkY2FuY2VsQnV0dG9uLnRleHQod29ya2Zsb3cubGFiZWxzLmNsb3NlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vbm9pbnNwZWN0aW9uIEpTVW5yZXNvbHZlZFZhcmlhYmxlXG4gICAgICAgICRva0J1dHRvbi50ZXh0KHdvcmtmbG93LmxhYmVscy5yZXRyeSk7XG4gICAgICB9XG4gICAgfSxcblxuICAgIGNsZWFuQW5kUmVuZGVyOiBmdW5jdGlvbiB2VHJhbnNpdGlvbl9jbGVhbkFuZFJlbmRlcigpIHtcbiAgICAgIHZhciB3b3JrZmxvdyA9IHRoaXMubW9kZWwuZ2V0KFwid29ya2Zsb3dcIiksXG4gICAgICAgIHRyYW5zaXRpb24gPSB3b3JrZmxvdy50cmFuc2l0aW9uLFxuICAgICAgICBzdGF0ZSA9IHdvcmtmbG93LnN0YXRlO1xuXG4gICAgICB0aGlzLnJlbmRlcigpO1xuICAgICAgdGhpcy5kaXNwbGF5TWVzc2FnZXModGhpcy5tb2RlbC5nZXQoXCJtZXNzYWdlc1wiKSk7XG4gICAgICB0aGlzLmNsZWFyRXJyb3IoKTtcbiAgICAgIHRoaXMucmVhY3RpdmVXaWRnZXQoKTtcbiAgICAgIGlmICghdHJhbnNpdGlvbiAmJiBzdGF0ZSkge1xuICAgICAgICB0aGlzLm1vZGVsLnRyaWdnZXIoXCJzdWNjZXNzXCIsIHRoaXMubWVzc2FnZXMpO1xuICAgICAgfVxuICAgIH0sXG4gICAgLyoqXG4gICAgICogSW5qZWN0IGFzc29jaWF0ZWQgQ1NTIGluIHRoZSBET01cbiAgICAgKlxuICAgICAqIEluamVjdCBuZXcgQ1NTLCBubyByZW1vdmUgb2xkIENTU1xuICAgICAqL1xuICAgIHJlbmRlckNzczogZnVuY3Rpb24gdlRyYW5zaXRpb25SZW5kZXJDc3MoKSB7XG4gICAgICBWaWV3RG9jdW1lbnQucHJvdG90eXBlLnJlbmRlckNzcy5hcHBseSh0aGlzLCBbdHJ1ZV0pO1xuICAgIH0sXG4gICAgdXBkYXRlVGl0bGU6IGZ1bmN0aW9uIHZUcmFuc2l0aW9udXBkYXRlVGl0bGUoKSB7XG4gICAgICAvLyBObyB1cGRhdGUgdGl0bGVcbiAgICB9LFxuICAgIHVwZGF0ZUljb246IGZ1bmN0aW9uIHZUcmFuc2l0aW9udXBkYXRlSWNvbigpIHtcbiAgICAgIC8vIE5vIHVwZGF0ZSBpY29uXG4gICAgfSxcbiAgICBjbGVhckVycm9yOiBmdW5jdGlvbiB2VHJhbnNpdGlvbl9jbGVhckVycm9yKCkge1xuICAgICAgdGhpcy4kZWwuZmluZChcIi5kY3BUcmFuc2l0aW9uLS1lcnJvclwiKS5yZW1vdmUoKTtcbiAgICB9LFxuXG4gICAgcmVhY3RpdmVXaWRnZXQ6IGZ1bmN0aW9uIHZUcmFuc2l0aW9uX3JlYWN0aXZlV2lkZ2V0KCkge1xuICAgICAgdmFyIHdvcmtmbG93ID0gdGhpcy5tb2RlbC5nZXQoXCJ3b3JrZmxvd1wiKSxcbiAgICAgICAgYXR0cmlidXRlcyA9IHRoaXMubW9kZWwuZ2V0KFwiYXR0cmlidXRlc1wiKSxcbiAgICAgICAgJGxvYWRpbmcgPSB0aGlzLiRlbC5maW5kKFwiLmRjcFRyYW5zaXRpb24tLWxvYWRpbmdcIiksXG4gICAgICAgICRva0J1dHRvbiA9IHRoaXMuJGVsLmZpbmQoXCIuZGNwVHJhbnNpdGlvbi1idXR0b24tb2tcIiksXG4gICAgICAgICRjYW5jZWxCdXR0b24gPSB0aGlzLiRlbC5maW5kKFwiLmRjcFRyYW5zaXRpb24tYnV0dG9uLWNhbmNlbFwiKTtcblxuICAgICAgaWYgKGF0dHJpYnV0ZXMubGVuZ3RoID4gMCkge1xuICAgICAgICBpZiAod29ya2Zsb3cgJiYgd29ya2Zsb3cubGFiZWxzLmNvbmZpcm0pIHtcbiAgICAgICAgICAkb2tCdXR0b24udGV4dCh3b3JrZmxvdy5sYWJlbHMuY29uZmlybSk7XG4gICAgICAgIH1cbiAgICAgICAgJG9rQnV0dG9uLnByb3AoXCJkaXNhYmxlZFwiLCBmYWxzZSk7XG4gICAgICB9XG4gICAgICAkY2FuY2VsQnV0dG9uLnByb3AoXCJkaXNhYmxlZFwiLCBmYWxzZSk7XG5cbiAgICAgIHRoaXMuJGVsLmZpbmQoXCIuZGNwRG9jdW1lbnQtLWRpc2FibGVkXCIpLnJlbW92ZSgpO1xuICAgICAgJGxvYWRpbmcuaGlkZSgpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBEaXNwbGF5IHRoZSBsb2FkaW5nIHdpZGdldFxuICAgICAqL1xuICAgIHRyYW5zaXRpb25EaXNwbGF5TG9hZGluZzogZnVuY3Rpb24gdlRyYW5zaXRpb25fdHJhbnNpdGlvbkRpc3BsYXlMb2FkaW5nKCkge1xuICAgICAgdmFyICRsb2FkaW5nID0gdGhpcy4kZWwuZmluZChcIi5kY3BUcmFuc2l0aW9uLS1sb2FkaW5nXCIpLFxuICAgICAgICAkb2tCdXR0b24gPSB0aGlzLiRlbC5maW5kKFwiLmRjcFRyYW5zaXRpb24tYnV0dG9uLW9rXCIpLFxuICAgICAgICAkY2FuY2VsQnV0dG9uID0gdGhpcy4kZWwuZmluZChcIi5kY3BUcmFuc2l0aW9uLWJ1dHRvbi1jYW5jZWxcIik7XG5cbiAgICAgICRsb2FkaW5nLnNob3coKTtcbiAgICAgIHRoaXMuY2xlYXJFcnJvcigpO1xuICAgICAgJG9rQnV0dG9uLnByb3AoXCJkaXNhYmxlZFwiLCB0cnVlKTtcbiAgICAgICRjYW5jZWxCdXR0b24ucHJvcChcImRpc2FibGVkXCIsIHRydWUpO1xuICAgIH0sXG5cbiAgICBkaXNwbGF5TWVzc2FnZXM6IGZ1bmN0aW9uIHZUcmFuc2l0aW9uX2Rpc3BsYXlNZXNzYWdlcyhtZXNzYWdlcykge1xuICAgICAgdmFyIGN1cnJlbnRWaWV3ID0gdGhpcyxcbiAgICAgICAgdGVtcGxhdGUgPVxuICAgICAgICAgICc8ZGl2IGNsYXNzPVwiZGNwVHJhbnNpdGlvbi0tbWVzc2FnZSBkY3BUcmFuc2l0aW9uLS1tZXNzYWdlLS17e3R5cGV9fVwiPnt7Y29udGVudFRleHR9fSB7e3tjb250ZW50SHRtbH19fTwvZGl2PicsXG4gICAgICAgICRtZXNzYWdlID0gdGhpcy4kZWwuZmluZChcIi5kY3BUcmFuc2l0aW9uLS1tZXNzYWdlc1wiKTtcblxuICAgICAgdGhpcy5tZXNzYWdlcyA9IFtdO1xuXG4gICAgICBfLmVhY2gobWVzc2FnZXMsIGZ1bmN0aW9uIHZUcmFuc2l0aW9uX2FuYWx5emVDdXJyZW50TWVzc2FnZShtZXNzYWdlKSB7XG4gICAgICAgICRtZXNzYWdlLmFwcGVuZCgkKE11c3RhY2hlLnJlbmRlcih0ZW1wbGF0ZSB8fCBcIlwiLCBtZXNzYWdlKSkpO1xuICAgICAgICAvL25vaW5zcGVjdGlvbiBKU1VucmVzb2x2ZWRWYXJpYWJsZVxuICAgICAgICBjdXJyZW50Vmlldy5tZXNzYWdlcy5wdXNoKHtcbiAgICAgICAgICB0aXRsZTogbWVzc2FnZS5jb250ZW50VGV4dCxcbiAgICAgICAgICB0eXBlOiBtZXNzYWdlLnR5cGUsXG4gICAgICAgICAgaHRtbE1lc3NhZ2U6IG1lc3NhZ2UuY29udGVudEh0bWxcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogUmVuZGVyIHRoZSBkb2N1bWVudCB2aWV3XG4gICAgICogQHJldHVybnMgeyp9XG4gICAgICovXG4gICAgcmVuZGVyOiBmdW5jdGlvbiB2VHJhbnNpdGlvbl9yZW5kZXIoKSB7XG4gICAgICB2YXIgY3VycmVudFZpZXcgPSB0aGlzLFxuICAgICAgICB3b3JrZmxvdyA9IHRoaXMubW9kZWwuZ2V0KFwid29ya2Zsb3dcIiksXG4gICAgICAgIGF0dHJpYnV0ZXMgPSB0aGlzLm1vZGVsLmdldChcImF0dHJpYnV0ZXNcIiksXG4gICAgICAgIHRyYW5zaXRpb24gPSB3b3JrZmxvdy50cmFuc2l0aW9uLFxuICAgICAgICBzdGF0ZSA9IHdvcmtmbG93LnN0YXRlO1xuXG4gICAgICAvL0NhbGwgcGFyZW50XG4gICAgICBWaWV3RG9jdW1lbnQucHJvdG90eXBlLnJlbmRlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuXG4gICAgICB3b3JrZmxvdy5oYXNBdHRyaWJ1dGVzID0gYXR0cmlidXRlcy5sZW5ndGggPiAwO1xuICAgICAgaWYgKHRyYW5zaXRpb24pIHtcbiAgICAgICAgLy8gVHJhbnNpdGlvbiBhc2tcbiAgICAgICAgdGhpcy4kZWxcbiAgICAgICAgICAuZmluZChcIi5kY3BUcmFuc2l0aW9uLS1oZWFkZXJcIilcbiAgICAgICAgICAuYXBwZW5kKE11c3RhY2hlLnJlbmRlcih0aGlzLnRlbXBsYXRlcy5odG1sQ29udGVudCB8fCBcIlwiLCB3b3JrZmxvdykpO1xuICAgICAgICB0aGlzLiRlbFxuICAgICAgICAgIC5maW5kKFwiLmRjcFRyYW5zaXRpb24tLW1lc3NhZ2VzXCIpXG4gICAgICAgICAgLmFwcGVuZChNdXN0YWNoZS5yZW5kZXIodGhpcy50ZW1wbGF0ZXMuaHRtbExvYWRpbmcgfHwgXCJcIiwgd29ya2Zsb3cpKTtcbiAgICAgICAgdGhpcy4kZWxcbiAgICAgICAgICAuZmluZChcIi5kY3BUcmFuc2l0aW9uLS1idXR0b25zXCIpXG4gICAgICAgICAgLmFwcGVuZChNdXN0YWNoZS5yZW5kZXIodGhpcy50ZW1wbGF0ZXMuaHRtbEJ1dHRvbnMgfHwgXCJcIiwgd29ya2Zsb3cpKTtcbiAgICAgICAgdGhpcy4kZWwuZmluZChcIi5kY3BUcmFuc2l0aW9uLWJ1dHRvbi1va1wiKS50b29sdGlwKCk7XG5cbiAgICAgICAgaWYgKGF0dHJpYnV0ZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgLy8gRGlyZWN0IHNlbmQgdHJhbnNpdGlvbiB3aXRob3V0IHVzZXIgY29udHJvbFxuICAgICAgICAgIF8uZGVmZXIoZnVuY3Rpb24gdlRyYW5zaXRpb25fc2F2ZUZvck1lKCkge1xuICAgICAgICAgICAgdmFyIGV2ZW50ID0geyBwcmV2ZW50OiBmYWxzZSB9LFxuICAgICAgICAgICAgICBzYXZlWGhyO1xuICAgICAgICAgICAgY3VycmVudFZpZXcubW9kZWwudHJpZ2dlcihcImJlZm9yZUNoYW5nZVN0YXRlXCIsIGV2ZW50KTtcbiAgICAgICAgICAgIGlmIChldmVudC5wcmV2ZW50ID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICBzYXZlWGhyID0gY3VycmVudFZpZXcubW9kZWwuc2F2ZSgpO1xuICAgICAgICAgICAgICBpZiAoc2F2ZVhocikge1xuICAgICAgICAgICAgICAgIHNhdmVYaHJcbiAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIHZUcmFuc2l0aW9uX2RpcmVjdF9hZnRlclNhdmUoKSB7XG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnRWaWV3Lm1vZGVsLnRyaWdnZXIoXG4gICAgICAgICAgICAgICAgICAgICAgXCJzdWNjZXNzXCIsXG4gICAgICAgICAgICAgICAgICAgICAgY3VycmVudFZpZXcuZ2V0TWVzc2FnZXMoKVxuICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgIC5mYWlsKGZ1bmN0aW9uIHZUcmFuc2l0aW9uX2RpcmVjdF9lcnJvcihcbiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UsXG4gICAgICAgICAgICAgICAgICAgIHN0YXR1c1R4dCxcbiAgICAgICAgICAgICAgICAgICAgZXJyb3JUeHRcbiAgICAgICAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UucmVzcG9uc2VKU09OKSB7XG4gICAgICAgICAgICAgICAgICAgICAgbGV0IHVzZXJNZXNzYWdlID0gcmVzcG9uc2UucmVzcG9uc2VKU09OLnVzZXJNZXNzYWdlO1xuXG4gICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UucmVzcG9uc2VKU09OLm1lc3NhZ2VzID1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLnJlc3BvbnNlSlNPTi5tZXNzYWdlcyB8fCBbXTtcbiAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5yZXNwb25zZUpTT04ubWVzc2FnZXMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50VGV4dDogdXNlck1lc3NhZ2VcbiAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICBfLmVhY2goXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5yZXNwb25zZUpTT04ubWVzc2FnZXMsXG4gICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiB2VHJhbnNpdGlvbl9jbGlja09uT2tfZGlzcGxheUVycm9yKGFNZXNzYWdlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRWaWV3LmRpc3BsYXlFcnJvcih7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IGFNZXNzYWdlLmNvbnRlbnRUZXh0XG4gICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgaWYgKGVycm9yVHh0ICYmICFlcnJvclR4dC50aXRsZSAmJiBlcnJvclR4dC5tZXNzYWdlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlcnJvclR4dC50aXRsZSA9IGVycm9yVHh0Lm1lc3NhZ2U7XG4gICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50Vmlldy5kaXNwbGF5RXJyb3IoZXJyb3JUeHQpO1xuICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoXy5pc1N0cmluZyhlcnJvclR4dCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRWaWV3LmRpc3BsYXlFcnJvcih7IHRpdGxlOiBlcnJvclR4dCB9KTtcbiAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy4kZWwuYXR0cihcImRhdGEtc3RhdGVcIiwgc3RhdGUuaWQpO1xuICAgICAgICBpZiAodHJhbnNpdGlvbi5pZCkge1xuICAgICAgICAgIHRoaXMuJGVsLmF0dHIoXCJkYXRhLXRyYW5zaXRpb25cIiwgdHJhbnNpdGlvbi5pZCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBObyB1c2UgYm9yZGVyIGNvbG9yIGlmIHNhbWUgYXMgYmFja2dyb3VuZFxuICAgICAgICBfLmRlZmVyKGZ1bmN0aW9uIHZUcmFuc2l0aW9uX3JlbmRlcldoaXRlT25XaGl0ZSgpIHtcbiAgICAgICAgICBjdXJyZW50Vmlldy4kZWxcbiAgICAgICAgICAgIC5maW5kKFwiLmRjcFRyYW5zaXRpb24tLWFjdGl2aXR5XCIpXG4gICAgICAgICAgICAuZWFjaChmdW5jdGlvbiB2VHJhbnNpdGlvbl9yZW5kZXJCb3JkZXJDb2xvcigpIHtcbiAgICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICAgIGN1cnJlbnRWaWV3LiRlbC5jc3MoXCJiYWNrZ3JvdW5kLWNvbG9yXCIpID09PVxuICAgICAgICAgICAgICAgICQodGhpcykuY3NzKFwiYm9yZGVyLWNvbG9yXCIpXG4gICAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgICQodGhpcykuY3NzKFwiYm9yZGVyLWNvbG9yXCIsIFwiXCIpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2UgaWYgKHN0YXRlKSB7XG4gICAgICAgIC8vIFRyYW5zaXRpb24gc3VjY2Vzc1xuICAgICAgICB0aGlzLiRlbFxuICAgICAgICAgIC5maW5kKFwiLmRjcFRyYW5zaXRpb24tLWhlYWRlclwiKVxuICAgICAgICAgIC5hcHBlbmQoXG4gICAgICAgICAgICBNdXN0YWNoZS5yZW5kZXIodGhpcy50ZW1wbGF0ZXMuaHRtbFN0YXRlQ29udGVudCB8fCBcIlwiLCB3b3JrZmxvdylcbiAgICAgICAgICApO1xuICAgICAgICB0aGlzLiRlbFxuICAgICAgICAgIC5maW5kKFwiLmRjcFRyYW5zaXRpb24tLWJ1dHRvbnNcIilcbiAgICAgICAgICAuYXBwZW5kKFxuICAgICAgICAgICAgTXVzdGFjaGUucmVuZGVyKHRoaXMudGVtcGxhdGVzLmh0bWxTdGF0ZUJ1dHRvbnMgfHwgXCJcIiwgd29ya2Zsb3cpXG4gICAgICAgICAgKTtcbiAgICAgICAgdGhpcy4kZWwuZmluZChcIi5kY3BUcmFuc2l0aW9uLWJ1dHRvbi1jbG9zZVwiKS50b29sdGlwKCk7XG4gICAgICB9XG5cbiAgICAgIGlmICghdGhpcy50cmFuc2l0aW9uV2luZG93KSB7XG4gICAgICAgIHRoaXMudHJhbnNpdGlvbldpbmRvdyA9IHRoaXMuJGVsXG4gICAgICAgICAgLmRjcERpYWxvZyh7XG4gICAgICAgICAgICB3aW5kb3c6IHtcbiAgICAgICAgICAgICAgLy8gbWF4V2lkdGg6IFwiNjAwcHhcIixcbiAgICAgICAgICAgICAgaGVpZ2h0OiBcImF1dG9cIixcbiAgICAgICAgICAgICAgY2xvc2U6IGZ1bmN0aW9uIHJlZ2lzdGVyQ2xvc2VFdmVudChlKSB7XG4gICAgICAgICAgICAgICAgdmFyIGV2ZW50ID0geyBwcmV2ZW50OiBmYWxzZSB9O1xuICAgICAgICAgICAgICAgIGN1cnJlbnRWaWV3Lm1vZGVsLnRyaWdnZXIoXCJiZWZvcmVDaGFuZ2VTdGF0ZUNsb3NlXCIsIGV2ZW50KTtcbiAgICAgICAgICAgICAgICBpZiAoZXZlbnQucHJldmVudCAhPT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KVxuICAgICAgICAgIC5kYXRhKFwiZGNwRGlhbG9nXCIpO1xuICAgICAgICB0aGlzLiRlbC5rZW5kb1dpbmRvdyhcInRpdGxlXCIsIHdvcmtmbG93LnRyYW5zaXRpb24ubGFiZWwpO1xuICAgICAgICB0aGlzLnRyYW5zaXRpb25XaW5kb3cub3BlbigpO1xuICAgICAgfVxuICAgICAgdGhpcy50cmlnZ2VyKFwicmVuZGVyVHJhbnNpdGlvbldpbmRvd0RvbmVcIik7XG4gICAgfSxcblxuICAgIGNsaWNrT25PazogZnVuY3Rpb24gdlRyYW5zaXRpb25fY2xpY2tPbk9rKCkge1xuICAgICAgdmFyIGV2ZW50ID0geyBwcmV2ZW50OiBmYWxzZSB9LFxuICAgICAgICBjdXJyZW50VmlldyA9IHRoaXMsXG4gICAgICAgIHNhdmVYaHI7XG4gICAgICB0aGlzLm1vZGVsLnRyaWdnZXIoXCJiZWZvcmVDaGFuZ2VTdGF0ZVwiLCBldmVudCk7XG4gICAgICB0aGlzLiRlbC5maW5kKFwiLmRjcFRyYW5zaXRpb24tYnV0dG9uLW9rXCIpLnRvb2x0aXAoXCJoaWRlXCIpO1xuXG4gICAgICBpZiAoZXZlbnQucHJldmVudCA9PT0gZmFsc2UpIHtcbiAgICAgICAgc2F2ZVhociA9IHRoaXMubW9kZWwuc2F2ZSgpO1xuICAgICAgICBpZiAoc2F2ZVhocikge1xuICAgICAgICAgIHNhdmVYaHJcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIHZUcmFuc2l0aW9uX2NsaWNrT25Pa19hZnRlclNhdmUoKSB7XG4gICAgICAgICAgICAgIGN1cnJlbnRWaWV3Lm1vZGVsLnRyaWdnZXIoXCJzdWNjZXNzXCIsIGN1cnJlbnRWaWV3LmdldE1lc3NhZ2VzKCkpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5mYWlsKGZ1bmN0aW9uIHZUcmFuc2l0aW9uX2NsaWNrT25Pa19lcnJvcihcbiAgICAgICAgICAgICAgcmVzcG9uc2UsXG4gICAgICAgICAgICAgIHN0YXR1c1R4dCxcbiAgICAgICAgICAgICAgZXJyb3JUeHRcbiAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICBpZiAocmVzcG9uc2UucmVzcG9uc2VKU09OKSB7XG4gICAgICAgICAgICAgICAgbGV0IHVzZXJNZXNzYWdlID0gcmVzcG9uc2UucmVzcG9uc2VKU09OLnVzZXJNZXNzYWdlO1xuXG4gICAgICAgICAgICAgICAgcmVzcG9uc2UucmVzcG9uc2VKU09OLm1lc3NhZ2VzID1cbiAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLnJlc3BvbnNlSlNPTi5tZXNzYWdlcyB8fCBbXTtcbiAgICAgICAgICAgICAgICByZXNwb25zZS5yZXNwb25zZUpTT04ubWVzc2FnZXMucHVzaCh7XG4gICAgICAgICAgICAgICAgICBjb250ZW50VGV4dDogdXNlck1lc3NhZ2VcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBfLmVhY2goXG4gICAgICAgICAgICAgICAgICByZXNwb25zZS5yZXNwb25zZUpTT04ubWVzc2FnZXMsXG4gICAgICAgICAgICAgICAgICBmdW5jdGlvbiB2VHJhbnNpdGlvbl9jbGlja09uT2tfZGlzcGxheUVycm9yKGFNZXNzYWdlKSB7XG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnRWaWV3LmRpc3BsYXlFcnJvcih7XG4gICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IGFNZXNzYWdlLmNvbnRlbnRUZXh0XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKGVycm9yVHh0ICYmICFlcnJvclR4dC50aXRsZSAmJiBlcnJvclR4dC5tZXNzYWdlKSB7XG4gICAgICAgICAgICAgICAgICBlcnJvclR4dC50aXRsZSA9IGVycm9yVHh0Lm1lc3NhZ2U7XG4gICAgICAgICAgICAgICAgICBjdXJyZW50Vmlldy5kaXNwbGF5RXJyb3IoZXJyb3JUeHQpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoXy5pc1N0cmluZyhlcnJvclR4dCkpIHtcbiAgICAgICAgICAgICAgICAgIGN1cnJlbnRWaWV3LmRpc3BsYXlFcnJvcih7IHRpdGxlOiBlcnJvclR4dCB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcblxuICAgIGNsaWNrT25DYW5jZWw6IGZ1bmN0aW9uIHZUcmFuc2l0aW9uX2NsaWNrT25DYW5jZWwoKSB7XG4gICAgICB0aGlzLnRyYW5zaXRpb25XaW5kb3cuY2xvc2UoKTtcbiAgICB9LFxuXG4gICAgY2xpY2tPbkNsb3NlOiBmdW5jdGlvbiB2VHJhbnNpdGlvbl9jbGlja09uQ2xvc2UoKSB7XG4gICAgICB0aGlzLnRyYW5zaXRpb25XaW5kb3cuY2xvc2UoKTtcbiAgICB9LFxuXG4gICAgZ2V0TWVzc2FnZXM6IGZ1bmN0aW9uIHZUcmFuc2l0aW9uX2dldE1lc3NhZ2VzKCkge1xuICAgICAgdmFyIG1lc3NhZ2VzID0gW107XG4gICAgICBfLmVhY2goXG4gICAgICAgIHRoaXMubW9kZWwuZ2V0KFwibWVzc2FnZXNcIiksXG4gICAgICAgIGZ1bmN0aW9uIHZUcmFuc2l0aW9uX2dldE1lc3NhZ2VzQU1lc3NhZ2UoYU1lc3NhZ2UpIHtcbiAgICAgICAgICBtZXNzYWdlcy5wdXNoKHtcbiAgICAgICAgICAgIHR5cGU6IGFNZXNzYWdlLnR5cGUsXG4gICAgICAgICAgICB0aXRsZTogYU1lc3NhZ2UuY29udGVudFRleHQsXG4gICAgICAgICAgICBodG1sTWVzc2FnZTogYU1lc3NhZ2UuY29udGVudEh0bWxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgKTtcbiAgICAgIHJldHVybiBtZXNzYWdlcztcbiAgICB9XG4gIH0pO1xufSk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///2b8c963e23b3e828472e\n");

/***/ }),

/***/ "2ea670d287981a202ee6":
/*!**********************************************************!*\
  !*** ./src/Apps/DOCUMENT/IHM/models/mFamilyStructure.js ***!
  \**********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(/*! underscore */ \"8e08e542008e4aef1f58\"), __webpack_require__(/*! backbone */ \"1858b45bf48591489d06\")], __WEBPACK_AMD_DEFINE_RESULT__ = (function require_structure(_, Backbone) {\n  \"use strict\";\n\n  return Backbone.Model.extend({\n    typeModel: \"ddui:familyStructure\",\n    idAttribute: \"familyId\",\n\n    url: function mFamilyStructure_url() {\n      var urlStructure = _.template(\n        \"api/v2/families/<%- familyId %>/views/structure\"\n      );\n\n      return urlStructure({\n        familyId: this.get(\"familyId\")\n      });\n    }\n  });\n}).apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMmVhNjcwZDI4Nzk4MWEyMDJlZTYuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvQXBwcy9ET0NVTUVOVC9JSE0vbW9kZWxzL21GYW1pbHlTdHJ1Y3R1cmUuanM/MDJjMCJdLCJzb3VyY2VzQ29udGVudCI6WyJkZWZpbmUoW1widW5kZXJzY29yZVwiLCBcImJhY2tib25lXCJdLCBmdW5jdGlvbiByZXF1aXJlX3N0cnVjdHVyZShfLCBCYWNrYm9uZSkge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICByZXR1cm4gQmFja2JvbmUuTW9kZWwuZXh0ZW5kKHtcbiAgICB0eXBlTW9kZWw6IFwiZGR1aTpmYW1pbHlTdHJ1Y3R1cmVcIixcbiAgICBpZEF0dHJpYnV0ZTogXCJmYW1pbHlJZFwiLFxuXG4gICAgdXJsOiBmdW5jdGlvbiBtRmFtaWx5U3RydWN0dXJlX3VybCgpIHtcbiAgICAgIHZhciB1cmxTdHJ1Y3R1cmUgPSBfLnRlbXBsYXRlKFxuICAgICAgICBcImFwaS92Mi9mYW1pbGllcy88JS0gZmFtaWx5SWQgJT4vdmlld3Mvc3RydWN0dXJlXCJcbiAgICAgICk7XG5cbiAgICAgIHJldHVybiB1cmxTdHJ1Y3R1cmUoe1xuICAgICAgICBmYW1pbHlJZDogdGhpcy5nZXQoXCJmYW1pbHlJZFwiKVxuICAgICAgfSk7XG4gICAgfVxuICB9KTtcbn0pO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///2ea670d287981a202ee6\n");

/***/ }),

/***/ "30f8a357b2168c64d123":
/*!************************************************************!*\
  !*** ./src/Apps/DOCUMENT/IHM/views/document/menu/vMenu.js ***!
  \************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/*global define*/\n!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(/*! underscore */ \"8e08e542008e4aef1f58\"), __webpack_require__(/*! backbone */ \"1858b45bf48591489d06\"), __webpack_require__(/*! dcpDocument/widgets/menu/wMenu */ \"87c09356a22ec84292bb\")], __WEBPACK_AMD_DEFINE_RESULT__ = (function(\n  _,\n  Backbone\n) {\n  \"use strict\";\n\n  return Backbone.View.extend({\n    className: \"dcpDocument\",\n\n    events: {\n      dcpmenuexternallinkselected: \"externalLinkSelected\",\n      dcpmenushowmessage: \"showMessage\",\n      dcpmenureload: \"reloadDocument\"\n    },\n\n    /**\n     * The current model is the document model\n     * So menuModel reference the menu model\n     */\n    menuModel: null,\n\n    initialize: function vMenuInitialize() {\n      this.listenTo(this.model.get(\"properties\"), \"change\", this.updateWidget);\n      this.listenTo(this.model.get(\"menus\"), \"change\", this.updateWidget);\n      this.listenTo(this.model.get(\"menus\"), \"reload\", this.updateWidget);\n      this.listenTo(\n        this.model.get(\"attributes\"),\n        \"changeMenuVisibility\",\n        this.changeVisibility\n      );\n      this.listenTo(this.model, \"destroy\", this.remove);\n      this.listenTo(this.model, \"cleanView\", this.remove);\n      this.menuModel = this.model.get(\"menus\");\n    },\n\n    render: function vMenuRender() {\n      var currentView = this;\n      return new Promise(\n        _.bind(function vMenuRenderPromise(resolve, reject) {\n          try {\n            currentView.$el.dcpMenu(currentView.model.toData());\n            currentView.refresh();\n            return resolve(currentView);\n          } catch (e) {\n            reject(e);\n          }\n        }, this)\n      );\n    },\n\n    externalLinkSelected: function vMenuExternalLinkSelected(event, options) {\n      var internalEvent = {\n        prevent: false\n      };\n\n      options.attrid = this.model.id;\n      this.model.trigger(\"internalLinkSelected\", internalEvent, options);\n      if (event.prevent) {\n        return this;\n      }\n      this.model.trigger(\"actionAttributeLink\", internalEvent, options);\n      return this;\n    },\n\n    showMessage: function vMenushowMessage(event, options) {\n      options.attrid = this.model.id;\n      this.model.trigger(\"showMessage\", options);\n\n      return this;\n    },\n    reloadDocument: function vMenureloadDocument(event, options) {\n      this.model.trigger(\"reload\", options);\n\n      return this;\n    },\n    changeVisibility: function vMenuchangeVisibility(event, data) {\n      var menuItem = this.menuModel.get(data.id);\n      var onlyIfVisible = !!data.onlyIfVisible;\n      var visibility;\n      if (menuItem) {\n        visibility = menuItem.get(\"visibility\");\n        if (!onlyIfVisible || visibility !== \"hidden\") {\n          menuItem.set(\"visibility\", data.visibility);\n        }\n      }\n    },\n\n    updateWidget: function vMenuUpdateWidget() {\n      if (this.$el.dcpMenu && this._findWidgetName(this.$el)) {\n        this.$el.dcpMenu(\"destroy\");\n      }\n      return this.render();\n    },\n\n    remove: function vMenuRemove() {\n      if (this.$el.dcpMenu && this._findWidgetName(this.$el)) {\n        this.$el.dcpMenu(\"destroy\");\n      }\n      return Backbone.View.prototype.remove.call(this);\n    },\n\n    _findWidgetName: function vMenu_findWidgetName($element) {\n      return _.find(_.keys($element.data()), function(currentKey) {\n        return currentKey.indexOf(\"dcpDcp\") !== -1;\n      });\n    },\n\n    /**\n     * Recompute responsive in case of scrollbar can appear\n     */\n    refresh: function vMenu_refresh() {\n      if (this.$el.dcpMenu && this._findWidgetName(this.$el)) {\n        this.$el.dcpMenu(\"updateResponsiveMenu\");\n      }\n    }\n  });\n}).apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMzBmOGEzNTdiMjE2OGM2NGQxMjMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvQXBwcy9ET0NVTUVOVC9JSE0vdmlld3MvZG9jdW1lbnQvbWVudS92TWVudS5qcz9mZWU3Il0sInNvdXJjZXNDb250ZW50IjpbIi8qZ2xvYmFsIGRlZmluZSovXG5kZWZpbmUoW1widW5kZXJzY29yZVwiLCBcImJhY2tib25lXCIsIFwiZGNwRG9jdW1lbnQvd2lkZ2V0cy9tZW51L3dNZW51XCJdLCBmdW5jdGlvbihcbiAgXyxcbiAgQmFja2JvbmVcbikge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICByZXR1cm4gQmFja2JvbmUuVmlldy5leHRlbmQoe1xuICAgIGNsYXNzTmFtZTogXCJkY3BEb2N1bWVudFwiLFxuXG4gICAgZXZlbnRzOiB7XG4gICAgICBkY3BtZW51ZXh0ZXJuYWxsaW5rc2VsZWN0ZWQ6IFwiZXh0ZXJuYWxMaW5rU2VsZWN0ZWRcIixcbiAgICAgIGRjcG1lbnVzaG93bWVzc2FnZTogXCJzaG93TWVzc2FnZVwiLFxuICAgICAgZGNwbWVudXJlbG9hZDogXCJyZWxvYWREb2N1bWVudFwiXG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIFRoZSBjdXJyZW50IG1vZGVsIGlzIHRoZSBkb2N1bWVudCBtb2RlbFxuICAgICAqIFNvIG1lbnVNb2RlbCByZWZlcmVuY2UgdGhlIG1lbnUgbW9kZWxcbiAgICAgKi9cbiAgICBtZW51TW9kZWw6IG51bGwsXG5cbiAgICBpbml0aWFsaXplOiBmdW5jdGlvbiB2TWVudUluaXRpYWxpemUoKSB7XG4gICAgICB0aGlzLmxpc3RlblRvKHRoaXMubW9kZWwuZ2V0KFwicHJvcGVydGllc1wiKSwgXCJjaGFuZ2VcIiwgdGhpcy51cGRhdGVXaWRnZXQpO1xuICAgICAgdGhpcy5saXN0ZW5Ubyh0aGlzLm1vZGVsLmdldChcIm1lbnVzXCIpLCBcImNoYW5nZVwiLCB0aGlzLnVwZGF0ZVdpZGdldCk7XG4gICAgICB0aGlzLmxpc3RlblRvKHRoaXMubW9kZWwuZ2V0KFwibWVudXNcIiksIFwicmVsb2FkXCIsIHRoaXMudXBkYXRlV2lkZ2V0KTtcbiAgICAgIHRoaXMubGlzdGVuVG8oXG4gICAgICAgIHRoaXMubW9kZWwuZ2V0KFwiYXR0cmlidXRlc1wiKSxcbiAgICAgICAgXCJjaGFuZ2VNZW51VmlzaWJpbGl0eVwiLFxuICAgICAgICB0aGlzLmNoYW5nZVZpc2liaWxpdHlcbiAgICAgICk7XG4gICAgICB0aGlzLmxpc3RlblRvKHRoaXMubW9kZWwsIFwiZGVzdHJveVwiLCB0aGlzLnJlbW92ZSk7XG4gICAgICB0aGlzLmxpc3RlblRvKHRoaXMubW9kZWwsIFwiY2xlYW5WaWV3XCIsIHRoaXMucmVtb3ZlKTtcbiAgICAgIHRoaXMubWVudU1vZGVsID0gdGhpcy5tb2RlbC5nZXQoXCJtZW51c1wiKTtcbiAgICB9LFxuXG4gICAgcmVuZGVyOiBmdW5jdGlvbiB2TWVudVJlbmRlcigpIHtcbiAgICAgIHZhciBjdXJyZW50VmlldyA9IHRoaXM7XG4gICAgICByZXR1cm4gbmV3IFByb21pc2UoXG4gICAgICAgIF8uYmluZChmdW5jdGlvbiB2TWVudVJlbmRlclByb21pc2UocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGN1cnJlbnRWaWV3LiRlbC5kY3BNZW51KGN1cnJlbnRWaWV3Lm1vZGVsLnRvRGF0YSgpKTtcbiAgICAgICAgICAgIGN1cnJlbnRWaWV3LnJlZnJlc2goKTtcbiAgICAgICAgICAgIHJldHVybiByZXNvbHZlKGN1cnJlbnRWaWV3KTtcbiAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICByZWplY3QoZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9LCB0aGlzKVxuICAgICAgKTtcbiAgICB9LFxuXG4gICAgZXh0ZXJuYWxMaW5rU2VsZWN0ZWQ6IGZ1bmN0aW9uIHZNZW51RXh0ZXJuYWxMaW5rU2VsZWN0ZWQoZXZlbnQsIG9wdGlvbnMpIHtcbiAgICAgIHZhciBpbnRlcm5hbEV2ZW50ID0ge1xuICAgICAgICBwcmV2ZW50OiBmYWxzZVxuICAgICAgfTtcblxuICAgICAgb3B0aW9ucy5hdHRyaWQgPSB0aGlzLm1vZGVsLmlkO1xuICAgICAgdGhpcy5tb2RlbC50cmlnZ2VyKFwiaW50ZXJuYWxMaW5rU2VsZWN0ZWRcIiwgaW50ZXJuYWxFdmVudCwgb3B0aW9ucyk7XG4gICAgICBpZiAoZXZlbnQucHJldmVudCkge1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgIH1cbiAgICAgIHRoaXMubW9kZWwudHJpZ2dlcihcImFjdGlvbkF0dHJpYnV0ZUxpbmtcIiwgaW50ZXJuYWxFdmVudCwgb3B0aW9ucyk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgc2hvd01lc3NhZ2U6IGZ1bmN0aW9uIHZNZW51c2hvd01lc3NhZ2UoZXZlbnQsIG9wdGlvbnMpIHtcbiAgICAgIG9wdGlvbnMuYXR0cmlkID0gdGhpcy5tb2RlbC5pZDtcbiAgICAgIHRoaXMubW9kZWwudHJpZ2dlcihcInNob3dNZXNzYWdlXCIsIG9wdGlvbnMpO1xuXG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuICAgIHJlbG9hZERvY3VtZW50OiBmdW5jdGlvbiB2TWVudXJlbG9hZERvY3VtZW50KGV2ZW50LCBvcHRpb25zKSB7XG4gICAgICB0aGlzLm1vZGVsLnRyaWdnZXIoXCJyZWxvYWRcIiwgb3B0aW9ucyk7XG5cbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG4gICAgY2hhbmdlVmlzaWJpbGl0eTogZnVuY3Rpb24gdk1lbnVjaGFuZ2VWaXNpYmlsaXR5KGV2ZW50LCBkYXRhKSB7XG4gICAgICB2YXIgbWVudUl0ZW0gPSB0aGlzLm1lbnVNb2RlbC5nZXQoZGF0YS5pZCk7XG4gICAgICB2YXIgb25seUlmVmlzaWJsZSA9ICEhZGF0YS5vbmx5SWZWaXNpYmxlO1xuICAgICAgdmFyIHZpc2liaWxpdHk7XG4gICAgICBpZiAobWVudUl0ZW0pIHtcbiAgICAgICAgdmlzaWJpbGl0eSA9IG1lbnVJdGVtLmdldChcInZpc2liaWxpdHlcIik7XG4gICAgICAgIGlmICghb25seUlmVmlzaWJsZSB8fCB2aXNpYmlsaXR5ICE9PSBcImhpZGRlblwiKSB7XG4gICAgICAgICAgbWVudUl0ZW0uc2V0KFwidmlzaWJpbGl0eVwiLCBkYXRhLnZpc2liaWxpdHkpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcblxuICAgIHVwZGF0ZVdpZGdldDogZnVuY3Rpb24gdk1lbnVVcGRhdGVXaWRnZXQoKSB7XG4gICAgICBpZiAodGhpcy4kZWwuZGNwTWVudSAmJiB0aGlzLl9maW5kV2lkZ2V0TmFtZSh0aGlzLiRlbCkpIHtcbiAgICAgICAgdGhpcy4kZWwuZGNwTWVudShcImRlc3Ryb3lcIik7XG4gICAgICB9XG4gICAgICByZXR1cm4gdGhpcy5yZW5kZXIoKTtcbiAgICB9LFxuXG4gICAgcmVtb3ZlOiBmdW5jdGlvbiB2TWVudVJlbW92ZSgpIHtcbiAgICAgIGlmICh0aGlzLiRlbC5kY3BNZW51ICYmIHRoaXMuX2ZpbmRXaWRnZXROYW1lKHRoaXMuJGVsKSkge1xuICAgICAgICB0aGlzLiRlbC5kY3BNZW51KFwiZGVzdHJveVwiKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBCYWNrYm9uZS5WaWV3LnByb3RvdHlwZS5yZW1vdmUuY2FsbCh0aGlzKTtcbiAgICB9LFxuXG4gICAgX2ZpbmRXaWRnZXROYW1lOiBmdW5jdGlvbiB2TWVudV9maW5kV2lkZ2V0TmFtZSgkZWxlbWVudCkge1xuICAgICAgcmV0dXJuIF8uZmluZChfLmtleXMoJGVsZW1lbnQuZGF0YSgpKSwgZnVuY3Rpb24oY3VycmVudEtleSkge1xuICAgICAgICByZXR1cm4gY3VycmVudEtleS5pbmRleE9mKFwiZGNwRGNwXCIpICE9PSAtMTtcbiAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBSZWNvbXB1dGUgcmVzcG9uc2l2ZSBpbiBjYXNlIG9mIHNjcm9sbGJhciBjYW4gYXBwZWFyXG4gICAgICovXG4gICAgcmVmcmVzaDogZnVuY3Rpb24gdk1lbnVfcmVmcmVzaCgpIHtcbiAgICAgIGlmICh0aGlzLiRlbC5kY3BNZW51ICYmIHRoaXMuX2ZpbmRXaWRnZXROYW1lKHRoaXMuJGVsKSkge1xuICAgICAgICB0aGlzLiRlbC5kY3BNZW51KFwidXBkYXRlUmVzcG9uc2l2ZU1lbnVcIik7XG4gICAgICB9XG4gICAgfVxuICB9KTtcbn0pO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///30f8a357b2168c64d123\n");

/***/ }),

/***/ "35dd456a4962187f103a":
/*!*****************************************************************!*\
  !*** ./src/Apps/DOCUMENT/IHM/views/attributes/array/vColumn.js ***!
  \*****************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/*global define*/\n!(__WEBPACK_AMD_DEFINE_ARRAY__ = [\n  __webpack_require__(/*! jquery */ \"127c8cf59f228bb01a21\"),\n  __webpack_require__(/*! underscore */ \"8e08e542008e4aef1f58\"),\n  __webpack_require__(/*! backbone */ \"1858b45bf48591489d06\"),\n  __webpack_require__(/*! mustache */ \"bcd31d01884fc294fd69\"),\n  __webpack_require__(/*! dcpDocument/views/attributes/vAttribute */ \"fde693488ffc947d1881\"),\n  __webpack_require__(/*! dcpDocument/views/document/attributeTemplate */ \"593c8c94ba4399020f79\")\n], __WEBPACK_AMD_DEFINE_RESULT__ = (function vColumn(\n  $,\n  _,\n  Backbone,\n  Mustache,\n  ViewAttribute,\n  attributeTemplate\n) {\n  \"use strict\";\n\n  return ViewAttribute.extend({\n    /**\n     * Use special event to trigger only attributes of model\n     */\n    attributeEvents: function vColumnEvents() {\n      var events = {};\n      this._mergeEvent(events, \"delete\", \"deleteValue\");\n      this._mergeEvent(\n        events,\n        \"changeattrmenuvisibility\",\n        \"changeMenuVisibility\"\n      );\n      this._mergeEvent(events, \"changeattrsvalue\", \"changeAttributesValue\");\n      this._mergeEvent(events, \"fetchdocument\", \"loadDocument\");\n      this._mergeEvent(events, \"externallinkselected\", \"externalLinkSelected\");\n      this._mergeEvent(events, \"downloadfile\", \"downloadFileSelect\");\n      this._mergeEvent(events, \"uploadfile\", \"uploadFileSelect\");\n      this._mergeEvent(events, \"uploadfiledone\", \"uploadFileDone\");\n      this._mergeEvent(events, \"anchorclick\", \"anchorClick\");\n      this.listenTo(this.model, \"change:label\", this.changeLabel);\n      return events;\n    },\n\n    _mergeEvent: function vColumn_addEvent(events, name, method) {\n      events[\n        \"dcpattribute\" +\n          name +\n          ' .dcpArray__content__cell[data-attrid=\"' +\n          this.model.id +\n          '\"]'\n      ] = method;\n    },\n\n    render: function vColumnRender() {\n      var scope = this;\n      if (this.displayLabel === false) {\n        // Need to defer because thead is not construct yet\n        _.defer(function vColumnHideHead() {\n          var $head = scope.$el.find(\n            '.dcpArray__head__cell[data-attrid=\"' + scope.model.id + '\"]'\n          );\n          $head.hide();\n        });\n      } else {\n        // Need to defer because thead is not construct yet\n        _.defer(function vColumnDescriptionHead() {\n          var $head = scope.$el.find(\n            '.dcpArray__head__cell[data-attrid=\"' + scope.model.id + '\"]'\n          );\n          attributeTemplate.insertDescription(scope, $head);\n        });\n      }\n      this.model.trigger(\"renderColumnDone\", {\n        model: this.model,\n        $el: this.$el\n      });\n      return this;\n    },\n\n    /**\n     * Change the label of the column\n     */\n    changeLabel: function vColumnChangeLabel() {\n      this.$el\n        .find('.dcpArray__head__cell[data-attrid=\"' + this.model.id + '\"]')\n        .text(this.model.get(\"label\"));\n    },\n\n    /**\n     * called by vArray::addLine()\n     * @param index row index\n     * @param customView HTML fragment to use for a custom view\n     */\n    addNewWidget: function vColumnAddNewWidget(index, customView) {\n      return new Promise(\n        _.bind(function vColumnAddNewWidget_promise(resolve, reject) {\n          try {\n            if (this.options) {\n              var cells = this.options.parentElement.find(\n                  '.dcpArray__content__cell[data-attrid=\"' +\n                    this.model.id +\n                    '\"]'\n                ),\n                $el,\n                data = this.getData(index),\n                event = { prevent: false };\n\n              if (cells[index]) {\n                try {\n                  $el = $(cells[index]);\n                  this.model.trigger(\"beforeRender\", event, {\n                    model: this.model,\n                    $el: $el,\n                    index: index\n                  });\n                  if (event.prevent) {\n                    resolve();\n                    return this;\n                  }\n                  if (customView) {\n                    $el.append(customView);\n                    this.model.trigger(\"renderDone\", {\n                      model: this.model,\n                      $el: $el,\n                      index: index\n                    });\n                    this.moveValueIndex({});\n                    resolve($el);\n                  } else {\n                    $el.one(\n                      \"dcpattributewidgetready .dcpAttribute__content\",\n                      _.bind(function vcolumnRender_widgetready() {\n                        this.model.trigger(\"renderDone\", {\n                          model: this.model,\n                          $el: $el,\n                          index: index\n                        });\n                        this.moveValueIndex({});\n                        resolve();\n                      }, this)\n                    );\n                    this.widgetInit($el, data);\n                    attributeTemplate.insertDescription(this, $el.parent());\n                    resolve();\n                  }\n                } catch (error) {\n                  if (window.dcp.logger) {\n                    window.dcp.logger(error);\n                  } else {\n                    console.error(error);\n                  }\n                  resolve();\n                }\n              } else {\n                resolve();\n              }\n            } else {\n              resolve();\n            }\n          } catch (e) {\n            reject(e);\n          }\n        }, this)\n      );\n    },\n\n    /**\n     *\n     * @param event\n     * @param options\n     */\n    loadDocument: function vColumnLoadDocument(event, options) {\n      var tableLine = options.tableLine,\n        index = options.index,\n        initid,\n        valueLine = this.model.get(\"attributeValue\")[tableLine],\n        documentModel = this.model.getDocumentModel();\n      if (_.isUndefined(index)) {\n        initid = valueLine.value;\n      } else {\n        initid = valueLine[index].value;\n      }\n\n      this.model.trigger(\"internalLinkSelected\", event, {\n        eventId: \"document.load\",\n        target: event.target,\n        attrid: this.model.id,\n        options: [initid, \"!defaultConsultation\"],\n        index: options.index,\n        row: tableLine\n      });\n\n      if (event.prevent) {\n        return this;\n      }\n\n      documentModel.fetchDocument({\n        initid: initid,\n        revision: -1,\n        viewId: \"!defaultConsultation\"\n      });\n    },\n\n    /**\n     * Hide all items of the column\n     */\n    hide: function vColumnHide() {\n      this.getDOMElements().each(function vColumnHideEach() {\n        var $cell = $(this);\n        var tagName = $cell.prop(\"tagName\").toLowerCase();\n\n        if (tagName !== \"td\" && tagName !== \"th\") {\n          $cell = $cell.closest(\"td.dcpArray__cell, th.dcpArray__head\");\n        }\n        $cell.hide();\n      });\n\n      this.$el.find('thead th[data-attrid=\"' + this.model.id + '\"]').hide();\n    },\n    /**\n     * Show all hidden items of the column\n     */\n    show: function vColumnShow() {\n      this.getDOMElements().each(function vColumnShowEach() {\n        var $cell = $(this);\n        var tagName = $cell.prop(\"tagName\").toLowerCase();\n\n        if (tagName !== \"td\" && tagName !== \"th\") {\n          $cell = $cell.closest(\"td.dcpArray__cell, th.dcpArray__head\");\n        }\n        $cell.show();\n      });\n      this.$el.find('thead th[data-attrid=\"' + this.model.id + '\"]').show();\n    }\n  });\n}).apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMzVkZDQ1NmE0OTYyMTg3ZjEwM2EuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvQXBwcy9ET0NVTUVOVC9JSE0vdmlld3MvYXR0cmlidXRlcy9hcnJheS92Q29sdW1uLmpzPzgwNTMiXSwic291cmNlc0NvbnRlbnQiOlsiLypnbG9iYWwgZGVmaW5lKi9cbmRlZmluZShbXG4gIFwianF1ZXJ5XCIsXG4gIFwidW5kZXJzY29yZVwiLFxuICBcImJhY2tib25lXCIsXG4gIFwibXVzdGFjaGVcIixcbiAgXCJkY3BEb2N1bWVudC92aWV3cy9hdHRyaWJ1dGVzL3ZBdHRyaWJ1dGVcIixcbiAgXCJkY3BEb2N1bWVudC92aWV3cy9kb2N1bWVudC9hdHRyaWJ1dGVUZW1wbGF0ZVwiXG5dLCBmdW5jdGlvbiB2Q29sdW1uKFxuICAkLFxuICBfLFxuICBCYWNrYm9uZSxcbiAgTXVzdGFjaGUsXG4gIFZpZXdBdHRyaWJ1dGUsXG4gIGF0dHJpYnV0ZVRlbXBsYXRlXG4pIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgcmV0dXJuIFZpZXdBdHRyaWJ1dGUuZXh0ZW5kKHtcbiAgICAvKipcbiAgICAgKiBVc2Ugc3BlY2lhbCBldmVudCB0byB0cmlnZ2VyIG9ubHkgYXR0cmlidXRlcyBvZiBtb2RlbFxuICAgICAqL1xuICAgIGF0dHJpYnV0ZUV2ZW50czogZnVuY3Rpb24gdkNvbHVtbkV2ZW50cygpIHtcbiAgICAgIHZhciBldmVudHMgPSB7fTtcbiAgICAgIHRoaXMuX21lcmdlRXZlbnQoZXZlbnRzLCBcImRlbGV0ZVwiLCBcImRlbGV0ZVZhbHVlXCIpO1xuICAgICAgdGhpcy5fbWVyZ2VFdmVudChcbiAgICAgICAgZXZlbnRzLFxuICAgICAgICBcImNoYW5nZWF0dHJtZW51dmlzaWJpbGl0eVwiLFxuICAgICAgICBcImNoYW5nZU1lbnVWaXNpYmlsaXR5XCJcbiAgICAgICk7XG4gICAgICB0aGlzLl9tZXJnZUV2ZW50KGV2ZW50cywgXCJjaGFuZ2VhdHRyc3ZhbHVlXCIsIFwiY2hhbmdlQXR0cmlidXRlc1ZhbHVlXCIpO1xuICAgICAgdGhpcy5fbWVyZ2VFdmVudChldmVudHMsIFwiZmV0Y2hkb2N1bWVudFwiLCBcImxvYWREb2N1bWVudFwiKTtcbiAgICAgIHRoaXMuX21lcmdlRXZlbnQoZXZlbnRzLCBcImV4dGVybmFsbGlua3NlbGVjdGVkXCIsIFwiZXh0ZXJuYWxMaW5rU2VsZWN0ZWRcIik7XG4gICAgICB0aGlzLl9tZXJnZUV2ZW50KGV2ZW50cywgXCJkb3dubG9hZGZpbGVcIiwgXCJkb3dubG9hZEZpbGVTZWxlY3RcIik7XG4gICAgICB0aGlzLl9tZXJnZUV2ZW50KGV2ZW50cywgXCJ1cGxvYWRmaWxlXCIsIFwidXBsb2FkRmlsZVNlbGVjdFwiKTtcbiAgICAgIHRoaXMuX21lcmdlRXZlbnQoZXZlbnRzLCBcInVwbG9hZGZpbGVkb25lXCIsIFwidXBsb2FkRmlsZURvbmVcIik7XG4gICAgICB0aGlzLl9tZXJnZUV2ZW50KGV2ZW50cywgXCJhbmNob3JjbGlja1wiLCBcImFuY2hvckNsaWNrXCIpO1xuICAgICAgdGhpcy5saXN0ZW5Ubyh0aGlzLm1vZGVsLCBcImNoYW5nZTpsYWJlbFwiLCB0aGlzLmNoYW5nZUxhYmVsKTtcbiAgICAgIHJldHVybiBldmVudHM7XG4gICAgfSxcblxuICAgIF9tZXJnZUV2ZW50OiBmdW5jdGlvbiB2Q29sdW1uX2FkZEV2ZW50KGV2ZW50cywgbmFtZSwgbWV0aG9kKSB7XG4gICAgICBldmVudHNbXG4gICAgICAgIFwiZGNwYXR0cmlidXRlXCIgK1xuICAgICAgICAgIG5hbWUgK1xuICAgICAgICAgICcgLmRjcEFycmF5X19jb250ZW50X19jZWxsW2RhdGEtYXR0cmlkPVwiJyArXG4gICAgICAgICAgdGhpcy5tb2RlbC5pZCArXG4gICAgICAgICAgJ1wiXSdcbiAgICAgIF0gPSBtZXRob2Q7XG4gICAgfSxcblxuICAgIHJlbmRlcjogZnVuY3Rpb24gdkNvbHVtblJlbmRlcigpIHtcbiAgICAgIHZhciBzY29wZSA9IHRoaXM7XG4gICAgICBpZiAodGhpcy5kaXNwbGF5TGFiZWwgPT09IGZhbHNlKSB7XG4gICAgICAgIC8vIE5lZWQgdG8gZGVmZXIgYmVjYXVzZSB0aGVhZCBpcyBub3QgY29uc3RydWN0IHlldFxuICAgICAgICBfLmRlZmVyKGZ1bmN0aW9uIHZDb2x1bW5IaWRlSGVhZCgpIHtcbiAgICAgICAgICB2YXIgJGhlYWQgPSBzY29wZS4kZWwuZmluZChcbiAgICAgICAgICAgICcuZGNwQXJyYXlfX2hlYWRfX2NlbGxbZGF0YS1hdHRyaWQ9XCInICsgc2NvcGUubW9kZWwuaWQgKyAnXCJdJ1xuICAgICAgICAgICk7XG4gICAgICAgICAgJGhlYWQuaGlkZSgpO1xuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIE5lZWQgdG8gZGVmZXIgYmVjYXVzZSB0aGVhZCBpcyBub3QgY29uc3RydWN0IHlldFxuICAgICAgICBfLmRlZmVyKGZ1bmN0aW9uIHZDb2x1bW5EZXNjcmlwdGlvbkhlYWQoKSB7XG4gICAgICAgICAgdmFyICRoZWFkID0gc2NvcGUuJGVsLmZpbmQoXG4gICAgICAgICAgICAnLmRjcEFycmF5X19oZWFkX19jZWxsW2RhdGEtYXR0cmlkPVwiJyArIHNjb3BlLm1vZGVsLmlkICsgJ1wiXSdcbiAgICAgICAgICApO1xuICAgICAgICAgIGF0dHJpYnV0ZVRlbXBsYXRlLmluc2VydERlc2NyaXB0aW9uKHNjb3BlLCAkaGVhZCk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgdGhpcy5tb2RlbC50cmlnZ2VyKFwicmVuZGVyQ29sdW1uRG9uZVwiLCB7XG4gICAgICAgIG1vZGVsOiB0aGlzLm1vZGVsLFxuICAgICAgICAkZWw6IHRoaXMuJGVsXG4gICAgICB9KTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBDaGFuZ2UgdGhlIGxhYmVsIG9mIHRoZSBjb2x1bW5cbiAgICAgKi9cbiAgICBjaGFuZ2VMYWJlbDogZnVuY3Rpb24gdkNvbHVtbkNoYW5nZUxhYmVsKCkge1xuICAgICAgdGhpcy4kZWxcbiAgICAgICAgLmZpbmQoJy5kY3BBcnJheV9faGVhZF9fY2VsbFtkYXRhLWF0dHJpZD1cIicgKyB0aGlzLm1vZGVsLmlkICsgJ1wiXScpXG4gICAgICAgIC50ZXh0KHRoaXMubW9kZWwuZ2V0KFwibGFiZWxcIikpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBjYWxsZWQgYnkgdkFycmF5OjphZGRMaW5lKClcbiAgICAgKiBAcGFyYW0gaW5kZXggcm93IGluZGV4XG4gICAgICogQHBhcmFtIGN1c3RvbVZpZXcgSFRNTCBmcmFnbWVudCB0byB1c2UgZm9yIGEgY3VzdG9tIHZpZXdcbiAgICAgKi9cbiAgICBhZGROZXdXaWRnZXQ6IGZ1bmN0aW9uIHZDb2x1bW5BZGROZXdXaWRnZXQoaW5kZXgsIGN1c3RvbVZpZXcpIHtcbiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShcbiAgICAgICAgXy5iaW5kKGZ1bmN0aW9uIHZDb2x1bW5BZGROZXdXaWRnZXRfcHJvbWlzZShyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucykge1xuICAgICAgICAgICAgICB2YXIgY2VsbHMgPSB0aGlzLm9wdGlvbnMucGFyZW50RWxlbWVudC5maW5kKFxuICAgICAgICAgICAgICAgICAgJy5kY3BBcnJheV9fY29udGVudF9fY2VsbFtkYXRhLWF0dHJpZD1cIicgK1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLmlkICtcbiAgICAgICAgICAgICAgICAgICAgJ1wiXSdcbiAgICAgICAgICAgICAgICApLFxuICAgICAgICAgICAgICAgICRlbCxcbiAgICAgICAgICAgICAgICBkYXRhID0gdGhpcy5nZXREYXRhKGluZGV4KSxcbiAgICAgICAgICAgICAgICBldmVudCA9IHsgcHJldmVudDogZmFsc2UgfTtcblxuICAgICAgICAgICAgICBpZiAoY2VsbHNbaW5kZXhdKSB7XG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICRlbCA9ICQoY2VsbHNbaW5kZXhdKTtcbiAgICAgICAgICAgICAgICAgIHRoaXMubW9kZWwudHJpZ2dlcihcImJlZm9yZVJlbmRlclwiLCBldmVudCwge1xuICAgICAgICAgICAgICAgICAgICBtb2RlbDogdGhpcy5tb2RlbCxcbiAgICAgICAgICAgICAgICAgICAgJGVsOiAkZWwsXG4gICAgICAgICAgICAgICAgICAgIGluZGV4OiBpbmRleFxuICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICBpZiAoZXZlbnQucHJldmVudCkge1xuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgaWYgKGN1c3RvbVZpZXcpIHtcbiAgICAgICAgICAgICAgICAgICAgJGVsLmFwcGVuZChjdXN0b21WaWV3KTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb2RlbC50cmlnZ2VyKFwicmVuZGVyRG9uZVwiLCB7XG4gICAgICAgICAgICAgICAgICAgICAgbW9kZWw6IHRoaXMubW9kZWwsXG4gICAgICAgICAgICAgICAgICAgICAgJGVsOiAkZWwsXG4gICAgICAgICAgICAgICAgICAgICAgaW5kZXg6IGluZGV4XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm1vdmVWYWx1ZUluZGV4KHt9KTtcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgkZWwpO1xuICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgJGVsLm9uZShcbiAgICAgICAgICAgICAgICAgICAgICBcImRjcGF0dHJpYnV0ZXdpZGdldHJlYWR5IC5kY3BBdHRyaWJ1dGVfX2NvbnRlbnRcIixcbiAgICAgICAgICAgICAgICAgICAgICBfLmJpbmQoZnVuY3Rpb24gdmNvbHVtblJlbmRlcl93aWRnZXRyZWFkeSgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubW9kZWwudHJpZ2dlcihcInJlbmRlckRvbmVcIiwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RlbDogdGhpcy5tb2RlbCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgJGVsOiAkZWwsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4OiBpbmRleFxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1vdmVWYWx1ZUluZGV4KHt9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgICB9LCB0aGlzKVxuICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLndpZGdldEluaXQoJGVsLCBkYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlVGVtcGxhdGUuaW5zZXJ0RGVzY3JpcHRpb24odGhpcywgJGVsLnBhcmVudCgpKTtcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICBpZiAod2luZG93LmRjcC5sb2dnZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgd2luZG93LmRjcC5sb2dnZXIoZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICByZXNvbHZlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHJlamVjdChlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sIHRoaXMpXG4gICAgICApO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKlxuICAgICAqIEBwYXJhbSBldmVudFxuICAgICAqIEBwYXJhbSBvcHRpb25zXG4gICAgICovXG4gICAgbG9hZERvY3VtZW50OiBmdW5jdGlvbiB2Q29sdW1uTG9hZERvY3VtZW50KGV2ZW50LCBvcHRpb25zKSB7XG4gICAgICB2YXIgdGFibGVMaW5lID0gb3B0aW9ucy50YWJsZUxpbmUsXG4gICAgICAgIGluZGV4ID0gb3B0aW9ucy5pbmRleCxcbiAgICAgICAgaW5pdGlkLFxuICAgICAgICB2YWx1ZUxpbmUgPSB0aGlzLm1vZGVsLmdldChcImF0dHJpYnV0ZVZhbHVlXCIpW3RhYmxlTGluZV0sXG4gICAgICAgIGRvY3VtZW50TW9kZWwgPSB0aGlzLm1vZGVsLmdldERvY3VtZW50TW9kZWwoKTtcbiAgICAgIGlmIChfLmlzVW5kZWZpbmVkKGluZGV4KSkge1xuICAgICAgICBpbml0aWQgPSB2YWx1ZUxpbmUudmFsdWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpbml0aWQgPSB2YWx1ZUxpbmVbaW5kZXhdLnZhbHVlO1xuICAgICAgfVxuXG4gICAgICB0aGlzLm1vZGVsLnRyaWdnZXIoXCJpbnRlcm5hbExpbmtTZWxlY3RlZFwiLCBldmVudCwge1xuICAgICAgICBldmVudElkOiBcImRvY3VtZW50LmxvYWRcIixcbiAgICAgICAgdGFyZ2V0OiBldmVudC50YXJnZXQsXG4gICAgICAgIGF0dHJpZDogdGhpcy5tb2RlbC5pZCxcbiAgICAgICAgb3B0aW9uczogW2luaXRpZCwgXCIhZGVmYXVsdENvbnN1bHRhdGlvblwiXSxcbiAgICAgICAgaW5kZXg6IG9wdGlvbnMuaW5kZXgsXG4gICAgICAgIHJvdzogdGFibGVMaW5lXG4gICAgICB9KTtcblxuICAgICAgaWYgKGV2ZW50LnByZXZlbnQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICB9XG5cbiAgICAgIGRvY3VtZW50TW9kZWwuZmV0Y2hEb2N1bWVudCh7XG4gICAgICAgIGluaXRpZDogaW5pdGlkLFxuICAgICAgICByZXZpc2lvbjogLTEsXG4gICAgICAgIHZpZXdJZDogXCIhZGVmYXVsdENvbnN1bHRhdGlvblwiXG4gICAgICB9KTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogSGlkZSBhbGwgaXRlbXMgb2YgdGhlIGNvbHVtblxuICAgICAqL1xuICAgIGhpZGU6IGZ1bmN0aW9uIHZDb2x1bW5IaWRlKCkge1xuICAgICAgdGhpcy5nZXRET01FbGVtZW50cygpLmVhY2goZnVuY3Rpb24gdkNvbHVtbkhpZGVFYWNoKCkge1xuICAgICAgICB2YXIgJGNlbGwgPSAkKHRoaXMpO1xuICAgICAgICB2YXIgdGFnTmFtZSA9ICRjZWxsLnByb3AoXCJ0YWdOYW1lXCIpLnRvTG93ZXJDYXNlKCk7XG5cbiAgICAgICAgaWYgKHRhZ05hbWUgIT09IFwidGRcIiAmJiB0YWdOYW1lICE9PSBcInRoXCIpIHtcbiAgICAgICAgICAkY2VsbCA9ICRjZWxsLmNsb3Nlc3QoXCJ0ZC5kY3BBcnJheV9fY2VsbCwgdGguZGNwQXJyYXlfX2hlYWRcIik7XG4gICAgICAgIH1cbiAgICAgICAgJGNlbGwuaGlkZSgpO1xuICAgICAgfSk7XG5cbiAgICAgIHRoaXMuJGVsLmZpbmQoJ3RoZWFkIHRoW2RhdGEtYXR0cmlkPVwiJyArIHRoaXMubW9kZWwuaWQgKyAnXCJdJykuaGlkZSgpO1xuICAgIH0sXG4gICAgLyoqXG4gICAgICogU2hvdyBhbGwgaGlkZGVuIGl0ZW1zIG9mIHRoZSBjb2x1bW5cbiAgICAgKi9cbiAgICBzaG93OiBmdW5jdGlvbiB2Q29sdW1uU2hvdygpIHtcbiAgICAgIHRoaXMuZ2V0RE9NRWxlbWVudHMoKS5lYWNoKGZ1bmN0aW9uIHZDb2x1bW5TaG93RWFjaCgpIHtcbiAgICAgICAgdmFyICRjZWxsID0gJCh0aGlzKTtcbiAgICAgICAgdmFyIHRhZ05hbWUgPSAkY2VsbC5wcm9wKFwidGFnTmFtZVwiKS50b0xvd2VyQ2FzZSgpO1xuXG4gICAgICAgIGlmICh0YWdOYW1lICE9PSBcInRkXCIgJiYgdGFnTmFtZSAhPT0gXCJ0aFwiKSB7XG4gICAgICAgICAgJGNlbGwgPSAkY2VsbC5jbG9zZXN0KFwidGQuZGNwQXJyYXlfX2NlbGwsIHRoLmRjcEFycmF5X19oZWFkXCIpO1xuICAgICAgICB9XG4gICAgICAgICRjZWxsLnNob3coKTtcbiAgICAgIH0pO1xuICAgICAgdGhpcy4kZWwuZmluZCgndGhlYWQgdGhbZGF0YS1hdHRyaWQ9XCInICsgdGhpcy5tb2RlbC5pZCArICdcIl0nKS5zaG93KCk7XG4gICAgfVxuICB9KTtcbn0pO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///35dd456a4962187f103a\n");

/***/ }),

/***/ "37746b3b205813560cd8":
/*!*******************************************************!*\
  !*** ./src/Apps/DOCUMENT/IHM/models/mDocumentLock.js ***!
  \*******************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(/*! underscore */ \"8e08e542008e4aef1f58\"), __webpack_require__(/*! backbone */ \"1858b45bf48591489d06\")], __WEBPACK_AMD_DEFINE_RESULT__ = (function require_lock(_, Backbone) {\n  \"use strict\";\n\n  var urlCore = _.template(\"api/v2/documents/<%- initid %>/locks/<%- type %>\");\n  var urlView = _.template(\n    \"api/v2/documents/<%- initid %>/views/<%- viewId %>/locks/<%- type %>\"\n  );\n\n  return Backbone.Model.extend({\n    typeModel: \"ddui:lock\",\n    idAttribute: \"initid\",\n    viewId: \"\",\n\n    url: function mDocumentLock_url() {\n      //console.log(\"lock model\", this.get(\"viewId\"));\n      if (this.get(\"viewId\")) {\n        return urlView({\n          initid: this.get(\"initid\"),\n          type: this.get(\"type\"),\n          viewId: this.get(\"viewId\")\n        });\n      } else {\n        return urlCore({\n          initid: this.get(\"initid\"),\n          type: this.get(\"type\")\n        });\n      }\n    }\n  });\n}).apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMzc3NDZiM2IyMDU4MTM1NjBjZDguanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvQXBwcy9ET0NVTUVOVC9JSE0vbW9kZWxzL21Eb2N1bWVudExvY2suanM/NDQxYyJdLCJzb3VyY2VzQ29udGVudCI6WyJkZWZpbmUoW1widW5kZXJzY29yZVwiLCBcImJhY2tib25lXCJdLCBmdW5jdGlvbiByZXF1aXJlX2xvY2soXywgQmFja2JvbmUpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgdmFyIHVybENvcmUgPSBfLnRlbXBsYXRlKFwiYXBpL3YyL2RvY3VtZW50cy88JS0gaW5pdGlkICU+L2xvY2tzLzwlLSB0eXBlICU+XCIpO1xuICB2YXIgdXJsVmlldyA9IF8udGVtcGxhdGUoXG4gICAgXCJhcGkvdjIvZG9jdW1lbnRzLzwlLSBpbml0aWQgJT4vdmlld3MvPCUtIHZpZXdJZCAlPi9sb2Nrcy88JS0gdHlwZSAlPlwiXG4gICk7XG5cbiAgcmV0dXJuIEJhY2tib25lLk1vZGVsLmV4dGVuZCh7XG4gICAgdHlwZU1vZGVsOiBcImRkdWk6bG9ja1wiLFxuICAgIGlkQXR0cmlidXRlOiBcImluaXRpZFwiLFxuICAgIHZpZXdJZDogXCJcIixcblxuICAgIHVybDogZnVuY3Rpb24gbURvY3VtZW50TG9ja191cmwoKSB7XG4gICAgICAvL2NvbnNvbGUubG9nKFwibG9jayBtb2RlbFwiLCB0aGlzLmdldChcInZpZXdJZFwiKSk7XG4gICAgICBpZiAodGhpcy5nZXQoXCJ2aWV3SWRcIikpIHtcbiAgICAgICAgcmV0dXJuIHVybFZpZXcoe1xuICAgICAgICAgIGluaXRpZDogdGhpcy5nZXQoXCJpbml0aWRcIiksXG4gICAgICAgICAgdHlwZTogdGhpcy5nZXQoXCJ0eXBlXCIpLFxuICAgICAgICAgIHZpZXdJZDogdGhpcy5nZXQoXCJ2aWV3SWRcIilcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gdXJsQ29yZSh7XG4gICAgICAgICAgaW5pdGlkOiB0aGlzLmdldChcImluaXRpZFwiKSxcbiAgICAgICAgICB0eXBlOiB0aGlzLmdldChcInR5cGVcIilcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuICB9KTtcbn0pO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///37746b3b205813560cd8\n");

/***/ }),

/***/ "3d2e52a160dc74b891c1":
/*!****************************************************************************!*\
  !*** ./node_modules/@progress/kendo-ui/js/cultures/kendo.culture.fr-FR.js ***!
  \****************************************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("module.exports =\n/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\texports: {},\n/******/ \t\t\tid: moduleId,\n/******/ \t\t\tloaded: false\n/******/ \t\t};\n\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.loaded = true;\n\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n\n\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ({\n\n/***/ 0:\n/***/ (function(module, exports, __webpack_require__) {\n\n\t__webpack_require__(335);\n\tmodule.exports = __webpack_require__(335);\n\n\n/***/ }),\n\n/***/ 335:\n/***/ (function(module, exports) {\n\n\t(function( window, undefined ) {\n\t    kendo.cultures[\"fr-FR\"] = {\n\t        name: \"fr-FR\",\n\t        numberFormat: {\n\t            pattern: [\"-n\"],\n\t            decimals: 2,\n\t            \",\": \"\",\n\t            \".\": \",\",\n\t            groupSize: [3],\n\t            percent: {\n\t                pattern: [\"-n %\",\"n %\"],\n\t                decimals: 2,\n\t                \",\": \"\",\n\t                \".\": \",\",\n\t                groupSize: [3],\n\t                symbol: \"%\"\n\t            },\n\t            currency: {\n\t                name: \"Euro\",\n\t                abbr: \"EUR\",\n\t                pattern: [\"-n $\",\"n $\"],\n\t                decimals: 2,\n\t                \",\": \"\",\n\t                \".\": \",\",\n\t                groupSize: [3],\n\t                symbol: \"\"\n\t            }\n\t        },\n\t        calendars: {\n\t            standard: {\n\t                days: {\n\t                    names: [\"dimanche\",\"lundi\",\"mardi\",\"mercredi\",\"jeudi\",\"vendredi\",\"samedi\"],\n\t                    namesAbbr: [\"dim.\",\"lun.\",\"mar.\",\"mer.\",\"jeu.\",\"ven.\",\"sam.\"],\n\t                    namesShort: [\"di\",\"lu\",\"ma\",\"me\",\"je\",\"ve\",\"sa\"]\n\t                },\n\t                months: {\n\t                    names: [\"janvier\",\"fvrier\",\"mars\",\"avril\",\"mai\",\"juin\",\"juillet\",\"aot\",\"septembre\",\"octobre\",\"novembre\",\"dcembre\"],\n\t                    namesAbbr: [\"janv.\",\"fvr.\",\"mars\",\"avr.\",\"mai\",\"juin\",\"juil.\",\"aot\",\"sept.\",\"oct.\",\"nov.\",\"dc.\"]\n\t                },\n\t                AM: [\"\"],\n\t                PM: [\"\"],\n\t                patterns: {\n\t                    d: \"dd/MM/yyyy\",\n\t                    D: \"dddd d MMMM yyyy\",\n\t                    F: \"dddd d MMMM yyyy HH:mm:ss\",\n\t                    g: \"dd/MM/yyyy HH:mm\",\n\t                    G: \"dd/MM/yyyy HH:mm:ss\",\n\t                    m: \"d MMMM\",\n\t                    M: \"d MMMM\",\n\t                    s: \"yyyy'-'MM'-'dd'T'HH':'mm':'ss\",\n\t                    t: \"HH:mm\",\n\t                    T: \"HH:mm:ss\",\n\t                    u: \"yyyy'-'MM'-'dd HH':'mm':'ss'Z'\",\n\t                    y: \"MMMM yyyy\",\n\t                    Y: \"MMMM yyyy\"\n\t                },\n\t                \"/\": \"/\",\n\t                \":\": \":\",\n\t                firstDay: 1\n\t            }\n\t        }\n\t    }\n\t})(this);\n\n\n/***/ })\n\n/******/ });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiM2QyZTUyYTE2MGRjNzRiODkxYzEuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvQHByb2dyZXNzL2tlbmRvLXVpL2pzL2N1bHR1cmVzL2tlbmRvLmN1bHR1cmUuZnItRlIuanM/ZDgwYiJdLCJzb3VyY2VzQ29udGVudCI6WyJtb2R1bGUuZXhwb3J0cyA9XG4vKioqKioqLyAoZnVuY3Rpb24obW9kdWxlcykgeyAvLyB3ZWJwYWNrQm9vdHN0cmFwXG4vKioqKioqLyBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbi8qKioqKiovIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuLyoqKioqKi8gXHQvLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuLyoqKioqKi8gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbi8qKioqKiovIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbi8qKioqKiovIFx0XHRpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSlcbi8qKioqKiovIFx0XHRcdHJldHVybiBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXS5leHBvcnRzO1xuXG4vKioqKioqLyBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbi8qKioqKiovIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4vKioqKioqLyBcdFx0XHRleHBvcnRzOiB7fSxcbi8qKioqKiovIFx0XHRcdGlkOiBtb2R1bGVJZCxcbi8qKioqKiovIFx0XHRcdGxvYWRlZDogZmFsc2Vcbi8qKioqKiovIFx0XHR9O1xuXG4vKioqKioqLyBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4vKioqKioqLyBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cbi8qKioqKiovIFx0XHQvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkXG4vKioqKioqLyBcdFx0bW9kdWxlLmxvYWRlZCA9IHRydWU7XG5cbi8qKioqKiovIFx0XHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuLyoqKioqKi8gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbi8qKioqKiovIFx0fVxuXG5cbi8qKioqKiovIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXylcbi8qKioqKiovIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuLyoqKioqKi8gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuLyoqKioqKi8gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmMgPSBpbnN0YWxsZWRNb2R1bGVzO1xuXG4vKioqKioqLyBcdC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fXG4vKioqKioqLyBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cbi8qKioqKiovIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4vKioqKioqLyBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKDApO1xuLyoqKioqKi8gfSlcbi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG4vKioqKioqLyAoe1xuXG4vKioqLyAwOlxuLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykge1xuXG5cdF9fd2VicGFja19yZXF1aXJlX18oMzM1KTtcblx0bW9kdWxlLmV4cG9ydHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDMzNSk7XG5cblxuLyoqKi8gfSksXG5cbi8qKiovIDMzNTpcbi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHtcblxuXHQoZnVuY3Rpb24oIHdpbmRvdywgdW5kZWZpbmVkICkge1xuXHQgICAga2VuZG8uY3VsdHVyZXNbXCJmci1GUlwiXSA9IHtcblx0ICAgICAgICBuYW1lOiBcImZyLUZSXCIsXG5cdCAgICAgICAgbnVtYmVyRm9ybWF0OiB7XG5cdCAgICAgICAgICAgIHBhdHRlcm46IFtcIi1uXCJdLFxuXHQgICAgICAgICAgICBkZWNpbWFsczogMixcblx0ICAgICAgICAgICAgXCIsXCI6IFwiwqBcIixcblx0ICAgICAgICAgICAgXCIuXCI6IFwiLFwiLFxuXHQgICAgICAgICAgICBncm91cFNpemU6IFszXSxcblx0ICAgICAgICAgICAgcGVyY2VudDoge1xuXHQgICAgICAgICAgICAgICAgcGF0dGVybjogW1wiLW4gJVwiLFwibiAlXCJdLFxuXHQgICAgICAgICAgICAgICAgZGVjaW1hbHM6IDIsXG5cdCAgICAgICAgICAgICAgICBcIixcIjogXCLCoFwiLFxuXHQgICAgICAgICAgICAgICAgXCIuXCI6IFwiLFwiLFxuXHQgICAgICAgICAgICAgICAgZ3JvdXBTaXplOiBbM10sXG5cdCAgICAgICAgICAgICAgICBzeW1ib2w6IFwiJVwiXG5cdCAgICAgICAgICAgIH0sXG5cdCAgICAgICAgICAgIGN1cnJlbmN5OiB7XG5cdCAgICAgICAgICAgICAgICBuYW1lOiBcIkV1cm9cIixcblx0ICAgICAgICAgICAgICAgIGFiYnI6IFwiRVVSXCIsXG5cdCAgICAgICAgICAgICAgICBwYXR0ZXJuOiBbXCItbiAkXCIsXCJuICRcIl0sXG5cdCAgICAgICAgICAgICAgICBkZWNpbWFsczogMixcblx0ICAgICAgICAgICAgICAgIFwiLFwiOiBcIsKgXCIsXG5cdCAgICAgICAgICAgICAgICBcIi5cIjogXCIsXCIsXG5cdCAgICAgICAgICAgICAgICBncm91cFNpemU6IFszXSxcblx0ICAgICAgICAgICAgICAgIHN5bWJvbDogXCLigqxcIlxuXHQgICAgICAgICAgICB9XG5cdCAgICAgICAgfSxcblx0ICAgICAgICBjYWxlbmRhcnM6IHtcblx0ICAgICAgICAgICAgc3RhbmRhcmQ6IHtcblx0ICAgICAgICAgICAgICAgIGRheXM6IHtcblx0ICAgICAgICAgICAgICAgICAgICBuYW1lczogW1wiZGltYW5jaGVcIixcImx1bmRpXCIsXCJtYXJkaVwiLFwibWVyY3JlZGlcIixcImpldWRpXCIsXCJ2ZW5kcmVkaVwiLFwic2FtZWRpXCJdLFxuXHQgICAgICAgICAgICAgICAgICAgIG5hbWVzQWJicjogW1wiZGltLlwiLFwibHVuLlwiLFwibWFyLlwiLFwibWVyLlwiLFwiamV1LlwiLFwidmVuLlwiLFwic2FtLlwiXSxcblx0ICAgICAgICAgICAgICAgICAgICBuYW1lc1Nob3J0OiBbXCJkaVwiLFwibHVcIixcIm1hXCIsXCJtZVwiLFwiamVcIixcInZlXCIsXCJzYVwiXVxuXHQgICAgICAgICAgICAgICAgfSxcblx0ICAgICAgICAgICAgICAgIG1vbnRoczoge1xuXHQgICAgICAgICAgICAgICAgICAgIG5hbWVzOiBbXCJqYW52aWVyXCIsXCJmw6l2cmllclwiLFwibWFyc1wiLFwiYXZyaWxcIixcIm1haVwiLFwianVpblwiLFwianVpbGxldFwiLFwiYW/Du3RcIixcInNlcHRlbWJyZVwiLFwib2N0b2JyZVwiLFwibm92ZW1icmVcIixcImTDqWNlbWJyZVwiXSxcblx0ICAgICAgICAgICAgICAgICAgICBuYW1lc0FiYnI6IFtcImphbnYuXCIsXCJmw6l2ci5cIixcIm1hcnNcIixcImF2ci5cIixcIm1haVwiLFwianVpblwiLFwianVpbC5cIixcImFvw7t0XCIsXCJzZXB0LlwiLFwib2N0LlwiLFwibm92LlwiLFwiZMOpYy5cIl1cblx0ICAgICAgICAgICAgICAgIH0sXG5cdCAgICAgICAgICAgICAgICBBTTogW1wiXCJdLFxuXHQgICAgICAgICAgICAgICAgUE06IFtcIlwiXSxcblx0ICAgICAgICAgICAgICAgIHBhdHRlcm5zOiB7XG5cdCAgICAgICAgICAgICAgICAgICAgZDogXCJkZC9NTS95eXl5XCIsXG5cdCAgICAgICAgICAgICAgICAgICAgRDogXCJkZGRkIGQgTU1NTSB5eXl5XCIsXG5cdCAgICAgICAgICAgICAgICAgICAgRjogXCJkZGRkIGQgTU1NTSB5eXl5IEhIOm1tOnNzXCIsXG5cdCAgICAgICAgICAgICAgICAgICAgZzogXCJkZC9NTS95eXl5IEhIOm1tXCIsXG5cdCAgICAgICAgICAgICAgICAgICAgRzogXCJkZC9NTS95eXl5IEhIOm1tOnNzXCIsXG5cdCAgICAgICAgICAgICAgICAgICAgbTogXCJkIE1NTU1cIixcblx0ICAgICAgICAgICAgICAgICAgICBNOiBcImQgTU1NTVwiLFxuXHQgICAgICAgICAgICAgICAgICAgIHM6IFwieXl5eSctJ01NJy0nZGQnVCdISCc6J21tJzonc3NcIixcblx0ICAgICAgICAgICAgICAgICAgICB0OiBcIkhIOm1tXCIsXG5cdCAgICAgICAgICAgICAgICAgICAgVDogXCJISDptbTpzc1wiLFxuXHQgICAgICAgICAgICAgICAgICAgIHU6IFwieXl5eSctJ01NJy0nZGQgSEgnOidtbSc6J3NzJ1onXCIsXG5cdCAgICAgICAgICAgICAgICAgICAgeTogXCJNTU1NIHl5eXlcIixcblx0ICAgICAgICAgICAgICAgICAgICBZOiBcIk1NTU0geXl5eVwiXG5cdCAgICAgICAgICAgICAgICB9LFxuXHQgICAgICAgICAgICAgICAgXCIvXCI6IFwiL1wiLFxuXHQgICAgICAgICAgICAgICAgXCI6XCI6IFwiOlwiLFxuXHQgICAgICAgICAgICAgICAgZmlyc3REYXk6IDFcblx0ICAgICAgICAgICAgfVxuXHQgICAgICAgIH1cblx0ICAgIH1cblx0fSkodGhpcyk7XG5cblxuLyoqKi8gfSlcblxuLyoqKioqKi8gfSk7Il0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///3d2e52a160dc74b891c1\n");

/***/ }),

/***/ "3e588fcfb2b891e35e39":
/*!******************************************************************!*\
  !*** ./src/Apps/DOCUMENT/IHM/widgets/attributes/array/wArray.js ***!
  \******************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;(function umdRequire(root, factory) {\n  \"use strict\";\n\n  if (true) {\n    !(__WEBPACK_AMD_DEFINE_ARRAY__ = [\n      __webpack_require__(/*! jquery */ \"127c8cf59f228bb01a21\"),\n      __webpack_require__(/*! underscore */ \"8e08e542008e4aef1f58\"),\n      __webpack_require__(/*! mustache */ \"bcd31d01884fc294fd69\"),\n      __webpack_require__(/*! dcpDocument/widgets/widget */ \"f562ab9f022eef93542c\")\n    ], __WEBPACK_AMD_DEFINE_FACTORY__ = (factory),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?\n\t\t\t\t(__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n  } else {}\n})(window, function require_array($, _, Mustache) {\n  \"use strict\";\n\n  $.widget(\"dcp.dcpArray\", {\n    options: {\n      tools: true,\n      nbLines: 0,\n      renderOptions: {\n        rowCountThreshold: -1,\n        rowAddDisable: false,\n        rowDelDisable: false,\n        rowMoveDisable: false,\n        rowMinLimit: -1,\n        rowMinDefault: 0,\n        rowMaxLimit: -1,\n        collapse: false,\n        arrayBreakPoints: {\n          transpositionRule: \"@media (max-width: 768px)\",\n          upRule: \"@media (max-width: 1200px)\"\n        }\n      },\n      displayLabel: true,\n      customTemplate: false,\n      labels: {\n        closeErrorMessage: \"Close message\",\n        limitMaxMessage: \"Row count limit to {{limit}}\",\n        limitMinMessage: \"Min row limit is {{limit}}\"\n      }\n    },\n\n    /**\n     * get Selected line element (jquery, length = 0 if no selected)\n     * @returns {*}\n     */\n    getSelectedLineElement: function dcpArraygetSelectedLineElement() {\n      return this.element.find(\".dcpArray__content__line--selected.active\");\n    },\n    /**\n     * get Selected line index (0 : first, null : no selected line)\n     * @returns {*}\n     */\n    getSelectedLineIndex: function dcpArray_getSelectedLineIndex() {\n      var index = this.getSelectedLineElement().data(\"line\");\n      if (_.isUndefined(index) || _.isNull(index)) {\n        return null;\n      }\n      return index;\n    },\n    /**\n     *\n     * @private\n     */\n    _create: function dcpArray_create() {\n      this.options.tools =\n        this.options.mode === \"write\" && this.options.visibility !== \"U\";\n      if (\n        this.options.renderOptions.rowAddDisable === true &&\n        this.options.renderOptions.rowDelDisable === true &&\n        this.options.renderOptions.rowMoveDisable === true\n      ) {\n        this.options.tools = false;\n      }\n      if (this.options.renderOptions.attributeLabel) {\n        this.options.label = this.options.renderOptions.attributeLabel;\n      }\n\n      this.initializing = true;\n      this._initDom().then(\n        _.bind(function onDomOK() {\n          this._trigger(\"widgetReady\");\n        }, this)\n      );\n      if (!this._isEventBinded()) {\n        this._initActionClickEvent();\n        this._bindEvents();\n        this._isEventBinded(true);\n      }\n      this.element.find(\".dcpArray--collapsable\").on(\n        \"click\" + this.eventNamespace,\n        _.bind(function toogleTable() {\n          this.toggleCollapse.apply(this);\n        }, this)\n      );\n\n      if (this.options.renderOptions.collapse === \"collapse\") {\n        this.toggleCollapse(null, true);\n      }\n\n      this.initializing = false;\n    },\n\n    _isInitialized: function dcpArray_isInitialized(value) {\n      var $tbody = this.element.find(\".dcpArray__body\");\n      if (value !== undefined) {\n        $tbody.data(\"bodyGenerated\", value);\n      }\n      return $tbody.data(\"bodyGenerated\");\n    },\n    _isEventBinded: function dcpArray_isEventBinded(value) {\n      var $tbody = this.element.find(\".dcpArray__body\");\n      if (value !== undefined) {\n        $tbody.data(\"eventsBinded\", value);\n      }\n      return $tbody.data(\"eventsBinded\");\n    },\n\n    _initDom: function dcpArray_initDom() {\n      return new Promise(\n        _.bind(function dcpArray_initDom_initDom(resolve, reject) {\n          var scope = this,\n            $table;\n          if (\n            this.options.mode === \"read\" &&\n            this.options.nbLines === 0 &&\n            this.options.showEmpty !== true\n          ) {\n            if (this.options.showEmpty) {\n              this.element.addClass(\"card card-default\");\n              // showEmptyCOntent option\n              if (this.options.displayLabel !== false) {\n                this.element.append(\n                  Mustache.render(\n                    this._getTemplate(\"label\") || \"\",\n                    this.options\n                  )\n                );\n                if (this.options.renderOptions.labelPosition === \"left\") {\n                  this.element\n                    .find(\".dcpLabel\")\n                    .addClass(\"dcpArray__label--left\");\n                }\n              }\n\n              this.element.append(this.options.showEmpty);\n            }\n          } else {\n            this.element.addClass(\"card card-default\");\n            if (this.options.displayLabel !== false) {\n              this.element.append(\n                Mustache.render(\n                  this._getTemplate(\"label\") || \"\",\n                  _.extend(this.options, {\n                    collapsable: this.options.renderOptions.collapse !== \"none\",\n                    displayCount:\n                      this.options.renderOptions.rowCountThreshold >= 0 &&\n                      this.options.nbLines >=\n                        this.options.renderOptions.rowCountThreshold\n                  })\n                )\n              );\n            }\n\n            if (this.options.customTemplate) {\n              // The template is already composed on view\n              this.element.append(this.options.customTemplate);\n              this.element\n                .find(\".dcpCustomTemplate table.dcpArray__table > tbody > tr\")\n                .addClass(\"dcpArray__content__line\");\n              this._indexLine();\n              this.element\n                .find(\".dcpArray__content__line\")\n                .attr(\"data-attrid\", this.options.id);\n              this.element\n                .find(\".dcpCustomTemplate\")\n                .addClass(\"dcpArray__content dcpArray__content--open\");\n            } else {\n              _.each(this.options.content, function wArrayCopyRenderContent(\n                anOption\n              ) {\n                // Need duplicate because Mustache is confused when 2 attributes has same name\n                anOption.contentRenderOptions = anOption.renderOptions;\n              });\n              this.element.append(\n                Mustache.render(\n                  this._getTemplate(\"content\") || \"\",\n                  this.options\n                )\n              );\n\n              if (this.options.mode === \"write\") {\n                this.element\n                  .find(\".dcpArray__content\")\n                  .addClass(\"dcpArray--tooltips\");\n                this.element.tooltip({\n                  selector:\n                    \".dcpArray--tooltips .dcpArray__content__toolCell span, .dcpArray--tooltips .dcpArray__tools .dcpArray__button\",\n                  placement: function(tooltipDom, targetDom) {\n                    // Auto hide after 3s\n                    _.delay(function() {\n                      $(targetDom).tooltip(\"hide\");\n                    }, 3000);\n                    if ($(targetDom).closest(\".dcpArray__tools\").length > 0) {\n                      return \"bottom\";\n                    }\n                    return \"top\";\n                  },\n                  container: \".dcpDocument\",\n\n                  delay: {\n                    hide: 0,\n                    show: 500\n                  }\n                });\n              }\n            }\n            if (this.options.displayLabel !== false) {\n              var labelPosition = this.options.renderOptions.labelPosition;\n              if (labelPosition === \"auto\" || labelPosition === \"left\") {\n                this.element\n                  .find(\".dcpArray__label\")\n                  .addClass(\"dcpAttribute__left\");\n                this.element\n                  .find(\".dcpArray__content\")\n                  .addClass(\"dcpAttribute__right\");\n                this.element.addClass(\"dcpArray--left\");\n              }\n\n              this.element\n                .find(\".dcpAttribute__right\")\n                .addClass(\"dcpAttribute__labelPosition--\" + labelPosition);\n              this.element\n                .find(\".dcpAttribute__left\")\n                .addClass(\"dcpAttribute__labelPosition--\" + labelPosition);\n              this.element.addClass(\n                \"dcpAttribute__labelPosition--\" + labelPosition\n              );\n            }\n\n            if (this.options.renderOptions.rowAddDisable === true) {\n              this.element\n                .find(\".dcpArray__button--add, .dcpArray__button--copy\")\n                .hide();\n            }\n\n            // Set system css classes\n            $table = this.element.find(\".dcpArray__table\");\n            $table.addClass(\n              \"table table-condensed table-hover table-bordered responsive\"\n            );\n            $table\n              .find(\"> tbody\")\n              .addClass(\"dcpArray__body\")\n              .attr(\"data-attrid\", this.options.id);\n            $table\n              .find(\"> thead\")\n              .attr(\"data-attrid\", this.options.id)\n              .find(\"tr\")\n              .addClass(\"dcpArray__head\")\n              .attr(\"data-attrid\", this.options.id);\n\n            if (\n              this.options.mode === \"write\" &&\n              this.options.renderOptions.rowMoveDisable !== true\n            ) {\n              //Initiate drag drop events\n              this.element.find(\"tbody\").kendoDraggable({\n                axis: \"y\",\n                container: scope.element.find(\"tbody\"),\n                filter: \".dcpArray__content__toolCell__dragDrop\",\n                hint: function dcpArrayhint(element) {\n                  var dragLine = element.closest(\"tr\");\n                  var lineWidth = dragLine.width();\n                  var classTable = element.closest(\"table\").attr(\"class\");\n\n                  scope._hideTooltips();\n                  scope._disableTooltips();\n\n                  return $(\"<table/>\")\n                    .addClass(\"dcpArray__dragLine \" + classTable)\n                    .css(\"width\", lineWidth)\n                    .css(\n                      \"margin-left\",\n                      \"-\" +\n                        (element.offset().left - dragLine.offset().left) +\n                        \"px\"\n                    )\n                    .append(dragLine.clone());\n                },\n                dragstart: function dcpArraydragstart(event) {\n                  if (event.currentTarget) {\n                    var dragLine = $(event.currentTarget).closest(\"tr\");\n                    dragLine.css(\"opacity\", \"0\");\n                    dragLine.data(\"fromLine\", dragLine.data(\"line\"));\n                  }\n                },\n                dragend: function dcpArraydragend(event) {\n                  if (event.currentTarget) {\n                    var dragLine = $(event.currentTarget).closest(\"tr\");\n                    dragLine.css(\"opacity\", \"\");\n                    scope._trigger(\n                      \"lineMoved\",\n                      {},\n                      {\n                        fromLine: dragLine.data(\"fromLine\"),\n                        toLine: dragLine.data(\"line\")\n                      }\n                    );\n                  }\n\n                  scope._enableTooltips();\n                }\n              });\n\n              this.element.find(\"tbody\").kendoDropTargetArea({\n                filter:\n                  '.dcpArray__content__line[data-attrid=\"' +\n                  this.options.id +\n                  '\"]',\n                dragenter: function dragenter(event) {\n                  if (event.currentTarget) {\n                    var drap = event.draggable.currentTarget.closest(\"tr\");\n                    var drop = event.dropTarget;\n                    var drapLine = drap.data(\"line\");\n                    var dropLine = drop.data(\"line\");\n                    if (drapLine > dropLine) {\n                      drap.insertBefore(drop);\n                    } else {\n                      drap.insertAfter(drop);\n                    }\n                    scope._indexLine();\n                  }\n                }\n              });\n            }\n            this.element.on(\n              \"click\" + this.eventNamespace,\n              \".button-close-error\",\n              function destroyTable(/*event*/) {\n                scope.element\n                  .find(\".dcpArray__content table.table\")\n                  .tooltip(\"destroy\");\n              }\n            );\n          }\n          _.delay(_.bind(this._initCSSResponsive, this), 10);\n\n          if (!this._isInitialized()) {\n            this.addAllLines(this.options.nbLines)\n              .then(resolve)\n              .catch(reject);\n            this._isInitialized(true);\n          }\n        }, this)\n      );\n    },\n    /**\n     * Init event for #action/ links\n     *\n     * @protected\n     */\n    _initActionClickEvent: function wAttributeInitActionClickEvent() {\n      var scopeWidget = this;\n\n      this.element.on(\n        \"click.\" + this.eventNamespace,\n        'a[href^=\"#action/\"], a[data-action], button[data-action]',\n        function wAttributeActionClick(event) {\n          var $this = $(this),\n            action,\n            options,\n            eventOptions;\n\n          event.preventDefault();\n          if (event.stopPropagation) {\n            event.stopPropagation();\n          }\n\n          action = $this.data(\"action\") || $this.attr(\"href\");\n          options = action.substring(8).split(\":\");\n          eventOptions = {\n            target: event.target,\n            index: -1,\n            eventId: options.shift(),\n            options: options\n          };\n\n          scopeWidget._trigger(\"externalLinkSelected\", event, eventOptions);\n          return this;\n        }\n      );\n    },\n    _initCSSResponsive: function _initCSSResponsive() {\n      // I9 not support transposition table\n      var useTransposition = $(\"html.k-ie9\").length === 0;\n\n      this.element.append(\n        Mustache.render(\n          this._getTemplate(\"responsive\") || \"\",\n          _.extend(this.options, { useTransposition: useTransposition })\n        )\n      );\n\n      if (useTransposition) {\n        this.element.find(\"table.dcpArray__table\").addClass(\"responsive\");\n        var cssString,\n          cssTemplate,\n          headers = _.map(\n            this.element.find(\"table.responsive > thead th\"),\n            function addResponsiveKey(currentElement, index) {\n              var $currentElement = $(currentElement);\n              var $label = $currentElement.find(\".dcpArray__head__label\");\n\n              if ($label.length === 0) {\n                $label = $currentElement;\n              }\n              $label.attr(\"data-responsiveKey\", \"rk\" + index);\n              return {\n                key: $label.attr(\"data-responsiveKey\"),\n                attrid: $label.data(\"attrid\"),\n                label: $label.text().trim()\n              };\n            }\n          );\n\n        // Generate CSS string\n        cssString =\n          \"<style>\" +\n          this.options.renderOptions.arrayBreakPoints.transpositionRule +\n          \" { \";\n\n        cssTemplate = _.template(\n          \".dcpArray__content[data-attrid=\" +\n            this.options.id +\n            '] .dcpAttribute__content[data-responsiveKey=<%= key %>]:before { content: \"<%= label %>\"; }'\n        );\n\n        _.each(headers, function initCssHeader(currentHeader) {\n          currentHeader.label = currentHeader.label\n            .replace(/([\\\\\"])/g, \"\\\\$1\")\n            .replace(/\\n/g, \" \");\n          cssString += cssTemplate(currentHeader);\n        });\n        cssString += \" }</style>\";\n\n        this.element.append(cssString);\n      }\n    },\n\n    _hideTooltips: function wArray__hideTooltips() {\n      var $element = this.element;\n      $element.find(\"[aria-describedby^=tooltip]\").tooltip(\"hide\");\n      _.delay(function _hideTooltipsOneAgain() {\n        // Need redo cause animation delay of 500ms\n        $element.find(\"[aria-describedby^=tooltip]\").tooltip(\"hide\");\n      }, 500);\n    },\n    _disableTooltips: function wArray__disableTooltips() {\n      this.element.find(\".dcpArray__content\").removeClass(\"dcpArray--tooltips\");\n    },\n    _enableTooltips: function wArray__enableTooltips() {\n      this.element.find(\".dcpArray__content\").addClass(\"dcpArray--tooltips\");\n    },\n\n    _bindEvents: function dcpArray_bindEvents() {\n      var currentWidget = this;\n      this.element.on(\n        \"click\" + this.eventNamespace,\n        \".dcpArray__content__toolCell__check input\",\n        function selectLineEvent() {\n          var $this = $(this);\n          var isAlreadyChecked = $this\n            .closest(\".dcpArray__content__line\")\n            .hasClass(\"dcpArray__content__line--selected\");\n          currentWidget._hideTooltips();\n          currentWidget._unSelectLines();\n          if (isAlreadyChecked) {\n            currentWidget.element\n              .find(\".dcpArray__copy\")\n              .prop(\"disabled\", true);\n            $(this)\n              .prop(\"checked\", false)\n              .removeAttr(\"checked\");\n          } else {\n            $this.find(\".fa-check\").show();\n            $this\n              .closest(\".dcpArray__content__line\")\n              .addClass(\"dcpArray__content__line--selected active\");\n            currentWidget.element\n              .find(\".dcpArray__copy\")\n              .prop(\"disabled\", false);\n            $(this)\n              .prop(\"checked\", true)\n              .attr(\"checked\", \"checked\");\n          }\n        }\n      );\n      this.element.on(\n        \"click\" + this.eventNamespace,\n        \".dcpArray__add\",\n        function addLineEvent() {\n          var selectedLine = currentWidget.getSelectedLineIndex();\n          currentWidget._hideTooltips();\n          if (\n            currentWidget.options.renderOptions.rowMaxLimit < 0 ||\n            currentWidget.options.nbLines <\n              currentWidget.options.renderOptions.rowMaxLimit\n          ) {\n            if (selectedLine === null || _.isUndefined(selectedLine)) {\n              currentWidget.options.nbLines += 1;\n              currentWidget.addLine(currentWidget.options.nbLines - 1, {\n                needAddValue: true,\n                useSelectedLine: true\n              });\n            } else {\n              currentWidget.options.nbLines += 1;\n              currentWidget.addLine(selectedLine, {\n                needAddValue: true,\n                useSelectedLine: true\n              });\n            }\n          }\n        }\n      );\n      this.element.on(\n        \"click\" + this.eventNamespace,\n        \".dcpArray__copy\",\n        function copyLineEvent() {\n          var selectedLine = currentWidget.getSelectedLineIndex();\n\n          currentWidget._hideTooltips();\n          if (\n            currentWidget.options.renderOptions.rowMaxLimit < 0 ||\n            currentWidget.options.nbLines <\n              currentWidget.options.renderOptions.rowMaxLimit\n          ) {\n            currentWidget.options.nbLines += 1;\n            currentWidget.copyLine(selectedLine, {\n              needAddValue: true,\n              useSelectedLine: true\n            });\n          }\n        }\n      );\n      this.element.on(\n        \"click\" + this.eventNamespace,\n        \".dcpArray__content__toolCell__delete button\",\n        function deleteLineEvent() {\n          currentWidget._hideTooltips();\n          currentWidget.removeLine(\n            $(this)\n              .closest(\".dcpArray__content__line\")\n              .data(\"line\")\n          );\n          currentWidget.element.find(\".dcpArray__copy\").prop(\"disabled\", true);\n        }\n      );\n    },\n\n    toggleCollapse: function toggleCollapse(event, hideNow) {\n      this._hideTooltips();\n      var $contentElement = this.element.find(\".dcpArray__content\");\n      this.element\n        .find(\".dcp__array__caret\")\n        .toggleClass(\"fa-caret-right fa-caret-down\");\n      $contentElement.toggleClass(\n        \"dcpArray__content--open dcpArray__content--close\"\n      );\n      if (hideNow) {\n        $contentElement.hide();\n      } else {\n        $contentElement.slideToggle(200);\n      }\n    },\n\n    /**\n     * Redraw label with current count\n     */\n    redrawLabel: function wArrayRedrawLabel() {\n      this.element.find(\".dcpArray__label\").html(\n        $(\n          Mustache.render(\n            this._getTemplate(\"label\") || \"\",\n            _.extend(this.options, {\n              displayCount:\n                this.options.renderOptions.rowCountThreshold >= 0 &&\n                this.options.nbLines >=\n                  this.options.renderOptions.rowCountThreshold\n            })\n          )\n        ).html()\n      );\n    },\n    setLines: function wArraySetLines(lineNumber, options) {\n      return new Promise(\n        _.bind(function wArraySetLines_promise(resolve, reject) {\n          var linesPromise = [];\n          if (!this.initializing) {\n            // No auto add lines when array is initializing itself\n            var currentLineNumber = this.options.nbLines;\n            var i;\n            if (lineNumber > currentLineNumber) {\n              for (i = 0; i < lineNumber - currentLineNumber; i += 1) {\n                linesPromise.push(this.addLine(currentLineNumber + i, options));\n              }\n              Promise.all(linesPromise)\n                .then(resolve)\n                .catch(reject);\n            } else if (lineNumber < currentLineNumber) {\n              for (i = 0; i < currentLineNumber - lineNumber; i += 1) {\n                this.removeLine(this.options.nbLines - 1, options);\n              }\n              resolve();\n            } else {\n              resolve();\n            }\n          } else {\n            resolve();\n          }\n        }, this)\n      );\n    },\n\n    addAllLines: function dcpArrayaddAllLines(lineNumber) {\n      var i,\n        min,\n        allPromiseLines = [];\n      var $tbody = this.element.find(\".dcpArray__body\");\n      $tbody.empty();\n\n      for (i = 0; i < lineNumber; i += 1) {\n        this.addLine(i);\n      }\n\n      min = Math.max(\n        this.options.renderOptions.rowMinLimit,\n        this.options.renderOptions.rowMinDefault\n      );\n      if (min > 0) {\n        if (this.options.nbLines < min) {\n          for (i = this.options.nbLines; i < min; i += 1) {\n            allPromiseLines.push(this.addLine(i, { needAddValue: true }));\n          }\n        }\n      }\n\n      return Promise.all(allPromiseLines).then(\n        _.bind(function allLineAdded() {\n          this._trigger(\"linesGenerated\");\n        }, this)\n      );\n    },\n\n    _getLineContent: function dcpArray_getLineContent(index) {\n      var $content = \"NULL LINE\";\n\n      this.options.lineCid = _.uniqueId(this.options.id);\n      if (this.options.customTemplate) {\n        $content = this.options.customLineCallback.apply(this, [index]);\n        $content.addClass(\"dcpArray__content__line\");\n        $content.attr(\"data-attrid\", this.options.id);\n      } else {\n        $content = $(\n          Mustache.render(\n            this._getTemplate(\"line\") || \"\",\n            _.extend({ lineNumber: index }, this.options)\n          )\n        );\n      }\n      $content\n        .find(\".dcpArray__content__toolCell\")\n        .closest(\"td\")\n        .addClass(\"dcpArray__toolCell\");\n\n      if (this.options.renderOptions.rowDelDisable === true) {\n        $content.find(\".dcpArray__content__toolCell__delete\").hide();\n      }\n      if (this.options.renderOptions.rowMoveDisable === true) {\n        $content.find(\".dcpArray__content__toolCell__dragDrop\").hide();\n      }\n      _.each($content.find(\">td\"), function dcpArray_addCssClass(\n        currentCell,\n        index\n      ) {\n        $(currentCell)\n          .find(\".dcpArray__content__cell\")\n          .attr(\"data-responsiveKey\", \"rk\" + index)\n          .closest(\"td\")\n          .addClass(\"dcpArray__cell\");\n      });\n      return $content;\n    },\n\n    _addNewLine: function dcpArray_addNewLine(lineNumber, options) {\n      if (!_.isNumber(lineNumber)) {\n        throw new Error(\"You need to indicate the line number\");\n      }\n\n      var $content = this._getLineContent(lineNumber);\n      var selectedLine = [];\n\n      if (options && options.useSelectedLine) {\n        selectedLine = this.getSelectedLineElement();\n      }\n\n      if (selectedLine.length === 1) {\n        $content.insertBefore(selectedLine);\n      } else {\n        this.element.find(\".dcpArray__body\").append($content);\n      }\n      this._indexLine();\n      this.redrawLabel();\n      this._activateRowLimits();\n\n      return $content;\n    },\n\n    /**\n     * Disable/Enable Add/copy button\n     */\n    _activateRowLimits: function wArray_activateRowLimits() {\n      var currentWidget = this;\n      if (this.options.renderOptions.rowMaxLimit >= 0) {\n        if (this.options.nbLines >= this.options.renderOptions.rowMaxLimit) {\n          this.element\n            .find(\".dcpArray__add, .dcpArray__copy\")\n            .prop(\"disabled\", true);\n          this.element\n            .find(\".dcpArray__button--add, .dcpArray__button--copy\")\n            .each(function dcpArray_initLine() {\n              var $this = $(this);\n              if (!$this.data(\"originalTitle\")) {\n                $this.data(\"originalTitle\", $this.attr(\"title\"));\n              }\n              // reset tooltip\n              $this.tooltip(\"hide\").data(\"bs.tooltip\", null);\n\n              $this.attr(\n                \"title\",\n                Mustache.render(\n                  currentWidget.options.labels.limitMaxMessage || \"\",\n                  { limit: currentWidget.options.renderOptions.rowMaxLimit }\n                )\n              );\n            });\n        } else {\n          this.element\n            .find(\".dcpArray__add, .dcpArray__copy\")\n            .prop(\"disabled\", false);\n          this.element\n            .find(\".dcpArray__button--add, .dcpArray__button--copy\")\n            .each(function dcpArray_initLine() {\n              // reset tooltip\n              $(this)\n                .tooltip(\"hide\")\n                .data(\"bs.tooltip\", null);\n              $(this).attr(\"title\", $(this).data(\"originalTitle\"));\n            });\n        }\n      }\n\n      if (this.options.renderOptions.rowMinLimit >= 0) {\n        if (this.options.nbLines <= this.options.renderOptions.rowMinLimit) {\n          this.element\n            .find(\".dcpArray__content__toolCell__delete button\")\n            .prop(\"disabled\", true);\n          this.element\n            .find(\".dcpArray__content__toolCell__delete\")\n            .each(function dcpArray_initLine() {\n              if (!$(this).data(\"originalTitle\")) {\n                $(this).data(\"originalTitle\", $(this).attr(\"title\"));\n              }\n              // reset tooltip\n              $(this)\n                .tooltip(\"hide\")\n                .data(\"bs.tooltip\", null);\n\n              $(this).attr(\n                \"title\",\n                Mustache.render(\n                  currentWidget.options.labels.limitMinMessage || \"\",\n                  { limit: currentWidget.options.renderOptions.rowMinLimit }\n                )\n              );\n            });\n        } else {\n          this.element\n            .find(\".dcpArray__content__toolCell__delete button\")\n            .prop(\"disabled\", false);\n          this.element\n            .find(\".dcpArray__content__toolCell__delete\")\n            .each(function dcpArray_initLine() {\n              // reset tooltip\n              $(this)\n                .tooltip(\"hide\")\n                .data(\"bs.tooltip\", null);\n              $(this).attr(\"title\", $(this).data(\"originalTitle\"));\n            });\n        }\n      }\n    },\n\n    addLine: function dcpArrayaddLine(lineNumber, options) {\n      return new Promise(\n        _.bind(function dcpArrayaddLine_promise(resolve, reject) {\n          var $content = this._addNewLine(lineNumber, options);\n          if ($content) {\n            options = _.defaults(options || {}, {\n              silent: false,\n              needAddValue: false\n            });\n            if (options.silent !== true) {\n              this._trigger(\n                \"lineAdded\",\n                {},\n                {\n                  line: lineNumber,\n                  element: $content,\n                  needAddValue: options.needAddValue,\n                  resolve: resolve,\n                  reject: reject\n                }\n              );\n            }\n          }\n        }, this)\n      );\n    },\n\n    copyLine: function dcpArraycopyLine(lineNumber, options) {\n      return new Promise(\n        _.bind(function dcpArrayaddLine() {\n          var $content = this._addNewLine(lineNumber, options);\n          if ($content) {\n            this._trigger(\n              \"lineAdded\",\n              {},\n              { line: lineNumber, element: $content, copyValue: true }\n            );\n          }\n        }, this)\n      );\n    },\n\n    removeLine: function dcpArrayremoveLine(line, options) {\n      options = options || {};\n      this.element.find(\"[data-line=\" + line + \"]\").remove();\n      this._indexLine();\n      if (options.silent !== true) {\n        this._trigger(\"lineRemoved\", {}, { line: line });\n      }\n      this.redrawLabel();\n      this._activateRowLimits();\n    },\n\n    _destroy: function dcpArray_destroy() {\n      var tbody = this.element.find(\"tbody\");\n      if (tbody && tbody.data(\"kendoDropTargetArea\")) {\n        tbody.data(\"kendoDropTargetArea\").destroy();\n      }\n      if (tbody && tbody.data(\"kendoDraggable\")) {\n        tbody.data(\"kendoDraggable\").destroy();\n      }\n      this.element.empty();\n      this._super();\n    },\n\n    _indexLine: function dcpArray_indexLine() {\n      var i = 0;\n      this.element\n        .find(\".dcpArray__content__line\")\n        .each(function numeroteLine() {\n          $(this)\n            .attr(\"data-line\", i)\n            .data(\"line\", i);\n          i += 1;\n        });\n      this.options.nbLines = i;\n    },\n\n    _unSelectLines: function dcpArray_unSelectLines() {\n      this.element.find(\".dcpArray__content__toolCell__check .fa-check\").hide();\n      this.element\n        .find(\".dcpArray__content__line--selected\")\n        .removeClass(\"dcpArray__content__line--selected active\");\n    },\n    /**\n     * Display tooltip an error message\n     *\n     * @param message string or array of [{message:, index:}, ...]\n     */\n    setError: function dcpArray_SetError(message) {\n      var scope = this;\n      var $target = this.element.find(\".dcpArray__content table.table\");\n      if (message) {\n        $target\n          .tooltip({\n            placement: \"top\",\n            trigger: \"manual\",\n            animation: false,\n            html: true,\n            title: function dcpArray_computeTitleError() {\n              var rawMessage = $(\"<div/>\")\n                .text(message)\n                .html();\n              return (\n                \"<div>\" +\n                '<span title=\"' +\n                scope.options.labels.closeErrorMessage +\n                '\" class=\"btn fa fa-times button-close-error\"> &nbsp;</span>' +\n                rawMessage +\n                \"</div>\"\n              );\n            }\n          })\n          .one(\"shown.bs.tooltip\", function wErrorTooltip() {\n            var tipElement = $(this).data(\"bs.tooltip\").tip;\n            if (tipElement) {\n              $(tipElement).addClass(\"has-error\");\n            }\n          })\n          .tooltip(\"show\")\n          .addClass(\"dcpArray--error\");\n      } else {\n        $target.tooltip(\"hide\").removeClass(\"dcpArray--error\");\n      }\n    },\n    /**\n     * Get the template of the current attribute\n     *\n     * The template can be in the options or in a global var of dcp namespace (initiated by require for widget)\n     *\n     * @param key\n     * @returns string\n     * @private\n     */\n    _getTemplate: function dcpArray_getTemplate(key) {\n      if (this.options.templates && this.options.templates[key]) {\n        return this.options.templates[key];\n      }\n      if (\n        window.dcp &&\n        window.dcp.templates &&\n        window.dcp.templates[this.getType()] &&\n        window.dcp.templates[this.getType()][key]\n      ) {\n        return window.dcp.templates[this.getType()][key];\n      }\n      if (\n        window.dcp &&\n        window.dcp.templates &&\n        window.dcp.templates[\"default\"] &&\n        window.dcp.templates[\"default\"][key]\n      ) {\n        return window.dcp.templates[\"default\"][key];\n      }\n      throw new Error(\"Unknown template  \" + key + \"/\" + this.options.type);\n    },\n\n    getType: function dcpArray_getType() {\n      return \"array\";\n    }\n  });\n\n  return $.fn.dcpArray;\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiM2U1ODhmY2ZiMmI4OTFlMzVlMzkuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvQXBwcy9ET0NVTUVOVC9JSE0vd2lkZ2V0cy9hdHRyaWJ1dGVzL2FycmF5L3dBcnJheS5qcz8xYWE0Il0sInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiB1bWRSZXF1aXJlKHJvb3QsIGZhY3RvcnkpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgaWYgKHR5cGVvZiBkZWZpbmUgPT09IFwiZnVuY3Rpb25cIiAmJiBkZWZpbmUuYW1kKSB7XG4gICAgZGVmaW5lKFtcbiAgICAgIFwianF1ZXJ5XCIsXG4gICAgICBcInVuZGVyc2NvcmVcIixcbiAgICAgIFwibXVzdGFjaGVcIixcbiAgICAgIFwiZGNwRG9jdW1lbnQvd2lkZ2V0cy93aWRnZXRcIlxuICAgIF0sIGZhY3RvcnkpO1xuICB9IGVsc2Uge1xuICAgIC8vbm9pbnNwZWN0aW9uIEpTVW5yZXNvbHZlZFZhcmlhYmxlXG4gICAgZmFjdG9yeSh3aW5kb3cualF1ZXJ5LCB3aW5kb3cuXywgd2luZG93Lk11c3RhY2hlKTtcbiAgfVxufSkod2luZG93LCBmdW5jdGlvbiByZXF1aXJlX2FycmF5KCQsIF8sIE11c3RhY2hlKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gICQud2lkZ2V0KFwiZGNwLmRjcEFycmF5XCIsIHtcbiAgICBvcHRpb25zOiB7XG4gICAgICB0b29sczogdHJ1ZSxcbiAgICAgIG5iTGluZXM6IDAsXG4gICAgICByZW5kZXJPcHRpb25zOiB7XG4gICAgICAgIHJvd0NvdW50VGhyZXNob2xkOiAtMSxcbiAgICAgICAgcm93QWRkRGlzYWJsZTogZmFsc2UsXG4gICAgICAgIHJvd0RlbERpc2FibGU6IGZhbHNlLFxuICAgICAgICByb3dNb3ZlRGlzYWJsZTogZmFsc2UsXG4gICAgICAgIHJvd01pbkxpbWl0OiAtMSxcbiAgICAgICAgcm93TWluRGVmYXVsdDogMCxcbiAgICAgICAgcm93TWF4TGltaXQ6IC0xLFxuICAgICAgICBjb2xsYXBzZTogZmFsc2UsXG4gICAgICAgIGFycmF5QnJlYWtQb2ludHM6IHtcbiAgICAgICAgICB0cmFuc3Bvc2l0aW9uUnVsZTogXCJAbWVkaWEgKG1heC13aWR0aDogNzY4cHgpXCIsXG4gICAgICAgICAgdXBSdWxlOiBcIkBtZWRpYSAobWF4LXdpZHRoOiAxMjAwcHgpXCJcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGRpc3BsYXlMYWJlbDogdHJ1ZSxcbiAgICAgIGN1c3RvbVRlbXBsYXRlOiBmYWxzZSxcbiAgICAgIGxhYmVsczoge1xuICAgICAgICBjbG9zZUVycm9yTWVzc2FnZTogXCJDbG9zZSBtZXNzYWdlXCIsXG4gICAgICAgIGxpbWl0TWF4TWVzc2FnZTogXCJSb3cgY291bnQgbGltaXQgdG8ge3tsaW1pdH19XCIsXG4gICAgICAgIGxpbWl0TWluTWVzc2FnZTogXCJNaW4gcm93IGxpbWl0IGlzIHt7bGltaXR9fVwiXG4gICAgICB9XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIGdldCBTZWxlY3RlZCBsaW5lIGVsZW1lbnQgKGpxdWVyeSwgbGVuZ3RoID0gMCBpZiBubyBzZWxlY3RlZClcbiAgICAgKiBAcmV0dXJucyB7Kn1cbiAgICAgKi9cbiAgICBnZXRTZWxlY3RlZExpbmVFbGVtZW50OiBmdW5jdGlvbiBkY3BBcnJheWdldFNlbGVjdGVkTGluZUVsZW1lbnQoKSB7XG4gICAgICByZXR1cm4gdGhpcy5lbGVtZW50LmZpbmQoXCIuZGNwQXJyYXlfX2NvbnRlbnRfX2xpbmUtLXNlbGVjdGVkLmFjdGl2ZVwiKTtcbiAgICB9LFxuICAgIC8qKlxuICAgICAqIGdldCBTZWxlY3RlZCBsaW5lIGluZGV4ICgwIDogZmlyc3QsIG51bGwgOiBubyBzZWxlY3RlZCBsaW5lKVxuICAgICAqIEByZXR1cm5zIHsqfVxuICAgICAqL1xuICAgIGdldFNlbGVjdGVkTGluZUluZGV4OiBmdW5jdGlvbiBkY3BBcnJheV9nZXRTZWxlY3RlZExpbmVJbmRleCgpIHtcbiAgICAgIHZhciBpbmRleCA9IHRoaXMuZ2V0U2VsZWN0ZWRMaW5lRWxlbWVudCgpLmRhdGEoXCJsaW5lXCIpO1xuICAgICAgaWYgKF8uaXNVbmRlZmluZWQoaW5kZXgpIHx8IF8uaXNOdWxsKGluZGV4KSkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cbiAgICAgIHJldHVybiBpbmRleDtcbiAgICB9LFxuICAgIC8qKlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfY3JlYXRlOiBmdW5jdGlvbiBkY3BBcnJheV9jcmVhdGUoKSB7XG4gICAgICB0aGlzLm9wdGlvbnMudG9vbHMgPVxuICAgICAgICB0aGlzLm9wdGlvbnMubW9kZSA9PT0gXCJ3cml0ZVwiICYmIHRoaXMub3B0aW9ucy52aXNpYmlsaXR5ICE9PSBcIlVcIjtcbiAgICAgIGlmIChcbiAgICAgICAgdGhpcy5vcHRpb25zLnJlbmRlck9wdGlvbnMucm93QWRkRGlzYWJsZSA9PT0gdHJ1ZSAmJlxuICAgICAgICB0aGlzLm9wdGlvbnMucmVuZGVyT3B0aW9ucy5yb3dEZWxEaXNhYmxlID09PSB0cnVlICYmXG4gICAgICAgIHRoaXMub3B0aW9ucy5yZW5kZXJPcHRpb25zLnJvd01vdmVEaXNhYmxlID09PSB0cnVlXG4gICAgICApIHtcbiAgICAgICAgdGhpcy5vcHRpb25zLnRvb2xzID0gZmFsc2U7XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5vcHRpb25zLnJlbmRlck9wdGlvbnMuYXR0cmlidXRlTGFiZWwpIHtcbiAgICAgICAgdGhpcy5vcHRpb25zLmxhYmVsID0gdGhpcy5vcHRpb25zLnJlbmRlck9wdGlvbnMuYXR0cmlidXRlTGFiZWw7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuaW5pdGlhbGl6aW5nID0gdHJ1ZTtcbiAgICAgIHRoaXMuX2luaXREb20oKS50aGVuKFxuICAgICAgICBfLmJpbmQoZnVuY3Rpb24gb25Eb21PSygpIHtcbiAgICAgICAgICB0aGlzLl90cmlnZ2VyKFwid2lkZ2V0UmVhZHlcIik7XG4gICAgICAgIH0sIHRoaXMpXG4gICAgICApO1xuICAgICAgaWYgKCF0aGlzLl9pc0V2ZW50QmluZGVkKCkpIHtcbiAgICAgICAgdGhpcy5faW5pdEFjdGlvbkNsaWNrRXZlbnQoKTtcbiAgICAgICAgdGhpcy5fYmluZEV2ZW50cygpO1xuICAgICAgICB0aGlzLl9pc0V2ZW50QmluZGVkKHRydWUpO1xuICAgICAgfVxuICAgICAgdGhpcy5lbGVtZW50LmZpbmQoXCIuZGNwQXJyYXktLWNvbGxhcHNhYmxlXCIpLm9uKFxuICAgICAgICBcImNsaWNrXCIgKyB0aGlzLmV2ZW50TmFtZXNwYWNlLFxuICAgICAgICBfLmJpbmQoZnVuY3Rpb24gdG9vZ2xlVGFibGUoKSB7XG4gICAgICAgICAgdGhpcy50b2dnbGVDb2xsYXBzZS5hcHBseSh0aGlzKTtcbiAgICAgICAgfSwgdGhpcylcbiAgICAgICk7XG5cbiAgICAgIGlmICh0aGlzLm9wdGlvbnMucmVuZGVyT3B0aW9ucy5jb2xsYXBzZSA9PT0gXCJjb2xsYXBzZVwiKSB7XG4gICAgICAgIHRoaXMudG9nZ2xlQ29sbGFwc2UobnVsbCwgdHJ1ZSk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuaW5pdGlhbGl6aW5nID0gZmFsc2U7XG4gICAgfSxcblxuICAgIF9pc0luaXRpYWxpemVkOiBmdW5jdGlvbiBkY3BBcnJheV9pc0luaXRpYWxpemVkKHZhbHVlKSB7XG4gICAgICB2YXIgJHRib2R5ID0gdGhpcy5lbGVtZW50LmZpbmQoXCIuZGNwQXJyYXlfX2JvZHlcIik7XG4gICAgICBpZiAodmFsdWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAkdGJvZHkuZGF0YShcImJvZHlHZW5lcmF0ZWRcIiwgdmFsdWUpO1xuICAgICAgfVxuICAgICAgcmV0dXJuICR0Ym9keS5kYXRhKFwiYm9keUdlbmVyYXRlZFwiKTtcbiAgICB9LFxuICAgIF9pc0V2ZW50QmluZGVkOiBmdW5jdGlvbiBkY3BBcnJheV9pc0V2ZW50QmluZGVkKHZhbHVlKSB7XG4gICAgICB2YXIgJHRib2R5ID0gdGhpcy5lbGVtZW50LmZpbmQoXCIuZGNwQXJyYXlfX2JvZHlcIik7XG4gICAgICBpZiAodmFsdWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAkdGJvZHkuZGF0YShcImV2ZW50c0JpbmRlZFwiLCB2YWx1ZSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gJHRib2R5LmRhdGEoXCJldmVudHNCaW5kZWRcIik7XG4gICAgfSxcblxuICAgIF9pbml0RG9tOiBmdW5jdGlvbiBkY3BBcnJheV9pbml0RG9tKCkge1xuICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKFxuICAgICAgICBfLmJpbmQoZnVuY3Rpb24gZGNwQXJyYXlfaW5pdERvbV9pbml0RG9tKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICAgIHZhciBzY29wZSA9IHRoaXMsXG4gICAgICAgICAgICAkdGFibGU7XG4gICAgICAgICAgaWYgKFxuICAgICAgICAgICAgdGhpcy5vcHRpb25zLm1vZGUgPT09IFwicmVhZFwiICYmXG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMubmJMaW5lcyA9PT0gMCAmJlxuICAgICAgICAgICAgdGhpcy5vcHRpb25zLnNob3dFbXB0eSAhPT0gdHJ1ZVxuICAgICAgICAgICkge1xuICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5zaG93RW1wdHkpIHtcbiAgICAgICAgICAgICAgdGhpcy5lbGVtZW50LmFkZENsYXNzKFwiY2FyZCBjYXJkLWRlZmF1bHRcIik7XG4gICAgICAgICAgICAgIC8vIHNob3dFbXB0eUNPbnRlbnQgb3B0aW9uXG4gICAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMuZGlzcGxheUxhYmVsICE9PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudC5hcHBlbmQoXG4gICAgICAgICAgICAgICAgICBNdXN0YWNoZS5yZW5kZXIoXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2dldFRlbXBsYXRlKFwibGFiZWxcIikgfHwgXCJcIixcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vcHRpb25zXG4gICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLnJlbmRlck9wdGlvbnMubGFiZWxQb3NpdGlvbiA9PT0gXCJsZWZ0XCIpIHtcbiAgICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudFxuICAgICAgICAgICAgICAgICAgICAuZmluZChcIi5kY3BMYWJlbFwiKVxuICAgICAgICAgICAgICAgICAgICAuYWRkQ2xhc3MoXCJkY3BBcnJheV9fbGFiZWwtLWxlZnRcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgdGhpcy5lbGVtZW50LmFwcGVuZCh0aGlzLm9wdGlvbnMuc2hvd0VtcHR5KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5lbGVtZW50LmFkZENsYXNzKFwiY2FyZCBjYXJkLWRlZmF1bHRcIik7XG4gICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLmRpc3BsYXlMYWJlbCAhPT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgdGhpcy5lbGVtZW50LmFwcGVuZChcbiAgICAgICAgICAgICAgICBNdXN0YWNoZS5yZW5kZXIoXG4gICAgICAgICAgICAgICAgICB0aGlzLl9nZXRUZW1wbGF0ZShcImxhYmVsXCIpIHx8IFwiXCIsXG4gICAgICAgICAgICAgICAgICBfLmV4dGVuZCh0aGlzLm9wdGlvbnMsIHtcbiAgICAgICAgICAgICAgICAgICAgY29sbGFwc2FibGU6IHRoaXMub3B0aW9ucy5yZW5kZXJPcHRpb25zLmNvbGxhcHNlICE9PSBcIm5vbmVcIixcbiAgICAgICAgICAgICAgICAgICAgZGlzcGxheUNvdW50OlxuICAgICAgICAgICAgICAgICAgICAgIHRoaXMub3B0aW9ucy5yZW5kZXJPcHRpb25zLnJvd0NvdW50VGhyZXNob2xkID49IDAgJiZcbiAgICAgICAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMubmJMaW5lcyA+PVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vcHRpb25zLnJlbmRlck9wdGlvbnMucm93Q291bnRUaHJlc2hvbGRcbiAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLmN1c3RvbVRlbXBsYXRlKSB7XG4gICAgICAgICAgICAgIC8vIFRoZSB0ZW1wbGF0ZSBpcyBhbHJlYWR5IGNvbXBvc2VkIG9uIHZpZXdcbiAgICAgICAgICAgICAgdGhpcy5lbGVtZW50LmFwcGVuZCh0aGlzLm9wdGlvbnMuY3VzdG9tVGVtcGxhdGUpO1xuICAgICAgICAgICAgICB0aGlzLmVsZW1lbnRcbiAgICAgICAgICAgICAgICAuZmluZChcIi5kY3BDdXN0b21UZW1wbGF0ZSB0YWJsZS5kY3BBcnJheV9fdGFibGUgPiB0Ym9keSA+IHRyXCIpXG4gICAgICAgICAgICAgICAgLmFkZENsYXNzKFwiZGNwQXJyYXlfX2NvbnRlbnRfX2xpbmVcIik7XG4gICAgICAgICAgICAgIHRoaXMuX2luZGV4TGluZSgpO1xuICAgICAgICAgICAgICB0aGlzLmVsZW1lbnRcbiAgICAgICAgICAgICAgICAuZmluZChcIi5kY3BBcnJheV9fY29udGVudF9fbGluZVwiKVxuICAgICAgICAgICAgICAgIC5hdHRyKFwiZGF0YS1hdHRyaWRcIiwgdGhpcy5vcHRpb25zLmlkKTtcbiAgICAgICAgICAgICAgdGhpcy5lbGVtZW50XG4gICAgICAgICAgICAgICAgLmZpbmQoXCIuZGNwQ3VzdG9tVGVtcGxhdGVcIilcbiAgICAgICAgICAgICAgICAuYWRkQ2xhc3MoXCJkY3BBcnJheV9fY29udGVudCBkY3BBcnJheV9fY29udGVudC0tb3BlblwiKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIF8uZWFjaCh0aGlzLm9wdGlvbnMuY29udGVudCwgZnVuY3Rpb24gd0FycmF5Q29weVJlbmRlckNvbnRlbnQoXG4gICAgICAgICAgICAgICAgYW5PcHRpb25cbiAgICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgLy8gTmVlZCBkdXBsaWNhdGUgYmVjYXVzZSBNdXN0YWNoZSBpcyBjb25mdXNlZCB3aGVuIDIgYXR0cmlidXRlcyBoYXMgc2FtZSBuYW1lXG4gICAgICAgICAgICAgICAgYW5PcHRpb24uY29udGVudFJlbmRlck9wdGlvbnMgPSBhbk9wdGlvbi5yZW5kZXJPcHRpb25zO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgdGhpcy5lbGVtZW50LmFwcGVuZChcbiAgICAgICAgICAgICAgICBNdXN0YWNoZS5yZW5kZXIoXG4gICAgICAgICAgICAgICAgICB0aGlzLl9nZXRUZW1wbGF0ZShcImNvbnRlbnRcIikgfHwgXCJcIixcbiAgICAgICAgICAgICAgICAgIHRoaXMub3B0aW9uc1xuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLm1vZGUgPT09IFwid3JpdGVcIikge1xuICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudFxuICAgICAgICAgICAgICAgICAgLmZpbmQoXCIuZGNwQXJyYXlfX2NvbnRlbnRcIilcbiAgICAgICAgICAgICAgICAgIC5hZGRDbGFzcyhcImRjcEFycmF5LS10b29sdGlwc1wiKTtcbiAgICAgICAgICAgICAgICB0aGlzLmVsZW1lbnQudG9vbHRpcCh7XG4gICAgICAgICAgICAgICAgICBzZWxlY3RvcjpcbiAgICAgICAgICAgICAgICAgICAgXCIuZGNwQXJyYXktLXRvb2x0aXBzIC5kY3BBcnJheV9fY29udGVudF9fdG9vbENlbGwgc3BhbiwgLmRjcEFycmF5LS10b29sdGlwcyAuZGNwQXJyYXlfX3Rvb2xzIC5kY3BBcnJheV9fYnV0dG9uXCIsXG4gICAgICAgICAgICAgICAgICBwbGFjZW1lbnQ6IGZ1bmN0aW9uKHRvb2x0aXBEb20sIHRhcmdldERvbSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBBdXRvIGhpZGUgYWZ0ZXIgM3NcbiAgICAgICAgICAgICAgICAgICAgXy5kZWxheShmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAkKHRhcmdldERvbSkudG9vbHRpcChcImhpZGVcIik7XG4gICAgICAgICAgICAgICAgICAgIH0sIDMwMDApO1xuICAgICAgICAgICAgICAgICAgICBpZiAoJCh0YXJnZXREb20pLmNsb3Nlc3QoXCIuZGNwQXJyYXlfX3Rvb2xzXCIpLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJib3R0b21cIjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gXCJ0b3BcIjtcbiAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICBjb250YWluZXI6IFwiLmRjcERvY3VtZW50XCIsXG5cbiAgICAgICAgICAgICAgICAgIGRlbGF5OiB7XG4gICAgICAgICAgICAgICAgICAgIGhpZGU6IDAsXG4gICAgICAgICAgICAgICAgICAgIHNob3c6IDUwMFxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLmRpc3BsYXlMYWJlbCAhPT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgdmFyIGxhYmVsUG9zaXRpb24gPSB0aGlzLm9wdGlvbnMucmVuZGVyT3B0aW9ucy5sYWJlbFBvc2l0aW9uO1xuICAgICAgICAgICAgICBpZiAobGFiZWxQb3NpdGlvbiA9PT0gXCJhdXRvXCIgfHwgbGFiZWxQb3NpdGlvbiA9PT0gXCJsZWZ0XCIpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmVsZW1lbnRcbiAgICAgICAgICAgICAgICAgIC5maW5kKFwiLmRjcEFycmF5X19sYWJlbFwiKVxuICAgICAgICAgICAgICAgICAgLmFkZENsYXNzKFwiZGNwQXR0cmlidXRlX19sZWZ0XCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudFxuICAgICAgICAgICAgICAgICAgLmZpbmQoXCIuZGNwQXJyYXlfX2NvbnRlbnRcIilcbiAgICAgICAgICAgICAgICAgIC5hZGRDbGFzcyhcImRjcEF0dHJpYnV0ZV9fcmlnaHRcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5lbGVtZW50LmFkZENsYXNzKFwiZGNwQXJyYXktLWxlZnRcIik7XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICB0aGlzLmVsZW1lbnRcbiAgICAgICAgICAgICAgICAuZmluZChcIi5kY3BBdHRyaWJ1dGVfX3JpZ2h0XCIpXG4gICAgICAgICAgICAgICAgLmFkZENsYXNzKFwiZGNwQXR0cmlidXRlX19sYWJlbFBvc2l0aW9uLS1cIiArIGxhYmVsUG9zaXRpb24pO1xuICAgICAgICAgICAgICB0aGlzLmVsZW1lbnRcbiAgICAgICAgICAgICAgICAuZmluZChcIi5kY3BBdHRyaWJ1dGVfX2xlZnRcIilcbiAgICAgICAgICAgICAgICAuYWRkQ2xhc3MoXCJkY3BBdHRyaWJ1dGVfX2xhYmVsUG9zaXRpb24tLVwiICsgbGFiZWxQb3NpdGlvbik7XG4gICAgICAgICAgICAgIHRoaXMuZWxlbWVudC5hZGRDbGFzcyhcbiAgICAgICAgICAgICAgICBcImRjcEF0dHJpYnV0ZV9fbGFiZWxQb3NpdGlvbi0tXCIgKyBsYWJlbFBvc2l0aW9uXG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMucmVuZGVyT3B0aW9ucy5yb3dBZGREaXNhYmxlID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgIHRoaXMuZWxlbWVudFxuICAgICAgICAgICAgICAgIC5maW5kKFwiLmRjcEFycmF5X19idXR0b24tLWFkZCwgLmRjcEFycmF5X19idXR0b24tLWNvcHlcIilcbiAgICAgICAgICAgICAgICAuaGlkZSgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBTZXQgc3lzdGVtIGNzcyBjbGFzc2VzXG4gICAgICAgICAgICAkdGFibGUgPSB0aGlzLmVsZW1lbnQuZmluZChcIi5kY3BBcnJheV9fdGFibGVcIik7XG4gICAgICAgICAgICAkdGFibGUuYWRkQ2xhc3MoXG4gICAgICAgICAgICAgIFwidGFibGUgdGFibGUtY29uZGVuc2VkIHRhYmxlLWhvdmVyIHRhYmxlLWJvcmRlcmVkIHJlc3BvbnNpdmVcIlxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICR0YWJsZVxuICAgICAgICAgICAgICAuZmluZChcIj4gdGJvZHlcIilcbiAgICAgICAgICAgICAgLmFkZENsYXNzKFwiZGNwQXJyYXlfX2JvZHlcIilcbiAgICAgICAgICAgICAgLmF0dHIoXCJkYXRhLWF0dHJpZFwiLCB0aGlzLm9wdGlvbnMuaWQpO1xuICAgICAgICAgICAgJHRhYmxlXG4gICAgICAgICAgICAgIC5maW5kKFwiPiB0aGVhZFwiKVxuICAgICAgICAgICAgICAuYXR0cihcImRhdGEtYXR0cmlkXCIsIHRoaXMub3B0aW9ucy5pZClcbiAgICAgICAgICAgICAgLmZpbmQoXCJ0clwiKVxuICAgICAgICAgICAgICAuYWRkQ2xhc3MoXCJkY3BBcnJheV9faGVhZFwiKVxuICAgICAgICAgICAgICAuYXR0cihcImRhdGEtYXR0cmlkXCIsIHRoaXMub3B0aW9ucy5pZCk7XG5cbiAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgdGhpcy5vcHRpb25zLm1vZGUgPT09IFwid3JpdGVcIiAmJlxuICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMucmVuZGVyT3B0aW9ucy5yb3dNb3ZlRGlzYWJsZSAhPT0gdHJ1ZVxuICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgIC8vSW5pdGlhdGUgZHJhZyBkcm9wIGV2ZW50c1xuICAgICAgICAgICAgICB0aGlzLmVsZW1lbnQuZmluZChcInRib2R5XCIpLmtlbmRvRHJhZ2dhYmxlKHtcbiAgICAgICAgICAgICAgICBheGlzOiBcInlcIixcbiAgICAgICAgICAgICAgICBjb250YWluZXI6IHNjb3BlLmVsZW1lbnQuZmluZChcInRib2R5XCIpLFxuICAgICAgICAgICAgICAgIGZpbHRlcjogXCIuZGNwQXJyYXlfX2NvbnRlbnRfX3Rvb2xDZWxsX19kcmFnRHJvcFwiLFxuICAgICAgICAgICAgICAgIGhpbnQ6IGZ1bmN0aW9uIGRjcEFycmF5aGludChlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICB2YXIgZHJhZ0xpbmUgPSBlbGVtZW50LmNsb3Nlc3QoXCJ0clwiKTtcbiAgICAgICAgICAgICAgICAgIHZhciBsaW5lV2lkdGggPSBkcmFnTGluZS53aWR0aCgpO1xuICAgICAgICAgICAgICAgICAgdmFyIGNsYXNzVGFibGUgPSBlbGVtZW50LmNsb3Nlc3QoXCJ0YWJsZVwiKS5hdHRyKFwiY2xhc3NcIik7XG5cbiAgICAgICAgICAgICAgICAgIHNjb3BlLl9oaWRlVG9vbHRpcHMoKTtcbiAgICAgICAgICAgICAgICAgIHNjb3BlLl9kaXNhYmxlVG9vbHRpcHMoKTtcblxuICAgICAgICAgICAgICAgICAgcmV0dXJuICQoXCI8dGFibGUvPlwiKVxuICAgICAgICAgICAgICAgICAgICAuYWRkQ2xhc3MoXCJkY3BBcnJheV9fZHJhZ0xpbmUgXCIgKyBjbGFzc1RhYmxlKVxuICAgICAgICAgICAgICAgICAgICAuY3NzKFwid2lkdGhcIiwgbGluZVdpZHRoKVxuICAgICAgICAgICAgICAgICAgICAuY3NzKFxuICAgICAgICAgICAgICAgICAgICAgIFwibWFyZ2luLWxlZnRcIixcbiAgICAgICAgICAgICAgICAgICAgICBcIi1cIiArXG4gICAgICAgICAgICAgICAgICAgICAgICAoZWxlbWVudC5vZmZzZXQoKS5sZWZ0IC0gZHJhZ0xpbmUub2Zmc2V0KCkubGVmdCkgK1xuICAgICAgICAgICAgICAgICAgICAgICAgXCJweFwiXG4gICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICAgLmFwcGVuZChkcmFnTGluZS5jbG9uZSgpKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGRyYWdzdGFydDogZnVuY3Rpb24gZGNwQXJyYXlkcmFnc3RhcnQoZXZlbnQpIHtcbiAgICAgICAgICAgICAgICAgIGlmIChldmVudC5jdXJyZW50VGFyZ2V0KSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBkcmFnTGluZSA9ICQoZXZlbnQuY3VycmVudFRhcmdldCkuY2xvc2VzdChcInRyXCIpO1xuICAgICAgICAgICAgICAgICAgICBkcmFnTGluZS5jc3MoXCJvcGFjaXR5XCIsIFwiMFwiKTtcbiAgICAgICAgICAgICAgICAgICAgZHJhZ0xpbmUuZGF0YShcImZyb21MaW5lXCIsIGRyYWdMaW5lLmRhdGEoXCJsaW5lXCIpKTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGRyYWdlbmQ6IGZ1bmN0aW9uIGRjcEFycmF5ZHJhZ2VuZChldmVudCkge1xuICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50LmN1cnJlbnRUYXJnZXQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRyYWdMaW5lID0gJChldmVudC5jdXJyZW50VGFyZ2V0KS5jbG9zZXN0KFwidHJcIik7XG4gICAgICAgICAgICAgICAgICAgIGRyYWdMaW5lLmNzcyhcIm9wYWNpdHlcIiwgXCJcIik7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLl90cmlnZ2VyKFxuICAgICAgICAgICAgICAgICAgICAgIFwibGluZU1vdmVkXCIsXG4gICAgICAgICAgICAgICAgICAgICAge30sXG4gICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgZnJvbUxpbmU6IGRyYWdMaW5lLmRhdGEoXCJmcm9tTGluZVwiKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvTGluZTogZHJhZ0xpbmUuZGF0YShcImxpbmVcIilcbiAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgIHNjb3BlLl9lbmFibGVUb29sdGlwcygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgdGhpcy5lbGVtZW50LmZpbmQoXCJ0Ym9keVwiKS5rZW5kb0Ryb3BUYXJnZXRBcmVhKHtcbiAgICAgICAgICAgICAgICBmaWx0ZXI6XG4gICAgICAgICAgICAgICAgICAnLmRjcEFycmF5X19jb250ZW50X19saW5lW2RhdGEtYXR0cmlkPVwiJyArXG4gICAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMuaWQgK1xuICAgICAgICAgICAgICAgICAgJ1wiXScsXG4gICAgICAgICAgICAgICAgZHJhZ2VudGVyOiBmdW5jdGlvbiBkcmFnZW50ZXIoZXZlbnQpIHtcbiAgICAgICAgICAgICAgICAgIGlmIChldmVudC5jdXJyZW50VGFyZ2V0KSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBkcmFwID0gZXZlbnQuZHJhZ2dhYmxlLmN1cnJlbnRUYXJnZXQuY2xvc2VzdChcInRyXCIpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgZHJvcCA9IGV2ZW50LmRyb3BUYXJnZXQ7XG4gICAgICAgICAgICAgICAgICAgIHZhciBkcmFwTGluZSA9IGRyYXAuZGF0YShcImxpbmVcIik7XG4gICAgICAgICAgICAgICAgICAgIHZhciBkcm9wTGluZSA9IGRyb3AuZGF0YShcImxpbmVcIik7XG4gICAgICAgICAgICAgICAgICAgIGlmIChkcmFwTGluZSA+IGRyb3BMaW5lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgZHJhcC5pbnNlcnRCZWZvcmUoZHJvcCk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgZHJhcC5pbnNlcnRBZnRlcihkcm9wKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBzY29wZS5faW5kZXhMaW5lKCk7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5vbihcbiAgICAgICAgICAgICAgXCJjbGlja1wiICsgdGhpcy5ldmVudE5hbWVzcGFjZSxcbiAgICAgICAgICAgICAgXCIuYnV0dG9uLWNsb3NlLWVycm9yXCIsXG4gICAgICAgICAgICAgIGZ1bmN0aW9uIGRlc3Ryb3lUYWJsZSgvKmV2ZW50Ki8pIHtcbiAgICAgICAgICAgICAgICBzY29wZS5lbGVtZW50XG4gICAgICAgICAgICAgICAgICAuZmluZChcIi5kY3BBcnJheV9fY29udGVudCB0YWJsZS50YWJsZVwiKVxuICAgICAgICAgICAgICAgICAgLnRvb2x0aXAoXCJkZXN0cm95XCIpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgICBfLmRlbGF5KF8uYmluZCh0aGlzLl9pbml0Q1NTUmVzcG9uc2l2ZSwgdGhpcyksIDEwKTtcblxuICAgICAgICAgIGlmICghdGhpcy5faXNJbml0aWFsaXplZCgpKSB7XG4gICAgICAgICAgICB0aGlzLmFkZEFsbExpbmVzKHRoaXMub3B0aW9ucy5uYkxpbmVzKVxuICAgICAgICAgICAgICAudGhlbihyZXNvbHZlKVxuICAgICAgICAgICAgICAuY2F0Y2gocmVqZWN0KTtcbiAgICAgICAgICAgIHRoaXMuX2lzSW5pdGlhbGl6ZWQodHJ1ZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9LCB0aGlzKVxuICAgICAgKTtcbiAgICB9LFxuICAgIC8qKlxuICAgICAqIEluaXQgZXZlbnQgZm9yICNhY3Rpb24vIGxpbmtzXG4gICAgICpcbiAgICAgKiBAcHJvdGVjdGVkXG4gICAgICovXG4gICAgX2luaXRBY3Rpb25DbGlja0V2ZW50OiBmdW5jdGlvbiB3QXR0cmlidXRlSW5pdEFjdGlvbkNsaWNrRXZlbnQoKSB7XG4gICAgICB2YXIgc2NvcGVXaWRnZXQgPSB0aGlzO1xuXG4gICAgICB0aGlzLmVsZW1lbnQub24oXG4gICAgICAgIFwiY2xpY2suXCIgKyB0aGlzLmV2ZW50TmFtZXNwYWNlLFxuICAgICAgICAnYVtocmVmXj1cIiNhY3Rpb24vXCJdLCBhW2RhdGEtYWN0aW9uXSwgYnV0dG9uW2RhdGEtYWN0aW9uXScsXG4gICAgICAgIGZ1bmN0aW9uIHdBdHRyaWJ1dGVBY3Rpb25DbGljayhldmVudCkge1xuICAgICAgICAgIHZhciAkdGhpcyA9ICQodGhpcyksXG4gICAgICAgICAgICBhY3Rpb24sXG4gICAgICAgICAgICBvcHRpb25zLFxuICAgICAgICAgICAgZXZlbnRPcHRpb25zO1xuXG4gICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICBpZiAoZXZlbnQuc3RvcFByb3BhZ2F0aW9uKSB7XG4gICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBhY3Rpb24gPSAkdGhpcy5kYXRhKFwiYWN0aW9uXCIpIHx8ICR0aGlzLmF0dHIoXCJocmVmXCIpO1xuICAgICAgICAgIG9wdGlvbnMgPSBhY3Rpb24uc3Vic3RyaW5nKDgpLnNwbGl0KFwiOlwiKTtcbiAgICAgICAgICBldmVudE9wdGlvbnMgPSB7XG4gICAgICAgICAgICB0YXJnZXQ6IGV2ZW50LnRhcmdldCxcbiAgICAgICAgICAgIGluZGV4OiAtMSxcbiAgICAgICAgICAgIGV2ZW50SWQ6IG9wdGlvbnMuc2hpZnQoKSxcbiAgICAgICAgICAgIG9wdGlvbnM6IG9wdGlvbnNcbiAgICAgICAgICB9O1xuXG4gICAgICAgICAgc2NvcGVXaWRnZXQuX3RyaWdnZXIoXCJleHRlcm5hbExpbmtTZWxlY3RlZFwiLCBldmVudCwgZXZlbnRPcHRpb25zKTtcbiAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfVxuICAgICAgKTtcbiAgICB9LFxuICAgIF9pbml0Q1NTUmVzcG9uc2l2ZTogZnVuY3Rpb24gX2luaXRDU1NSZXNwb25zaXZlKCkge1xuICAgICAgLy8gSTkgbm90IHN1cHBvcnQgdHJhbnNwb3NpdGlvbiB0YWJsZVxuICAgICAgdmFyIHVzZVRyYW5zcG9zaXRpb24gPSAkKFwiaHRtbC5rLWllOVwiKS5sZW5ndGggPT09IDA7XG5cbiAgICAgIHRoaXMuZWxlbWVudC5hcHBlbmQoXG4gICAgICAgIE11c3RhY2hlLnJlbmRlcihcbiAgICAgICAgICB0aGlzLl9nZXRUZW1wbGF0ZShcInJlc3BvbnNpdmVcIikgfHwgXCJcIixcbiAgICAgICAgICBfLmV4dGVuZCh0aGlzLm9wdGlvbnMsIHsgdXNlVHJhbnNwb3NpdGlvbjogdXNlVHJhbnNwb3NpdGlvbiB9KVxuICAgICAgICApXG4gICAgICApO1xuXG4gICAgICBpZiAodXNlVHJhbnNwb3NpdGlvbikge1xuICAgICAgICB0aGlzLmVsZW1lbnQuZmluZChcInRhYmxlLmRjcEFycmF5X190YWJsZVwiKS5hZGRDbGFzcyhcInJlc3BvbnNpdmVcIik7XG4gICAgICAgIHZhciBjc3NTdHJpbmcsXG4gICAgICAgICAgY3NzVGVtcGxhdGUsXG4gICAgICAgICAgaGVhZGVycyA9IF8ubWFwKFxuICAgICAgICAgICAgdGhpcy5lbGVtZW50LmZpbmQoXCJ0YWJsZS5yZXNwb25zaXZlID4gdGhlYWQgdGhcIiksXG4gICAgICAgICAgICBmdW5jdGlvbiBhZGRSZXNwb25zaXZlS2V5KGN1cnJlbnRFbGVtZW50LCBpbmRleCkge1xuICAgICAgICAgICAgICB2YXIgJGN1cnJlbnRFbGVtZW50ID0gJChjdXJyZW50RWxlbWVudCk7XG4gICAgICAgICAgICAgIHZhciAkbGFiZWwgPSAkY3VycmVudEVsZW1lbnQuZmluZChcIi5kY3BBcnJheV9faGVhZF9fbGFiZWxcIik7XG5cbiAgICAgICAgICAgICAgaWYgKCRsYWJlbC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAkbGFiZWwgPSAkY3VycmVudEVsZW1lbnQ7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgJGxhYmVsLmF0dHIoXCJkYXRhLXJlc3BvbnNpdmVLZXlcIiwgXCJya1wiICsgaW5kZXgpO1xuICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGtleTogJGxhYmVsLmF0dHIoXCJkYXRhLXJlc3BvbnNpdmVLZXlcIiksXG4gICAgICAgICAgICAgICAgYXR0cmlkOiAkbGFiZWwuZGF0YShcImF0dHJpZFwiKSxcbiAgICAgICAgICAgICAgICBsYWJlbDogJGxhYmVsLnRleHQoKS50cmltKClcbiAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICApO1xuXG4gICAgICAgIC8vIEdlbmVyYXRlIENTUyBzdHJpbmdcbiAgICAgICAgY3NzU3RyaW5nID1cbiAgICAgICAgICBcIjxzdHlsZT5cIiArXG4gICAgICAgICAgdGhpcy5vcHRpb25zLnJlbmRlck9wdGlvbnMuYXJyYXlCcmVha1BvaW50cy50cmFuc3Bvc2l0aW9uUnVsZSArXG4gICAgICAgICAgXCIgeyBcIjtcblxuICAgICAgICBjc3NUZW1wbGF0ZSA9IF8udGVtcGxhdGUoXG4gICAgICAgICAgXCIuZGNwQXJyYXlfX2NvbnRlbnRbZGF0YS1hdHRyaWQ9XCIgK1xuICAgICAgICAgICAgdGhpcy5vcHRpb25zLmlkICtcbiAgICAgICAgICAgICddIC5kY3BBdHRyaWJ1dGVfX2NvbnRlbnRbZGF0YS1yZXNwb25zaXZlS2V5PTwlPSBrZXkgJT5dOmJlZm9yZSB7IGNvbnRlbnQ6IFwiPCU9IGxhYmVsICU+XCI7IH0nXG4gICAgICAgICk7XG5cbiAgICAgICAgXy5lYWNoKGhlYWRlcnMsIGZ1bmN0aW9uIGluaXRDc3NIZWFkZXIoY3VycmVudEhlYWRlcikge1xuICAgICAgICAgIGN1cnJlbnRIZWFkZXIubGFiZWwgPSBjdXJyZW50SGVhZGVyLmxhYmVsXG4gICAgICAgICAgICAucmVwbGFjZSgvKFtcXFxcXCJdKS9nLCBcIlxcXFwkMVwiKVxuICAgICAgICAgICAgLnJlcGxhY2UoL1xcbi9nLCBcIiBcIik7XG4gICAgICAgICAgY3NzU3RyaW5nICs9IGNzc1RlbXBsYXRlKGN1cnJlbnRIZWFkZXIpO1xuICAgICAgICB9KTtcbiAgICAgICAgY3NzU3RyaW5nICs9IFwiIH08L3N0eWxlPlwiO1xuXG4gICAgICAgIHRoaXMuZWxlbWVudC5hcHBlbmQoY3NzU3RyaW5nKTtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgX2hpZGVUb29sdGlwczogZnVuY3Rpb24gd0FycmF5X19oaWRlVG9vbHRpcHMoKSB7XG4gICAgICB2YXIgJGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG4gICAgICAkZWxlbWVudC5maW5kKFwiW2FyaWEtZGVzY3JpYmVkYnlePXRvb2x0aXBdXCIpLnRvb2x0aXAoXCJoaWRlXCIpO1xuICAgICAgXy5kZWxheShmdW5jdGlvbiBfaGlkZVRvb2x0aXBzT25lQWdhaW4oKSB7XG4gICAgICAgIC8vIE5lZWQgcmVkbyBjYXVzZSBhbmltYXRpb24gZGVsYXkgb2YgNTAwbXNcbiAgICAgICAgJGVsZW1lbnQuZmluZChcIlthcmlhLWRlc2NyaWJlZGJ5Xj10b29sdGlwXVwiKS50b29sdGlwKFwiaGlkZVwiKTtcbiAgICAgIH0sIDUwMCk7XG4gICAgfSxcbiAgICBfZGlzYWJsZVRvb2x0aXBzOiBmdW5jdGlvbiB3QXJyYXlfX2Rpc2FibGVUb29sdGlwcygpIHtcbiAgICAgIHRoaXMuZWxlbWVudC5maW5kKFwiLmRjcEFycmF5X19jb250ZW50XCIpLnJlbW92ZUNsYXNzKFwiZGNwQXJyYXktLXRvb2x0aXBzXCIpO1xuICAgIH0sXG4gICAgX2VuYWJsZVRvb2x0aXBzOiBmdW5jdGlvbiB3QXJyYXlfX2VuYWJsZVRvb2x0aXBzKCkge1xuICAgICAgdGhpcy5lbGVtZW50LmZpbmQoXCIuZGNwQXJyYXlfX2NvbnRlbnRcIikuYWRkQ2xhc3MoXCJkY3BBcnJheS0tdG9vbHRpcHNcIik7XG4gICAgfSxcblxuICAgIF9iaW5kRXZlbnRzOiBmdW5jdGlvbiBkY3BBcnJheV9iaW5kRXZlbnRzKCkge1xuICAgICAgdmFyIGN1cnJlbnRXaWRnZXQgPSB0aGlzO1xuICAgICAgdGhpcy5lbGVtZW50Lm9uKFxuICAgICAgICBcImNsaWNrXCIgKyB0aGlzLmV2ZW50TmFtZXNwYWNlLFxuICAgICAgICBcIi5kY3BBcnJheV9fY29udGVudF9fdG9vbENlbGxfX2NoZWNrIGlucHV0XCIsXG4gICAgICAgIGZ1bmN0aW9uIHNlbGVjdExpbmVFdmVudCgpIHtcbiAgICAgICAgICB2YXIgJHRoaXMgPSAkKHRoaXMpO1xuICAgICAgICAgIHZhciBpc0FscmVhZHlDaGVja2VkID0gJHRoaXNcbiAgICAgICAgICAgIC5jbG9zZXN0KFwiLmRjcEFycmF5X19jb250ZW50X19saW5lXCIpXG4gICAgICAgICAgICAuaGFzQ2xhc3MoXCJkY3BBcnJheV9fY29udGVudF9fbGluZS0tc2VsZWN0ZWRcIik7XG4gICAgICAgICAgY3VycmVudFdpZGdldC5faGlkZVRvb2x0aXBzKCk7XG4gICAgICAgICAgY3VycmVudFdpZGdldC5fdW5TZWxlY3RMaW5lcygpO1xuICAgICAgICAgIGlmIChpc0FscmVhZHlDaGVja2VkKSB7XG4gICAgICAgICAgICBjdXJyZW50V2lkZ2V0LmVsZW1lbnRcbiAgICAgICAgICAgICAgLmZpbmQoXCIuZGNwQXJyYXlfX2NvcHlcIilcbiAgICAgICAgICAgICAgLnByb3AoXCJkaXNhYmxlZFwiLCB0cnVlKTtcbiAgICAgICAgICAgICQodGhpcylcbiAgICAgICAgICAgICAgLnByb3AoXCJjaGVja2VkXCIsIGZhbHNlKVxuICAgICAgICAgICAgICAucmVtb3ZlQXR0cihcImNoZWNrZWRcIik7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICR0aGlzLmZpbmQoXCIuZmEtY2hlY2tcIikuc2hvdygpO1xuICAgICAgICAgICAgJHRoaXNcbiAgICAgICAgICAgICAgLmNsb3Nlc3QoXCIuZGNwQXJyYXlfX2NvbnRlbnRfX2xpbmVcIilcbiAgICAgICAgICAgICAgLmFkZENsYXNzKFwiZGNwQXJyYXlfX2NvbnRlbnRfX2xpbmUtLXNlbGVjdGVkIGFjdGl2ZVwiKTtcbiAgICAgICAgICAgIGN1cnJlbnRXaWRnZXQuZWxlbWVudFxuICAgICAgICAgICAgICAuZmluZChcIi5kY3BBcnJheV9fY29weVwiKVxuICAgICAgICAgICAgICAucHJvcChcImRpc2FibGVkXCIsIGZhbHNlKTtcbiAgICAgICAgICAgICQodGhpcylcbiAgICAgICAgICAgICAgLnByb3AoXCJjaGVja2VkXCIsIHRydWUpXG4gICAgICAgICAgICAgIC5hdHRyKFwiY2hlY2tlZFwiLCBcImNoZWNrZWRcIik7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICApO1xuICAgICAgdGhpcy5lbGVtZW50Lm9uKFxuICAgICAgICBcImNsaWNrXCIgKyB0aGlzLmV2ZW50TmFtZXNwYWNlLFxuICAgICAgICBcIi5kY3BBcnJheV9fYWRkXCIsXG4gICAgICAgIGZ1bmN0aW9uIGFkZExpbmVFdmVudCgpIHtcbiAgICAgICAgICB2YXIgc2VsZWN0ZWRMaW5lID0gY3VycmVudFdpZGdldC5nZXRTZWxlY3RlZExpbmVJbmRleCgpO1xuICAgICAgICAgIGN1cnJlbnRXaWRnZXQuX2hpZGVUb29sdGlwcygpO1xuICAgICAgICAgIGlmIChcbiAgICAgICAgICAgIGN1cnJlbnRXaWRnZXQub3B0aW9ucy5yZW5kZXJPcHRpb25zLnJvd01heExpbWl0IDwgMCB8fFxuICAgICAgICAgICAgY3VycmVudFdpZGdldC5vcHRpb25zLm5iTGluZXMgPFxuICAgICAgICAgICAgICBjdXJyZW50V2lkZ2V0Lm9wdGlvbnMucmVuZGVyT3B0aW9ucy5yb3dNYXhMaW1pdFxuICAgICAgICAgICkge1xuICAgICAgICAgICAgaWYgKHNlbGVjdGVkTGluZSA9PT0gbnVsbCB8fCBfLmlzVW5kZWZpbmVkKHNlbGVjdGVkTGluZSkpIHtcbiAgICAgICAgICAgICAgY3VycmVudFdpZGdldC5vcHRpb25zLm5iTGluZXMgKz0gMTtcbiAgICAgICAgICAgICAgY3VycmVudFdpZGdldC5hZGRMaW5lKGN1cnJlbnRXaWRnZXQub3B0aW9ucy5uYkxpbmVzIC0gMSwge1xuICAgICAgICAgICAgICAgIG5lZWRBZGRWYWx1ZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICB1c2VTZWxlY3RlZExpbmU6IHRydWVcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBjdXJyZW50V2lkZ2V0Lm9wdGlvbnMubmJMaW5lcyArPSAxO1xuICAgICAgICAgICAgICBjdXJyZW50V2lkZ2V0LmFkZExpbmUoc2VsZWN0ZWRMaW5lLCB7XG4gICAgICAgICAgICAgICAgbmVlZEFkZFZhbHVlOiB0cnVlLFxuICAgICAgICAgICAgICAgIHVzZVNlbGVjdGVkTGluZTogdHJ1ZVxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgICB0aGlzLmVsZW1lbnQub24oXG4gICAgICAgIFwiY2xpY2tcIiArIHRoaXMuZXZlbnROYW1lc3BhY2UsXG4gICAgICAgIFwiLmRjcEFycmF5X19jb3B5XCIsXG4gICAgICAgIGZ1bmN0aW9uIGNvcHlMaW5lRXZlbnQoKSB7XG4gICAgICAgICAgdmFyIHNlbGVjdGVkTGluZSA9IGN1cnJlbnRXaWRnZXQuZ2V0U2VsZWN0ZWRMaW5lSW5kZXgoKTtcblxuICAgICAgICAgIGN1cnJlbnRXaWRnZXQuX2hpZGVUb29sdGlwcygpO1xuICAgICAgICAgIGlmIChcbiAgICAgICAgICAgIGN1cnJlbnRXaWRnZXQub3B0aW9ucy5yZW5kZXJPcHRpb25zLnJvd01heExpbWl0IDwgMCB8fFxuICAgICAgICAgICAgY3VycmVudFdpZGdldC5vcHRpb25zLm5iTGluZXMgPFxuICAgICAgICAgICAgICBjdXJyZW50V2lkZ2V0Lm9wdGlvbnMucmVuZGVyT3B0aW9ucy5yb3dNYXhMaW1pdFxuICAgICAgICAgICkge1xuICAgICAgICAgICAgY3VycmVudFdpZGdldC5vcHRpb25zLm5iTGluZXMgKz0gMTtcbiAgICAgICAgICAgIGN1cnJlbnRXaWRnZXQuY29weUxpbmUoc2VsZWN0ZWRMaW5lLCB7XG4gICAgICAgICAgICAgIG5lZWRBZGRWYWx1ZTogdHJ1ZSxcbiAgICAgICAgICAgICAgdXNlU2VsZWN0ZWRMaW5lOiB0cnVlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgICB0aGlzLmVsZW1lbnQub24oXG4gICAgICAgIFwiY2xpY2tcIiArIHRoaXMuZXZlbnROYW1lc3BhY2UsXG4gICAgICAgIFwiLmRjcEFycmF5X19jb250ZW50X190b29sQ2VsbF9fZGVsZXRlIGJ1dHRvblwiLFxuICAgICAgICBmdW5jdGlvbiBkZWxldGVMaW5lRXZlbnQoKSB7XG4gICAgICAgICAgY3VycmVudFdpZGdldC5faGlkZVRvb2x0aXBzKCk7XG4gICAgICAgICAgY3VycmVudFdpZGdldC5yZW1vdmVMaW5lKFxuICAgICAgICAgICAgJCh0aGlzKVxuICAgICAgICAgICAgICAuY2xvc2VzdChcIi5kY3BBcnJheV9fY29udGVudF9fbGluZVwiKVxuICAgICAgICAgICAgICAuZGF0YShcImxpbmVcIilcbiAgICAgICAgICApO1xuICAgICAgICAgIGN1cnJlbnRXaWRnZXQuZWxlbWVudC5maW5kKFwiLmRjcEFycmF5X19jb3B5XCIpLnByb3AoXCJkaXNhYmxlZFwiLCB0cnVlKTtcbiAgICAgICAgfVxuICAgICAgKTtcbiAgICB9LFxuXG4gICAgdG9nZ2xlQ29sbGFwc2U6IGZ1bmN0aW9uIHRvZ2dsZUNvbGxhcHNlKGV2ZW50LCBoaWRlTm93KSB7XG4gICAgICB0aGlzLl9oaWRlVG9vbHRpcHMoKTtcbiAgICAgIHZhciAkY29udGVudEVsZW1lbnQgPSB0aGlzLmVsZW1lbnQuZmluZChcIi5kY3BBcnJheV9fY29udGVudFwiKTtcbiAgICAgIHRoaXMuZWxlbWVudFxuICAgICAgICAuZmluZChcIi5kY3BfX2FycmF5X19jYXJldFwiKVxuICAgICAgICAudG9nZ2xlQ2xhc3MoXCJmYS1jYXJldC1yaWdodCBmYS1jYXJldC1kb3duXCIpO1xuICAgICAgJGNvbnRlbnRFbGVtZW50LnRvZ2dsZUNsYXNzKFxuICAgICAgICBcImRjcEFycmF5X19jb250ZW50LS1vcGVuIGRjcEFycmF5X19jb250ZW50LS1jbG9zZVwiXG4gICAgICApO1xuICAgICAgaWYgKGhpZGVOb3cpIHtcbiAgICAgICAgJGNvbnRlbnRFbGVtZW50LmhpZGUoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgICRjb250ZW50RWxlbWVudC5zbGlkZVRvZ2dsZSgyMDApO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBSZWRyYXcgbGFiZWwgd2l0aCBjdXJyZW50IGNvdW50XG4gICAgICovXG4gICAgcmVkcmF3TGFiZWw6IGZ1bmN0aW9uIHdBcnJheVJlZHJhd0xhYmVsKCkge1xuICAgICAgdGhpcy5lbGVtZW50LmZpbmQoXCIuZGNwQXJyYXlfX2xhYmVsXCIpLmh0bWwoXG4gICAgICAgICQoXG4gICAgICAgICAgTXVzdGFjaGUucmVuZGVyKFxuICAgICAgICAgICAgdGhpcy5fZ2V0VGVtcGxhdGUoXCJsYWJlbFwiKSB8fCBcIlwiLFxuICAgICAgICAgICAgXy5leHRlbmQodGhpcy5vcHRpb25zLCB7XG4gICAgICAgICAgICAgIGRpc3BsYXlDb3VudDpcbiAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMucmVuZGVyT3B0aW9ucy5yb3dDb3VudFRocmVzaG9sZCA+PSAwICYmXG4gICAgICAgICAgICAgICAgdGhpcy5vcHRpb25zLm5iTGluZXMgPj1cbiAgICAgICAgICAgICAgICAgIHRoaXMub3B0aW9ucy5yZW5kZXJPcHRpb25zLnJvd0NvdW50VGhyZXNob2xkXG4gICAgICAgICAgICB9KVxuICAgICAgICAgIClcbiAgICAgICAgKS5odG1sKClcbiAgICAgICk7XG4gICAgfSxcbiAgICBzZXRMaW5lczogZnVuY3Rpb24gd0FycmF5U2V0TGluZXMobGluZU51bWJlciwgb3B0aW9ucykge1xuICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKFxuICAgICAgICBfLmJpbmQoZnVuY3Rpb24gd0FycmF5U2V0TGluZXNfcHJvbWlzZShyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgICB2YXIgbGluZXNQcm9taXNlID0gW107XG4gICAgICAgICAgaWYgKCF0aGlzLmluaXRpYWxpemluZykge1xuICAgICAgICAgICAgLy8gTm8gYXV0byBhZGQgbGluZXMgd2hlbiBhcnJheSBpcyBpbml0aWFsaXppbmcgaXRzZWxmXG4gICAgICAgICAgICB2YXIgY3VycmVudExpbmVOdW1iZXIgPSB0aGlzLm9wdGlvbnMubmJMaW5lcztcbiAgICAgICAgICAgIHZhciBpO1xuICAgICAgICAgICAgaWYgKGxpbmVOdW1iZXIgPiBjdXJyZW50TGluZU51bWJlcikge1xuICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbGluZU51bWJlciAtIGN1cnJlbnRMaW5lTnVtYmVyOyBpICs9IDEpIHtcbiAgICAgICAgICAgICAgICBsaW5lc1Byb21pc2UucHVzaCh0aGlzLmFkZExpbmUoY3VycmVudExpbmVOdW1iZXIgKyBpLCBvcHRpb25zKSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgUHJvbWlzZS5hbGwobGluZXNQcm9taXNlKVxuICAgICAgICAgICAgICAgIC50aGVuKHJlc29sdmUpXG4gICAgICAgICAgICAgICAgLmNhdGNoKHJlamVjdCk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGxpbmVOdW1iZXIgPCBjdXJyZW50TGluZU51bWJlcikge1xuICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgY3VycmVudExpbmVOdW1iZXIgLSBsaW5lTnVtYmVyOyBpICs9IDEpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZUxpbmUodGhpcy5vcHRpb25zLm5iTGluZXMgLSAxLCBvcHRpb25zKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICByZXNvbHZlKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICByZXNvbHZlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sIHRoaXMpXG4gICAgICApO1xuICAgIH0sXG5cbiAgICBhZGRBbGxMaW5lczogZnVuY3Rpb24gZGNwQXJyYXlhZGRBbGxMaW5lcyhsaW5lTnVtYmVyKSB7XG4gICAgICB2YXIgaSxcbiAgICAgICAgbWluLFxuICAgICAgICBhbGxQcm9taXNlTGluZXMgPSBbXTtcbiAgICAgIHZhciAkdGJvZHkgPSB0aGlzLmVsZW1lbnQuZmluZChcIi5kY3BBcnJheV9fYm9keVwiKTtcbiAgICAgICR0Ym9keS5lbXB0eSgpO1xuXG4gICAgICBmb3IgKGkgPSAwOyBpIDwgbGluZU51bWJlcjsgaSArPSAxKSB7XG4gICAgICAgIHRoaXMuYWRkTGluZShpKTtcbiAgICAgIH1cblxuICAgICAgbWluID0gTWF0aC5tYXgoXG4gICAgICAgIHRoaXMub3B0aW9ucy5yZW5kZXJPcHRpb25zLnJvd01pbkxpbWl0LFxuICAgICAgICB0aGlzLm9wdGlvbnMucmVuZGVyT3B0aW9ucy5yb3dNaW5EZWZhdWx0XG4gICAgICApO1xuICAgICAgaWYgKG1pbiA+IDApIHtcbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5uYkxpbmVzIDwgbWluKSB7XG4gICAgICAgICAgZm9yIChpID0gdGhpcy5vcHRpb25zLm5iTGluZXM7IGkgPCBtaW47IGkgKz0gMSkge1xuICAgICAgICAgICAgYWxsUHJvbWlzZUxpbmVzLnB1c2godGhpcy5hZGRMaW5lKGksIHsgbmVlZEFkZFZhbHVlOiB0cnVlIH0pKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIFByb21pc2UuYWxsKGFsbFByb21pc2VMaW5lcykudGhlbihcbiAgICAgICAgXy5iaW5kKGZ1bmN0aW9uIGFsbExpbmVBZGRlZCgpIHtcbiAgICAgICAgICB0aGlzLl90cmlnZ2VyKFwibGluZXNHZW5lcmF0ZWRcIik7XG4gICAgICAgIH0sIHRoaXMpXG4gICAgICApO1xuICAgIH0sXG5cbiAgICBfZ2V0TGluZUNvbnRlbnQ6IGZ1bmN0aW9uIGRjcEFycmF5X2dldExpbmVDb250ZW50KGluZGV4KSB7XG4gICAgICB2YXIgJGNvbnRlbnQgPSBcIk5VTEwgTElORVwiO1xuXG4gICAgICB0aGlzLm9wdGlvbnMubGluZUNpZCA9IF8udW5pcXVlSWQodGhpcy5vcHRpb25zLmlkKTtcbiAgICAgIGlmICh0aGlzLm9wdGlvbnMuY3VzdG9tVGVtcGxhdGUpIHtcbiAgICAgICAgJGNvbnRlbnQgPSB0aGlzLm9wdGlvbnMuY3VzdG9tTGluZUNhbGxiYWNrLmFwcGx5KHRoaXMsIFtpbmRleF0pO1xuICAgICAgICAkY29udGVudC5hZGRDbGFzcyhcImRjcEFycmF5X19jb250ZW50X19saW5lXCIpO1xuICAgICAgICAkY29udGVudC5hdHRyKFwiZGF0YS1hdHRyaWRcIiwgdGhpcy5vcHRpb25zLmlkKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgICRjb250ZW50ID0gJChcbiAgICAgICAgICBNdXN0YWNoZS5yZW5kZXIoXG4gICAgICAgICAgICB0aGlzLl9nZXRUZW1wbGF0ZShcImxpbmVcIikgfHwgXCJcIixcbiAgICAgICAgICAgIF8uZXh0ZW5kKHsgbGluZU51bWJlcjogaW5kZXggfSwgdGhpcy5vcHRpb25zKVxuICAgICAgICAgIClcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgICRjb250ZW50XG4gICAgICAgIC5maW5kKFwiLmRjcEFycmF5X19jb250ZW50X190b29sQ2VsbFwiKVxuICAgICAgICAuY2xvc2VzdChcInRkXCIpXG4gICAgICAgIC5hZGRDbGFzcyhcImRjcEFycmF5X190b29sQ2VsbFwiKTtcblxuICAgICAgaWYgKHRoaXMub3B0aW9ucy5yZW5kZXJPcHRpb25zLnJvd0RlbERpc2FibGUgPT09IHRydWUpIHtcbiAgICAgICAgJGNvbnRlbnQuZmluZChcIi5kY3BBcnJheV9fY29udGVudF9fdG9vbENlbGxfX2RlbGV0ZVwiKS5oaWRlKCk7XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5vcHRpb25zLnJlbmRlck9wdGlvbnMucm93TW92ZURpc2FibGUgPT09IHRydWUpIHtcbiAgICAgICAgJGNvbnRlbnQuZmluZChcIi5kY3BBcnJheV9fY29udGVudF9fdG9vbENlbGxfX2RyYWdEcm9wXCIpLmhpZGUoKTtcbiAgICAgIH1cbiAgICAgIF8uZWFjaCgkY29udGVudC5maW5kKFwiPnRkXCIpLCBmdW5jdGlvbiBkY3BBcnJheV9hZGRDc3NDbGFzcyhcbiAgICAgICAgY3VycmVudENlbGwsXG4gICAgICAgIGluZGV4XG4gICAgICApIHtcbiAgICAgICAgJChjdXJyZW50Q2VsbClcbiAgICAgICAgICAuZmluZChcIi5kY3BBcnJheV9fY29udGVudF9fY2VsbFwiKVxuICAgICAgICAgIC5hdHRyKFwiZGF0YS1yZXNwb25zaXZlS2V5XCIsIFwicmtcIiArIGluZGV4KVxuICAgICAgICAgIC5jbG9zZXN0KFwidGRcIilcbiAgICAgICAgICAuYWRkQ2xhc3MoXCJkY3BBcnJheV9fY2VsbFwiKTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuICRjb250ZW50O1xuICAgIH0sXG5cbiAgICBfYWRkTmV3TGluZTogZnVuY3Rpb24gZGNwQXJyYXlfYWRkTmV3TGluZShsaW5lTnVtYmVyLCBvcHRpb25zKSB7XG4gICAgICBpZiAoIV8uaXNOdW1iZXIobGluZU51bWJlcikpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiWW91IG5lZWQgdG8gaW5kaWNhdGUgdGhlIGxpbmUgbnVtYmVyXCIpO1xuICAgICAgfVxuXG4gICAgICB2YXIgJGNvbnRlbnQgPSB0aGlzLl9nZXRMaW5lQ29udGVudChsaW5lTnVtYmVyKTtcbiAgICAgIHZhciBzZWxlY3RlZExpbmUgPSBbXTtcblxuICAgICAgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy51c2VTZWxlY3RlZExpbmUpIHtcbiAgICAgICAgc2VsZWN0ZWRMaW5lID0gdGhpcy5nZXRTZWxlY3RlZExpbmVFbGVtZW50KCk7XG4gICAgICB9XG5cbiAgICAgIGlmIChzZWxlY3RlZExpbmUubGVuZ3RoID09PSAxKSB7XG4gICAgICAgICRjb250ZW50Lmluc2VydEJlZm9yZShzZWxlY3RlZExpbmUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5lbGVtZW50LmZpbmQoXCIuZGNwQXJyYXlfX2JvZHlcIikuYXBwZW5kKCRjb250ZW50KTtcbiAgICAgIH1cbiAgICAgIHRoaXMuX2luZGV4TGluZSgpO1xuICAgICAgdGhpcy5yZWRyYXdMYWJlbCgpO1xuICAgICAgdGhpcy5fYWN0aXZhdGVSb3dMaW1pdHMoKTtcblxuICAgICAgcmV0dXJuICRjb250ZW50O1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBEaXNhYmxlL0VuYWJsZSBBZGQvY29weSBidXR0b25cbiAgICAgKi9cbiAgICBfYWN0aXZhdGVSb3dMaW1pdHM6IGZ1bmN0aW9uIHdBcnJheV9hY3RpdmF0ZVJvd0xpbWl0cygpIHtcbiAgICAgIHZhciBjdXJyZW50V2lkZ2V0ID0gdGhpcztcbiAgICAgIGlmICh0aGlzLm9wdGlvbnMucmVuZGVyT3B0aW9ucy5yb3dNYXhMaW1pdCA+PSAwKSB7XG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMubmJMaW5lcyA+PSB0aGlzLm9wdGlvbnMucmVuZGVyT3B0aW9ucy5yb3dNYXhMaW1pdCkge1xuICAgICAgICAgIHRoaXMuZWxlbWVudFxuICAgICAgICAgICAgLmZpbmQoXCIuZGNwQXJyYXlfX2FkZCwgLmRjcEFycmF5X19jb3B5XCIpXG4gICAgICAgICAgICAucHJvcChcImRpc2FibGVkXCIsIHRydWUpO1xuICAgICAgICAgIHRoaXMuZWxlbWVudFxuICAgICAgICAgICAgLmZpbmQoXCIuZGNwQXJyYXlfX2J1dHRvbi0tYWRkLCAuZGNwQXJyYXlfX2J1dHRvbi0tY29weVwiKVxuICAgICAgICAgICAgLmVhY2goZnVuY3Rpb24gZGNwQXJyYXlfaW5pdExpbmUoKSB7XG4gICAgICAgICAgICAgIHZhciAkdGhpcyA9ICQodGhpcyk7XG4gICAgICAgICAgICAgIGlmICghJHRoaXMuZGF0YShcIm9yaWdpbmFsVGl0bGVcIikpIHtcbiAgICAgICAgICAgICAgICAkdGhpcy5kYXRhKFwib3JpZ2luYWxUaXRsZVwiLCAkdGhpcy5hdHRyKFwidGl0bGVcIikpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIC8vIHJlc2V0IHRvb2x0aXBcbiAgICAgICAgICAgICAgJHRoaXMudG9vbHRpcChcImhpZGVcIikuZGF0YShcImJzLnRvb2x0aXBcIiwgbnVsbCk7XG5cbiAgICAgICAgICAgICAgJHRoaXMuYXR0cihcbiAgICAgICAgICAgICAgICBcInRpdGxlXCIsXG4gICAgICAgICAgICAgICAgTXVzdGFjaGUucmVuZGVyKFxuICAgICAgICAgICAgICAgICAgY3VycmVudFdpZGdldC5vcHRpb25zLmxhYmVscy5saW1pdE1heE1lc3NhZ2UgfHwgXCJcIixcbiAgICAgICAgICAgICAgICAgIHsgbGltaXQ6IGN1cnJlbnRXaWRnZXQub3B0aW9ucy5yZW5kZXJPcHRpb25zLnJvd01heExpbWl0IH1cbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLmVsZW1lbnRcbiAgICAgICAgICAgIC5maW5kKFwiLmRjcEFycmF5X19hZGQsIC5kY3BBcnJheV9fY29weVwiKVxuICAgICAgICAgICAgLnByb3AoXCJkaXNhYmxlZFwiLCBmYWxzZSk7XG4gICAgICAgICAgdGhpcy5lbGVtZW50XG4gICAgICAgICAgICAuZmluZChcIi5kY3BBcnJheV9fYnV0dG9uLS1hZGQsIC5kY3BBcnJheV9fYnV0dG9uLS1jb3B5XCIpXG4gICAgICAgICAgICAuZWFjaChmdW5jdGlvbiBkY3BBcnJheV9pbml0TGluZSgpIHtcbiAgICAgICAgICAgICAgLy8gcmVzZXQgdG9vbHRpcFxuICAgICAgICAgICAgICAkKHRoaXMpXG4gICAgICAgICAgICAgICAgLnRvb2x0aXAoXCJoaWRlXCIpXG4gICAgICAgICAgICAgICAgLmRhdGEoXCJicy50b29sdGlwXCIsIG51bGwpO1xuICAgICAgICAgICAgICAkKHRoaXMpLmF0dHIoXCJ0aXRsZVwiLCAkKHRoaXMpLmRhdGEoXCJvcmlnaW5hbFRpdGxlXCIpKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLm9wdGlvbnMucmVuZGVyT3B0aW9ucy5yb3dNaW5MaW1pdCA+PSAwKSB7XG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMubmJMaW5lcyA8PSB0aGlzLm9wdGlvbnMucmVuZGVyT3B0aW9ucy5yb3dNaW5MaW1pdCkge1xuICAgICAgICAgIHRoaXMuZWxlbWVudFxuICAgICAgICAgICAgLmZpbmQoXCIuZGNwQXJyYXlfX2NvbnRlbnRfX3Rvb2xDZWxsX19kZWxldGUgYnV0dG9uXCIpXG4gICAgICAgICAgICAucHJvcChcImRpc2FibGVkXCIsIHRydWUpO1xuICAgICAgICAgIHRoaXMuZWxlbWVudFxuICAgICAgICAgICAgLmZpbmQoXCIuZGNwQXJyYXlfX2NvbnRlbnRfX3Rvb2xDZWxsX19kZWxldGVcIilcbiAgICAgICAgICAgIC5lYWNoKGZ1bmN0aW9uIGRjcEFycmF5X2luaXRMaW5lKCkge1xuICAgICAgICAgICAgICBpZiAoISQodGhpcykuZGF0YShcIm9yaWdpbmFsVGl0bGVcIikpIHtcbiAgICAgICAgICAgICAgICAkKHRoaXMpLmRhdGEoXCJvcmlnaW5hbFRpdGxlXCIsICQodGhpcykuYXR0cihcInRpdGxlXCIpKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAvLyByZXNldCB0b29sdGlwXG4gICAgICAgICAgICAgICQodGhpcylcbiAgICAgICAgICAgICAgICAudG9vbHRpcChcImhpZGVcIilcbiAgICAgICAgICAgICAgICAuZGF0YShcImJzLnRvb2x0aXBcIiwgbnVsbCk7XG5cbiAgICAgICAgICAgICAgJCh0aGlzKS5hdHRyKFxuICAgICAgICAgICAgICAgIFwidGl0bGVcIixcbiAgICAgICAgICAgICAgICBNdXN0YWNoZS5yZW5kZXIoXG4gICAgICAgICAgICAgICAgICBjdXJyZW50V2lkZ2V0Lm9wdGlvbnMubGFiZWxzLmxpbWl0TWluTWVzc2FnZSB8fCBcIlwiLFxuICAgICAgICAgICAgICAgICAgeyBsaW1pdDogY3VycmVudFdpZGdldC5vcHRpb25zLnJlbmRlck9wdGlvbnMucm93TWluTGltaXQgfVxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMuZWxlbWVudFxuICAgICAgICAgICAgLmZpbmQoXCIuZGNwQXJyYXlfX2NvbnRlbnRfX3Rvb2xDZWxsX19kZWxldGUgYnV0dG9uXCIpXG4gICAgICAgICAgICAucHJvcChcImRpc2FibGVkXCIsIGZhbHNlKTtcbiAgICAgICAgICB0aGlzLmVsZW1lbnRcbiAgICAgICAgICAgIC5maW5kKFwiLmRjcEFycmF5X19jb250ZW50X190b29sQ2VsbF9fZGVsZXRlXCIpXG4gICAgICAgICAgICAuZWFjaChmdW5jdGlvbiBkY3BBcnJheV9pbml0TGluZSgpIHtcbiAgICAgICAgICAgICAgLy8gcmVzZXQgdG9vbHRpcFxuICAgICAgICAgICAgICAkKHRoaXMpXG4gICAgICAgICAgICAgICAgLnRvb2x0aXAoXCJoaWRlXCIpXG4gICAgICAgICAgICAgICAgLmRhdGEoXCJicy50b29sdGlwXCIsIG51bGwpO1xuICAgICAgICAgICAgICAkKHRoaXMpLmF0dHIoXCJ0aXRsZVwiLCAkKHRoaXMpLmRhdGEoXCJvcmlnaW5hbFRpdGxlXCIpKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcblxuICAgIGFkZExpbmU6IGZ1bmN0aW9uIGRjcEFycmF5YWRkTGluZShsaW5lTnVtYmVyLCBvcHRpb25zKSB7XG4gICAgICByZXR1cm4gbmV3IFByb21pc2UoXG4gICAgICAgIF8uYmluZChmdW5jdGlvbiBkY3BBcnJheWFkZExpbmVfcHJvbWlzZShyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgICB2YXIgJGNvbnRlbnQgPSB0aGlzLl9hZGROZXdMaW5lKGxpbmVOdW1iZXIsIG9wdGlvbnMpO1xuICAgICAgICAgIGlmICgkY29udGVudCkge1xuICAgICAgICAgICAgb3B0aW9ucyA9IF8uZGVmYXVsdHMob3B0aW9ucyB8fCB7fSwge1xuICAgICAgICAgICAgICBzaWxlbnQ6IGZhbHNlLFxuICAgICAgICAgICAgICBuZWVkQWRkVmFsdWU6IGZhbHNlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGlmIChvcHRpb25zLnNpbGVudCAhPT0gdHJ1ZSkge1xuICAgICAgICAgICAgICB0aGlzLl90cmlnZ2VyKFxuICAgICAgICAgICAgICAgIFwibGluZUFkZGVkXCIsXG4gICAgICAgICAgICAgICAge30sXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgbGluZTogbGluZU51bWJlcixcbiAgICAgICAgICAgICAgICAgIGVsZW1lbnQ6ICRjb250ZW50LFxuICAgICAgICAgICAgICAgICAgbmVlZEFkZFZhbHVlOiBvcHRpb25zLm5lZWRBZGRWYWx1ZSxcbiAgICAgICAgICAgICAgICAgIHJlc29sdmU6IHJlc29sdmUsXG4gICAgICAgICAgICAgICAgICByZWplY3Q6IHJlamVjdFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sIHRoaXMpXG4gICAgICApO1xuICAgIH0sXG5cbiAgICBjb3B5TGluZTogZnVuY3Rpb24gZGNwQXJyYXljb3B5TGluZShsaW5lTnVtYmVyLCBvcHRpb25zKSB7XG4gICAgICByZXR1cm4gbmV3IFByb21pc2UoXG4gICAgICAgIF8uYmluZChmdW5jdGlvbiBkY3BBcnJheWFkZExpbmUoKSB7XG4gICAgICAgICAgdmFyICRjb250ZW50ID0gdGhpcy5fYWRkTmV3TGluZShsaW5lTnVtYmVyLCBvcHRpb25zKTtcbiAgICAgICAgICBpZiAoJGNvbnRlbnQpIHtcbiAgICAgICAgICAgIHRoaXMuX3RyaWdnZXIoXG4gICAgICAgICAgICAgIFwibGluZUFkZGVkXCIsXG4gICAgICAgICAgICAgIHt9LFxuICAgICAgICAgICAgICB7IGxpbmU6IGxpbmVOdW1iZXIsIGVsZW1lbnQ6ICRjb250ZW50LCBjb3B5VmFsdWU6IHRydWUgfVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sIHRoaXMpXG4gICAgICApO1xuICAgIH0sXG5cbiAgICByZW1vdmVMaW5lOiBmdW5jdGlvbiBkY3BBcnJheXJlbW92ZUxpbmUobGluZSwgb3B0aW9ucykge1xuICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG4gICAgICB0aGlzLmVsZW1lbnQuZmluZChcIltkYXRhLWxpbmU9XCIgKyBsaW5lICsgXCJdXCIpLnJlbW92ZSgpO1xuICAgICAgdGhpcy5faW5kZXhMaW5lKCk7XG4gICAgICBpZiAob3B0aW9ucy5zaWxlbnQgIT09IHRydWUpIHtcbiAgICAgICAgdGhpcy5fdHJpZ2dlcihcImxpbmVSZW1vdmVkXCIsIHt9LCB7IGxpbmU6IGxpbmUgfSk7XG4gICAgICB9XG4gICAgICB0aGlzLnJlZHJhd0xhYmVsKCk7XG4gICAgICB0aGlzLl9hY3RpdmF0ZVJvd0xpbWl0cygpO1xuICAgIH0sXG5cbiAgICBfZGVzdHJveTogZnVuY3Rpb24gZGNwQXJyYXlfZGVzdHJveSgpIHtcbiAgICAgIHZhciB0Ym9keSA9IHRoaXMuZWxlbWVudC5maW5kKFwidGJvZHlcIik7XG4gICAgICBpZiAodGJvZHkgJiYgdGJvZHkuZGF0YShcImtlbmRvRHJvcFRhcmdldEFyZWFcIikpIHtcbiAgICAgICAgdGJvZHkuZGF0YShcImtlbmRvRHJvcFRhcmdldEFyZWFcIikuZGVzdHJveSgpO1xuICAgICAgfVxuICAgICAgaWYgKHRib2R5ICYmIHRib2R5LmRhdGEoXCJrZW5kb0RyYWdnYWJsZVwiKSkge1xuICAgICAgICB0Ym9keS5kYXRhKFwia2VuZG9EcmFnZ2FibGVcIikuZGVzdHJveSgpO1xuICAgICAgfVxuICAgICAgdGhpcy5lbGVtZW50LmVtcHR5KCk7XG4gICAgICB0aGlzLl9zdXBlcigpO1xuICAgIH0sXG5cbiAgICBfaW5kZXhMaW5lOiBmdW5jdGlvbiBkY3BBcnJheV9pbmRleExpbmUoKSB7XG4gICAgICB2YXIgaSA9IDA7XG4gICAgICB0aGlzLmVsZW1lbnRcbiAgICAgICAgLmZpbmQoXCIuZGNwQXJyYXlfX2NvbnRlbnRfX2xpbmVcIilcbiAgICAgICAgLmVhY2goZnVuY3Rpb24gbnVtZXJvdGVMaW5lKCkge1xuICAgICAgICAgICQodGhpcylcbiAgICAgICAgICAgIC5hdHRyKFwiZGF0YS1saW5lXCIsIGkpXG4gICAgICAgICAgICAuZGF0YShcImxpbmVcIiwgaSk7XG4gICAgICAgICAgaSArPSAxO1xuICAgICAgICB9KTtcbiAgICAgIHRoaXMub3B0aW9ucy5uYkxpbmVzID0gaTtcbiAgICB9LFxuXG4gICAgX3VuU2VsZWN0TGluZXM6IGZ1bmN0aW9uIGRjcEFycmF5X3VuU2VsZWN0TGluZXMoKSB7XG4gICAgICB0aGlzLmVsZW1lbnQuZmluZChcIi5kY3BBcnJheV9fY29udGVudF9fdG9vbENlbGxfX2NoZWNrIC5mYS1jaGVja1wiKS5oaWRlKCk7XG4gICAgICB0aGlzLmVsZW1lbnRcbiAgICAgICAgLmZpbmQoXCIuZGNwQXJyYXlfX2NvbnRlbnRfX2xpbmUtLXNlbGVjdGVkXCIpXG4gICAgICAgIC5yZW1vdmVDbGFzcyhcImRjcEFycmF5X19jb250ZW50X19saW5lLS1zZWxlY3RlZCBhY3RpdmVcIik7XG4gICAgfSxcbiAgICAvKipcbiAgICAgKiBEaXNwbGF5IHRvb2x0aXAgYW4gZXJyb3IgbWVzc2FnZVxuICAgICAqXG4gICAgICogQHBhcmFtIG1lc3NhZ2Ugc3RyaW5nIG9yIGFycmF5IG9mIFt7bWVzc2FnZTosIGluZGV4On0sIC4uLl1cbiAgICAgKi9cbiAgICBzZXRFcnJvcjogZnVuY3Rpb24gZGNwQXJyYXlfU2V0RXJyb3IobWVzc2FnZSkge1xuICAgICAgdmFyIHNjb3BlID0gdGhpcztcbiAgICAgIHZhciAkdGFyZ2V0ID0gdGhpcy5lbGVtZW50LmZpbmQoXCIuZGNwQXJyYXlfX2NvbnRlbnQgdGFibGUudGFibGVcIik7XG4gICAgICBpZiAobWVzc2FnZSkge1xuICAgICAgICAkdGFyZ2V0XG4gICAgICAgICAgLnRvb2x0aXAoe1xuICAgICAgICAgICAgcGxhY2VtZW50OiBcInRvcFwiLFxuICAgICAgICAgICAgdHJpZ2dlcjogXCJtYW51YWxcIixcbiAgICAgICAgICAgIGFuaW1hdGlvbjogZmFsc2UsXG4gICAgICAgICAgICBodG1sOiB0cnVlLFxuICAgICAgICAgICAgdGl0bGU6IGZ1bmN0aW9uIGRjcEFycmF5X2NvbXB1dGVUaXRsZUVycm9yKCkge1xuICAgICAgICAgICAgICB2YXIgcmF3TWVzc2FnZSA9ICQoXCI8ZGl2Lz5cIilcbiAgICAgICAgICAgICAgICAudGV4dChtZXNzYWdlKVxuICAgICAgICAgICAgICAgIC5odG1sKCk7XG4gICAgICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAgICAgXCI8ZGl2PlwiICtcbiAgICAgICAgICAgICAgICAnPHNwYW4gdGl0bGU9XCInICtcbiAgICAgICAgICAgICAgICBzY29wZS5vcHRpb25zLmxhYmVscy5jbG9zZUVycm9yTWVzc2FnZSArXG4gICAgICAgICAgICAgICAgJ1wiIGNsYXNzPVwiYnRuIGZhIGZhLXRpbWVzIGJ1dHRvbi1jbG9zZS1lcnJvclwiPiAmbmJzcDs8L3NwYW4+JyArXG4gICAgICAgICAgICAgICAgcmF3TWVzc2FnZSArXG4gICAgICAgICAgICAgICAgXCI8L2Rpdj5cIlxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pXG4gICAgICAgICAgLm9uZShcInNob3duLmJzLnRvb2x0aXBcIiwgZnVuY3Rpb24gd0Vycm9yVG9vbHRpcCgpIHtcbiAgICAgICAgICAgIHZhciB0aXBFbGVtZW50ID0gJCh0aGlzKS5kYXRhKFwiYnMudG9vbHRpcFwiKS50aXA7XG4gICAgICAgICAgICBpZiAodGlwRWxlbWVudCkge1xuICAgICAgICAgICAgICAkKHRpcEVsZW1lbnQpLmFkZENsYXNzKFwiaGFzLWVycm9yXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pXG4gICAgICAgICAgLnRvb2x0aXAoXCJzaG93XCIpXG4gICAgICAgICAgLmFkZENsYXNzKFwiZGNwQXJyYXktLWVycm9yXCIpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgJHRhcmdldC50b29sdGlwKFwiaGlkZVwiKS5yZW1vdmVDbGFzcyhcImRjcEFycmF5LS1lcnJvclwiKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIC8qKlxuICAgICAqIEdldCB0aGUgdGVtcGxhdGUgb2YgdGhlIGN1cnJlbnQgYXR0cmlidXRlXG4gICAgICpcbiAgICAgKiBUaGUgdGVtcGxhdGUgY2FuIGJlIGluIHRoZSBvcHRpb25zIG9yIGluIGEgZ2xvYmFsIHZhciBvZiBkY3AgbmFtZXNwYWNlIChpbml0aWF0ZWQgYnkgcmVxdWlyZSBmb3Igd2lkZ2V0KVxuICAgICAqXG4gICAgICogQHBhcmFtIGtleVxuICAgICAqIEByZXR1cm5zIHN0cmluZ1xuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX2dldFRlbXBsYXRlOiBmdW5jdGlvbiBkY3BBcnJheV9nZXRUZW1wbGF0ZShrZXkpIHtcbiAgICAgIGlmICh0aGlzLm9wdGlvbnMudGVtcGxhdGVzICYmIHRoaXMub3B0aW9ucy50ZW1wbGF0ZXNba2V5XSkge1xuICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zLnRlbXBsYXRlc1trZXldO1xuICAgICAgfVxuICAgICAgaWYgKFxuICAgICAgICB3aW5kb3cuZGNwICYmXG4gICAgICAgIHdpbmRvdy5kY3AudGVtcGxhdGVzICYmXG4gICAgICAgIHdpbmRvdy5kY3AudGVtcGxhdGVzW3RoaXMuZ2V0VHlwZSgpXSAmJlxuICAgICAgICB3aW5kb3cuZGNwLnRlbXBsYXRlc1t0aGlzLmdldFR5cGUoKV1ba2V5XVxuICAgICAgKSB7XG4gICAgICAgIHJldHVybiB3aW5kb3cuZGNwLnRlbXBsYXRlc1t0aGlzLmdldFR5cGUoKV1ba2V5XTtcbiAgICAgIH1cbiAgICAgIGlmIChcbiAgICAgICAgd2luZG93LmRjcCAmJlxuICAgICAgICB3aW5kb3cuZGNwLnRlbXBsYXRlcyAmJlxuICAgICAgICB3aW5kb3cuZGNwLnRlbXBsYXRlc1tcImRlZmF1bHRcIl0gJiZcbiAgICAgICAgd2luZG93LmRjcC50ZW1wbGF0ZXNbXCJkZWZhdWx0XCJdW2tleV1cbiAgICAgICkge1xuICAgICAgICByZXR1cm4gd2luZG93LmRjcC50ZW1wbGF0ZXNbXCJkZWZhdWx0XCJdW2tleV07XG4gICAgICB9XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJVbmtub3duIHRlbXBsYXRlICBcIiArIGtleSArIFwiL1wiICsgdGhpcy5vcHRpb25zLnR5cGUpO1xuICAgIH0sXG5cbiAgICBnZXRUeXBlOiBmdW5jdGlvbiBkY3BBcnJheV9nZXRUeXBlKCkge1xuICAgICAgcmV0dXJuIFwiYXJyYXlcIjtcbiAgICB9XG4gIH0pO1xuXG4gIHJldHVybiAkLmZuLmRjcEFycmF5O1xufSk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQ0EsV0FHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///3e588fcfb2b891e35e39\n");

/***/ }),

/***/ "3fc27e9e68117b665919":
/*!**********************************************************!*\
  !*** ./src/Apps/DOCUMENT/IHM/widgets/window/wConfirm.js ***!
  \**********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;!(__WEBPACK_AMD_DEFINE_ARRAY__ = [\n  __webpack_require__(/*! jquery */ \"127c8cf59f228bb01a21\"),\n  __webpack_require__(/*! underscore */ \"8e08e542008e4aef1f58\"),\n  __webpack_require__(/*! mustache */ \"bcd31d01884fc294fd69\"),\n  __webpack_require__(/*! dcpDocument/widgets/window/wWindow */ \"20a5662e33e2c3e5a9d8\")\n], __WEBPACK_AMD_DEFINE_RESULT__ = (function wConfirm($, _, Mustache) {\n  \"use strict\";\n\n  $.widget(\"dcp.dcpConfirm\", $.dcp.dcpWindow, {\n    options: {\n      modal: true,\n      templateData: {\n        templates: {\n          window: {\n            confirm:\n              '<div class=\"confirm--body\"> <div class=\"confirm--content\">  <div>{{messages.textMessage}}</div><div>{{{messages.htmlMessage}}}</div> </div> <div class=\"confirm--buttons\"> <button class=\"button--cancel\" type=\"button\">{{messages.cancelMessage}}</button> <button class=\"button--ok k-primary\" type=\"button\">{{messages.okMessage}}</button> </div> </div>'\n          }\n        }\n      },\n      messages: {\n        textMessage: \"Are you sure ?\",\n        htmlMessage: \"\",\n        okMessage: \"Ok\",\n        cancelMessage: \"Cancel\"\n      },\n      cancel: function wConfirmCancel() {},\n\n      confirm: function wConfirmConfirm() {},\n      actions: [\"Close\"],\n      height: \"150px\"\n    },\n\n    _create: function wConfirmCreate() {\n      var scope = this;\n      var scoppedCancel = _.bind(this.options.cancel, this);\n      this.options.close = scoppedCancel;\n      this.options.templateData.messages = this.options.messages || [];\n      this.currentWidget = $(\n        Mustache.render(\n          this._getWindowTemplate(\"confirm\") || \"\",\n          this.options.templateData\n        )\n      );\n      this.element.append(this.currentWidget);\n      this.currentWidget.kendoWindow(this.options);\n      this.currentWidget.data(\"kendoWindow\").center();\n\n      this.currentWidget.find(\".button--cancel\").kendoButton({\n        click: function wConfirmCancelClick() {\n          scoppedCancel();\n          scope.destroy();\n        }\n      });\n\n      var scoppedConfirm = _.bind(this.options.confirm, this);\n\n      this.currentWidget.find(\".button--ok\").kendoButton({\n        click: function wConfirmOkClick() {\n          scoppedConfirm();\n          scope.destroy();\n        }\n      });\n\n      this.element.data(\"dcpWindow\", this);\n    }\n  });\n}).apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiM2ZjMjdlOWU2ODExN2I2NjU5MTkuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvQXBwcy9ET0NVTUVOVC9JSE0vd2lkZ2V0cy93aW5kb3cvd0NvbmZpcm0uanM/YWZiMyJdLCJzb3VyY2VzQ29udGVudCI6WyJkZWZpbmUoW1xuICBcImpxdWVyeVwiLFxuICBcInVuZGVyc2NvcmVcIixcbiAgXCJtdXN0YWNoZVwiLFxuICBcImRjcERvY3VtZW50L3dpZGdldHMvd2luZG93L3dXaW5kb3dcIlxuXSwgZnVuY3Rpb24gd0NvbmZpcm0oJCwgXywgTXVzdGFjaGUpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgJC53aWRnZXQoXCJkY3AuZGNwQ29uZmlybVwiLCAkLmRjcC5kY3BXaW5kb3csIHtcbiAgICBvcHRpb25zOiB7XG4gICAgICBtb2RhbDogdHJ1ZSxcbiAgICAgIHRlbXBsYXRlRGF0YToge1xuICAgICAgICB0ZW1wbGF0ZXM6IHtcbiAgICAgICAgICB3aW5kb3c6IHtcbiAgICAgICAgICAgIGNvbmZpcm06XG4gICAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwiY29uZmlybS0tYm9keVwiPiA8ZGl2IGNsYXNzPVwiY29uZmlybS0tY29udGVudFwiPiAgPGRpdj57e21lc3NhZ2VzLnRleHRNZXNzYWdlfX08L2Rpdj48ZGl2Pnt7e21lc3NhZ2VzLmh0bWxNZXNzYWdlfX19PC9kaXY+IDwvZGl2PiA8ZGl2IGNsYXNzPVwiY29uZmlybS0tYnV0dG9uc1wiPiA8YnV0dG9uIGNsYXNzPVwiYnV0dG9uLS1jYW5jZWxcIiB0eXBlPVwiYnV0dG9uXCI+e3ttZXNzYWdlcy5jYW5jZWxNZXNzYWdlfX08L2J1dHRvbj4gPGJ1dHRvbiBjbGFzcz1cImJ1dHRvbi0tb2sgay1wcmltYXJ5XCIgdHlwZT1cImJ1dHRvblwiPnt7bWVzc2FnZXMub2tNZXNzYWdlfX08L2J1dHRvbj4gPC9kaXY+IDwvZGl2PidcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBtZXNzYWdlczoge1xuICAgICAgICB0ZXh0TWVzc2FnZTogXCJBcmUgeW91IHN1cmUgP1wiLFxuICAgICAgICBodG1sTWVzc2FnZTogXCJcIixcbiAgICAgICAgb2tNZXNzYWdlOiBcIk9rXCIsXG4gICAgICAgIGNhbmNlbE1lc3NhZ2U6IFwiQ2FuY2VsXCJcbiAgICAgIH0sXG4gICAgICBjYW5jZWw6IGZ1bmN0aW9uIHdDb25maXJtQ2FuY2VsKCkge30sXG5cbiAgICAgIGNvbmZpcm06IGZ1bmN0aW9uIHdDb25maXJtQ29uZmlybSgpIHt9LFxuICAgICAgYWN0aW9uczogW1wiQ2xvc2VcIl0sXG4gICAgICBoZWlnaHQ6IFwiMTUwcHhcIlxuICAgIH0sXG5cbiAgICBfY3JlYXRlOiBmdW5jdGlvbiB3Q29uZmlybUNyZWF0ZSgpIHtcbiAgICAgIHZhciBzY29wZSA9IHRoaXM7XG4gICAgICB2YXIgc2NvcHBlZENhbmNlbCA9IF8uYmluZCh0aGlzLm9wdGlvbnMuY2FuY2VsLCB0aGlzKTtcbiAgICAgIHRoaXMub3B0aW9ucy5jbG9zZSA9IHNjb3BwZWRDYW5jZWw7XG4gICAgICB0aGlzLm9wdGlvbnMudGVtcGxhdGVEYXRhLm1lc3NhZ2VzID0gdGhpcy5vcHRpb25zLm1lc3NhZ2VzIHx8IFtdO1xuICAgICAgdGhpcy5jdXJyZW50V2lkZ2V0ID0gJChcbiAgICAgICAgTXVzdGFjaGUucmVuZGVyKFxuICAgICAgICAgIHRoaXMuX2dldFdpbmRvd1RlbXBsYXRlKFwiY29uZmlybVwiKSB8fCBcIlwiLFxuICAgICAgICAgIHRoaXMub3B0aW9ucy50ZW1wbGF0ZURhdGFcbiAgICAgICAgKVxuICAgICAgKTtcbiAgICAgIHRoaXMuZWxlbWVudC5hcHBlbmQodGhpcy5jdXJyZW50V2lkZ2V0KTtcbiAgICAgIHRoaXMuY3VycmVudFdpZGdldC5rZW5kb1dpbmRvdyh0aGlzLm9wdGlvbnMpO1xuICAgICAgdGhpcy5jdXJyZW50V2lkZ2V0LmRhdGEoXCJrZW5kb1dpbmRvd1wiKS5jZW50ZXIoKTtcblxuICAgICAgdGhpcy5jdXJyZW50V2lkZ2V0LmZpbmQoXCIuYnV0dG9uLS1jYW5jZWxcIikua2VuZG9CdXR0b24oe1xuICAgICAgICBjbGljazogZnVuY3Rpb24gd0NvbmZpcm1DYW5jZWxDbGljaygpIHtcbiAgICAgICAgICBzY29wcGVkQ2FuY2VsKCk7XG4gICAgICAgICAgc2NvcGUuZGVzdHJveSgpO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgdmFyIHNjb3BwZWRDb25maXJtID0gXy5iaW5kKHRoaXMub3B0aW9ucy5jb25maXJtLCB0aGlzKTtcblxuICAgICAgdGhpcy5jdXJyZW50V2lkZ2V0LmZpbmQoXCIuYnV0dG9uLS1va1wiKS5rZW5kb0J1dHRvbih7XG4gICAgICAgIGNsaWNrOiBmdW5jdGlvbiB3Q29uZmlybU9rQ2xpY2soKSB7XG4gICAgICAgICAgc2NvcHBlZENvbmZpcm0oKTtcbiAgICAgICAgICBzY29wZS5kZXN0cm95KCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLmVsZW1lbnQuZGF0YShcImRjcFdpbmRvd1wiLCB0aGlzKTtcbiAgICB9XG4gIH0pO1xufSk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///3fc27e9e68117b665919\n");

/***/ }),

/***/ "44a0b71fc2e02754c2f8":
/*!************************************************************************!*\
  !*** ./src/Apps/DOCUMENT/IHM/widgets/attributes/longtext/wLongtext.js ***!
  \************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/*global define*/\n(function umdRequire(root, factory) {\n  \"use strict\";\n\n  if (true) {\n    !(__WEBPACK_AMD_DEFINE_ARRAY__ = [\n      __webpack_require__(/*! jquery */ \"127c8cf59f228bb01a21\"),\n      __webpack_require__(/*! underscore */ \"8e08e542008e4aef1f58\"),\n      __webpack_require__(/*! dcpDocument/widgets/attributes/text/wText */ \"61b480911316cdda77a4\")\n    ], __WEBPACK_AMD_DEFINE_FACTORY__ = (factory),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?\n\t\t\t\t(__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n  } else {}\n})(window, function requireDcpLongText($, _) {\n  \"use strict\";\n\n  $.widget(\"dcp.dcpLongtext\", $.dcp.dcpText, {\n    options: {\n      type: \"longtext\",\n      renderOptions: {\n        displayedLineNumber: 5\n      }\n    },\n\n    _initDom: function dcpLongtext_initDom() {\n      var maxDisplayedLine = this.options.renderOptions.displayedLineNumber;\n\n      this._super();\n      this._maxLinesNumber(maxDisplayedLine);\n    },\n\n    _initEvent: function dcpLongtext_initEvent() {\n      if (this.getMode() === \"write\") {\n        this._initAutoFit();\n      }\n      this._super();\n    },\n\n    _maxLinesNumber: function dcpLongtext_maxLinesNumber(lineNumber) {\n      lineNumber = parseInt(lineNumber, 10);\n      if (lineNumber > 0) {\n        var scope = this;\n        _.defer(function dcpLongtext_deferComputeSize() {\n          var $element = scope.getContentElements();\n          var delta =\n            parseFloat($element.css(\"padding-top\")) +\n            parseFloat($element.css(\"padding-bottom\"));\n          var lineH = $element.css(\"line-height\");\n          // In IE9 , the result is just a number without unit\n          if (lineH) {\n            if (lineH.indexOf(\"px\") > 0) {\n              $element.css(\n                \"max-height\",\n                lineNumber * parseFloat(lineH) + delta + \"px\"\n              );\n            } else {\n              $element.css(\"max-height\", lineNumber * 1.1 + \"em\");\n            }\n          }\n        });\n      }\n    },\n    /**\n     * Define inputs for focus\n     * @protected\n     */\n    _getFocusInput: function dcpLongtext_getFocusInput() {\n      return this.element.find('textarea[name=\"' + this.options.id + '\"]');\n    },\n\n    _fitToContent: function dcpLongtext_fitToContent($element) {\n      var delta =\n          parseFloat($element.css(\"padding-top\")) +\n          parseFloat($element.css(\"padding-bottom\")),\n        element = $element.get(0),\n        maxHeight = parseFloat($element.css(\"max-height\"));\n      if (element && element.scrollHeight > element.clientHeight) {\n        $element.height(element.scrollHeight - delta + 1);\n        if (maxHeight > 0) {\n          if (element.scrollHeight > maxHeight) {\n            $element.css(\"resize\", \"none\");\n          } else {\n            $element.css(\"resize\", \"\");\n          }\n        }\n      }\n    },\n\n    _initAutoFit: function dcpLongtext_initAutoFit() {\n      var scope = this;\n      _.defer(function dcpLongtext_computeSize() {\n        scope._fitToContent(scope.getContentElements());\n      });\n      this.getContentElements()\n        .on(\n          \"keyup\" + this.eventNamespace,\n          function dcpLongtext_keyUpUpdateSize() {\n            scope._fitToContent($(this));\n          }\n        )\n        .on(\n          \"focus\" + this.eventNamespace,\n          function dcpLongtext_focusUpdateSize() {\n            scope._fitToContent($(this));\n          }\n        );\n\n      this.element.on(\n        \"show\" + this.eventNamespace,\n        function dcpLongtext_showUpdateSize() {\n          scope._fitToContent(scope.getContentElements());\n        }\n      );\n    },\n\n    getType: function dcpLongtext_getType() {\n      return \"longtext\";\n    }\n  });\n\n  return $.fn.dcpLongtext;\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNDRhMGI3MWZjMmUwMjc1NGMyZjguanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvQXBwcy9ET0NVTUVOVC9JSE0vd2lkZ2V0cy9hdHRyaWJ1dGVzL2xvbmd0ZXh0L3dMb25ndGV4dC5qcz9lYmU2Il0sInNvdXJjZXNDb250ZW50IjpbIi8qZ2xvYmFsIGRlZmluZSovXG4oZnVuY3Rpb24gdW1kUmVxdWlyZShyb290LCBmYWN0b3J5KSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIGlmICh0eXBlb2YgZGVmaW5lID09PSBcImZ1bmN0aW9uXCIgJiYgZGVmaW5lLmFtZCkge1xuICAgIGRlZmluZShbXG4gICAgICBcImpxdWVyeVwiLFxuICAgICAgXCJ1bmRlcnNjb3JlXCIsXG4gICAgICBcImRjcERvY3VtZW50L3dpZGdldHMvYXR0cmlidXRlcy90ZXh0L3dUZXh0XCJcbiAgICBdLCBmYWN0b3J5KTtcbiAgfSBlbHNlIHtcbiAgICAvL25vaW5zcGVjdGlvbiBKU1VucmVzb2x2ZWRWYXJpYWJsZVxuICAgIGZhY3Rvcnkod2luZG93LmpRdWVyeSwgd2luZG93Ll8pO1xuICB9XG59KSh3aW5kb3csIGZ1bmN0aW9uIHJlcXVpcmVEY3BMb25nVGV4dCgkLCBfKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gICQud2lkZ2V0KFwiZGNwLmRjcExvbmd0ZXh0XCIsICQuZGNwLmRjcFRleHQsIHtcbiAgICBvcHRpb25zOiB7XG4gICAgICB0eXBlOiBcImxvbmd0ZXh0XCIsXG4gICAgICByZW5kZXJPcHRpb25zOiB7XG4gICAgICAgIGRpc3BsYXllZExpbmVOdW1iZXI6IDVcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgX2luaXREb206IGZ1bmN0aW9uIGRjcExvbmd0ZXh0X2luaXREb20oKSB7XG4gICAgICB2YXIgbWF4RGlzcGxheWVkTGluZSA9IHRoaXMub3B0aW9ucy5yZW5kZXJPcHRpb25zLmRpc3BsYXllZExpbmVOdW1iZXI7XG5cbiAgICAgIHRoaXMuX3N1cGVyKCk7XG4gICAgICB0aGlzLl9tYXhMaW5lc051bWJlcihtYXhEaXNwbGF5ZWRMaW5lKTtcbiAgICB9LFxuXG4gICAgX2luaXRFdmVudDogZnVuY3Rpb24gZGNwTG9uZ3RleHRfaW5pdEV2ZW50KCkge1xuICAgICAgaWYgKHRoaXMuZ2V0TW9kZSgpID09PSBcIndyaXRlXCIpIHtcbiAgICAgICAgdGhpcy5faW5pdEF1dG9GaXQoKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuX3N1cGVyKCk7XG4gICAgfSxcblxuICAgIF9tYXhMaW5lc051bWJlcjogZnVuY3Rpb24gZGNwTG9uZ3RleHRfbWF4TGluZXNOdW1iZXIobGluZU51bWJlcikge1xuICAgICAgbGluZU51bWJlciA9IHBhcnNlSW50KGxpbmVOdW1iZXIsIDEwKTtcbiAgICAgIGlmIChsaW5lTnVtYmVyID4gMCkge1xuICAgICAgICB2YXIgc2NvcGUgPSB0aGlzO1xuICAgICAgICBfLmRlZmVyKGZ1bmN0aW9uIGRjcExvbmd0ZXh0X2RlZmVyQ29tcHV0ZVNpemUoKSB7XG4gICAgICAgICAgdmFyICRlbGVtZW50ID0gc2NvcGUuZ2V0Q29udGVudEVsZW1lbnRzKCk7XG4gICAgICAgICAgdmFyIGRlbHRhID1cbiAgICAgICAgICAgIHBhcnNlRmxvYXQoJGVsZW1lbnQuY3NzKFwicGFkZGluZy10b3BcIikpICtcbiAgICAgICAgICAgIHBhcnNlRmxvYXQoJGVsZW1lbnQuY3NzKFwicGFkZGluZy1ib3R0b21cIikpO1xuICAgICAgICAgIHZhciBsaW5lSCA9ICRlbGVtZW50LmNzcyhcImxpbmUtaGVpZ2h0XCIpO1xuICAgICAgICAgIC8vIEluIElFOSAsIHRoZSByZXN1bHQgaXMganVzdCBhIG51bWJlciB3aXRob3V0IHVuaXRcbiAgICAgICAgICBpZiAobGluZUgpIHtcbiAgICAgICAgICAgIGlmIChsaW5lSC5pbmRleE9mKFwicHhcIikgPiAwKSB7XG4gICAgICAgICAgICAgICRlbGVtZW50LmNzcyhcbiAgICAgICAgICAgICAgICBcIm1heC1oZWlnaHRcIixcbiAgICAgICAgICAgICAgICBsaW5lTnVtYmVyICogcGFyc2VGbG9hdChsaW5lSCkgKyBkZWx0YSArIFwicHhcIlxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgJGVsZW1lbnQuY3NzKFwibWF4LWhlaWdodFwiLCBsaW5lTnVtYmVyICogMS4xICsgXCJlbVwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0sXG4gICAgLyoqXG4gICAgICogRGVmaW5lIGlucHV0cyBmb3IgZm9jdXNcbiAgICAgKiBAcHJvdGVjdGVkXG4gICAgICovXG4gICAgX2dldEZvY3VzSW5wdXQ6IGZ1bmN0aW9uIGRjcExvbmd0ZXh0X2dldEZvY3VzSW5wdXQoKSB7XG4gICAgICByZXR1cm4gdGhpcy5lbGVtZW50LmZpbmQoJ3RleHRhcmVhW25hbWU9XCInICsgdGhpcy5vcHRpb25zLmlkICsgJ1wiXScpO1xuICAgIH0sXG5cbiAgICBfZml0VG9Db250ZW50OiBmdW5jdGlvbiBkY3BMb25ndGV4dF9maXRUb0NvbnRlbnQoJGVsZW1lbnQpIHtcbiAgICAgIHZhciBkZWx0YSA9XG4gICAgICAgICAgcGFyc2VGbG9hdCgkZWxlbWVudC5jc3MoXCJwYWRkaW5nLXRvcFwiKSkgK1xuICAgICAgICAgIHBhcnNlRmxvYXQoJGVsZW1lbnQuY3NzKFwicGFkZGluZy1ib3R0b21cIikpLFxuICAgICAgICBlbGVtZW50ID0gJGVsZW1lbnQuZ2V0KDApLFxuICAgICAgICBtYXhIZWlnaHQgPSBwYXJzZUZsb2F0KCRlbGVtZW50LmNzcyhcIm1heC1oZWlnaHRcIikpO1xuICAgICAgaWYgKGVsZW1lbnQgJiYgZWxlbWVudC5zY3JvbGxIZWlnaHQgPiBlbGVtZW50LmNsaWVudEhlaWdodCkge1xuICAgICAgICAkZWxlbWVudC5oZWlnaHQoZWxlbWVudC5zY3JvbGxIZWlnaHQgLSBkZWx0YSArIDEpO1xuICAgICAgICBpZiAobWF4SGVpZ2h0ID4gMCkge1xuICAgICAgICAgIGlmIChlbGVtZW50LnNjcm9sbEhlaWdodCA+IG1heEhlaWdodCkge1xuICAgICAgICAgICAgJGVsZW1lbnQuY3NzKFwicmVzaXplXCIsIFwibm9uZVwiKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgJGVsZW1lbnQuY3NzKFwicmVzaXplXCIsIFwiXCIpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sXG5cbiAgICBfaW5pdEF1dG9GaXQ6IGZ1bmN0aW9uIGRjcExvbmd0ZXh0X2luaXRBdXRvRml0KCkge1xuICAgICAgdmFyIHNjb3BlID0gdGhpcztcbiAgICAgIF8uZGVmZXIoZnVuY3Rpb24gZGNwTG9uZ3RleHRfY29tcHV0ZVNpemUoKSB7XG4gICAgICAgIHNjb3BlLl9maXRUb0NvbnRlbnQoc2NvcGUuZ2V0Q29udGVudEVsZW1lbnRzKCkpO1xuICAgICAgfSk7XG4gICAgICB0aGlzLmdldENvbnRlbnRFbGVtZW50cygpXG4gICAgICAgIC5vbihcbiAgICAgICAgICBcImtleXVwXCIgKyB0aGlzLmV2ZW50TmFtZXNwYWNlLFxuICAgICAgICAgIGZ1bmN0aW9uIGRjcExvbmd0ZXh0X2tleVVwVXBkYXRlU2l6ZSgpIHtcbiAgICAgICAgICAgIHNjb3BlLl9maXRUb0NvbnRlbnQoJCh0aGlzKSk7XG4gICAgICAgICAgfVxuICAgICAgICApXG4gICAgICAgIC5vbihcbiAgICAgICAgICBcImZvY3VzXCIgKyB0aGlzLmV2ZW50TmFtZXNwYWNlLFxuICAgICAgICAgIGZ1bmN0aW9uIGRjcExvbmd0ZXh0X2ZvY3VzVXBkYXRlU2l6ZSgpIHtcbiAgICAgICAgICAgIHNjb3BlLl9maXRUb0NvbnRlbnQoJCh0aGlzKSk7XG4gICAgICAgICAgfVxuICAgICAgICApO1xuXG4gICAgICB0aGlzLmVsZW1lbnQub24oXG4gICAgICAgIFwic2hvd1wiICsgdGhpcy5ldmVudE5hbWVzcGFjZSxcbiAgICAgICAgZnVuY3Rpb24gZGNwTG9uZ3RleHRfc2hvd1VwZGF0ZVNpemUoKSB7XG4gICAgICAgICAgc2NvcGUuX2ZpdFRvQ29udGVudChzY29wZS5nZXRDb250ZW50RWxlbWVudHMoKSk7XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgfSxcblxuICAgIGdldFR5cGU6IGZ1bmN0aW9uIGRjcExvbmd0ZXh0X2dldFR5cGUoKSB7XG4gICAgICByZXR1cm4gXCJsb25ndGV4dFwiO1xuICAgIH1cbiAgfSk7XG5cbiAgcmV0dXJuICQuZm4uZGNwTG9uZ3RleHQ7XG59KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFDQSxXQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///44a0b71fc2e02754c2f8\n");

/***/ }),

/***/ "4eae4dcce004a8d344d8":
/*!*****************************************************************!*\
  !*** ./src/Apps/DOCUMENT/IHM/views/attributes/tab/vTabLabel.js ***!
  \*****************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/*global define*/\n!(__WEBPACK_AMD_DEFINE_ARRAY__ = [\n  __webpack_require__(/*! jquery */ \"127c8cf59f228bb01a21\"),\n  __webpack_require__(/*! underscore */ \"8e08e542008e4aef1f58\"),\n  __webpack_require__(/*! backbone */ \"1858b45bf48591489d06\"),\n  __webpack_require__(/*! mustache */ \"bcd31d01884fc294fd69\"),\n  __webpack_require__(/*! dcpDocument/views/document/attributeTemplate */ \"593c8c94ba4399020f79\")\n], __WEBPACK_AMD_DEFINE_RESULT__ = (function vTabLabel($, _, Backbone, Mustache, attributeTemplate) {\n  \"use strict\";\n\n  return Backbone.View.extend({\n    tagName: \"li\",\n\n    className: \"dcpTab__label dcpLabel\",\n\n    events: {\n      'click a[href^=\"#action/\"], a[data-action], button[data-action]':\n        \"externalLinkSelected\"\n    },\n\n    displayLabel: true,\n\n    initialize: function vTabLabel_initialize(options) {\n      if (\n        options.displayLabel === false ||\n        this.model.getOption(\"labelPosition\") === \"none\"\n      ) {\n        this.displayLabel = false;\n      }\n      this.listenTo(this.model, \"change:label\", this.updateLabel);\n      this.listenTo(this.model.get(\"content\"), \"add\", this.render);\n      this.listenTo(this.model.get(\"content\"), \"remove\", this.render);\n      this.listenTo(this.model.get(\"content\"), \"reset\", this.render);\n      this.listenTo(this.model, \"errorMessage\", this.setError);\n      this.listenTo(this.model, \"change:errorMessage\", this.setError);\n      this.listenTo(this.model, \"destroy\", this.remove);\n      this.listenTo(this.model, \"cleanView\", this.remove);\n      this.listenTo(this.model, \"hide\", this.hide);\n      this.listenTo(this.model, \"show\", this.show);\n    },\n\n    render: function vTabLabel_render() {\n      var label = this.model.get(\"label\");\n      var tooltipLabel = this.model.getOption(\"tooltipLabel\");\n      var attrData = this.model.attributes;\n      var helpId = this.model.getOption(\"helpLinkIdentifier\");\n\n      this.$el.empty();\n      if (this.displayLabel !== false) {\n        if (this.model.getOption(\"attributeLabel\")) {\n          label = this.model.getOption(\"attributeLabel\");\n        }\n\n        if (helpId) {\n          this.$el.append(\n            Mustache.render(\n              '<span class=\"dcpLabel__text\">{{label}} <a class=\"dcpLabel__help__link\" href=\"#action/document.help:{{helpId}}:{{attrid}}\"><span class=\"fa fa-question-circle\"></span></a></span>',\n              {\n                helpId: helpId,\n                attrid: this.model.id,\n                label: label\n              }\n            )\n          );\n        } else {\n          this.$el.html($('<span class=\"dcpLabel__text\" />').text(label));\n        }\n\n        attributeTemplate.insertDescription(this);\n        if (tooltipLabel) {\n          tooltipLabel = Mustache.render(tooltipLabel || \"\", attrData);\n          if (!this.model.getOption(\"tooltipHtml\")) {\n            // Need encode itself because the dropselect tooltip also need\n            tooltipLabel = $(\"<div/>\")\n              .text(tooltipLabel)\n              .html();\n          }\n          this.$el.data(\n            \"tooltipLabel\",\n            Mustache.render(tooltipLabel || \"\", attrData)\n          );\n          this.$el.tooltip({\n            placement: \"top\",\n            container: \".dcpDocument\",\n            html: true,\n            title: function vDocumentTooltipTitle() {\n              if ($(this).find(\".k-input.dcpTab__label__select\").length > 0) {\n                // It is a selected Tab\n                return $(this).data(\"tooltipLabelSelect\");\n              }\n              return $(this).data(\"tooltipLabel\"); // set the element text as content of the tooltip\n            }\n          });\n        }\n      }\n\n      this.$el.attr(\"data-attrid\", this.model.id);\n\n      return this;\n    },\n\n    setError: function vTabLabel_setError(event, data) {\n      this.model.trigger(\"attributeTabChange\", event, this.model.id, this.$el, {\n        error: data\n      });\n      if (event.prevent) {\n        return;\n      }\n      if (data) {\n        this.$el.addClass(\"has-error\");\n      } else {\n        this.$el.removeClass(\"has-error\");\n      }\n    },\n\n    updateLabel: function vTabLabel_updateLabel() {\n      this.model.trigger(\n        \"attributeTabChange\",\n        event,\n        this.model.id,\n        this.$el,\n        {}\n      );\n      this.$el.text(this.model.get(\"label\"));\n    },\n\n    hide: function vTabLabel_hide() {\n      this.$el.hide();\n    },\n\n    show: function vTabLabel_show() {\n      this.$el.show();\n    },\n\n    externalLinkSelected: function vAttributeExternalLinkSelected(event) {\n      var $target = $(event.currentTarget),\n        action,\n        options,\n        eventOptions,\n        documentModel,\n        internalEvent = {\n          prevent: false\n        };\n\n      event.preventDefault();\n      if (event.stopPropagation) {\n        event.stopPropagation();\n      }\n\n      action = $target.data(\"action\") || $target.attr(\"href\");\n      options = action.substring(8).split(\":\");\n      eventOptions = {\n        target: event.target,\n        index: -1,\n        eventId: options.shift(),\n        options: options\n      };\n      documentModel = this.model.getDocumentModel();\n\n      this.model.trigger(\"internalLinkSelected\", internalEvent, eventOptions);\n      if (event.prevent) {\n        return this;\n      }\n\n      documentModel.trigger(\"actionAttributeLink\", internalEvent, options);\n\n      return this;\n    }\n  });\n}).apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNGVhZTRkY2NlMDA0YThkMzQ0ZDguanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvQXBwcy9ET0NVTUVOVC9JSE0vdmlld3MvYXR0cmlidXRlcy90YWIvdlRhYkxhYmVsLmpzPzRjOTYiXSwic291cmNlc0NvbnRlbnQiOlsiLypnbG9iYWwgZGVmaW5lKi9cbmRlZmluZShbXG4gIFwianF1ZXJ5XCIsXG4gIFwidW5kZXJzY29yZVwiLFxuICBcImJhY2tib25lXCIsXG4gIFwibXVzdGFjaGVcIixcbiAgXCJkY3BEb2N1bWVudC92aWV3cy9kb2N1bWVudC9hdHRyaWJ1dGVUZW1wbGF0ZVwiXG5dLCBmdW5jdGlvbiB2VGFiTGFiZWwoJCwgXywgQmFja2JvbmUsIE11c3RhY2hlLCBhdHRyaWJ1dGVUZW1wbGF0ZSkge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICByZXR1cm4gQmFja2JvbmUuVmlldy5leHRlbmQoe1xuICAgIHRhZ05hbWU6IFwibGlcIixcblxuICAgIGNsYXNzTmFtZTogXCJkY3BUYWJfX2xhYmVsIGRjcExhYmVsXCIsXG5cbiAgICBldmVudHM6IHtcbiAgICAgICdjbGljayBhW2hyZWZePVwiI2FjdGlvbi9cIl0sIGFbZGF0YS1hY3Rpb25dLCBidXR0b25bZGF0YS1hY3Rpb25dJzpcbiAgICAgICAgXCJleHRlcm5hbExpbmtTZWxlY3RlZFwiXG4gICAgfSxcblxuICAgIGRpc3BsYXlMYWJlbDogdHJ1ZSxcblxuICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uIHZUYWJMYWJlbF9pbml0aWFsaXplKG9wdGlvbnMpIHtcbiAgICAgIGlmIChcbiAgICAgICAgb3B0aW9ucy5kaXNwbGF5TGFiZWwgPT09IGZhbHNlIHx8XG4gICAgICAgIHRoaXMubW9kZWwuZ2V0T3B0aW9uKFwibGFiZWxQb3NpdGlvblwiKSA9PT0gXCJub25lXCJcbiAgICAgICkge1xuICAgICAgICB0aGlzLmRpc3BsYXlMYWJlbCA9IGZhbHNlO1xuICAgICAgfVxuICAgICAgdGhpcy5saXN0ZW5Ubyh0aGlzLm1vZGVsLCBcImNoYW5nZTpsYWJlbFwiLCB0aGlzLnVwZGF0ZUxhYmVsKTtcbiAgICAgIHRoaXMubGlzdGVuVG8odGhpcy5tb2RlbC5nZXQoXCJjb250ZW50XCIpLCBcImFkZFwiLCB0aGlzLnJlbmRlcik7XG4gICAgICB0aGlzLmxpc3RlblRvKHRoaXMubW9kZWwuZ2V0KFwiY29udGVudFwiKSwgXCJyZW1vdmVcIiwgdGhpcy5yZW5kZXIpO1xuICAgICAgdGhpcy5saXN0ZW5Ubyh0aGlzLm1vZGVsLmdldChcImNvbnRlbnRcIiksIFwicmVzZXRcIiwgdGhpcy5yZW5kZXIpO1xuICAgICAgdGhpcy5saXN0ZW5Ubyh0aGlzLm1vZGVsLCBcImVycm9yTWVzc2FnZVwiLCB0aGlzLnNldEVycm9yKTtcbiAgICAgIHRoaXMubGlzdGVuVG8odGhpcy5tb2RlbCwgXCJjaGFuZ2U6ZXJyb3JNZXNzYWdlXCIsIHRoaXMuc2V0RXJyb3IpO1xuICAgICAgdGhpcy5saXN0ZW5Ubyh0aGlzLm1vZGVsLCBcImRlc3Ryb3lcIiwgdGhpcy5yZW1vdmUpO1xuICAgICAgdGhpcy5saXN0ZW5Ubyh0aGlzLm1vZGVsLCBcImNsZWFuVmlld1wiLCB0aGlzLnJlbW92ZSk7XG4gICAgICB0aGlzLmxpc3RlblRvKHRoaXMubW9kZWwsIFwiaGlkZVwiLCB0aGlzLmhpZGUpO1xuICAgICAgdGhpcy5saXN0ZW5Ubyh0aGlzLm1vZGVsLCBcInNob3dcIiwgdGhpcy5zaG93KTtcbiAgICB9LFxuXG4gICAgcmVuZGVyOiBmdW5jdGlvbiB2VGFiTGFiZWxfcmVuZGVyKCkge1xuICAgICAgdmFyIGxhYmVsID0gdGhpcy5tb2RlbC5nZXQoXCJsYWJlbFwiKTtcbiAgICAgIHZhciB0b29sdGlwTGFiZWwgPSB0aGlzLm1vZGVsLmdldE9wdGlvbihcInRvb2x0aXBMYWJlbFwiKTtcbiAgICAgIHZhciBhdHRyRGF0YSA9IHRoaXMubW9kZWwuYXR0cmlidXRlcztcbiAgICAgIHZhciBoZWxwSWQgPSB0aGlzLm1vZGVsLmdldE9wdGlvbihcImhlbHBMaW5rSWRlbnRpZmllclwiKTtcblxuICAgICAgdGhpcy4kZWwuZW1wdHkoKTtcbiAgICAgIGlmICh0aGlzLmRpc3BsYXlMYWJlbCAhPT0gZmFsc2UpIHtcbiAgICAgICAgaWYgKHRoaXMubW9kZWwuZ2V0T3B0aW9uKFwiYXR0cmlidXRlTGFiZWxcIikpIHtcbiAgICAgICAgICBsYWJlbCA9IHRoaXMubW9kZWwuZ2V0T3B0aW9uKFwiYXR0cmlidXRlTGFiZWxcIik7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoaGVscElkKSB7XG4gICAgICAgICAgdGhpcy4kZWwuYXBwZW5kKFxuICAgICAgICAgICAgTXVzdGFjaGUucmVuZGVyKFxuICAgICAgICAgICAgICAnPHNwYW4gY2xhc3M9XCJkY3BMYWJlbF9fdGV4dFwiPnt7bGFiZWx9fSA8YSBjbGFzcz1cImRjcExhYmVsX19oZWxwX19saW5rXCIgaHJlZj1cIiNhY3Rpb24vZG9jdW1lbnQuaGVscDp7e2hlbHBJZH19Ont7YXR0cmlkfX1cIj48c3BhbiBjbGFzcz1cImZhIGZhLXF1ZXN0aW9uLWNpcmNsZVwiPjwvc3Bhbj48L2E+PC9zcGFuPicsXG4gICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBoZWxwSWQ6IGhlbHBJZCxcbiAgICAgICAgICAgICAgICBhdHRyaWQ6IHRoaXMubW9kZWwuaWQsXG4gICAgICAgICAgICAgICAgbGFiZWw6IGxhYmVsXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIClcbiAgICAgICAgICApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMuJGVsLmh0bWwoJCgnPHNwYW4gY2xhc3M9XCJkY3BMYWJlbF9fdGV4dFwiIC8+JykudGV4dChsYWJlbCkpO1xuICAgICAgICB9XG5cbiAgICAgICAgYXR0cmlidXRlVGVtcGxhdGUuaW5zZXJ0RGVzY3JpcHRpb24odGhpcyk7XG4gICAgICAgIGlmICh0b29sdGlwTGFiZWwpIHtcbiAgICAgICAgICB0b29sdGlwTGFiZWwgPSBNdXN0YWNoZS5yZW5kZXIodG9vbHRpcExhYmVsIHx8IFwiXCIsIGF0dHJEYXRhKTtcbiAgICAgICAgICBpZiAoIXRoaXMubW9kZWwuZ2V0T3B0aW9uKFwidG9vbHRpcEh0bWxcIikpIHtcbiAgICAgICAgICAgIC8vIE5lZWQgZW5jb2RlIGl0c2VsZiBiZWNhdXNlIHRoZSBkcm9wc2VsZWN0IHRvb2x0aXAgYWxzbyBuZWVkXG4gICAgICAgICAgICB0b29sdGlwTGFiZWwgPSAkKFwiPGRpdi8+XCIpXG4gICAgICAgICAgICAgIC50ZXh0KHRvb2x0aXBMYWJlbClcbiAgICAgICAgICAgICAgLmh0bWwoKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgdGhpcy4kZWwuZGF0YShcbiAgICAgICAgICAgIFwidG9vbHRpcExhYmVsXCIsXG4gICAgICAgICAgICBNdXN0YWNoZS5yZW5kZXIodG9vbHRpcExhYmVsIHx8IFwiXCIsIGF0dHJEYXRhKVxuICAgICAgICAgICk7XG4gICAgICAgICAgdGhpcy4kZWwudG9vbHRpcCh7XG4gICAgICAgICAgICBwbGFjZW1lbnQ6IFwidG9wXCIsXG4gICAgICAgICAgICBjb250YWluZXI6IFwiLmRjcERvY3VtZW50XCIsXG4gICAgICAgICAgICBodG1sOiB0cnVlLFxuICAgICAgICAgICAgdGl0bGU6IGZ1bmN0aW9uIHZEb2N1bWVudFRvb2x0aXBUaXRsZSgpIHtcbiAgICAgICAgICAgICAgaWYgKCQodGhpcykuZmluZChcIi5rLWlucHV0LmRjcFRhYl9fbGFiZWxfX3NlbGVjdFwiKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgLy8gSXQgaXMgYSBzZWxlY3RlZCBUYWJcbiAgICAgICAgICAgICAgICByZXR1cm4gJCh0aGlzKS5kYXRhKFwidG9vbHRpcExhYmVsU2VsZWN0XCIpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIHJldHVybiAkKHRoaXMpLmRhdGEoXCJ0b29sdGlwTGFiZWxcIik7IC8vIHNldCB0aGUgZWxlbWVudCB0ZXh0IGFzIGNvbnRlbnQgb2YgdGhlIHRvb2x0aXBcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICB0aGlzLiRlbC5hdHRyKFwiZGF0YS1hdHRyaWRcIiwgdGhpcy5tb2RlbC5pZCk7XG5cbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICBzZXRFcnJvcjogZnVuY3Rpb24gdlRhYkxhYmVsX3NldEVycm9yKGV2ZW50LCBkYXRhKSB7XG4gICAgICB0aGlzLm1vZGVsLnRyaWdnZXIoXCJhdHRyaWJ1dGVUYWJDaGFuZ2VcIiwgZXZlbnQsIHRoaXMubW9kZWwuaWQsIHRoaXMuJGVsLCB7XG4gICAgICAgIGVycm9yOiBkYXRhXG4gICAgICB9KTtcbiAgICAgIGlmIChldmVudC5wcmV2ZW50KSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgIHRoaXMuJGVsLmFkZENsYXNzKFwiaGFzLWVycm9yXCIpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy4kZWwucmVtb3ZlQ2xhc3MoXCJoYXMtZXJyb3JcIik7XG4gICAgICB9XG4gICAgfSxcblxuICAgIHVwZGF0ZUxhYmVsOiBmdW5jdGlvbiB2VGFiTGFiZWxfdXBkYXRlTGFiZWwoKSB7XG4gICAgICB0aGlzLm1vZGVsLnRyaWdnZXIoXG4gICAgICAgIFwiYXR0cmlidXRlVGFiQ2hhbmdlXCIsXG4gICAgICAgIGV2ZW50LFxuICAgICAgICB0aGlzLm1vZGVsLmlkLFxuICAgICAgICB0aGlzLiRlbCxcbiAgICAgICAge31cbiAgICAgICk7XG4gICAgICB0aGlzLiRlbC50ZXh0KHRoaXMubW9kZWwuZ2V0KFwibGFiZWxcIikpO1xuICAgIH0sXG5cbiAgICBoaWRlOiBmdW5jdGlvbiB2VGFiTGFiZWxfaGlkZSgpIHtcbiAgICAgIHRoaXMuJGVsLmhpZGUoKTtcbiAgICB9LFxuXG4gICAgc2hvdzogZnVuY3Rpb24gdlRhYkxhYmVsX3Nob3coKSB7XG4gICAgICB0aGlzLiRlbC5zaG93KCk7XG4gICAgfSxcblxuICAgIGV4dGVybmFsTGlua1NlbGVjdGVkOiBmdW5jdGlvbiB2QXR0cmlidXRlRXh0ZXJuYWxMaW5rU2VsZWN0ZWQoZXZlbnQpIHtcbiAgICAgIHZhciAkdGFyZ2V0ID0gJChldmVudC5jdXJyZW50VGFyZ2V0KSxcbiAgICAgICAgYWN0aW9uLFxuICAgICAgICBvcHRpb25zLFxuICAgICAgICBldmVudE9wdGlvbnMsXG4gICAgICAgIGRvY3VtZW50TW9kZWwsXG4gICAgICAgIGludGVybmFsRXZlbnQgPSB7XG4gICAgICAgICAgcHJldmVudDogZmFsc2VcbiAgICAgICAgfTtcblxuICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgIGlmIChldmVudC5zdG9wUHJvcGFnYXRpb24pIHtcbiAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICB9XG5cbiAgICAgIGFjdGlvbiA9ICR0YXJnZXQuZGF0YShcImFjdGlvblwiKSB8fCAkdGFyZ2V0LmF0dHIoXCJocmVmXCIpO1xuICAgICAgb3B0aW9ucyA9IGFjdGlvbi5zdWJzdHJpbmcoOCkuc3BsaXQoXCI6XCIpO1xuICAgICAgZXZlbnRPcHRpb25zID0ge1xuICAgICAgICB0YXJnZXQ6IGV2ZW50LnRhcmdldCxcbiAgICAgICAgaW5kZXg6IC0xLFxuICAgICAgICBldmVudElkOiBvcHRpb25zLnNoaWZ0KCksXG4gICAgICAgIG9wdGlvbnM6IG9wdGlvbnNcbiAgICAgIH07XG4gICAgICBkb2N1bWVudE1vZGVsID0gdGhpcy5tb2RlbC5nZXREb2N1bWVudE1vZGVsKCk7XG5cbiAgICAgIHRoaXMubW9kZWwudHJpZ2dlcihcImludGVybmFsTGlua1NlbGVjdGVkXCIsIGludGVybmFsRXZlbnQsIGV2ZW50T3B0aW9ucyk7XG4gICAgICBpZiAoZXZlbnQucHJldmVudCkge1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgIH1cblxuICAgICAgZG9jdW1lbnRNb2RlbC50cmlnZ2VyKFwiYWN0aW9uQXR0cmlidXRlTGlua1wiLCBpbnRlcm5hbEV2ZW50LCBvcHRpb25zKTtcblxuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICB9KTtcbn0pO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///4eae4dcce004a8d344d8\n");

/***/ }),

/***/ "512dac7279589ee7db96":
/*!**************************************************************!*\
  !*** ./src/Apps/DOCUMENT/IHM/models/mAttributeStructural.js ***!
  \**************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;!(__WEBPACK_AMD_DEFINE_ARRAY__ = [\n  __webpack_require__(/*! underscore */ \"8e08e542008e4aef1f58\"),\n  __webpack_require__(/*! dcpDocument/models/mAttribute */ \"0a26bdc45fd66878f3b9\"),\n  __webpack_require__(/*! dcpDocument/collections/contentAttributes */ \"72eda5b0d863ce233971\")\n], __WEBPACK_AMD_DEFINE_RESULT__ = (function(_, AttributeModel, CollectionContentAttributes) {\n  \"use strict\";\n\n  return AttributeModel.extend({\n    typeModel: \"ddui:structureAttribute\",\n    defaults: {\n      content: []\n    },\n\n    setContentCollection: function mAttributesetContentCollection(attributes) {\n      var collection = new CollectionContentAttributes();\n      _.each(attributes, function(currentChild) {\n        collection.push(currentChild);\n      });\n      this.set(\"content\", collection);\n    }\n  });\n}).apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNTEyZGFjNzI3OTU4OWVlN2RiOTYuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvQXBwcy9ET0NVTUVOVC9JSE0vbW9kZWxzL21BdHRyaWJ1dGVTdHJ1Y3R1cmFsLmpzPzg3ZmIiXSwic291cmNlc0NvbnRlbnQiOlsiZGVmaW5lKFtcbiAgXCJ1bmRlcnNjb3JlXCIsXG4gIFwiZGNwRG9jdW1lbnQvbW9kZWxzL21BdHRyaWJ1dGVcIixcbiAgXCJkY3BEb2N1bWVudC9jb2xsZWN0aW9ucy9jb250ZW50QXR0cmlidXRlc1wiXG5dLCBmdW5jdGlvbihfLCBBdHRyaWJ1dGVNb2RlbCwgQ29sbGVjdGlvbkNvbnRlbnRBdHRyaWJ1dGVzKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIHJldHVybiBBdHRyaWJ1dGVNb2RlbC5leHRlbmQoe1xuICAgIHR5cGVNb2RlbDogXCJkZHVpOnN0cnVjdHVyZUF0dHJpYnV0ZVwiLFxuICAgIGRlZmF1bHRzOiB7XG4gICAgICBjb250ZW50OiBbXVxuICAgIH0sXG5cbiAgICBzZXRDb250ZW50Q29sbGVjdGlvbjogZnVuY3Rpb24gbUF0dHJpYnV0ZXNldENvbnRlbnRDb2xsZWN0aW9uKGF0dHJpYnV0ZXMpIHtcbiAgICAgIHZhciBjb2xsZWN0aW9uID0gbmV3IENvbGxlY3Rpb25Db250ZW50QXR0cmlidXRlcygpO1xuICAgICAgXy5lYWNoKGF0dHJpYnV0ZXMsIGZ1bmN0aW9uKGN1cnJlbnRDaGlsZCkge1xuICAgICAgICBjb2xsZWN0aW9uLnB1c2goY3VycmVudENoaWxkKTtcbiAgICAgIH0pO1xuICAgICAgdGhpcy5zZXQoXCJjb250ZW50XCIsIGNvbGxlY3Rpb24pO1xuICAgIH1cbiAgfSk7XG59KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///512dac7279589ee7db96\n");

/***/ }),

/***/ "568d4145cebb6959279c":
/*!****************************************************************!*\
  !*** ./src/Apps/DOCUMENT/IHM/widgets/attributes/time/wTime.js ***!
  \****************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;(function umdRequire(root, factory) {\n  \"use strict\";\n\n  if (true) {\n    !(__WEBPACK_AMD_DEFINE_ARRAY__ = [\n      __webpack_require__(/*! jquery */ \"127c8cf59f228bb01a21\"),\n      __webpack_require__(/*! underscore */ \"8e08e542008e4aef1f58\"),\n      __webpack_require__(/*! dcpDocument/widgets/attributes/date/wDate */ \"bd13ec831aaf61fba460\")\n    ], __WEBPACK_AMD_DEFINE_FACTORY__ = (factory),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?\n\t\t\t\t(__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n  } else {}\n})(window, function($, _) {\n  \"use strict\";\n\n  $.widget(\"dcp.dcpTime\", $.dcp.dcpDate, {\n    options: {\n      type: \"time\",\n      renderOptions: {\n        kendoTimeConfiguration: {\n          timeDataFormat: [\"HH:mm\", \"HH:mm:ss\"]\n        }\n      }\n    },\n\n    kendoWidgetClass: \"kendoTimePicker\",\n\n    _initDom: function wTimeInitDom() {\n      if (this.options.renderOptions.kendoTimeConfiguration.format) {\n        this.options.attributeValue.displayValue = this.formatDate(\n          this.parseDate(this.options.attributeValue.value)\n        );\n      }\n      this._super();\n    },\n\n    _activateDate: function wTimeActivateDate(inputValue) {\n      var scope = this;\n      var kOptions = this.getKendoOptions();\n\n      kOptions.change = function() {\n        // only valid date are setted\n        // wrong date are set by blur event\n        var isoDate = scope.convertDateToPseudoIsoString(this.value());\n        // Need to set by widget to use raw date\n\n        scope.setValue({ value: isoDate, displayValue: inputValue.val() });\n      };\n      inputValue.kendoTimePicker(kOptions);\n      this._controlDate(inputValue);\n      if (this.options.attributeValue && this.options.attributeValue.value) {\n        this.setValue(this.options.attributeValue);\n      }\n    },\n\n    setValue: function wTimeSetValue(value) {\n      var originalValue;\n\n      value = _.clone(value);\n\n      if (_.has(value, \"value\") && !_.has(value, \"displayValue\")) {\n        value.displayValue = this.formatDate(this.parseDate(value.value));\n      }\n\n      $.dcp.dcpAttribute.prototype.setValue.call(this, value);\n\n      if (this.getMode() === \"write\") {\n        originalValue = this.convertDateToPseudoIsoString(\n          this.kendoWidget.data(this.kendoWidgetClass).value()\n        );\n        // : explicit lazy equal\n        //noinspection JSHint\n        if (originalValue != value.value) {\n          if (value.value) {\n            this.kendoWidget.data(this.kendoWidgetClass).value(value.value);\n          } else {\n            this.getContentElements().val(\"\");\n          }\n          // Modify value only if different\n          this.flashElement();\n        }\n      } else if (this.getMode() === \"read\") {\n        this.getContentElements().text(value.displayValue);\n      } else {\n        throw new Error(\n          \"Attribute \" + this.options.id + \" unkown mode \" + this.getMode()\n        );\n      }\n    },\n\n    getValue: function wTimeGetValue() {\n      var value = this._super();\n      if (value.value && _.isDate(value.value)) {\n        value.value = this.convertDateToPseudoIsoString(value.value);\n      }\n      return value;\n    },\n\n    convertDateToPseudoIsoString: function wTimeConvertDateToPseudoIsoString(\n      date\n    ) {\n      if (_.isDate(date)) {\n        return (\n          this.padNumber(date.getHours()) +\n          \":\" +\n          this.padNumber(date.getMinutes())\n        );\n      }\n      return \"\";\n    },\n\n    formatDate: function wTimeFormatDate(value) {\n      if (this.options.renderOptions.kendoTimeConfiguration.format) {\n        return kendo.toString(\n          value,\n          this.options.renderOptions.kendoTimeConfiguration.format\n        );\n      }\n      return kendo.toString(value, \"T\");\n    },\n\n    parseDate: function wTimeParseDate(value) {\n      return kendo.parseDate(\n        value,\n        this.options.renderOptions.kendoTimeConfiguration.timeDataFormat\n      );\n    },\n\n    /**\n     * Get kendo option from normal options and from renderOptions.kendoNumeric\n     * @returns {*}\n     */\n    getKendoOptions: function wTimegetKendoOptions() {\n      var scope = this,\n        kendoOptions = {},\n        defaultOptions = {\n          min: this.options.minDate\n        };\n\n      if (_.isObject(scope.options.renderOptions.kendoTimeConfiguration)) {\n        kendoOptions = scope.options.renderOptions.kendoTimeConfiguration;\n      }\n\n      return _.extend(defaultOptions, kendoOptions);\n    },\n\n    getType: function() {\n      return \"time\";\n    }\n  });\n\n  return $.fn.dcpTime;\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNTY4ZDQxNDVjZWJiNjk1OTI3OWMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvQXBwcy9ET0NVTUVOVC9JSE0vd2lkZ2V0cy9hdHRyaWJ1dGVzL3RpbWUvd1RpbWUuanM/ZmQzNCJdLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gdW1kUmVxdWlyZShyb290LCBmYWN0b3J5KSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIGlmICh0eXBlb2YgZGVmaW5lID09PSBcImZ1bmN0aW9uXCIgJiYgZGVmaW5lLmFtZCkge1xuICAgIGRlZmluZShbXG4gICAgICBcImpxdWVyeVwiLFxuICAgICAgXCJ1bmRlcnNjb3JlXCIsXG4gICAgICBcImRjcERvY3VtZW50L3dpZGdldHMvYXR0cmlidXRlcy9kYXRlL3dEYXRlXCJcbiAgICBdLCBmYWN0b3J5KTtcbiAgfSBlbHNlIHtcbiAgICAvL25vaW5zcGVjdGlvbiBKU1VucmVzb2x2ZWRWYXJpYWJsZVxuICAgIGZhY3Rvcnkod2luZG93LmpRdWVyeSwgd2luZG93Ll8pO1xuICB9XG59KSh3aW5kb3csIGZ1bmN0aW9uKCQsIF8pIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgJC53aWRnZXQoXCJkY3AuZGNwVGltZVwiLCAkLmRjcC5kY3BEYXRlLCB7XG4gICAgb3B0aW9uczoge1xuICAgICAgdHlwZTogXCJ0aW1lXCIsXG4gICAgICByZW5kZXJPcHRpb25zOiB7XG4gICAgICAgIGtlbmRvVGltZUNvbmZpZ3VyYXRpb246IHtcbiAgICAgICAgICB0aW1lRGF0YUZvcm1hdDogW1wiSEg6bW1cIiwgXCJISDptbTpzc1wiXVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcblxuICAgIGtlbmRvV2lkZ2V0Q2xhc3M6IFwia2VuZG9UaW1lUGlja2VyXCIsXG5cbiAgICBfaW5pdERvbTogZnVuY3Rpb24gd1RpbWVJbml0RG9tKCkge1xuICAgICAgaWYgKHRoaXMub3B0aW9ucy5yZW5kZXJPcHRpb25zLmtlbmRvVGltZUNvbmZpZ3VyYXRpb24uZm9ybWF0KSB7XG4gICAgICAgIHRoaXMub3B0aW9ucy5hdHRyaWJ1dGVWYWx1ZS5kaXNwbGF5VmFsdWUgPSB0aGlzLmZvcm1hdERhdGUoXG4gICAgICAgICAgdGhpcy5wYXJzZURhdGUodGhpcy5vcHRpb25zLmF0dHJpYnV0ZVZhbHVlLnZhbHVlKVxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgdGhpcy5fc3VwZXIoKTtcbiAgICB9LFxuXG4gICAgX2FjdGl2YXRlRGF0ZTogZnVuY3Rpb24gd1RpbWVBY3RpdmF0ZURhdGUoaW5wdXRWYWx1ZSkge1xuICAgICAgdmFyIHNjb3BlID0gdGhpcztcbiAgICAgIHZhciBrT3B0aW9ucyA9IHRoaXMuZ2V0S2VuZG9PcHRpb25zKCk7XG5cbiAgICAgIGtPcHRpb25zLmNoYW5nZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAvLyBvbmx5IHZhbGlkIGRhdGUgYXJlIHNldHRlZFxuICAgICAgICAvLyB3cm9uZyBkYXRlIGFyZSBzZXQgYnkgYmx1ciBldmVudFxuICAgICAgICB2YXIgaXNvRGF0ZSA9IHNjb3BlLmNvbnZlcnREYXRlVG9Qc2V1ZG9Jc29TdHJpbmcodGhpcy52YWx1ZSgpKTtcbiAgICAgICAgLy8gTmVlZCB0byBzZXQgYnkgd2lkZ2V0IHRvIHVzZSByYXcgZGF0ZVxuXG4gICAgICAgIHNjb3BlLnNldFZhbHVlKHsgdmFsdWU6IGlzb0RhdGUsIGRpc3BsYXlWYWx1ZTogaW5wdXRWYWx1ZS52YWwoKSB9KTtcbiAgICAgIH07XG4gICAgICBpbnB1dFZhbHVlLmtlbmRvVGltZVBpY2tlcihrT3B0aW9ucyk7XG4gICAgICB0aGlzLl9jb250cm9sRGF0ZShpbnB1dFZhbHVlKTtcbiAgICAgIGlmICh0aGlzLm9wdGlvbnMuYXR0cmlidXRlVmFsdWUgJiYgdGhpcy5vcHRpb25zLmF0dHJpYnV0ZVZhbHVlLnZhbHVlKSB7XG4gICAgICAgIHRoaXMuc2V0VmFsdWUodGhpcy5vcHRpb25zLmF0dHJpYnV0ZVZhbHVlKTtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgc2V0VmFsdWU6IGZ1bmN0aW9uIHdUaW1lU2V0VmFsdWUodmFsdWUpIHtcbiAgICAgIHZhciBvcmlnaW5hbFZhbHVlO1xuXG4gICAgICB2YWx1ZSA9IF8uY2xvbmUodmFsdWUpO1xuXG4gICAgICBpZiAoXy5oYXModmFsdWUsIFwidmFsdWVcIikgJiYgIV8uaGFzKHZhbHVlLCBcImRpc3BsYXlWYWx1ZVwiKSkge1xuICAgICAgICB2YWx1ZS5kaXNwbGF5VmFsdWUgPSB0aGlzLmZvcm1hdERhdGUodGhpcy5wYXJzZURhdGUodmFsdWUudmFsdWUpKTtcbiAgICAgIH1cblxuICAgICAgJC5kY3AuZGNwQXR0cmlidXRlLnByb3RvdHlwZS5zZXRWYWx1ZS5jYWxsKHRoaXMsIHZhbHVlKTtcblxuICAgICAgaWYgKHRoaXMuZ2V0TW9kZSgpID09PSBcIndyaXRlXCIpIHtcbiAgICAgICAgb3JpZ2luYWxWYWx1ZSA9IHRoaXMuY29udmVydERhdGVUb1BzZXVkb0lzb1N0cmluZyhcbiAgICAgICAgICB0aGlzLmtlbmRvV2lkZ2V0LmRhdGEodGhpcy5rZW5kb1dpZGdldENsYXNzKS52YWx1ZSgpXG4gICAgICAgICk7XG4gICAgICAgIC8vIDogZXhwbGljaXQgbGF6eSBlcXVhbFxuICAgICAgICAvL25vaW5zcGVjdGlvbiBKU0hpbnRcbiAgICAgICAgaWYgKG9yaWdpbmFsVmFsdWUgIT0gdmFsdWUudmFsdWUpIHtcbiAgICAgICAgICBpZiAodmFsdWUudmFsdWUpIHtcbiAgICAgICAgICAgIHRoaXMua2VuZG9XaWRnZXQuZGF0YSh0aGlzLmtlbmRvV2lkZ2V0Q2xhc3MpLnZhbHVlKHZhbHVlLnZhbHVlKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5nZXRDb250ZW50RWxlbWVudHMoKS52YWwoXCJcIik7XG4gICAgICAgICAgfVxuICAgICAgICAgIC8vIE1vZGlmeSB2YWx1ZSBvbmx5IGlmIGRpZmZlcmVudFxuICAgICAgICAgIHRoaXMuZmxhc2hFbGVtZW50KCk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAodGhpcy5nZXRNb2RlKCkgPT09IFwicmVhZFwiKSB7XG4gICAgICAgIHRoaXMuZ2V0Q29udGVudEVsZW1lbnRzKCkudGV4dCh2YWx1ZS5kaXNwbGF5VmFsdWUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgIFwiQXR0cmlidXRlIFwiICsgdGhpcy5vcHRpb25zLmlkICsgXCIgdW5rb3duIG1vZGUgXCIgKyB0aGlzLmdldE1vZGUoKVxuICAgICAgICApO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICBnZXRWYWx1ZTogZnVuY3Rpb24gd1RpbWVHZXRWYWx1ZSgpIHtcbiAgICAgIHZhciB2YWx1ZSA9IHRoaXMuX3N1cGVyKCk7XG4gICAgICBpZiAodmFsdWUudmFsdWUgJiYgXy5pc0RhdGUodmFsdWUudmFsdWUpKSB7XG4gICAgICAgIHZhbHVlLnZhbHVlID0gdGhpcy5jb252ZXJ0RGF0ZVRvUHNldWRvSXNvU3RyaW5nKHZhbHVlLnZhbHVlKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB2YWx1ZTtcbiAgICB9LFxuXG4gICAgY29udmVydERhdGVUb1BzZXVkb0lzb1N0cmluZzogZnVuY3Rpb24gd1RpbWVDb252ZXJ0RGF0ZVRvUHNldWRvSXNvU3RyaW5nKFxuICAgICAgZGF0ZVxuICAgICkge1xuICAgICAgaWYgKF8uaXNEYXRlKGRhdGUpKSB7XG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgdGhpcy5wYWROdW1iZXIoZGF0ZS5nZXRIb3VycygpKSArXG4gICAgICAgICAgXCI6XCIgK1xuICAgICAgICAgIHRoaXMucGFkTnVtYmVyKGRhdGUuZ2V0TWludXRlcygpKVxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgcmV0dXJuIFwiXCI7XG4gICAgfSxcblxuICAgIGZvcm1hdERhdGU6IGZ1bmN0aW9uIHdUaW1lRm9ybWF0RGF0ZSh2YWx1ZSkge1xuICAgICAgaWYgKHRoaXMub3B0aW9ucy5yZW5kZXJPcHRpb25zLmtlbmRvVGltZUNvbmZpZ3VyYXRpb24uZm9ybWF0KSB7XG4gICAgICAgIHJldHVybiBrZW5kby50b1N0cmluZyhcbiAgICAgICAgICB2YWx1ZSxcbiAgICAgICAgICB0aGlzLm9wdGlvbnMucmVuZGVyT3B0aW9ucy5rZW5kb1RpbWVDb25maWd1cmF0aW9uLmZvcm1hdFxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGtlbmRvLnRvU3RyaW5nKHZhbHVlLCBcIlRcIik7XG4gICAgfSxcblxuICAgIHBhcnNlRGF0ZTogZnVuY3Rpb24gd1RpbWVQYXJzZURhdGUodmFsdWUpIHtcbiAgICAgIHJldHVybiBrZW5kby5wYXJzZURhdGUoXG4gICAgICAgIHZhbHVlLFxuICAgICAgICB0aGlzLm9wdGlvbnMucmVuZGVyT3B0aW9ucy5rZW5kb1RpbWVDb25maWd1cmF0aW9uLnRpbWVEYXRhRm9ybWF0XG4gICAgICApO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBHZXQga2VuZG8gb3B0aW9uIGZyb20gbm9ybWFsIG9wdGlvbnMgYW5kIGZyb20gcmVuZGVyT3B0aW9ucy5rZW5kb051bWVyaWNcbiAgICAgKiBAcmV0dXJucyB7Kn1cbiAgICAgKi9cbiAgICBnZXRLZW5kb09wdGlvbnM6IGZ1bmN0aW9uIHdUaW1lZ2V0S2VuZG9PcHRpb25zKCkge1xuICAgICAgdmFyIHNjb3BlID0gdGhpcyxcbiAgICAgICAga2VuZG9PcHRpb25zID0ge30sXG4gICAgICAgIGRlZmF1bHRPcHRpb25zID0ge1xuICAgICAgICAgIG1pbjogdGhpcy5vcHRpb25zLm1pbkRhdGVcbiAgICAgICAgfTtcblxuICAgICAgaWYgKF8uaXNPYmplY3Qoc2NvcGUub3B0aW9ucy5yZW5kZXJPcHRpb25zLmtlbmRvVGltZUNvbmZpZ3VyYXRpb24pKSB7XG4gICAgICAgIGtlbmRvT3B0aW9ucyA9IHNjb3BlLm9wdGlvbnMucmVuZGVyT3B0aW9ucy5rZW5kb1RpbWVDb25maWd1cmF0aW9uO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gXy5leHRlbmQoZGVmYXVsdE9wdGlvbnMsIGtlbmRvT3B0aW9ucyk7XG4gICAgfSxcblxuICAgIGdldFR5cGU6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIFwidGltZVwiO1xuICAgIH1cbiAgfSk7XG5cbiAgcmV0dXJuICQuZm4uZGNwVGltZTtcbn0pO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFDQSxXQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///568d4145cebb6959279c\n");

/***/ }),

/***/ "570ca0403ab6bea71f8b":
/*!**********************************************************!*\
  !*** ./src/Apps/DOCUMENT/IHM/widgets/window/wLoading.js ***!
  \**********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(/*! jquery */ \"127c8cf59f228bb01a21\"), __webpack_require__(/*! dcpDocument/widgets/widget */ \"f562ab9f022eef93542c\")], __WEBPACK_AMD_DEFINE_RESULT__ = (function($) {\n  \"use strict\";\n\n  $.widget(\"dcp.dcpLoading\", {\n    pc: 0,\n    rest: 0,\n    restItem: 0,\n    currentWidget: null,\n    doneItems: 0,\n    original: null,\n\n    _create: function dcpLoading_create() {\n      this.stack = 0;\n      this.initBar = this.element.find(\".progress\");\n      this.$title = this.element.find(\".dcpLoading--title\");\n      this.$header = this.element.find(\".dcpLoading--header\");\n    },\n\n    reset: function dcpLoadingReset() {\n      this.initBar.show();\n    },\n\n    setTitle: function dcpLoadingsetTitle(val) {\n      this.element.find(\".dcpLoading--title\").html(val);\n    },\n\n    isDisplayed: function dcpLoadingIsDisplayed() {\n      return this.stack > 0;\n    },\n\n    hide: function dcpLoadinghide(force) {\n      this.stack -= 1;\n      if (!force && this.stack > 0) {\n        return this;\n      }\n      this.stack = 0;\n      this.element.hide();\n      this.element.removeClass(\"dcpLoading--hide\");\n      this.setPercent(0);\n    },\n\n    show: function dcpLoadingshow(text, pc) {\n      this.stack += 1;\n      if (text) {\n        this.setLabel(text);\n      }\n      if (pc) {\n        this.setPercent(pc);\n      }\n      this.element.show();\n      this.$header.show().removeClass(\"dcpLoading--hide\");\n    },\n\n    setLabel: function dcpLoadingsetLabel(text) {\n      if (text) {\n        this.$title.text(text);\n      } else {\n        this.$header.addClass(\"dcpLoading--hide\");\n      }\n    },\n\n    setPercent: function dcpLoadingsetPercent(pc) {\n      var $initbar = this.initBar.find(\".progress-bar\");\n      var rpc = Math.round(pc);\n      this.pc = pc;\n      if (window && window.requestAnimationFrame) {\n        window.requestAnimationFrame(function() {\n          $initbar.css(\"width\", rpc + \"%\");\n        });\n      }\n    },\n\n    setNbItem: function dcpLoadingSetNbItem(restItem) {\n      this.rest = 100 - this.pc;\n      this.restItem = restItem;\n    },\n\n    addItem: function dcpLoadingAddItem(number) {\n      number = number || 1;\n      number = parseInt(number, 10);\n      this.doneItems += number;\n      var pv = (this.rest / this.restItem) * number;\n      this.setPercent(this.pc + pv);\n    },\n\n    _destroy: function dcpLoading_destroy() {\n      this._trigger(\"destroy\");\n      this._super();\n    }\n  });\n}).apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNTcwY2EwNDAzYWI2YmVhNzFmOGIuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvQXBwcy9ET0NVTUVOVC9JSE0vd2lkZ2V0cy93aW5kb3cvd0xvYWRpbmcuanM/NTcyNCJdLCJzb3VyY2VzQ29udGVudCI6WyJkZWZpbmUoW1wianF1ZXJ5XCIsIFwiZGNwRG9jdW1lbnQvd2lkZ2V0cy93aWRnZXRcIl0sIGZ1bmN0aW9uKCQpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgJC53aWRnZXQoXCJkY3AuZGNwTG9hZGluZ1wiLCB7XG4gICAgcGM6IDAsXG4gICAgcmVzdDogMCxcbiAgICByZXN0SXRlbTogMCxcbiAgICBjdXJyZW50V2lkZ2V0OiBudWxsLFxuICAgIGRvbmVJdGVtczogMCxcbiAgICBvcmlnaW5hbDogbnVsbCxcblxuICAgIF9jcmVhdGU6IGZ1bmN0aW9uIGRjcExvYWRpbmdfY3JlYXRlKCkge1xuICAgICAgdGhpcy5zdGFjayA9IDA7XG4gICAgICB0aGlzLmluaXRCYXIgPSB0aGlzLmVsZW1lbnQuZmluZChcIi5wcm9ncmVzc1wiKTtcbiAgICAgIHRoaXMuJHRpdGxlID0gdGhpcy5lbGVtZW50LmZpbmQoXCIuZGNwTG9hZGluZy0tdGl0bGVcIik7XG4gICAgICB0aGlzLiRoZWFkZXIgPSB0aGlzLmVsZW1lbnQuZmluZChcIi5kY3BMb2FkaW5nLS1oZWFkZXJcIik7XG4gICAgfSxcblxuICAgIHJlc2V0OiBmdW5jdGlvbiBkY3BMb2FkaW5nUmVzZXQoKSB7XG4gICAgICB0aGlzLmluaXRCYXIuc2hvdygpO1xuICAgIH0sXG5cbiAgICBzZXRUaXRsZTogZnVuY3Rpb24gZGNwTG9hZGluZ3NldFRpdGxlKHZhbCkge1xuICAgICAgdGhpcy5lbGVtZW50LmZpbmQoXCIuZGNwTG9hZGluZy0tdGl0bGVcIikuaHRtbCh2YWwpO1xuICAgIH0sXG5cbiAgICBpc0Rpc3BsYXllZDogZnVuY3Rpb24gZGNwTG9hZGluZ0lzRGlzcGxheWVkKCkge1xuICAgICAgcmV0dXJuIHRoaXMuc3RhY2sgPiAwO1xuICAgIH0sXG5cbiAgICBoaWRlOiBmdW5jdGlvbiBkY3BMb2FkaW5naGlkZShmb3JjZSkge1xuICAgICAgdGhpcy5zdGFjayAtPSAxO1xuICAgICAgaWYgKCFmb3JjZSAmJiB0aGlzLnN0YWNrID4gMCkge1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgIH1cbiAgICAgIHRoaXMuc3RhY2sgPSAwO1xuICAgICAgdGhpcy5lbGVtZW50LmhpZGUoKTtcbiAgICAgIHRoaXMuZWxlbWVudC5yZW1vdmVDbGFzcyhcImRjcExvYWRpbmctLWhpZGVcIik7XG4gICAgICB0aGlzLnNldFBlcmNlbnQoMCk7XG4gICAgfSxcblxuICAgIHNob3c6IGZ1bmN0aW9uIGRjcExvYWRpbmdzaG93KHRleHQsIHBjKSB7XG4gICAgICB0aGlzLnN0YWNrICs9IDE7XG4gICAgICBpZiAodGV4dCkge1xuICAgICAgICB0aGlzLnNldExhYmVsKHRleHQpO1xuICAgICAgfVxuICAgICAgaWYgKHBjKSB7XG4gICAgICAgIHRoaXMuc2V0UGVyY2VudChwYyk7XG4gICAgICB9XG4gICAgICB0aGlzLmVsZW1lbnQuc2hvdygpO1xuICAgICAgdGhpcy4kaGVhZGVyLnNob3coKS5yZW1vdmVDbGFzcyhcImRjcExvYWRpbmctLWhpZGVcIik7XG4gICAgfSxcblxuICAgIHNldExhYmVsOiBmdW5jdGlvbiBkY3BMb2FkaW5nc2V0TGFiZWwodGV4dCkge1xuICAgICAgaWYgKHRleHQpIHtcbiAgICAgICAgdGhpcy4kdGl0bGUudGV4dCh0ZXh0KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuJGhlYWRlci5hZGRDbGFzcyhcImRjcExvYWRpbmctLWhpZGVcIik7XG4gICAgICB9XG4gICAgfSxcblxuICAgIHNldFBlcmNlbnQ6IGZ1bmN0aW9uIGRjcExvYWRpbmdzZXRQZXJjZW50KHBjKSB7XG4gICAgICB2YXIgJGluaXRiYXIgPSB0aGlzLmluaXRCYXIuZmluZChcIi5wcm9ncmVzcy1iYXJcIik7XG4gICAgICB2YXIgcnBjID0gTWF0aC5yb3VuZChwYyk7XG4gICAgICB0aGlzLnBjID0gcGM7XG4gICAgICBpZiAod2luZG93ICYmIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUpIHtcbiAgICAgICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZShmdW5jdGlvbigpIHtcbiAgICAgICAgICAkaW5pdGJhci5jc3MoXCJ3aWR0aFwiLCBycGMgKyBcIiVcIik7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICBzZXROYkl0ZW06IGZ1bmN0aW9uIGRjcExvYWRpbmdTZXROYkl0ZW0ocmVzdEl0ZW0pIHtcbiAgICAgIHRoaXMucmVzdCA9IDEwMCAtIHRoaXMucGM7XG4gICAgICB0aGlzLnJlc3RJdGVtID0gcmVzdEl0ZW07XG4gICAgfSxcblxuICAgIGFkZEl0ZW06IGZ1bmN0aW9uIGRjcExvYWRpbmdBZGRJdGVtKG51bWJlcikge1xuICAgICAgbnVtYmVyID0gbnVtYmVyIHx8IDE7XG4gICAgICBudW1iZXIgPSBwYXJzZUludChudW1iZXIsIDEwKTtcbiAgICAgIHRoaXMuZG9uZUl0ZW1zICs9IG51bWJlcjtcbiAgICAgIHZhciBwdiA9ICh0aGlzLnJlc3QgLyB0aGlzLnJlc3RJdGVtKSAqIG51bWJlcjtcbiAgICAgIHRoaXMuc2V0UGVyY2VudCh0aGlzLnBjICsgcHYpO1xuICAgIH0sXG5cbiAgICBfZGVzdHJveTogZnVuY3Rpb24gZGNwTG9hZGluZ19kZXN0cm95KCkge1xuICAgICAgdGhpcy5fdHJpZ2dlcihcImRlc3Ryb3lcIik7XG4gICAgICB0aGlzLl9zdXBlcigpO1xuICAgIH1cbiAgfSk7XG59KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///570ca0403ab6bea71f8b\n");

/***/ }),

/***/ "593c8c94ba4399020f79":
/*!*******************************************************************!*\
  !*** ./src/Apps/DOCUMENT/IHM/views/document/attributeTemplate.js ***!
  \*******************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_RESULT__;/*global define*/\n!(__WEBPACK_AMD_DEFINE_RESULT__ = (function attributeTemplate(require /*, exports, module*/) {\n  \"use strict\";\n  var _ = __webpack_require__(/*! underscore */ \"8e08e542008e4aef1f58\");\n  var $ = __webpack_require__(/*! jquery */ \"127c8cf59f228bb01a21\");\n  var Mustache = __webpack_require__(/*! mustache */ \"bcd31d01884fc294fd69\");\n\n  return {\n    customLineTemplate: \"\",\n\n    /**\n     * Get some data to complete custom attribute template\n     * @param documentModel document model\n     * @returns {{properties: *, attributes: {}}}\n     * @public\n     */\n    getTemplateModelInfo: function attributeTemplateGetTemplateModelInfo(\n      documentModel\n    ) {\n      var documentData = documentModel.getDocumentData();\n      var templateInfo = {\n        properties: documentData.properties,\n        attributes: {}\n      };\n      var currentTemplate = this;\n\n      templateInfo.properties.isWriteMode =\n        templateInfo.properties.renderMode === \"edit\";\n      templateInfo.properties.isReadMode =\n        templateInfo.properties.renderMode === \"view\";\n\n      _.each(documentData.attributeValues, function associateValue(\n        attributeValue,\n        attributeId\n      ) {\n        templateInfo.attributes[attributeId] = {\n          attributeValue: attributeValue\n        };\n      });\n      _.each(\n        documentData.attributeLabels,\n        function attributeTemplategetTemplateModelInfoEach(\n          attributeLabel,\n          attributeId\n        ) {\n          var currentAttributeModel = documentModel\n            .get(\"attributes\")\n            .get(attributeId);\n          if (currentAttributeModel.getOption(\"attributeLabel\")) {\n            attributeLabel = currentAttributeModel.getOption(\"attributeLabel\");\n          }\n\n          if (templateInfo.attributes[attributeId]) {\n            templateInfo.attributes[attributeId].label = attributeLabel;\n          } else {\n            templateInfo.attributes[attributeId] = { label: attributeLabel };\n          }\n\n          templateInfo.attributes[attributeId].id = attributeId;\n          templateInfo.attributes[\n            attributeId\n          ].isEmpty = currentTemplate._isEmptyAttribute(currentAttributeModel);\n\n          templateInfo.attributes[attributeId].htmlContent = _.bind(\n            currentTemplate.getCustomTemplate,\n            currentTemplate,\n            currentAttributeModel,\n            false,\n            false\n          );\n          templateInfo.attributes[attributeId].htmlView = _.bind(\n            currentTemplate.getCustomTemplate,\n            currentTemplate,\n            currentAttributeModel,\n            true,\n            false\n          );\n          templateInfo.attributes[attributeId].htmlDefaultContent = _.bind(\n            currentTemplate.getCustomTemplate,\n            currentTemplate,\n            currentAttributeModel,\n            false,\n            true\n          );\n          templateInfo.attributes[attributeId].htmlDefaultView = _.bind(\n            currentTemplate.getCustomTemplate,\n            currentTemplate,\n            currentAttributeModel,\n            true,\n            true\n          );\n          templateInfo.attributes[attributeId].isReadMode =\n            currentAttributeModel.get(\"mode\") === \"read\";\n          templateInfo.attributes[attributeId].isWriteMode =\n            currentAttributeModel.get(\"mode\") === \"write\";\n          templateInfo.attributes[attributeId].isVisible =\n            currentAttributeModel.get(\"mode\") !== \"hidden\";\n          templateInfo.attributes[\n            attributeId\n          ].renderOptions = currentAttributeModel.getOptions();\n          if (currentAttributeModel.get(\"type\") === \"array\") {\n            templateInfo.attributes[attributeId].toolsEnabled =\n              templateInfo.attributes[attributeId].isWriteMode &&\n              currentAttributeModel.get(\"visibility\") !== \"U\" &&\n              (currentAttributeModel.getOption(\"rowAddDisable\") !== true ||\n                currentAttributeModel.getOption(\"rowDelDisable\") !== true ||\n                currentAttributeModel.getOption(\"rowMoveDisable\") !== true);\n            templateInfo.attributes[attributeId].rows = _.bind(\n              currentTemplate.getArrayRowInfo,\n              currentTemplate,\n              currentAttributeModel\n            );\n            templateInfo.attributes[attributeId].tableTools = _.bind(\n              currentTemplate.getArrayTools,\n              currentTemplate,\n              currentAttributeModel\n            );\n          }\n        }\n      );\n      return templateInfo;\n    },\n\n    _isEmptyAttribute: function attributeTemplate_isEmptyAttribute(\n      attributeModel\n    ) {\n      var currentTemplate = this;\n      if (attributeModel.get(\"isValueAttribute\")) {\n        var attrValue = attributeModel.get(\"attributeValue\");\n        return (\n          _.isEmpty(attrValue) ||\n          (attrValue.value === \"\" || attrValue.value === null)\n        );\n      }\n      if (\n        !attributeModel.get(\"content\") ||\n        attributeModel.get(\"content\").length === 0\n      ) {\n        return true;\n      }\n      if (attributeModel.get(\"content\").some) {\n        return !attributeModel\n          .get(\"content\")\n          .some(function attributeTemplate_isEmptyAttribute_checkEmpty(value) {\n            return !currentTemplate._isEmptyAttribute(value);\n          });\n      }\n    },\n\n    /**\n     * Get some data to complete custom attribute template\n     * @returns {{properties: *, attributes: {}}}\n     * @private\n     */\n    getTemplateInfo: function attributeTemplateGetTemplateInfo(attributeModel) {\n      var templateInfo = this.getTemplateModelInfo(\n        attributeModel.getDocumentModel()\n      );\n      var attributeId = attributeModel.id;\n      var extraKeys = attributeModel.getOption(\"templateKeys\");\n\n      templateInfo.attribute = templateInfo.attributes[attributeId];\n      if (extraKeys) {\n        var copyextraKeys = _.clone(extraKeys);\n        if (copyextraKeys.attribute && copyextraKeys.attribute.rows) {\n          copyextraKeys.attribute = _.clone(extraKeys.attribute);\n          delete copyextraKeys.attribute.rows;\n        }\n        templateInfo = this._deepExtend(templateInfo, copyextraKeys);\n      }\n      return templateInfo;\n    },\n\n    /**\n     * Recursively extend data\n     *\n     * @param target\n     * @param source\n     * @returns {*}\n     */\n    _deepExtend: function attributeTemplate_deepExtend(target, source) {\n      for (var prop in source) {\n        if (source.hasOwnProperty(prop)) {\n          if (prop in target) {\n            this._deepExtend(target[prop], source[prop]);\n          } else {\n            target[prop] = source[prop];\n          }\n        }\n      }\n      return target;\n    },\n\n    /**\n     * Construct custom view based on template options\n     *\n     * @param attrModel Attribute model\n     * @param callBackView Callback to call after\n     * @returns {*|HTMLElement}\n     * @param config\n     */\n    renderCustomView: function attributeTemplateCustomView(\n      attrModel,\n      callBackView,\n      config\n    ) {\n      var customTemplate =\n        '<div class=\"dcpCustomTemplate\" data-attrid=\"' +\n        attrModel.id +\n        '\">' +\n        attrModel.getOption(\"template\") +\n        \"</div>\";\n      var templateInfo = this.getTemplateInfo(attrModel);\n      var $render;\n      var completePromise;\n\n      if (config && !_.isUndefined(config.index) && config.index >= 0) {\n        templateInfo.attribute.attributeValue =\n          templateInfo.attribute.attributeValue[config.index];\n      }\n      $render = $(Mustache.render(customTemplate || \"\", templateInfo));\n      completePromise = this.completeCustomContent(\n        $render,\n        attrModel.getDocumentModel(),\n        callBackView,\n        config\n      );\n      return { $el: $render, promise: completePromise };\n    },\n\n    /**\n     *\n     * Render the custom element of the template\n     *\n     * @param $el\n     * @param documentModel\n     * @param callBackView\n     * @param config\n     */\n    completeCustomContent: function attributeTemplateCompleteCustomContent(\n      $el,\n      documentModel,\n      callBackView,\n      config\n    ) {\n      var renderElementPromises = [];\n      $el\n        .find(\".dcpCustomTemplate--content\")\n        .each(function attributeTemplatecompleteCustomContentEach() {\n          var attrId = $(this).data(\"attrid\"),\n            displayLabel = $(this).data(\"displaylabel\") === true,\n            currentAttributeModel = documentModel.get(\"attributes\").get(attrId),\n            attrContent = \"NO VIEW FOR \" + attrId,\n            view = \"\",\n            BackView = null,\n            // guess if the template is the true version (without template, only the widget)\n            originalView = $(this).data(\"originalview\") === true;\n\n          if (currentAttributeModel) {\n            try {\n              if (_.isFunction(callBackView)) {\n                // When called from vColumn to render widget in a cell\n                callBackView.apply($(this));\n                attrContent = \"\";\n              } else {\n                switch (currentAttributeModel.get(\"type\")) {\n                  case \"array\":\n                    BackView = __webpack_require__(/*! dcpDocument/views/attributes/array/vArray */ \"2396a71337586706882f\");\n                    break;\n                  case \"tab\":\n                    BackView = __webpack_require__(/*! dcpDocument/views/attributes/tab/vTabContent */ \"b3a839c4520ca8b4b597\");\n                    break;\n                  case \"frame\":\n                    BackView = __webpack_require__(/*! dcpDocument/views/attributes/frame/vFrame */ \"7a4c946b6dd0337fa34b\");\n                    break;\n                  default:\n                    BackView = __webpack_require__(/*! dcpDocument/views/attributes/vAttribute */ \"fde693488ffc947d1881\");\n                }\n\n                //If the attribute has no template, so it's the view with the widget, we annotate it to bind the events\n                if (!currentAttributeModel.getOption(\"template\")) {\n                  originalView = true;\n                }\n\n                if (\n                  originalView === false &&\n                  currentAttributeModel.customViewRended === true\n                ) {\n                  throw new Error(\n                    'Cannot use \"htmlView\" / \"htmlContent\" for itself on own custom view for ' +\n                      currentAttributeModel.id +\n                      '. Use \"htmlDefaultView\" / \"htmlDefaultContent\" instead'\n                  );\n                }\n                if (originalView === false) {\n                  currentAttributeModel.customViewRended = true;\n                }\n\n                view = new BackView({\n                  model: currentAttributeModel,\n                  originalView: originalView,\n                  initializeContent:\n                    (config && config.initializeContent) || false,\n                  displayLabel: displayLabel\n                });\n                renderElementPromises.push(view.render());\n                attrContent = view.$el;\n              }\n            } catch (e) {\n              attrContent = $(\"<div/>\")\n                .addClass(\"bg-danger\")\n                .text(e.message);\n            }\n          }\n          $(this).append(attrContent);\n        });\n      return Promise.all(renderElementPromises);\n    },\n\n    /**\n     * Information used when add new line\n     * @param attributeModel\n     * @param index line index\n     * @private\n     * @returns {{properties: *, attributes: {}}}\n     */\n    getLineInfo: function attributeTemplategetLineInfo(attributeModel, index) {\n      var documentData = attributeModel.getDocumentModel().getDocumentData();\n      var templateInfo = this.getTemplateInfo(attributeModel);\n      var extraKeys = attributeModel.getOption(\"templateKeys\");\n\n      _.each(documentData.attributeLabels, function attributeTemplate_eachLabel(\n        attributeLabel,\n        attributeId\n      ) {\n        var currentAttributeModel = attributeModel\n          .getDocumentModel()\n          .get(\"attributes\")\n          .get(attributeId);\n        // Reset some special keys which are not allowed here\n        if (currentAttributeModel.get(\"type\") === \"array\") {\n          templateInfo.attributes[attributeId].rows = [];\n          templateInfo.attributes[attributeId].tableTools =\n            \"NO TABLE TOOL ALLOWED HERE\";\n        }\n      });\n\n      templateInfo.rowTools = this.getRowTool(attributeModel);\n      templateInfo.content = {};\n      attributeModel\n        .get(\"content\")\n        .each(function attributeTemplate_eachContent(currentAttribute) {\n          var attributeId = currentAttribute.id;\n          var attributeLabel = currentAttribute.get(\"label\");\n\n          if (!currentAttribute.isDisplayable()) {\n            return;\n          }\n\n          if (currentAttribute.getOption(\"attributeLabel\")) {\n            attributeLabel = currentAttribute.getOption(\"attributeLabel\");\n          }\n          templateInfo.content[attributeId] = {};\n          templateInfo.content[attributeId].attributeValue = {\n            value: null, // No value for the moment. Value will be set by array view with default values\n            displayValue: \"\"\n          };\n          templateInfo.content[attributeId].label = attributeLabel;\n          templateInfo.content[attributeId].htmlContent =\n            '<div class=\"dcpCustomTemplate--row dcpArray__content__cell dcpAttribute__content\" data-displaylabel=\"false\" data-attrid=\"' +\n            attributeId +\n            '\"/>';\n        });\n\n      if (extraKeys && extraKeys.attribute && extraKeys.attribute.rows) {\n        _.each(\n          extraKeys.attribute.rows,\n          function attributeTemplategetLineInfoEach(extraValues, extraKey) {\n            templateInfo[extraKey] = extraValues[index];\n          }\n        );\n      }\n\n      return templateInfo;\n    },\n\n    /**\n     * Extract rows template line to customLineTemplate\n     * @param attrModel\n     * @private\n     * @returns {{attribute: {rows: Function}}}\n     */\n    extractRow: function attributeTemplateExtractRow(attrModel) {\n      var scope = this;\n      var info;\n\n      info = {\n        attribute: {\n          rows: function attributeTemplateExtractRowContent() {\n            return function attributeTemplate_getRowContent(text) {\n              scope.customLineTemplate = text.trim();\n            };\n          }\n        }\n      };\n      info.attributes = {};\n      info.attributes[attrModel.id] = info.attributes;\n      return info;\n    },\n\n    /**\n     * Construct custom line (declared in vArray::render and used in wArray::_getLineContent)\n     * @param index\n     * @param attrModel\n     * @returns {*|HTMLElement}\n     */\n    customArrayRowView: function attributeTemplateCustomArrayRowView(\n      index,\n      attrModel\n    ) {\n      var $render;\n\n      // Extract line to customLineTemplate variable\n      Mustache.render(\n        attrModel.getOption(\"template\") || \"\",\n        this.extractRow(attrModel)\n      );\n      $render = $(\n        Mustache.render(\n          this.customLineTemplate || \"\",\n          this.getLineInfo(attrModel, index)\n        )\n      );\n\n      return $render;\n    },\n\n    /**\n     * Get element where custom template will be inserted (htmlContent and htmlView)\n     * @param attributeModel\n     * @param displayLabel\n     * @param originalView\n     * @private\n     * @returns {string}\n     */\n    getCustomTemplate: function attributeTemplategetCustomTemplate(\n      attributeModel,\n      displayLabel,\n      originalView\n    ) {\n      if (attributeModel.get(\"mode\") === \"hidden\") {\n        return \"\";\n      }\n      return (\n        '<div class=\"dcpCustomTemplate--content ' +\n        (displayLabel\n          ? \"dcpCustomTemplate--content--view\"\n          : \"dcpCustomTemplate--content--value\") +\n        '\" data-displaylabel=\"' +\n        (displayLabel ? \"true\" : \"false\") +\n        '\" data-originalview=\"' +\n        (originalView ? \"true\" : \"false\") +\n        '\" data-attrid=\"' +\n        attributeModel.id +\n        '\"/>'\n      );\n    },\n\n    /**\n     * Extract dcpArray__tools from content array template\n     * @param attributeModel\n     * @private\n     * @returns {*}\n     */\n    getArrayTools: function attributeTemplateGetArrayTools(attributeModel) {\n      var tpls = attributeModel.getTemplates().attribute[\n        attributeModel.get(\"type\")\n      ];\n      if (tpls && tpls.content) {\n        return $(Mustache.render(tpls.content || \"\", { tools: true }))\n          .find(\".dcpArray__tools\")\n          .get(0).outerHTML;\n      }\n      return \"no tools\";\n    },\n\n    /**\n     * Extract dcpArray__content__toolCell from line array template\n     * @param attributeModel\n     * @private\n     * @returns {*}\n     */\n    getRowTool: function attributeTemplateGetRowTool(attributeModel) {\n      var templates = attributeModel.getTemplates().attribute[\n        attributeModel.get(\"type\")\n      ];\n      var tool = \"\";\n      if (templates && templates.line) {\n        tool = $(\n          Mustache.render(templates.line || \"\", {\n            tools: true,\n            lineCid: _.uniqueId(attributeModel.id)\n          })\n        )\n          .find(\".dcpArray__toolCell\")\n          .html();\n      }\n      return tool;\n    },\n\n    /**\n     * Get data for mustache \"rows\" variable\n     * @param attributeModel\n     * @private\n     * @returns {Array}\n     */\n    getArrayRowInfo: function attributeTemplategetArrayRowInfo(attributeModel) {\n      var rows = [];\n      var line = this.getRowTool(attributeModel);\n\n      attributeModel\n        .get(\"content\")\n        .each(function attributeTemplate_eachContent(currentAttribute) {\n          var values;\n          var attributeId = currentAttribute.id;\n          var attributeLabel = currentAttribute.get(\"label\");\n          if (!currentAttribute.isDisplayable()) {\n            return;\n          }\n\n          if (currentAttribute.getOption(\"attributeLabel\")) {\n            attributeLabel = currentAttribute.getOption(\"attributeLabel\");\n          }\n          values = currentAttribute.get(\"attributeValue\");\n          _.each(values, function attributeTemplategetArrayRowInfoEach(\n            singleValue,\n            index\n          ) {\n            if (_.isUndefined(rows[index])) {\n              rows[index] = { content: {} };\n            }\n            rows[index].index = index;\n            rows[index].content[attributeId] = {\n              label: attributeLabel,\n              attributeValue: singleValue,\n              htmlContent:\n                '<div class=\"dcpCustomTemplate--row dcpArray__content__cell dcpAttribute__content\"  data-attrid=\"' +\n                currentAttribute.id +\n                '\"/>'\n            };\n\n            rows[index].rowTools = line;\n          });\n        });\n\n      return rows;\n    },\n\n    renderClickDesc: function($tip, nsOn) {\n      $tip\n        .on(\"click\" + nsOn, function vAttributeShowDesc(event) {\n          event.stopPropagation();\n          $(this).tooltip(\"toggle\");\n        })\n        .one(\"show.bs.tooltip\", function wDescTooltip() {\n          var tipElement = $(this).data(\"bs.tooltip\").tip;\n          if (tipElement) {\n            $(tipElement).addClass(\"dcpAttribute__description-info\");\n          }\n        })\n        .one(\"shown.bs.tooltip\", function wDescTooltip() {\n          var tipElement = $(this).data(\"bs.tooltip\").tip;\n          if (tipElement) {\n            $(tipElement)\n              .find(\".tooltip-inner\")\n              .prepend(\n                '<span class=\"btn btn-secondary button-close-error\"><span class=\"fa fa-times\" />&nbsp;</span>'\n              );\n\n            $(tipElement).on(\n              \"click\" + nsOn,\n              \".button-close-error\",\n              function vAttributeCloseDesc(event) {\n                event.stopPropagation();\n                $(tipElement).tooltip(\"hide\");\n              }\n            );\n          }\n        });\n    },\n\n    /**\n     * Insert attribute description\n     * @param attributeView Backbone view\n     * @param $customElement specific other DOM element instead of default element view\n     */\n    insertDescription: function attributeTemplateInsertDescription(\n      attributeView,\n      $customElement\n    ) {\n      var data = attributeView.model.toData(null, true);\n\n      if (!data.renderOptions.description) {\n        return;\n      }\n      var descriptionTemplate;\n      var $tip;\n      var nsOn = \".v\" + attributeView.model.cid;\n      var $viewElement = $customElement ? $customElement : attributeView.$el;\n      var isFrame = $viewElement.hasClass(\"dcpFrame\");\n      var isArray = $viewElement.hasClass(\"dcpArray\");\n      var isArrayHead = $viewElement.hasClass(\"dcpArray__head__cell\");\n      var isArrayCell = $viewElement.hasClass(\"dcpArray__cell\");\n      var isAttribute = $viewElement.hasClass(\"dcpAttribute\");\n      var isTabContent = $viewElement.hasClass(\"dcpTab__content\");\n      var isTabLabel = $viewElement.hasClass(\"dcpTab__label\");\n      var $descriptionElement;\n\n      descriptionTemplate = attributeView.model.getTemplates().attribute\n        .description;\n      data.renderOptions.description.htmlContentRender = Mustache.render(\n        data.renderOptions.description.htmlContent,\n        data\n      );\n      data.renderOptions.description.htmlTitleRender = Mustache.render(\n        data.renderOptions.description.htmlTitle,\n        data\n      );\n\n      $descriptionElement = $(Mustache.render(descriptionTemplate || \"\", data));\n\n      if (isFrame) {\n        switch (data.renderOptions.description.position) {\n          case \"bottom\":\n            $viewElement.append($descriptionElement);\n            break;\n          case \"top\":\n          case \"topLabel\":\n            $viewElement.prepend($descriptionElement);\n            break;\n          case \"left\":\n            $viewElement\n              .find(\".dcpFrame__content\")\n              .addClass(\"dcpFrame__content--left-description\");\n            $descriptionElement.insertAfter(\n              $viewElement.find(\".dcpFrame__label\")\n            );\n            break;\n          case \"right\":\n            // Need to add class because no have css selector\n            $viewElement.append($descriptionElement);\n            $viewElement\n              .find(\".dcpFrame__content\")\n              .addClass(\"dcpFrame__content--right-description\");\n            break;\n          case \"bottomLabel\":\n            $descriptionElement.insertAfter(\n              $viewElement.find(\".dcpFrame__label\")\n            );\n            break;\n          case \"topValue\":\n            $viewElement\n              .find(\".dcpFrame__content\")\n              .prepend($descriptionElement);\n            break;\n          case \"bottomValue\":\n            $viewElement.find(\".dcpFrame__content\").append($descriptionElement);\n            break;\n          case \"click\":\n            $viewElement.append($descriptionElement);\n            $viewElement\n              .find(\".dcpFrame__label\")\n              .prepend(\n                '<a class=\"dcpAttribute__label_description\"><span class=\"fa fa-info-circle\"></span></a>'\n              );\n            $tip = $viewElement\n              .find(\".dcpFrame__label > .dcpAttribute__label_description\")\n              .tooltip({\n                html: true,\n                container: $viewElement,\n                title: $descriptionElement,\n                placement: \"auto\",\n                trigger: \"manual\"\n              });\n\n            this.renderClickDesc($tip, nsOn);\n        }\n      }\n      if (isTabContent || isTabLabel) {\n        switch (data.renderOptions.description.position) {\n          case \"top\":\n          case \"topValue\":\n            if (isTabContent) {\n              $viewElement.prepend($descriptionElement);\n            }\n            break;\n          case \"bottom\":\n          case \"bottomValue\":\n            if (isTabContent) {\n              $viewElement.append($descriptionElement);\n            }\n            break;\n          case \"click\":\n            if (isTabLabel) {\n              $viewElement.append($descriptionElement);\n              $viewElement\n                .find(\".dcpLabel__text\")\n                .prepend(\n                  '<a class=\"dcpAttribute__label_description\"><span class=\"fa fa-info-circle\"></span></a>'\n                );\n\n              $tip = $viewElement\n                .find(\".dcpAttribute__label_description\")\n                .tooltip({\n                  html: true,\n                  container: \".dcpDocument\",\n                  title: $descriptionElement,\n                  placement: \"auto\",\n                  trigger: \"manual\"\n                });\n\n              this.renderClickDesc($tip, nsOn);\n            }\n            break;\n\n          case \"bottomLabel\":\n          case \"topLabel\":\n          case \"left\":\n          case \"right\":\n            console.error(\n              'Cannot use \"' +\n                data.renderOptions.description.position +\n                '\" description position in tab attribute : ' +\n                data.id\n            );\n        }\n      }\n      if (isArray) {\n        switch (data.renderOptions.description.position) {\n          case \"top\":\n            $viewElement.prepend($descriptionElement);\n            break;\n          case \"topLabel\":\n            $viewElement.find(\".dcpArray__label\").prepend($descriptionElement);\n            break;\n          case \"bottomLabel\":\n            $viewElement.find(\".dcpArray__label\").append($descriptionElement);\n            break;\n          case \"topValue\":\n            $viewElement\n              .find(\".dcpArray__content\")\n              .prepend($descriptionElement);\n            break;\n          case \"bottomValue\":\n            $descriptionElement.insertAfter(\n              $viewElement.find(\".dcpArray__table\")\n            );\n            break;\n          case \"bottom\":\n            $viewElement.append($descriptionElement);\n            break;\n          case \"click\":\n            $viewElement.append($descriptionElement);\n            $viewElement\n              .find(\".dcpArray__label\")\n              .prepend(\n                '<a class=\"dcpAttribute__label_description\"><span class=\"fa fa-info-circle\"></span></a>'\n              );\n\n            $tip = $viewElement\n              .find(\".dcpArray__label > .dcpAttribute__label_description\")\n              .tooltip({\n                html: true,\n                container: $viewElement,\n                title: $descriptionElement,\n                placement: \"auto\",\n                trigger: \"manual\"\n              });\n\n            this.renderClickDesc($tip, nsOn);\n\n            break;\n\n          case \"left\":\n          case \"right\":\n            console.error(\n              'Cannot use \"' +\n                data.renderOptions.description.position +\n                '\" description position in array attribute : ' +\n                data.id\n            );\n            break;\n        }\n      }\n      if (isAttribute) {\n        switch (data.renderOptions.description.position) {\n          case \"bottom\":\n            $viewElement.append($descriptionElement);\n            break;\n          case \"top\":\n            $viewElement.prepend($descriptionElement);\n            break;\n          case \"left\":\n            $viewElement\n              .find(\".dcpAttribute__label\")\n              .append($descriptionElement);\n            break;\n          case \"right\":\n            $viewElement\n              .find(\".dcpAttribute__content\")\n              .append($descriptionElement);\n            break;\n          case \"topValue\":\n            $viewElement.prepend($descriptionElement);\n            $descriptionElement.addClass(\"dcpAttribute__right\");\n            break;\n          case \"topLabel\":\n            $viewElement.prepend($descriptionElement);\n            $descriptionElement.addClass(\"dcpAttribute__left\");\n            break;\n          case \"bottomValue\":\n            $viewElement.append($descriptionElement);\n            $descriptionElement.addClass(\"dcpAttribute__right\");\n            break;\n          case \"bottomLabel\":\n            $viewElement.append($descriptionElement);\n            $descriptionElement.addClass(\"dcpAttribute__left\");\n            break;\n          case \"click\":\n            $viewElement.append($descriptionElement);\n            $viewElement\n              .find(\".dcpAttribute__label\")\n              .append(\n                '<a class=\"dcpAttribute__label_description\"><span class=\"fa fa-info-circle\"></span></a>'\n              );\n\n            $tip = $viewElement\n              .find(\".dcpAttribute__label_description\")\n              .tooltip({\n                html: true,\n                container: $viewElement,\n                placement: \"auto\",\n                title: $descriptionElement,\n                trigger: \"manual\"\n              });\n\n            this.renderClickDesc($tip, nsOn);\n        }\n      }\n\n      if (isArrayCell || isArrayHead) {\n        switch (data.renderOptions.description.position) {\n          case \"topLabel\":\n          case \"top\":\n            if (isArrayHead) {\n              $viewElement.prepend($descriptionElement);\n            }\n            break;\n          case \"topValue\":\n            if (isArrayCell) {\n              $viewElement.prepend($descriptionElement);\n            }\n            break;\n          case \"bottomValue\":\n            if (isArrayCell) {\n              $viewElement.append($descriptionElement);\n            }\n            break;\n          case \"bottom\":\n          case \"bottomLabel\":\n            if (isArrayHead) {\n              $viewElement.append($descriptionElement);\n            }\n            break;\n          case \"click\":\n            if (isArrayHead) {\n              $viewElement.append($descriptionElement);\n              $viewElement.prepend(\n                '<a class=\"dcpAttribute__label_description\"><span class=\"fa fa-info-circle\"></span></a>'\n              );\n\n              $tip = $viewElement\n                .find(\".dcpAttribute__label_description\")\n                .tooltip({\n                  html: true,\n                  container: $viewElement,\n                  placement: \"auto\",\n                  title: $viewElement.find(\"> .dcpAttribute__description\"),\n                  trigger: \"manual\"\n                });\n\n              this.renderClickDesc($tip, nsOn);\n            }\n            break;\n          case \"left\":\n          case \"right\":\n            // No use in column context\n            console.error(\n              'Cannot use \"' +\n                data.renderOptions.description.position +\n                '\" description position in column attribute : ' +\n                data.id\n            );\n            break;\n        }\n      }\n      if (data.renderOptions.description.htmlContent) {\n        $viewElement.on(\n          \"click\" + nsOn,\n          \".dcpAttribute__description__title\",\n          function vAttribute_descToggle() {\n            var $contentElement = $(this)\n              .closest(\".dcpAttribute__description\")\n              .find(\".dcpAttribute__description__content\");\n            $(this)\n              .find(\".dcpAttribute__description__title__expand\")\n              .toggleClass(\"fa-caret-right fa-caret-down\");\n            $contentElement.slideToggle(200);\n          }\n        );\n        if (data.renderOptions.description.collapsed === true) {\n          $viewElement\n            .find(\".dcpAttribute__description__title__expand\")\n            .toggleClass(\"fa-caret-right fa-caret-down\");\n          $viewElement.find(\".dcpAttribute__description__content\").hide();\n        }\n      }\n    }\n  };\n}).call(exports, __webpack_require__, exports, module),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNTkzYzhjOTRiYTQzOTkwMjBmNzkuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvQXBwcy9ET0NVTUVOVC9JSE0vdmlld3MvZG9jdW1lbnQvYXR0cmlidXRlVGVtcGxhdGUuanM/ZjQwOCJdLCJzb3VyY2VzQ29udGVudCI6WyIvKmdsb2JhbCBkZWZpbmUqL1xuZGVmaW5lKGZ1bmN0aW9uIGF0dHJpYnV0ZVRlbXBsYXRlKHJlcXVpcmUgLyosIGV4cG9ydHMsIG1vZHVsZSovKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuICB2YXIgXyA9IHJlcXVpcmUoXCJ1bmRlcnNjb3JlXCIpO1xuICB2YXIgJCA9IHJlcXVpcmUoXCJqcXVlcnlcIik7XG4gIHZhciBNdXN0YWNoZSA9IHJlcXVpcmUoXCJtdXN0YWNoZVwiKTtcblxuICByZXR1cm4ge1xuICAgIGN1c3RvbUxpbmVUZW1wbGF0ZTogXCJcIixcblxuICAgIC8qKlxuICAgICAqIEdldCBzb21lIGRhdGEgdG8gY29tcGxldGUgY3VzdG9tIGF0dHJpYnV0ZSB0ZW1wbGF0ZVxuICAgICAqIEBwYXJhbSBkb2N1bWVudE1vZGVsIGRvY3VtZW50IG1vZGVsXG4gICAgICogQHJldHVybnMge3twcm9wZXJ0aWVzOiAqLCBhdHRyaWJ1dGVzOiB7fX19XG4gICAgICogQHB1YmxpY1xuICAgICAqL1xuICAgIGdldFRlbXBsYXRlTW9kZWxJbmZvOiBmdW5jdGlvbiBhdHRyaWJ1dGVUZW1wbGF0ZUdldFRlbXBsYXRlTW9kZWxJbmZvKFxuICAgICAgZG9jdW1lbnRNb2RlbFxuICAgICkge1xuICAgICAgdmFyIGRvY3VtZW50RGF0YSA9IGRvY3VtZW50TW9kZWwuZ2V0RG9jdW1lbnREYXRhKCk7XG4gICAgICB2YXIgdGVtcGxhdGVJbmZvID0ge1xuICAgICAgICBwcm9wZXJ0aWVzOiBkb2N1bWVudERhdGEucHJvcGVydGllcyxcbiAgICAgICAgYXR0cmlidXRlczoge31cbiAgICAgIH07XG4gICAgICB2YXIgY3VycmVudFRlbXBsYXRlID0gdGhpcztcblxuICAgICAgdGVtcGxhdGVJbmZvLnByb3BlcnRpZXMuaXNXcml0ZU1vZGUgPVxuICAgICAgICB0ZW1wbGF0ZUluZm8ucHJvcGVydGllcy5yZW5kZXJNb2RlID09PSBcImVkaXRcIjtcbiAgICAgIHRlbXBsYXRlSW5mby5wcm9wZXJ0aWVzLmlzUmVhZE1vZGUgPVxuICAgICAgICB0ZW1wbGF0ZUluZm8ucHJvcGVydGllcy5yZW5kZXJNb2RlID09PSBcInZpZXdcIjtcblxuICAgICAgXy5lYWNoKGRvY3VtZW50RGF0YS5hdHRyaWJ1dGVWYWx1ZXMsIGZ1bmN0aW9uIGFzc29jaWF0ZVZhbHVlKFxuICAgICAgICBhdHRyaWJ1dGVWYWx1ZSxcbiAgICAgICAgYXR0cmlidXRlSWRcbiAgICAgICkge1xuICAgICAgICB0ZW1wbGF0ZUluZm8uYXR0cmlidXRlc1thdHRyaWJ1dGVJZF0gPSB7XG4gICAgICAgICAgYXR0cmlidXRlVmFsdWU6IGF0dHJpYnV0ZVZhbHVlXG4gICAgICAgIH07XG4gICAgICB9KTtcbiAgICAgIF8uZWFjaChcbiAgICAgICAgZG9jdW1lbnREYXRhLmF0dHJpYnV0ZUxhYmVscyxcbiAgICAgICAgZnVuY3Rpb24gYXR0cmlidXRlVGVtcGxhdGVnZXRUZW1wbGF0ZU1vZGVsSW5mb0VhY2goXG4gICAgICAgICAgYXR0cmlidXRlTGFiZWwsXG4gICAgICAgICAgYXR0cmlidXRlSWRcbiAgICAgICAgKSB7XG4gICAgICAgICAgdmFyIGN1cnJlbnRBdHRyaWJ1dGVNb2RlbCA9IGRvY3VtZW50TW9kZWxcbiAgICAgICAgICAgIC5nZXQoXCJhdHRyaWJ1dGVzXCIpXG4gICAgICAgICAgICAuZ2V0KGF0dHJpYnV0ZUlkKTtcbiAgICAgICAgICBpZiAoY3VycmVudEF0dHJpYnV0ZU1vZGVsLmdldE9wdGlvbihcImF0dHJpYnV0ZUxhYmVsXCIpKSB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVMYWJlbCA9IGN1cnJlbnRBdHRyaWJ1dGVNb2RlbC5nZXRPcHRpb24oXCJhdHRyaWJ1dGVMYWJlbFwiKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpZiAodGVtcGxhdGVJbmZvLmF0dHJpYnV0ZXNbYXR0cmlidXRlSWRdKSB7XG4gICAgICAgICAgICB0ZW1wbGF0ZUluZm8uYXR0cmlidXRlc1thdHRyaWJ1dGVJZF0ubGFiZWwgPSBhdHRyaWJ1dGVMYWJlbDtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGVtcGxhdGVJbmZvLmF0dHJpYnV0ZXNbYXR0cmlidXRlSWRdID0geyBsYWJlbDogYXR0cmlidXRlTGFiZWwgfTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICB0ZW1wbGF0ZUluZm8uYXR0cmlidXRlc1thdHRyaWJ1dGVJZF0uaWQgPSBhdHRyaWJ1dGVJZDtcbiAgICAgICAgICB0ZW1wbGF0ZUluZm8uYXR0cmlidXRlc1tcbiAgICAgICAgICAgIGF0dHJpYnV0ZUlkXG4gICAgICAgICAgXS5pc0VtcHR5ID0gY3VycmVudFRlbXBsYXRlLl9pc0VtcHR5QXR0cmlidXRlKGN1cnJlbnRBdHRyaWJ1dGVNb2RlbCk7XG5cbiAgICAgICAgICB0ZW1wbGF0ZUluZm8uYXR0cmlidXRlc1thdHRyaWJ1dGVJZF0uaHRtbENvbnRlbnQgPSBfLmJpbmQoXG4gICAgICAgICAgICBjdXJyZW50VGVtcGxhdGUuZ2V0Q3VzdG9tVGVtcGxhdGUsXG4gICAgICAgICAgICBjdXJyZW50VGVtcGxhdGUsXG4gICAgICAgICAgICBjdXJyZW50QXR0cmlidXRlTW9kZWwsXG4gICAgICAgICAgICBmYWxzZSxcbiAgICAgICAgICAgIGZhbHNlXG4gICAgICAgICAgKTtcbiAgICAgICAgICB0ZW1wbGF0ZUluZm8uYXR0cmlidXRlc1thdHRyaWJ1dGVJZF0uaHRtbFZpZXcgPSBfLmJpbmQoXG4gICAgICAgICAgICBjdXJyZW50VGVtcGxhdGUuZ2V0Q3VzdG9tVGVtcGxhdGUsXG4gICAgICAgICAgICBjdXJyZW50VGVtcGxhdGUsXG4gICAgICAgICAgICBjdXJyZW50QXR0cmlidXRlTW9kZWwsXG4gICAgICAgICAgICB0cnVlLFxuICAgICAgICAgICAgZmFsc2VcbiAgICAgICAgICApO1xuICAgICAgICAgIHRlbXBsYXRlSW5mby5hdHRyaWJ1dGVzW2F0dHJpYnV0ZUlkXS5odG1sRGVmYXVsdENvbnRlbnQgPSBfLmJpbmQoXG4gICAgICAgICAgICBjdXJyZW50VGVtcGxhdGUuZ2V0Q3VzdG9tVGVtcGxhdGUsXG4gICAgICAgICAgICBjdXJyZW50VGVtcGxhdGUsXG4gICAgICAgICAgICBjdXJyZW50QXR0cmlidXRlTW9kZWwsXG4gICAgICAgICAgICBmYWxzZSxcbiAgICAgICAgICAgIHRydWVcbiAgICAgICAgICApO1xuICAgICAgICAgIHRlbXBsYXRlSW5mby5hdHRyaWJ1dGVzW2F0dHJpYnV0ZUlkXS5odG1sRGVmYXVsdFZpZXcgPSBfLmJpbmQoXG4gICAgICAgICAgICBjdXJyZW50VGVtcGxhdGUuZ2V0Q3VzdG9tVGVtcGxhdGUsXG4gICAgICAgICAgICBjdXJyZW50VGVtcGxhdGUsXG4gICAgICAgICAgICBjdXJyZW50QXR0cmlidXRlTW9kZWwsXG4gICAgICAgICAgICB0cnVlLFxuICAgICAgICAgICAgdHJ1ZVxuICAgICAgICAgICk7XG4gICAgICAgICAgdGVtcGxhdGVJbmZvLmF0dHJpYnV0ZXNbYXR0cmlidXRlSWRdLmlzUmVhZE1vZGUgPVxuICAgICAgICAgICAgY3VycmVudEF0dHJpYnV0ZU1vZGVsLmdldChcIm1vZGVcIikgPT09IFwicmVhZFwiO1xuICAgICAgICAgIHRlbXBsYXRlSW5mby5hdHRyaWJ1dGVzW2F0dHJpYnV0ZUlkXS5pc1dyaXRlTW9kZSA9XG4gICAgICAgICAgICBjdXJyZW50QXR0cmlidXRlTW9kZWwuZ2V0KFwibW9kZVwiKSA9PT0gXCJ3cml0ZVwiO1xuICAgICAgICAgIHRlbXBsYXRlSW5mby5hdHRyaWJ1dGVzW2F0dHJpYnV0ZUlkXS5pc1Zpc2libGUgPVxuICAgICAgICAgICAgY3VycmVudEF0dHJpYnV0ZU1vZGVsLmdldChcIm1vZGVcIikgIT09IFwiaGlkZGVuXCI7XG4gICAgICAgICAgdGVtcGxhdGVJbmZvLmF0dHJpYnV0ZXNbXG4gICAgICAgICAgICBhdHRyaWJ1dGVJZFxuICAgICAgICAgIF0ucmVuZGVyT3B0aW9ucyA9IGN1cnJlbnRBdHRyaWJ1dGVNb2RlbC5nZXRPcHRpb25zKCk7XG4gICAgICAgICAgaWYgKGN1cnJlbnRBdHRyaWJ1dGVNb2RlbC5nZXQoXCJ0eXBlXCIpID09PSBcImFycmF5XCIpIHtcbiAgICAgICAgICAgIHRlbXBsYXRlSW5mby5hdHRyaWJ1dGVzW2F0dHJpYnV0ZUlkXS50b29sc0VuYWJsZWQgPVxuICAgICAgICAgICAgICB0ZW1wbGF0ZUluZm8uYXR0cmlidXRlc1thdHRyaWJ1dGVJZF0uaXNXcml0ZU1vZGUgJiZcbiAgICAgICAgICAgICAgY3VycmVudEF0dHJpYnV0ZU1vZGVsLmdldChcInZpc2liaWxpdHlcIikgIT09IFwiVVwiICYmXG4gICAgICAgICAgICAgIChjdXJyZW50QXR0cmlidXRlTW9kZWwuZ2V0T3B0aW9uKFwicm93QWRkRGlzYWJsZVwiKSAhPT0gdHJ1ZSB8fFxuICAgICAgICAgICAgICAgIGN1cnJlbnRBdHRyaWJ1dGVNb2RlbC5nZXRPcHRpb24oXCJyb3dEZWxEaXNhYmxlXCIpICE9PSB0cnVlIHx8XG4gICAgICAgICAgICAgICAgY3VycmVudEF0dHJpYnV0ZU1vZGVsLmdldE9wdGlvbihcInJvd01vdmVEaXNhYmxlXCIpICE9PSB0cnVlKTtcbiAgICAgICAgICAgIHRlbXBsYXRlSW5mby5hdHRyaWJ1dGVzW2F0dHJpYnV0ZUlkXS5yb3dzID0gXy5iaW5kKFxuICAgICAgICAgICAgICBjdXJyZW50VGVtcGxhdGUuZ2V0QXJyYXlSb3dJbmZvLFxuICAgICAgICAgICAgICBjdXJyZW50VGVtcGxhdGUsXG4gICAgICAgICAgICAgIGN1cnJlbnRBdHRyaWJ1dGVNb2RlbFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIHRlbXBsYXRlSW5mby5hdHRyaWJ1dGVzW2F0dHJpYnV0ZUlkXS50YWJsZVRvb2xzID0gXy5iaW5kKFxuICAgICAgICAgICAgICBjdXJyZW50VGVtcGxhdGUuZ2V0QXJyYXlUb29scyxcbiAgICAgICAgICAgICAgY3VycmVudFRlbXBsYXRlLFxuICAgICAgICAgICAgICBjdXJyZW50QXR0cmlidXRlTW9kZWxcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICApO1xuICAgICAgcmV0dXJuIHRlbXBsYXRlSW5mbztcbiAgICB9LFxuXG4gICAgX2lzRW1wdHlBdHRyaWJ1dGU6IGZ1bmN0aW9uIGF0dHJpYnV0ZVRlbXBsYXRlX2lzRW1wdHlBdHRyaWJ1dGUoXG4gICAgICBhdHRyaWJ1dGVNb2RlbFxuICAgICkge1xuICAgICAgdmFyIGN1cnJlbnRUZW1wbGF0ZSA9IHRoaXM7XG4gICAgICBpZiAoYXR0cmlidXRlTW9kZWwuZ2V0KFwiaXNWYWx1ZUF0dHJpYnV0ZVwiKSkge1xuICAgICAgICB2YXIgYXR0clZhbHVlID0gYXR0cmlidXRlTW9kZWwuZ2V0KFwiYXR0cmlidXRlVmFsdWVcIik7XG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgXy5pc0VtcHR5KGF0dHJWYWx1ZSkgfHxcbiAgICAgICAgICAoYXR0clZhbHVlLnZhbHVlID09PSBcIlwiIHx8IGF0dHJWYWx1ZS52YWx1ZSA9PT0gbnVsbClcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIGlmIChcbiAgICAgICAgIWF0dHJpYnV0ZU1vZGVsLmdldChcImNvbnRlbnRcIikgfHxcbiAgICAgICAgYXR0cmlidXRlTW9kZWwuZ2V0KFwiY29udGVudFwiKS5sZW5ndGggPT09IDBcbiAgICAgICkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIGlmIChhdHRyaWJ1dGVNb2RlbC5nZXQoXCJjb250ZW50XCIpLnNvbWUpIHtcbiAgICAgICAgcmV0dXJuICFhdHRyaWJ1dGVNb2RlbFxuICAgICAgICAgIC5nZXQoXCJjb250ZW50XCIpXG4gICAgICAgICAgLnNvbWUoZnVuY3Rpb24gYXR0cmlidXRlVGVtcGxhdGVfaXNFbXB0eUF0dHJpYnV0ZV9jaGVja0VtcHR5KHZhbHVlKSB7XG4gICAgICAgICAgICByZXR1cm4gIWN1cnJlbnRUZW1wbGF0ZS5faXNFbXB0eUF0dHJpYnV0ZSh2YWx1ZSk7XG4gICAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEdldCBzb21lIGRhdGEgdG8gY29tcGxldGUgY3VzdG9tIGF0dHJpYnV0ZSB0ZW1wbGF0ZVxuICAgICAqIEByZXR1cm5zIHt7cHJvcGVydGllczogKiwgYXR0cmlidXRlczoge319fVxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgZ2V0VGVtcGxhdGVJbmZvOiBmdW5jdGlvbiBhdHRyaWJ1dGVUZW1wbGF0ZUdldFRlbXBsYXRlSW5mbyhhdHRyaWJ1dGVNb2RlbCkge1xuICAgICAgdmFyIHRlbXBsYXRlSW5mbyA9IHRoaXMuZ2V0VGVtcGxhdGVNb2RlbEluZm8oXG4gICAgICAgIGF0dHJpYnV0ZU1vZGVsLmdldERvY3VtZW50TW9kZWwoKVxuICAgICAgKTtcbiAgICAgIHZhciBhdHRyaWJ1dGVJZCA9IGF0dHJpYnV0ZU1vZGVsLmlkO1xuICAgICAgdmFyIGV4dHJhS2V5cyA9IGF0dHJpYnV0ZU1vZGVsLmdldE9wdGlvbihcInRlbXBsYXRlS2V5c1wiKTtcblxuICAgICAgdGVtcGxhdGVJbmZvLmF0dHJpYnV0ZSA9IHRlbXBsYXRlSW5mby5hdHRyaWJ1dGVzW2F0dHJpYnV0ZUlkXTtcbiAgICAgIGlmIChleHRyYUtleXMpIHtcbiAgICAgICAgdmFyIGNvcHlleHRyYUtleXMgPSBfLmNsb25lKGV4dHJhS2V5cyk7XG4gICAgICAgIGlmIChjb3B5ZXh0cmFLZXlzLmF0dHJpYnV0ZSAmJiBjb3B5ZXh0cmFLZXlzLmF0dHJpYnV0ZS5yb3dzKSB7XG4gICAgICAgICAgY29weWV4dHJhS2V5cy5hdHRyaWJ1dGUgPSBfLmNsb25lKGV4dHJhS2V5cy5hdHRyaWJ1dGUpO1xuICAgICAgICAgIGRlbGV0ZSBjb3B5ZXh0cmFLZXlzLmF0dHJpYnV0ZS5yb3dzO1xuICAgICAgICB9XG4gICAgICAgIHRlbXBsYXRlSW5mbyA9IHRoaXMuX2RlZXBFeHRlbmQodGVtcGxhdGVJbmZvLCBjb3B5ZXh0cmFLZXlzKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0ZW1wbGF0ZUluZm87XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIFJlY3Vyc2l2ZWx5IGV4dGVuZCBkYXRhXG4gICAgICpcbiAgICAgKiBAcGFyYW0gdGFyZ2V0XG4gICAgICogQHBhcmFtIHNvdXJjZVxuICAgICAqIEByZXR1cm5zIHsqfVxuICAgICAqL1xuICAgIF9kZWVwRXh0ZW5kOiBmdW5jdGlvbiBhdHRyaWJ1dGVUZW1wbGF0ZV9kZWVwRXh0ZW5kKHRhcmdldCwgc291cmNlKSB7XG4gICAgICBmb3IgKHZhciBwcm9wIGluIHNvdXJjZSkge1xuICAgICAgICBpZiAoc291cmNlLmhhc093blByb3BlcnR5KHByb3ApKSB7XG4gICAgICAgICAgaWYgKHByb3AgaW4gdGFyZ2V0KSB7XG4gICAgICAgICAgICB0aGlzLl9kZWVwRXh0ZW5kKHRhcmdldFtwcm9wXSwgc291cmNlW3Byb3BdKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGFyZ2V0W3Byb3BdID0gc291cmNlW3Byb3BdO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIHRhcmdldDtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQ29uc3RydWN0IGN1c3RvbSB2aWV3IGJhc2VkIG9uIHRlbXBsYXRlIG9wdGlvbnNcbiAgICAgKlxuICAgICAqIEBwYXJhbSBhdHRyTW9kZWwgQXR0cmlidXRlIG1vZGVsXG4gICAgICogQHBhcmFtIGNhbGxCYWNrVmlldyBDYWxsYmFjayB0byBjYWxsIGFmdGVyXG4gICAgICogQHJldHVybnMgeyp8SFRNTEVsZW1lbnR9XG4gICAgICogQHBhcmFtIGNvbmZpZ1xuICAgICAqL1xuICAgIHJlbmRlckN1c3RvbVZpZXc6IGZ1bmN0aW9uIGF0dHJpYnV0ZVRlbXBsYXRlQ3VzdG9tVmlldyhcbiAgICAgIGF0dHJNb2RlbCxcbiAgICAgIGNhbGxCYWNrVmlldyxcbiAgICAgIGNvbmZpZ1xuICAgICkge1xuICAgICAgdmFyIGN1c3RvbVRlbXBsYXRlID1cbiAgICAgICAgJzxkaXYgY2xhc3M9XCJkY3BDdXN0b21UZW1wbGF0ZVwiIGRhdGEtYXR0cmlkPVwiJyArXG4gICAgICAgIGF0dHJNb2RlbC5pZCArXG4gICAgICAgICdcIj4nICtcbiAgICAgICAgYXR0ck1vZGVsLmdldE9wdGlvbihcInRlbXBsYXRlXCIpICtcbiAgICAgICAgXCI8L2Rpdj5cIjtcbiAgICAgIHZhciB0ZW1wbGF0ZUluZm8gPSB0aGlzLmdldFRlbXBsYXRlSW5mbyhhdHRyTW9kZWwpO1xuICAgICAgdmFyICRyZW5kZXI7XG4gICAgICB2YXIgY29tcGxldGVQcm9taXNlO1xuXG4gICAgICBpZiAoY29uZmlnICYmICFfLmlzVW5kZWZpbmVkKGNvbmZpZy5pbmRleCkgJiYgY29uZmlnLmluZGV4ID49IDApIHtcbiAgICAgICAgdGVtcGxhdGVJbmZvLmF0dHJpYnV0ZS5hdHRyaWJ1dGVWYWx1ZSA9XG4gICAgICAgICAgdGVtcGxhdGVJbmZvLmF0dHJpYnV0ZS5hdHRyaWJ1dGVWYWx1ZVtjb25maWcuaW5kZXhdO1xuICAgICAgfVxuICAgICAgJHJlbmRlciA9ICQoTXVzdGFjaGUucmVuZGVyKGN1c3RvbVRlbXBsYXRlIHx8IFwiXCIsIHRlbXBsYXRlSW5mbykpO1xuICAgICAgY29tcGxldGVQcm9taXNlID0gdGhpcy5jb21wbGV0ZUN1c3RvbUNvbnRlbnQoXG4gICAgICAgICRyZW5kZXIsXG4gICAgICAgIGF0dHJNb2RlbC5nZXREb2N1bWVudE1vZGVsKCksXG4gICAgICAgIGNhbGxCYWNrVmlldyxcbiAgICAgICAgY29uZmlnXG4gICAgICApO1xuICAgICAgcmV0dXJuIHsgJGVsOiAkcmVuZGVyLCBwcm9taXNlOiBjb21wbGV0ZVByb21pc2UgfTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKiBSZW5kZXIgdGhlIGN1c3RvbSBlbGVtZW50IG9mIHRoZSB0ZW1wbGF0ZVxuICAgICAqXG4gICAgICogQHBhcmFtICRlbFxuICAgICAqIEBwYXJhbSBkb2N1bWVudE1vZGVsXG4gICAgICogQHBhcmFtIGNhbGxCYWNrVmlld1xuICAgICAqIEBwYXJhbSBjb25maWdcbiAgICAgKi9cbiAgICBjb21wbGV0ZUN1c3RvbUNvbnRlbnQ6IGZ1bmN0aW9uIGF0dHJpYnV0ZVRlbXBsYXRlQ29tcGxldGVDdXN0b21Db250ZW50KFxuICAgICAgJGVsLFxuICAgICAgZG9jdW1lbnRNb2RlbCxcbiAgICAgIGNhbGxCYWNrVmlldyxcbiAgICAgIGNvbmZpZ1xuICAgICkge1xuICAgICAgdmFyIHJlbmRlckVsZW1lbnRQcm9taXNlcyA9IFtdO1xuICAgICAgJGVsXG4gICAgICAgIC5maW5kKFwiLmRjcEN1c3RvbVRlbXBsYXRlLS1jb250ZW50XCIpXG4gICAgICAgIC5lYWNoKGZ1bmN0aW9uIGF0dHJpYnV0ZVRlbXBsYXRlY29tcGxldGVDdXN0b21Db250ZW50RWFjaCgpIHtcbiAgICAgICAgICB2YXIgYXR0cklkID0gJCh0aGlzKS5kYXRhKFwiYXR0cmlkXCIpLFxuICAgICAgICAgICAgZGlzcGxheUxhYmVsID0gJCh0aGlzKS5kYXRhKFwiZGlzcGxheWxhYmVsXCIpID09PSB0cnVlLFxuICAgICAgICAgICAgY3VycmVudEF0dHJpYnV0ZU1vZGVsID0gZG9jdW1lbnRNb2RlbC5nZXQoXCJhdHRyaWJ1dGVzXCIpLmdldChhdHRySWQpLFxuICAgICAgICAgICAgYXR0ckNvbnRlbnQgPSBcIk5PIFZJRVcgRk9SIFwiICsgYXR0cklkLFxuICAgICAgICAgICAgdmlldyA9IFwiXCIsXG4gICAgICAgICAgICBCYWNrVmlldyA9IG51bGwsXG4gICAgICAgICAgICAvLyBndWVzcyBpZiB0aGUgdGVtcGxhdGUgaXMgdGhlIHRydWUgdmVyc2lvbiAod2l0aG91dCB0ZW1wbGF0ZSwgb25seSB0aGUgd2lkZ2V0KVxuICAgICAgICAgICAgb3JpZ2luYWxWaWV3ID0gJCh0aGlzKS5kYXRhKFwib3JpZ2luYWx2aWV3XCIpID09PSB0cnVlO1xuXG4gICAgICAgICAgaWYgKGN1cnJlbnRBdHRyaWJ1dGVNb2RlbCkge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgaWYgKF8uaXNGdW5jdGlvbihjYWxsQmFja1ZpZXcpKSB7XG4gICAgICAgICAgICAgICAgLy8gV2hlbiBjYWxsZWQgZnJvbSB2Q29sdW1uIHRvIHJlbmRlciB3aWRnZXQgaW4gYSBjZWxsXG4gICAgICAgICAgICAgICAgY2FsbEJhY2tWaWV3LmFwcGx5KCQodGhpcykpO1xuICAgICAgICAgICAgICAgIGF0dHJDb250ZW50ID0gXCJcIjtcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKGN1cnJlbnRBdHRyaWJ1dGVNb2RlbC5nZXQoXCJ0eXBlXCIpKSB7XG4gICAgICAgICAgICAgICAgICBjYXNlIFwiYXJyYXlcIjpcbiAgICAgICAgICAgICAgICAgICAgQmFja1ZpZXcgPSByZXF1aXJlKFwiZGNwRG9jdW1lbnQvdmlld3MvYXR0cmlidXRlcy9hcnJheS92QXJyYXlcIik7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgY2FzZSBcInRhYlwiOlxuICAgICAgICAgICAgICAgICAgICBCYWNrVmlldyA9IHJlcXVpcmUoXCJkY3BEb2N1bWVudC92aWV3cy9hdHRyaWJ1dGVzL3RhYi92VGFiQ29udGVudFwiKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICBjYXNlIFwiZnJhbWVcIjpcbiAgICAgICAgICAgICAgICAgICAgQmFja1ZpZXcgPSByZXF1aXJlKFwiZGNwRG9jdW1lbnQvdmlld3MvYXR0cmlidXRlcy9mcmFtZS92RnJhbWVcIik7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgQmFja1ZpZXcgPSByZXF1aXJlKFwiZGNwRG9jdW1lbnQvdmlld3MvYXR0cmlidXRlcy92QXR0cmlidXRlXCIpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vSWYgdGhlIGF0dHJpYnV0ZSBoYXMgbm8gdGVtcGxhdGUsIHNvIGl0J3MgdGhlIHZpZXcgd2l0aCB0aGUgd2lkZ2V0LCB3ZSBhbm5vdGF0ZSBpdCB0byBiaW5kIHRoZSBldmVudHNcbiAgICAgICAgICAgICAgICBpZiAoIWN1cnJlbnRBdHRyaWJ1dGVNb2RlbC5nZXRPcHRpb24oXCJ0ZW1wbGF0ZVwiKSkge1xuICAgICAgICAgICAgICAgICAgb3JpZ2luYWxWaWV3ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgICBvcmlnaW5hbFZpZXcgPT09IGZhbHNlICYmXG4gICAgICAgICAgICAgICAgICBjdXJyZW50QXR0cmlidXRlTW9kZWwuY3VzdG9tVmlld1JlbmRlZCA9PT0gdHJ1ZVxuICAgICAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICAgICAgICAgICAnQ2Fubm90IHVzZSBcImh0bWxWaWV3XCIgLyBcImh0bWxDb250ZW50XCIgZm9yIGl0c2VsZiBvbiBvd24gY3VzdG9tIHZpZXcgZm9yICcgK1xuICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRBdHRyaWJ1dGVNb2RlbC5pZCArXG4gICAgICAgICAgICAgICAgICAgICAgJy4gVXNlIFwiaHRtbERlZmF1bHRWaWV3XCIgLyBcImh0bWxEZWZhdWx0Q29udGVudFwiIGluc3RlYWQnXG4gICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAob3JpZ2luYWxWaWV3ID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgICAgY3VycmVudEF0dHJpYnV0ZU1vZGVsLmN1c3RvbVZpZXdSZW5kZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHZpZXcgPSBuZXcgQmFja1ZpZXcoe1xuICAgICAgICAgICAgICAgICAgbW9kZWw6IGN1cnJlbnRBdHRyaWJ1dGVNb2RlbCxcbiAgICAgICAgICAgICAgICAgIG9yaWdpbmFsVmlldzogb3JpZ2luYWxWaWV3LFxuICAgICAgICAgICAgICAgICAgaW5pdGlhbGl6ZUNvbnRlbnQ6XG4gICAgICAgICAgICAgICAgICAgIChjb25maWcgJiYgY29uZmlnLmluaXRpYWxpemVDb250ZW50KSB8fCBmYWxzZSxcbiAgICAgICAgICAgICAgICAgIGRpc3BsYXlMYWJlbDogZGlzcGxheUxhYmVsXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmVuZGVyRWxlbWVudFByb21pc2VzLnB1c2godmlldy5yZW5kZXIoKSk7XG4gICAgICAgICAgICAgICAgYXR0ckNvbnRlbnQgPSB2aWV3LiRlbDtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICBhdHRyQ29udGVudCA9ICQoXCI8ZGl2Lz5cIilcbiAgICAgICAgICAgICAgICAuYWRkQ2xhc3MoXCJiZy1kYW5nZXJcIilcbiAgICAgICAgICAgICAgICAudGV4dChlLm1lc3NhZ2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICAkKHRoaXMpLmFwcGVuZChhdHRyQ29udGVudCk7XG4gICAgICAgIH0pO1xuICAgICAgcmV0dXJuIFByb21pc2UuYWxsKHJlbmRlckVsZW1lbnRQcm9taXNlcyk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEluZm9ybWF0aW9uIHVzZWQgd2hlbiBhZGQgbmV3IGxpbmVcbiAgICAgKiBAcGFyYW0gYXR0cmlidXRlTW9kZWxcbiAgICAgKiBAcGFyYW0gaW5kZXggbGluZSBpbmRleFxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHJldHVybnMge3twcm9wZXJ0aWVzOiAqLCBhdHRyaWJ1dGVzOiB7fX19XG4gICAgICovXG4gICAgZ2V0TGluZUluZm86IGZ1bmN0aW9uIGF0dHJpYnV0ZVRlbXBsYXRlZ2V0TGluZUluZm8oYXR0cmlidXRlTW9kZWwsIGluZGV4KSB7XG4gICAgICB2YXIgZG9jdW1lbnREYXRhID0gYXR0cmlidXRlTW9kZWwuZ2V0RG9jdW1lbnRNb2RlbCgpLmdldERvY3VtZW50RGF0YSgpO1xuICAgICAgdmFyIHRlbXBsYXRlSW5mbyA9IHRoaXMuZ2V0VGVtcGxhdGVJbmZvKGF0dHJpYnV0ZU1vZGVsKTtcbiAgICAgIHZhciBleHRyYUtleXMgPSBhdHRyaWJ1dGVNb2RlbC5nZXRPcHRpb24oXCJ0ZW1wbGF0ZUtleXNcIik7XG5cbiAgICAgIF8uZWFjaChkb2N1bWVudERhdGEuYXR0cmlidXRlTGFiZWxzLCBmdW5jdGlvbiBhdHRyaWJ1dGVUZW1wbGF0ZV9lYWNoTGFiZWwoXG4gICAgICAgIGF0dHJpYnV0ZUxhYmVsLFxuICAgICAgICBhdHRyaWJ1dGVJZFxuICAgICAgKSB7XG4gICAgICAgIHZhciBjdXJyZW50QXR0cmlidXRlTW9kZWwgPSBhdHRyaWJ1dGVNb2RlbFxuICAgICAgICAgIC5nZXREb2N1bWVudE1vZGVsKClcbiAgICAgICAgICAuZ2V0KFwiYXR0cmlidXRlc1wiKVxuICAgICAgICAgIC5nZXQoYXR0cmlidXRlSWQpO1xuICAgICAgICAvLyBSZXNldCBzb21lIHNwZWNpYWwga2V5cyB3aGljaCBhcmUgbm90IGFsbG93ZWQgaGVyZVxuICAgICAgICBpZiAoY3VycmVudEF0dHJpYnV0ZU1vZGVsLmdldChcInR5cGVcIikgPT09IFwiYXJyYXlcIikge1xuICAgICAgICAgIHRlbXBsYXRlSW5mby5hdHRyaWJ1dGVzW2F0dHJpYnV0ZUlkXS5yb3dzID0gW107XG4gICAgICAgICAgdGVtcGxhdGVJbmZvLmF0dHJpYnV0ZXNbYXR0cmlidXRlSWRdLnRhYmxlVG9vbHMgPVxuICAgICAgICAgICAgXCJOTyBUQUJMRSBUT09MIEFMTE9XRUQgSEVSRVwiO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgdGVtcGxhdGVJbmZvLnJvd1Rvb2xzID0gdGhpcy5nZXRSb3dUb29sKGF0dHJpYnV0ZU1vZGVsKTtcbiAgICAgIHRlbXBsYXRlSW5mby5jb250ZW50ID0ge307XG4gICAgICBhdHRyaWJ1dGVNb2RlbFxuICAgICAgICAuZ2V0KFwiY29udGVudFwiKVxuICAgICAgICAuZWFjaChmdW5jdGlvbiBhdHRyaWJ1dGVUZW1wbGF0ZV9lYWNoQ29udGVudChjdXJyZW50QXR0cmlidXRlKSB7XG4gICAgICAgICAgdmFyIGF0dHJpYnV0ZUlkID0gY3VycmVudEF0dHJpYnV0ZS5pZDtcbiAgICAgICAgICB2YXIgYXR0cmlidXRlTGFiZWwgPSBjdXJyZW50QXR0cmlidXRlLmdldChcImxhYmVsXCIpO1xuXG4gICAgICAgICAgaWYgKCFjdXJyZW50QXR0cmlidXRlLmlzRGlzcGxheWFibGUoKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmIChjdXJyZW50QXR0cmlidXRlLmdldE9wdGlvbihcImF0dHJpYnV0ZUxhYmVsXCIpKSB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVMYWJlbCA9IGN1cnJlbnRBdHRyaWJ1dGUuZ2V0T3B0aW9uKFwiYXR0cmlidXRlTGFiZWxcIik7XG4gICAgICAgICAgfVxuICAgICAgICAgIHRlbXBsYXRlSW5mby5jb250ZW50W2F0dHJpYnV0ZUlkXSA9IHt9O1xuICAgICAgICAgIHRlbXBsYXRlSW5mby5jb250ZW50W2F0dHJpYnV0ZUlkXS5hdHRyaWJ1dGVWYWx1ZSA9IHtcbiAgICAgICAgICAgIHZhbHVlOiBudWxsLCAvLyBObyB2YWx1ZSBmb3IgdGhlIG1vbWVudC4gVmFsdWUgd2lsbCBiZSBzZXQgYnkgYXJyYXkgdmlldyB3aXRoIGRlZmF1bHQgdmFsdWVzXG4gICAgICAgICAgICBkaXNwbGF5VmFsdWU6IFwiXCJcbiAgICAgICAgICB9O1xuICAgICAgICAgIHRlbXBsYXRlSW5mby5jb250ZW50W2F0dHJpYnV0ZUlkXS5sYWJlbCA9IGF0dHJpYnV0ZUxhYmVsO1xuICAgICAgICAgIHRlbXBsYXRlSW5mby5jb250ZW50W2F0dHJpYnV0ZUlkXS5odG1sQ29udGVudCA9XG4gICAgICAgICAgICAnPGRpdiBjbGFzcz1cImRjcEN1c3RvbVRlbXBsYXRlLS1yb3cgZGNwQXJyYXlfX2NvbnRlbnRfX2NlbGwgZGNwQXR0cmlidXRlX19jb250ZW50XCIgZGF0YS1kaXNwbGF5bGFiZWw9XCJmYWxzZVwiIGRhdGEtYXR0cmlkPVwiJyArXG4gICAgICAgICAgICBhdHRyaWJ1dGVJZCArXG4gICAgICAgICAgICAnXCIvPic7XG4gICAgICAgIH0pO1xuXG4gICAgICBpZiAoZXh0cmFLZXlzICYmIGV4dHJhS2V5cy5hdHRyaWJ1dGUgJiYgZXh0cmFLZXlzLmF0dHJpYnV0ZS5yb3dzKSB7XG4gICAgICAgIF8uZWFjaChcbiAgICAgICAgICBleHRyYUtleXMuYXR0cmlidXRlLnJvd3MsXG4gICAgICAgICAgZnVuY3Rpb24gYXR0cmlidXRlVGVtcGxhdGVnZXRMaW5lSW5mb0VhY2goZXh0cmFWYWx1ZXMsIGV4dHJhS2V5KSB7XG4gICAgICAgICAgICB0ZW1wbGF0ZUluZm9bZXh0cmFLZXldID0gZXh0cmFWYWx1ZXNbaW5kZXhdO1xuICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHRlbXBsYXRlSW5mbztcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogRXh0cmFjdCByb3dzIHRlbXBsYXRlIGxpbmUgdG8gY3VzdG9tTGluZVRlbXBsYXRlXG4gICAgICogQHBhcmFtIGF0dHJNb2RlbFxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHJldHVybnMge3thdHRyaWJ1dGU6IHtyb3dzOiBGdW5jdGlvbn19fVxuICAgICAqL1xuICAgIGV4dHJhY3RSb3c6IGZ1bmN0aW9uIGF0dHJpYnV0ZVRlbXBsYXRlRXh0cmFjdFJvdyhhdHRyTW9kZWwpIHtcbiAgICAgIHZhciBzY29wZSA9IHRoaXM7XG4gICAgICB2YXIgaW5mbztcblxuICAgICAgaW5mbyA9IHtcbiAgICAgICAgYXR0cmlidXRlOiB7XG4gICAgICAgICAgcm93czogZnVuY3Rpb24gYXR0cmlidXRlVGVtcGxhdGVFeHRyYWN0Um93Q29udGVudCgpIHtcbiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiBhdHRyaWJ1dGVUZW1wbGF0ZV9nZXRSb3dDb250ZW50KHRleHQpIHtcbiAgICAgICAgICAgICAgc2NvcGUuY3VzdG9tTGluZVRlbXBsYXRlID0gdGV4dC50cmltKCk7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIGluZm8uYXR0cmlidXRlcyA9IHt9O1xuICAgICAgaW5mby5hdHRyaWJ1dGVzW2F0dHJNb2RlbC5pZF0gPSBpbmZvLmF0dHJpYnV0ZXM7XG4gICAgICByZXR1cm4gaW5mbztcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQ29uc3RydWN0IGN1c3RvbSBsaW5lIChkZWNsYXJlZCBpbiB2QXJyYXk6OnJlbmRlciBhbmQgdXNlZCBpbiB3QXJyYXk6Ol9nZXRMaW5lQ29udGVudClcbiAgICAgKiBAcGFyYW0gaW5kZXhcbiAgICAgKiBAcGFyYW0gYXR0ck1vZGVsXG4gICAgICogQHJldHVybnMgeyp8SFRNTEVsZW1lbnR9XG4gICAgICovXG4gICAgY3VzdG9tQXJyYXlSb3dWaWV3OiBmdW5jdGlvbiBhdHRyaWJ1dGVUZW1wbGF0ZUN1c3RvbUFycmF5Um93VmlldyhcbiAgICAgIGluZGV4LFxuICAgICAgYXR0ck1vZGVsXG4gICAgKSB7XG4gICAgICB2YXIgJHJlbmRlcjtcblxuICAgICAgLy8gRXh0cmFjdCBsaW5lIHRvIGN1c3RvbUxpbmVUZW1wbGF0ZSB2YXJpYWJsZVxuICAgICAgTXVzdGFjaGUucmVuZGVyKFxuICAgICAgICBhdHRyTW9kZWwuZ2V0T3B0aW9uKFwidGVtcGxhdGVcIikgfHwgXCJcIixcbiAgICAgICAgdGhpcy5leHRyYWN0Um93KGF0dHJNb2RlbClcbiAgICAgICk7XG4gICAgICAkcmVuZGVyID0gJChcbiAgICAgICAgTXVzdGFjaGUucmVuZGVyKFxuICAgICAgICAgIHRoaXMuY3VzdG9tTGluZVRlbXBsYXRlIHx8IFwiXCIsXG4gICAgICAgICAgdGhpcy5nZXRMaW5lSW5mbyhhdHRyTW9kZWwsIGluZGV4KVxuICAgICAgICApXG4gICAgICApO1xuXG4gICAgICByZXR1cm4gJHJlbmRlcjtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogR2V0IGVsZW1lbnQgd2hlcmUgY3VzdG9tIHRlbXBsYXRlIHdpbGwgYmUgaW5zZXJ0ZWQgKGh0bWxDb250ZW50IGFuZCBodG1sVmlldylcbiAgICAgKiBAcGFyYW0gYXR0cmlidXRlTW9kZWxcbiAgICAgKiBAcGFyYW0gZGlzcGxheUxhYmVsXG4gICAgICogQHBhcmFtIG9yaWdpbmFsVmlld1xuICAgICAqIEBwcml2YXRlXG4gICAgICogQHJldHVybnMge3N0cmluZ31cbiAgICAgKi9cbiAgICBnZXRDdXN0b21UZW1wbGF0ZTogZnVuY3Rpb24gYXR0cmlidXRlVGVtcGxhdGVnZXRDdXN0b21UZW1wbGF0ZShcbiAgICAgIGF0dHJpYnV0ZU1vZGVsLFxuICAgICAgZGlzcGxheUxhYmVsLFxuICAgICAgb3JpZ2luYWxWaWV3XG4gICAgKSB7XG4gICAgICBpZiAoYXR0cmlidXRlTW9kZWwuZ2V0KFwibW9kZVwiKSA9PT0gXCJoaWRkZW5cIikge1xuICAgICAgICByZXR1cm4gXCJcIjtcbiAgICAgIH1cbiAgICAgIHJldHVybiAoXG4gICAgICAgICc8ZGl2IGNsYXNzPVwiZGNwQ3VzdG9tVGVtcGxhdGUtLWNvbnRlbnQgJyArXG4gICAgICAgIChkaXNwbGF5TGFiZWxcbiAgICAgICAgICA/IFwiZGNwQ3VzdG9tVGVtcGxhdGUtLWNvbnRlbnQtLXZpZXdcIlxuICAgICAgICAgIDogXCJkY3BDdXN0b21UZW1wbGF0ZS0tY29udGVudC0tdmFsdWVcIikgK1xuICAgICAgICAnXCIgZGF0YS1kaXNwbGF5bGFiZWw9XCInICtcbiAgICAgICAgKGRpc3BsYXlMYWJlbCA/IFwidHJ1ZVwiIDogXCJmYWxzZVwiKSArXG4gICAgICAgICdcIiBkYXRhLW9yaWdpbmFsdmlldz1cIicgK1xuICAgICAgICAob3JpZ2luYWxWaWV3ID8gXCJ0cnVlXCIgOiBcImZhbHNlXCIpICtcbiAgICAgICAgJ1wiIGRhdGEtYXR0cmlkPVwiJyArXG4gICAgICAgIGF0dHJpYnV0ZU1vZGVsLmlkICtcbiAgICAgICAgJ1wiLz4nXG4gICAgICApO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBFeHRyYWN0IGRjcEFycmF5X190b29scyBmcm9tIGNvbnRlbnQgYXJyYXkgdGVtcGxhdGVcbiAgICAgKiBAcGFyYW0gYXR0cmlidXRlTW9kZWxcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEByZXR1cm5zIHsqfVxuICAgICAqL1xuICAgIGdldEFycmF5VG9vbHM6IGZ1bmN0aW9uIGF0dHJpYnV0ZVRlbXBsYXRlR2V0QXJyYXlUb29scyhhdHRyaWJ1dGVNb2RlbCkge1xuICAgICAgdmFyIHRwbHMgPSBhdHRyaWJ1dGVNb2RlbC5nZXRUZW1wbGF0ZXMoKS5hdHRyaWJ1dGVbXG4gICAgICAgIGF0dHJpYnV0ZU1vZGVsLmdldChcInR5cGVcIilcbiAgICAgIF07XG4gICAgICBpZiAodHBscyAmJiB0cGxzLmNvbnRlbnQpIHtcbiAgICAgICAgcmV0dXJuICQoTXVzdGFjaGUucmVuZGVyKHRwbHMuY29udGVudCB8fCBcIlwiLCB7IHRvb2xzOiB0cnVlIH0pKVxuICAgICAgICAgIC5maW5kKFwiLmRjcEFycmF5X190b29sc1wiKVxuICAgICAgICAgIC5nZXQoMCkub3V0ZXJIVE1MO1xuICAgICAgfVxuICAgICAgcmV0dXJuIFwibm8gdG9vbHNcIjtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogRXh0cmFjdCBkY3BBcnJheV9fY29udGVudF9fdG9vbENlbGwgZnJvbSBsaW5lIGFycmF5IHRlbXBsYXRlXG4gICAgICogQHBhcmFtIGF0dHJpYnV0ZU1vZGVsXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcmV0dXJucyB7Kn1cbiAgICAgKi9cbiAgICBnZXRSb3dUb29sOiBmdW5jdGlvbiBhdHRyaWJ1dGVUZW1wbGF0ZUdldFJvd1Rvb2woYXR0cmlidXRlTW9kZWwpIHtcbiAgICAgIHZhciB0ZW1wbGF0ZXMgPSBhdHRyaWJ1dGVNb2RlbC5nZXRUZW1wbGF0ZXMoKS5hdHRyaWJ1dGVbXG4gICAgICAgIGF0dHJpYnV0ZU1vZGVsLmdldChcInR5cGVcIilcbiAgICAgIF07XG4gICAgICB2YXIgdG9vbCA9IFwiXCI7XG4gICAgICBpZiAodGVtcGxhdGVzICYmIHRlbXBsYXRlcy5saW5lKSB7XG4gICAgICAgIHRvb2wgPSAkKFxuICAgICAgICAgIE11c3RhY2hlLnJlbmRlcih0ZW1wbGF0ZXMubGluZSB8fCBcIlwiLCB7XG4gICAgICAgICAgICB0b29sczogdHJ1ZSxcbiAgICAgICAgICAgIGxpbmVDaWQ6IF8udW5pcXVlSWQoYXR0cmlidXRlTW9kZWwuaWQpXG4gICAgICAgICAgfSlcbiAgICAgICAgKVxuICAgICAgICAgIC5maW5kKFwiLmRjcEFycmF5X190b29sQ2VsbFwiKVxuICAgICAgICAgIC5odG1sKCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gdG9vbDtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogR2V0IGRhdGEgZm9yIG11c3RhY2hlIFwicm93c1wiIHZhcmlhYmxlXG4gICAgICogQHBhcmFtIGF0dHJpYnV0ZU1vZGVsXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcmV0dXJucyB7QXJyYXl9XG4gICAgICovXG4gICAgZ2V0QXJyYXlSb3dJbmZvOiBmdW5jdGlvbiBhdHRyaWJ1dGVUZW1wbGF0ZWdldEFycmF5Um93SW5mbyhhdHRyaWJ1dGVNb2RlbCkge1xuICAgICAgdmFyIHJvd3MgPSBbXTtcbiAgICAgIHZhciBsaW5lID0gdGhpcy5nZXRSb3dUb29sKGF0dHJpYnV0ZU1vZGVsKTtcblxuICAgICAgYXR0cmlidXRlTW9kZWxcbiAgICAgICAgLmdldChcImNvbnRlbnRcIilcbiAgICAgICAgLmVhY2goZnVuY3Rpb24gYXR0cmlidXRlVGVtcGxhdGVfZWFjaENvbnRlbnQoY3VycmVudEF0dHJpYnV0ZSkge1xuICAgICAgICAgIHZhciB2YWx1ZXM7XG4gICAgICAgICAgdmFyIGF0dHJpYnV0ZUlkID0gY3VycmVudEF0dHJpYnV0ZS5pZDtcbiAgICAgICAgICB2YXIgYXR0cmlidXRlTGFiZWwgPSBjdXJyZW50QXR0cmlidXRlLmdldChcImxhYmVsXCIpO1xuICAgICAgICAgIGlmICghY3VycmVudEF0dHJpYnV0ZS5pc0Rpc3BsYXlhYmxlKCkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpZiAoY3VycmVudEF0dHJpYnV0ZS5nZXRPcHRpb24oXCJhdHRyaWJ1dGVMYWJlbFwiKSkge1xuICAgICAgICAgICAgYXR0cmlidXRlTGFiZWwgPSBjdXJyZW50QXR0cmlidXRlLmdldE9wdGlvbihcImF0dHJpYnV0ZUxhYmVsXCIpO1xuICAgICAgICAgIH1cbiAgICAgICAgICB2YWx1ZXMgPSBjdXJyZW50QXR0cmlidXRlLmdldChcImF0dHJpYnV0ZVZhbHVlXCIpO1xuICAgICAgICAgIF8uZWFjaCh2YWx1ZXMsIGZ1bmN0aW9uIGF0dHJpYnV0ZVRlbXBsYXRlZ2V0QXJyYXlSb3dJbmZvRWFjaChcbiAgICAgICAgICAgIHNpbmdsZVZhbHVlLFxuICAgICAgICAgICAgaW5kZXhcbiAgICAgICAgICApIHtcbiAgICAgICAgICAgIGlmIChfLmlzVW5kZWZpbmVkKHJvd3NbaW5kZXhdKSkge1xuICAgICAgICAgICAgICByb3dzW2luZGV4XSA9IHsgY29udGVudDoge30gfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJvd3NbaW5kZXhdLmluZGV4ID0gaW5kZXg7XG4gICAgICAgICAgICByb3dzW2luZGV4XS5jb250ZW50W2F0dHJpYnV0ZUlkXSA9IHtcbiAgICAgICAgICAgICAgbGFiZWw6IGF0dHJpYnV0ZUxhYmVsLFxuICAgICAgICAgICAgICBhdHRyaWJ1dGVWYWx1ZTogc2luZ2xlVmFsdWUsXG4gICAgICAgICAgICAgIGh0bWxDb250ZW50OlxuICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwiZGNwQ3VzdG9tVGVtcGxhdGUtLXJvdyBkY3BBcnJheV9fY29udGVudF9fY2VsbCBkY3BBdHRyaWJ1dGVfX2NvbnRlbnRcIiAgZGF0YS1hdHRyaWQ9XCInICtcbiAgICAgICAgICAgICAgICBjdXJyZW50QXR0cmlidXRlLmlkICtcbiAgICAgICAgICAgICAgICAnXCIvPidcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHJvd3NbaW5kZXhdLnJvd1Rvb2xzID0gbGluZTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgIHJldHVybiByb3dzO1xuICAgIH0sXG5cbiAgICByZW5kZXJDbGlja0Rlc2M6IGZ1bmN0aW9uKCR0aXAsIG5zT24pIHtcbiAgICAgICR0aXBcbiAgICAgICAgLm9uKFwiY2xpY2tcIiArIG5zT24sIGZ1bmN0aW9uIHZBdHRyaWJ1dGVTaG93RGVzYyhldmVudCkge1xuICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICQodGhpcykudG9vbHRpcChcInRvZ2dsZVwiKTtcbiAgICAgICAgfSlcbiAgICAgICAgLm9uZShcInNob3cuYnMudG9vbHRpcFwiLCBmdW5jdGlvbiB3RGVzY1Rvb2x0aXAoKSB7XG4gICAgICAgICAgdmFyIHRpcEVsZW1lbnQgPSAkKHRoaXMpLmRhdGEoXCJicy50b29sdGlwXCIpLnRpcDtcbiAgICAgICAgICBpZiAodGlwRWxlbWVudCkge1xuICAgICAgICAgICAgJCh0aXBFbGVtZW50KS5hZGRDbGFzcyhcImRjcEF0dHJpYnV0ZV9fZGVzY3JpcHRpb24taW5mb1wiKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICAgIC5vbmUoXCJzaG93bi5icy50b29sdGlwXCIsIGZ1bmN0aW9uIHdEZXNjVG9vbHRpcCgpIHtcbiAgICAgICAgICB2YXIgdGlwRWxlbWVudCA9ICQodGhpcykuZGF0YShcImJzLnRvb2x0aXBcIikudGlwO1xuICAgICAgICAgIGlmICh0aXBFbGVtZW50KSB7XG4gICAgICAgICAgICAkKHRpcEVsZW1lbnQpXG4gICAgICAgICAgICAgIC5maW5kKFwiLnRvb2x0aXAtaW5uZXJcIilcbiAgICAgICAgICAgICAgLnByZXBlbmQoXG4gICAgICAgICAgICAgICAgJzxzcGFuIGNsYXNzPVwiYnRuIGJ0bi1zZWNvbmRhcnkgYnV0dG9uLWNsb3NlLWVycm9yXCI+PHNwYW4gY2xhc3M9XCJmYSBmYS10aW1lc1wiIC8+Jm5ic3A7PC9zcGFuPidcbiAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgJCh0aXBFbGVtZW50KS5vbihcbiAgICAgICAgICAgICAgXCJjbGlja1wiICsgbnNPbixcbiAgICAgICAgICAgICAgXCIuYnV0dG9uLWNsb3NlLWVycm9yXCIsXG4gICAgICAgICAgICAgIGZ1bmN0aW9uIHZBdHRyaWJ1dGVDbG9zZURlc2MoZXZlbnQpIHtcbiAgICAgICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICAkKHRpcEVsZW1lbnQpLnRvb2x0aXAoXCJoaWRlXCIpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEluc2VydCBhdHRyaWJ1dGUgZGVzY3JpcHRpb25cbiAgICAgKiBAcGFyYW0gYXR0cmlidXRlVmlldyBCYWNrYm9uZSB2aWV3XG4gICAgICogQHBhcmFtICRjdXN0b21FbGVtZW50IHNwZWNpZmljIG90aGVyIERPTSBlbGVtZW50IGluc3RlYWQgb2YgZGVmYXVsdCBlbGVtZW50IHZpZXdcbiAgICAgKi9cbiAgICBpbnNlcnREZXNjcmlwdGlvbjogZnVuY3Rpb24gYXR0cmlidXRlVGVtcGxhdGVJbnNlcnREZXNjcmlwdGlvbihcbiAgICAgIGF0dHJpYnV0ZVZpZXcsXG4gICAgICAkY3VzdG9tRWxlbWVudFxuICAgICkge1xuICAgICAgdmFyIGRhdGEgPSBhdHRyaWJ1dGVWaWV3Lm1vZGVsLnRvRGF0YShudWxsLCB0cnVlKTtcblxuICAgICAgaWYgKCFkYXRhLnJlbmRlck9wdGlvbnMuZGVzY3JpcHRpb24pIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgdmFyIGRlc2NyaXB0aW9uVGVtcGxhdGU7XG4gICAgICB2YXIgJHRpcDtcbiAgICAgIHZhciBuc09uID0gXCIudlwiICsgYXR0cmlidXRlVmlldy5tb2RlbC5jaWQ7XG4gICAgICB2YXIgJHZpZXdFbGVtZW50ID0gJGN1c3RvbUVsZW1lbnQgPyAkY3VzdG9tRWxlbWVudCA6IGF0dHJpYnV0ZVZpZXcuJGVsO1xuICAgICAgdmFyIGlzRnJhbWUgPSAkdmlld0VsZW1lbnQuaGFzQ2xhc3MoXCJkY3BGcmFtZVwiKTtcbiAgICAgIHZhciBpc0FycmF5ID0gJHZpZXdFbGVtZW50Lmhhc0NsYXNzKFwiZGNwQXJyYXlcIik7XG4gICAgICB2YXIgaXNBcnJheUhlYWQgPSAkdmlld0VsZW1lbnQuaGFzQ2xhc3MoXCJkY3BBcnJheV9faGVhZF9fY2VsbFwiKTtcbiAgICAgIHZhciBpc0FycmF5Q2VsbCA9ICR2aWV3RWxlbWVudC5oYXNDbGFzcyhcImRjcEFycmF5X19jZWxsXCIpO1xuICAgICAgdmFyIGlzQXR0cmlidXRlID0gJHZpZXdFbGVtZW50Lmhhc0NsYXNzKFwiZGNwQXR0cmlidXRlXCIpO1xuICAgICAgdmFyIGlzVGFiQ29udGVudCA9ICR2aWV3RWxlbWVudC5oYXNDbGFzcyhcImRjcFRhYl9fY29udGVudFwiKTtcbiAgICAgIHZhciBpc1RhYkxhYmVsID0gJHZpZXdFbGVtZW50Lmhhc0NsYXNzKFwiZGNwVGFiX19sYWJlbFwiKTtcbiAgICAgIHZhciAkZGVzY3JpcHRpb25FbGVtZW50O1xuXG4gICAgICBkZXNjcmlwdGlvblRlbXBsYXRlID0gYXR0cmlidXRlVmlldy5tb2RlbC5nZXRUZW1wbGF0ZXMoKS5hdHRyaWJ1dGVcbiAgICAgICAgLmRlc2NyaXB0aW9uO1xuICAgICAgZGF0YS5yZW5kZXJPcHRpb25zLmRlc2NyaXB0aW9uLmh0bWxDb250ZW50UmVuZGVyID0gTXVzdGFjaGUucmVuZGVyKFxuICAgICAgICBkYXRhLnJlbmRlck9wdGlvbnMuZGVzY3JpcHRpb24uaHRtbENvbnRlbnQsXG4gICAgICAgIGRhdGFcbiAgICAgICk7XG4gICAgICBkYXRhLnJlbmRlck9wdGlvbnMuZGVzY3JpcHRpb24uaHRtbFRpdGxlUmVuZGVyID0gTXVzdGFjaGUucmVuZGVyKFxuICAgICAgICBkYXRhLnJlbmRlck9wdGlvbnMuZGVzY3JpcHRpb24uaHRtbFRpdGxlLFxuICAgICAgICBkYXRhXG4gICAgICApO1xuXG4gICAgICAkZGVzY3JpcHRpb25FbGVtZW50ID0gJChNdXN0YWNoZS5yZW5kZXIoZGVzY3JpcHRpb25UZW1wbGF0ZSB8fCBcIlwiLCBkYXRhKSk7XG5cbiAgICAgIGlmIChpc0ZyYW1lKSB7XG4gICAgICAgIHN3aXRjaCAoZGF0YS5yZW5kZXJPcHRpb25zLmRlc2NyaXB0aW9uLnBvc2l0aW9uKSB7XG4gICAgICAgICAgY2FzZSBcImJvdHRvbVwiOlxuICAgICAgICAgICAgJHZpZXdFbGVtZW50LmFwcGVuZCgkZGVzY3JpcHRpb25FbGVtZW50KTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgXCJ0b3BcIjpcbiAgICAgICAgICBjYXNlIFwidG9wTGFiZWxcIjpcbiAgICAgICAgICAgICR2aWV3RWxlbWVudC5wcmVwZW5kKCRkZXNjcmlwdGlvbkVsZW1lbnQpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSBcImxlZnRcIjpcbiAgICAgICAgICAgICR2aWV3RWxlbWVudFxuICAgICAgICAgICAgICAuZmluZChcIi5kY3BGcmFtZV9fY29udGVudFwiKVxuICAgICAgICAgICAgICAuYWRkQ2xhc3MoXCJkY3BGcmFtZV9fY29udGVudC0tbGVmdC1kZXNjcmlwdGlvblwiKTtcbiAgICAgICAgICAgICRkZXNjcmlwdGlvbkVsZW1lbnQuaW5zZXJ0QWZ0ZXIoXG4gICAgICAgICAgICAgICR2aWV3RWxlbWVudC5maW5kKFwiLmRjcEZyYW1lX19sYWJlbFwiKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgXCJyaWdodFwiOlxuICAgICAgICAgICAgLy8gTmVlZCB0byBhZGQgY2xhc3MgYmVjYXVzZSBubyBoYXZlIGNzcyBzZWxlY3RvclxuICAgICAgICAgICAgJHZpZXdFbGVtZW50LmFwcGVuZCgkZGVzY3JpcHRpb25FbGVtZW50KTtcbiAgICAgICAgICAgICR2aWV3RWxlbWVudFxuICAgICAgICAgICAgICAuZmluZChcIi5kY3BGcmFtZV9fY29udGVudFwiKVxuICAgICAgICAgICAgICAuYWRkQ2xhc3MoXCJkY3BGcmFtZV9fY29udGVudC0tcmlnaHQtZGVzY3JpcHRpb25cIik7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIFwiYm90dG9tTGFiZWxcIjpcbiAgICAgICAgICAgICRkZXNjcmlwdGlvbkVsZW1lbnQuaW5zZXJ0QWZ0ZXIoXG4gICAgICAgICAgICAgICR2aWV3RWxlbWVudC5maW5kKFwiLmRjcEZyYW1lX19sYWJlbFwiKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgXCJ0b3BWYWx1ZVwiOlxuICAgICAgICAgICAgJHZpZXdFbGVtZW50XG4gICAgICAgICAgICAgIC5maW5kKFwiLmRjcEZyYW1lX19jb250ZW50XCIpXG4gICAgICAgICAgICAgIC5wcmVwZW5kKCRkZXNjcmlwdGlvbkVsZW1lbnQpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSBcImJvdHRvbVZhbHVlXCI6XG4gICAgICAgICAgICAkdmlld0VsZW1lbnQuZmluZChcIi5kY3BGcmFtZV9fY29udGVudFwiKS5hcHBlbmQoJGRlc2NyaXB0aW9uRWxlbWVudCk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIFwiY2xpY2tcIjpcbiAgICAgICAgICAgICR2aWV3RWxlbWVudC5hcHBlbmQoJGRlc2NyaXB0aW9uRWxlbWVudCk7XG4gICAgICAgICAgICAkdmlld0VsZW1lbnRcbiAgICAgICAgICAgICAgLmZpbmQoXCIuZGNwRnJhbWVfX2xhYmVsXCIpXG4gICAgICAgICAgICAgIC5wcmVwZW5kKFxuICAgICAgICAgICAgICAgICc8YSBjbGFzcz1cImRjcEF0dHJpYnV0ZV9fbGFiZWxfZGVzY3JpcHRpb25cIj48c3BhbiBjbGFzcz1cImZhIGZhLWluZm8tY2lyY2xlXCI+PC9zcGFuPjwvYT4nXG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAkdGlwID0gJHZpZXdFbGVtZW50XG4gICAgICAgICAgICAgIC5maW5kKFwiLmRjcEZyYW1lX19sYWJlbCA+IC5kY3BBdHRyaWJ1dGVfX2xhYmVsX2Rlc2NyaXB0aW9uXCIpXG4gICAgICAgICAgICAgIC50b29sdGlwKHtcbiAgICAgICAgICAgICAgICBodG1sOiB0cnVlLFxuICAgICAgICAgICAgICAgIGNvbnRhaW5lcjogJHZpZXdFbGVtZW50LFxuICAgICAgICAgICAgICAgIHRpdGxlOiAkZGVzY3JpcHRpb25FbGVtZW50LFxuICAgICAgICAgICAgICAgIHBsYWNlbWVudDogXCJhdXRvXCIsXG4gICAgICAgICAgICAgICAgdHJpZ2dlcjogXCJtYW51YWxcIlxuICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdGhpcy5yZW5kZXJDbGlja0Rlc2MoJHRpcCwgbnNPbik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChpc1RhYkNvbnRlbnQgfHwgaXNUYWJMYWJlbCkge1xuICAgICAgICBzd2l0Y2ggKGRhdGEucmVuZGVyT3B0aW9ucy5kZXNjcmlwdGlvbi5wb3NpdGlvbikge1xuICAgICAgICAgIGNhc2UgXCJ0b3BcIjpcbiAgICAgICAgICBjYXNlIFwidG9wVmFsdWVcIjpcbiAgICAgICAgICAgIGlmIChpc1RhYkNvbnRlbnQpIHtcbiAgICAgICAgICAgICAgJHZpZXdFbGVtZW50LnByZXBlbmQoJGRlc2NyaXB0aW9uRWxlbWVudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIFwiYm90dG9tXCI6XG4gICAgICAgICAgY2FzZSBcImJvdHRvbVZhbHVlXCI6XG4gICAgICAgICAgICBpZiAoaXNUYWJDb250ZW50KSB7XG4gICAgICAgICAgICAgICR2aWV3RWxlbWVudC5hcHBlbmQoJGRlc2NyaXB0aW9uRWxlbWVudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIFwiY2xpY2tcIjpcbiAgICAgICAgICAgIGlmIChpc1RhYkxhYmVsKSB7XG4gICAgICAgICAgICAgICR2aWV3RWxlbWVudC5hcHBlbmQoJGRlc2NyaXB0aW9uRWxlbWVudCk7XG4gICAgICAgICAgICAgICR2aWV3RWxlbWVudFxuICAgICAgICAgICAgICAgIC5maW5kKFwiLmRjcExhYmVsX190ZXh0XCIpXG4gICAgICAgICAgICAgICAgLnByZXBlbmQoXG4gICAgICAgICAgICAgICAgICAnPGEgY2xhc3M9XCJkY3BBdHRyaWJ1dGVfX2xhYmVsX2Rlc2NyaXB0aW9uXCI+PHNwYW4gY2xhc3M9XCJmYSBmYS1pbmZvLWNpcmNsZVwiPjwvc3Bhbj48L2E+J1xuICAgICAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgICAgJHRpcCA9ICR2aWV3RWxlbWVudFxuICAgICAgICAgICAgICAgIC5maW5kKFwiLmRjcEF0dHJpYnV0ZV9fbGFiZWxfZGVzY3JpcHRpb25cIilcbiAgICAgICAgICAgICAgICAudG9vbHRpcCh7XG4gICAgICAgICAgICAgICAgICBodG1sOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgY29udGFpbmVyOiBcIi5kY3BEb2N1bWVudFwiLFxuICAgICAgICAgICAgICAgICAgdGl0bGU6ICRkZXNjcmlwdGlvbkVsZW1lbnQsXG4gICAgICAgICAgICAgICAgICBwbGFjZW1lbnQ6IFwiYXV0b1wiLFxuICAgICAgICAgICAgICAgICAgdHJpZ2dlcjogXCJtYW51YWxcIlxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgIHRoaXMucmVuZGVyQ2xpY2tEZXNjKCR0aXAsIG5zT24pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICBjYXNlIFwiYm90dG9tTGFiZWxcIjpcbiAgICAgICAgICBjYXNlIFwidG9wTGFiZWxcIjpcbiAgICAgICAgICBjYXNlIFwibGVmdFwiOlxuICAgICAgICAgIGNhc2UgXCJyaWdodFwiOlxuICAgICAgICAgICAgY29uc29sZS5lcnJvcihcbiAgICAgICAgICAgICAgJ0Nhbm5vdCB1c2UgXCInICtcbiAgICAgICAgICAgICAgICBkYXRhLnJlbmRlck9wdGlvbnMuZGVzY3JpcHRpb24ucG9zaXRpb24gK1xuICAgICAgICAgICAgICAgICdcIiBkZXNjcmlwdGlvbiBwb3NpdGlvbiBpbiB0YWIgYXR0cmlidXRlIDogJyArXG4gICAgICAgICAgICAgICAgZGF0YS5pZFxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKGlzQXJyYXkpIHtcbiAgICAgICAgc3dpdGNoIChkYXRhLnJlbmRlck9wdGlvbnMuZGVzY3JpcHRpb24ucG9zaXRpb24pIHtcbiAgICAgICAgICBjYXNlIFwidG9wXCI6XG4gICAgICAgICAgICAkdmlld0VsZW1lbnQucHJlcGVuZCgkZGVzY3JpcHRpb25FbGVtZW50KTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgXCJ0b3BMYWJlbFwiOlxuICAgICAgICAgICAgJHZpZXdFbGVtZW50LmZpbmQoXCIuZGNwQXJyYXlfX2xhYmVsXCIpLnByZXBlbmQoJGRlc2NyaXB0aW9uRWxlbWVudCk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIFwiYm90dG9tTGFiZWxcIjpcbiAgICAgICAgICAgICR2aWV3RWxlbWVudC5maW5kKFwiLmRjcEFycmF5X19sYWJlbFwiKS5hcHBlbmQoJGRlc2NyaXB0aW9uRWxlbWVudCk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIFwidG9wVmFsdWVcIjpcbiAgICAgICAgICAgICR2aWV3RWxlbWVudFxuICAgICAgICAgICAgICAuZmluZChcIi5kY3BBcnJheV9fY29udGVudFwiKVxuICAgICAgICAgICAgICAucHJlcGVuZCgkZGVzY3JpcHRpb25FbGVtZW50KTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgXCJib3R0b21WYWx1ZVwiOlxuICAgICAgICAgICAgJGRlc2NyaXB0aW9uRWxlbWVudC5pbnNlcnRBZnRlcihcbiAgICAgICAgICAgICAgJHZpZXdFbGVtZW50LmZpbmQoXCIuZGNwQXJyYXlfX3RhYmxlXCIpXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSBcImJvdHRvbVwiOlxuICAgICAgICAgICAgJHZpZXdFbGVtZW50LmFwcGVuZCgkZGVzY3JpcHRpb25FbGVtZW50KTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgXCJjbGlja1wiOlxuICAgICAgICAgICAgJHZpZXdFbGVtZW50LmFwcGVuZCgkZGVzY3JpcHRpb25FbGVtZW50KTtcbiAgICAgICAgICAgICR2aWV3RWxlbWVudFxuICAgICAgICAgICAgICAuZmluZChcIi5kY3BBcnJheV9fbGFiZWxcIilcbiAgICAgICAgICAgICAgLnByZXBlbmQoXG4gICAgICAgICAgICAgICAgJzxhIGNsYXNzPVwiZGNwQXR0cmlidXRlX19sYWJlbF9kZXNjcmlwdGlvblwiPjxzcGFuIGNsYXNzPVwiZmEgZmEtaW5mby1jaXJjbGVcIj48L3NwYW4+PC9hPidcbiAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgJHRpcCA9ICR2aWV3RWxlbWVudFxuICAgICAgICAgICAgICAuZmluZChcIi5kY3BBcnJheV9fbGFiZWwgPiAuZGNwQXR0cmlidXRlX19sYWJlbF9kZXNjcmlwdGlvblwiKVxuICAgICAgICAgICAgICAudG9vbHRpcCh7XG4gICAgICAgICAgICAgICAgaHRtbDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBjb250YWluZXI6ICR2aWV3RWxlbWVudCxcbiAgICAgICAgICAgICAgICB0aXRsZTogJGRlc2NyaXB0aW9uRWxlbWVudCxcbiAgICAgICAgICAgICAgICBwbGFjZW1lbnQ6IFwiYXV0b1wiLFxuICAgICAgICAgICAgICAgIHRyaWdnZXI6IFwibWFudWFsXCJcbiAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHRoaXMucmVuZGVyQ2xpY2tEZXNjKCR0aXAsIG5zT24pO1xuXG4gICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgIGNhc2UgXCJsZWZ0XCI6XG4gICAgICAgICAgY2FzZSBcInJpZ2h0XCI6XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKFxuICAgICAgICAgICAgICAnQ2Fubm90IHVzZSBcIicgK1xuICAgICAgICAgICAgICAgIGRhdGEucmVuZGVyT3B0aW9ucy5kZXNjcmlwdGlvbi5wb3NpdGlvbiArXG4gICAgICAgICAgICAgICAgJ1wiIGRlc2NyaXB0aW9uIHBvc2l0aW9uIGluIGFycmF5IGF0dHJpYnV0ZSA6ICcgK1xuICAgICAgICAgICAgICAgIGRhdGEuaWRcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKGlzQXR0cmlidXRlKSB7XG4gICAgICAgIHN3aXRjaCAoZGF0YS5yZW5kZXJPcHRpb25zLmRlc2NyaXB0aW9uLnBvc2l0aW9uKSB7XG4gICAgICAgICAgY2FzZSBcImJvdHRvbVwiOlxuICAgICAgICAgICAgJHZpZXdFbGVtZW50LmFwcGVuZCgkZGVzY3JpcHRpb25FbGVtZW50KTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgXCJ0b3BcIjpcbiAgICAgICAgICAgICR2aWV3RWxlbWVudC5wcmVwZW5kKCRkZXNjcmlwdGlvbkVsZW1lbnQpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSBcImxlZnRcIjpcbiAgICAgICAgICAgICR2aWV3RWxlbWVudFxuICAgICAgICAgICAgICAuZmluZChcIi5kY3BBdHRyaWJ1dGVfX2xhYmVsXCIpXG4gICAgICAgICAgICAgIC5hcHBlbmQoJGRlc2NyaXB0aW9uRWxlbWVudCk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIFwicmlnaHRcIjpcbiAgICAgICAgICAgICR2aWV3RWxlbWVudFxuICAgICAgICAgICAgICAuZmluZChcIi5kY3BBdHRyaWJ1dGVfX2NvbnRlbnRcIilcbiAgICAgICAgICAgICAgLmFwcGVuZCgkZGVzY3JpcHRpb25FbGVtZW50KTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgXCJ0b3BWYWx1ZVwiOlxuICAgICAgICAgICAgJHZpZXdFbGVtZW50LnByZXBlbmQoJGRlc2NyaXB0aW9uRWxlbWVudCk7XG4gICAgICAgICAgICAkZGVzY3JpcHRpb25FbGVtZW50LmFkZENsYXNzKFwiZGNwQXR0cmlidXRlX19yaWdodFwiKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgXCJ0b3BMYWJlbFwiOlxuICAgICAgICAgICAgJHZpZXdFbGVtZW50LnByZXBlbmQoJGRlc2NyaXB0aW9uRWxlbWVudCk7XG4gICAgICAgICAgICAkZGVzY3JpcHRpb25FbGVtZW50LmFkZENsYXNzKFwiZGNwQXR0cmlidXRlX19sZWZ0XCIpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSBcImJvdHRvbVZhbHVlXCI6XG4gICAgICAgICAgICAkdmlld0VsZW1lbnQuYXBwZW5kKCRkZXNjcmlwdGlvbkVsZW1lbnQpO1xuICAgICAgICAgICAgJGRlc2NyaXB0aW9uRWxlbWVudC5hZGRDbGFzcyhcImRjcEF0dHJpYnV0ZV9fcmlnaHRcIik7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIFwiYm90dG9tTGFiZWxcIjpcbiAgICAgICAgICAgICR2aWV3RWxlbWVudC5hcHBlbmQoJGRlc2NyaXB0aW9uRWxlbWVudCk7XG4gICAgICAgICAgICAkZGVzY3JpcHRpb25FbGVtZW50LmFkZENsYXNzKFwiZGNwQXR0cmlidXRlX19sZWZ0XCIpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSBcImNsaWNrXCI6XG4gICAgICAgICAgICAkdmlld0VsZW1lbnQuYXBwZW5kKCRkZXNjcmlwdGlvbkVsZW1lbnQpO1xuICAgICAgICAgICAgJHZpZXdFbGVtZW50XG4gICAgICAgICAgICAgIC5maW5kKFwiLmRjcEF0dHJpYnV0ZV9fbGFiZWxcIilcbiAgICAgICAgICAgICAgLmFwcGVuZChcbiAgICAgICAgICAgICAgICAnPGEgY2xhc3M9XCJkY3BBdHRyaWJ1dGVfX2xhYmVsX2Rlc2NyaXB0aW9uXCI+PHNwYW4gY2xhc3M9XCJmYSBmYS1pbmZvLWNpcmNsZVwiPjwvc3Bhbj48L2E+J1xuICAgICAgICAgICAgICApO1xuXG4gICAgICAgICAgICAkdGlwID0gJHZpZXdFbGVtZW50XG4gICAgICAgICAgICAgIC5maW5kKFwiLmRjcEF0dHJpYnV0ZV9fbGFiZWxfZGVzY3JpcHRpb25cIilcbiAgICAgICAgICAgICAgLnRvb2x0aXAoe1xuICAgICAgICAgICAgICAgIGh0bWw6IHRydWUsXG4gICAgICAgICAgICAgICAgY29udGFpbmVyOiAkdmlld0VsZW1lbnQsXG4gICAgICAgICAgICAgICAgcGxhY2VtZW50OiBcImF1dG9cIixcbiAgICAgICAgICAgICAgICB0aXRsZTogJGRlc2NyaXB0aW9uRWxlbWVudCxcbiAgICAgICAgICAgICAgICB0cmlnZ2VyOiBcIm1hbnVhbFwiXG4gICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB0aGlzLnJlbmRlckNsaWNrRGVzYygkdGlwLCBuc09uKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAoaXNBcnJheUNlbGwgfHwgaXNBcnJheUhlYWQpIHtcbiAgICAgICAgc3dpdGNoIChkYXRhLnJlbmRlck9wdGlvbnMuZGVzY3JpcHRpb24ucG9zaXRpb24pIHtcbiAgICAgICAgICBjYXNlIFwidG9wTGFiZWxcIjpcbiAgICAgICAgICBjYXNlIFwidG9wXCI6XG4gICAgICAgICAgICBpZiAoaXNBcnJheUhlYWQpIHtcbiAgICAgICAgICAgICAgJHZpZXdFbGVtZW50LnByZXBlbmQoJGRlc2NyaXB0aW9uRWxlbWVudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIFwidG9wVmFsdWVcIjpcbiAgICAgICAgICAgIGlmIChpc0FycmF5Q2VsbCkge1xuICAgICAgICAgICAgICAkdmlld0VsZW1lbnQucHJlcGVuZCgkZGVzY3JpcHRpb25FbGVtZW50KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgXCJib3R0b21WYWx1ZVwiOlxuICAgICAgICAgICAgaWYgKGlzQXJyYXlDZWxsKSB7XG4gICAgICAgICAgICAgICR2aWV3RWxlbWVudC5hcHBlbmQoJGRlc2NyaXB0aW9uRWxlbWVudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIFwiYm90dG9tXCI6XG4gICAgICAgICAgY2FzZSBcImJvdHRvbUxhYmVsXCI6XG4gICAgICAgICAgICBpZiAoaXNBcnJheUhlYWQpIHtcbiAgICAgICAgICAgICAgJHZpZXdFbGVtZW50LmFwcGVuZCgkZGVzY3JpcHRpb25FbGVtZW50KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgXCJjbGlja1wiOlxuICAgICAgICAgICAgaWYgKGlzQXJyYXlIZWFkKSB7XG4gICAgICAgICAgICAgICR2aWV3RWxlbWVudC5hcHBlbmQoJGRlc2NyaXB0aW9uRWxlbWVudCk7XG4gICAgICAgICAgICAgICR2aWV3RWxlbWVudC5wcmVwZW5kKFxuICAgICAgICAgICAgICAgICc8YSBjbGFzcz1cImRjcEF0dHJpYnV0ZV9fbGFiZWxfZGVzY3JpcHRpb25cIj48c3BhbiBjbGFzcz1cImZhIGZhLWluZm8tY2lyY2xlXCI+PC9zcGFuPjwvYT4nXG4gICAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgICAgJHRpcCA9ICR2aWV3RWxlbWVudFxuICAgICAgICAgICAgICAgIC5maW5kKFwiLmRjcEF0dHJpYnV0ZV9fbGFiZWxfZGVzY3JpcHRpb25cIilcbiAgICAgICAgICAgICAgICAudG9vbHRpcCh7XG4gICAgICAgICAgICAgICAgICBodG1sOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgY29udGFpbmVyOiAkdmlld0VsZW1lbnQsXG4gICAgICAgICAgICAgICAgICBwbGFjZW1lbnQ6IFwiYXV0b1wiLFxuICAgICAgICAgICAgICAgICAgdGl0bGU6ICR2aWV3RWxlbWVudC5maW5kKFwiPiAuZGNwQXR0cmlidXRlX19kZXNjcmlwdGlvblwiKSxcbiAgICAgICAgICAgICAgICAgIHRyaWdnZXI6IFwibWFudWFsXCJcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICB0aGlzLnJlbmRlckNsaWNrRGVzYygkdGlwLCBuc09uKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgXCJsZWZ0XCI6XG4gICAgICAgICAgY2FzZSBcInJpZ2h0XCI6XG4gICAgICAgICAgICAvLyBObyB1c2UgaW4gY29sdW1uIGNvbnRleHRcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXG4gICAgICAgICAgICAgICdDYW5ub3QgdXNlIFwiJyArXG4gICAgICAgICAgICAgICAgZGF0YS5yZW5kZXJPcHRpb25zLmRlc2NyaXB0aW9uLnBvc2l0aW9uICtcbiAgICAgICAgICAgICAgICAnXCIgZGVzY3JpcHRpb24gcG9zaXRpb24gaW4gY29sdW1uIGF0dHJpYnV0ZSA6ICcgK1xuICAgICAgICAgICAgICAgIGRhdGEuaWRcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKGRhdGEucmVuZGVyT3B0aW9ucy5kZXNjcmlwdGlvbi5odG1sQ29udGVudCkge1xuICAgICAgICAkdmlld0VsZW1lbnQub24oXG4gICAgICAgICAgXCJjbGlja1wiICsgbnNPbixcbiAgICAgICAgICBcIi5kY3BBdHRyaWJ1dGVfX2Rlc2NyaXB0aW9uX190aXRsZVwiLFxuICAgICAgICAgIGZ1bmN0aW9uIHZBdHRyaWJ1dGVfZGVzY1RvZ2dsZSgpIHtcbiAgICAgICAgICAgIHZhciAkY29udGVudEVsZW1lbnQgPSAkKHRoaXMpXG4gICAgICAgICAgICAgIC5jbG9zZXN0KFwiLmRjcEF0dHJpYnV0ZV9fZGVzY3JpcHRpb25cIilcbiAgICAgICAgICAgICAgLmZpbmQoXCIuZGNwQXR0cmlidXRlX19kZXNjcmlwdGlvbl9fY29udGVudFwiKTtcbiAgICAgICAgICAgICQodGhpcylcbiAgICAgICAgICAgICAgLmZpbmQoXCIuZGNwQXR0cmlidXRlX19kZXNjcmlwdGlvbl9fdGl0bGVfX2V4cGFuZFwiKVxuICAgICAgICAgICAgICAudG9nZ2xlQ2xhc3MoXCJmYS1jYXJldC1yaWdodCBmYS1jYXJldC1kb3duXCIpO1xuICAgICAgICAgICAgJGNvbnRlbnRFbGVtZW50LnNsaWRlVG9nZ2xlKDIwMCk7XG4gICAgICAgICAgfVxuICAgICAgICApO1xuICAgICAgICBpZiAoZGF0YS5yZW5kZXJPcHRpb25zLmRlc2NyaXB0aW9uLmNvbGxhcHNlZCA9PT0gdHJ1ZSkge1xuICAgICAgICAgICR2aWV3RWxlbWVudFxuICAgICAgICAgICAgLmZpbmQoXCIuZGNwQXR0cmlidXRlX19kZXNjcmlwdGlvbl9fdGl0bGVfX2V4cGFuZFwiKVxuICAgICAgICAgICAgLnRvZ2dsZUNsYXNzKFwiZmEtY2FyZXQtcmlnaHQgZmEtY2FyZXQtZG93blwiKTtcbiAgICAgICAgICAkdmlld0VsZW1lbnQuZmluZChcIi5kY3BBdHRyaWJ1dGVfX2Rlc2NyaXB0aW9uX19jb250ZW50XCIpLmhpZGUoKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfTtcbn0pO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///593c8c94ba4399020f79\n");

/***/ }),

/***/ "59b870d5aad30b0e7e20":
/*!************************!*\
  !*** external "kendo" ***!
  \************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("module.exports = kendo;//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNTliODcwZDVhYWQzMGIwZTdlMjAuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vZXh0ZXJuYWwgXCJrZW5kb1wiP2FlYWMiXSwic291cmNlc0NvbnRlbnQiOlsibW9kdWxlLmV4cG9ydHMgPSBrZW5kbzsiXSwibWFwcGluZ3MiOiJBQUFBIiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///59b870d5aad30b0e7e20\n");

/***/ }),

/***/ "5d1c50599007150199da":
/*!****************************************************************!*\
  !*** ./src/Apps/DOCUMENT/IHM/widgets/history/wRevisionDiff.js ***!
  \****************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;!(__WEBPACK_AMD_DEFINE_ARRAY__ = [\n  __webpack_require__(/*! jquery */ \"127c8cf59f228bb01a21\"),\n  __webpack_require__(/*! underscore */ \"8e08e542008e4aef1f58\"),\n  __webpack_require__(/*! mustache */ \"bcd31d01884fc294fd69\"),\n  __webpack_require__(/*! dcpDocument/widgets/widget */ \"f562ab9f022eef93542c\"),\n  __webpack_require__(/*! dcpDocument/widgets/window/wDialog */ \"0bd0aa4c1909a49f67bb\")\n], __WEBPACK_AMD_DEFINE_RESULT__ = (function require_revisiondiff($, _, Mustache) {\n  \"use strict\";\n\n  $.widget(\"dcp.dcpRevisionDiff\", $.dcp.dcpDialog, {\n    options: {\n      documentId: 0,\n      firstRevision: 0,\n      secondRevision: 0,\n      window: {\n        modal: true,\n        animation: {\n          open: {\n            effects: \"fade:in\",\n            duration: 1000\n          },\n          close: {\n            effects: \"fade:out\",\n            duration: 1000\n          }\n        },\n        actions: [\"Maximize\", \"Close\"],\n        visible: false,\n        height: \"300px\",\n        width: \"500px\",\n        title: \"Document difference\"\n      },\n      labels: {\n        first: \"First document\",\n        second: \"Second document\",\n        attributeId: \"Attribute id\",\n        attributeLabel: \"Attribute label\",\n        documentHeader:\n          '\"{{title}}\"  (Revision : {{revision}}). <br/>Created on <em>{{mdate}}</em>',\n        filterMessages: \"Filter data\",\n        showOnlyDiff: \"Show only differences\",\n        showAll: \"Show all\"\n      }\n    },\n    firstDocument: null,\n    secondDocument: null,\n\n    _create: function dcpRevisionDiff__create() {\n      var currentWidget = this,\n        $widget = $(this);\n\n      this.element.html(this.htmlCaneva());\n      __webpack_require__.e(/*! require.ensure | ensureDatatables */ \"vendors~ensureDatatables\").then((function dcpDocumentWHistory_initTable() {\n          __webpack_require__(/*! datatables.net-bs4/css/dataTables.bootstrap4.css */ \"ac0cf2e8e04136065d45\");\n          __webpack_require__(/*! datatables */ \"7006cf2c262b498f6c83\");\n          currentWidget._initDatatable();\n        }).bind(null, __webpack_require__)).catch(__webpack_require__.oe);\n\n      this.element.data(\"dcpRevisionDiff\", this);\n\n      this._super();\n\n      this.element.on(\n        \"click\" + this.eventNamespace,\n        \".revision-diff-button-showonlydiff\",\n        function dcpRevisionDiff_showDiff() {\n          if ($widget.data(\"showOnlyDiff\")) {\n            $widget.data(\"showOnlyDiff\", false);\n            $(this)\n              .text(currentWidget.options.labels.showOnlyDiff)\n              .removeClass(\"btn-primary\");\n            currentWidget.element.find(\".revision-diff-equal\").show();\n          } else {\n            $widget.data(\"showOnlyDiff\", true);\n            currentWidget.element.find(\".revision-diff-equal\").hide();\n            $(this)\n              .text(currentWidget.options.labels.showAll)\n              .addClass(\"btn-primary\");\n          }\n        }\n      );\n    },\n\n    htmlCaneva: function dcpRevisionDiff_htmlCaneva() {\n      return (\n        '<table class=\"revision-diff-main\"><thead>' +\n        '<tr class=\"revision-diff-header\">' +\n        '<th class=\"revision-diff-header--attribute-id\"/>' +\n        '<th class=\"revision-diff-header--attribute-label\"/>' +\n        '<th class=\"revision-diff-header--first\"/>' +\n        '<th class=\"revision-diff-header--second\"/>' +\n        \"</tr>\" +\n        \"</thead></table>\"\n      );\n    },\n    _initDatatable: function dcpRevisionDiff__initDatatable() {\n      var revisionDiffWidget = this;\n      this.element\n        .find(\".revision-diff-main\")\n        .dataTable({\n          autoWidth: false,\n          ordering: false,\n          paging: false,\n          dom: \"<'revision-head'<'revision-diff-buttons'>f>rtip\",\n          // \"scrollY\": \"200px\",\n          scrollCollapse: false,\n          info: false,\n          language: {\n            search: \" \"\n          },\n          columns: [\n            {\n              data: \"attributeId\",\n              name: \"attributeId\",\n              title: revisionDiffWidget.options.labels.attributeId,\n              className: \"revision-diff-attributeid\",\n              visible: false\n            },\n            {\n              data: \"attributeLabel\",\n              name: \"attributeLabel\",\n              title: revisionDiffWidget.options.labels.attributeLabel,\n              className: \"revision-diff-attributelabel\"\n            },\n            {\n              data: \"first\",\n              name: \"first\",\n              title: revisionDiffWidget.options.labels.first,\n              className: \"revision-diff-first\",\n              render: function dcpRevisionDiff_renderFirst(data) {\n                if (_.isArray(data)) {\n                  return _.pluck(data, \"displayValue\").join(\", \");\n                } else {\n                  return data.displayValue;\n                }\n              }\n            },\n            {\n              data: \"second\",\n              name: \"second\",\n              title: revisionDiffWidget.options.labels.second,\n              className: \"revision-diff-second\",\n              render: function dcpRevisionDiff_renderSecond(data) {\n                if (_.isArray(data)) {\n                  return _.pluck(data, \"displayValue\").join(\", \");\n                } else {\n                  return data.displayValue;\n                }\n              }\n            }\n          ],\n\n          initComplete: function dcpRevisionDiff_initComplete() {\n            var api = this.api();\n            // var data = api.rows({page: 'current'}).data();\n            // Output the data for the visible rows to the browser's console\n            $(api.columns(\"first:name\").header()).html(\n              revisionDiffWidget._getDocHeader(revisionDiffWidget.firstDocument)\n            );\n            $(api.columns(\"second:name\").header()).html(\n              revisionDiffWidget._getDocHeader(\n                revisionDiffWidget.secondDocument\n              )\n            );\n            revisionDiffWidget.element\n              .find(\".dataTables_filter input\")\n              .attr(\n                \"placeholder\",\n                revisionDiffWidget.options.labels.filterMessages\n              );\n\n            revisionDiffWidget.element\n              .find(\".dataTables_filter input\")\n              .addClass(\"form-control form-control-sm\");\n\n            var firstHeadCell = revisionDiffWidget.element.find(\n              \".revision-diff-buttons\"\n            );\n            if (\n              firstHeadCell.find(\".revision-diff-button-showonlydiff\")\n                .length === 0\n            ) {\n              firstHeadCell.append(\n                $(\n                  '<button class=\"revision-diff-button-showonlydiff btn btn-secondary btn-sm\" >' +\n                    revisionDiffWidget.options.labels.showOnlyDiff +\n                    \"</button>\"\n                )\n              );\n            }\n          },\n\n          ajax: function dcpRevisionDiff_getData(data, callback) {\n            var myData = [];\n\n            $.getJSON(\n              \"api/v2/documents/\" +\n                revisionDiffWidget.options.documentId +\n                \"/revisions/\" +\n                revisionDiffWidget.options.firstRevision +\n                \".json?useTrash=true&fields=family.structure,document.properties.mdate,document.properties.revision,document.attributes\"\n            )\n              .done(function dcpRevisionDiff_getDataDone(data1) {\n                revisionDiffWidget.firstDocument = data1.data.revision;\n                $.getJSON(\n                  \"api/v2/documents/\" +\n                    revisionDiffWidget.options.documentId +\n                    \"/revisions/\" +\n                    revisionDiffWidget.options.secondRevision +\n                    \".json?useTrash=true&fields=document.properties.mdate,document.properties.revision,document.attributes\"\n                )\n                  .done(function dcpRevisionDiff_getRevisionDone(data2) {\n                    revisionDiffWidget.secondDocument = data2.data.revision;\n                    _.each(\n                      data1.data.revision.attributes,\n                      function dcpRevisionDiff_analyzeAttribute(\n                        firstValue,\n                        index\n                      ) {\n                        var secondValue = data2.data.revision.attributes[index];\n                        myData.push({\n                          attributeId: index,\n                          attributeLabel: revisionDiffWidget._findAttributeLabel(\n                            data1.data.family.structure,\n                            index\n                          ),\n                          first: firstValue,\n                          second: secondValue,\n                          DT_RowClass: revisionDiffWidget.isEqualAttributeValue(\n                            firstValue,\n                            secondValue\n                          )\n                            ? \"revision-diff-equal\"\n                            : \"revision-diff-not-equal\"\n                        });\n                      }\n                    );\n                    callback({ data: myData });\n                  })\n                  .fail(function dcpRevisionDiff_getRevisionFail(xhr) {\n                    var result = JSON.parse(xhr.responseText);\n                    window.alert(result.exceptionMessage);\n                  });\n              })\n              .fail(function dcpRevisionDiff_getDataFail(xhr) {\n                var result = JSON.parse(xhr.responseText);\n                window.alert(result.exceptionMessage);\n              });\n          }\n        })\n        .addClass(\"table table-condensed table-bordered table-hover\");\n    },\n\n    isEqualAttributeValue: function dcpRevisionDiff_isEqualAttributeValue(\n      v1,\n      v2\n    ) {\n      if (_.isEqual(v1, v2)) {\n        return true;\n      }\n\n      if (_.isArray(v1) && _.isArray(v2)) {\n        var values1 = _.pluck(v1, \"value\");\n        var values2 = _.pluck(v2, \"value\");\n        return _.isEqual(values1, values2);\n      }\n      return false;\n    },\n\n    _findAttributeLabel: function wRevisionDiffFindAttributeLabel(\n      structure,\n      aid\n    ) {\n      var scope = this;\n      var label = null;\n      _.some(structure, function dcpRevisionDiff_analyzeAttribute(\n        attributInfo,\n        attributId\n      ) {\n        if (attributId === aid) {\n          label = attributInfo.label;\n          return true;\n        }\n        if (_.isObject(attributInfo.content)) {\n          var contentLabel = scope._findAttributeLabel(\n            attributInfo.content,\n            aid\n          );\n\n          if (contentLabel !== null) {\n            label = contentLabel;\n            return true;\n          }\n        }\n        return false;\n      });\n      return label;\n    },\n\n    _getDocHeader: function wRevisionDiffGetDocHeader(documentStructure) {\n      var documentHeader = this.options.labels.documentHeader;\n      return Mustache.render(\n        documentHeader || \"\",\n        documentStructure.properties\n      );\n    },\n\n    _destroy: function _destroy() {\n      var $history = this.element.find(\".revision-diff-main\");\n\n      if ($history.DataTable) {\n        $history.DataTable().destroy();\n      }\n      this._super();\n    }\n  });\n}).apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNWQxYzUwNTk5MDA3MTUwMTk5ZGEuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvQXBwcy9ET0NVTUVOVC9JSE0vd2lkZ2V0cy9oaXN0b3J5L3dSZXZpc2lvbkRpZmYuanM/OTVkYyJdLCJzb3VyY2VzQ29udGVudCI6WyJkZWZpbmUoW1xuICBcImpxdWVyeVwiLFxuICBcInVuZGVyc2NvcmVcIixcbiAgXCJtdXN0YWNoZVwiLFxuICBcImRjcERvY3VtZW50L3dpZGdldHMvd2lkZ2V0XCIsXG4gIFwiZGNwRG9jdW1lbnQvd2lkZ2V0cy93aW5kb3cvd0RpYWxvZ1wiXG5dLCBmdW5jdGlvbiByZXF1aXJlX3JldmlzaW9uZGlmZigkLCBfLCBNdXN0YWNoZSkge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICAkLndpZGdldChcImRjcC5kY3BSZXZpc2lvbkRpZmZcIiwgJC5kY3AuZGNwRGlhbG9nLCB7XG4gICAgb3B0aW9uczoge1xuICAgICAgZG9jdW1lbnRJZDogMCxcbiAgICAgIGZpcnN0UmV2aXNpb246IDAsXG4gICAgICBzZWNvbmRSZXZpc2lvbjogMCxcbiAgICAgIHdpbmRvdzoge1xuICAgICAgICBtb2RhbDogdHJ1ZSxcbiAgICAgICAgYW5pbWF0aW9uOiB7XG4gICAgICAgICAgb3Blbjoge1xuICAgICAgICAgICAgZWZmZWN0czogXCJmYWRlOmluXCIsXG4gICAgICAgICAgICBkdXJhdGlvbjogMTAwMFxuICAgICAgICAgIH0sXG4gICAgICAgICAgY2xvc2U6IHtcbiAgICAgICAgICAgIGVmZmVjdHM6IFwiZmFkZTpvdXRcIixcbiAgICAgICAgICAgIGR1cmF0aW9uOiAxMDAwXG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBhY3Rpb25zOiBbXCJNYXhpbWl6ZVwiLCBcIkNsb3NlXCJdLFxuICAgICAgICB2aXNpYmxlOiBmYWxzZSxcbiAgICAgICAgaGVpZ2h0OiBcIjMwMHB4XCIsXG4gICAgICAgIHdpZHRoOiBcIjUwMHB4XCIsXG4gICAgICAgIHRpdGxlOiBcIkRvY3VtZW50IGRpZmZlcmVuY2VcIlxuICAgICAgfSxcbiAgICAgIGxhYmVsczoge1xuICAgICAgICBmaXJzdDogXCJGaXJzdCBkb2N1bWVudFwiLFxuICAgICAgICBzZWNvbmQ6IFwiU2Vjb25kIGRvY3VtZW50XCIsXG4gICAgICAgIGF0dHJpYnV0ZUlkOiBcIkF0dHJpYnV0ZSBpZFwiLFxuICAgICAgICBhdHRyaWJ1dGVMYWJlbDogXCJBdHRyaWJ1dGUgbGFiZWxcIixcbiAgICAgICAgZG9jdW1lbnRIZWFkZXI6XG4gICAgICAgICAgJ1wie3t0aXRsZX19XCIgIChSZXZpc2lvbiA6IHt7cmV2aXNpb259fSkuIDxici8+Q3JlYXRlZCBvbiA8ZW0+e3ttZGF0ZX19PC9lbT4nLFxuICAgICAgICBmaWx0ZXJNZXNzYWdlczogXCJGaWx0ZXIgZGF0YVwiLFxuICAgICAgICBzaG93T25seURpZmY6IFwiU2hvdyBvbmx5IGRpZmZlcmVuY2VzXCIsXG4gICAgICAgIHNob3dBbGw6IFwiU2hvdyBhbGxcIlxuICAgICAgfVxuICAgIH0sXG4gICAgZmlyc3REb2N1bWVudDogbnVsbCxcbiAgICBzZWNvbmREb2N1bWVudDogbnVsbCxcblxuICAgIF9jcmVhdGU6IGZ1bmN0aW9uIGRjcFJldmlzaW9uRGlmZl9fY3JlYXRlKCkge1xuICAgICAgdmFyIGN1cnJlbnRXaWRnZXQgPSB0aGlzLFxuICAgICAgICAkd2lkZ2V0ID0gJCh0aGlzKTtcblxuICAgICAgdGhpcy5lbGVtZW50Lmh0bWwodGhpcy5odG1sQ2FuZXZhKCkpO1xuICAgICAgcmVxdWlyZS5lbnN1cmUoXG4gICAgICAgIFtcImRhdGF0YWJsZXNcIl0sXG4gICAgICAgIGZ1bmN0aW9uIGRjcERvY3VtZW50V0hpc3RvcnlfaW5pdFRhYmxlKCkge1xuICAgICAgICAgIHJlcXVpcmUoXCJkYXRhdGFibGVzLm5ldC1iczQvY3NzL2RhdGFUYWJsZXMuYm9vdHN0cmFwNC5jc3NcIik7XG4gICAgICAgICAgcmVxdWlyZShcImRhdGF0YWJsZXNcIik7XG4gICAgICAgICAgY3VycmVudFdpZGdldC5faW5pdERhdGF0YWJsZSgpO1xuICAgICAgICB9LFxuICAgICAgICBcImVuc3VyZURhdGF0YWJsZXNcIlxuICAgICAgKTtcblxuICAgICAgdGhpcy5lbGVtZW50LmRhdGEoXCJkY3BSZXZpc2lvbkRpZmZcIiwgdGhpcyk7XG5cbiAgICAgIHRoaXMuX3N1cGVyKCk7XG5cbiAgICAgIHRoaXMuZWxlbWVudC5vbihcbiAgICAgICAgXCJjbGlja1wiICsgdGhpcy5ldmVudE5hbWVzcGFjZSxcbiAgICAgICAgXCIucmV2aXNpb24tZGlmZi1idXR0b24tc2hvd29ubHlkaWZmXCIsXG4gICAgICAgIGZ1bmN0aW9uIGRjcFJldmlzaW9uRGlmZl9zaG93RGlmZigpIHtcbiAgICAgICAgICBpZiAoJHdpZGdldC5kYXRhKFwic2hvd09ubHlEaWZmXCIpKSB7XG4gICAgICAgICAgICAkd2lkZ2V0LmRhdGEoXCJzaG93T25seURpZmZcIiwgZmFsc2UpO1xuICAgICAgICAgICAgJCh0aGlzKVxuICAgICAgICAgICAgICAudGV4dChjdXJyZW50V2lkZ2V0Lm9wdGlvbnMubGFiZWxzLnNob3dPbmx5RGlmZilcbiAgICAgICAgICAgICAgLnJlbW92ZUNsYXNzKFwiYnRuLXByaW1hcnlcIik7XG4gICAgICAgICAgICBjdXJyZW50V2lkZ2V0LmVsZW1lbnQuZmluZChcIi5yZXZpc2lvbi1kaWZmLWVxdWFsXCIpLnNob3coKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgJHdpZGdldC5kYXRhKFwic2hvd09ubHlEaWZmXCIsIHRydWUpO1xuICAgICAgICAgICAgY3VycmVudFdpZGdldC5lbGVtZW50LmZpbmQoXCIucmV2aXNpb24tZGlmZi1lcXVhbFwiKS5oaWRlKCk7XG4gICAgICAgICAgICAkKHRoaXMpXG4gICAgICAgICAgICAgIC50ZXh0KGN1cnJlbnRXaWRnZXQub3B0aW9ucy5sYWJlbHMuc2hvd0FsbClcbiAgICAgICAgICAgICAgLmFkZENsYXNzKFwiYnRuLXByaW1hcnlcIik7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICApO1xuICAgIH0sXG5cbiAgICBodG1sQ2FuZXZhOiBmdW5jdGlvbiBkY3BSZXZpc2lvbkRpZmZfaHRtbENhbmV2YSgpIHtcbiAgICAgIHJldHVybiAoXG4gICAgICAgICc8dGFibGUgY2xhc3M9XCJyZXZpc2lvbi1kaWZmLW1haW5cIj48dGhlYWQ+JyArXG4gICAgICAgICc8dHIgY2xhc3M9XCJyZXZpc2lvbi1kaWZmLWhlYWRlclwiPicgK1xuICAgICAgICAnPHRoIGNsYXNzPVwicmV2aXNpb24tZGlmZi1oZWFkZXItLWF0dHJpYnV0ZS1pZFwiLz4nICtcbiAgICAgICAgJzx0aCBjbGFzcz1cInJldmlzaW9uLWRpZmYtaGVhZGVyLS1hdHRyaWJ1dGUtbGFiZWxcIi8+JyArXG4gICAgICAgICc8dGggY2xhc3M9XCJyZXZpc2lvbi1kaWZmLWhlYWRlci0tZmlyc3RcIi8+JyArXG4gICAgICAgICc8dGggY2xhc3M9XCJyZXZpc2lvbi1kaWZmLWhlYWRlci0tc2Vjb25kXCIvPicgK1xuICAgICAgICBcIjwvdHI+XCIgK1xuICAgICAgICBcIjwvdGhlYWQ+PC90YWJsZT5cIlxuICAgICAgKTtcbiAgICB9LFxuICAgIF9pbml0RGF0YXRhYmxlOiBmdW5jdGlvbiBkY3BSZXZpc2lvbkRpZmZfX2luaXREYXRhdGFibGUoKSB7XG4gICAgICB2YXIgcmV2aXNpb25EaWZmV2lkZ2V0ID0gdGhpcztcbiAgICAgIHRoaXMuZWxlbWVudFxuICAgICAgICAuZmluZChcIi5yZXZpc2lvbi1kaWZmLW1haW5cIilcbiAgICAgICAgLmRhdGFUYWJsZSh7XG4gICAgICAgICAgYXV0b1dpZHRoOiBmYWxzZSxcbiAgICAgICAgICBvcmRlcmluZzogZmFsc2UsXG4gICAgICAgICAgcGFnaW5nOiBmYWxzZSxcbiAgICAgICAgICBkb206IFwiPCdyZXZpc2lvbi1oZWFkJzwncmV2aXNpb24tZGlmZi1idXR0b25zJz5mPnJ0aXBcIixcbiAgICAgICAgICAvLyBcInNjcm9sbFlcIjogXCIyMDBweFwiLFxuICAgICAgICAgIHNjcm9sbENvbGxhcHNlOiBmYWxzZSxcbiAgICAgICAgICBpbmZvOiBmYWxzZSxcbiAgICAgICAgICBsYW5ndWFnZToge1xuICAgICAgICAgICAgc2VhcmNoOiBcIiBcIlxuICAgICAgICAgIH0sXG4gICAgICAgICAgY29sdW1uczogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBkYXRhOiBcImF0dHJpYnV0ZUlkXCIsXG4gICAgICAgICAgICAgIG5hbWU6IFwiYXR0cmlidXRlSWRcIixcbiAgICAgICAgICAgICAgdGl0bGU6IHJldmlzaW9uRGlmZldpZGdldC5vcHRpb25zLmxhYmVscy5hdHRyaWJ1dGVJZCxcbiAgICAgICAgICAgICAgY2xhc3NOYW1lOiBcInJldmlzaW9uLWRpZmYtYXR0cmlidXRlaWRcIixcbiAgICAgICAgICAgICAgdmlzaWJsZTogZmFsc2VcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIGRhdGE6IFwiYXR0cmlidXRlTGFiZWxcIixcbiAgICAgICAgICAgICAgbmFtZTogXCJhdHRyaWJ1dGVMYWJlbFwiLFxuICAgICAgICAgICAgICB0aXRsZTogcmV2aXNpb25EaWZmV2lkZ2V0Lm9wdGlvbnMubGFiZWxzLmF0dHJpYnV0ZUxhYmVsLFxuICAgICAgICAgICAgICBjbGFzc05hbWU6IFwicmV2aXNpb24tZGlmZi1hdHRyaWJ1dGVsYWJlbFwiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBkYXRhOiBcImZpcnN0XCIsXG4gICAgICAgICAgICAgIG5hbWU6IFwiZmlyc3RcIixcbiAgICAgICAgICAgICAgdGl0bGU6IHJldmlzaW9uRGlmZldpZGdldC5vcHRpb25zLmxhYmVscy5maXJzdCxcbiAgICAgICAgICAgICAgY2xhc3NOYW1lOiBcInJldmlzaW9uLWRpZmYtZmlyc3RcIixcbiAgICAgICAgICAgICAgcmVuZGVyOiBmdW5jdGlvbiBkY3BSZXZpc2lvbkRpZmZfcmVuZGVyRmlyc3QoZGF0YSkge1xuICAgICAgICAgICAgICAgIGlmIChfLmlzQXJyYXkoZGF0YSkpIHtcbiAgICAgICAgICAgICAgICAgIHJldHVybiBfLnBsdWNrKGRhdGEsIFwiZGlzcGxheVZhbHVlXCIpLmpvaW4oXCIsIFwiKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGEuZGlzcGxheVZhbHVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgZGF0YTogXCJzZWNvbmRcIixcbiAgICAgICAgICAgICAgbmFtZTogXCJzZWNvbmRcIixcbiAgICAgICAgICAgICAgdGl0bGU6IHJldmlzaW9uRGlmZldpZGdldC5vcHRpb25zLmxhYmVscy5zZWNvbmQsXG4gICAgICAgICAgICAgIGNsYXNzTmFtZTogXCJyZXZpc2lvbi1kaWZmLXNlY29uZFwiLFxuICAgICAgICAgICAgICByZW5kZXI6IGZ1bmN0aW9uIGRjcFJldmlzaW9uRGlmZl9yZW5kZXJTZWNvbmQoZGF0YSkge1xuICAgICAgICAgICAgICAgIGlmIChfLmlzQXJyYXkoZGF0YSkpIHtcbiAgICAgICAgICAgICAgICAgIHJldHVybiBfLnBsdWNrKGRhdGEsIFwiZGlzcGxheVZhbHVlXCIpLmpvaW4oXCIsIFwiKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGEuZGlzcGxheVZhbHVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIF0sXG5cbiAgICAgICAgICBpbml0Q29tcGxldGU6IGZ1bmN0aW9uIGRjcFJldmlzaW9uRGlmZl9pbml0Q29tcGxldGUoKSB7XG4gICAgICAgICAgICB2YXIgYXBpID0gdGhpcy5hcGkoKTtcbiAgICAgICAgICAgIC8vIHZhciBkYXRhID0gYXBpLnJvd3Moe3BhZ2U6ICdjdXJyZW50J30pLmRhdGEoKTtcbiAgICAgICAgICAgIC8vIE91dHB1dCB0aGUgZGF0YSBmb3IgdGhlIHZpc2libGUgcm93cyB0byB0aGUgYnJvd3NlcidzIGNvbnNvbGVcbiAgICAgICAgICAgICQoYXBpLmNvbHVtbnMoXCJmaXJzdDpuYW1lXCIpLmhlYWRlcigpKS5odG1sKFxuICAgICAgICAgICAgICByZXZpc2lvbkRpZmZXaWRnZXQuX2dldERvY0hlYWRlcihyZXZpc2lvbkRpZmZXaWRnZXQuZmlyc3REb2N1bWVudClcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICAkKGFwaS5jb2x1bW5zKFwic2Vjb25kOm5hbWVcIikuaGVhZGVyKCkpLmh0bWwoXG4gICAgICAgICAgICAgIHJldmlzaW9uRGlmZldpZGdldC5fZ2V0RG9jSGVhZGVyKFxuICAgICAgICAgICAgICAgIHJldmlzaW9uRGlmZldpZGdldC5zZWNvbmREb2N1bWVudFxuICAgICAgICAgICAgICApXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgcmV2aXNpb25EaWZmV2lkZ2V0LmVsZW1lbnRcbiAgICAgICAgICAgICAgLmZpbmQoXCIuZGF0YVRhYmxlc19maWx0ZXIgaW5wdXRcIilcbiAgICAgICAgICAgICAgLmF0dHIoXG4gICAgICAgICAgICAgICAgXCJwbGFjZWhvbGRlclwiLFxuICAgICAgICAgICAgICAgIHJldmlzaW9uRGlmZldpZGdldC5vcHRpb25zLmxhYmVscy5maWx0ZXJNZXNzYWdlc1xuICAgICAgICAgICAgICApO1xuXG4gICAgICAgICAgICByZXZpc2lvbkRpZmZXaWRnZXQuZWxlbWVudFxuICAgICAgICAgICAgICAuZmluZChcIi5kYXRhVGFibGVzX2ZpbHRlciBpbnB1dFwiKVxuICAgICAgICAgICAgICAuYWRkQ2xhc3MoXCJmb3JtLWNvbnRyb2wgZm9ybS1jb250cm9sLXNtXCIpO1xuXG4gICAgICAgICAgICB2YXIgZmlyc3RIZWFkQ2VsbCA9IHJldmlzaW9uRGlmZldpZGdldC5lbGVtZW50LmZpbmQoXG4gICAgICAgICAgICAgIFwiLnJldmlzaW9uLWRpZmYtYnV0dG9uc1wiXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICBmaXJzdEhlYWRDZWxsLmZpbmQoXCIucmV2aXNpb24tZGlmZi1idXR0b24tc2hvd29ubHlkaWZmXCIpXG4gICAgICAgICAgICAgICAgLmxlbmd0aCA9PT0gMFxuICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgIGZpcnN0SGVhZENlbGwuYXBwZW5kKFxuICAgICAgICAgICAgICAgICQoXG4gICAgICAgICAgICAgICAgICAnPGJ1dHRvbiBjbGFzcz1cInJldmlzaW9uLWRpZmYtYnV0dG9uLXNob3dvbmx5ZGlmZiBidG4gYnRuLXNlY29uZGFyeSBidG4tc21cIiA+JyArXG4gICAgICAgICAgICAgICAgICAgIHJldmlzaW9uRGlmZldpZGdldC5vcHRpb25zLmxhYmVscy5zaG93T25seURpZmYgK1xuICAgICAgICAgICAgICAgICAgICBcIjwvYnV0dG9uPlwiXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG5cbiAgICAgICAgICBhamF4OiBmdW5jdGlvbiBkY3BSZXZpc2lvbkRpZmZfZ2V0RGF0YShkYXRhLCBjYWxsYmFjaykge1xuICAgICAgICAgICAgdmFyIG15RGF0YSA9IFtdO1xuXG4gICAgICAgICAgICAkLmdldEpTT04oXG4gICAgICAgICAgICAgIFwiYXBpL3YyL2RvY3VtZW50cy9cIiArXG4gICAgICAgICAgICAgICAgcmV2aXNpb25EaWZmV2lkZ2V0Lm9wdGlvbnMuZG9jdW1lbnRJZCArXG4gICAgICAgICAgICAgICAgXCIvcmV2aXNpb25zL1wiICtcbiAgICAgICAgICAgICAgICByZXZpc2lvbkRpZmZXaWRnZXQub3B0aW9ucy5maXJzdFJldmlzaW9uICtcbiAgICAgICAgICAgICAgICBcIi5qc29uP3VzZVRyYXNoPXRydWUmZmllbGRzPWZhbWlseS5zdHJ1Y3R1cmUsZG9jdW1lbnQucHJvcGVydGllcy5tZGF0ZSxkb2N1bWVudC5wcm9wZXJ0aWVzLnJldmlzaW9uLGRvY3VtZW50LmF0dHJpYnV0ZXNcIlxuICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAuZG9uZShmdW5jdGlvbiBkY3BSZXZpc2lvbkRpZmZfZ2V0RGF0YURvbmUoZGF0YTEpIHtcbiAgICAgICAgICAgICAgICByZXZpc2lvbkRpZmZXaWRnZXQuZmlyc3REb2N1bWVudCA9IGRhdGExLmRhdGEucmV2aXNpb247XG4gICAgICAgICAgICAgICAgJC5nZXRKU09OKFxuICAgICAgICAgICAgICAgICAgXCJhcGkvdjIvZG9jdW1lbnRzL1wiICtcbiAgICAgICAgICAgICAgICAgICAgcmV2aXNpb25EaWZmV2lkZ2V0Lm9wdGlvbnMuZG9jdW1lbnRJZCArXG4gICAgICAgICAgICAgICAgICAgIFwiL3JldmlzaW9ucy9cIiArXG4gICAgICAgICAgICAgICAgICAgIHJldmlzaW9uRGlmZldpZGdldC5vcHRpb25zLnNlY29uZFJldmlzaW9uICtcbiAgICAgICAgICAgICAgICAgICAgXCIuanNvbj91c2VUcmFzaD10cnVlJmZpZWxkcz1kb2N1bWVudC5wcm9wZXJ0aWVzLm1kYXRlLGRvY3VtZW50LnByb3BlcnRpZXMucmV2aXNpb24sZG9jdW1lbnQuYXR0cmlidXRlc1wiXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgLmRvbmUoZnVuY3Rpb24gZGNwUmV2aXNpb25EaWZmX2dldFJldmlzaW9uRG9uZShkYXRhMikge1xuICAgICAgICAgICAgICAgICAgICByZXZpc2lvbkRpZmZXaWRnZXQuc2Vjb25kRG9jdW1lbnQgPSBkYXRhMi5kYXRhLnJldmlzaW9uO1xuICAgICAgICAgICAgICAgICAgICBfLmVhY2goXG4gICAgICAgICAgICAgICAgICAgICAgZGF0YTEuZGF0YS5yZXZpc2lvbi5hdHRyaWJ1dGVzLFxuICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGRjcFJldmlzaW9uRGlmZl9hbmFseXplQXR0cmlidXRlKFxuICAgICAgICAgICAgICAgICAgICAgICAgZmlyc3RWYWx1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4XG4gICAgICAgICAgICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2Vjb25kVmFsdWUgPSBkYXRhMi5kYXRhLnJldmlzaW9uLmF0dHJpYnV0ZXNbaW5kZXhdO1xuICAgICAgICAgICAgICAgICAgICAgICAgbXlEYXRhLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgICBhdHRyaWJ1dGVJZDogaW5kZXgsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZUxhYmVsOiByZXZpc2lvbkRpZmZXaWRnZXQuX2ZpbmRBdHRyaWJ1dGVMYWJlbChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhMS5kYXRhLmZhbWlseS5zdHJ1Y3R1cmUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXhcbiAgICAgICAgICAgICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyc3Q6IGZpcnN0VmFsdWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIHNlY29uZDogc2Vjb25kVmFsdWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIERUX1Jvd0NsYXNzOiByZXZpc2lvbkRpZmZXaWRnZXQuaXNFcXVhbEF0dHJpYnV0ZVZhbHVlKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcnN0VmFsdWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2Vjb25kVmFsdWVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gXCJyZXZpc2lvbi1kaWZmLWVxdWFsXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IFwicmV2aXNpb24tZGlmZi1ub3QtZXF1YWxcIlxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayh7IGRhdGE6IG15RGF0YSB9KTtcbiAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAuZmFpbChmdW5jdGlvbiBkY3BSZXZpc2lvbkRpZmZfZ2V0UmV2aXNpb25GYWlsKHhocikge1xuICAgICAgICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gSlNPTi5wYXJzZSh4aHIucmVzcG9uc2VUZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgd2luZG93LmFsZXJ0KHJlc3VsdC5leGNlcHRpb25NZXNzYWdlKTtcbiAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAuZmFpbChmdW5jdGlvbiBkY3BSZXZpc2lvbkRpZmZfZ2V0RGF0YUZhaWwoeGhyKSB7XG4gICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IEpTT04ucGFyc2UoeGhyLnJlc3BvbnNlVGV4dCk7XG4gICAgICAgICAgICAgICAgd2luZG93LmFsZXJ0KHJlc3VsdC5leGNlcHRpb25NZXNzYWdlKTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgICAuYWRkQ2xhc3MoXCJ0YWJsZSB0YWJsZS1jb25kZW5zZWQgdGFibGUtYm9yZGVyZWQgdGFibGUtaG92ZXJcIik7XG4gICAgfSxcblxuICAgIGlzRXF1YWxBdHRyaWJ1dGVWYWx1ZTogZnVuY3Rpb24gZGNwUmV2aXNpb25EaWZmX2lzRXF1YWxBdHRyaWJ1dGVWYWx1ZShcbiAgICAgIHYxLFxuICAgICAgdjJcbiAgICApIHtcbiAgICAgIGlmIChfLmlzRXF1YWwodjEsIHYyKSkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cblxuICAgICAgaWYgKF8uaXNBcnJheSh2MSkgJiYgXy5pc0FycmF5KHYyKSkge1xuICAgICAgICB2YXIgdmFsdWVzMSA9IF8ucGx1Y2sodjEsIFwidmFsdWVcIik7XG4gICAgICAgIHZhciB2YWx1ZXMyID0gXy5wbHVjayh2MiwgXCJ2YWx1ZVwiKTtcbiAgICAgICAgcmV0dXJuIF8uaXNFcXVhbCh2YWx1ZXMxLCB2YWx1ZXMyKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9LFxuXG4gICAgX2ZpbmRBdHRyaWJ1dGVMYWJlbDogZnVuY3Rpb24gd1JldmlzaW9uRGlmZkZpbmRBdHRyaWJ1dGVMYWJlbChcbiAgICAgIHN0cnVjdHVyZSxcbiAgICAgIGFpZFxuICAgICkge1xuICAgICAgdmFyIHNjb3BlID0gdGhpcztcbiAgICAgIHZhciBsYWJlbCA9IG51bGw7XG4gICAgICBfLnNvbWUoc3RydWN0dXJlLCBmdW5jdGlvbiBkY3BSZXZpc2lvbkRpZmZfYW5hbHl6ZUF0dHJpYnV0ZShcbiAgICAgICAgYXR0cmlidXRJbmZvLFxuICAgICAgICBhdHRyaWJ1dElkXG4gICAgICApIHtcbiAgICAgICAgaWYgKGF0dHJpYnV0SWQgPT09IGFpZCkge1xuICAgICAgICAgIGxhYmVsID0gYXR0cmlidXRJbmZvLmxhYmVsO1xuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChfLmlzT2JqZWN0KGF0dHJpYnV0SW5mby5jb250ZW50KSkge1xuICAgICAgICAgIHZhciBjb250ZW50TGFiZWwgPSBzY29wZS5fZmluZEF0dHJpYnV0ZUxhYmVsKFxuICAgICAgICAgICAgYXR0cmlidXRJbmZvLmNvbnRlbnQsXG4gICAgICAgICAgICBhaWRcbiAgICAgICAgICApO1xuXG4gICAgICAgICAgaWYgKGNvbnRlbnRMYWJlbCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgbGFiZWwgPSBjb250ZW50TGFiZWw7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gbGFiZWw7XG4gICAgfSxcblxuICAgIF9nZXREb2NIZWFkZXI6IGZ1bmN0aW9uIHdSZXZpc2lvbkRpZmZHZXREb2NIZWFkZXIoZG9jdW1lbnRTdHJ1Y3R1cmUpIHtcbiAgICAgIHZhciBkb2N1bWVudEhlYWRlciA9IHRoaXMub3B0aW9ucy5sYWJlbHMuZG9jdW1lbnRIZWFkZXI7XG4gICAgICByZXR1cm4gTXVzdGFjaGUucmVuZGVyKFxuICAgICAgICBkb2N1bWVudEhlYWRlciB8fCBcIlwiLFxuICAgICAgICBkb2N1bWVudFN0cnVjdHVyZS5wcm9wZXJ0aWVzXG4gICAgICApO1xuICAgIH0sXG5cbiAgICBfZGVzdHJveTogZnVuY3Rpb24gX2Rlc3Ryb3koKSB7XG4gICAgICB2YXIgJGhpc3RvcnkgPSB0aGlzLmVsZW1lbnQuZmluZChcIi5yZXZpc2lvbi1kaWZmLW1haW5cIik7XG5cbiAgICAgIGlmICgkaGlzdG9yeS5EYXRhVGFibGUpIHtcbiAgICAgICAgJGhpc3RvcnkuRGF0YVRhYmxlKCkuZGVzdHJveSgpO1xuICAgICAgfVxuICAgICAgdGhpcy5fc3VwZXIoKTtcbiAgICB9XG4gIH0pO1xufSk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUdBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5RUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///5d1c50599007150199da\n");

/***/ }),

/***/ "61b480911316cdda77a4":
/*!****************************************************************!*\
  !*** ./src/Apps/DOCUMENT/IHM/widgets/attributes/text/wText.js ***!
  \****************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;(function umdRequire(root, factory) {\n  \"use strict\";\n\n  if (true) {\n    !(__WEBPACK_AMD_DEFINE_ARRAY__ = [\n      __webpack_require__(/*! jquery */ \"127c8cf59f228bb01a21\"),\n      __webpack_require__(/*! underscore */ \"8e08e542008e4aef1f58\"),\n      __webpack_require__(/*! mustache */ \"bcd31d01884fc294fd69\"),\n      __webpack_require__(/*! dcpDocument/widgets/attributes/wAttribute */ \"d1cffa31e143773735c0\")\n    ], __WEBPACK_AMD_DEFINE_FACTORY__ = (factory),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?\n\t\t\t\t(__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n  } else {}\n})(window, function wText($, _, Mustache) {\n  \"use strict\";\n\n  $.widget(\"dcp.dcpText\", $.dcp.dcpAttribute, {\n    options: {\n      type: \"text\",\n      renderOptions: {\n        maxLength: 0, // char max length\n        placeHolder: \"\",\n        format: \"\",\n        kendoAutoCompleteConfiguration: {\n          filter: \"contains\",\n          clearButton: false,\n          minLength: 1,\n          template:\n            '<div class=\"dcpAutocomplete\"><span class=\"k-state-default\">#= data.title#</span>' +\n            \"#if (data.message) {#\" +\n            '<div class=\"dcpAutocomplete--#= data.message.type#\">#: data.message.contentText# #= data.message.contentHtml#</div>' +\n            \"#}# </div>\"\n        }\n      }\n    },\n\n    kendoWidget: null,\n\n    _initDom: function wTextInitDom() {\n      if (this.getMode() === \"read\") {\n        if (this.options.renderOptions.format) {\n          this.options.attributeValue.formatValue = Mustache.render(\n            this.options.renderOptions.format || \"\",\n            this.options.attributeValue\n          );\n        }\n      }\n\n      this._super();\n      this.kendoWidget = this.element.find(\".dcpAttribute__value--edit\");\n      if (this.kendoWidget && this.options.hasAutocomplete) {\n        this.activateAutocomplete(this.kendoWidget);\n      } else {\n        if (this.getType() === \"text\") {\n          this.kendoWidget.addClass(\"k-textbox\");\n        }\n      }\n    },\n\n    _initEvent: function wTextInitEvent() {\n      if (this.getMode() === \"write\") {\n        this._initChangeEvent();\n      }\n      this._super();\n    },\n\n    _initChangeEvent: function wTextInitChangeEvent() {\n      var currentWidget = this;\n      if (this.getMode() === \"write\") {\n        this.getContentElements().on(\n          \"change\" + this.eventNamespace,\n          function wTextChangeElement() {\n            var newValue = _.clone(currentWidget.options.attributeValue);\n            newValue.value = $(this).val();\n            newValue.displayValue = newValue.value;\n            currentWidget.setValue(newValue);\n          }\n        );\n      }\n    },\n\n    /**\n     * Just to be apply in normal input help\n     * @param inputValue\n     */\n    activateAutocomplete: function activateAutocomplete(inputValue) {\n      var currentWidget = this;\n      var systemOption = {\n        dataTextField: \"title\",\n        dataSource: {\n          // type: \"json\",\n\n          serverFiltering: true,\n          transport: {\n            read: function mapAutoActivated(options) {\n              options.data.index = currentWidget._getIndex();\n              return currentWidget.options.autocompleteRequest.call(\n                null,\n                options\n              );\n            }\n          }\n        },\n        filtering: function wTextFiltering(e) {\n          // space search is used to force new search\n          if (e.filter.value === \" \") {\n            e.filter.value = \"\";\n          }\n        },\n        select: function kendoAutocompleteSelect(event) {\n          var valueIndex = currentWidget._getIndex();\n          var dataItem = this.dataSource.at(event.item.index());\n          //The object returned by dataSource.at are internal kendo object so I clean it with toJSON\n          if (dataItem.toJSON) {\n            dataItem = dataItem.toJSON();\n          }\n          event.preventDefault(); // no fire change event\n          currentWidget._trigger(\"changeattrsvalue\", event, {\n            dataItem: dataItem,\n            valueIndex: valueIndex\n          });\n        }\n      };\n\n      inputValue.kendoAutoComplete(\n        _.extend(\n          {},\n          this.options.renderOptions.kendoAutoCompleteConfiguration,\n          systemOption\n        )\n      );\n      this.element.on(\n        \"click\" + this.eventNamespace,\n        \".dcpAttribute__value--autocomplete--button\",\n        function wTextClickAutoComplete(event) {\n          event.preventDefault();\n          inputValue.data(\"kendoAutoComplete\").search(\" \"); // use space search\n        }\n      );\n      this.element\n        .find(\".dcpAttribute__value--autocomplete--button[title]\")\n        .tooltip({\n          html: true,\n          container: this.element\n        })\n        .each(function wTextInitLinkTooltip() {\n          $(this)\n            .data(\"bs.tooltip\")\n            .tip()\n            .addClass(\"dcpAttribute__autocomplete\");\n        });\n    },\n\n    /**\n     * Modify value to widget and send notification to the view\n     * @param value\n     */\n    setValue: function wTextSetValue(value) {\n      var originalValue;\n\n      value = _.clone(value);\n\n      if (_.has(value, \"value\") && !_.has(value, \"displayValue\")) {\n        value.displayValue = value.value;\n      }\n      this._super(value);\n\n      originalValue = this.getWidgetValue();\n\n      if (this.getMode() === \"write\") {\n        // : explicit lazy equal\n        if (value.value === null && originalValue === \"\") {\n          originalValue = null;\n        }\n        if (originalValue !== value.value) {\n          // Modify value only if different\n          this.getContentElements().val(value.value);\n          this.flashElement();\n        }\n      } else if (this.getMode() === \"read\") {\n        this.redraw();\n      } else {\n        throw new Error(\n          \"Attribute \" + this.options.id + \" unkown mode \" + this.getMode()\n        );\n      }\n    },\n\n    getType: function getType() {\n      return \"text\";\n    },\n\n    _destroy: function _destroy() {\n      //Destroy autocomplete if activated\n      if (this.kendoWidget && this.kendoWidget.data(\"kendoAutoComplete\")) {\n        this.kendoWidget.data(\"kendoAutoComplete\").destroy();\n      }\n      this._super();\n    }\n  });\n\n  return $.fn.dcpText;\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNjFiNDgwOTExMzE2Y2RkYTc3YTQuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvQXBwcy9ET0NVTUVOVC9JSE0vd2lkZ2V0cy9hdHRyaWJ1dGVzL3RleHQvd1RleHQuanM/ZjVjNCJdLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gdW1kUmVxdWlyZShyb290LCBmYWN0b3J5KSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIGlmICh0eXBlb2YgZGVmaW5lID09PSBcImZ1bmN0aW9uXCIgJiYgZGVmaW5lLmFtZCkge1xuICAgIGRlZmluZShbXG4gICAgICBcImpxdWVyeVwiLFxuICAgICAgXCJ1bmRlcnNjb3JlXCIsXG4gICAgICBcIm11c3RhY2hlXCIsXG4gICAgICBcImRjcERvY3VtZW50L3dpZGdldHMvYXR0cmlidXRlcy93QXR0cmlidXRlXCJcbiAgICBdLCBmYWN0b3J5KTtcbiAgfSBlbHNlIHtcbiAgICAvL25vaW5zcGVjdGlvbiBKU1VucmVzb2x2ZWRWYXJpYWJsZVxuICAgIGZhY3Rvcnkod2luZG93LmpRdWVyeSwgd2luZG93Ll8sIHdpbmRvdy5NdXN0YWNoZSk7XG4gIH1cbn0pKHdpbmRvdywgZnVuY3Rpb24gd1RleHQoJCwgXywgTXVzdGFjaGUpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgJC53aWRnZXQoXCJkY3AuZGNwVGV4dFwiLCAkLmRjcC5kY3BBdHRyaWJ1dGUsIHtcbiAgICBvcHRpb25zOiB7XG4gICAgICB0eXBlOiBcInRleHRcIixcbiAgICAgIHJlbmRlck9wdGlvbnM6IHtcbiAgICAgICAgbWF4TGVuZ3RoOiAwLCAvLyBjaGFyIG1heCBsZW5ndGhcbiAgICAgICAgcGxhY2VIb2xkZXI6IFwiXCIsXG4gICAgICAgIGZvcm1hdDogXCJcIixcbiAgICAgICAga2VuZG9BdXRvQ29tcGxldGVDb25maWd1cmF0aW9uOiB7XG4gICAgICAgICAgZmlsdGVyOiBcImNvbnRhaW5zXCIsXG4gICAgICAgICAgY2xlYXJCdXR0b246IGZhbHNlLFxuICAgICAgICAgIG1pbkxlbmd0aDogMSxcbiAgICAgICAgICB0ZW1wbGF0ZTpcbiAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwiZGNwQXV0b2NvbXBsZXRlXCI+PHNwYW4gY2xhc3M9XCJrLXN0YXRlLWRlZmF1bHRcIj4jPSBkYXRhLnRpdGxlIzwvc3Bhbj4nICtcbiAgICAgICAgICAgIFwiI2lmIChkYXRhLm1lc3NhZ2UpIHsjXCIgK1xuICAgICAgICAgICAgJzxkaXYgY2xhc3M9XCJkY3BBdXRvY29tcGxldGUtLSM9IGRhdGEubWVzc2FnZS50eXBlI1wiPiM6IGRhdGEubWVzc2FnZS5jb250ZW50VGV4dCMgIz0gZGF0YS5tZXNzYWdlLmNvbnRlbnRIdG1sIzwvZGl2PicgK1xuICAgICAgICAgICAgXCIjfSMgPC9kaXY+XCJcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sXG5cbiAgICBrZW5kb1dpZGdldDogbnVsbCxcblxuICAgIF9pbml0RG9tOiBmdW5jdGlvbiB3VGV4dEluaXREb20oKSB7XG4gICAgICBpZiAodGhpcy5nZXRNb2RlKCkgPT09IFwicmVhZFwiKSB7XG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMucmVuZGVyT3B0aW9ucy5mb3JtYXQpIHtcbiAgICAgICAgICB0aGlzLm9wdGlvbnMuYXR0cmlidXRlVmFsdWUuZm9ybWF0VmFsdWUgPSBNdXN0YWNoZS5yZW5kZXIoXG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMucmVuZGVyT3B0aW9ucy5mb3JtYXQgfHwgXCJcIixcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucy5hdHRyaWJ1dGVWYWx1ZVxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgdGhpcy5fc3VwZXIoKTtcbiAgICAgIHRoaXMua2VuZG9XaWRnZXQgPSB0aGlzLmVsZW1lbnQuZmluZChcIi5kY3BBdHRyaWJ1dGVfX3ZhbHVlLS1lZGl0XCIpO1xuICAgICAgaWYgKHRoaXMua2VuZG9XaWRnZXQgJiYgdGhpcy5vcHRpb25zLmhhc0F1dG9jb21wbGV0ZSkge1xuICAgICAgICB0aGlzLmFjdGl2YXRlQXV0b2NvbXBsZXRlKHRoaXMua2VuZG9XaWRnZXQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKHRoaXMuZ2V0VHlwZSgpID09PSBcInRleHRcIikge1xuICAgICAgICAgIHRoaXMua2VuZG9XaWRnZXQuYWRkQ2xhc3MoXCJrLXRleHRib3hcIik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuXG4gICAgX2luaXRFdmVudDogZnVuY3Rpb24gd1RleHRJbml0RXZlbnQoKSB7XG4gICAgICBpZiAodGhpcy5nZXRNb2RlKCkgPT09IFwid3JpdGVcIikge1xuICAgICAgICB0aGlzLl9pbml0Q2hhbmdlRXZlbnQoKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuX3N1cGVyKCk7XG4gICAgfSxcblxuICAgIF9pbml0Q2hhbmdlRXZlbnQ6IGZ1bmN0aW9uIHdUZXh0SW5pdENoYW5nZUV2ZW50KCkge1xuICAgICAgdmFyIGN1cnJlbnRXaWRnZXQgPSB0aGlzO1xuICAgICAgaWYgKHRoaXMuZ2V0TW9kZSgpID09PSBcIndyaXRlXCIpIHtcbiAgICAgICAgdGhpcy5nZXRDb250ZW50RWxlbWVudHMoKS5vbihcbiAgICAgICAgICBcImNoYW5nZVwiICsgdGhpcy5ldmVudE5hbWVzcGFjZSxcbiAgICAgICAgICBmdW5jdGlvbiB3VGV4dENoYW5nZUVsZW1lbnQoKSB7XG4gICAgICAgICAgICB2YXIgbmV3VmFsdWUgPSBfLmNsb25lKGN1cnJlbnRXaWRnZXQub3B0aW9ucy5hdHRyaWJ1dGVWYWx1ZSk7XG4gICAgICAgICAgICBuZXdWYWx1ZS52YWx1ZSA9ICQodGhpcykudmFsKCk7XG4gICAgICAgICAgICBuZXdWYWx1ZS5kaXNwbGF5VmFsdWUgPSBuZXdWYWx1ZS52YWx1ZTtcbiAgICAgICAgICAgIGN1cnJlbnRXaWRnZXQuc2V0VmFsdWUobmV3VmFsdWUpO1xuICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogSnVzdCB0byBiZSBhcHBseSBpbiBub3JtYWwgaW5wdXQgaGVscFxuICAgICAqIEBwYXJhbSBpbnB1dFZhbHVlXG4gICAgICovXG4gICAgYWN0aXZhdGVBdXRvY29tcGxldGU6IGZ1bmN0aW9uIGFjdGl2YXRlQXV0b2NvbXBsZXRlKGlucHV0VmFsdWUpIHtcbiAgICAgIHZhciBjdXJyZW50V2lkZ2V0ID0gdGhpcztcbiAgICAgIHZhciBzeXN0ZW1PcHRpb24gPSB7XG4gICAgICAgIGRhdGFUZXh0RmllbGQ6IFwidGl0bGVcIixcbiAgICAgICAgZGF0YVNvdXJjZToge1xuICAgICAgICAgIC8vIHR5cGU6IFwianNvblwiLFxuXG4gICAgICAgICAgc2VydmVyRmlsdGVyaW5nOiB0cnVlLFxuICAgICAgICAgIHRyYW5zcG9ydDoge1xuICAgICAgICAgICAgcmVhZDogZnVuY3Rpb24gbWFwQXV0b0FjdGl2YXRlZChvcHRpb25zKSB7XG4gICAgICAgICAgICAgIG9wdGlvbnMuZGF0YS5pbmRleCA9IGN1cnJlbnRXaWRnZXQuX2dldEluZGV4KCk7XG4gICAgICAgICAgICAgIHJldHVybiBjdXJyZW50V2lkZ2V0Lm9wdGlvbnMuYXV0b2NvbXBsZXRlUmVxdWVzdC5jYWxsKFxuICAgICAgICAgICAgICAgIG51bGwsXG4gICAgICAgICAgICAgICAgb3B0aW9uc1xuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgZmlsdGVyaW5nOiBmdW5jdGlvbiB3VGV4dEZpbHRlcmluZyhlKSB7XG4gICAgICAgICAgLy8gc3BhY2Ugc2VhcmNoIGlzIHVzZWQgdG8gZm9yY2UgbmV3IHNlYXJjaFxuICAgICAgICAgIGlmIChlLmZpbHRlci52YWx1ZSA9PT0gXCIgXCIpIHtcbiAgICAgICAgICAgIGUuZmlsdGVyLnZhbHVlID0gXCJcIjtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHNlbGVjdDogZnVuY3Rpb24ga2VuZG9BdXRvY29tcGxldGVTZWxlY3QoZXZlbnQpIHtcbiAgICAgICAgICB2YXIgdmFsdWVJbmRleCA9IGN1cnJlbnRXaWRnZXQuX2dldEluZGV4KCk7XG4gICAgICAgICAgdmFyIGRhdGFJdGVtID0gdGhpcy5kYXRhU291cmNlLmF0KGV2ZW50Lml0ZW0uaW5kZXgoKSk7XG4gICAgICAgICAgLy9UaGUgb2JqZWN0IHJldHVybmVkIGJ5IGRhdGFTb3VyY2UuYXQgYXJlIGludGVybmFsIGtlbmRvIG9iamVjdCBzbyBJIGNsZWFuIGl0IHdpdGggdG9KU09OXG4gICAgICAgICAgaWYgKGRhdGFJdGVtLnRvSlNPTikge1xuICAgICAgICAgICAgZGF0YUl0ZW0gPSBkYXRhSXRlbS50b0pTT04oKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsgLy8gbm8gZmlyZSBjaGFuZ2UgZXZlbnRcbiAgICAgICAgICBjdXJyZW50V2lkZ2V0Ll90cmlnZ2VyKFwiY2hhbmdlYXR0cnN2YWx1ZVwiLCBldmVudCwge1xuICAgICAgICAgICAgZGF0YUl0ZW06IGRhdGFJdGVtLFxuICAgICAgICAgICAgdmFsdWVJbmRleDogdmFsdWVJbmRleFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICBpbnB1dFZhbHVlLmtlbmRvQXV0b0NvbXBsZXRlKFxuICAgICAgICBfLmV4dGVuZChcbiAgICAgICAgICB7fSxcbiAgICAgICAgICB0aGlzLm9wdGlvbnMucmVuZGVyT3B0aW9ucy5rZW5kb0F1dG9Db21wbGV0ZUNvbmZpZ3VyYXRpb24sXG4gICAgICAgICAgc3lzdGVtT3B0aW9uXG4gICAgICAgIClcbiAgICAgICk7XG4gICAgICB0aGlzLmVsZW1lbnQub24oXG4gICAgICAgIFwiY2xpY2tcIiArIHRoaXMuZXZlbnROYW1lc3BhY2UsXG4gICAgICAgIFwiLmRjcEF0dHJpYnV0ZV9fdmFsdWUtLWF1dG9jb21wbGV0ZS0tYnV0dG9uXCIsXG4gICAgICAgIGZ1bmN0aW9uIHdUZXh0Q2xpY2tBdXRvQ29tcGxldGUoZXZlbnQpIHtcbiAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgIGlucHV0VmFsdWUuZGF0YShcImtlbmRvQXV0b0NvbXBsZXRlXCIpLnNlYXJjaChcIiBcIik7IC8vIHVzZSBzcGFjZSBzZWFyY2hcbiAgICAgICAgfVxuICAgICAgKTtcbiAgICAgIHRoaXMuZWxlbWVudFxuICAgICAgICAuZmluZChcIi5kY3BBdHRyaWJ1dGVfX3ZhbHVlLS1hdXRvY29tcGxldGUtLWJ1dHRvblt0aXRsZV1cIilcbiAgICAgICAgLnRvb2x0aXAoe1xuICAgICAgICAgIGh0bWw6IHRydWUsXG4gICAgICAgICAgY29udGFpbmVyOiB0aGlzLmVsZW1lbnRcbiAgICAgICAgfSlcbiAgICAgICAgLmVhY2goZnVuY3Rpb24gd1RleHRJbml0TGlua1Rvb2x0aXAoKSB7XG4gICAgICAgICAgJCh0aGlzKVxuICAgICAgICAgICAgLmRhdGEoXCJicy50b29sdGlwXCIpXG4gICAgICAgICAgICAudGlwKClcbiAgICAgICAgICAgIC5hZGRDbGFzcyhcImRjcEF0dHJpYnV0ZV9fYXV0b2NvbXBsZXRlXCIpO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogTW9kaWZ5IHZhbHVlIHRvIHdpZGdldCBhbmQgc2VuZCBub3RpZmljYXRpb24gdG8gdGhlIHZpZXdcbiAgICAgKiBAcGFyYW0gdmFsdWVcbiAgICAgKi9cbiAgICBzZXRWYWx1ZTogZnVuY3Rpb24gd1RleHRTZXRWYWx1ZSh2YWx1ZSkge1xuICAgICAgdmFyIG9yaWdpbmFsVmFsdWU7XG5cbiAgICAgIHZhbHVlID0gXy5jbG9uZSh2YWx1ZSk7XG5cbiAgICAgIGlmIChfLmhhcyh2YWx1ZSwgXCJ2YWx1ZVwiKSAmJiAhXy5oYXModmFsdWUsIFwiZGlzcGxheVZhbHVlXCIpKSB7XG4gICAgICAgIHZhbHVlLmRpc3BsYXlWYWx1ZSA9IHZhbHVlLnZhbHVlO1xuICAgICAgfVxuICAgICAgdGhpcy5fc3VwZXIodmFsdWUpO1xuXG4gICAgICBvcmlnaW5hbFZhbHVlID0gdGhpcy5nZXRXaWRnZXRWYWx1ZSgpO1xuXG4gICAgICBpZiAodGhpcy5nZXRNb2RlKCkgPT09IFwid3JpdGVcIikge1xuICAgICAgICAvLyA6IGV4cGxpY2l0IGxhenkgZXF1YWxcbiAgICAgICAgaWYgKHZhbHVlLnZhbHVlID09PSBudWxsICYmIG9yaWdpbmFsVmFsdWUgPT09IFwiXCIpIHtcbiAgICAgICAgICBvcmlnaW5hbFZhbHVlID0gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBpZiAob3JpZ2luYWxWYWx1ZSAhPT0gdmFsdWUudmFsdWUpIHtcbiAgICAgICAgICAvLyBNb2RpZnkgdmFsdWUgb25seSBpZiBkaWZmZXJlbnRcbiAgICAgICAgICB0aGlzLmdldENvbnRlbnRFbGVtZW50cygpLnZhbCh2YWx1ZS52YWx1ZSk7XG4gICAgICAgICAgdGhpcy5mbGFzaEVsZW1lbnQoKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmICh0aGlzLmdldE1vZGUoKSA9PT0gXCJyZWFkXCIpIHtcbiAgICAgICAgdGhpcy5yZWRyYXcoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICBcIkF0dHJpYnV0ZSBcIiArIHRoaXMub3B0aW9ucy5pZCArIFwiIHVua293biBtb2RlIFwiICsgdGhpcy5nZXRNb2RlKClcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgZ2V0VHlwZTogZnVuY3Rpb24gZ2V0VHlwZSgpIHtcbiAgICAgIHJldHVybiBcInRleHRcIjtcbiAgICB9LFxuXG4gICAgX2Rlc3Ryb3k6IGZ1bmN0aW9uIF9kZXN0cm95KCkge1xuICAgICAgLy9EZXN0cm95IGF1dG9jb21wbGV0ZSBpZiBhY3RpdmF0ZWRcbiAgICAgIGlmICh0aGlzLmtlbmRvV2lkZ2V0ICYmIHRoaXMua2VuZG9XaWRnZXQuZGF0YShcImtlbmRvQXV0b0NvbXBsZXRlXCIpKSB7XG4gICAgICAgIHRoaXMua2VuZG9XaWRnZXQuZGF0YShcImtlbmRvQXV0b0NvbXBsZXRlXCIpLmRlc3Ryb3koKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuX3N1cGVyKCk7XG4gICAgfVxuICB9KTtcblxuICByZXR1cm4gJC5mbi5kY3BUZXh0O1xufSk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQ0EsV0FHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///61b480911316cdda77a4\n");

/***/ }),

/***/ "63e285088893d0390ab6":
/*!********************************************************************************!*\
  !*** ./src/Apps/DOCUMENT/IHM/widgets/documentController/documentController.js ***!
  \********************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* global define, console */\n!(__WEBPACK_AMD_DEFINE_ARRAY__ = [\n  __webpack_require__(/*! jquery */ \"127c8cf59f228bb01a21\"),\n  __webpack_require__(/*! underscore */ \"8e08e542008e4aef1f58\"),\n  __webpack_require__(/*! backbone */ \"1858b45bf48591489d06\"),\n  __webpack_require__(/*! dcpDocument/routers/router */ \"f845389cd549ce7299bb\"),\n  __webpack_require__(/*! dcpDocument/models/mDocument */ \"ab4ce4f91706f6c2712e\"),\n  __webpack_require__(/*! dcpDocument/controllerObjects/attributeInterface */ \"102a2812abe6ba802db9\"),\n  __webpack_require__(/*! dcpDocument/controllerObjects/menuInterface */ \"ae9a1dffcb7d80ee2f61\"),\n  __webpack_require__(/*! dcpDocument/controllerObjects/transitionInterface */ \"72700e7eabedfcaa8458\"),\n  __webpack_require__(/*! dcpDocument/views/document/vDocument */ \"07b96fa8c545aab31dad\"),\n  __webpack_require__(/*! dcpDocument/models/mTransition */ \"e795383f953f8380d242\"),\n  __webpack_require__(/*! dcpDocument/views/workflow/vTransition */ \"2b8c963e23b3e828472e\"),\n  __webpack_require__(/*! dcpDocument/models/mMenu */ \"8c1928b0f0f644cba374\"),\n  __webpack_require__(/*! dcpDocument/i18n/documentCatalog */ \"278ba7757aa1904087c6\"),\n  __webpack_require__(/*! dcpDocument/widgets/widget */ \"f562ab9f022eef93542c\"),\n  __webpack_require__(/*! dcpDocument/widgets/window/wConfirm */ \"3fc27e9e68117b665919\"),\n  __webpack_require__(/*! dcpDocument/widgets/window/wLoading */ \"570ca0403ab6bea71f8b\"),\n  __webpack_require__(/*! dcpDocument/widgets/window/wNotification */ \"77d7ff9509612d0e239e\")\n], __WEBPACK_AMD_DEFINE_RESULT__ = (function documentController(\n  $,\n  _,\n  Backbone,\n  Router,\n  DocumentModel,\n  AttributeInterface,\n  MenuInterface,\n  TransitionInterface,\n  DocumentView,\n  TransitionModel,\n  TransitionView,\n  MenuModel,\n  i18n\n) {\n  \"use strict\";\n\n  var ErrorModelNonInitialized = function ErrorModelNonInitialized(message) {\n    this.name = \"ErrorModelNonInitialized\";\n    this.message =\n      message ||\n      \"The widget model is not initialized, use fetchDocument to initialise it.\";\n    this.stack = new Error().stack;\n  };\n  ErrorModelNonInitialized.prototype = Object.create(Error.prototype);\n  ErrorModelNonInitialized.prototype.constructor = ErrorModelNonInitialized;\n\n  var eventList = [\n    \"beforeRender\",\n    \"ready\",\n    \"change\",\n    \"displayMessage\",\n    \"displayError\",\n    \"validate\",\n    \"attributeBeforeRender\",\n    \"attributeReady\",\n    \"attributeHelperSearch\",\n    \"attributeHelperResponse\",\n    \"attributeHelperSelect\",\n    \"attributeArrayChange\",\n    \"actionClick\",\n    \"attributeAnchorClick\",\n    \"beforeClose\",\n    \"close\",\n    \"beforeSave\",\n    \"afterSave\",\n    \"attributeDownloadFile\",\n    \"attributeUploadFile\",\n    \"attributeUploadFileDone\",\n    \"beforeDelete\",\n    \"afterDelete\",\n    \"beforeRestore\",\n    \"afterRestore\",\n    \"failTransition\",\n    \"successTransition\",\n    \"attributeBeforeTabSelect\",\n    \"attributeAfterTabSelect\",\n    \"attributeTabChange\",\n    \"beforeDisplayTransition\",\n    \"afterDisplayTransition\",\n    \"beforeTransition\",\n    \"beforeTransitionClose\",\n    \"destroy\",\n    \"attributeCreateDialogDocumentBeforeSetFormValues\",\n    \"attributeCreateDialogDocumentBeforeSetTargetValue\",\n    \"attributeCreateDialogDocumentReady\",\n    \"attributeCreateDialogDocumentBeforeClose\",\n    \"attributeCreateDialogDocumentBeforeDestroy\"\n  ];\n\n  $.widget(\"dcp.documentController\", {\n    options: {\n      eventPrefix: \"document\",\n      initid: null,\n      viewId: undefined,\n      revision: undefined,\n      constraintList: [],\n      eventListener: [],\n      _model: null,\n      activatedConstraint: {},\n      activatedEventListener: {},\n      _initializedModel: false,\n      _initializedView: false\n    },\n\n    /**\n     * Create widget\n     * @private\n     */\n    _create: function documentController_create() {\n      this.options.constraintList = {};\n      this.options.eventListener = {};\n      this.activatedConstraint = {};\n      this.activatedEventListener = {};\n      this._initializedModel = false;\n      this._initializedView = false;\n      this._customClientData = {};\n      if (!this.options.initid) {\n        return;\n      }\n      this._initializeWidget({}, this.options.customClientData);\n      this._super();\n    },\n\n    /**\n     * Delete the widget\n     * @private\n     */\n    _destroy: function documentController_destroy() {\n      this._triggerControllerEvent(\"destroy\", null, this.getProperties());\n      this.options.constraintList = {};\n      this.options.eventListener = {};\n      this.activatedConstraint = {};\n      this.activatedEventListener = {};\n      this._initializedModel = false;\n      this._initializedView = false;\n      this.element.removeData(\"document\");\n      if (this._model) {\n        this._model.trigger(\"destroy\");\n      }\n      this._trigger(\"destroy\");\n      this._super();\n    },\n\n    /**\n     * Initialize the widget\n     *\n     * Create Model, initView\n     *\n     * @param options object {\"success\": fct, \"error\", fct}\n     * @param customClientData object\n     *\n     * @private\n     */\n    _initializeWidget: function documentController_initializeWidget(\n      options,\n      customClientData\n    ) {\n      var promise,\n        currentWidget = this,\n        initializeSuccess = function documentController_initializeSuccess() {\n          currentWidget._initializedModel = true;\n        };\n      options = options || {};\n      this._initExternalElements();\n      this._initModel(this._getModelValue());\n      this._initView();\n      if (options.success) {\n        options.success = _.wrap(\n          options.success,\n          function documentController_fetchSuccess(success) {\n            initializeSuccess.apply(this, _.rest(arguments));\n            return success.apply(this, _.rest(arguments));\n          }\n        );\n      }\n      if (customClientData) {\n        this._model._customClientData = customClientData;\n      }\n      promise = this._model.fetchDocument(this._getModelValue(), options);\n      if (!options.success) {\n        promise.then(initializeSuccess);\n      }\n\n      this._initRouter({ useHistory: !this.options.noRouter });\n\n      return promise;\n    },\n\n    /**\n     * Return essential element of the current document\n     *\n     * @returns {Object}\n     * @private\n     */\n    _getModelValue: function documentController_getModelValue() {\n      return _.pick(this.options, \"initid\", \"viewId\", \"revision\");\n    },\n\n    /**\n     * Generate the dom where the view is inserted\n     * @private\n     */\n    _initDom: function documentController_initDom() {\n      var $document = this.element.find(\".dcpDocument\");\n      if (!this.$document || $document.length === 0) {\n        this.element.append('<div class=\"dcpDocument\"></div>');\n        this.$document = this.element.find(\".dcpDocument\");\n      }\n    },\n\n    /**\n     * Init the model and bind the events\n     *\n     * @param initialValue\n     * @returns DocumentModel\n     * @private\n     */\n    _initModel: function documentController_initModel(initialValue) {\n      var model;\n\n      //Don't reinit the model\n      if (!this._model) {\n        model = new DocumentModel(initialValue);\n        this._model = model;\n        this._initModelEvents();\n      } else {\n        this._reinitModel();\n      }\n      return model;\n    },\n\n    /**\n     * Init the view and bind the events\n     *\n     * @returns DocumentView\n     * @private\n     */\n    _initView: function documentController_initView() {\n      var documentView;\n      ///Don't reinit view\n      if (!this.view) {\n        this._initDom();\n        documentView = new DocumentView({\n          model: this._model,\n          el: this.$document[0]\n        });\n        this.view = documentView;\n        this._initViewEvents();\n      }\n      return this.view;\n    },\n\n    /**\n     * Clear and reinit the model with current widget values\n     *\n     * @private\n     */\n    _reinitModel: function documentController_reinitModel() {\n      this._model.set(this._getModelValue());\n    },\n\n    /**\n     * Init the external elements (loading bar and notification widget)\n     * @private\n     */\n    _initExternalElements: function documentController_initExternalElements() {\n      this.$loading = $(\".dcpLoading\").dcpLoading();\n      this.$notification = $(\"body\").dcpNotification(window.dcp.notifications); // active notification\n    },\n\n    /**\n     * Bind the model event\n     *\n     * Re-trigger the event\n     *\n     * @private\n     */\n    _initModelEvents: function documentController_initEvents() {\n      var currentWidget = this;\n      this._model.listenTo(\n        this._model,\n        \"invalid\",\n        function documentController_triggerShowInvalid(model, error) {\n          var result = currentWidget._triggerControllerEvent(\n            \"displayError\",\n            null,\n            currentWidget.getProperties(),\n            error\n          );\n          if (result) {\n            currentWidget.$notification.dcpNotification(\"showError\", error);\n          }\n        }\n      );\n      this._model.listenTo(\n        this._model,\n        \"showError\",\n        function documentController_triggerShowError(error) {\n          var result = currentWidget._triggerControllerEvent(\n            \"displayError\",\n            null,\n            currentWidget.getProperties(),\n            error\n          );\n          if (result) {\n            currentWidget.$notification.dcpNotification(\"showError\", error);\n          }\n        }\n      );\n      this._model.listenTo(\n        this._model,\n        \"showMessage\",\n        function documentController_triggerShowMessage(msg) {\n          var result = currentWidget._triggerControllerEvent(\n            \"displayMessage\",\n            null,\n            currentWidget.getProperties(),\n            msg\n          );\n          if (result) {\n            currentWidget.$notification.dcpNotification(\"show\", msg.type, msg);\n          }\n        }\n      );\n      this._model.listenTo(\n        this._model,\n        \"reload\",\n        function documentController_triggerReinit() {\n          // currentWidget._initModel(currentWidget._getModelValue());\n          // currentWidget._initView();\n          currentWidget._model.fetchDocument();\n        }\n      );\n      this._model.listenTo(\n        this._model,\n        \"sync\",\n        function documentController_triggerSync() {\n          currentWidget._initializedModel = true;\n          currentWidget.options.initid = currentWidget._model.id;\n          currentWidget.options.viewId = currentWidget._model.get(\"viewId\");\n          currentWidget.options.revision = currentWidget._model.get(\"revision\");\n          currentWidget.element.data(\n            \"document\",\n            currentWidget._getModelValue()\n          );\n          currentWidget._initActivatedConstraint();\n          currentWidget._initActivatedEventListeners({ launchReady: false });\n        }\n      );\n      this._model.listenTo(\n        this._model,\n        \"beforeRender\",\n        function documentController_triggerBeforeRender(event) {\n          event.prevent = !currentWidget._triggerControllerEvent(\n            \"beforeRender\",\n            event,\n            currentWidget.getProperties(),\n            currentWidget._model.getModelProperties()\n          );\n        }\n      );\n      this._model.listenTo(\n        this._model,\n        \"beforeClose\",\n        function documentController_triggerBeforeClose(\n          event,\n          nextDocument,\n          customClientData\n        ) {\n          if (currentWidget._initializedView !== false) {\n            event.prevent = !currentWidget._triggerControllerEvent(\n              \"beforeClose\",\n              event,\n              currentWidget.getProperties(),\n              nextDocument,\n              customClientData\n            );\n          }\n        }\n      );\n      this._model.listenTo(\n        this._model,\n        \"close\",\n        function documentController_triggerClose(oldProperties) {\n          if (currentWidget._initializedView !== false) {\n            currentWidget._triggerControllerEvent(\n              \"close\",\n              null,\n              currentWidget.getProperties(),\n              oldProperties\n            );\n          }\n          currentWidget._initializedView = false;\n        }\n      );\n      this._model.listenTo(\n        this._model,\n        \"getCustomClientData\",\n        function documentController_triggerAddCustomData() {\n          try {\n            currentWidget._model._customClientData = currentWidget.getCustomClientData(\n              false\n            );\n          } catch (e) {\n            //no test here\n          }\n        }\n      );\n      this._model.listenTo(\n        this._model,\n        \"beforeSave\",\n        function documentController_triggerBeforeSave(event, customClientData) {\n          var _model = this;\n          var requestOptions = {\n            getRequestData: function getRequestData() {\n              return _model.toJSON();\n            },\n            setRequestData: function documentControllerSetRequestData(data) {\n              _model._customRequestData = data;\n            }\n          };\n          event.prevent = !currentWidget._triggerControllerEvent(\n            \"beforeSave\",\n            event,\n            currentWidget.getProperties(),\n            requestOptions,\n            customClientData\n          );\n        }\n      );\n      this._model.listenTo(\n        this._model,\n        \"afterSave\",\n        function documentController_triggerAfterSave(oldProperties) {\n          currentWidget._triggerControllerEvent(\n            \"afterSave\",\n            null,\n            currentWidget.getProperties(),\n            oldProperties\n          );\n        }\n      );\n      this._model.listenTo(\n        this._model,\n        \"beforeRestore\",\n        function documentController_triggerBeforeRestore(event) {\n          event.prevent = !currentWidget._triggerControllerEvent(\n            \"beforeRestore\",\n            event,\n            currentWidget.getProperties()\n          );\n        }\n      );\n      this._model.listenTo(\n        this._model,\n        \"afterRestore\",\n        function documentController_triggerAfterRestore(oldProperties) {\n          currentWidget._triggerControllerEvent(\n            \"afterRestore\",\n            null,\n            currentWidget.getProperties(),\n            oldProperties\n          );\n        }\n      );\n      this._model.listenTo(\n        this._model,\n        \"beforeDelete\",\n        function documentController_triggerBeforeDelete(\n          event,\n          customClientData\n        ) {\n          event.prevent = !currentWidget._triggerControllerEvent(\n            \"beforeDelete\",\n            event,\n            currentWidget.getProperties(),\n            currentWidget._model.getModelProperties(),\n            customClientData\n          );\n        }\n      );\n      this._model.listenTo(\n        this._model,\n        \"afterDelete\",\n        function documentController_triggerAfterDelete(oldProperties) {\n          currentWidget._triggerControllerEvent(\n            \"afterDelete\",\n            null,\n            currentWidget.getProperties(),\n            oldProperties\n          );\n        }\n      );\n      this._model.listenTo(\n        this._model,\n        \"validate\",\n        function documentController_triggerValidate(event) {\n          event.prevent = !currentWidget._triggerControllerEvent(\n            \"validate\",\n            event,\n            currentWidget.getProperties()\n          );\n        }\n      );\n      this._model.listenTo(\n        this._model,\n        \"changeValue\",\n        function documentController_triggerChangeValue(options) {\n          try {\n            var currentAttribute = currentWidget.getAttribute(\n                options.attributeId\n              ),\n              index = 0,\n              values = currentAttribute.getValue(\"all\"),\n              mAttribute = currentWidget._getAttributeModel(\n                options.attributeId\n              );\n            if (mAttribute.getParent().get(\"type\") !== \"array\") {\n              index = -1;\n            } else {\n              var changesIndex = [];\n              _.each(\n                values.current,\n                function documentController_valueIsModified(currentValue) {\n                  var previous = values.previous[index];\n                  if (!previous) {\n                    changesIndex.push(index);\n                  } else {\n                    if (_.isArray(currentValue)) {\n                      currentValue = currentValue.join(\",\");\n                    }\n                    currentValue = _.has(currentValue, \"value\")\n                      ? currentValue.value\n                      : currentValue;\n                    if (_.isArray(previous)) {\n                      previous = previous.join(\",\");\n                    }\n                    previous = _.has(previous, \"value\")\n                      ? previous.value\n                      : previous;\n                    if (previous !== currentValue) {\n                      changesIndex.push(index);\n                    }\n                  }\n                  index++;\n                }\n              );\n              index = changesIndex.length === 1 ? changesIndex[0] : -1;\n            }\n            currentWidget._triggerAttributeControllerEvent(\n              \"change\",\n              null,\n              currentAttribute,\n              currentWidget.getProperties(),\n              currentAttribute,\n              currentAttribute.getValue(\"all\"),\n              index\n            );\n          } catch (error) {\n            if (!(error instanceof ErrorModelNonInitialized)) {\n              console.error(error);\n            }\n          }\n        }\n      );\n      this._model.listenTo(\n        this._model,\n        \"beforeAttributeRender\",\n        function documentController_triggerAttributeRender(\n          event,\n          attributeId,\n          $el,\n          index\n        ) {\n          try {\n            var currentAttribute = currentWidget.getAttribute(attributeId);\n            event.prevent = !currentWidget._triggerAttributeControllerEvent(\n              \"attributeBeforeRender\",\n              event,\n              currentAttribute,\n              currentWidget.getProperties(),\n              currentAttribute,\n              $el,\n              index\n            );\n          } catch (error) {\n            if (!(error instanceof ErrorModelNonInitialized)) {\n              console.error(error);\n            }\n          }\n        }\n      );\n      this._model.listenTo(\n        this._model,\n        \"attributeRender\",\n        function documentController_triggerAttributeRender(\n          attributeId,\n          $el,\n          index\n        ) {\n          try {\n            var currentAttribute = currentWidget.getAttribute(attributeId);\n            currentWidget._triggerAttributeControllerEvent(\n              \"attributeReady\",\n              null,\n              currentAttribute,\n              currentWidget.getProperties(),\n              currentAttribute,\n              $el,\n              index\n            );\n          } catch (error) {\n            if (!(error instanceof ErrorModelNonInitialized)) {\n              console.error(error);\n            }\n          }\n        }\n      );\n      this._model.listenTo(\n        this._model,\n        \"arrayModified\",\n        function documentController_triggerArrayModified(options) {\n          try {\n            var currentAttribute = currentWidget.getAttribute(\n              options.attributeId\n            );\n            currentWidget._triggerAttributeControllerEvent(\n              \"attributeArrayChange\",\n              null,\n              currentAttribute,\n              currentWidget.getProperties(),\n              currentAttribute,\n              options.type,\n              options.options\n            );\n          } catch (error) {\n            if (!(error instanceof ErrorModelNonInitialized)) {\n              console.error(error);\n            }\n          }\n        }\n      );\n      this._model.listenTo(\n        this._model,\n        \"internalLinkSelected\",\n        function documentController_triggerInternalLinkSelected(\n          event,\n          options\n        ) {\n          event.prevent = !currentWidget._triggerControllerEvent(\n            \"actionClick\",\n            event,\n            currentWidget.getProperties(),\n            options\n          );\n        }\n      );\n      this._model.listenTo(\n        this._model,\n        \"downloadFile\",\n        function documentController_triggerDownloadFile(\n          event,\n          attrid,\n          options\n        ) {\n          try {\n            var currentAttribute = currentWidget.getAttribute(attrid);\n            event.prevent = !currentWidget._triggerAttributeControllerEvent(\n              \"attributeDownloadFile\",\n              event,\n              currentAttribute,\n              currentWidget.getProperties(),\n              currentAttribute,\n              options.$el,\n              options.index\n            );\n          } catch (error) {\n            if (!(error instanceof ErrorModelNonInitialized)) {\n              console.error(error);\n            }\n          }\n        }\n      );\n      this._model.listenTo(\n        this._model,\n        \"uploadFile\",\n        function documentController_triggerUploadFile(event, attrid, options) {\n          try {\n            var currentAttribute = currentWidget.getAttribute(attrid);\n            event.prevent = !currentWidget._triggerAttributeControllerEvent(\n              \"attributeUploadFile\",\n              event,\n              currentAttribute,\n              currentWidget.getProperties(),\n              currentAttribute,\n              options.$el,\n              options.index,\n              {\n                file: options.file,\n                hasUploadingFiles: currentWidget._model.hasUploadingFile()\n              }\n            );\n          } catch (error) {\n            if (!(error instanceof ErrorModelNonInitialized)) {\n              console.error(error);\n            }\n          }\n        }\n      );\n      this._model.listenTo(\n        this._model,\n        \"uploadFileDone\",\n        function documentController_triggerUploadFile(event, attrid, options) {\n          try {\n            var currentAttribute = currentWidget.getAttribute(attrid);\n            event.prevent = !currentWidget._triggerAttributeControllerEvent(\n              \"attributeUploadFileDone\",\n              event,\n              currentAttribute,\n              currentWidget.getProperties(),\n              currentAttribute,\n              options.$el,\n              options.index,\n              {\n                file: options.file,\n                hasUploadingFiles: currentWidget._model.hasUploadingFile()\n              }\n            );\n          } catch (error) {\n            if (!(error instanceof ErrorModelNonInitialized)) {\n              console.error(error);\n            }\n          }\n        }\n      );\n\n      this._model.listenTo(\n        this._model,\n        \"attributeBeforeTabSelect\",\n        function documentController_triggerBeforeSelectTab(event, attrid) {\n          var currentAttribute = currentWidget.getAttribute(attrid);\n          var prevent;\n\n          prevent = !currentWidget._triggerAttributeControllerEvent(\n            \"attributeBeforeTabSelect\",\n            event,\n            currentAttribute,\n            currentWidget.getProperties(),\n            currentAttribute,\n            $(event.item)\n          );\n          if (prevent) {\n            event.preventDefault();\n          }\n        }\n      );\n      this._model.listenTo(\n        this._model,\n        \"attributeTabChange\",\n        function documentController_triggerAfterSelectTab(\n          event,\n          attrid,\n          $el,\n          data\n        ) {\n          var currentAttribute = currentWidget.getAttribute(attrid);\n\n          currentWidget._triggerAttributeControllerEvent(\n            \"attributeTabChange\",\n            event,\n            currentAttribute,\n            currentWidget.getProperties(),\n            currentAttribute,\n            $el,\n            data\n          );\n        }\n      );\n      this._model.listenTo(\n        this._model,\n        \"attributeAfterTabSelect\",\n        function documentController_triggerAfterSelectTab(event, attrid) {\n          var currentAttribute = currentWidget.getAttribute(attrid);\n\n          currentWidget._triggerAttributeControllerEvent(\n            \"attributeAfterTabSelect\",\n            event,\n            currentAttribute,\n            currentWidget.getProperties(),\n            currentAttribute,\n            $(event.item)\n          );\n        }\n      );\n      this._model.listenTo(\n        this._model,\n        \"helperSearch\",\n        function documentController_triggerHelperSearch(\n          event,\n          attrid,\n          options\n        ) {\n          try {\n            var currentAttribute = currentWidget.getAttribute(attrid);\n            event.prevent = !currentWidget._triggerAttributeControllerEvent(\n              \"attributeHelperSearch\",\n              event,\n              currentAttribute,\n              currentWidget.getProperties(),\n              currentAttribute,\n              options\n            );\n          } catch (error) {\n            if (!(error instanceof ErrorModelNonInitialized)) {\n              console.error(error);\n            }\n          }\n        }\n      );\n      this._model.listenTo(\n        this._model,\n        \"helperResponse\",\n        function documentController_triggerHelperResponse(\n          event,\n          attrid,\n          options\n        ) {\n          try {\n            var currentAttribute = currentWidget.getAttribute(attrid);\n            event.prevent = !currentWidget._triggerAttributeControllerEvent(\n              \"attributeHelperResponse\",\n              event,\n              currentAttribute,\n              currentWidget.getProperties(),\n              currentAttribute,\n              options\n            );\n          } catch (error) {\n            if (!(error instanceof ErrorModelNonInitialized)) {\n              console.error(error);\n            }\n          }\n        }\n      );\n      this._model.listenTo(\n        this._model,\n        \"helperSelect\",\n        function documentController_triggerHelperSelect(\n          event,\n          attrid,\n          options\n        ) {\n          try {\n            var currentAttribute = currentWidget.getAttribute(attrid);\n            event.prevent = !currentWidget._triggerAttributeControllerEvent(\n              \"attributeHelperSelect\",\n              event,\n              currentAttribute,\n              currentWidget.getProperties(),\n              currentAttribute,\n              options\n            );\n          } catch (error) {\n            if (!(error instanceof ErrorModelNonInitialized)) {\n              console.error(error);\n            }\n          }\n        }\n      );\n\n      // listener to prevent default actions when anchorClick is triggered\n      this._model.listenTo(\n        this._model,\n        \"anchorClick\",\n        function documentController_triggerHelperSelect(\n          event,\n          attrid,\n          options\n        ) {\n          try {\n            var currentAttribute = currentWidget.getAttribute(attrid);\n            event.prevent = !currentWidget._triggerAttributeControllerEvent(\n              \"attributeAnchorClick\",\n              event,\n              currentAttribute,\n              currentWidget.getProperties(),\n              currentAttribute,\n              options.$el,\n              options.index,\n              options.options\n            );\n          } catch (error) {\n            if (!(error instanceof ErrorModelNonInitialized)) {\n              console.error(error);\n            }\n          }\n        }\n      );\n\n      // Generic listener for addCreateDocumentButton docid render option\n      this._model.listenTo(\n        this._model,\n        \"createDialogListener\",\n        function documentController_triggercreateDialogDocumentOpen(\n          event,\n          attrid,\n          options\n        ) {\n          try {\n            var currentAttribute = currentWidget.getAttribute(attrid);\n            var triggername = \"attributeCreateDialogDocument\";\n            // Uppercase first letter\n            triggername +=\n              options.triggerId.charAt(0).toUpperCase() +\n              options.triggerId.slice(1);\n\n            event.prevent = !currentWidget._triggerAttributeControllerEvent(\n              triggername,\n              event,\n              currentAttribute,\n              currentWidget.getProperties(),\n              currentAttribute,\n              options\n            );\n          } catch (error) {\n            if (!(error instanceof ErrorModelNonInitialized)) {\n              console.error(error);\n            }\n          }\n        }\n      );\n      this._model.listenTo(\n        this._model,\n        \"constraint\",\n        function documentController_triggerConstraint(\n          attribute,\n          constraintController\n        ) {\n          try {\n            var currentAttribute = currentWidget.getAttribute(attribute),\n              currentModel = currentWidget.getProperties(),\n              $element = $(currentWidget.element),\n              addConstraint = function documentController_addConstraint(\n                currentConstraint\n              ) {\n                if (_.isString(currentConstraint)) {\n                  constraintController.addConstraintMessage(currentConstraint);\n                }\n                if (\n                  _.isObject(currentConstraint) &&\n                  currentConstraint.message &&\n                  _.isNumber(currentConstraint.index)\n                ) {\n                  constraintController.addConstraintMessage(\n                    currentConstraint.message,\n                    currentConstraint.index\n                  );\n                }\n              };\n            _.each(\n              currentWidget.activatedConstraint,\n              function triggerCurrentConstraint(currentConstraint) {\n                try {\n                  if (\n                    currentConstraint.attributeCheck.apply($element, [\n                      currentAttribute,\n                      currentModel\n                    ])\n                  ) {\n                    var response = currentConstraint.constraintCheck.call(\n                      $element,\n                      currentModel,\n                      currentAttribute,\n                      currentAttribute.getValue(\"all\")\n                    );\n                    if (_.isArray(response)) {\n                      _.each(response, addConstraint);\n                    } else {\n                      addConstraint(response);\n                    }\n                  }\n                } catch (e) {\n                  console.error(e);\n                }\n              }\n            );\n          } catch (error) {\n            if (!(error instanceof ErrorModelNonInitialized)) {\n              console.error(error);\n            }\n          }\n        }\n      );\n      this._model.listenTo(\n        this._model,\n        \"showTransition\",\n        _.bind(currentWidget._initAndDisplayTransition, this)\n      );\n      this._model.listenTo(\n        this._model,\n        \"beforeParse\",\n        _.bind(function deleteCustomClient() {\n          //Suppress customClientData after a sucessful transaction\n          try {\n            currentWidget.getCustomClientData(true);\n          } catch (e) {\n            //no test here\n          }\n        }, this)\n      );\n    },\n\n    /**\n     * Bind the view\n     * Re-trigger the events\n     *\n     * @private\n     */\n    _initViewEvents: function documentController_initViewEvents() {\n      var currentWidget = this;\n      this.view.on(\n        \"cleanNotification\",\n        function documentController_triggerCleanNotification() {\n          currentWidget.$notification.dcpNotification(\"clear\");\n        }\n      );\n      this.view.on(\"loading\", function documentController_triggerLoading(\n        data,\n        nbItem\n      ) {\n        currentWidget.$loading.dcpLoading(\"setPercent\", data);\n        if (nbItem) {\n          currentWidget.$loading.dcpLoading(\"setNbItem\", nbItem);\n        }\n      });\n      this.view.on(\"loaderShow\", function documentController_triggerLoaderShow(\n        text,\n        pc\n      ) {\n        console.time(\"xhr+render document view\");\n        currentWidget.$loading.dcpLoading(\"show\", text, pc);\n      });\n      this.view.on(\"loaderHide\", function documentController_triggerHide() {\n        currentWidget.$loading.dcpLoading(\"hide\");\n      });\n      this.view.on(\n        \"partRender\",\n        function documentController_triggerPartRender() {\n          currentWidget.$loading.dcpLoading(\"addItem\");\n        }\n      );\n      this.view.on(\n        \"renderDone\",\n        function documentController_triggerRenderDone() {\n          console.timeEnd(\"xhr+render document view\");\n          currentWidget.$loading.dcpLoading(\"setPercent\", 100);\n          currentWidget.$loading.dcpLoading(\"setLabel\", null);\n          currentWidget._initializedView = true;\n          currentWidget._triggerControllerEvent(\n            \"ready\",\n            null,\n            currentWidget.getProperties()\n          );\n          _.delay(function documentController_endRender() {\n            currentWidget.$loading.dcpLoading(\"hide\", true);\n            console.timeEnd(\"main\");\n          });\n        }\n      );\n      this.view.on(\n        \"showMessage\",\n        function documentController_triggerShowMessage(message) {\n          var result = currentWidget._triggerControllerEvent(\n            \"displayMessage\",\n            null,\n            currentWidget.getProperties(),\n            message\n          );\n          if (result) {\n            currentWidget.$notification.dcpNotification(\n              \"show\",\n              message.type,\n              message\n            );\n          }\n        }\n      );\n      this.view.on(\n        \"showSuccess\",\n        function documentController_triggerShowSuccess(message) {\n          var result = currentWidget._triggerControllerEvent(\n            \"displayMessage\",\n            null,\n            currentWidget.getProperties(),\n            message\n          );\n          if (result) {\n            currentWidget.$notification.dcpNotification(\"showSuccess\", message);\n          }\n        }\n      );\n      this.view.on(\"reinit\", function documentController_triggerReinit() {\n        currentWidget._initModel(currentWidget._getModelValue());\n        currentWidget._initView();\n        currentWidget._model.fetchDocument();\n      });\n    },\n\n    /**\n     * Init the pushstate router\n     *\n     * @private\n     */\n    _initRouter: function documentController_initRouter(config) {\n      if (this.router) {\n        return this.router;\n      }\n      try {\n        if (window.history && history.pushState) {\n          Backbone.history.start({ pushState: true });\n        } else {\n          //For browser without API history\n          Backbone.history.start();\n        }\n      } catch (e) {\n        console.error(e);\n      }\n      this.router = new Router({\n        document: this._model,\n        useHistory: !config || config.useHistory\n      });\n    },\n\n    /**\n     * Init and display the change state pop-up\n     *\n     * @param nextState\n     * @param transition\n     * @param values\n     * @param withoutInterface\n     * @param reinitOptions\n     */\n    _initAndDisplayTransition: function documentController_initAndDisplayTransition(\n      nextState,\n      transition,\n      values,\n      withoutInterface,\n      reinitOptions\n    ) {\n      var $target = $('<div class=\"dcpTransition\"/>'),\n        transitionElements = {},\n        currentWidget = this,\n        result,\n        transitionInterface,\n        documentServerProperties = this.getProperties();\n\n      return new Promise(function documentController_changeStatePromise(\n        resolve,\n        reject\n      ) {\n        result = !currentWidget._triggerControllerEvent(\n          \"beforeDisplayChangeState\",\n          null,\n          currentWidget.getProperties(),\n          new TransitionInterface(null, $target, nextState, transition)\n        );\n        if (result) {\n          reject();\n          return this;\n        }\n\n        //Init transition model\n        transitionElements.model = new TransitionModel({\n          documentId: currentWidget._model.id,\n          documentModel: currentWidget._model,\n          state: nextState,\n          transition: transition\n        });\n\n        //Init transition view\n        if (withoutInterface !== true) {\n          transitionElements.view = new TransitionView({\n            model: transitionElements.model,\n            el: $target\n          });\n        }\n\n        transitionInterface = new TransitionInterface(\n          transitionElements.model,\n          $target,\n          nextState,\n          transition\n        );\n\n        if (transitionElements.view) {\n          //Propagate afterDisplayChange on renderDone\n          transitionElements.view.once(\n            \"renderTransitionWindowDone\",\n            function documentController_propagateAfter() {\n              currentWidget._triggerControllerEvent(\n                \"afterDisplayTransition\",\n                null,\n                currentWidget.getProperties(),\n                transitionInterface\n              );\n            }\n          );\n        }\n\n        //Propagate the beforeTransition\n        transitionElements.model.listenTo(\n          transitionElements.model,\n          \"beforeChangeState\",\n          function documentController_propagateBeforeTransition(event) {\n            event.prevent = !currentWidget._triggerControllerEvent(\n              \"beforeTransition\",\n              null,\n              currentWidget.getProperties(),\n              transitionInterface\n            );\n          }\n        );\n\n        //Propagate the beforeTransitionClose\n        transitionElements.model.listenTo(\n          transitionElements.model,\n          \"beforeChangeStateClose\",\n          function documentController_propagateTransitionClose(event) {\n            event.prevent = !currentWidget._triggerControllerEvent(\n              \"beforeTransitionClose\",\n              null,\n              currentWidget.getProperties(),\n              transitionInterface\n            );\n          }\n        );\n\n        transitionElements.model.listenTo(\n          transitionElements.model,\n          \"showError\",\n          function documentController_propagateTransitionError(error) {\n            event.prevent = !currentWidget._triggerControllerEvent(\n              \"failTransition\",\n              null,\n              currentWidget.getProperties(),\n              transitionInterface,\n              error\n            );\n            reject({ documentProperties: documentServerProperties });\n          }\n        );\n\n        transitionElements.model.listenTo(\n          transitionElements.model,\n          \"success\",\n          function documentController_TransitionSuccess(messages) {\n            if (transitionElements.view) {\n              transitionElements.view.$el.hide();\n              currentWidget.view.once(\n                \"renderDone\",\n                function documentController_transitionRender() {\n                  transitionElements.view.remove();\n                  _.each(messages, function documentController_parseMessage(\n                    message\n                  ) {\n                    currentWidget.view.trigger(\"showMessage\", message);\n                  });\n                }\n              );\n            }\n\n            //delete the pop up when the render of the pop up is done\n            currentWidget._triggerControllerEvent(\n              \"successTransition\",\n              null,\n              currentWidget.getProperties(),\n              transitionInterface\n            );\n\n            reinitOptions = reinitOptions || { revision: -1 };\n            if (!_.has(reinitOptions, \"revision\")) {\n              reinitOptions.revision = -1;\n            }\n\n            //Reinit the main model with last revision\n            currentWidget.reinitDocument(reinitOptions).then(\n              function documentController_reinitDone() {\n                resolve({ documentProperties: documentServerProperties });\n              },\n              function documentController_reinitFail() {\n                reject({ documentProperties: documentServerProperties });\n              }\n            );\n          }\n        );\n\n        transitionElements.model.listenTo(\n          currentWidget._model,\n          \"sync\",\n          function documentController_TransitionClose() {\n            this.trigger(\"close\");\n          }\n        );\n\n        transitionElements.model.fetch({\n          success: function transitionModel_setDefaultValues() {\n            if (values) {\n              transitionElements.model.setValues(values);\n            }\n            if (withoutInterface === true) {\n              transitionElements.model\n                ._loadDocument(transitionElements.model)\n                .then(function documentController_TransitionSave() {\n                  transitionElements.model.save(\n                    {},\n                    {\n                      success: function transitionModel_afterSave() {\n                        transitionElements.model.trigger(\"success\");\n                        resolve({\n                          documentProperties: documentServerProperties\n                        });\n                      },\n                      error: function transitionModel_error() {\n                        reject({\n                          documentProperties: documentServerProperties\n                        });\n                      }\n                    }\n                  );\n                })\n                .catch(function transitionModel_error() {\n                  reject({ documentProperties: documentServerProperties });\n                });\n            } else {\n              transitionElements.model\n                ._loadDocument(transitionElements.model)\n                .then(function documentController_TransitionDisplay() {\n                  transitionElements.model.trigger(\"dduiDocumentReady\");\n                })\n                .catch(function transitionModel_error() {\n                  reject({ documentProperties: documentServerProperties });\n                });\n            }\n          },\n          error: function transitionModel_error(theModel, response, options) {\n            var errorTxt = { title: \"Transition Error\" };\n            if (options && options.errorThrown) {\n              errorTxt.message = options.errorThrown;\n            }\n            currentWidget.$notification.dcpNotification(\"showError\", errorTxt);\n            transitionElements.model.trigger(\"showError\", errorTxt);\n          }\n        });\n      });\n    },\n\n    /**\n     * Get a backbone model of an attribute\n     *\n     * @param attributeId\n     * @returns {*}\n     */\n    _getAttributeModel: function documentController_getAttributeModel(\n      attributeId\n    ) {\n      var attributes = this._model.get(\"attributes\");\n      var attribute;\n      if (!attributes) {\n        throw new Error(\n          'Attribute models not initialized yet : The attribute \"' +\n            attributeId +\n            '\" cannot be found.'\n        );\n      }\n      attribute = this._model.get(\"attributes\").get(attributeId);\n      if (!attribute) {\n        return undefined;\n      }\n      return attribute;\n    },\n\n    _getMenuModel: function documentController_getMenuModel(menuId) {\n      var menus = this._model.get(\"menus\");\n\n      var menu = menus.get(menuId);\n      if (!menu && menus) {\n        menus.each(function documentControllerGetMenuIterate(itemMenu) {\n          if (itemMenu.get(\"content\")) {\n            _.each(\n              itemMenu.get(\"content\"),\n              function documentControllerGetSubMenuIterate(subMenu) {\n                if (subMenu.id === menuId) {\n                  menu = new MenuModel(subMenu);\n                }\n              }\n            );\n          }\n        });\n      }\n      return menu;\n    },\n\n    /**\n     * Get all rendered attributes with their root dom node\n     *\n     * @returns {*}\n     */\n    _getRenderedAttributes: function documentController_getRenderedAttributes() {\n      return this._model\n        .get(\"attributes\")\n        .chain()\n        .map(function documentController_getRenderedAttribute(\n          currentAttribute\n        ) {\n          return {\n            view: currentAttribute.haveView(),\n            id: currentAttribute.id\n          };\n        })\n        .filter(function documentController_suppressNoView(currentAttribut) {\n          return currentAttribut.view.haveView;\n        })\n        .value();\n    },\n\n    /**\n     * Get max index of an array\n     *\n     * @param attributeArray\n     * @returns {*}\n     */\n    _getMaxIndex: function documentController_getMaxIndex(attributeArray) {\n      return _.size(\n        attributeArray\n          .get(\"content\")\n          .max(function documentController_getMax(currentAttr) {\n            return _.size(currentAttr.get(\"attributeValue\"));\n          })\n          .get(\"attributeValue\")\n      );\n    },\n\n    /**\n     * Activate constraint on the current document\n     * Used on the fetch of a new document\n     *\n     */\n    _initActivatedConstraint: function documentController_initActivatedConstraint() {\n      var currentDocumentProperties = this.getProperties(),\n        currentWidget = this;\n      this.activatedConstraint = {};\n      _.each(\n        this.options.constraintList,\n        function documentController_getActivatedConstraint(currentConstraint) {\n          if (\n            currentConstraint.documentCheck.call(\n              $(currentWidget.element),\n              currentDocumentProperties\n            )\n          ) {\n            currentWidget.activatedConstraint[\n              currentConstraint.name\n            ] = currentConstraint;\n          }\n        }\n      );\n    },\n\n    /**\n     * Activate events on the current document\n     * Used on the fetch of a new document\n     */\n    _initActivatedEventListeners: function documentController_initActivatedEvents(\n      options\n    ) {\n      var currentDocumentProperties = this.getProperties(),\n        currentWidget = this;\n      options = options || {};\n      this.activatedEventListener = {};\n      _.each(\n        this.options.eventListener,\n        function documentController_getActivatedEvent(currentEvent) {\n          if (!_.isFunction(currentEvent.documentCheck)) {\n            currentWidget.activatedEventListener[\n              currentEvent.name\n            ] = currentEvent;\n            return;\n          }\n          if (\n            currentEvent.documentCheck.call(\n              $(currentWidget.element),\n              currentDocumentProperties\n            )\n          ) {\n            currentWidget.activatedEventListener[\n              currentEvent.name\n            ] = currentEvent;\n          }\n        }\n      );\n      //Trigger new added ready event\n      if (this._initializedView !== false && options.launchReady !== false) {\n        this._triggerControllerEvent(\"ready\", null, currentDocumentProperties);\n        _.each(\n          this._getRenderedAttributes(),\n          function documentController_triggerRenderedAttributes(\n            currentAttribute\n          ) {\n            var objectAttribute = currentWidget.getAttribute(\n              currentAttribute.id\n            );\n            currentWidget._triggerAttributeControllerEvent(\n              \"attributeReady\",\n              null,\n              currentAttribute,\n              currentDocumentProperties,\n              objectAttribute,\n              currentAttribute.view.elements\n            );\n          }\n        );\n      }\n    },\n\n    /**\n     * Add new event and autotrigger already done event for ready\n     *\n     * @param newEvent\n     */\n    _addAndInitNewEvents: function documentController_addAndInitNewEvents(\n      newEvent\n    ) {\n      var currentDocumentProperties,\n        currentWidget = this,\n        event,\n        uniqueName,\n        $element = $(currentWidget.element);\n      uniqueName =\n        (newEvent.externalEvent ? \"external_\" : \"internal_\") + newEvent.name;\n      this.options.eventListener[uniqueName] = newEvent;\n\n      if (!this._initializedModel) {\n        //early event model is not ready (no trigger, or current register possible)\n        return this;\n      }\n      currentDocumentProperties = this.getProperties();\n      // Check if the event is for the current document\n      if (\n        !_.isFunction(newEvent.documentCheck) ||\n        newEvent.documentCheck.call($element, currentDocumentProperties)\n      ) {\n        this.activatedEventListener[newEvent.name] = newEvent;\n        // Check if we need to manually trigger this callback (late registered : only for ready events)\n        if (this._initializedView !== false) {\n          if (newEvent.eventType === \"ready\") {\n            event = $.Event(newEvent.eventType);\n            event.target = currentWidget.element;\n            try {\n              // add element as function context\n              newEvent.eventCallback.call(\n                $element,\n                event,\n                currentDocumentProperties\n              );\n            } catch (e) {\n              console.error(e);\n            }\n          }\n          if (newEvent.eventType === \"attributeReady\") {\n            event = $.Event(newEvent.eventType);\n            event.target = currentWidget.element;\n            _.each(\n              this._getRenderedAttributes(),\n              function documentController_triggerRenderedAttributes(\n                currentAttribute\n              ) {\n                var objectAttribute = currentWidget.getAttribute(\n                  currentAttribute.id\n                );\n                if (\n                  !_.isFunction(newEvent.attributeCheck) ||\n                  newEvent.attributeCheck.apply($element, [objectAttribute])\n                ) {\n                  try {\n                    // add element as function context\n                    newEvent.eventCallback.call(\n                      $element,\n                      event,\n                      currentDocumentProperties,\n                      objectAttribute,\n                      currentAttribute.view.elements\n                    );\n                  } catch (e) {\n                    console.error(e);\n                  }\n                }\n              }\n            );\n          }\n        }\n      }\n    },\n\n    /**\n     * Trigger attribute event\n     *\n     * Similar at trigger document event with a constraint on attribute\n     *\n     * @param eventName\n     * @param originalEvent\n     * @param attributeInternalElement\n     * @returns {boolean}\n     */\n    _triggerAttributeControllerEvent: function documentController_triggerAttributeControllerEvent(\n      eventName,\n      originalEvent,\n      attributeInternalElement\n    ) {\n      var currentWidget = this,\n        args = Array.prototype.slice.call(arguments, 3),\n        event = $.Event(eventName),\n        externalEventArgument,\n        $element = $(currentWidget.element);\n      event.target = currentWidget.element;\n      // internal event trigger\n      if (originalEvent && originalEvent.preventDefault) {\n        event.originalEvent = originalEvent;\n      }\n      args.unshift(event);\n      _.chain(this.activatedEventListener)\n        .filter(function documentController__filterUsableEvents(currentEvent) {\n          // Check by eventType (only call callback with good eventType)\n          if (currentEvent.eventType === eventName) {\n            //Check with attributeCheck if the function exist\n            if (!_.isFunction(currentEvent.attributeCheck)) {\n              return true;\n            }\n            return currentEvent.attributeCheck.apply($element, [\n              attributeInternalElement,\n              currentWidget.getProperties()\n            ]);\n          }\n          return false;\n        })\n        .each(function documentController_applyCallBack(currentEvent) {\n          try {\n            currentEvent.eventCallback.apply($element, args);\n          } catch (e) {\n            if (window.dcp && window.dcp.logger) {\n              window.dcp.logger(e);\n            } else {\n              console.error(e);\n            }\n          }\n        });\n      externalEventArgument = Array.prototype.slice.call(arguments, 0);\n      externalEventArgument.splice(1, 1);\n      currentWidget._triggerExternalEvent.apply(\n        currentWidget,\n        externalEventArgument\n      );\n      return !event.isDefaultPrevented();\n    },\n\n    /**\n     * Trigger a controller event\n     * That kind of event are only for this widget\n     *\n     * @param eventName\n     * @param originalEvent\n     * @returns {boolean}\n     */\n    _triggerControllerEvent: function documentController_triggerControllerEvent(\n      eventName,\n      originalEvent\n    ) {\n      var currentWidget = this,\n        args = Array.prototype.slice.call(arguments, 2),\n        event = $.Event(eventName);\n      event.target = currentWidget.element;\n      if (originalEvent && originalEvent.preventDefault) {\n        event.originalEvent = originalEvent;\n      }\n      // internal event trigger\n      args.unshift(event);\n      _.chain(this.activatedEventListener)\n        .filter(function documentController_getEventName(currentEvent) {\n          return currentEvent.eventType === eventName;\n        })\n        .each(function documentController_triggerAnEvent(currentEvent) {\n          try {\n            currentEvent.eventCallback.apply($(currentWidget.element), args);\n          } catch (e) {\n            if (window.dcp.logger) {\n              window.dcp.logger(e);\n            } else {\n              console.error(e);\n            }\n          }\n        });\n      currentWidget._triggerExternalEvent.apply(currentWidget, arguments);\n      return !event.isDefaultPrevented();\n    },\n\n    /**\n     * Trigger event as jQuery standard events (all events are prefixed by document)\n     *\n     * @param type\n     */\n    _triggerExternalEvent: function documentController_triggerExternalEvent(\n      type\n    ) {\n      var currentWidget = this,\n        args = Array.prototype.slice.call(arguments, 1),\n        event = $.Event(type);\n      //prepare argument for widget event trigger (we want type, event, data)\n      // add the eventObject\n      args.unshift(event);\n      // add the type\n      args.unshift(type);\n      // concatenate other argument in one element (to respect widget pattern)\n      args[2] = args.slice(2);\n      // suppress other arguments (since they have been concatened)\n      args = args.slice(0, 3);\n      //trigger external event\n      currentWidget._trigger.apply(currentWidget, args);\n    },\n\n    /**\n     * Check if event name is valid\n     *\n     * @param eventName string\n     * @private\n     */\n    _checkEventName: function documentController_checkEventName(eventName) {\n      if (\n        _.isString(eventName) &&\n        (eventName.indexOf(\"custom:\") === 0 ||\n          _.find(eventList, function documentController_CheckEventType(\n            currentEventType\n          ) {\n            return currentEventType === eventName;\n          }))\n      ) {\n        return true;\n      }\n      throw new Error(\n        \"The event type \" +\n          eventName +\n          \" is not known. It must be one of \" +\n          eventList.sort().join(\" ,\")\n      );\n    },\n\n    /**\n     * Check if the view is initialized\n     *\n     * @private\n     */\n    _checkInitialisedView: function documentController_checkInitialised() {\n      if (!this._initializedView) {\n        throw new ErrorModelNonInitialized(\n          \"The widget view is not initialized, use fetchDocument to initialise it.\"\n        );\n      }\n    },\n\n    /**\n     * Check if the model is initialized\n     *\n     * @private\n     */\n    _checkInitialisedModel: function documentController_checkInitialisedModel() {\n      if (!this._initializedModel) {\n        throw new ErrorModelNonInitialized();\n      }\n    },\n\n    _registerOutputPromise: function documentController_registerOutputPromise(\n      documentPromise,\n      options\n    ) {\n      var currentWidget = this;\n      return new Promise(function documentController_reinitPromise(\n        resolve,\n        reject\n      ) {\n        documentPromise.then(\n          function documentController_reinitDone(values) {\n            if (options && _.isFunction(options.success)) {\n              try {\n                if (window.console.warn) {\n                  window.console.warn(\n                    'Callback \"success\" is deprecated use promise instead'\n                  );\n                }\n                options.success.call(\n                  $(currentWidget.element),\n                  values.documentProperties || {},\n                  currentWidget.getProperties()\n                );\n              } catch (exception) {\n                if (window.dcp.logger) {\n                  window.dcp.logger(exception);\n                } else {\n                  console.error(exception);\n                }\n              }\n            }\n            resolve({\n              element: $(currentWidget.element),\n              previousDocument: values.documentProperties || {},\n              nextDocument: currentWidget.getProperties()\n            });\n          },\n          function documentController_reinitFail(values) {\n            var errorArguments = values.arguments;\n            var errorMessage = { contentText: \"Undefined error\" };\n\n            if (values.arguments) {\n              try {\n                if (\n                  errorArguments &&\n                  errorArguments[1] &&\n                  errorArguments[1].responseJSON\n                ) {\n                  errorMessage = errorArguments[1].responseJSON.messages[0];\n                }\n              } catch (e) {\n                //no error here\n              }\n              if (\n                errorArguments &&\n                errorArguments[0] &&\n                errorArguments[0].eventPrevented\n              ) {\n                errorMessage = { contentText: \"Event prevented\" };\n              }\n              if (\n                errorArguments &&\n                errorArguments[0] &&\n                errorArguments[0].errorMessage\n              ) {\n                errorMessage = errorArguments[0].errorMessage;\n              }\n            }\n            if (options && _.isFunction(options.error)) {\n              try {\n                if (window.console.warn) {\n                  window.console.warn(\n                    'Callback \"error\" is deprecated use promise instead'\n                  );\n                }\n                options.error.call(\n                  $(currentWidget.element),\n                  values.documentProperties || {},\n                  null,\n                  errorMessage\n                );\n              } catch (exception) {\n                window.dcp.logger(exception);\n              }\n            }\n            reject({\n              element: $(currentWidget.element),\n              previousDocument: values.documentProperties || {},\n              nextDocument: null,\n              errorMessage: errorMessage\n            });\n          }\n        );\n      });\n    },\n\n    /***************************************************************************************************************\n     * External function\n     **************************************************************************************************************/\n    /**\n     * Reinit the current document (close it and re-open it) : keep the same view, revision, etc...\n     *\n     * @param values object {\"initid\" : int, \"revision\" : int, \"viewId\" : string, \"customClientData\" : mixed}\n     * @param options object {\"success\": fct, \"error\", fct}\n     */\n    reinitDocument: function documentControllerReinitDocument(values, options) {\n      var properties = this.getProperties();\n      this._checkInitialisedModel();\n      values = values || {};\n\n      //Reinit model with server values\n      _.defaults(values, {\n        revision: properties.revision,\n        viewId: properties.viewId,\n        initid: properties.initid\n      });\n\n      return this.fetchDocument(values, options);\n    },\n\n    /**\n     * Fetch a new document\n     * @param values object {\"initid\" : int, \"revision\" : int, \"viewId\" : string, \"customClientData\" : mixed}\n     * @param options object {\"success\": fct, \"error\", fct}\n     */\n    fetchDocument: function documentControllerFetchDocument(values, options) {\n      var documentPromise, callBackPromise;\n      var currentWidget = this;\n      values = _.isUndefined(values) ? {} : values;\n      options = options || {};\n\n      if (!_.isObject(values)) {\n        throw new Error(\n          'Fetch argument must be an object {\"initid\":, \"revision\": , \"viewId\": }'\n        );\n      }\n\n      if (!values.initid) {\n        throw new Error(\"initid argument is mandatory\");\n      }\n\n      if (!isNaN(values.initid)) {\n        // Convert to numeric initid is possible\n        values.initid = parseInt(values.initid);\n      }\n\n      // Use default values when fetch another document\n      _.defaults(values, { revision: -1, viewId: \"!defaultConsultation\" });\n      _.defaults(options, { force: false });\n\n      _.each(\n        _.pick(values, \"initid\", \"revision\", \"viewId\"),\n        function dcpDocument_setNewOptions(value, key) {\n          currentWidget.options[key] = value;\n        }\n      );\n\n      if (!this._model) {\n        documentPromise = this._initializeWidget(\n          options,\n          values.customClientData\n        );\n      } else {\n        if (values.customClientData) {\n          this._model._customClientData = values.customClientData;\n        }\n\n        if (this._model.isModified() && options.force === false) {\n          callBackPromise = this._model._promiseCallback();\n          this._model.trigger(\"loadDocument\", this._getModelValue(), {\n            success: callBackPromise.success,\n            error: callBackPromise.error\n          });\n          documentPromise = callBackPromise.promise;\n        } else {\n          documentPromise = this._model.fetchDocument(this._getModelValue());\n        }\n      }\n      return this._registerOutputPromise(documentPromise, options);\n    },\n\n    /**\n     * Save the current document\n     * Reload the interface in the same mode\n     * @param options object {\"success\": fct, \"error\", fct, \"customClientData\" : mixed}\n     *\n     */\n    saveDocument: function documentControllerSave(options) {\n      var documentPromise;\n      options = options || {};\n      this._checkInitialisedModel();\n      if (options.customClientData) {\n        this._model._customClientData = options.customClientData;\n      }\n      documentPromise = this._model.saveDocument();\n      return this._registerOutputPromise(documentPromise, options);\n    },\n\n    /**\n     * Change the workflow state of the document\n     *\n     * @param parameters\n     * @param reinitOptions\n     * @param options\n     */\n    changeStateDocument: function documentController_changeStateDocument(\n      parameters,\n      reinitOptions,\n      options\n    ) {\n      var documentPromise;\n      this._checkInitialisedModel();\n      if (!_.isObject(parameters)) {\n        throw new Error(\n          'changeStateDocument first argument must be an object {\"nextState\":, \"transition\": , \"values\":, \"unattended\":, \"\" }'\n        );\n      }\n      if (\n        !_.isString(parameters.nextState) ||\n        !_.isString(parameters.transition)\n      ) {\n        throw new Error(\"nextState and transition arguments are mandatory\");\n      }\n      documentPromise = this._initAndDisplayTransition(\n        parameters.nextState,\n        parameters.transition,\n        parameters.values || null,\n        parameters.unattended || false,\n        reinitOptions\n      );\n      return this._registerOutputPromise(documentPromise, options);\n    },\n\n    /**\n     * Delete the current document\n     * Reload the interface in the same mode\n     * @param options object {\"success\": fct, \"error\", fct, \"customClientData\" : mixed}\n     */\n    deleteDocument: function documentControllerDelete(options) {\n      var documentPromise;\n      options = options || {};\n      this._checkInitialisedModel();\n      if (options.customClientData) {\n        this._model._customClientData = options.customClientData;\n      }\n      documentPromise = this._model.deleteDocument();\n      return this._registerOutputPromise(documentPromise, options);\n    },\n\n    /**\n     * Restore the current document\n     * Reload the interface in the same mode\n     * @param options object {\"success\": fct, \"error\", fct, \"customClientData\" : mixed}\n     */\n    restoreDocument: function documentControllerRestore(options) {\n      var documentPromise;\n      options = options || {};\n      this._checkInitialisedModel();\n      if (options.customClientData) {\n        this._model._customClientData = options.customClientData;\n      }\n      documentPromise = this._model.restoreDocument();\n      return this._registerOutputPromise(documentPromise, options);\n    },\n\n    /**\n     * Get a property value\n     *\n     * @param property\n     * @returns {*}\n     */\n    getProperty: function documentControllerGetDocumentProperty(property) {\n      this._checkInitialisedModel();\n      if (property === \"isModified\") {\n        return this._model.isModified();\n      }\n      return this._model.getServerProperties()[property];\n    },\n\n    /**\n     * Get all the properties\n     * @returns {*}\n     */\n    getProperties: function documentControllerGetDocumentProperties() {\n      var properties,\n        ready = true;\n      try {\n        this._checkInitialisedModel();\n      } catch (e) {\n        ready = false;\n        properties = {\n          notLoaded: true\n        };\n      }\n      if (ready) {\n        properties = this._model.getServerProperties();\n        properties.isModified = this._model.isModified();\n        properties.url = window.location.href;\n      }\n\n      return properties;\n    },\n\n    /**\n     * Check if an attribute exist\n     *\n     * @param attributeId\n     * @return {boolean}\n     */\n    hasAttribute: function documentController_hasAttribute(attributeId) {\n      this._checkInitialisedModel();\n      var attribute = this._model.get(\"attributes\").get(attributeId);\n      return !!attribute;\n    },\n\n    /**\n     * Get the attribute interface object\n     * Return null if attribute not found\n     * @param attributeId\n     * @returns AttributeInterface|null\n     */\n    getAttribute: function documentControllerGetAttribute(attributeId) {\n      this._checkInitialisedModel();\n      var attributeModel = this._getAttributeModel(attributeId);\n      if (!attributeModel) {\n        return null;\n      }\n      return new AttributeInterface(this._getAttributeModel(attributeId));\n    },\n\n    /**\n     * Get all the attributes of the current document\n     *\n     * @returns [AttributeInterface]\n     */\n    getAttributes: function documentControllerGetAttributes() {\n      this._checkInitialisedModel();\n      return this._model\n        .get(\"attributes\")\n        .map(function documentController_mapAttribute(currentAttribute) {\n          return new AttributeInterface(currentAttribute);\n        });\n    },\n\n    /**\n     * Check if a menu exist\n     *\n     * @param menuId\n     * @return {boolean}\n     */\n    hasMenu: function documentController_hasMenu(menuId) {\n      this._checkInitialisedModel();\n      var menu = this._getMenuModel(menuId);\n      return !!menu;\n    },\n\n    /**\n     * Get the menu interface object\n     *\n     * @param menuId\n     * @returns MenuInterface\n     */\n    getMenu: function documentControllerGetMenu(menuId) {\n      this._checkInitialisedModel();\n      var menu = this._getMenuModel(menuId);\n      if (!menu) {\n        return null;\n      }\n      return new MenuInterface(menu);\n    },\n\n    /**\n     * Get all the menu of the current document\n     *\n     * @returns [MenuInterface]\n     */\n    getMenus: function documentControllerGetMenus() {\n      this._checkInitialisedModel();\n      return this._model\n        .get(\"menus\")\n        .map(function documentController_mapMenu(currentMenu) {\n          return new MenuInterface(currentMenu);\n        });\n    },\n\n    /**\n     * Select a tab\n     *\n     * @param tabId\n     * @returns void\n     */\n    selectTab: function documentControllerSelectTab(tabId) {\n      this._checkInitialisedModel();\n      var attributeModel = this._getAttributeModel(tabId);\n      if (!attributeModel) {\n        throw new Error('The attribute \"' + tabId + '\" cannot be found.');\n      }\n      if (attributeModel.get(\"type\") !== \"tab\") {\n        throw new Error('The attribute \"' + tabId + '\" is not a tab.');\n      }\n\n      this._model.trigger(\"doSelectTab\", tabId);\n    },\n\n    /**\n     * Draw tab content\n     *\n     * @param tabId\n     * @returns void\n     */\n    drawTab: function documentControllerDrawTab(tabId) {\n      this._checkInitialisedModel();\n      var attributeModel = this._getAttributeModel(tabId);\n      if (!attributeModel) {\n        throw new Error('The attribute \"' + tabId + '\" cannot be found.');\n      }\n      if (attributeModel.get(\"type\") !== \"tab\") {\n        throw new Error('The attribute \"' + tabId + '\" is not a tab.');\n      }\n\n      this._model.trigger(\"doDrawTab\", tabId);\n    },\n\n    /**\n     * Get an attribute value\n     *\n     * @param attributeId\n     * @param type string (current|previous|initial|all) what kind of value (default : current)\n     * @returns {*}\n     */\n    getValue: function documentControllerGetValue(attributeId, type) {\n      var attribute;\n      this._checkInitialisedModel();\n      var attributeModel = this._getAttributeModel(attributeId);\n      if (!attributeModel) {\n        return null;\n      }\n      attribute = new AttributeInterface(attributeModel);\n      return _.clone(attribute.getValue(type));\n    },\n\n    /**\n     * Get all the values\n     *\n     * @returns {*|{}}\n     */\n    getValues: function documentControllerGetValues() {\n      this._checkInitialisedModel();\n      return this._model.getValues();\n    },\n\n    /**\n     * Get customData from render view model\n     * @returns {*}\n     */\n    getCustomServerData: function documentControllerGetServerCustomData() {\n      this._checkInitialisedModel();\n      return this._model.get(\"customServerData\");\n    },\n    /**\n     * Add customData from render view model\n     * @returns {*}\n     */\n    addCustomClientData: function documentControllerAddCustomClientData(\n      documentCheck,\n      value\n    ) {\n      var currentWidget = this;\n      this._checkInitialisedModel();\n      //First case no data, so documentCheck is data\n      if (_.isUndefined(value)) {\n        value = documentCheck;\n        documentCheck = {};\n      }\n      //Second case documentCheck is a function and data is object\n      if (_.isFunction(documentCheck) && _.isObject(value)) {\n        documentCheck = { documentCheck: documentCheck };\n      }\n      //Third case documentCheck is an object and data is object => check if documentCheck property exist\n      if (_.isObject(value) && _.isObject(documentCheck)) {\n        documentCheck = _.defaults(documentCheck, {\n          documentCheck: function clientCustomOK() {\n            return true;\n          },\n          once: true\n        });\n      } else {\n        throw new Error(\n          \"Constraint must be an value or a function and a value\"\n        );\n      }\n      //Register the customClientData\n      _.each(value, function documentControllerAddCustomClientDataEach(\n        currentValue,\n        currentKey\n      ) {\n        currentWidget._customClientData[currentKey] = {\n          value: currentValue,\n          documentCheck: documentCheck.documentCheck,\n          once: documentCheck.once\n        };\n      });\n    },\n    /**\n     * Get customData from render view model\n     * @returns {*}\n     */\n    setCustomClientData: function documentControllerSetCustomClientData(\n      documentCheck,\n      value\n    ) {\n      console.error(\"this function (setCustomClientData) is deprecated\");\n      return this.addCustomClientData(documentCheck, value);\n    },\n    /**\n     * Get customData from render view model\n     * @returns {*}\n     */\n    getCustomClientData: function documentControllerSetCustomClientData(\n      deleteOnce\n    ) {\n      var values = {},\n        currentWidget = this,\n        $element,\n        properties,\n        newCustomData = {};\n      this._checkInitialisedModel();\n      properties = this.getProperties();\n      $element = $(currentWidget.element);\n      _.each(currentWidget._customClientData, function analyzeCustomClient(\n        currentCustom,\n        key\n      ) {\n        if (currentCustom.documentCheck.call($element, properties)) {\n          values[key] = currentCustom.value;\n          if (deleteOnce === true && !currentCustom.once) {\n            newCustomData[key] = currentCustom;\n          }\n        } else {\n          if (deleteOnce === true) {\n            newCustomData[key] = currentCustom;\n          }\n        }\n      });\n      if (deleteOnce === true) {\n        currentWidget._customClientData = newCustomData;\n      }\n      return values;\n    },\n\n    /**\n     * Delete a custom data\n     * @returns {*}\n     */\n    removeCustomClientData: function documentControllerRemoveCustomClientData(\n      key\n    ) {\n      if (this._customClientData[key]) {\n        delete this._customClientData[key];\n      }\n      return this;\n    },\n    /**\n     * Set a value\n     * Trigger a change event\n     *\n     * @param attributeId string attribute identifier\n     * @param value object { \"value\" : *, \"displayValue\" : *}\n     * @returns {*}\n     */\n    setValue: function documentControllerSetValue(attributeId, value) {\n      this._checkInitialisedModel();\n      var attributeModel = this._getAttributeModel(attributeId);\n      if (!attributeModel) {\n        throw new Error(\"Unable to find attribute \" + attributeId);\n      }\n      var attributeInterface = new AttributeInterface(attributeModel);\n      var index;\n      var currentValueLength;\n      var i;\n\n      if (attributeModel.getParent().get(\"type\") === \"array\") {\n        attributeInterface.setValue(value, true); // Just verify value conditions\n        if (!_.isArray(value)) {\n          index = value.index;\n        } else {\n          index = value.length - 1;\n        }\n        currentValueLength = attributeInterface.getValue().length;\n        attributeInterface.setValue(value);\n\n        // Pad values of complete array with default values\n        var arrayModel = attributeModel.getParent();\n        var modifiedColumns = {};\n        arrayModel.get(\"content\").each(function(aModel) {\n          var aValue = _.clone(aModel.get(\"attributeValue\"));\n          var defaultValue = aModel.get(\"defaultValue\");\n\n          if (!defaultValue) {\n            defaultValue = aModel.hasMultipleOption()\n              ? []\n              : { value: null, displayValue: \"\" };\n          }\n\n          for (i = currentValueLength; i <= index; i++) {\n            if (_.isUndefined(aValue[i])) {\n              aValue[i] = defaultValue;\n              modifiedColumns[aModel.id] = { model: aModel, values: aValue };\n            }\n          }\n        });\n\n        _.each(modifiedColumns, function documentControllerPadValues(modData) {\n          _.defer(function documentControllerPadValue() {\n            modData.model.set(\"attributeValue\", modData.values);\n          });\n        });\n\n        return;\n      }\n      return attributeInterface.setValue(value);\n    },\n\n    /**\n     * Add a row to an array\n     *\n     * @param attributeId string attribute array\n     * @param values object { \"attributeId\" : { \"value\" : *, \"displayValue\" : * }, ...}\n     */\n    appendArrayRow: function documentControllerAddArrayRow(\n      attributeId,\n      values\n    ) {\n      this._checkInitialisedModel();\n      var attribute = this._getAttributeModel(attributeId);\n\n      if (!attribute) {\n        throw new Error(\"Unable to find attribute \" + attributeId);\n      }\n\n      if (attribute.get(\"type\") !== \"array\") {\n        throw new Error(\n          \"Attribute \" + attributeId + \" must be an attribute of type array\"\n        );\n      }\n      if (!_.isObject(values)) {\n        throw new Error(\n          \"Values must be an object where each properties is an attribute of the array for \" +\n            attributeId\n        );\n      }\n      attribute\n        .get(\"content\")\n        .each(function documentController_addACell(currentAttribute) {\n          var newValue = values[currentAttribute.id];\n          var currentValue = currentAttribute.getValue();\n          if (_.isUndefined(newValue)) {\n            // Set default value if no value defined\n            currentAttribute.createIndexedValue(\n              currentValue.length,\n              false,\n              _.isEmpty(values)\n            );\n          } else {\n            newValue = _.defaults(newValue, {\n              value: \"\",\n              displayValue: newValue.value\n            });\n            currentAttribute.addValue(newValue);\n          }\n        });\n    },\n\n    /**\n     * Add a row before another row\n     *\n     * @param attributeId string attribute array\n     * @param values object { \"attributeId\" : { \"value\" : *, \"displayValue\" : * }, ...}\n     * @param index int index of the row\n     */\n    insertBeforeArrayRow: function documentControllerInsertBeforeArrayRow(\n      attributeId,\n      values,\n      index\n    ) {\n      this._checkInitialisedModel();\n      var attribute = this._getAttributeModel(attributeId),\n        maxValue;\n      if (!attribute) {\n        throw new Error(\"Unable to find attribute \" + attributeId);\n      }\n      if (attribute.get(\"type\") !== \"array\") {\n        throw new Error(\n          \"Attribute \" + attributeId + \" must be an attribute of type array\"\n        );\n      }\n      if (!_.isObject(values)) {\n        throw new Error(\n          \"Values must be an object where each properties is an attribute of the array for \" +\n            attributeId\n        );\n      }\n      maxValue = this._getMaxIndex(attribute);\n      if (index < 0 || index > maxValue) {\n        throw new Error(\"Index must be between 0 and \" + maxValue);\n      }\n      attribute\n        .get(\"content\")\n        .each(function documentController_addACell(currentAttribute) {\n          var currentValue = values[currentAttribute.id];\n          if (!_.isUndefined(currentValue)) {\n            currentValue = _.defaults(currentValue, {\n              value: \"\",\n              displayValue: currentValue.value\n            });\n          } else {\n            currentValue = currentAttribute.attributes.defaultValue;\n            if (!currentValue) {\n              currentValue = { value: \"\", displayValue: \"\" };\n            }\n          }\n          currentAttribute.addIndexedValue(currentValue, index);\n        });\n    },\n\n    /**\n     * Remove an array row\n     * @param attributeId string attribute array\n     * @param index int index of the row\n     */\n    removeArrayRow: function documentControllerRemoveArrayRow(\n      attributeId,\n      index\n    ) {\n      this._checkInitialisedModel();\n      var attribute = this._getAttributeModel(attributeId),\n        maxIndex;\n      if (!attribute) {\n        throw new Error(\"Unable to find attribute \" + attributeId);\n      }\n      if (attribute.get(\"type\") !== \"array\") {\n        throw Error(\n          \"Attribute \" + attributeId + \" must be an attribute of type array\"\n        );\n      }\n      maxIndex = this._getMaxIndex(attribute) - 1;\n      if (index < 0 || index > maxIndex) {\n        throw Error(\n          \"Index must be between 0 and \" + maxIndex + \" for \" + attributeId\n        );\n      }\n      attribute\n        .get(\"content\")\n        .each(function documentController_removeACell(currentAttribute) {\n          currentAttribute.removeIndexValue(index);\n        });\n      attribute.removeIndexedLine(index);\n    },\n\n    /**\n     * Add a constraint to the widget\n     *\n     * @param options object { \"name\" : string, \"documentCheck\": function}\n     * @param callback function callback called when the event is triggered\n     * @returns {*}\n     */\n    addConstraint: function documentControlleraddConstraint(options, callback) {\n      var currentConstraint,\n        currentWidget = this,\n        uniqueName;\n      if (_.isUndefined(callback) && _.isFunction(options)) {\n        callback = options;\n        options = {};\n      }\n      if (_.isObject(options) && _.isUndefined(callback)) {\n        if (!options.name) {\n          throw new Error(\n            \"When a constraint is initiated with a single object, this object needs to have the name property \".JSON.stringify(\n              options\n            )\n          );\n        }\n      } else {\n        _.defaults(options, {\n          documentCheck: function documentController_defaultDocumentCheck() {\n            return true;\n          },\n          attributeCheck: function documentController_defaultAttributeCheck() {\n            return true;\n          },\n          constraintCheck: callback,\n          name: _.uniqueId(\"constraint\"),\n          externalConstraint: false,\n          once: false\n        });\n      }\n      currentConstraint = options;\n      if (!_.isFunction(currentConstraint.constraintCheck)) {\n        throw new Error(\"An event need a callback\");\n      }\n      //If constraint is once : wrap it an callback that execute callback and delete it\n      if (currentConstraint.once === true) {\n        currentConstraint.eventCallback = _.wrap(\n          currentConstraint.constraintCheck,\n          function documentController_onceWrapper(callback) {\n            try {\n              callback.apply(this, _.rest(arguments));\n            } catch (e) {\n              console.error(e);\n            }\n            currentWidget.removeConstraint(\n              currentConstraint.name,\n              currentConstraint.externalConstraint\n            );\n          }\n        );\n      }\n      uniqueName =\n        (currentConstraint.externalConstraint ? \"external_\" : \"internal_\") +\n        currentConstraint.name;\n      this.options.constraintList[uniqueName] = currentConstraint;\n      this._initActivatedConstraint();\n      return currentConstraint.name;\n    },\n\n    /**\n     * List the constraint of the widget\n     *\n     * @returns {*}\n     */\n    listConstraints: function documentControllerListConstraint() {\n      return this.options.constraintList;\n    },\n\n    /**\n     * Remove a constraint of the widget\n     *\n     * @param constraintName\n     * @param allKind\n     * @returns {*}\n     */\n    removeConstraint: function documentControllerRemoveConstraint(\n      constraintName,\n      allKind\n    ) {\n      var removed = [],\n        newConstraintList,\n        constraintList,\n        testRegExp = new RegExp(\"\\\\\" + constraintName + \"$\");\n      // jscs:disable disallowImplicitTypeConversion\n      allKind = !!allKind;\n      // jscs:enable disallowImplicitTypeConversion\n      newConstraintList = _.filter(\n        this.options.constraintList,\n        function documentController_removeConstraint(currentConstrait) {\n          if (\n            (allKind || !currentConstrait.externalConstraint) &&\n            (currentConstrait.name === constraintName ||\n              testRegExp.test(currentConstrait.name))\n          ) {\n            removed.push(currentConstrait);\n            return false;\n          }\n          return true;\n        }\n      );\n      constraintList = {};\n      _.each(\n        newConstraintList,\n        function documentController_rebuildConstraintList(currentConstraint) {\n          var uniqueName =\n            (currentConstraint.externalConstraint ? \"external_\" : \"internal_\") +\n            currentConstraint.name;\n          constraintList[uniqueName] = currentConstraint;\n        }\n      );\n      this.options.constraintList = constraintList;\n      this._initActivatedConstraint();\n      return removed;\n    },\n\n    /**\n     * Add an event to the widget\n     *\n     * @param eventType string kind of event\n     * @param options object { \"name\" : string, \"documentCheck\": function}\n     * @param callback function callback called when the event is triggered\n     * @returns {*|Window.options.name}\n     */\n    addEventListener: function documentControllerAddEvent(\n      eventType,\n      options,\n      callback\n    ) {\n      var currentEvent,\n        currentWidget = this;\n      //options is not mandatory and the callback can be the second parameters\n      if (_.isUndefined(callback) && _.isFunction(options)) {\n        callback = options;\n        options = {};\n      }\n      // the first parameters can be the final object (chain removeEvent and addEvent)\n      if (\n        _.isObject(eventType) &&\n        _.isUndefined(options) &&\n        _.isUndefined(callback)\n      ) {\n        currentEvent = eventType;\n        if (!currentEvent.name) {\n          throw new Error(\n            \"When an event is initiated with a single object, this object needs to have the name property \" +\n              JSON.stringify(currentEvent)\n          );\n        }\n      } else {\n        currentEvent = _.defaults(options, {\n          name: _.uniqueId(\"event_\" + eventType),\n          eventType: eventType,\n          eventCallback: callback,\n          externalEvent: false,\n          once: false\n        });\n      }\n      // the eventType must be one the list\n      this._checkEventName(currentEvent.eventType);\n      // callback is mandatory and must be a function\n      if (!_.isFunction(currentEvent.eventCallback)) {\n        throw new Error(\"An event needs a callback that is a function\");\n      }\n      //If event is once : wrap it an callback that execute event and delete it\n      if (currentEvent.once === true) {\n        currentEvent.eventCallback = _.wrap(\n          currentEvent.eventCallback,\n          function documentController_onceWrapper(callback) {\n            currentWidget.removeEventListener(\n              currentEvent.name,\n              currentEvent.externalEvent\n            );\n            try {\n              callback.apply(this, _.rest(arguments));\n            } catch (e) {\n              console.error(e);\n            }\n          }\n        );\n      }\n      this._addAndInitNewEvents(currentEvent);\n      // return the name of the event\n      return currentEvent.name;\n    },\n\n    /**\n     * List of the events of the current widget\n     *\n     * @returns {*}\n     */\n    listEventListeners: function documentControllerListEvents() {\n      return this.options.eventListener;\n    },\n\n    /**\n     * Remove an event of the current widget\n     *\n     * @param eventName string can be an event name or a namespace\n     * @param allKind remove internal/external events\n     * @returns {*}\n     */\n    removeEventListener: function documentControllerRemoveEvent(\n      eventName,\n      allKind\n    ) {\n      var removed = [],\n        testRegExp = new RegExp(\"\\\\\" + eventName + \"$\"),\n        newList,\n        eventList;\n      // jscs:disable\n      allKind = !!allKind;\n      // jscs:enable\n      newList = _.filter(\n        this.options.eventListener,\n        function documentController_removeCurrentEvent(currentEvent) {\n          if (\n            (allKind || !currentEvent.externalEvent) &&\n            (currentEvent.name === eventName ||\n              testRegExp.test(currentEvent.name))\n          ) {\n            removed.push(currentEvent);\n            return false;\n          }\n          return true;\n        }\n      );\n      eventList = {};\n      _.each(newList, function documentController__rebuildEventList(\n        currentEvent\n      ) {\n        var uniqueName =\n          (currentEvent.externalEvent ? \"external_\" : \"internal_\") +\n          currentEvent.name;\n        eventList[uniqueName] = currentEvent;\n      });\n      this.options.eventListener = eventList;\n      this._initActivatedEventListeners({ launchReady: false });\n      return removed;\n    },\n\n    /**\n     * Trigger an event\n     *\n     * @param eventName\n     */\n    triggerEvent: function documentController_triggerEvent(eventName) {\n      var args = _.toArray(arguments);\n      this._checkInitialisedModel();\n      this._checkEventName(eventName);\n\n      args.splice(1, 0, null); // Add null originalEvent\n      return this._triggerControllerEvent.apply(this, args);\n    },\n\n    /**\n     * Hide a visible attribute\n     *\n     * @param attributeId\n     */\n    hideAttribute: function documentControllerHideAttribute(attributeId) {\n      this._checkInitialisedView();\n      var attributeModel = this._getAttributeModel(attributeId);\n      if (!attributeModel) {\n        console.error(\"Unable find and hide the attribute \" + attributeId);\n        return;\n      }\n      attributeModel.trigger(\"hide\");\n    },\n    /**\n     * show a visible attribute (previously hidden)\n     *\n     * @param attributeId\n     */\n    showAttribute: function documentControllerShowAttribute(attributeId) {\n      this._checkInitialisedView();\n      var attributeModel = this._getAttributeModel(attributeId);\n      if (!attributeModel) {\n        console.error(\"Unable find and show the attribute \" + attributeId);\n        return;\n      }\n      attributeModel.trigger(\"show\");\n    },\n\n    /**\n     * Display a message to the user\n     *\n     * @param message\n     */\n    showMessage: function documentControllerShowMessage(message) {\n      this._checkInitialisedView();\n      if (_.isString(message)) {\n        message = {\n          type: \"info\",\n          message: message\n        };\n      }\n      if (_.isObject(message)) {\n        message = _.defaults(message, {\n          type: \"info\"\n        });\n      }\n      this.$notification.dcpNotification(\"show\", message.type, message);\n    },\n\n    /**\n     * Display loading bar\n     *\n     * @param message\n     * @param px\n     */\n    maskDocument: function documentController(message, px) {\n      this.$loading.dcpLoading(\"show\");\n      if (message) {\n        this.$loading.dcpLoading(\"setTitle\", message);\n      }\n      if (px) {\n        this.$loading.dcpLoading(\"setPercent\", px);\n      }\n    },\n\n    /**\n     * Hide loading bar\n     */\n    unmaskDocument: function documentController_unmaskDocument(force) {\n      this.$loading.dcpLoading(\"hide\", force);\n    },\n\n    /**\n     * Add an error message to an attribute\n     *\n     * @param attributeId\n     * @param message\n     * @param index\n     */\n    setAttributeErrorMessage: function documentControllersetAttributeErrorMessage(\n      attributeId,\n      message,\n      index\n    ) {\n      this._checkInitialisedView();\n      var attributeModel = this._getAttributeModel(attributeId);\n      if (!attributeModel) {\n        console.error(\"Unable find and show the attribute \" + attributeId);\n        return;\n      }\n      attributeModel.setErrorMessage(message, index);\n    },\n\n    /**\n     * Clean the error message of an attribute\n     *\n     * @param attributeId\n     * @param index\n     */\n    cleanAttributeErrorMessage: function documentControllercleanAttributeErrorMessage(\n      attributeId,\n      index\n    ) {\n      this._checkInitialisedView();\n      var attributeModel = this._getAttributeModel(attributeId);\n      if (!attributeModel) {\n        console.error(\"Unable find and show the attribute \" + attributeId);\n        return;\n      }\n      attributeModel.setErrorMessage(null, index);\n    },\n\n    injectCSS: function documentController_injectCSS(cssToInject) {\n      this._checkInitialisedView();\n      if (!_.isArray(cssToInject) && !_.isString(cssToInject)) {\n        throw new Error(\n          \"The css to inject must be an array string or a string\"\n        );\n      }\n      if (_.isString(cssToInject)) {\n        cssToInject = [cssToInject];\n      }\n\n      this._model.injectCSS(cssToInject);\n    },\n\n    injectJS: function documentController_injectCSS(jsToInject) {\n      this._checkInitialisedView();\n      if (!_.isArray(jsToInject) && !_.isString(jsToInject)) {\n        throw new Error(\"The js to inject must be an array string or a string\");\n      }\n      if (_.isString(jsToInject)) {\n        jsToInject = [jsToInject];\n      }\n\n      return this._model.injectJS(jsToInject);\n    },\n    /**\n     * tryToDestroy the widget\n     *\n     * @return Promise\n     */\n    tryToDestroy: function documentController_tryToDestroy() {\n      var currentWidget = this;\n      return new Promise(function documentController_promiseDestroy(\n        resolve,\n        reject\n      ) {\n        var event = { prevent: false };\n        if (!currentWidget._model) {\n          resolve();\n          return;\n        }\n        if (\n          currentWidget._model &&\n          currentWidget._model.isModified() &&\n          !window.confirm(\n            currentWidget._model.get(\"properties\").get(\"title\") +\n              \"\\n\" +\n              i18n.___(\n                \"The form has been modified without saving, do you want to close it ?\",\n                \"ddui\"\n              )\n          )\n        ) {\n          reject(\"Unable to destroy because user refuses it\");\n          return;\n        }\n        event.prevent = !currentWidget._triggerControllerEvent(\n          \"beforeClose\",\n          null,\n          currentWidget._model.getServerProperties()\n        );\n        if (event.prevent) {\n          reject(\"Unable to destroy because before close refuses it\");\n          return;\n        }\n        resolve();\n      });\n    }\n  });\n\n  return $.fn.documentController;\n}).apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNjNlMjg1MDg4ODkzZDAzOTBhYjYuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvQXBwcy9ET0NVTUVOVC9JSE0vd2lkZ2V0cy9kb2N1bWVudENvbnRyb2xsZXIvZG9jdW1lbnRDb250cm9sbGVyLmpzP2I1MzciXSwic291cmNlc0NvbnRlbnQiOlsiLyogZ2xvYmFsIGRlZmluZSwgY29uc29sZSAqL1xuZGVmaW5lKFtcbiAgXCJqcXVlcnlcIixcbiAgXCJ1bmRlcnNjb3JlXCIsXG4gIFwiYmFja2JvbmVcIixcbiAgXCJkY3BEb2N1bWVudC9yb3V0ZXJzL3JvdXRlclwiLFxuICBcImRjcERvY3VtZW50L21vZGVscy9tRG9jdW1lbnRcIixcbiAgXCJkY3BEb2N1bWVudC9jb250cm9sbGVyT2JqZWN0cy9hdHRyaWJ1dGVJbnRlcmZhY2VcIixcbiAgXCJkY3BEb2N1bWVudC9jb250cm9sbGVyT2JqZWN0cy9tZW51SW50ZXJmYWNlXCIsXG4gIFwiZGNwRG9jdW1lbnQvY29udHJvbGxlck9iamVjdHMvdHJhbnNpdGlvbkludGVyZmFjZVwiLFxuICBcImRjcERvY3VtZW50L3ZpZXdzL2RvY3VtZW50L3ZEb2N1bWVudFwiLFxuICBcImRjcERvY3VtZW50L21vZGVscy9tVHJhbnNpdGlvblwiLFxuICBcImRjcERvY3VtZW50L3ZpZXdzL3dvcmtmbG93L3ZUcmFuc2l0aW9uXCIsXG4gIFwiZGNwRG9jdW1lbnQvbW9kZWxzL21NZW51XCIsXG4gIFwiZGNwRG9jdW1lbnQvaTE4bi9kb2N1bWVudENhdGFsb2dcIixcbiAgXCJkY3BEb2N1bWVudC93aWRnZXRzL3dpZGdldFwiLFxuICBcImRjcERvY3VtZW50L3dpZGdldHMvd2luZG93L3dDb25maXJtXCIsXG4gIFwiZGNwRG9jdW1lbnQvd2lkZ2V0cy93aW5kb3cvd0xvYWRpbmdcIixcbiAgXCJkY3BEb2N1bWVudC93aWRnZXRzL3dpbmRvdy93Tm90aWZpY2F0aW9uXCJcbl0sIGZ1bmN0aW9uIGRvY3VtZW50Q29udHJvbGxlcihcbiAgJCxcbiAgXyxcbiAgQmFja2JvbmUsXG4gIFJvdXRlcixcbiAgRG9jdW1lbnRNb2RlbCxcbiAgQXR0cmlidXRlSW50ZXJmYWNlLFxuICBNZW51SW50ZXJmYWNlLFxuICBUcmFuc2l0aW9uSW50ZXJmYWNlLFxuICBEb2N1bWVudFZpZXcsXG4gIFRyYW5zaXRpb25Nb2RlbCxcbiAgVHJhbnNpdGlvblZpZXcsXG4gIE1lbnVNb2RlbCxcbiAgaTE4blxuKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIHZhciBFcnJvck1vZGVsTm9uSW5pdGlhbGl6ZWQgPSBmdW5jdGlvbiBFcnJvck1vZGVsTm9uSW5pdGlhbGl6ZWQobWVzc2FnZSkge1xuICAgIHRoaXMubmFtZSA9IFwiRXJyb3JNb2RlbE5vbkluaXRpYWxpemVkXCI7XG4gICAgdGhpcy5tZXNzYWdlID1cbiAgICAgIG1lc3NhZ2UgfHxcbiAgICAgIFwiVGhlIHdpZGdldCBtb2RlbCBpcyBub3QgaW5pdGlhbGl6ZWQsIHVzZSBmZXRjaERvY3VtZW50IHRvIGluaXRpYWxpc2UgaXQuXCI7XG4gICAgdGhpcy5zdGFjayA9IG5ldyBFcnJvcigpLnN0YWNrO1xuICB9O1xuICBFcnJvck1vZGVsTm9uSW5pdGlhbGl6ZWQucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShFcnJvci5wcm90b3R5cGUpO1xuICBFcnJvck1vZGVsTm9uSW5pdGlhbGl6ZWQucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gRXJyb3JNb2RlbE5vbkluaXRpYWxpemVkO1xuXG4gIHZhciBldmVudExpc3QgPSBbXG4gICAgXCJiZWZvcmVSZW5kZXJcIixcbiAgICBcInJlYWR5XCIsXG4gICAgXCJjaGFuZ2VcIixcbiAgICBcImRpc3BsYXlNZXNzYWdlXCIsXG4gICAgXCJkaXNwbGF5RXJyb3JcIixcbiAgICBcInZhbGlkYXRlXCIsXG4gICAgXCJhdHRyaWJ1dGVCZWZvcmVSZW5kZXJcIixcbiAgICBcImF0dHJpYnV0ZVJlYWR5XCIsXG4gICAgXCJhdHRyaWJ1dGVIZWxwZXJTZWFyY2hcIixcbiAgICBcImF0dHJpYnV0ZUhlbHBlclJlc3BvbnNlXCIsXG4gICAgXCJhdHRyaWJ1dGVIZWxwZXJTZWxlY3RcIixcbiAgICBcImF0dHJpYnV0ZUFycmF5Q2hhbmdlXCIsXG4gICAgXCJhY3Rpb25DbGlja1wiLFxuICAgIFwiYXR0cmlidXRlQW5jaG9yQ2xpY2tcIixcbiAgICBcImJlZm9yZUNsb3NlXCIsXG4gICAgXCJjbG9zZVwiLFxuICAgIFwiYmVmb3JlU2F2ZVwiLFxuICAgIFwiYWZ0ZXJTYXZlXCIsXG4gICAgXCJhdHRyaWJ1dGVEb3dubG9hZEZpbGVcIixcbiAgICBcImF0dHJpYnV0ZVVwbG9hZEZpbGVcIixcbiAgICBcImF0dHJpYnV0ZVVwbG9hZEZpbGVEb25lXCIsXG4gICAgXCJiZWZvcmVEZWxldGVcIixcbiAgICBcImFmdGVyRGVsZXRlXCIsXG4gICAgXCJiZWZvcmVSZXN0b3JlXCIsXG4gICAgXCJhZnRlclJlc3RvcmVcIixcbiAgICBcImZhaWxUcmFuc2l0aW9uXCIsXG4gICAgXCJzdWNjZXNzVHJhbnNpdGlvblwiLFxuICAgIFwiYXR0cmlidXRlQmVmb3JlVGFiU2VsZWN0XCIsXG4gICAgXCJhdHRyaWJ1dGVBZnRlclRhYlNlbGVjdFwiLFxuICAgIFwiYXR0cmlidXRlVGFiQ2hhbmdlXCIsXG4gICAgXCJiZWZvcmVEaXNwbGF5VHJhbnNpdGlvblwiLFxuICAgIFwiYWZ0ZXJEaXNwbGF5VHJhbnNpdGlvblwiLFxuICAgIFwiYmVmb3JlVHJhbnNpdGlvblwiLFxuICAgIFwiYmVmb3JlVHJhbnNpdGlvbkNsb3NlXCIsXG4gICAgXCJkZXN0cm95XCIsXG4gICAgXCJhdHRyaWJ1dGVDcmVhdGVEaWFsb2dEb2N1bWVudEJlZm9yZVNldEZvcm1WYWx1ZXNcIixcbiAgICBcImF0dHJpYnV0ZUNyZWF0ZURpYWxvZ0RvY3VtZW50QmVmb3JlU2V0VGFyZ2V0VmFsdWVcIixcbiAgICBcImF0dHJpYnV0ZUNyZWF0ZURpYWxvZ0RvY3VtZW50UmVhZHlcIixcbiAgICBcImF0dHJpYnV0ZUNyZWF0ZURpYWxvZ0RvY3VtZW50QmVmb3JlQ2xvc2VcIixcbiAgICBcImF0dHJpYnV0ZUNyZWF0ZURpYWxvZ0RvY3VtZW50QmVmb3JlRGVzdHJveVwiXG4gIF07XG5cbiAgJC53aWRnZXQoXCJkY3AuZG9jdW1lbnRDb250cm9sbGVyXCIsIHtcbiAgICBvcHRpb25zOiB7XG4gICAgICBldmVudFByZWZpeDogXCJkb2N1bWVudFwiLFxuICAgICAgaW5pdGlkOiBudWxsLFxuICAgICAgdmlld0lkOiB1bmRlZmluZWQsXG4gICAgICByZXZpc2lvbjogdW5kZWZpbmVkLFxuICAgICAgY29uc3RyYWludExpc3Q6IFtdLFxuICAgICAgZXZlbnRMaXN0ZW5lcjogW10sXG4gICAgICBfbW9kZWw6IG51bGwsXG4gICAgICBhY3RpdmF0ZWRDb25zdHJhaW50OiB7fSxcbiAgICAgIGFjdGl2YXRlZEV2ZW50TGlzdGVuZXI6IHt9LFxuICAgICAgX2luaXRpYWxpemVkTW9kZWw6IGZhbHNlLFxuICAgICAgX2luaXRpYWxpemVkVmlldzogZmFsc2VcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlIHdpZGdldFxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX2NyZWF0ZTogZnVuY3Rpb24gZG9jdW1lbnRDb250cm9sbGVyX2NyZWF0ZSgpIHtcbiAgICAgIHRoaXMub3B0aW9ucy5jb25zdHJhaW50TGlzdCA9IHt9O1xuICAgICAgdGhpcy5vcHRpb25zLmV2ZW50TGlzdGVuZXIgPSB7fTtcbiAgICAgIHRoaXMuYWN0aXZhdGVkQ29uc3RyYWludCA9IHt9O1xuICAgICAgdGhpcy5hY3RpdmF0ZWRFdmVudExpc3RlbmVyID0ge307XG4gICAgICB0aGlzLl9pbml0aWFsaXplZE1vZGVsID0gZmFsc2U7XG4gICAgICB0aGlzLl9pbml0aWFsaXplZFZpZXcgPSBmYWxzZTtcbiAgICAgIHRoaXMuX2N1c3RvbUNsaWVudERhdGEgPSB7fTtcbiAgICAgIGlmICghdGhpcy5vcHRpb25zLmluaXRpZCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICB0aGlzLl9pbml0aWFsaXplV2lkZ2V0KHt9LCB0aGlzLm9wdGlvbnMuY3VzdG9tQ2xpZW50RGF0YSk7XG4gICAgICB0aGlzLl9zdXBlcigpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBEZWxldGUgdGhlIHdpZGdldFxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX2Rlc3Ryb3k6IGZ1bmN0aW9uIGRvY3VtZW50Q29udHJvbGxlcl9kZXN0cm95KCkge1xuICAgICAgdGhpcy5fdHJpZ2dlckNvbnRyb2xsZXJFdmVudChcImRlc3Ryb3lcIiwgbnVsbCwgdGhpcy5nZXRQcm9wZXJ0aWVzKCkpO1xuICAgICAgdGhpcy5vcHRpb25zLmNvbnN0cmFpbnRMaXN0ID0ge307XG4gICAgICB0aGlzLm9wdGlvbnMuZXZlbnRMaXN0ZW5lciA9IHt9O1xuICAgICAgdGhpcy5hY3RpdmF0ZWRDb25zdHJhaW50ID0ge307XG4gICAgICB0aGlzLmFjdGl2YXRlZEV2ZW50TGlzdGVuZXIgPSB7fTtcbiAgICAgIHRoaXMuX2luaXRpYWxpemVkTW9kZWwgPSBmYWxzZTtcbiAgICAgIHRoaXMuX2luaXRpYWxpemVkVmlldyA9IGZhbHNlO1xuICAgICAgdGhpcy5lbGVtZW50LnJlbW92ZURhdGEoXCJkb2N1bWVudFwiKTtcbiAgICAgIGlmICh0aGlzLl9tb2RlbCkge1xuICAgICAgICB0aGlzLl9tb2RlbC50cmlnZ2VyKFwiZGVzdHJveVwiKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuX3RyaWdnZXIoXCJkZXN0cm95XCIpO1xuICAgICAgdGhpcy5fc3VwZXIoKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogSW5pdGlhbGl6ZSB0aGUgd2lkZ2V0XG4gICAgICpcbiAgICAgKiBDcmVhdGUgTW9kZWwsIGluaXRWaWV3XG4gICAgICpcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyBvYmplY3Qge1wic3VjY2Vzc1wiOiBmY3QsIFwiZXJyb3JcIiwgZmN0fVxuICAgICAqIEBwYXJhbSBjdXN0b21DbGllbnREYXRhIG9iamVjdFxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfaW5pdGlhbGl6ZVdpZGdldDogZnVuY3Rpb24gZG9jdW1lbnRDb250cm9sbGVyX2luaXRpYWxpemVXaWRnZXQoXG4gICAgICBvcHRpb25zLFxuICAgICAgY3VzdG9tQ2xpZW50RGF0YVxuICAgICkge1xuICAgICAgdmFyIHByb21pc2UsXG4gICAgICAgIGN1cnJlbnRXaWRnZXQgPSB0aGlzLFxuICAgICAgICBpbml0aWFsaXplU3VjY2VzcyA9IGZ1bmN0aW9uIGRvY3VtZW50Q29udHJvbGxlcl9pbml0aWFsaXplU3VjY2VzcygpIHtcbiAgICAgICAgICBjdXJyZW50V2lkZ2V0Ll9pbml0aWFsaXplZE1vZGVsID0gdHJ1ZTtcbiAgICAgICAgfTtcbiAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuICAgICAgdGhpcy5faW5pdEV4dGVybmFsRWxlbWVudHMoKTtcbiAgICAgIHRoaXMuX2luaXRNb2RlbCh0aGlzLl9nZXRNb2RlbFZhbHVlKCkpO1xuICAgICAgdGhpcy5faW5pdFZpZXcoKTtcbiAgICAgIGlmIChvcHRpb25zLnN1Y2Nlc3MpIHtcbiAgICAgICAgb3B0aW9ucy5zdWNjZXNzID0gXy53cmFwKFxuICAgICAgICAgIG9wdGlvbnMuc3VjY2VzcyxcbiAgICAgICAgICBmdW5jdGlvbiBkb2N1bWVudENvbnRyb2xsZXJfZmV0Y2hTdWNjZXNzKHN1Y2Nlc3MpIHtcbiAgICAgICAgICAgIGluaXRpYWxpemVTdWNjZXNzLmFwcGx5KHRoaXMsIF8ucmVzdChhcmd1bWVudHMpKTtcbiAgICAgICAgICAgIHJldHVybiBzdWNjZXNzLmFwcGx5KHRoaXMsIF8ucmVzdChhcmd1bWVudHMpKTtcbiAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICBpZiAoY3VzdG9tQ2xpZW50RGF0YSkge1xuICAgICAgICB0aGlzLl9tb2RlbC5fY3VzdG9tQ2xpZW50RGF0YSA9IGN1c3RvbUNsaWVudERhdGE7XG4gICAgICB9XG4gICAgICBwcm9taXNlID0gdGhpcy5fbW9kZWwuZmV0Y2hEb2N1bWVudCh0aGlzLl9nZXRNb2RlbFZhbHVlKCksIG9wdGlvbnMpO1xuICAgICAgaWYgKCFvcHRpb25zLnN1Y2Nlc3MpIHtcbiAgICAgICAgcHJvbWlzZS50aGVuKGluaXRpYWxpemVTdWNjZXNzKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5faW5pdFJvdXRlcih7IHVzZUhpc3Rvcnk6ICF0aGlzLm9wdGlvbnMubm9Sb3V0ZXIgfSk7XG5cbiAgICAgIHJldHVybiBwcm9taXNlO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm4gZXNzZW50aWFsIGVsZW1lbnQgb2YgdGhlIGN1cnJlbnQgZG9jdW1lbnRcbiAgICAgKlxuICAgICAqIEByZXR1cm5zIHtPYmplY3R9XG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfZ2V0TW9kZWxWYWx1ZTogZnVuY3Rpb24gZG9jdW1lbnRDb250cm9sbGVyX2dldE1vZGVsVmFsdWUoKSB7XG4gICAgICByZXR1cm4gXy5waWNrKHRoaXMub3B0aW9ucywgXCJpbml0aWRcIiwgXCJ2aWV3SWRcIiwgXCJyZXZpc2lvblwiKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogR2VuZXJhdGUgdGhlIGRvbSB3aGVyZSB0aGUgdmlldyBpcyBpbnNlcnRlZFxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX2luaXREb206IGZ1bmN0aW9uIGRvY3VtZW50Q29udHJvbGxlcl9pbml0RG9tKCkge1xuICAgICAgdmFyICRkb2N1bWVudCA9IHRoaXMuZWxlbWVudC5maW5kKFwiLmRjcERvY3VtZW50XCIpO1xuICAgICAgaWYgKCF0aGlzLiRkb2N1bWVudCB8fCAkZG9jdW1lbnQubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHRoaXMuZWxlbWVudC5hcHBlbmQoJzxkaXYgY2xhc3M9XCJkY3BEb2N1bWVudFwiPjwvZGl2PicpO1xuICAgICAgICB0aGlzLiRkb2N1bWVudCA9IHRoaXMuZWxlbWVudC5maW5kKFwiLmRjcERvY3VtZW50XCIpO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBJbml0IHRoZSBtb2RlbCBhbmQgYmluZCB0aGUgZXZlbnRzXG4gICAgICpcbiAgICAgKiBAcGFyYW0gaW5pdGlhbFZhbHVlXG4gICAgICogQHJldHVybnMgRG9jdW1lbnRNb2RlbFxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX2luaXRNb2RlbDogZnVuY3Rpb24gZG9jdW1lbnRDb250cm9sbGVyX2luaXRNb2RlbChpbml0aWFsVmFsdWUpIHtcbiAgICAgIHZhciBtb2RlbDtcblxuICAgICAgLy9Eb24ndCByZWluaXQgdGhlIG1vZGVsXG4gICAgICBpZiAoIXRoaXMuX21vZGVsKSB7XG4gICAgICAgIG1vZGVsID0gbmV3IERvY3VtZW50TW9kZWwoaW5pdGlhbFZhbHVlKTtcbiAgICAgICAgdGhpcy5fbW9kZWwgPSBtb2RlbDtcbiAgICAgICAgdGhpcy5faW5pdE1vZGVsRXZlbnRzKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLl9yZWluaXRNb2RlbCgpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIG1vZGVsO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBJbml0IHRoZSB2aWV3IGFuZCBiaW5kIHRoZSBldmVudHNcbiAgICAgKlxuICAgICAqIEByZXR1cm5zIERvY3VtZW50Vmlld1xuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX2luaXRWaWV3OiBmdW5jdGlvbiBkb2N1bWVudENvbnRyb2xsZXJfaW5pdFZpZXcoKSB7XG4gICAgICB2YXIgZG9jdW1lbnRWaWV3O1xuICAgICAgLy8vRG9uJ3QgcmVpbml0IHZpZXdcbiAgICAgIGlmICghdGhpcy52aWV3KSB7XG4gICAgICAgIHRoaXMuX2luaXREb20oKTtcbiAgICAgICAgZG9jdW1lbnRWaWV3ID0gbmV3IERvY3VtZW50Vmlldyh7XG4gICAgICAgICAgbW9kZWw6IHRoaXMuX21vZGVsLFxuICAgICAgICAgIGVsOiB0aGlzLiRkb2N1bWVudFswXVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy52aWV3ID0gZG9jdW1lbnRWaWV3O1xuICAgICAgICB0aGlzLl9pbml0Vmlld0V2ZW50cygpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRoaXMudmlldztcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQ2xlYXIgYW5kIHJlaW5pdCB0aGUgbW9kZWwgd2l0aCBjdXJyZW50IHdpZGdldCB2YWx1ZXNcbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX3JlaW5pdE1vZGVsOiBmdW5jdGlvbiBkb2N1bWVudENvbnRyb2xsZXJfcmVpbml0TW9kZWwoKSB7XG4gICAgICB0aGlzLl9tb2RlbC5zZXQodGhpcy5fZ2V0TW9kZWxWYWx1ZSgpKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogSW5pdCB0aGUgZXh0ZXJuYWwgZWxlbWVudHMgKGxvYWRpbmcgYmFyIGFuZCBub3RpZmljYXRpb24gd2lkZ2V0KVxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX2luaXRFeHRlcm5hbEVsZW1lbnRzOiBmdW5jdGlvbiBkb2N1bWVudENvbnRyb2xsZXJfaW5pdEV4dGVybmFsRWxlbWVudHMoKSB7XG4gICAgICB0aGlzLiRsb2FkaW5nID0gJChcIi5kY3BMb2FkaW5nXCIpLmRjcExvYWRpbmcoKTtcbiAgICAgIHRoaXMuJG5vdGlmaWNhdGlvbiA9ICQoXCJib2R5XCIpLmRjcE5vdGlmaWNhdGlvbih3aW5kb3cuZGNwLm5vdGlmaWNhdGlvbnMpOyAvLyBhY3RpdmUgbm90aWZpY2F0aW9uXG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEJpbmQgdGhlIG1vZGVsIGV2ZW50XG4gICAgICpcbiAgICAgKiBSZS10cmlnZ2VyIHRoZSBldmVudFxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfaW5pdE1vZGVsRXZlbnRzOiBmdW5jdGlvbiBkb2N1bWVudENvbnRyb2xsZXJfaW5pdEV2ZW50cygpIHtcbiAgICAgIHZhciBjdXJyZW50V2lkZ2V0ID0gdGhpcztcbiAgICAgIHRoaXMuX21vZGVsLmxpc3RlblRvKFxuICAgICAgICB0aGlzLl9tb2RlbCxcbiAgICAgICAgXCJpbnZhbGlkXCIsXG4gICAgICAgIGZ1bmN0aW9uIGRvY3VtZW50Q29udHJvbGxlcl90cmlnZ2VyU2hvd0ludmFsaWQobW9kZWwsIGVycm9yKSB7XG4gICAgICAgICAgdmFyIHJlc3VsdCA9IGN1cnJlbnRXaWRnZXQuX3RyaWdnZXJDb250cm9sbGVyRXZlbnQoXG4gICAgICAgICAgICBcImRpc3BsYXlFcnJvclwiLFxuICAgICAgICAgICAgbnVsbCxcbiAgICAgICAgICAgIGN1cnJlbnRXaWRnZXQuZ2V0UHJvcGVydGllcygpLFxuICAgICAgICAgICAgZXJyb3JcbiAgICAgICAgICApO1xuICAgICAgICAgIGlmIChyZXN1bHQpIHtcbiAgICAgICAgICAgIGN1cnJlbnRXaWRnZXQuJG5vdGlmaWNhdGlvbi5kY3BOb3RpZmljYXRpb24oXCJzaG93RXJyb3JcIiwgZXJyb3IpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgKTtcbiAgICAgIHRoaXMuX21vZGVsLmxpc3RlblRvKFxuICAgICAgICB0aGlzLl9tb2RlbCxcbiAgICAgICAgXCJzaG93RXJyb3JcIixcbiAgICAgICAgZnVuY3Rpb24gZG9jdW1lbnRDb250cm9sbGVyX3RyaWdnZXJTaG93RXJyb3IoZXJyb3IpIHtcbiAgICAgICAgICB2YXIgcmVzdWx0ID0gY3VycmVudFdpZGdldC5fdHJpZ2dlckNvbnRyb2xsZXJFdmVudChcbiAgICAgICAgICAgIFwiZGlzcGxheUVycm9yXCIsXG4gICAgICAgICAgICBudWxsLFxuICAgICAgICAgICAgY3VycmVudFdpZGdldC5nZXRQcm9wZXJ0aWVzKCksXG4gICAgICAgICAgICBlcnJvclxuICAgICAgICAgICk7XG4gICAgICAgICAgaWYgKHJlc3VsdCkge1xuICAgICAgICAgICAgY3VycmVudFdpZGdldC4kbm90aWZpY2F0aW9uLmRjcE5vdGlmaWNhdGlvbihcInNob3dFcnJvclwiLCBlcnJvcik7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICApO1xuICAgICAgdGhpcy5fbW9kZWwubGlzdGVuVG8oXG4gICAgICAgIHRoaXMuX21vZGVsLFxuICAgICAgICBcInNob3dNZXNzYWdlXCIsXG4gICAgICAgIGZ1bmN0aW9uIGRvY3VtZW50Q29udHJvbGxlcl90cmlnZ2VyU2hvd01lc3NhZ2UobXNnKSB7XG4gICAgICAgICAgdmFyIHJlc3VsdCA9IGN1cnJlbnRXaWRnZXQuX3RyaWdnZXJDb250cm9sbGVyRXZlbnQoXG4gICAgICAgICAgICBcImRpc3BsYXlNZXNzYWdlXCIsXG4gICAgICAgICAgICBudWxsLFxuICAgICAgICAgICAgY3VycmVudFdpZGdldC5nZXRQcm9wZXJ0aWVzKCksXG4gICAgICAgICAgICBtc2dcbiAgICAgICAgICApO1xuICAgICAgICAgIGlmIChyZXN1bHQpIHtcbiAgICAgICAgICAgIGN1cnJlbnRXaWRnZXQuJG5vdGlmaWNhdGlvbi5kY3BOb3RpZmljYXRpb24oXCJzaG93XCIsIG1zZy50eXBlLCBtc2cpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgKTtcbiAgICAgIHRoaXMuX21vZGVsLmxpc3RlblRvKFxuICAgICAgICB0aGlzLl9tb2RlbCxcbiAgICAgICAgXCJyZWxvYWRcIixcbiAgICAgICAgZnVuY3Rpb24gZG9jdW1lbnRDb250cm9sbGVyX3RyaWdnZXJSZWluaXQoKSB7XG4gICAgICAgICAgLy8gY3VycmVudFdpZGdldC5faW5pdE1vZGVsKGN1cnJlbnRXaWRnZXQuX2dldE1vZGVsVmFsdWUoKSk7XG4gICAgICAgICAgLy8gY3VycmVudFdpZGdldC5faW5pdFZpZXcoKTtcbiAgICAgICAgICBjdXJyZW50V2lkZ2V0Ll9tb2RlbC5mZXRjaERvY3VtZW50KCk7XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgICB0aGlzLl9tb2RlbC5saXN0ZW5UbyhcbiAgICAgICAgdGhpcy5fbW9kZWwsXG4gICAgICAgIFwic3luY1wiLFxuICAgICAgICBmdW5jdGlvbiBkb2N1bWVudENvbnRyb2xsZXJfdHJpZ2dlclN5bmMoKSB7XG4gICAgICAgICAgY3VycmVudFdpZGdldC5faW5pdGlhbGl6ZWRNb2RlbCA9IHRydWU7XG4gICAgICAgICAgY3VycmVudFdpZGdldC5vcHRpb25zLmluaXRpZCA9IGN1cnJlbnRXaWRnZXQuX21vZGVsLmlkO1xuICAgICAgICAgIGN1cnJlbnRXaWRnZXQub3B0aW9ucy52aWV3SWQgPSBjdXJyZW50V2lkZ2V0Ll9tb2RlbC5nZXQoXCJ2aWV3SWRcIik7XG4gICAgICAgICAgY3VycmVudFdpZGdldC5vcHRpb25zLnJldmlzaW9uID0gY3VycmVudFdpZGdldC5fbW9kZWwuZ2V0KFwicmV2aXNpb25cIik7XG4gICAgICAgICAgY3VycmVudFdpZGdldC5lbGVtZW50LmRhdGEoXG4gICAgICAgICAgICBcImRvY3VtZW50XCIsXG4gICAgICAgICAgICBjdXJyZW50V2lkZ2V0Ll9nZXRNb2RlbFZhbHVlKClcbiAgICAgICAgICApO1xuICAgICAgICAgIGN1cnJlbnRXaWRnZXQuX2luaXRBY3RpdmF0ZWRDb25zdHJhaW50KCk7XG4gICAgICAgICAgY3VycmVudFdpZGdldC5faW5pdEFjdGl2YXRlZEV2ZW50TGlzdGVuZXJzKHsgbGF1bmNoUmVhZHk6IGZhbHNlIH0pO1xuICAgICAgICB9XG4gICAgICApO1xuICAgICAgdGhpcy5fbW9kZWwubGlzdGVuVG8oXG4gICAgICAgIHRoaXMuX21vZGVsLFxuICAgICAgICBcImJlZm9yZVJlbmRlclwiLFxuICAgICAgICBmdW5jdGlvbiBkb2N1bWVudENvbnRyb2xsZXJfdHJpZ2dlckJlZm9yZVJlbmRlcihldmVudCkge1xuICAgICAgICAgIGV2ZW50LnByZXZlbnQgPSAhY3VycmVudFdpZGdldC5fdHJpZ2dlckNvbnRyb2xsZXJFdmVudChcbiAgICAgICAgICAgIFwiYmVmb3JlUmVuZGVyXCIsXG4gICAgICAgICAgICBldmVudCxcbiAgICAgICAgICAgIGN1cnJlbnRXaWRnZXQuZ2V0UHJvcGVydGllcygpLFxuICAgICAgICAgICAgY3VycmVudFdpZGdldC5fbW9kZWwuZ2V0TW9kZWxQcm9wZXJ0aWVzKClcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICApO1xuICAgICAgdGhpcy5fbW9kZWwubGlzdGVuVG8oXG4gICAgICAgIHRoaXMuX21vZGVsLFxuICAgICAgICBcImJlZm9yZUNsb3NlXCIsXG4gICAgICAgIGZ1bmN0aW9uIGRvY3VtZW50Q29udHJvbGxlcl90cmlnZ2VyQmVmb3JlQ2xvc2UoXG4gICAgICAgICAgZXZlbnQsXG4gICAgICAgICAgbmV4dERvY3VtZW50LFxuICAgICAgICAgIGN1c3RvbUNsaWVudERhdGFcbiAgICAgICAgKSB7XG4gICAgICAgICAgaWYgKGN1cnJlbnRXaWRnZXQuX2luaXRpYWxpemVkVmlldyAhPT0gZmFsc2UpIHtcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnQgPSAhY3VycmVudFdpZGdldC5fdHJpZ2dlckNvbnRyb2xsZXJFdmVudChcbiAgICAgICAgICAgICAgXCJiZWZvcmVDbG9zZVwiLFxuICAgICAgICAgICAgICBldmVudCxcbiAgICAgICAgICAgICAgY3VycmVudFdpZGdldC5nZXRQcm9wZXJ0aWVzKCksXG4gICAgICAgICAgICAgIG5leHREb2N1bWVudCxcbiAgICAgICAgICAgICAgY3VzdG9tQ2xpZW50RGF0YVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgICB0aGlzLl9tb2RlbC5saXN0ZW5UbyhcbiAgICAgICAgdGhpcy5fbW9kZWwsXG4gICAgICAgIFwiY2xvc2VcIixcbiAgICAgICAgZnVuY3Rpb24gZG9jdW1lbnRDb250cm9sbGVyX3RyaWdnZXJDbG9zZShvbGRQcm9wZXJ0aWVzKSB7XG4gICAgICAgICAgaWYgKGN1cnJlbnRXaWRnZXQuX2luaXRpYWxpemVkVmlldyAhPT0gZmFsc2UpIHtcbiAgICAgICAgICAgIGN1cnJlbnRXaWRnZXQuX3RyaWdnZXJDb250cm9sbGVyRXZlbnQoXG4gICAgICAgICAgICAgIFwiY2xvc2VcIixcbiAgICAgICAgICAgICAgbnVsbCxcbiAgICAgICAgICAgICAgY3VycmVudFdpZGdldC5nZXRQcm9wZXJ0aWVzKCksXG4gICAgICAgICAgICAgIG9sZFByb3BlcnRpZXNcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGN1cnJlbnRXaWRnZXQuX2luaXRpYWxpemVkVmlldyA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICApO1xuICAgICAgdGhpcy5fbW9kZWwubGlzdGVuVG8oXG4gICAgICAgIHRoaXMuX21vZGVsLFxuICAgICAgICBcImdldEN1c3RvbUNsaWVudERhdGFcIixcbiAgICAgICAgZnVuY3Rpb24gZG9jdW1lbnRDb250cm9sbGVyX3RyaWdnZXJBZGRDdXN0b21EYXRhKCkge1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjdXJyZW50V2lkZ2V0Ll9tb2RlbC5fY3VzdG9tQ2xpZW50RGF0YSA9IGN1cnJlbnRXaWRnZXQuZ2V0Q3VzdG9tQ2xpZW50RGF0YShcbiAgICAgICAgICAgICAgZmFsc2VcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgLy9ubyB0ZXN0IGhlcmVcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgICB0aGlzLl9tb2RlbC5saXN0ZW5UbyhcbiAgICAgICAgdGhpcy5fbW9kZWwsXG4gICAgICAgIFwiYmVmb3JlU2F2ZVwiLFxuICAgICAgICBmdW5jdGlvbiBkb2N1bWVudENvbnRyb2xsZXJfdHJpZ2dlckJlZm9yZVNhdmUoZXZlbnQsIGN1c3RvbUNsaWVudERhdGEpIHtcbiAgICAgICAgICB2YXIgX21vZGVsID0gdGhpcztcbiAgICAgICAgICB2YXIgcmVxdWVzdE9wdGlvbnMgPSB7XG4gICAgICAgICAgICBnZXRSZXF1ZXN0RGF0YTogZnVuY3Rpb24gZ2V0UmVxdWVzdERhdGEoKSB7XG4gICAgICAgICAgICAgIHJldHVybiBfbW9kZWwudG9KU09OKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2V0UmVxdWVzdERhdGE6IGZ1bmN0aW9uIGRvY3VtZW50Q29udHJvbGxlclNldFJlcXVlc3REYXRhKGRhdGEpIHtcbiAgICAgICAgICAgICAgX21vZGVsLl9jdXN0b21SZXF1ZXN0RGF0YSA9IGRhdGE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfTtcbiAgICAgICAgICBldmVudC5wcmV2ZW50ID0gIWN1cnJlbnRXaWRnZXQuX3RyaWdnZXJDb250cm9sbGVyRXZlbnQoXG4gICAgICAgICAgICBcImJlZm9yZVNhdmVcIixcbiAgICAgICAgICAgIGV2ZW50LFxuICAgICAgICAgICAgY3VycmVudFdpZGdldC5nZXRQcm9wZXJ0aWVzKCksXG4gICAgICAgICAgICByZXF1ZXN0T3B0aW9ucyxcbiAgICAgICAgICAgIGN1c3RvbUNsaWVudERhdGFcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICApO1xuICAgICAgdGhpcy5fbW9kZWwubGlzdGVuVG8oXG4gICAgICAgIHRoaXMuX21vZGVsLFxuICAgICAgICBcImFmdGVyU2F2ZVwiLFxuICAgICAgICBmdW5jdGlvbiBkb2N1bWVudENvbnRyb2xsZXJfdHJpZ2dlckFmdGVyU2F2ZShvbGRQcm9wZXJ0aWVzKSB7XG4gICAgICAgICAgY3VycmVudFdpZGdldC5fdHJpZ2dlckNvbnRyb2xsZXJFdmVudChcbiAgICAgICAgICAgIFwiYWZ0ZXJTYXZlXCIsXG4gICAgICAgICAgICBudWxsLFxuICAgICAgICAgICAgY3VycmVudFdpZGdldC5nZXRQcm9wZXJ0aWVzKCksXG4gICAgICAgICAgICBvbGRQcm9wZXJ0aWVzXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgKTtcbiAgICAgIHRoaXMuX21vZGVsLmxpc3RlblRvKFxuICAgICAgICB0aGlzLl9tb2RlbCxcbiAgICAgICAgXCJiZWZvcmVSZXN0b3JlXCIsXG4gICAgICAgIGZ1bmN0aW9uIGRvY3VtZW50Q29udHJvbGxlcl90cmlnZ2VyQmVmb3JlUmVzdG9yZShldmVudCkge1xuICAgICAgICAgIGV2ZW50LnByZXZlbnQgPSAhY3VycmVudFdpZGdldC5fdHJpZ2dlckNvbnRyb2xsZXJFdmVudChcbiAgICAgICAgICAgIFwiYmVmb3JlUmVzdG9yZVwiLFxuICAgICAgICAgICAgZXZlbnQsXG4gICAgICAgICAgICBjdXJyZW50V2lkZ2V0LmdldFByb3BlcnRpZXMoKVxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgICB0aGlzLl9tb2RlbC5saXN0ZW5UbyhcbiAgICAgICAgdGhpcy5fbW9kZWwsXG4gICAgICAgIFwiYWZ0ZXJSZXN0b3JlXCIsXG4gICAgICAgIGZ1bmN0aW9uIGRvY3VtZW50Q29udHJvbGxlcl90cmlnZ2VyQWZ0ZXJSZXN0b3JlKG9sZFByb3BlcnRpZXMpIHtcbiAgICAgICAgICBjdXJyZW50V2lkZ2V0Ll90cmlnZ2VyQ29udHJvbGxlckV2ZW50KFxuICAgICAgICAgICAgXCJhZnRlclJlc3RvcmVcIixcbiAgICAgICAgICAgIG51bGwsXG4gICAgICAgICAgICBjdXJyZW50V2lkZ2V0LmdldFByb3BlcnRpZXMoKSxcbiAgICAgICAgICAgIG9sZFByb3BlcnRpZXNcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICApO1xuICAgICAgdGhpcy5fbW9kZWwubGlzdGVuVG8oXG4gICAgICAgIHRoaXMuX21vZGVsLFxuICAgICAgICBcImJlZm9yZURlbGV0ZVwiLFxuICAgICAgICBmdW5jdGlvbiBkb2N1bWVudENvbnRyb2xsZXJfdHJpZ2dlckJlZm9yZURlbGV0ZShcbiAgICAgICAgICBldmVudCxcbiAgICAgICAgICBjdXN0b21DbGllbnREYXRhXG4gICAgICAgICkge1xuICAgICAgICAgIGV2ZW50LnByZXZlbnQgPSAhY3VycmVudFdpZGdldC5fdHJpZ2dlckNvbnRyb2xsZXJFdmVudChcbiAgICAgICAgICAgIFwiYmVmb3JlRGVsZXRlXCIsXG4gICAgICAgICAgICBldmVudCxcbiAgICAgICAgICAgIGN1cnJlbnRXaWRnZXQuZ2V0UHJvcGVydGllcygpLFxuICAgICAgICAgICAgY3VycmVudFdpZGdldC5fbW9kZWwuZ2V0TW9kZWxQcm9wZXJ0aWVzKCksXG4gICAgICAgICAgICBjdXN0b21DbGllbnREYXRhXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgKTtcbiAgICAgIHRoaXMuX21vZGVsLmxpc3RlblRvKFxuICAgICAgICB0aGlzLl9tb2RlbCxcbiAgICAgICAgXCJhZnRlckRlbGV0ZVwiLFxuICAgICAgICBmdW5jdGlvbiBkb2N1bWVudENvbnRyb2xsZXJfdHJpZ2dlckFmdGVyRGVsZXRlKG9sZFByb3BlcnRpZXMpIHtcbiAgICAgICAgICBjdXJyZW50V2lkZ2V0Ll90cmlnZ2VyQ29udHJvbGxlckV2ZW50KFxuICAgICAgICAgICAgXCJhZnRlckRlbGV0ZVwiLFxuICAgICAgICAgICAgbnVsbCxcbiAgICAgICAgICAgIGN1cnJlbnRXaWRnZXQuZ2V0UHJvcGVydGllcygpLFxuICAgICAgICAgICAgb2xkUHJvcGVydGllc1xuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgICB0aGlzLl9tb2RlbC5saXN0ZW5UbyhcbiAgICAgICAgdGhpcy5fbW9kZWwsXG4gICAgICAgIFwidmFsaWRhdGVcIixcbiAgICAgICAgZnVuY3Rpb24gZG9jdW1lbnRDb250cm9sbGVyX3RyaWdnZXJWYWxpZGF0ZShldmVudCkge1xuICAgICAgICAgIGV2ZW50LnByZXZlbnQgPSAhY3VycmVudFdpZGdldC5fdHJpZ2dlckNvbnRyb2xsZXJFdmVudChcbiAgICAgICAgICAgIFwidmFsaWRhdGVcIixcbiAgICAgICAgICAgIGV2ZW50LFxuICAgICAgICAgICAgY3VycmVudFdpZGdldC5nZXRQcm9wZXJ0aWVzKClcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICApO1xuICAgICAgdGhpcy5fbW9kZWwubGlzdGVuVG8oXG4gICAgICAgIHRoaXMuX21vZGVsLFxuICAgICAgICBcImNoYW5nZVZhbHVlXCIsXG4gICAgICAgIGZ1bmN0aW9uIGRvY3VtZW50Q29udHJvbGxlcl90cmlnZ2VyQ2hhbmdlVmFsdWUob3B0aW9ucykge1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICB2YXIgY3VycmVudEF0dHJpYnV0ZSA9IGN1cnJlbnRXaWRnZXQuZ2V0QXR0cmlidXRlKFxuICAgICAgICAgICAgICAgIG9wdGlvbnMuYXR0cmlidXRlSWRcbiAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgaW5kZXggPSAwLFxuICAgICAgICAgICAgICB2YWx1ZXMgPSBjdXJyZW50QXR0cmlidXRlLmdldFZhbHVlKFwiYWxsXCIpLFxuICAgICAgICAgICAgICBtQXR0cmlidXRlID0gY3VycmVudFdpZGdldC5fZ2V0QXR0cmlidXRlTW9kZWwoXG4gICAgICAgICAgICAgICAgb3B0aW9ucy5hdHRyaWJ1dGVJZFxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgaWYgKG1BdHRyaWJ1dGUuZ2V0UGFyZW50KCkuZ2V0KFwidHlwZVwiKSAhPT0gXCJhcnJheVwiKSB7XG4gICAgICAgICAgICAgIGluZGV4ID0gLTE7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICB2YXIgY2hhbmdlc0luZGV4ID0gW107XG4gICAgICAgICAgICAgIF8uZWFjaChcbiAgICAgICAgICAgICAgICB2YWx1ZXMuY3VycmVudCxcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiBkb2N1bWVudENvbnRyb2xsZXJfdmFsdWVJc01vZGlmaWVkKGN1cnJlbnRWYWx1ZSkge1xuICAgICAgICAgICAgICAgICAgdmFyIHByZXZpb3VzID0gdmFsdWVzLnByZXZpb3VzW2luZGV4XTtcbiAgICAgICAgICAgICAgICAgIGlmICghcHJldmlvdXMpIHtcbiAgICAgICAgICAgICAgICAgICAgY2hhbmdlc0luZGV4LnB1c2goaW5kZXgpO1xuICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKF8uaXNBcnJheShjdXJyZW50VmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgY3VycmVudFZhbHVlID0gY3VycmVudFZhbHVlLmpvaW4oXCIsXCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnRWYWx1ZSA9IF8uaGFzKGN1cnJlbnRWYWx1ZSwgXCJ2YWx1ZVwiKVxuICAgICAgICAgICAgICAgICAgICAgID8gY3VycmVudFZhbHVlLnZhbHVlXG4gICAgICAgICAgICAgICAgICAgICAgOiBjdXJyZW50VmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIGlmIChfLmlzQXJyYXkocHJldmlvdXMpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgcHJldmlvdXMgPSBwcmV2aW91cy5qb2luKFwiLFwiKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBwcmV2aW91cyA9IF8uaGFzKHByZXZpb3VzLCBcInZhbHVlXCIpXG4gICAgICAgICAgICAgICAgICAgICAgPyBwcmV2aW91cy52YWx1ZVxuICAgICAgICAgICAgICAgICAgICAgIDogcHJldmlvdXM7XG4gICAgICAgICAgICAgICAgICAgIGlmIChwcmV2aW91cyAhPT0gY3VycmVudFZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgY2hhbmdlc0luZGV4LnB1c2goaW5kZXgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICBpbmRleCsrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgaW5kZXggPSBjaGFuZ2VzSW5kZXgubGVuZ3RoID09PSAxID8gY2hhbmdlc0luZGV4WzBdIDogLTE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjdXJyZW50V2lkZ2V0Ll90cmlnZ2VyQXR0cmlidXRlQ29udHJvbGxlckV2ZW50KFxuICAgICAgICAgICAgICBcImNoYW5nZVwiLFxuICAgICAgICAgICAgICBudWxsLFxuICAgICAgICAgICAgICBjdXJyZW50QXR0cmlidXRlLFxuICAgICAgICAgICAgICBjdXJyZW50V2lkZ2V0LmdldFByb3BlcnRpZXMoKSxcbiAgICAgICAgICAgICAgY3VycmVudEF0dHJpYnV0ZSxcbiAgICAgICAgICAgICAgY3VycmVudEF0dHJpYnV0ZS5nZXRWYWx1ZShcImFsbFwiKSxcbiAgICAgICAgICAgICAgaW5kZXhcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGlmICghKGVycm9yIGluc3RhbmNlb2YgRXJyb3JNb2RlbE5vbkluaXRpYWxpemVkKSkge1xuICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgICB0aGlzLl9tb2RlbC5saXN0ZW5UbyhcbiAgICAgICAgdGhpcy5fbW9kZWwsXG4gICAgICAgIFwiYmVmb3JlQXR0cmlidXRlUmVuZGVyXCIsXG4gICAgICAgIGZ1bmN0aW9uIGRvY3VtZW50Q29udHJvbGxlcl90cmlnZ2VyQXR0cmlidXRlUmVuZGVyKFxuICAgICAgICAgIGV2ZW50LFxuICAgICAgICAgIGF0dHJpYnV0ZUlkLFxuICAgICAgICAgICRlbCxcbiAgICAgICAgICBpbmRleFxuICAgICAgICApIHtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgdmFyIGN1cnJlbnRBdHRyaWJ1dGUgPSBjdXJyZW50V2lkZ2V0LmdldEF0dHJpYnV0ZShhdHRyaWJ1dGVJZCk7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50ID0gIWN1cnJlbnRXaWRnZXQuX3RyaWdnZXJBdHRyaWJ1dGVDb250cm9sbGVyRXZlbnQoXG4gICAgICAgICAgICAgIFwiYXR0cmlidXRlQmVmb3JlUmVuZGVyXCIsXG4gICAgICAgICAgICAgIGV2ZW50LFxuICAgICAgICAgICAgICBjdXJyZW50QXR0cmlidXRlLFxuICAgICAgICAgICAgICBjdXJyZW50V2lkZ2V0LmdldFByb3BlcnRpZXMoKSxcbiAgICAgICAgICAgICAgY3VycmVudEF0dHJpYnV0ZSxcbiAgICAgICAgICAgICAgJGVsLFxuICAgICAgICAgICAgICBpbmRleFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgaWYgKCEoZXJyb3IgaW5zdGFuY2VvZiBFcnJvck1vZGVsTm9uSW5pdGlhbGl6ZWQpKSB7XG4gICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgKTtcbiAgICAgIHRoaXMuX21vZGVsLmxpc3RlblRvKFxuICAgICAgICB0aGlzLl9tb2RlbCxcbiAgICAgICAgXCJhdHRyaWJ1dGVSZW5kZXJcIixcbiAgICAgICAgZnVuY3Rpb24gZG9jdW1lbnRDb250cm9sbGVyX3RyaWdnZXJBdHRyaWJ1dGVSZW5kZXIoXG4gICAgICAgICAgYXR0cmlidXRlSWQsXG4gICAgICAgICAgJGVsLFxuICAgICAgICAgIGluZGV4XG4gICAgICAgICkge1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICB2YXIgY3VycmVudEF0dHJpYnV0ZSA9IGN1cnJlbnRXaWRnZXQuZ2V0QXR0cmlidXRlKGF0dHJpYnV0ZUlkKTtcbiAgICAgICAgICAgIGN1cnJlbnRXaWRnZXQuX3RyaWdnZXJBdHRyaWJ1dGVDb250cm9sbGVyRXZlbnQoXG4gICAgICAgICAgICAgIFwiYXR0cmlidXRlUmVhZHlcIixcbiAgICAgICAgICAgICAgbnVsbCxcbiAgICAgICAgICAgICAgY3VycmVudEF0dHJpYnV0ZSxcbiAgICAgICAgICAgICAgY3VycmVudFdpZGdldC5nZXRQcm9wZXJ0aWVzKCksXG4gICAgICAgICAgICAgIGN1cnJlbnRBdHRyaWJ1dGUsXG4gICAgICAgICAgICAgICRlbCxcbiAgICAgICAgICAgICAgaW5kZXhcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGlmICghKGVycm9yIGluc3RhbmNlb2YgRXJyb3JNb2RlbE5vbkluaXRpYWxpemVkKSkge1xuICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgICB0aGlzLl9tb2RlbC5saXN0ZW5UbyhcbiAgICAgICAgdGhpcy5fbW9kZWwsXG4gICAgICAgIFwiYXJyYXlNb2RpZmllZFwiLFxuICAgICAgICBmdW5jdGlvbiBkb2N1bWVudENvbnRyb2xsZXJfdHJpZ2dlckFycmF5TW9kaWZpZWQob3B0aW9ucykge1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICB2YXIgY3VycmVudEF0dHJpYnV0ZSA9IGN1cnJlbnRXaWRnZXQuZ2V0QXR0cmlidXRlKFxuICAgICAgICAgICAgICBvcHRpb25zLmF0dHJpYnV0ZUlkXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgY3VycmVudFdpZGdldC5fdHJpZ2dlckF0dHJpYnV0ZUNvbnRyb2xsZXJFdmVudChcbiAgICAgICAgICAgICAgXCJhdHRyaWJ1dGVBcnJheUNoYW5nZVwiLFxuICAgICAgICAgICAgICBudWxsLFxuICAgICAgICAgICAgICBjdXJyZW50QXR0cmlidXRlLFxuICAgICAgICAgICAgICBjdXJyZW50V2lkZ2V0LmdldFByb3BlcnRpZXMoKSxcbiAgICAgICAgICAgICAgY3VycmVudEF0dHJpYnV0ZSxcbiAgICAgICAgICAgICAgb3B0aW9ucy50eXBlLFxuICAgICAgICAgICAgICBvcHRpb25zLm9wdGlvbnNcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGlmICghKGVycm9yIGluc3RhbmNlb2YgRXJyb3JNb2RlbE5vbkluaXRpYWxpemVkKSkge1xuICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgICB0aGlzLl9tb2RlbC5saXN0ZW5UbyhcbiAgICAgICAgdGhpcy5fbW9kZWwsXG4gICAgICAgIFwiaW50ZXJuYWxMaW5rU2VsZWN0ZWRcIixcbiAgICAgICAgZnVuY3Rpb24gZG9jdW1lbnRDb250cm9sbGVyX3RyaWdnZXJJbnRlcm5hbExpbmtTZWxlY3RlZChcbiAgICAgICAgICBldmVudCxcbiAgICAgICAgICBvcHRpb25zXG4gICAgICAgICkge1xuICAgICAgICAgIGV2ZW50LnByZXZlbnQgPSAhY3VycmVudFdpZGdldC5fdHJpZ2dlckNvbnRyb2xsZXJFdmVudChcbiAgICAgICAgICAgIFwiYWN0aW9uQ2xpY2tcIixcbiAgICAgICAgICAgIGV2ZW50LFxuICAgICAgICAgICAgY3VycmVudFdpZGdldC5nZXRQcm9wZXJ0aWVzKCksXG4gICAgICAgICAgICBvcHRpb25zXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgKTtcbiAgICAgIHRoaXMuX21vZGVsLmxpc3RlblRvKFxuICAgICAgICB0aGlzLl9tb2RlbCxcbiAgICAgICAgXCJkb3dubG9hZEZpbGVcIixcbiAgICAgICAgZnVuY3Rpb24gZG9jdW1lbnRDb250cm9sbGVyX3RyaWdnZXJEb3dubG9hZEZpbGUoXG4gICAgICAgICAgZXZlbnQsXG4gICAgICAgICAgYXR0cmlkLFxuICAgICAgICAgIG9wdGlvbnNcbiAgICAgICAgKSB7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHZhciBjdXJyZW50QXR0cmlidXRlID0gY3VycmVudFdpZGdldC5nZXRBdHRyaWJ1dGUoYXR0cmlkKTtcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnQgPSAhY3VycmVudFdpZGdldC5fdHJpZ2dlckF0dHJpYnV0ZUNvbnRyb2xsZXJFdmVudChcbiAgICAgICAgICAgICAgXCJhdHRyaWJ1dGVEb3dubG9hZEZpbGVcIixcbiAgICAgICAgICAgICAgZXZlbnQsXG4gICAgICAgICAgICAgIGN1cnJlbnRBdHRyaWJ1dGUsXG4gICAgICAgICAgICAgIGN1cnJlbnRXaWRnZXQuZ2V0UHJvcGVydGllcygpLFxuICAgICAgICAgICAgICBjdXJyZW50QXR0cmlidXRlLFxuICAgICAgICAgICAgICBvcHRpb25zLiRlbCxcbiAgICAgICAgICAgICAgb3B0aW9ucy5pbmRleFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgaWYgKCEoZXJyb3IgaW5zdGFuY2VvZiBFcnJvck1vZGVsTm9uSW5pdGlhbGl6ZWQpKSB7XG4gICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgKTtcbiAgICAgIHRoaXMuX21vZGVsLmxpc3RlblRvKFxuICAgICAgICB0aGlzLl9tb2RlbCxcbiAgICAgICAgXCJ1cGxvYWRGaWxlXCIsXG4gICAgICAgIGZ1bmN0aW9uIGRvY3VtZW50Q29udHJvbGxlcl90cmlnZ2VyVXBsb2FkRmlsZShldmVudCwgYXR0cmlkLCBvcHRpb25zKSB7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHZhciBjdXJyZW50QXR0cmlidXRlID0gY3VycmVudFdpZGdldC5nZXRBdHRyaWJ1dGUoYXR0cmlkKTtcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnQgPSAhY3VycmVudFdpZGdldC5fdHJpZ2dlckF0dHJpYnV0ZUNvbnRyb2xsZXJFdmVudChcbiAgICAgICAgICAgICAgXCJhdHRyaWJ1dGVVcGxvYWRGaWxlXCIsXG4gICAgICAgICAgICAgIGV2ZW50LFxuICAgICAgICAgICAgICBjdXJyZW50QXR0cmlidXRlLFxuICAgICAgICAgICAgICBjdXJyZW50V2lkZ2V0LmdldFByb3BlcnRpZXMoKSxcbiAgICAgICAgICAgICAgY3VycmVudEF0dHJpYnV0ZSxcbiAgICAgICAgICAgICAgb3B0aW9ucy4kZWwsXG4gICAgICAgICAgICAgIG9wdGlvbnMuaW5kZXgsXG4gICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBmaWxlOiBvcHRpb25zLmZpbGUsXG4gICAgICAgICAgICAgICAgaGFzVXBsb2FkaW5nRmlsZXM6IGN1cnJlbnRXaWRnZXQuX21vZGVsLmhhc1VwbG9hZGluZ0ZpbGUoKVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBpZiAoIShlcnJvciBpbnN0YW5jZW9mIEVycm9yTW9kZWxOb25Jbml0aWFsaXplZCkpIHtcbiAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICApO1xuICAgICAgdGhpcy5fbW9kZWwubGlzdGVuVG8oXG4gICAgICAgIHRoaXMuX21vZGVsLFxuICAgICAgICBcInVwbG9hZEZpbGVEb25lXCIsXG4gICAgICAgIGZ1bmN0aW9uIGRvY3VtZW50Q29udHJvbGxlcl90cmlnZ2VyVXBsb2FkRmlsZShldmVudCwgYXR0cmlkLCBvcHRpb25zKSB7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHZhciBjdXJyZW50QXR0cmlidXRlID0gY3VycmVudFdpZGdldC5nZXRBdHRyaWJ1dGUoYXR0cmlkKTtcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnQgPSAhY3VycmVudFdpZGdldC5fdHJpZ2dlckF0dHJpYnV0ZUNvbnRyb2xsZXJFdmVudChcbiAgICAgICAgICAgICAgXCJhdHRyaWJ1dGVVcGxvYWRGaWxlRG9uZVwiLFxuICAgICAgICAgICAgICBldmVudCxcbiAgICAgICAgICAgICAgY3VycmVudEF0dHJpYnV0ZSxcbiAgICAgICAgICAgICAgY3VycmVudFdpZGdldC5nZXRQcm9wZXJ0aWVzKCksXG4gICAgICAgICAgICAgIGN1cnJlbnRBdHRyaWJ1dGUsXG4gICAgICAgICAgICAgIG9wdGlvbnMuJGVsLFxuICAgICAgICAgICAgICBvcHRpb25zLmluZGV4LFxuICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgZmlsZTogb3B0aW9ucy5maWxlLFxuICAgICAgICAgICAgICAgIGhhc1VwbG9hZGluZ0ZpbGVzOiBjdXJyZW50V2lkZ2V0Ll9tb2RlbC5oYXNVcGxvYWRpbmdGaWxlKClcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgaWYgKCEoZXJyb3IgaW5zdGFuY2VvZiBFcnJvck1vZGVsTm9uSW5pdGlhbGl6ZWQpKSB7XG4gICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgKTtcblxuICAgICAgdGhpcy5fbW9kZWwubGlzdGVuVG8oXG4gICAgICAgIHRoaXMuX21vZGVsLFxuICAgICAgICBcImF0dHJpYnV0ZUJlZm9yZVRhYlNlbGVjdFwiLFxuICAgICAgICBmdW5jdGlvbiBkb2N1bWVudENvbnRyb2xsZXJfdHJpZ2dlckJlZm9yZVNlbGVjdFRhYihldmVudCwgYXR0cmlkKSB7XG4gICAgICAgICAgdmFyIGN1cnJlbnRBdHRyaWJ1dGUgPSBjdXJyZW50V2lkZ2V0LmdldEF0dHJpYnV0ZShhdHRyaWQpO1xuICAgICAgICAgIHZhciBwcmV2ZW50O1xuXG4gICAgICAgICAgcHJldmVudCA9ICFjdXJyZW50V2lkZ2V0Ll90cmlnZ2VyQXR0cmlidXRlQ29udHJvbGxlckV2ZW50KFxuICAgICAgICAgICAgXCJhdHRyaWJ1dGVCZWZvcmVUYWJTZWxlY3RcIixcbiAgICAgICAgICAgIGV2ZW50LFxuICAgICAgICAgICAgY3VycmVudEF0dHJpYnV0ZSxcbiAgICAgICAgICAgIGN1cnJlbnRXaWRnZXQuZ2V0UHJvcGVydGllcygpLFxuICAgICAgICAgICAgY3VycmVudEF0dHJpYnV0ZSxcbiAgICAgICAgICAgICQoZXZlbnQuaXRlbSlcbiAgICAgICAgICApO1xuICAgICAgICAgIGlmIChwcmV2ZW50KSB7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgKTtcbiAgICAgIHRoaXMuX21vZGVsLmxpc3RlblRvKFxuICAgICAgICB0aGlzLl9tb2RlbCxcbiAgICAgICAgXCJhdHRyaWJ1dGVUYWJDaGFuZ2VcIixcbiAgICAgICAgZnVuY3Rpb24gZG9jdW1lbnRDb250cm9sbGVyX3RyaWdnZXJBZnRlclNlbGVjdFRhYihcbiAgICAgICAgICBldmVudCxcbiAgICAgICAgICBhdHRyaWQsXG4gICAgICAgICAgJGVsLFxuICAgICAgICAgIGRhdGFcbiAgICAgICAgKSB7XG4gICAgICAgICAgdmFyIGN1cnJlbnRBdHRyaWJ1dGUgPSBjdXJyZW50V2lkZ2V0LmdldEF0dHJpYnV0ZShhdHRyaWQpO1xuXG4gICAgICAgICAgY3VycmVudFdpZGdldC5fdHJpZ2dlckF0dHJpYnV0ZUNvbnRyb2xsZXJFdmVudChcbiAgICAgICAgICAgIFwiYXR0cmlidXRlVGFiQ2hhbmdlXCIsXG4gICAgICAgICAgICBldmVudCxcbiAgICAgICAgICAgIGN1cnJlbnRBdHRyaWJ1dGUsXG4gICAgICAgICAgICBjdXJyZW50V2lkZ2V0LmdldFByb3BlcnRpZXMoKSxcbiAgICAgICAgICAgIGN1cnJlbnRBdHRyaWJ1dGUsXG4gICAgICAgICAgICAkZWwsXG4gICAgICAgICAgICBkYXRhXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgKTtcbiAgICAgIHRoaXMuX21vZGVsLmxpc3RlblRvKFxuICAgICAgICB0aGlzLl9tb2RlbCxcbiAgICAgICAgXCJhdHRyaWJ1dGVBZnRlclRhYlNlbGVjdFwiLFxuICAgICAgICBmdW5jdGlvbiBkb2N1bWVudENvbnRyb2xsZXJfdHJpZ2dlckFmdGVyU2VsZWN0VGFiKGV2ZW50LCBhdHRyaWQpIHtcbiAgICAgICAgICB2YXIgY3VycmVudEF0dHJpYnV0ZSA9IGN1cnJlbnRXaWRnZXQuZ2V0QXR0cmlidXRlKGF0dHJpZCk7XG5cbiAgICAgICAgICBjdXJyZW50V2lkZ2V0Ll90cmlnZ2VyQXR0cmlidXRlQ29udHJvbGxlckV2ZW50KFxuICAgICAgICAgICAgXCJhdHRyaWJ1dGVBZnRlclRhYlNlbGVjdFwiLFxuICAgICAgICAgICAgZXZlbnQsXG4gICAgICAgICAgICBjdXJyZW50QXR0cmlidXRlLFxuICAgICAgICAgICAgY3VycmVudFdpZGdldC5nZXRQcm9wZXJ0aWVzKCksXG4gICAgICAgICAgICBjdXJyZW50QXR0cmlidXRlLFxuICAgICAgICAgICAgJChldmVudC5pdGVtKVxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgICB0aGlzLl9tb2RlbC5saXN0ZW5UbyhcbiAgICAgICAgdGhpcy5fbW9kZWwsXG4gICAgICAgIFwiaGVscGVyU2VhcmNoXCIsXG4gICAgICAgIGZ1bmN0aW9uIGRvY3VtZW50Q29udHJvbGxlcl90cmlnZ2VySGVscGVyU2VhcmNoKFxuICAgICAgICAgIGV2ZW50LFxuICAgICAgICAgIGF0dHJpZCxcbiAgICAgICAgICBvcHRpb25zXG4gICAgICAgICkge1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICB2YXIgY3VycmVudEF0dHJpYnV0ZSA9IGN1cnJlbnRXaWRnZXQuZ2V0QXR0cmlidXRlKGF0dHJpZCk7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50ID0gIWN1cnJlbnRXaWRnZXQuX3RyaWdnZXJBdHRyaWJ1dGVDb250cm9sbGVyRXZlbnQoXG4gICAgICAgICAgICAgIFwiYXR0cmlidXRlSGVscGVyU2VhcmNoXCIsXG4gICAgICAgICAgICAgIGV2ZW50LFxuICAgICAgICAgICAgICBjdXJyZW50QXR0cmlidXRlLFxuICAgICAgICAgICAgICBjdXJyZW50V2lkZ2V0LmdldFByb3BlcnRpZXMoKSxcbiAgICAgICAgICAgICAgY3VycmVudEF0dHJpYnV0ZSxcbiAgICAgICAgICAgICAgb3B0aW9uc1xuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgaWYgKCEoZXJyb3IgaW5zdGFuY2VvZiBFcnJvck1vZGVsTm9uSW5pdGlhbGl6ZWQpKSB7XG4gICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgKTtcbiAgICAgIHRoaXMuX21vZGVsLmxpc3RlblRvKFxuICAgICAgICB0aGlzLl9tb2RlbCxcbiAgICAgICAgXCJoZWxwZXJSZXNwb25zZVwiLFxuICAgICAgICBmdW5jdGlvbiBkb2N1bWVudENvbnRyb2xsZXJfdHJpZ2dlckhlbHBlclJlc3BvbnNlKFxuICAgICAgICAgIGV2ZW50LFxuICAgICAgICAgIGF0dHJpZCxcbiAgICAgICAgICBvcHRpb25zXG4gICAgICAgICkge1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICB2YXIgY3VycmVudEF0dHJpYnV0ZSA9IGN1cnJlbnRXaWRnZXQuZ2V0QXR0cmlidXRlKGF0dHJpZCk7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50ID0gIWN1cnJlbnRXaWRnZXQuX3RyaWdnZXJBdHRyaWJ1dGVDb250cm9sbGVyRXZlbnQoXG4gICAgICAgICAgICAgIFwiYXR0cmlidXRlSGVscGVyUmVzcG9uc2VcIixcbiAgICAgICAgICAgICAgZXZlbnQsXG4gICAgICAgICAgICAgIGN1cnJlbnRBdHRyaWJ1dGUsXG4gICAgICAgICAgICAgIGN1cnJlbnRXaWRnZXQuZ2V0UHJvcGVydGllcygpLFxuICAgICAgICAgICAgICBjdXJyZW50QXR0cmlidXRlLFxuICAgICAgICAgICAgICBvcHRpb25zXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBpZiAoIShlcnJvciBpbnN0YW5jZW9mIEVycm9yTW9kZWxOb25Jbml0aWFsaXplZCkpIHtcbiAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICApO1xuICAgICAgdGhpcy5fbW9kZWwubGlzdGVuVG8oXG4gICAgICAgIHRoaXMuX21vZGVsLFxuICAgICAgICBcImhlbHBlclNlbGVjdFwiLFxuICAgICAgICBmdW5jdGlvbiBkb2N1bWVudENvbnRyb2xsZXJfdHJpZ2dlckhlbHBlclNlbGVjdChcbiAgICAgICAgICBldmVudCxcbiAgICAgICAgICBhdHRyaWQsXG4gICAgICAgICAgb3B0aW9uc1xuICAgICAgICApIHtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgdmFyIGN1cnJlbnRBdHRyaWJ1dGUgPSBjdXJyZW50V2lkZ2V0LmdldEF0dHJpYnV0ZShhdHRyaWQpO1xuICAgICAgICAgICAgZXZlbnQucHJldmVudCA9ICFjdXJyZW50V2lkZ2V0Ll90cmlnZ2VyQXR0cmlidXRlQ29udHJvbGxlckV2ZW50KFxuICAgICAgICAgICAgICBcImF0dHJpYnV0ZUhlbHBlclNlbGVjdFwiLFxuICAgICAgICAgICAgICBldmVudCxcbiAgICAgICAgICAgICAgY3VycmVudEF0dHJpYnV0ZSxcbiAgICAgICAgICAgICAgY3VycmVudFdpZGdldC5nZXRQcm9wZXJ0aWVzKCksXG4gICAgICAgICAgICAgIGN1cnJlbnRBdHRyaWJ1dGUsXG4gICAgICAgICAgICAgIG9wdGlvbnNcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGlmICghKGVycm9yIGluc3RhbmNlb2YgRXJyb3JNb2RlbE5vbkluaXRpYWxpemVkKSkge1xuICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICk7XG5cbiAgICAgIC8vIGxpc3RlbmVyIHRvIHByZXZlbnQgZGVmYXVsdCBhY3Rpb25zIHdoZW4gYW5jaG9yQ2xpY2sgaXMgdHJpZ2dlcmVkXG4gICAgICB0aGlzLl9tb2RlbC5saXN0ZW5UbyhcbiAgICAgICAgdGhpcy5fbW9kZWwsXG4gICAgICAgIFwiYW5jaG9yQ2xpY2tcIixcbiAgICAgICAgZnVuY3Rpb24gZG9jdW1lbnRDb250cm9sbGVyX3RyaWdnZXJIZWxwZXJTZWxlY3QoXG4gICAgICAgICAgZXZlbnQsXG4gICAgICAgICAgYXR0cmlkLFxuICAgICAgICAgIG9wdGlvbnNcbiAgICAgICAgKSB7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHZhciBjdXJyZW50QXR0cmlidXRlID0gY3VycmVudFdpZGdldC5nZXRBdHRyaWJ1dGUoYXR0cmlkKTtcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnQgPSAhY3VycmVudFdpZGdldC5fdHJpZ2dlckF0dHJpYnV0ZUNvbnRyb2xsZXJFdmVudChcbiAgICAgICAgICAgICAgXCJhdHRyaWJ1dGVBbmNob3JDbGlja1wiLFxuICAgICAgICAgICAgICBldmVudCxcbiAgICAgICAgICAgICAgY3VycmVudEF0dHJpYnV0ZSxcbiAgICAgICAgICAgICAgY3VycmVudFdpZGdldC5nZXRQcm9wZXJ0aWVzKCksXG4gICAgICAgICAgICAgIGN1cnJlbnRBdHRyaWJ1dGUsXG4gICAgICAgICAgICAgIG9wdGlvbnMuJGVsLFxuICAgICAgICAgICAgICBvcHRpb25zLmluZGV4LFxuICAgICAgICAgICAgICBvcHRpb25zLm9wdGlvbnNcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGlmICghKGVycm9yIGluc3RhbmNlb2YgRXJyb3JNb2RlbE5vbkluaXRpYWxpemVkKSkge1xuICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICk7XG5cbiAgICAgIC8vIEdlbmVyaWMgbGlzdGVuZXIgZm9yIGFkZENyZWF0ZURvY3VtZW50QnV0dG9uIGRvY2lkIHJlbmRlciBvcHRpb25cbiAgICAgIHRoaXMuX21vZGVsLmxpc3RlblRvKFxuICAgICAgICB0aGlzLl9tb2RlbCxcbiAgICAgICAgXCJjcmVhdGVEaWFsb2dMaXN0ZW5lclwiLFxuICAgICAgICBmdW5jdGlvbiBkb2N1bWVudENvbnRyb2xsZXJfdHJpZ2dlcmNyZWF0ZURpYWxvZ0RvY3VtZW50T3BlbihcbiAgICAgICAgICBldmVudCxcbiAgICAgICAgICBhdHRyaWQsXG4gICAgICAgICAgb3B0aW9uc1xuICAgICAgICApIHtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgdmFyIGN1cnJlbnRBdHRyaWJ1dGUgPSBjdXJyZW50V2lkZ2V0LmdldEF0dHJpYnV0ZShhdHRyaWQpO1xuICAgICAgICAgICAgdmFyIHRyaWdnZXJuYW1lID0gXCJhdHRyaWJ1dGVDcmVhdGVEaWFsb2dEb2N1bWVudFwiO1xuICAgICAgICAgICAgLy8gVXBwZXJjYXNlIGZpcnN0IGxldHRlclxuICAgICAgICAgICAgdHJpZ2dlcm5hbWUgKz1cbiAgICAgICAgICAgICAgb3B0aW9ucy50cmlnZ2VySWQuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgK1xuICAgICAgICAgICAgICBvcHRpb25zLnRyaWdnZXJJZC5zbGljZSgxKTtcblxuICAgICAgICAgICAgZXZlbnQucHJldmVudCA9ICFjdXJyZW50V2lkZ2V0Ll90cmlnZ2VyQXR0cmlidXRlQ29udHJvbGxlckV2ZW50KFxuICAgICAgICAgICAgICB0cmlnZ2VybmFtZSxcbiAgICAgICAgICAgICAgZXZlbnQsXG4gICAgICAgICAgICAgIGN1cnJlbnRBdHRyaWJ1dGUsXG4gICAgICAgICAgICAgIGN1cnJlbnRXaWRnZXQuZ2V0UHJvcGVydGllcygpLFxuICAgICAgICAgICAgICBjdXJyZW50QXR0cmlidXRlLFxuICAgICAgICAgICAgICBvcHRpb25zXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBpZiAoIShlcnJvciBpbnN0YW5jZW9mIEVycm9yTW9kZWxOb25Jbml0aWFsaXplZCkpIHtcbiAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICApO1xuICAgICAgdGhpcy5fbW9kZWwubGlzdGVuVG8oXG4gICAgICAgIHRoaXMuX21vZGVsLFxuICAgICAgICBcImNvbnN0cmFpbnRcIixcbiAgICAgICAgZnVuY3Rpb24gZG9jdW1lbnRDb250cm9sbGVyX3RyaWdnZXJDb25zdHJhaW50KFxuICAgICAgICAgIGF0dHJpYnV0ZSxcbiAgICAgICAgICBjb25zdHJhaW50Q29udHJvbGxlclxuICAgICAgICApIHtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgdmFyIGN1cnJlbnRBdHRyaWJ1dGUgPSBjdXJyZW50V2lkZ2V0LmdldEF0dHJpYnV0ZShhdHRyaWJ1dGUpLFxuICAgICAgICAgICAgICBjdXJyZW50TW9kZWwgPSBjdXJyZW50V2lkZ2V0LmdldFByb3BlcnRpZXMoKSxcbiAgICAgICAgICAgICAgJGVsZW1lbnQgPSAkKGN1cnJlbnRXaWRnZXQuZWxlbWVudCksXG4gICAgICAgICAgICAgIGFkZENvbnN0cmFpbnQgPSBmdW5jdGlvbiBkb2N1bWVudENvbnRyb2xsZXJfYWRkQ29uc3RyYWludChcbiAgICAgICAgICAgICAgICBjdXJyZW50Q29uc3RyYWludFxuICAgICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICBpZiAoXy5pc1N0cmluZyhjdXJyZW50Q29uc3RyYWludCkpIHtcbiAgICAgICAgICAgICAgICAgIGNvbnN0cmFpbnRDb250cm9sbGVyLmFkZENvbnN0cmFpbnRNZXNzYWdlKGN1cnJlbnRDb25zdHJhaW50KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICAgICAgXy5pc09iamVjdChjdXJyZW50Q29uc3RyYWludCkgJiZcbiAgICAgICAgICAgICAgICAgIGN1cnJlbnRDb25zdHJhaW50Lm1lc3NhZ2UgJiZcbiAgICAgICAgICAgICAgICAgIF8uaXNOdW1iZXIoY3VycmVudENvbnN0cmFpbnQuaW5kZXgpXG4gICAgICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgICBjb25zdHJhaW50Q29udHJvbGxlci5hZGRDb25zdHJhaW50TWVzc2FnZShcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudENvbnN0cmFpbnQubWVzc2FnZSxcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudENvbnN0cmFpbnQuaW5kZXhcbiAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgXy5lYWNoKFxuICAgICAgICAgICAgICBjdXJyZW50V2lkZ2V0LmFjdGl2YXRlZENvbnN0cmFpbnQsXG4gICAgICAgICAgICAgIGZ1bmN0aW9uIHRyaWdnZXJDdXJyZW50Q29uc3RyYWludChjdXJyZW50Q29uc3RyYWludCkge1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnRDb25zdHJhaW50LmF0dHJpYnV0ZUNoZWNrLmFwcGx5KCRlbGVtZW50LCBbXG4gICAgICAgICAgICAgICAgICAgICAgY3VycmVudEF0dHJpYnV0ZSxcbiAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50TW9kZWxcbiAgICAgICAgICAgICAgICAgICAgXSlcbiAgICAgICAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgcmVzcG9uc2UgPSBjdXJyZW50Q29uc3RyYWludC5jb25zdHJhaW50Q2hlY2suY2FsbChcbiAgICAgICAgICAgICAgICAgICAgICAkZWxlbWVudCxcbiAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50TW9kZWwsXG4gICAgICAgICAgICAgICAgICAgICAgY3VycmVudEF0dHJpYnV0ZSxcbiAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50QXR0cmlidXRlLmdldFZhbHVlKFwiYWxsXCIpXG4gICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChfLmlzQXJyYXkocmVzcG9uc2UpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgXy5lYWNoKHJlc3BvbnNlLCBhZGRDb25zdHJhaW50KTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICBhZGRDb25zdHJhaW50KHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBpZiAoIShlcnJvciBpbnN0YW5jZW9mIEVycm9yTW9kZWxOb25Jbml0aWFsaXplZCkpIHtcbiAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICApO1xuICAgICAgdGhpcy5fbW9kZWwubGlzdGVuVG8oXG4gICAgICAgIHRoaXMuX21vZGVsLFxuICAgICAgICBcInNob3dUcmFuc2l0aW9uXCIsXG4gICAgICAgIF8uYmluZChjdXJyZW50V2lkZ2V0Ll9pbml0QW5kRGlzcGxheVRyYW5zaXRpb24sIHRoaXMpXG4gICAgICApO1xuICAgICAgdGhpcy5fbW9kZWwubGlzdGVuVG8oXG4gICAgICAgIHRoaXMuX21vZGVsLFxuICAgICAgICBcImJlZm9yZVBhcnNlXCIsXG4gICAgICAgIF8uYmluZChmdW5jdGlvbiBkZWxldGVDdXN0b21DbGllbnQoKSB7XG4gICAgICAgICAgLy9TdXBwcmVzcyBjdXN0b21DbGllbnREYXRhIGFmdGVyIGEgc3VjZXNzZnVsIHRyYW5zYWN0aW9uXG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGN1cnJlbnRXaWRnZXQuZ2V0Q3VzdG9tQ2xpZW50RGF0YSh0cnVlKTtcbiAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAvL25vIHRlc3QgaGVyZVxuICAgICAgICAgIH1cbiAgICAgICAgfSwgdGhpcylcbiAgICAgICk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEJpbmQgdGhlIHZpZXdcbiAgICAgKiBSZS10cmlnZ2VyIHRoZSBldmVudHNcbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX2luaXRWaWV3RXZlbnRzOiBmdW5jdGlvbiBkb2N1bWVudENvbnRyb2xsZXJfaW5pdFZpZXdFdmVudHMoKSB7XG4gICAgICB2YXIgY3VycmVudFdpZGdldCA9IHRoaXM7XG4gICAgICB0aGlzLnZpZXcub24oXG4gICAgICAgIFwiY2xlYW5Ob3RpZmljYXRpb25cIixcbiAgICAgICAgZnVuY3Rpb24gZG9jdW1lbnRDb250cm9sbGVyX3RyaWdnZXJDbGVhbk5vdGlmaWNhdGlvbigpIHtcbiAgICAgICAgICBjdXJyZW50V2lkZ2V0LiRub3RpZmljYXRpb24uZGNwTm90aWZpY2F0aW9uKFwiY2xlYXJcIik7XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgICB0aGlzLnZpZXcub24oXCJsb2FkaW5nXCIsIGZ1bmN0aW9uIGRvY3VtZW50Q29udHJvbGxlcl90cmlnZ2VyTG9hZGluZyhcbiAgICAgICAgZGF0YSxcbiAgICAgICAgbmJJdGVtXG4gICAgICApIHtcbiAgICAgICAgY3VycmVudFdpZGdldC4kbG9hZGluZy5kY3BMb2FkaW5nKFwic2V0UGVyY2VudFwiLCBkYXRhKTtcbiAgICAgICAgaWYgKG5iSXRlbSkge1xuICAgICAgICAgIGN1cnJlbnRXaWRnZXQuJGxvYWRpbmcuZGNwTG9hZGluZyhcInNldE5iSXRlbVwiLCBuYkl0ZW0pO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIHRoaXMudmlldy5vbihcImxvYWRlclNob3dcIiwgZnVuY3Rpb24gZG9jdW1lbnRDb250cm9sbGVyX3RyaWdnZXJMb2FkZXJTaG93KFxuICAgICAgICB0ZXh0LFxuICAgICAgICBwY1xuICAgICAgKSB7XG4gICAgICAgIGNvbnNvbGUudGltZShcInhocityZW5kZXIgZG9jdW1lbnQgdmlld1wiKTtcbiAgICAgICAgY3VycmVudFdpZGdldC4kbG9hZGluZy5kY3BMb2FkaW5nKFwic2hvd1wiLCB0ZXh0LCBwYyk7XG4gICAgICB9KTtcbiAgICAgIHRoaXMudmlldy5vbihcImxvYWRlckhpZGVcIiwgZnVuY3Rpb24gZG9jdW1lbnRDb250cm9sbGVyX3RyaWdnZXJIaWRlKCkge1xuICAgICAgICBjdXJyZW50V2lkZ2V0LiRsb2FkaW5nLmRjcExvYWRpbmcoXCJoaWRlXCIpO1xuICAgICAgfSk7XG4gICAgICB0aGlzLnZpZXcub24oXG4gICAgICAgIFwicGFydFJlbmRlclwiLFxuICAgICAgICBmdW5jdGlvbiBkb2N1bWVudENvbnRyb2xsZXJfdHJpZ2dlclBhcnRSZW5kZXIoKSB7XG4gICAgICAgICAgY3VycmVudFdpZGdldC4kbG9hZGluZy5kY3BMb2FkaW5nKFwiYWRkSXRlbVwiKTtcbiAgICAgICAgfVxuICAgICAgKTtcbiAgICAgIHRoaXMudmlldy5vbihcbiAgICAgICAgXCJyZW5kZXJEb25lXCIsXG4gICAgICAgIGZ1bmN0aW9uIGRvY3VtZW50Q29udHJvbGxlcl90cmlnZ2VyUmVuZGVyRG9uZSgpIHtcbiAgICAgICAgICBjb25zb2xlLnRpbWVFbmQoXCJ4aHIrcmVuZGVyIGRvY3VtZW50IHZpZXdcIik7XG4gICAgICAgICAgY3VycmVudFdpZGdldC4kbG9hZGluZy5kY3BMb2FkaW5nKFwic2V0UGVyY2VudFwiLCAxMDApO1xuICAgICAgICAgIGN1cnJlbnRXaWRnZXQuJGxvYWRpbmcuZGNwTG9hZGluZyhcInNldExhYmVsXCIsIG51bGwpO1xuICAgICAgICAgIGN1cnJlbnRXaWRnZXQuX2luaXRpYWxpemVkVmlldyA9IHRydWU7XG4gICAgICAgICAgY3VycmVudFdpZGdldC5fdHJpZ2dlckNvbnRyb2xsZXJFdmVudChcbiAgICAgICAgICAgIFwicmVhZHlcIixcbiAgICAgICAgICAgIG51bGwsXG4gICAgICAgICAgICBjdXJyZW50V2lkZ2V0LmdldFByb3BlcnRpZXMoKVxuICAgICAgICAgICk7XG4gICAgICAgICAgXy5kZWxheShmdW5jdGlvbiBkb2N1bWVudENvbnRyb2xsZXJfZW5kUmVuZGVyKCkge1xuICAgICAgICAgICAgY3VycmVudFdpZGdldC4kbG9hZGluZy5kY3BMb2FkaW5nKFwiaGlkZVwiLCB0cnVlKTtcbiAgICAgICAgICAgIGNvbnNvbGUudGltZUVuZChcIm1haW5cIik7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgICB0aGlzLnZpZXcub24oXG4gICAgICAgIFwic2hvd01lc3NhZ2VcIixcbiAgICAgICAgZnVuY3Rpb24gZG9jdW1lbnRDb250cm9sbGVyX3RyaWdnZXJTaG93TWVzc2FnZShtZXNzYWdlKSB7XG4gICAgICAgICAgdmFyIHJlc3VsdCA9IGN1cnJlbnRXaWRnZXQuX3RyaWdnZXJDb250cm9sbGVyRXZlbnQoXG4gICAgICAgICAgICBcImRpc3BsYXlNZXNzYWdlXCIsXG4gICAgICAgICAgICBudWxsLFxuICAgICAgICAgICAgY3VycmVudFdpZGdldC5nZXRQcm9wZXJ0aWVzKCksXG4gICAgICAgICAgICBtZXNzYWdlXG4gICAgICAgICAgKTtcbiAgICAgICAgICBpZiAocmVzdWx0KSB7XG4gICAgICAgICAgICBjdXJyZW50V2lkZ2V0LiRub3RpZmljYXRpb24uZGNwTm90aWZpY2F0aW9uKFxuICAgICAgICAgICAgICBcInNob3dcIixcbiAgICAgICAgICAgICAgbWVzc2FnZS50eXBlLFxuICAgICAgICAgICAgICBtZXNzYWdlXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgKTtcbiAgICAgIHRoaXMudmlldy5vbihcbiAgICAgICAgXCJzaG93U3VjY2Vzc1wiLFxuICAgICAgICBmdW5jdGlvbiBkb2N1bWVudENvbnRyb2xsZXJfdHJpZ2dlclNob3dTdWNjZXNzKG1lc3NhZ2UpIHtcbiAgICAgICAgICB2YXIgcmVzdWx0ID0gY3VycmVudFdpZGdldC5fdHJpZ2dlckNvbnRyb2xsZXJFdmVudChcbiAgICAgICAgICAgIFwiZGlzcGxheU1lc3NhZ2VcIixcbiAgICAgICAgICAgIG51bGwsXG4gICAgICAgICAgICBjdXJyZW50V2lkZ2V0LmdldFByb3BlcnRpZXMoKSxcbiAgICAgICAgICAgIG1lc3NhZ2VcbiAgICAgICAgICApO1xuICAgICAgICAgIGlmIChyZXN1bHQpIHtcbiAgICAgICAgICAgIGN1cnJlbnRXaWRnZXQuJG5vdGlmaWNhdGlvbi5kY3BOb3RpZmljYXRpb24oXCJzaG93U3VjY2Vzc1wiLCBtZXNzYWdlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgICB0aGlzLnZpZXcub24oXCJyZWluaXRcIiwgZnVuY3Rpb24gZG9jdW1lbnRDb250cm9sbGVyX3RyaWdnZXJSZWluaXQoKSB7XG4gICAgICAgIGN1cnJlbnRXaWRnZXQuX2luaXRNb2RlbChjdXJyZW50V2lkZ2V0Ll9nZXRNb2RlbFZhbHVlKCkpO1xuICAgICAgICBjdXJyZW50V2lkZ2V0Ll9pbml0VmlldygpO1xuICAgICAgICBjdXJyZW50V2lkZ2V0Ll9tb2RlbC5mZXRjaERvY3VtZW50KCk7XG4gICAgICB9KTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogSW5pdCB0aGUgcHVzaHN0YXRlIHJvdXRlclxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfaW5pdFJvdXRlcjogZnVuY3Rpb24gZG9jdW1lbnRDb250cm9sbGVyX2luaXRSb3V0ZXIoY29uZmlnKSB7XG4gICAgICBpZiAodGhpcy5yb3V0ZXIpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucm91dGVyO1xuICAgICAgfVxuICAgICAgdHJ5IHtcbiAgICAgICAgaWYgKHdpbmRvdy5oaXN0b3J5ICYmIGhpc3RvcnkucHVzaFN0YXRlKSB7XG4gICAgICAgICAgQmFja2JvbmUuaGlzdG9yeS5zdGFydCh7IHB1c2hTdGF0ZTogdHJ1ZSB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvL0ZvciBicm93c2VyIHdpdGhvdXQgQVBJIGhpc3RvcnlcbiAgICAgICAgICBCYWNrYm9uZS5oaXN0b3J5LnN0YXJ0KCk7XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihlKTtcbiAgICAgIH1cbiAgICAgIHRoaXMucm91dGVyID0gbmV3IFJvdXRlcih7XG4gICAgICAgIGRvY3VtZW50OiB0aGlzLl9tb2RlbCxcbiAgICAgICAgdXNlSGlzdG9yeTogIWNvbmZpZyB8fCBjb25maWcudXNlSGlzdG9yeVxuICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEluaXQgYW5kIGRpc3BsYXkgdGhlIGNoYW5nZSBzdGF0ZSBwb3AtdXBcbiAgICAgKlxuICAgICAqIEBwYXJhbSBuZXh0U3RhdGVcbiAgICAgKiBAcGFyYW0gdHJhbnNpdGlvblxuICAgICAqIEBwYXJhbSB2YWx1ZXNcbiAgICAgKiBAcGFyYW0gd2l0aG91dEludGVyZmFjZVxuICAgICAqIEBwYXJhbSByZWluaXRPcHRpb25zXG4gICAgICovXG4gICAgX2luaXRBbmREaXNwbGF5VHJhbnNpdGlvbjogZnVuY3Rpb24gZG9jdW1lbnRDb250cm9sbGVyX2luaXRBbmREaXNwbGF5VHJhbnNpdGlvbihcbiAgICAgIG5leHRTdGF0ZSxcbiAgICAgIHRyYW5zaXRpb24sXG4gICAgICB2YWx1ZXMsXG4gICAgICB3aXRob3V0SW50ZXJmYWNlLFxuICAgICAgcmVpbml0T3B0aW9uc1xuICAgICkge1xuICAgICAgdmFyICR0YXJnZXQgPSAkKCc8ZGl2IGNsYXNzPVwiZGNwVHJhbnNpdGlvblwiLz4nKSxcbiAgICAgICAgdHJhbnNpdGlvbkVsZW1lbnRzID0ge30sXG4gICAgICAgIGN1cnJlbnRXaWRnZXQgPSB0aGlzLFxuICAgICAgICByZXN1bHQsXG4gICAgICAgIHRyYW5zaXRpb25JbnRlcmZhY2UsXG4gICAgICAgIGRvY3VtZW50U2VydmVyUHJvcGVydGllcyA9IHRoaXMuZ2V0UHJvcGVydGllcygpO1xuXG4gICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gZG9jdW1lbnRDb250cm9sbGVyX2NoYW5nZVN0YXRlUHJvbWlzZShcbiAgICAgICAgcmVzb2x2ZSxcbiAgICAgICAgcmVqZWN0XG4gICAgICApIHtcbiAgICAgICAgcmVzdWx0ID0gIWN1cnJlbnRXaWRnZXQuX3RyaWdnZXJDb250cm9sbGVyRXZlbnQoXG4gICAgICAgICAgXCJiZWZvcmVEaXNwbGF5Q2hhbmdlU3RhdGVcIixcbiAgICAgICAgICBudWxsLFxuICAgICAgICAgIGN1cnJlbnRXaWRnZXQuZ2V0UHJvcGVydGllcygpLFxuICAgICAgICAgIG5ldyBUcmFuc2l0aW9uSW50ZXJmYWNlKG51bGwsICR0YXJnZXQsIG5leHRTdGF0ZSwgdHJhbnNpdGlvbilcbiAgICAgICAgKTtcbiAgICAgICAgaWYgKHJlc3VsdCkge1xuICAgICAgICAgIHJlamVjdCgpO1xuICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9XG5cbiAgICAgICAgLy9Jbml0IHRyYW5zaXRpb24gbW9kZWxcbiAgICAgICAgdHJhbnNpdGlvbkVsZW1lbnRzLm1vZGVsID0gbmV3IFRyYW5zaXRpb25Nb2RlbCh7XG4gICAgICAgICAgZG9jdW1lbnRJZDogY3VycmVudFdpZGdldC5fbW9kZWwuaWQsXG4gICAgICAgICAgZG9jdW1lbnRNb2RlbDogY3VycmVudFdpZGdldC5fbW9kZWwsXG4gICAgICAgICAgc3RhdGU6IG5leHRTdGF0ZSxcbiAgICAgICAgICB0cmFuc2l0aW9uOiB0cmFuc2l0aW9uXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vSW5pdCB0cmFuc2l0aW9uIHZpZXdcbiAgICAgICAgaWYgKHdpdGhvdXRJbnRlcmZhY2UgIT09IHRydWUpIHtcbiAgICAgICAgICB0cmFuc2l0aW9uRWxlbWVudHMudmlldyA9IG5ldyBUcmFuc2l0aW9uVmlldyh7XG4gICAgICAgICAgICBtb2RlbDogdHJhbnNpdGlvbkVsZW1lbnRzLm1vZGVsLFxuICAgICAgICAgICAgZWw6ICR0YXJnZXRcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRyYW5zaXRpb25JbnRlcmZhY2UgPSBuZXcgVHJhbnNpdGlvbkludGVyZmFjZShcbiAgICAgICAgICB0cmFuc2l0aW9uRWxlbWVudHMubW9kZWwsXG4gICAgICAgICAgJHRhcmdldCxcbiAgICAgICAgICBuZXh0U3RhdGUsXG4gICAgICAgICAgdHJhbnNpdGlvblxuICAgICAgICApO1xuXG4gICAgICAgIGlmICh0cmFuc2l0aW9uRWxlbWVudHMudmlldykge1xuICAgICAgICAgIC8vUHJvcGFnYXRlIGFmdGVyRGlzcGxheUNoYW5nZSBvbiByZW5kZXJEb25lXG4gICAgICAgICAgdHJhbnNpdGlvbkVsZW1lbnRzLnZpZXcub25jZShcbiAgICAgICAgICAgIFwicmVuZGVyVHJhbnNpdGlvbldpbmRvd0RvbmVcIixcbiAgICAgICAgICAgIGZ1bmN0aW9uIGRvY3VtZW50Q29udHJvbGxlcl9wcm9wYWdhdGVBZnRlcigpIHtcbiAgICAgICAgICAgICAgY3VycmVudFdpZGdldC5fdHJpZ2dlckNvbnRyb2xsZXJFdmVudChcbiAgICAgICAgICAgICAgICBcImFmdGVyRGlzcGxheVRyYW5zaXRpb25cIixcbiAgICAgICAgICAgICAgICBudWxsLFxuICAgICAgICAgICAgICAgIGN1cnJlbnRXaWRnZXQuZ2V0UHJvcGVydGllcygpLFxuICAgICAgICAgICAgICAgIHRyYW5zaXRpb25JbnRlcmZhY2VcbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgLy9Qcm9wYWdhdGUgdGhlIGJlZm9yZVRyYW5zaXRpb25cbiAgICAgICAgdHJhbnNpdGlvbkVsZW1lbnRzLm1vZGVsLmxpc3RlblRvKFxuICAgICAgICAgIHRyYW5zaXRpb25FbGVtZW50cy5tb2RlbCxcbiAgICAgICAgICBcImJlZm9yZUNoYW5nZVN0YXRlXCIsXG4gICAgICAgICAgZnVuY3Rpb24gZG9jdW1lbnRDb250cm9sbGVyX3Byb3BhZ2F0ZUJlZm9yZVRyYW5zaXRpb24oZXZlbnQpIHtcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnQgPSAhY3VycmVudFdpZGdldC5fdHJpZ2dlckNvbnRyb2xsZXJFdmVudChcbiAgICAgICAgICAgICAgXCJiZWZvcmVUcmFuc2l0aW9uXCIsXG4gICAgICAgICAgICAgIG51bGwsXG4gICAgICAgICAgICAgIGN1cnJlbnRXaWRnZXQuZ2V0UHJvcGVydGllcygpLFxuICAgICAgICAgICAgICB0cmFuc2l0aW9uSW50ZXJmYWNlXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgKTtcblxuICAgICAgICAvL1Byb3BhZ2F0ZSB0aGUgYmVmb3JlVHJhbnNpdGlvbkNsb3NlXG4gICAgICAgIHRyYW5zaXRpb25FbGVtZW50cy5tb2RlbC5saXN0ZW5UbyhcbiAgICAgICAgICB0cmFuc2l0aW9uRWxlbWVudHMubW9kZWwsXG4gICAgICAgICAgXCJiZWZvcmVDaGFuZ2VTdGF0ZUNsb3NlXCIsXG4gICAgICAgICAgZnVuY3Rpb24gZG9jdW1lbnRDb250cm9sbGVyX3Byb3BhZ2F0ZVRyYW5zaXRpb25DbG9zZShldmVudCkge1xuICAgICAgICAgICAgZXZlbnQucHJldmVudCA9ICFjdXJyZW50V2lkZ2V0Ll90cmlnZ2VyQ29udHJvbGxlckV2ZW50KFxuICAgICAgICAgICAgICBcImJlZm9yZVRyYW5zaXRpb25DbG9zZVwiLFxuICAgICAgICAgICAgICBudWxsLFxuICAgICAgICAgICAgICBjdXJyZW50V2lkZ2V0LmdldFByb3BlcnRpZXMoKSxcbiAgICAgICAgICAgICAgdHJhbnNpdGlvbkludGVyZmFjZVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgICk7XG5cbiAgICAgICAgdHJhbnNpdGlvbkVsZW1lbnRzLm1vZGVsLmxpc3RlblRvKFxuICAgICAgICAgIHRyYW5zaXRpb25FbGVtZW50cy5tb2RlbCxcbiAgICAgICAgICBcInNob3dFcnJvclwiLFxuICAgICAgICAgIGZ1bmN0aW9uIGRvY3VtZW50Q29udHJvbGxlcl9wcm9wYWdhdGVUcmFuc2l0aW9uRXJyb3IoZXJyb3IpIHtcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnQgPSAhY3VycmVudFdpZGdldC5fdHJpZ2dlckNvbnRyb2xsZXJFdmVudChcbiAgICAgICAgICAgICAgXCJmYWlsVHJhbnNpdGlvblwiLFxuICAgICAgICAgICAgICBudWxsLFxuICAgICAgICAgICAgICBjdXJyZW50V2lkZ2V0LmdldFByb3BlcnRpZXMoKSxcbiAgICAgICAgICAgICAgdHJhbnNpdGlvbkludGVyZmFjZSxcbiAgICAgICAgICAgICAgZXJyb3JcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICByZWplY3QoeyBkb2N1bWVudFByb3BlcnRpZXM6IGRvY3VtZW50U2VydmVyUHJvcGVydGllcyB9KTtcbiAgICAgICAgICB9XG4gICAgICAgICk7XG5cbiAgICAgICAgdHJhbnNpdGlvbkVsZW1lbnRzLm1vZGVsLmxpc3RlblRvKFxuICAgICAgICAgIHRyYW5zaXRpb25FbGVtZW50cy5tb2RlbCxcbiAgICAgICAgICBcInN1Y2Nlc3NcIixcbiAgICAgICAgICBmdW5jdGlvbiBkb2N1bWVudENvbnRyb2xsZXJfVHJhbnNpdGlvblN1Y2Nlc3MobWVzc2FnZXMpIHtcbiAgICAgICAgICAgIGlmICh0cmFuc2l0aW9uRWxlbWVudHMudmlldykge1xuICAgICAgICAgICAgICB0cmFuc2l0aW9uRWxlbWVudHMudmlldy4kZWwuaGlkZSgpO1xuICAgICAgICAgICAgICBjdXJyZW50V2lkZ2V0LnZpZXcub25jZShcbiAgICAgICAgICAgICAgICBcInJlbmRlckRvbmVcIixcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiBkb2N1bWVudENvbnRyb2xsZXJfdHJhbnNpdGlvblJlbmRlcigpIHtcbiAgICAgICAgICAgICAgICAgIHRyYW5zaXRpb25FbGVtZW50cy52aWV3LnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICAgXy5lYWNoKG1lc3NhZ2VzLCBmdW5jdGlvbiBkb2N1bWVudENvbnRyb2xsZXJfcGFyc2VNZXNzYWdlKFxuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlXG4gICAgICAgICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudFdpZGdldC52aWV3LnRyaWdnZXIoXCJzaG93TWVzc2FnZVwiLCBtZXNzYWdlKTtcbiAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy9kZWxldGUgdGhlIHBvcCB1cCB3aGVuIHRoZSByZW5kZXIgb2YgdGhlIHBvcCB1cCBpcyBkb25lXG4gICAgICAgICAgICBjdXJyZW50V2lkZ2V0Ll90cmlnZ2VyQ29udHJvbGxlckV2ZW50KFxuICAgICAgICAgICAgICBcInN1Y2Nlc3NUcmFuc2l0aW9uXCIsXG4gICAgICAgICAgICAgIG51bGwsXG4gICAgICAgICAgICAgIGN1cnJlbnRXaWRnZXQuZ2V0UHJvcGVydGllcygpLFxuICAgICAgICAgICAgICB0cmFuc2l0aW9uSW50ZXJmYWNlXG4gICAgICAgICAgICApO1xuXG4gICAgICAgICAgICByZWluaXRPcHRpb25zID0gcmVpbml0T3B0aW9ucyB8fCB7IHJldmlzaW9uOiAtMSB9O1xuICAgICAgICAgICAgaWYgKCFfLmhhcyhyZWluaXRPcHRpb25zLCBcInJldmlzaW9uXCIpKSB7XG4gICAgICAgICAgICAgIHJlaW5pdE9wdGlvbnMucmV2aXNpb24gPSAtMTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy9SZWluaXQgdGhlIG1haW4gbW9kZWwgd2l0aCBsYXN0IHJldmlzaW9uXG4gICAgICAgICAgICBjdXJyZW50V2lkZ2V0LnJlaW5pdERvY3VtZW50KHJlaW5pdE9wdGlvbnMpLnRoZW4oXG4gICAgICAgICAgICAgIGZ1bmN0aW9uIGRvY3VtZW50Q29udHJvbGxlcl9yZWluaXREb25lKCkge1xuICAgICAgICAgICAgICAgIHJlc29sdmUoeyBkb2N1bWVudFByb3BlcnRpZXM6IGRvY3VtZW50U2VydmVyUHJvcGVydGllcyB9KTtcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgZnVuY3Rpb24gZG9jdW1lbnRDb250cm9sbGVyX3JlaW5pdEZhaWwoKSB7XG4gICAgICAgICAgICAgICAgcmVqZWN0KHsgZG9jdW1lbnRQcm9wZXJ0aWVzOiBkb2N1bWVudFNlcnZlclByb3BlcnRpZXMgfSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICApO1xuXG4gICAgICAgIHRyYW5zaXRpb25FbGVtZW50cy5tb2RlbC5saXN0ZW5UbyhcbiAgICAgICAgICBjdXJyZW50V2lkZ2V0Ll9tb2RlbCxcbiAgICAgICAgICBcInN5bmNcIixcbiAgICAgICAgICBmdW5jdGlvbiBkb2N1bWVudENvbnRyb2xsZXJfVHJhbnNpdGlvbkNsb3NlKCkge1xuICAgICAgICAgICAgdGhpcy50cmlnZ2VyKFwiY2xvc2VcIik7XG4gICAgICAgICAgfVxuICAgICAgICApO1xuXG4gICAgICAgIHRyYW5zaXRpb25FbGVtZW50cy5tb2RlbC5mZXRjaCh7XG4gICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gdHJhbnNpdGlvbk1vZGVsX3NldERlZmF1bHRWYWx1ZXMoKSB7XG4gICAgICAgICAgICBpZiAodmFsdWVzKSB7XG4gICAgICAgICAgICAgIHRyYW5zaXRpb25FbGVtZW50cy5tb2RlbC5zZXRWYWx1ZXModmFsdWVzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh3aXRob3V0SW50ZXJmYWNlID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgIHRyYW5zaXRpb25FbGVtZW50cy5tb2RlbFxuICAgICAgICAgICAgICAgIC5fbG9hZERvY3VtZW50KHRyYW5zaXRpb25FbGVtZW50cy5tb2RlbClcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiBkb2N1bWVudENvbnRyb2xsZXJfVHJhbnNpdGlvblNhdmUoKSB7XG4gICAgICAgICAgICAgICAgICB0cmFuc2l0aW9uRWxlbWVudHMubW9kZWwuc2F2ZShcbiAgICAgICAgICAgICAgICAgICAge30sXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiB0cmFuc2l0aW9uTW9kZWxfYWZ0ZXJTYXZlKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNpdGlvbkVsZW1lbnRzLm1vZGVsLnRyaWdnZXIoXCJzdWNjZXNzXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50UHJvcGVydGllczogZG9jdW1lbnRTZXJ2ZXJQcm9wZXJ0aWVzXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbiB0cmFuc2l0aW9uTW9kZWxfZXJyb3IoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3Qoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudFByb3BlcnRpZXM6IGRvY3VtZW50U2VydmVyUHJvcGVydGllc1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIHRyYW5zaXRpb25Nb2RlbF9lcnJvcigpIHtcbiAgICAgICAgICAgICAgICAgIHJlamVjdCh7IGRvY3VtZW50UHJvcGVydGllczogZG9jdW1lbnRTZXJ2ZXJQcm9wZXJ0aWVzIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgdHJhbnNpdGlvbkVsZW1lbnRzLm1vZGVsXG4gICAgICAgICAgICAgICAgLl9sb2FkRG9jdW1lbnQodHJhbnNpdGlvbkVsZW1lbnRzLm1vZGVsKVxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIGRvY3VtZW50Q29udHJvbGxlcl9UcmFuc2l0aW9uRGlzcGxheSgpIHtcbiAgICAgICAgICAgICAgICAgIHRyYW5zaXRpb25FbGVtZW50cy5tb2RlbC50cmlnZ2VyKFwiZGR1aURvY3VtZW50UmVhZHlcIik7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gdHJhbnNpdGlvbk1vZGVsX2Vycm9yKCkge1xuICAgICAgICAgICAgICAgICAgcmVqZWN0KHsgZG9jdW1lbnRQcm9wZXJ0aWVzOiBkb2N1bWVudFNlcnZlclByb3BlcnRpZXMgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gdHJhbnNpdGlvbk1vZGVsX2Vycm9yKHRoZU1vZGVsLCByZXNwb25zZSwgb3B0aW9ucykge1xuICAgICAgICAgICAgdmFyIGVycm9yVHh0ID0geyB0aXRsZTogXCJUcmFuc2l0aW9uIEVycm9yXCIgfTtcbiAgICAgICAgICAgIGlmIChvcHRpb25zICYmIG9wdGlvbnMuZXJyb3JUaHJvd24pIHtcbiAgICAgICAgICAgICAgZXJyb3JUeHQubWVzc2FnZSA9IG9wdGlvbnMuZXJyb3JUaHJvd247XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjdXJyZW50V2lkZ2V0LiRub3RpZmljYXRpb24uZGNwTm90aWZpY2F0aW9uKFwic2hvd0Vycm9yXCIsIGVycm9yVHh0KTtcbiAgICAgICAgICAgIHRyYW5zaXRpb25FbGVtZW50cy5tb2RlbC50cmlnZ2VyKFwic2hvd0Vycm9yXCIsIGVycm9yVHh0KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEdldCBhIGJhY2tib25lIG1vZGVsIG9mIGFuIGF0dHJpYnV0ZVxuICAgICAqXG4gICAgICogQHBhcmFtIGF0dHJpYnV0ZUlkXG4gICAgICogQHJldHVybnMgeyp9XG4gICAgICovXG4gICAgX2dldEF0dHJpYnV0ZU1vZGVsOiBmdW5jdGlvbiBkb2N1bWVudENvbnRyb2xsZXJfZ2V0QXR0cmlidXRlTW9kZWwoXG4gICAgICBhdHRyaWJ1dGVJZFxuICAgICkge1xuICAgICAgdmFyIGF0dHJpYnV0ZXMgPSB0aGlzLl9tb2RlbC5nZXQoXCJhdHRyaWJ1dGVzXCIpO1xuICAgICAgdmFyIGF0dHJpYnV0ZTtcbiAgICAgIGlmICghYXR0cmlidXRlcykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgJ0F0dHJpYnV0ZSBtb2RlbHMgbm90IGluaXRpYWxpemVkIHlldCA6IFRoZSBhdHRyaWJ1dGUgXCInICtcbiAgICAgICAgICAgIGF0dHJpYnV0ZUlkICtcbiAgICAgICAgICAgICdcIiBjYW5ub3QgYmUgZm91bmQuJ1xuICAgICAgICApO1xuICAgICAgfVxuICAgICAgYXR0cmlidXRlID0gdGhpcy5fbW9kZWwuZ2V0KFwiYXR0cmlidXRlc1wiKS5nZXQoYXR0cmlidXRlSWQpO1xuICAgICAgaWYgKCFhdHRyaWJ1dGUpIHtcbiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgIH1cbiAgICAgIHJldHVybiBhdHRyaWJ1dGU7XG4gICAgfSxcblxuICAgIF9nZXRNZW51TW9kZWw6IGZ1bmN0aW9uIGRvY3VtZW50Q29udHJvbGxlcl9nZXRNZW51TW9kZWwobWVudUlkKSB7XG4gICAgICB2YXIgbWVudXMgPSB0aGlzLl9tb2RlbC5nZXQoXCJtZW51c1wiKTtcblxuICAgICAgdmFyIG1lbnUgPSBtZW51cy5nZXQobWVudUlkKTtcbiAgICAgIGlmICghbWVudSAmJiBtZW51cykge1xuICAgICAgICBtZW51cy5lYWNoKGZ1bmN0aW9uIGRvY3VtZW50Q29udHJvbGxlckdldE1lbnVJdGVyYXRlKGl0ZW1NZW51KSB7XG4gICAgICAgICAgaWYgKGl0ZW1NZW51LmdldChcImNvbnRlbnRcIikpIHtcbiAgICAgICAgICAgIF8uZWFjaChcbiAgICAgICAgICAgICAgaXRlbU1lbnUuZ2V0KFwiY29udGVudFwiKSxcbiAgICAgICAgICAgICAgZnVuY3Rpb24gZG9jdW1lbnRDb250cm9sbGVyR2V0U3ViTWVudUl0ZXJhdGUoc3ViTWVudSkge1xuICAgICAgICAgICAgICAgIGlmIChzdWJNZW51LmlkID09PSBtZW51SWQpIHtcbiAgICAgICAgICAgICAgICAgIG1lbnUgPSBuZXcgTWVudU1vZGVsKHN1Yk1lbnUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgcmV0dXJuIG1lbnU7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEdldCBhbGwgcmVuZGVyZWQgYXR0cmlidXRlcyB3aXRoIHRoZWlyIHJvb3QgZG9tIG5vZGVcbiAgICAgKlxuICAgICAqIEByZXR1cm5zIHsqfVxuICAgICAqL1xuICAgIF9nZXRSZW5kZXJlZEF0dHJpYnV0ZXM6IGZ1bmN0aW9uIGRvY3VtZW50Q29udHJvbGxlcl9nZXRSZW5kZXJlZEF0dHJpYnV0ZXMoKSB7XG4gICAgICByZXR1cm4gdGhpcy5fbW9kZWxcbiAgICAgICAgLmdldChcImF0dHJpYnV0ZXNcIilcbiAgICAgICAgLmNoYWluKClcbiAgICAgICAgLm1hcChmdW5jdGlvbiBkb2N1bWVudENvbnRyb2xsZXJfZ2V0UmVuZGVyZWRBdHRyaWJ1dGUoXG4gICAgICAgICAgY3VycmVudEF0dHJpYnV0ZVxuICAgICAgICApIHtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdmlldzogY3VycmVudEF0dHJpYnV0ZS5oYXZlVmlldygpLFxuICAgICAgICAgICAgaWQ6IGN1cnJlbnRBdHRyaWJ1dGUuaWRcbiAgICAgICAgICB9O1xuICAgICAgICB9KVxuICAgICAgICAuZmlsdGVyKGZ1bmN0aW9uIGRvY3VtZW50Q29udHJvbGxlcl9zdXBwcmVzc05vVmlldyhjdXJyZW50QXR0cmlidXQpIHtcbiAgICAgICAgICByZXR1cm4gY3VycmVudEF0dHJpYnV0LnZpZXcuaGF2ZVZpZXc7XG4gICAgICAgIH0pXG4gICAgICAgIC52YWx1ZSgpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBHZXQgbWF4IGluZGV4IG9mIGFuIGFycmF5XG4gICAgICpcbiAgICAgKiBAcGFyYW0gYXR0cmlidXRlQXJyYXlcbiAgICAgKiBAcmV0dXJucyB7Kn1cbiAgICAgKi9cbiAgICBfZ2V0TWF4SW5kZXg6IGZ1bmN0aW9uIGRvY3VtZW50Q29udHJvbGxlcl9nZXRNYXhJbmRleChhdHRyaWJ1dGVBcnJheSkge1xuICAgICAgcmV0dXJuIF8uc2l6ZShcbiAgICAgICAgYXR0cmlidXRlQXJyYXlcbiAgICAgICAgICAuZ2V0KFwiY29udGVudFwiKVxuICAgICAgICAgIC5tYXgoZnVuY3Rpb24gZG9jdW1lbnRDb250cm9sbGVyX2dldE1heChjdXJyZW50QXR0cikge1xuICAgICAgICAgICAgcmV0dXJuIF8uc2l6ZShjdXJyZW50QXR0ci5nZXQoXCJhdHRyaWJ1dGVWYWx1ZVwiKSk7XG4gICAgICAgICAgfSlcbiAgICAgICAgICAuZ2V0KFwiYXR0cmlidXRlVmFsdWVcIilcbiAgICAgICk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEFjdGl2YXRlIGNvbnN0cmFpbnQgb24gdGhlIGN1cnJlbnQgZG9jdW1lbnRcbiAgICAgKiBVc2VkIG9uIHRoZSBmZXRjaCBvZiBhIG5ldyBkb2N1bWVudFxuICAgICAqXG4gICAgICovXG4gICAgX2luaXRBY3RpdmF0ZWRDb25zdHJhaW50OiBmdW5jdGlvbiBkb2N1bWVudENvbnRyb2xsZXJfaW5pdEFjdGl2YXRlZENvbnN0cmFpbnQoKSB7XG4gICAgICB2YXIgY3VycmVudERvY3VtZW50UHJvcGVydGllcyA9IHRoaXMuZ2V0UHJvcGVydGllcygpLFxuICAgICAgICBjdXJyZW50V2lkZ2V0ID0gdGhpcztcbiAgICAgIHRoaXMuYWN0aXZhdGVkQ29uc3RyYWludCA9IHt9O1xuICAgICAgXy5lYWNoKFxuICAgICAgICB0aGlzLm9wdGlvbnMuY29uc3RyYWludExpc3QsXG4gICAgICAgIGZ1bmN0aW9uIGRvY3VtZW50Q29udHJvbGxlcl9nZXRBY3RpdmF0ZWRDb25zdHJhaW50KGN1cnJlbnRDb25zdHJhaW50KSB7XG4gICAgICAgICAgaWYgKFxuICAgICAgICAgICAgY3VycmVudENvbnN0cmFpbnQuZG9jdW1lbnRDaGVjay5jYWxsKFxuICAgICAgICAgICAgICAkKGN1cnJlbnRXaWRnZXQuZWxlbWVudCksXG4gICAgICAgICAgICAgIGN1cnJlbnREb2N1bWVudFByb3BlcnRpZXNcbiAgICAgICAgICAgIClcbiAgICAgICAgICApIHtcbiAgICAgICAgICAgIGN1cnJlbnRXaWRnZXQuYWN0aXZhdGVkQ29uc3RyYWludFtcbiAgICAgICAgICAgICAgY3VycmVudENvbnN0cmFpbnQubmFtZVxuICAgICAgICAgICAgXSA9IGN1cnJlbnRDb25zdHJhaW50O1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQWN0aXZhdGUgZXZlbnRzIG9uIHRoZSBjdXJyZW50IGRvY3VtZW50XG4gICAgICogVXNlZCBvbiB0aGUgZmV0Y2ggb2YgYSBuZXcgZG9jdW1lbnRcbiAgICAgKi9cbiAgICBfaW5pdEFjdGl2YXRlZEV2ZW50TGlzdGVuZXJzOiBmdW5jdGlvbiBkb2N1bWVudENvbnRyb2xsZXJfaW5pdEFjdGl2YXRlZEV2ZW50cyhcbiAgICAgIG9wdGlvbnNcbiAgICApIHtcbiAgICAgIHZhciBjdXJyZW50RG9jdW1lbnRQcm9wZXJ0aWVzID0gdGhpcy5nZXRQcm9wZXJ0aWVzKCksXG4gICAgICAgIGN1cnJlbnRXaWRnZXQgPSB0aGlzO1xuICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG4gICAgICB0aGlzLmFjdGl2YXRlZEV2ZW50TGlzdGVuZXIgPSB7fTtcbiAgICAgIF8uZWFjaChcbiAgICAgICAgdGhpcy5vcHRpb25zLmV2ZW50TGlzdGVuZXIsXG4gICAgICAgIGZ1bmN0aW9uIGRvY3VtZW50Q29udHJvbGxlcl9nZXRBY3RpdmF0ZWRFdmVudChjdXJyZW50RXZlbnQpIHtcbiAgICAgICAgICBpZiAoIV8uaXNGdW5jdGlvbihjdXJyZW50RXZlbnQuZG9jdW1lbnRDaGVjaykpIHtcbiAgICAgICAgICAgIGN1cnJlbnRXaWRnZXQuYWN0aXZhdGVkRXZlbnRMaXN0ZW5lcltcbiAgICAgICAgICAgICAgY3VycmVudEV2ZW50Lm5hbWVcbiAgICAgICAgICAgIF0gPSBjdXJyZW50RXZlbnQ7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChcbiAgICAgICAgICAgIGN1cnJlbnRFdmVudC5kb2N1bWVudENoZWNrLmNhbGwoXG4gICAgICAgICAgICAgICQoY3VycmVudFdpZGdldC5lbGVtZW50KSxcbiAgICAgICAgICAgICAgY3VycmVudERvY3VtZW50UHJvcGVydGllc1xuICAgICAgICAgICAgKVxuICAgICAgICAgICkge1xuICAgICAgICAgICAgY3VycmVudFdpZGdldC5hY3RpdmF0ZWRFdmVudExpc3RlbmVyW1xuICAgICAgICAgICAgICBjdXJyZW50RXZlbnQubmFtZVxuICAgICAgICAgICAgXSA9IGN1cnJlbnRFdmVudDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgICAvL1RyaWdnZXIgbmV3IGFkZGVkIHJlYWR5IGV2ZW50XG4gICAgICBpZiAodGhpcy5faW5pdGlhbGl6ZWRWaWV3ICE9PSBmYWxzZSAmJiBvcHRpb25zLmxhdW5jaFJlYWR5ICE9PSBmYWxzZSkge1xuICAgICAgICB0aGlzLl90cmlnZ2VyQ29udHJvbGxlckV2ZW50KFwicmVhZHlcIiwgbnVsbCwgY3VycmVudERvY3VtZW50UHJvcGVydGllcyk7XG4gICAgICAgIF8uZWFjaChcbiAgICAgICAgICB0aGlzLl9nZXRSZW5kZXJlZEF0dHJpYnV0ZXMoKSxcbiAgICAgICAgICBmdW5jdGlvbiBkb2N1bWVudENvbnRyb2xsZXJfdHJpZ2dlclJlbmRlcmVkQXR0cmlidXRlcyhcbiAgICAgICAgICAgIGN1cnJlbnRBdHRyaWJ1dGVcbiAgICAgICAgICApIHtcbiAgICAgICAgICAgIHZhciBvYmplY3RBdHRyaWJ1dGUgPSBjdXJyZW50V2lkZ2V0LmdldEF0dHJpYnV0ZShcbiAgICAgICAgICAgICAgY3VycmVudEF0dHJpYnV0ZS5pZFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIGN1cnJlbnRXaWRnZXQuX3RyaWdnZXJBdHRyaWJ1dGVDb250cm9sbGVyRXZlbnQoXG4gICAgICAgICAgICAgIFwiYXR0cmlidXRlUmVhZHlcIixcbiAgICAgICAgICAgICAgbnVsbCxcbiAgICAgICAgICAgICAgY3VycmVudEF0dHJpYnV0ZSxcbiAgICAgICAgICAgICAgY3VycmVudERvY3VtZW50UHJvcGVydGllcyxcbiAgICAgICAgICAgICAgb2JqZWN0QXR0cmlidXRlLFxuICAgICAgICAgICAgICBjdXJyZW50QXR0cmlidXRlLnZpZXcuZWxlbWVudHNcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICApO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBBZGQgbmV3IGV2ZW50IGFuZCBhdXRvdHJpZ2dlciBhbHJlYWR5IGRvbmUgZXZlbnQgZm9yIHJlYWR5XG4gICAgICpcbiAgICAgKiBAcGFyYW0gbmV3RXZlbnRcbiAgICAgKi9cbiAgICBfYWRkQW5kSW5pdE5ld0V2ZW50czogZnVuY3Rpb24gZG9jdW1lbnRDb250cm9sbGVyX2FkZEFuZEluaXROZXdFdmVudHMoXG4gICAgICBuZXdFdmVudFxuICAgICkge1xuICAgICAgdmFyIGN1cnJlbnREb2N1bWVudFByb3BlcnRpZXMsXG4gICAgICAgIGN1cnJlbnRXaWRnZXQgPSB0aGlzLFxuICAgICAgICBldmVudCxcbiAgICAgICAgdW5pcXVlTmFtZSxcbiAgICAgICAgJGVsZW1lbnQgPSAkKGN1cnJlbnRXaWRnZXQuZWxlbWVudCk7XG4gICAgICB1bmlxdWVOYW1lID1cbiAgICAgICAgKG5ld0V2ZW50LmV4dGVybmFsRXZlbnQgPyBcImV4dGVybmFsX1wiIDogXCJpbnRlcm5hbF9cIikgKyBuZXdFdmVudC5uYW1lO1xuICAgICAgdGhpcy5vcHRpb25zLmV2ZW50TGlzdGVuZXJbdW5pcXVlTmFtZV0gPSBuZXdFdmVudDtcblxuICAgICAgaWYgKCF0aGlzLl9pbml0aWFsaXplZE1vZGVsKSB7XG4gICAgICAgIC8vZWFybHkgZXZlbnQgbW9kZWwgaXMgbm90IHJlYWR5IChubyB0cmlnZ2VyLCBvciBjdXJyZW50IHJlZ2lzdGVyIHBvc3NpYmxlKVxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgIH1cbiAgICAgIGN1cnJlbnREb2N1bWVudFByb3BlcnRpZXMgPSB0aGlzLmdldFByb3BlcnRpZXMoKTtcbiAgICAgIC8vIENoZWNrIGlmIHRoZSBldmVudCBpcyBmb3IgdGhlIGN1cnJlbnQgZG9jdW1lbnRcbiAgICAgIGlmIChcbiAgICAgICAgIV8uaXNGdW5jdGlvbihuZXdFdmVudC5kb2N1bWVudENoZWNrKSB8fFxuICAgICAgICBuZXdFdmVudC5kb2N1bWVudENoZWNrLmNhbGwoJGVsZW1lbnQsIGN1cnJlbnREb2N1bWVudFByb3BlcnRpZXMpXG4gICAgICApIHtcbiAgICAgICAgdGhpcy5hY3RpdmF0ZWRFdmVudExpc3RlbmVyW25ld0V2ZW50Lm5hbWVdID0gbmV3RXZlbnQ7XG4gICAgICAgIC8vIENoZWNrIGlmIHdlIG5lZWQgdG8gbWFudWFsbHkgdHJpZ2dlciB0aGlzIGNhbGxiYWNrIChsYXRlIHJlZ2lzdGVyZWQgOiBvbmx5IGZvciByZWFkeSBldmVudHMpXG4gICAgICAgIGlmICh0aGlzLl9pbml0aWFsaXplZFZpZXcgIT09IGZhbHNlKSB7XG4gICAgICAgICAgaWYgKG5ld0V2ZW50LmV2ZW50VHlwZSA9PT0gXCJyZWFkeVwiKSB7XG4gICAgICAgICAgICBldmVudCA9ICQuRXZlbnQobmV3RXZlbnQuZXZlbnRUeXBlKTtcbiAgICAgICAgICAgIGV2ZW50LnRhcmdldCA9IGN1cnJlbnRXaWRnZXQuZWxlbWVudDtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgIC8vIGFkZCBlbGVtZW50IGFzIGZ1bmN0aW9uIGNvbnRleHRcbiAgICAgICAgICAgICAgbmV3RXZlbnQuZXZlbnRDYWxsYmFjay5jYWxsKFxuICAgICAgICAgICAgICAgICRlbGVtZW50LFxuICAgICAgICAgICAgICAgIGV2ZW50LFxuICAgICAgICAgICAgICAgIGN1cnJlbnREb2N1bWVudFByb3BlcnRpZXNcbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKG5ld0V2ZW50LmV2ZW50VHlwZSA9PT0gXCJhdHRyaWJ1dGVSZWFkeVwiKSB7XG4gICAgICAgICAgICBldmVudCA9ICQuRXZlbnQobmV3RXZlbnQuZXZlbnRUeXBlKTtcbiAgICAgICAgICAgIGV2ZW50LnRhcmdldCA9IGN1cnJlbnRXaWRnZXQuZWxlbWVudDtcbiAgICAgICAgICAgIF8uZWFjaChcbiAgICAgICAgICAgICAgdGhpcy5fZ2V0UmVuZGVyZWRBdHRyaWJ1dGVzKCksXG4gICAgICAgICAgICAgIGZ1bmN0aW9uIGRvY3VtZW50Q29udHJvbGxlcl90cmlnZ2VyUmVuZGVyZWRBdHRyaWJ1dGVzKFxuICAgICAgICAgICAgICAgIGN1cnJlbnRBdHRyaWJ1dGVcbiAgICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgdmFyIG9iamVjdEF0dHJpYnV0ZSA9IGN1cnJlbnRXaWRnZXQuZ2V0QXR0cmlidXRlKFxuICAgICAgICAgICAgICAgICAgY3VycmVudEF0dHJpYnV0ZS5pZFxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICAgICAgIV8uaXNGdW5jdGlvbihuZXdFdmVudC5hdHRyaWJ1dGVDaGVjaykgfHxcbiAgICAgICAgICAgICAgICAgIG5ld0V2ZW50LmF0dHJpYnV0ZUNoZWNrLmFwcGx5KCRlbGVtZW50LCBbb2JqZWN0QXR0cmlidXRlXSlcbiAgICAgICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGFkZCBlbGVtZW50IGFzIGZ1bmN0aW9uIGNvbnRleHRcbiAgICAgICAgICAgICAgICAgICAgbmV3RXZlbnQuZXZlbnRDYWxsYmFjay5jYWxsKFxuICAgICAgICAgICAgICAgICAgICAgICRlbGVtZW50LFxuICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LFxuICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnREb2N1bWVudFByb3BlcnRpZXMsXG4gICAgICAgICAgICAgICAgICAgICAgb2JqZWN0QXR0cmlidXRlLFxuICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRBdHRyaWJ1dGUudmlldy5lbGVtZW50c1xuICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGUpO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogVHJpZ2dlciBhdHRyaWJ1dGUgZXZlbnRcbiAgICAgKlxuICAgICAqIFNpbWlsYXIgYXQgdHJpZ2dlciBkb2N1bWVudCBldmVudCB3aXRoIGEgY29uc3RyYWludCBvbiBhdHRyaWJ1dGVcbiAgICAgKlxuICAgICAqIEBwYXJhbSBldmVudE5hbWVcbiAgICAgKiBAcGFyYW0gb3JpZ2luYWxFdmVudFxuICAgICAqIEBwYXJhbSBhdHRyaWJ1dGVJbnRlcm5hbEVsZW1lbnRcbiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn1cbiAgICAgKi9cbiAgICBfdHJpZ2dlckF0dHJpYnV0ZUNvbnRyb2xsZXJFdmVudDogZnVuY3Rpb24gZG9jdW1lbnRDb250cm9sbGVyX3RyaWdnZXJBdHRyaWJ1dGVDb250cm9sbGVyRXZlbnQoXG4gICAgICBldmVudE5hbWUsXG4gICAgICBvcmlnaW5hbEV2ZW50LFxuICAgICAgYXR0cmlidXRlSW50ZXJuYWxFbGVtZW50XG4gICAgKSB7XG4gICAgICB2YXIgY3VycmVudFdpZGdldCA9IHRoaXMsXG4gICAgICAgIGFyZ3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDMpLFxuICAgICAgICBldmVudCA9ICQuRXZlbnQoZXZlbnROYW1lKSxcbiAgICAgICAgZXh0ZXJuYWxFdmVudEFyZ3VtZW50LFxuICAgICAgICAkZWxlbWVudCA9ICQoY3VycmVudFdpZGdldC5lbGVtZW50KTtcbiAgICAgIGV2ZW50LnRhcmdldCA9IGN1cnJlbnRXaWRnZXQuZWxlbWVudDtcbiAgICAgIC8vIGludGVybmFsIGV2ZW50IHRyaWdnZXJcbiAgICAgIGlmIChvcmlnaW5hbEV2ZW50ICYmIG9yaWdpbmFsRXZlbnQucHJldmVudERlZmF1bHQpIHtcbiAgICAgICAgZXZlbnQub3JpZ2luYWxFdmVudCA9IG9yaWdpbmFsRXZlbnQ7XG4gICAgICB9XG4gICAgICBhcmdzLnVuc2hpZnQoZXZlbnQpO1xuICAgICAgXy5jaGFpbih0aGlzLmFjdGl2YXRlZEV2ZW50TGlzdGVuZXIpXG4gICAgICAgIC5maWx0ZXIoZnVuY3Rpb24gZG9jdW1lbnRDb250cm9sbGVyX19maWx0ZXJVc2FibGVFdmVudHMoY3VycmVudEV2ZW50KSB7XG4gICAgICAgICAgLy8gQ2hlY2sgYnkgZXZlbnRUeXBlIChvbmx5IGNhbGwgY2FsbGJhY2sgd2l0aCBnb29kIGV2ZW50VHlwZSlcbiAgICAgICAgICBpZiAoY3VycmVudEV2ZW50LmV2ZW50VHlwZSA9PT0gZXZlbnROYW1lKSB7XG4gICAgICAgICAgICAvL0NoZWNrIHdpdGggYXR0cmlidXRlQ2hlY2sgaWYgdGhlIGZ1bmN0aW9uIGV4aXN0XG4gICAgICAgICAgICBpZiAoIV8uaXNGdW5jdGlvbihjdXJyZW50RXZlbnQuYXR0cmlidXRlQ2hlY2spKSB7XG4gICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGN1cnJlbnRFdmVudC5hdHRyaWJ1dGVDaGVjay5hcHBseSgkZWxlbWVudCwgW1xuICAgICAgICAgICAgICBhdHRyaWJ1dGVJbnRlcm5hbEVsZW1lbnQsXG4gICAgICAgICAgICAgIGN1cnJlbnRXaWRnZXQuZ2V0UHJvcGVydGllcygpXG4gICAgICAgICAgICBdKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9KVxuICAgICAgICAuZWFjaChmdW5jdGlvbiBkb2N1bWVudENvbnRyb2xsZXJfYXBwbHlDYWxsQmFjayhjdXJyZW50RXZlbnQpIHtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgY3VycmVudEV2ZW50LmV2ZW50Q2FsbGJhY2suYXBwbHkoJGVsZW1lbnQsIGFyZ3MpO1xuICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIGlmICh3aW5kb3cuZGNwICYmIHdpbmRvdy5kY3AubG9nZ2VyKSB7XG4gICAgICAgICAgICAgIHdpbmRvdy5kY3AubG9nZ2VyKGUpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgZXh0ZXJuYWxFdmVudEFyZ3VtZW50ID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAwKTtcbiAgICAgIGV4dGVybmFsRXZlbnRBcmd1bWVudC5zcGxpY2UoMSwgMSk7XG4gICAgICBjdXJyZW50V2lkZ2V0Ll90cmlnZ2VyRXh0ZXJuYWxFdmVudC5hcHBseShcbiAgICAgICAgY3VycmVudFdpZGdldCxcbiAgICAgICAgZXh0ZXJuYWxFdmVudEFyZ3VtZW50XG4gICAgICApO1xuICAgICAgcmV0dXJuICFldmVudC5pc0RlZmF1bHRQcmV2ZW50ZWQoKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogVHJpZ2dlciBhIGNvbnRyb2xsZXIgZXZlbnRcbiAgICAgKiBUaGF0IGtpbmQgb2YgZXZlbnQgYXJlIG9ubHkgZm9yIHRoaXMgd2lkZ2V0XG4gICAgICpcbiAgICAgKiBAcGFyYW0gZXZlbnROYW1lXG4gICAgICogQHBhcmFtIG9yaWdpbmFsRXZlbnRcbiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn1cbiAgICAgKi9cbiAgICBfdHJpZ2dlckNvbnRyb2xsZXJFdmVudDogZnVuY3Rpb24gZG9jdW1lbnRDb250cm9sbGVyX3RyaWdnZXJDb250cm9sbGVyRXZlbnQoXG4gICAgICBldmVudE5hbWUsXG4gICAgICBvcmlnaW5hbEV2ZW50XG4gICAgKSB7XG4gICAgICB2YXIgY3VycmVudFdpZGdldCA9IHRoaXMsXG4gICAgICAgIGFyZ3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDIpLFxuICAgICAgICBldmVudCA9ICQuRXZlbnQoZXZlbnROYW1lKTtcbiAgICAgIGV2ZW50LnRhcmdldCA9IGN1cnJlbnRXaWRnZXQuZWxlbWVudDtcbiAgICAgIGlmIChvcmlnaW5hbEV2ZW50ICYmIG9yaWdpbmFsRXZlbnQucHJldmVudERlZmF1bHQpIHtcbiAgICAgICAgZXZlbnQub3JpZ2luYWxFdmVudCA9IG9yaWdpbmFsRXZlbnQ7XG4gICAgICB9XG4gICAgICAvLyBpbnRlcm5hbCBldmVudCB0cmlnZ2VyXG4gICAgICBhcmdzLnVuc2hpZnQoZXZlbnQpO1xuICAgICAgXy5jaGFpbih0aGlzLmFjdGl2YXRlZEV2ZW50TGlzdGVuZXIpXG4gICAgICAgIC5maWx0ZXIoZnVuY3Rpb24gZG9jdW1lbnRDb250cm9sbGVyX2dldEV2ZW50TmFtZShjdXJyZW50RXZlbnQpIHtcbiAgICAgICAgICByZXR1cm4gY3VycmVudEV2ZW50LmV2ZW50VHlwZSA9PT0gZXZlbnROYW1lO1xuICAgICAgICB9KVxuICAgICAgICAuZWFjaChmdW5jdGlvbiBkb2N1bWVudENvbnRyb2xsZXJfdHJpZ2dlckFuRXZlbnQoY3VycmVudEV2ZW50KSB7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGN1cnJlbnRFdmVudC5ldmVudENhbGxiYWNrLmFwcGx5KCQoY3VycmVudFdpZGdldC5lbGVtZW50KSwgYXJncyk7XG4gICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgaWYgKHdpbmRvdy5kY3AubG9nZ2VyKSB7XG4gICAgICAgICAgICAgIHdpbmRvdy5kY3AubG9nZ2VyKGUpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgY3VycmVudFdpZGdldC5fdHJpZ2dlckV4dGVybmFsRXZlbnQuYXBwbHkoY3VycmVudFdpZGdldCwgYXJndW1lbnRzKTtcbiAgICAgIHJldHVybiAhZXZlbnQuaXNEZWZhdWx0UHJldmVudGVkKCk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIFRyaWdnZXIgZXZlbnQgYXMgalF1ZXJ5IHN0YW5kYXJkIGV2ZW50cyAoYWxsIGV2ZW50cyBhcmUgcHJlZml4ZWQgYnkgZG9jdW1lbnQpXG4gICAgICpcbiAgICAgKiBAcGFyYW0gdHlwZVxuICAgICAqL1xuICAgIF90cmlnZ2VyRXh0ZXJuYWxFdmVudDogZnVuY3Rpb24gZG9jdW1lbnRDb250cm9sbGVyX3RyaWdnZXJFeHRlcm5hbEV2ZW50KFxuICAgICAgdHlwZVxuICAgICkge1xuICAgICAgdmFyIGN1cnJlbnRXaWRnZXQgPSB0aGlzLFxuICAgICAgICBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSxcbiAgICAgICAgZXZlbnQgPSAkLkV2ZW50KHR5cGUpO1xuICAgICAgLy9wcmVwYXJlIGFyZ3VtZW50IGZvciB3aWRnZXQgZXZlbnQgdHJpZ2dlciAod2Ugd2FudCB0eXBlLCBldmVudCwgZGF0YSlcbiAgICAgIC8vIGFkZCB0aGUgZXZlbnRPYmplY3RcbiAgICAgIGFyZ3MudW5zaGlmdChldmVudCk7XG4gICAgICAvLyBhZGQgdGhlIHR5cGVcbiAgICAgIGFyZ3MudW5zaGlmdCh0eXBlKTtcbiAgICAgIC8vIGNvbmNhdGVuYXRlIG90aGVyIGFyZ3VtZW50IGluIG9uZSBlbGVtZW50ICh0byByZXNwZWN0IHdpZGdldCBwYXR0ZXJuKVxuICAgICAgYXJnc1syXSA9IGFyZ3Muc2xpY2UoMik7XG4gICAgICAvLyBzdXBwcmVzcyBvdGhlciBhcmd1bWVudHMgKHNpbmNlIHRoZXkgaGF2ZSBiZWVuIGNvbmNhdGVuZWQpXG4gICAgICBhcmdzID0gYXJncy5zbGljZSgwLCAzKTtcbiAgICAgIC8vdHJpZ2dlciBleHRlcm5hbCBldmVudFxuICAgICAgY3VycmVudFdpZGdldC5fdHJpZ2dlci5hcHBseShjdXJyZW50V2lkZ2V0LCBhcmdzKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQ2hlY2sgaWYgZXZlbnQgbmFtZSBpcyB2YWxpZFxuICAgICAqXG4gICAgICogQHBhcmFtIGV2ZW50TmFtZSBzdHJpbmdcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9jaGVja0V2ZW50TmFtZTogZnVuY3Rpb24gZG9jdW1lbnRDb250cm9sbGVyX2NoZWNrRXZlbnROYW1lKGV2ZW50TmFtZSkge1xuICAgICAgaWYgKFxuICAgICAgICBfLmlzU3RyaW5nKGV2ZW50TmFtZSkgJiZcbiAgICAgICAgKGV2ZW50TmFtZS5pbmRleE9mKFwiY3VzdG9tOlwiKSA9PT0gMCB8fFxuICAgICAgICAgIF8uZmluZChldmVudExpc3QsIGZ1bmN0aW9uIGRvY3VtZW50Q29udHJvbGxlcl9DaGVja0V2ZW50VHlwZShcbiAgICAgICAgICAgIGN1cnJlbnRFdmVudFR5cGVcbiAgICAgICAgICApIHtcbiAgICAgICAgICAgIHJldHVybiBjdXJyZW50RXZlbnRUeXBlID09PSBldmVudE5hbWU7XG4gICAgICAgICAgfSkpXG4gICAgICApIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgIFwiVGhlIGV2ZW50IHR5cGUgXCIgK1xuICAgICAgICAgIGV2ZW50TmFtZSArXG4gICAgICAgICAgXCIgaXMgbm90IGtub3duLiBJdCBtdXN0IGJlIG9uZSBvZiBcIiArXG4gICAgICAgICAgZXZlbnRMaXN0LnNvcnQoKS5qb2luKFwiICxcIilcbiAgICAgICk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIENoZWNrIGlmIHRoZSB2aWV3IGlzIGluaXRpYWxpemVkXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9jaGVja0luaXRpYWxpc2VkVmlldzogZnVuY3Rpb24gZG9jdW1lbnRDb250cm9sbGVyX2NoZWNrSW5pdGlhbGlzZWQoKSB7XG4gICAgICBpZiAoIXRoaXMuX2luaXRpYWxpemVkVmlldykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3JNb2RlbE5vbkluaXRpYWxpemVkKFxuICAgICAgICAgIFwiVGhlIHdpZGdldCB2aWV3IGlzIG5vdCBpbml0aWFsaXplZCwgdXNlIGZldGNoRG9jdW1lbnQgdG8gaW5pdGlhbGlzZSBpdC5cIlxuICAgICAgICApO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBDaGVjayBpZiB0aGUgbW9kZWwgaXMgaW5pdGlhbGl6ZWRcbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX2NoZWNrSW5pdGlhbGlzZWRNb2RlbDogZnVuY3Rpb24gZG9jdW1lbnRDb250cm9sbGVyX2NoZWNrSW5pdGlhbGlzZWRNb2RlbCgpIHtcbiAgICAgIGlmICghdGhpcy5faW5pdGlhbGl6ZWRNb2RlbCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3JNb2RlbE5vbkluaXRpYWxpemVkKCk7XG4gICAgICB9XG4gICAgfSxcblxuICAgIF9yZWdpc3Rlck91dHB1dFByb21pc2U6IGZ1bmN0aW9uIGRvY3VtZW50Q29udHJvbGxlcl9yZWdpc3Rlck91dHB1dFByb21pc2UoXG4gICAgICBkb2N1bWVudFByb21pc2UsXG4gICAgICBvcHRpb25zXG4gICAgKSB7XG4gICAgICB2YXIgY3VycmVudFdpZGdldCA9IHRoaXM7XG4gICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gZG9jdW1lbnRDb250cm9sbGVyX3JlaW5pdFByb21pc2UoXG4gICAgICAgIHJlc29sdmUsXG4gICAgICAgIHJlamVjdFxuICAgICAgKSB7XG4gICAgICAgIGRvY3VtZW50UHJvbWlzZS50aGVuKFxuICAgICAgICAgIGZ1bmN0aW9uIGRvY3VtZW50Q29udHJvbGxlcl9yZWluaXREb25lKHZhbHVlcykge1xuICAgICAgICAgICAgaWYgKG9wdGlvbnMgJiYgXy5pc0Z1bmN0aW9uKG9wdGlvbnMuc3VjY2VzcykpIHtcbiAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBpZiAod2luZG93LmNvbnNvbGUud2Fybikge1xuICAgICAgICAgICAgICAgICAgd2luZG93LmNvbnNvbGUud2FybihcbiAgICAgICAgICAgICAgICAgICAgJ0NhbGxiYWNrIFwic3VjY2Vzc1wiIGlzIGRlcHJlY2F0ZWQgdXNlIHByb21pc2UgaW5zdGVhZCdcbiAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIG9wdGlvbnMuc3VjY2Vzcy5jYWxsKFxuICAgICAgICAgICAgICAgICAgJChjdXJyZW50V2lkZ2V0LmVsZW1lbnQpLFxuICAgICAgICAgICAgICAgICAgdmFsdWVzLmRvY3VtZW50UHJvcGVydGllcyB8fCB7fSxcbiAgICAgICAgICAgICAgICAgIGN1cnJlbnRXaWRnZXQuZ2V0UHJvcGVydGllcygpXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgfSBjYXRjaCAoZXhjZXB0aW9uKSB7XG4gICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5kY3AubG9nZ2VyKSB7XG4gICAgICAgICAgICAgICAgICB3aW5kb3cuZGNwLmxvZ2dlcihleGNlcHRpb24pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGV4Y2VwdGlvbik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXNvbHZlKHtcbiAgICAgICAgICAgICAgZWxlbWVudDogJChjdXJyZW50V2lkZ2V0LmVsZW1lbnQpLFxuICAgICAgICAgICAgICBwcmV2aW91c0RvY3VtZW50OiB2YWx1ZXMuZG9jdW1lbnRQcm9wZXJ0aWVzIHx8IHt9LFxuICAgICAgICAgICAgICBuZXh0RG9jdW1lbnQ6IGN1cnJlbnRXaWRnZXQuZ2V0UHJvcGVydGllcygpXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGZ1bmN0aW9uIGRvY3VtZW50Q29udHJvbGxlcl9yZWluaXRGYWlsKHZhbHVlcykge1xuICAgICAgICAgICAgdmFyIGVycm9yQXJndW1lbnRzID0gdmFsdWVzLmFyZ3VtZW50cztcbiAgICAgICAgICAgIHZhciBlcnJvck1lc3NhZ2UgPSB7IGNvbnRlbnRUZXh0OiBcIlVuZGVmaW5lZCBlcnJvclwiIH07XG5cbiAgICAgICAgICAgIGlmICh2YWx1ZXMuYXJndW1lbnRzKSB7XG4gICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICAgICAgZXJyb3JBcmd1bWVudHMgJiZcbiAgICAgICAgICAgICAgICAgIGVycm9yQXJndW1lbnRzWzFdICYmXG4gICAgICAgICAgICAgICAgICBlcnJvckFyZ3VtZW50c1sxXS5yZXNwb25zZUpTT05cbiAgICAgICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICAgIGVycm9yTWVzc2FnZSA9IGVycm9yQXJndW1lbnRzWzFdLnJlc3BvbnNlSlNPTi5tZXNzYWdlc1swXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICAvL25vIGVycm9yIGhlcmVcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgZXJyb3JBcmd1bWVudHMgJiZcbiAgICAgICAgICAgICAgICBlcnJvckFyZ3VtZW50c1swXSAmJlxuICAgICAgICAgICAgICAgIGVycm9yQXJndW1lbnRzWzBdLmV2ZW50UHJldmVudGVkXG4gICAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgIGVycm9yTWVzc2FnZSA9IHsgY29udGVudFRleHQ6IFwiRXZlbnQgcHJldmVudGVkXCIgfTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgZXJyb3JBcmd1bWVudHMgJiZcbiAgICAgICAgICAgICAgICBlcnJvckFyZ3VtZW50c1swXSAmJlxuICAgICAgICAgICAgICAgIGVycm9yQXJndW1lbnRzWzBdLmVycm9yTWVzc2FnZVxuICAgICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICBlcnJvck1lc3NhZ2UgPSBlcnJvckFyZ3VtZW50c1swXS5lcnJvck1lc3NhZ2U7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChvcHRpb25zICYmIF8uaXNGdW5jdGlvbihvcHRpb25zLmVycm9yKSkge1xuICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuY29uc29sZS53YXJuKSB7XG4gICAgICAgICAgICAgICAgICB3aW5kb3cuY29uc29sZS53YXJuKFxuICAgICAgICAgICAgICAgICAgICAnQ2FsbGJhY2sgXCJlcnJvclwiIGlzIGRlcHJlY2F0ZWQgdXNlIHByb21pc2UgaW5zdGVhZCdcbiAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIG9wdGlvbnMuZXJyb3IuY2FsbChcbiAgICAgICAgICAgICAgICAgICQoY3VycmVudFdpZGdldC5lbGVtZW50KSxcbiAgICAgICAgICAgICAgICAgIHZhbHVlcy5kb2N1bWVudFByb3BlcnRpZXMgfHwge30sXG4gICAgICAgICAgICAgICAgICBudWxsLFxuICAgICAgICAgICAgICAgICAgZXJyb3JNZXNzYWdlXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgfSBjYXRjaCAoZXhjZXB0aW9uKSB7XG4gICAgICAgICAgICAgICAgd2luZG93LmRjcC5sb2dnZXIoZXhjZXB0aW9uKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmVqZWN0KHtcbiAgICAgICAgICAgICAgZWxlbWVudDogJChjdXJyZW50V2lkZ2V0LmVsZW1lbnQpLFxuICAgICAgICAgICAgICBwcmV2aW91c0RvY3VtZW50OiB2YWx1ZXMuZG9jdW1lbnRQcm9wZXJ0aWVzIHx8IHt9LFxuICAgICAgICAgICAgICBuZXh0RG9jdW1lbnQ6IG51bGwsXG4gICAgICAgICAgICAgIGVycm9yTWVzc2FnZTogZXJyb3JNZXNzYWdlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgICB9KTtcbiAgICB9LFxuXG4gICAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxuICAgICAqIEV4dGVybmFsIGZ1bmN0aW9uXG4gICAgICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuICAgIC8qKlxuICAgICAqIFJlaW5pdCB0aGUgY3VycmVudCBkb2N1bWVudCAoY2xvc2UgaXQgYW5kIHJlLW9wZW4gaXQpIDoga2VlcCB0aGUgc2FtZSB2aWV3LCByZXZpc2lvbiwgZXRjLi4uXG4gICAgICpcbiAgICAgKiBAcGFyYW0gdmFsdWVzIG9iamVjdCB7XCJpbml0aWRcIiA6IGludCwgXCJyZXZpc2lvblwiIDogaW50LCBcInZpZXdJZFwiIDogc3RyaW5nLCBcImN1c3RvbUNsaWVudERhdGFcIiA6IG1peGVkfVxuICAgICAqIEBwYXJhbSBvcHRpb25zIG9iamVjdCB7XCJzdWNjZXNzXCI6IGZjdCwgXCJlcnJvclwiLCBmY3R9XG4gICAgICovXG4gICAgcmVpbml0RG9jdW1lbnQ6IGZ1bmN0aW9uIGRvY3VtZW50Q29udHJvbGxlclJlaW5pdERvY3VtZW50KHZhbHVlcywgb3B0aW9ucykge1xuICAgICAgdmFyIHByb3BlcnRpZXMgPSB0aGlzLmdldFByb3BlcnRpZXMoKTtcbiAgICAgIHRoaXMuX2NoZWNrSW5pdGlhbGlzZWRNb2RlbCgpO1xuICAgICAgdmFsdWVzID0gdmFsdWVzIHx8IHt9O1xuXG4gICAgICAvL1JlaW5pdCBtb2RlbCB3aXRoIHNlcnZlciB2YWx1ZXNcbiAgICAgIF8uZGVmYXVsdHModmFsdWVzLCB7XG4gICAgICAgIHJldmlzaW9uOiBwcm9wZXJ0aWVzLnJldmlzaW9uLFxuICAgICAgICB2aWV3SWQ6IHByb3BlcnRpZXMudmlld0lkLFxuICAgICAgICBpbml0aWQ6IHByb3BlcnRpZXMuaW5pdGlkXG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIHRoaXMuZmV0Y2hEb2N1bWVudCh2YWx1ZXMsIG9wdGlvbnMpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBGZXRjaCBhIG5ldyBkb2N1bWVudFxuICAgICAqIEBwYXJhbSB2YWx1ZXMgb2JqZWN0IHtcImluaXRpZFwiIDogaW50LCBcInJldmlzaW9uXCIgOiBpbnQsIFwidmlld0lkXCIgOiBzdHJpbmcsIFwiY3VzdG9tQ2xpZW50RGF0YVwiIDogbWl4ZWR9XG4gICAgICogQHBhcmFtIG9wdGlvbnMgb2JqZWN0IHtcInN1Y2Nlc3NcIjogZmN0LCBcImVycm9yXCIsIGZjdH1cbiAgICAgKi9cbiAgICBmZXRjaERvY3VtZW50OiBmdW5jdGlvbiBkb2N1bWVudENvbnRyb2xsZXJGZXRjaERvY3VtZW50KHZhbHVlcywgb3B0aW9ucykge1xuICAgICAgdmFyIGRvY3VtZW50UHJvbWlzZSwgY2FsbEJhY2tQcm9taXNlO1xuICAgICAgdmFyIGN1cnJlbnRXaWRnZXQgPSB0aGlzO1xuICAgICAgdmFsdWVzID0gXy5pc1VuZGVmaW5lZCh2YWx1ZXMpID8ge30gOiB2YWx1ZXM7XG4gICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcblxuICAgICAgaWYgKCFfLmlzT2JqZWN0KHZhbHVlcykpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICdGZXRjaCBhcmd1bWVudCBtdXN0IGJlIGFuIG9iamVjdCB7XCJpbml0aWRcIjosIFwicmV2aXNpb25cIjogLCBcInZpZXdJZFwiOiB9J1xuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICBpZiAoIXZhbHVlcy5pbml0aWQpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiaW5pdGlkIGFyZ3VtZW50IGlzIG1hbmRhdG9yeVwiKTtcbiAgICAgIH1cblxuICAgICAgaWYgKCFpc05hTih2YWx1ZXMuaW5pdGlkKSkge1xuICAgICAgICAvLyBDb252ZXJ0IHRvIG51bWVyaWMgaW5pdGlkIGlzIHBvc3NpYmxlXG4gICAgICAgIHZhbHVlcy5pbml0aWQgPSBwYXJzZUludCh2YWx1ZXMuaW5pdGlkKTtcbiAgICAgIH1cblxuICAgICAgLy8gVXNlIGRlZmF1bHQgdmFsdWVzIHdoZW4gZmV0Y2ggYW5vdGhlciBkb2N1bWVudFxuICAgICAgXy5kZWZhdWx0cyh2YWx1ZXMsIHsgcmV2aXNpb246IC0xLCB2aWV3SWQ6IFwiIWRlZmF1bHRDb25zdWx0YXRpb25cIiB9KTtcbiAgICAgIF8uZGVmYXVsdHMob3B0aW9ucywgeyBmb3JjZTogZmFsc2UgfSk7XG5cbiAgICAgIF8uZWFjaChcbiAgICAgICAgXy5waWNrKHZhbHVlcywgXCJpbml0aWRcIiwgXCJyZXZpc2lvblwiLCBcInZpZXdJZFwiKSxcbiAgICAgICAgZnVuY3Rpb24gZGNwRG9jdW1lbnRfc2V0TmV3T3B0aW9ucyh2YWx1ZSwga2V5KSB7XG4gICAgICAgICAgY3VycmVudFdpZGdldC5vcHRpb25zW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgfVxuICAgICAgKTtcblxuICAgICAgaWYgKCF0aGlzLl9tb2RlbCkge1xuICAgICAgICBkb2N1bWVudFByb21pc2UgPSB0aGlzLl9pbml0aWFsaXplV2lkZ2V0KFxuICAgICAgICAgIG9wdGlvbnMsXG4gICAgICAgICAgdmFsdWVzLmN1c3RvbUNsaWVudERhdGFcbiAgICAgICAgKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmICh2YWx1ZXMuY3VzdG9tQ2xpZW50RGF0YSkge1xuICAgICAgICAgIHRoaXMuX21vZGVsLl9jdXN0b21DbGllbnREYXRhID0gdmFsdWVzLmN1c3RvbUNsaWVudERhdGE7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5fbW9kZWwuaXNNb2RpZmllZCgpICYmIG9wdGlvbnMuZm9yY2UgPT09IGZhbHNlKSB7XG4gICAgICAgICAgY2FsbEJhY2tQcm9taXNlID0gdGhpcy5fbW9kZWwuX3Byb21pc2VDYWxsYmFjaygpO1xuICAgICAgICAgIHRoaXMuX21vZGVsLnRyaWdnZXIoXCJsb2FkRG9jdW1lbnRcIiwgdGhpcy5fZ2V0TW9kZWxWYWx1ZSgpLCB7XG4gICAgICAgICAgICBzdWNjZXNzOiBjYWxsQmFja1Byb21pc2Uuc3VjY2VzcyxcbiAgICAgICAgICAgIGVycm9yOiBjYWxsQmFja1Byb21pc2UuZXJyb3JcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBkb2N1bWVudFByb21pc2UgPSBjYWxsQmFja1Byb21pc2UucHJvbWlzZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBkb2N1bWVudFByb21pc2UgPSB0aGlzLl9tb2RlbC5mZXRjaERvY3VtZW50KHRoaXMuX2dldE1vZGVsVmFsdWUoKSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiB0aGlzLl9yZWdpc3Rlck91dHB1dFByb21pc2UoZG9jdW1lbnRQcm9taXNlLCBvcHRpb25zKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogU2F2ZSB0aGUgY3VycmVudCBkb2N1bWVudFxuICAgICAqIFJlbG9hZCB0aGUgaW50ZXJmYWNlIGluIHRoZSBzYW1lIG1vZGVcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyBvYmplY3Qge1wic3VjY2Vzc1wiOiBmY3QsIFwiZXJyb3JcIiwgZmN0LCBcImN1c3RvbUNsaWVudERhdGFcIiA6IG1peGVkfVxuICAgICAqXG4gICAgICovXG4gICAgc2F2ZURvY3VtZW50OiBmdW5jdGlvbiBkb2N1bWVudENvbnRyb2xsZXJTYXZlKG9wdGlvbnMpIHtcbiAgICAgIHZhciBkb2N1bWVudFByb21pc2U7XG4gICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcbiAgICAgIHRoaXMuX2NoZWNrSW5pdGlhbGlzZWRNb2RlbCgpO1xuICAgICAgaWYgKG9wdGlvbnMuY3VzdG9tQ2xpZW50RGF0YSkge1xuICAgICAgICB0aGlzLl9tb2RlbC5fY3VzdG9tQ2xpZW50RGF0YSA9IG9wdGlvbnMuY3VzdG9tQ2xpZW50RGF0YTtcbiAgICAgIH1cbiAgICAgIGRvY3VtZW50UHJvbWlzZSA9IHRoaXMuX21vZGVsLnNhdmVEb2N1bWVudCgpO1xuICAgICAgcmV0dXJuIHRoaXMuX3JlZ2lzdGVyT3V0cHV0UHJvbWlzZShkb2N1bWVudFByb21pc2UsIG9wdGlvbnMpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBDaGFuZ2UgdGhlIHdvcmtmbG93IHN0YXRlIG9mIHRoZSBkb2N1bWVudFxuICAgICAqXG4gICAgICogQHBhcmFtIHBhcmFtZXRlcnNcbiAgICAgKiBAcGFyYW0gcmVpbml0T3B0aW9uc1xuICAgICAqIEBwYXJhbSBvcHRpb25zXG4gICAgICovXG4gICAgY2hhbmdlU3RhdGVEb2N1bWVudDogZnVuY3Rpb24gZG9jdW1lbnRDb250cm9sbGVyX2NoYW5nZVN0YXRlRG9jdW1lbnQoXG4gICAgICBwYXJhbWV0ZXJzLFxuICAgICAgcmVpbml0T3B0aW9ucyxcbiAgICAgIG9wdGlvbnNcbiAgICApIHtcbiAgICAgIHZhciBkb2N1bWVudFByb21pc2U7XG4gICAgICB0aGlzLl9jaGVja0luaXRpYWxpc2VkTW9kZWwoKTtcbiAgICAgIGlmICghXy5pc09iamVjdChwYXJhbWV0ZXJzKSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgJ2NoYW5nZVN0YXRlRG9jdW1lbnQgZmlyc3QgYXJndW1lbnQgbXVzdCBiZSBhbiBvYmplY3Qge1wibmV4dFN0YXRlXCI6LCBcInRyYW5zaXRpb25cIjogLCBcInZhbHVlc1wiOiwgXCJ1bmF0dGVuZGVkXCI6LCBcIlwiIH0nXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICBpZiAoXG4gICAgICAgICFfLmlzU3RyaW5nKHBhcmFtZXRlcnMubmV4dFN0YXRlKSB8fFxuICAgICAgICAhXy5pc1N0cmluZyhwYXJhbWV0ZXJzLnRyYW5zaXRpb24pXG4gICAgICApIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwibmV4dFN0YXRlIGFuZCB0cmFuc2l0aW9uIGFyZ3VtZW50cyBhcmUgbWFuZGF0b3J5XCIpO1xuICAgICAgfVxuICAgICAgZG9jdW1lbnRQcm9taXNlID0gdGhpcy5faW5pdEFuZERpc3BsYXlUcmFuc2l0aW9uKFxuICAgICAgICBwYXJhbWV0ZXJzLm5leHRTdGF0ZSxcbiAgICAgICAgcGFyYW1ldGVycy50cmFuc2l0aW9uLFxuICAgICAgICBwYXJhbWV0ZXJzLnZhbHVlcyB8fCBudWxsLFxuICAgICAgICBwYXJhbWV0ZXJzLnVuYXR0ZW5kZWQgfHwgZmFsc2UsXG4gICAgICAgIHJlaW5pdE9wdGlvbnNcbiAgICAgICk7XG4gICAgICByZXR1cm4gdGhpcy5fcmVnaXN0ZXJPdXRwdXRQcm9taXNlKGRvY3VtZW50UHJvbWlzZSwgb3B0aW9ucyk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIERlbGV0ZSB0aGUgY3VycmVudCBkb2N1bWVudFxuICAgICAqIFJlbG9hZCB0aGUgaW50ZXJmYWNlIGluIHRoZSBzYW1lIG1vZGVcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyBvYmplY3Qge1wic3VjY2Vzc1wiOiBmY3QsIFwiZXJyb3JcIiwgZmN0LCBcImN1c3RvbUNsaWVudERhdGFcIiA6IG1peGVkfVxuICAgICAqL1xuICAgIGRlbGV0ZURvY3VtZW50OiBmdW5jdGlvbiBkb2N1bWVudENvbnRyb2xsZXJEZWxldGUob3B0aW9ucykge1xuICAgICAgdmFyIGRvY3VtZW50UHJvbWlzZTtcbiAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuICAgICAgdGhpcy5fY2hlY2tJbml0aWFsaXNlZE1vZGVsKCk7XG4gICAgICBpZiAob3B0aW9ucy5jdXN0b21DbGllbnREYXRhKSB7XG4gICAgICAgIHRoaXMuX21vZGVsLl9jdXN0b21DbGllbnREYXRhID0gb3B0aW9ucy5jdXN0b21DbGllbnREYXRhO1xuICAgICAgfVxuICAgICAgZG9jdW1lbnRQcm9taXNlID0gdGhpcy5fbW9kZWwuZGVsZXRlRG9jdW1lbnQoKTtcbiAgICAgIHJldHVybiB0aGlzLl9yZWdpc3Rlck91dHB1dFByb21pc2UoZG9jdW1lbnRQcm9taXNlLCBvcHRpb25zKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogUmVzdG9yZSB0aGUgY3VycmVudCBkb2N1bWVudFxuICAgICAqIFJlbG9hZCB0aGUgaW50ZXJmYWNlIGluIHRoZSBzYW1lIG1vZGVcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyBvYmplY3Qge1wic3VjY2Vzc1wiOiBmY3QsIFwiZXJyb3JcIiwgZmN0LCBcImN1c3RvbUNsaWVudERhdGFcIiA6IG1peGVkfVxuICAgICAqL1xuICAgIHJlc3RvcmVEb2N1bWVudDogZnVuY3Rpb24gZG9jdW1lbnRDb250cm9sbGVyUmVzdG9yZShvcHRpb25zKSB7XG4gICAgICB2YXIgZG9jdW1lbnRQcm9taXNlO1xuICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG4gICAgICB0aGlzLl9jaGVja0luaXRpYWxpc2VkTW9kZWwoKTtcbiAgICAgIGlmIChvcHRpb25zLmN1c3RvbUNsaWVudERhdGEpIHtcbiAgICAgICAgdGhpcy5fbW9kZWwuX2N1c3RvbUNsaWVudERhdGEgPSBvcHRpb25zLmN1c3RvbUNsaWVudERhdGE7XG4gICAgICB9XG4gICAgICBkb2N1bWVudFByb21pc2UgPSB0aGlzLl9tb2RlbC5yZXN0b3JlRG9jdW1lbnQoKTtcbiAgICAgIHJldHVybiB0aGlzLl9yZWdpc3Rlck91dHB1dFByb21pc2UoZG9jdW1lbnRQcm9taXNlLCBvcHRpb25zKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogR2V0IGEgcHJvcGVydHkgdmFsdWVcbiAgICAgKlxuICAgICAqIEBwYXJhbSBwcm9wZXJ0eVxuICAgICAqIEByZXR1cm5zIHsqfVxuICAgICAqL1xuICAgIGdldFByb3BlcnR5OiBmdW5jdGlvbiBkb2N1bWVudENvbnRyb2xsZXJHZXREb2N1bWVudFByb3BlcnR5KHByb3BlcnR5KSB7XG4gICAgICB0aGlzLl9jaGVja0luaXRpYWxpc2VkTW9kZWwoKTtcbiAgICAgIGlmIChwcm9wZXJ0eSA9PT0gXCJpc01vZGlmaWVkXCIpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX21vZGVsLmlzTW9kaWZpZWQoKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0aGlzLl9tb2RlbC5nZXRTZXJ2ZXJQcm9wZXJ0aWVzKClbcHJvcGVydHldO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBHZXQgYWxsIHRoZSBwcm9wZXJ0aWVzXG4gICAgICogQHJldHVybnMgeyp9XG4gICAgICovXG4gICAgZ2V0UHJvcGVydGllczogZnVuY3Rpb24gZG9jdW1lbnRDb250cm9sbGVyR2V0RG9jdW1lbnRQcm9wZXJ0aWVzKCkge1xuICAgICAgdmFyIHByb3BlcnRpZXMsXG4gICAgICAgIHJlYWR5ID0gdHJ1ZTtcbiAgICAgIHRyeSB7XG4gICAgICAgIHRoaXMuX2NoZWNrSW5pdGlhbGlzZWRNb2RlbCgpO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICByZWFkeSA9IGZhbHNlO1xuICAgICAgICBwcm9wZXJ0aWVzID0ge1xuICAgICAgICAgIG5vdExvYWRlZDogdHJ1ZVxuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgaWYgKHJlYWR5KSB7XG4gICAgICAgIHByb3BlcnRpZXMgPSB0aGlzLl9tb2RlbC5nZXRTZXJ2ZXJQcm9wZXJ0aWVzKCk7XG4gICAgICAgIHByb3BlcnRpZXMuaXNNb2RpZmllZCA9IHRoaXMuX21vZGVsLmlzTW9kaWZpZWQoKTtcbiAgICAgICAgcHJvcGVydGllcy51cmwgPSB3aW5kb3cubG9jYXRpb24uaHJlZjtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHByb3BlcnRpZXM7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIENoZWNrIGlmIGFuIGF0dHJpYnV0ZSBleGlzdFxuICAgICAqXG4gICAgICogQHBhcmFtIGF0dHJpYnV0ZUlkXG4gICAgICogQHJldHVybiB7Ym9vbGVhbn1cbiAgICAgKi9cbiAgICBoYXNBdHRyaWJ1dGU6IGZ1bmN0aW9uIGRvY3VtZW50Q29udHJvbGxlcl9oYXNBdHRyaWJ1dGUoYXR0cmlidXRlSWQpIHtcbiAgICAgIHRoaXMuX2NoZWNrSW5pdGlhbGlzZWRNb2RlbCgpO1xuICAgICAgdmFyIGF0dHJpYnV0ZSA9IHRoaXMuX21vZGVsLmdldChcImF0dHJpYnV0ZXNcIikuZ2V0KGF0dHJpYnV0ZUlkKTtcbiAgICAgIHJldHVybiAhIWF0dHJpYnV0ZTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogR2V0IHRoZSBhdHRyaWJ1dGUgaW50ZXJmYWNlIG9iamVjdFxuICAgICAqIFJldHVybiBudWxsIGlmIGF0dHJpYnV0ZSBub3QgZm91bmRcbiAgICAgKiBAcGFyYW0gYXR0cmlidXRlSWRcbiAgICAgKiBAcmV0dXJucyBBdHRyaWJ1dGVJbnRlcmZhY2V8bnVsbFxuICAgICAqL1xuICAgIGdldEF0dHJpYnV0ZTogZnVuY3Rpb24gZG9jdW1lbnRDb250cm9sbGVyR2V0QXR0cmlidXRlKGF0dHJpYnV0ZUlkKSB7XG4gICAgICB0aGlzLl9jaGVja0luaXRpYWxpc2VkTW9kZWwoKTtcbiAgICAgIHZhciBhdHRyaWJ1dGVNb2RlbCA9IHRoaXMuX2dldEF0dHJpYnV0ZU1vZGVsKGF0dHJpYnV0ZUlkKTtcbiAgICAgIGlmICghYXR0cmlidXRlTW9kZWwpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9XG4gICAgICByZXR1cm4gbmV3IEF0dHJpYnV0ZUludGVyZmFjZSh0aGlzLl9nZXRBdHRyaWJ1dGVNb2RlbChhdHRyaWJ1dGVJZCkpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBHZXQgYWxsIHRoZSBhdHRyaWJ1dGVzIG9mIHRoZSBjdXJyZW50IGRvY3VtZW50XG4gICAgICpcbiAgICAgKiBAcmV0dXJucyBbQXR0cmlidXRlSW50ZXJmYWNlXVxuICAgICAqL1xuICAgIGdldEF0dHJpYnV0ZXM6IGZ1bmN0aW9uIGRvY3VtZW50Q29udHJvbGxlckdldEF0dHJpYnV0ZXMoKSB7XG4gICAgICB0aGlzLl9jaGVja0luaXRpYWxpc2VkTW9kZWwoKTtcbiAgICAgIHJldHVybiB0aGlzLl9tb2RlbFxuICAgICAgICAuZ2V0KFwiYXR0cmlidXRlc1wiKVxuICAgICAgICAubWFwKGZ1bmN0aW9uIGRvY3VtZW50Q29udHJvbGxlcl9tYXBBdHRyaWJ1dGUoY3VycmVudEF0dHJpYnV0ZSkge1xuICAgICAgICAgIHJldHVybiBuZXcgQXR0cmlidXRlSW50ZXJmYWNlKGN1cnJlbnRBdHRyaWJ1dGUpO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQ2hlY2sgaWYgYSBtZW51IGV4aXN0XG4gICAgICpcbiAgICAgKiBAcGFyYW0gbWVudUlkXG4gICAgICogQHJldHVybiB7Ym9vbGVhbn1cbiAgICAgKi9cbiAgICBoYXNNZW51OiBmdW5jdGlvbiBkb2N1bWVudENvbnRyb2xsZXJfaGFzTWVudShtZW51SWQpIHtcbiAgICAgIHRoaXMuX2NoZWNrSW5pdGlhbGlzZWRNb2RlbCgpO1xuICAgICAgdmFyIG1lbnUgPSB0aGlzLl9nZXRNZW51TW9kZWwobWVudUlkKTtcbiAgICAgIHJldHVybiAhIW1lbnU7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEdldCB0aGUgbWVudSBpbnRlcmZhY2Ugb2JqZWN0XG4gICAgICpcbiAgICAgKiBAcGFyYW0gbWVudUlkXG4gICAgICogQHJldHVybnMgTWVudUludGVyZmFjZVxuICAgICAqL1xuICAgIGdldE1lbnU6IGZ1bmN0aW9uIGRvY3VtZW50Q29udHJvbGxlckdldE1lbnUobWVudUlkKSB7XG4gICAgICB0aGlzLl9jaGVja0luaXRpYWxpc2VkTW9kZWwoKTtcbiAgICAgIHZhciBtZW51ID0gdGhpcy5fZ2V0TWVudU1vZGVsKG1lbnVJZCk7XG4gICAgICBpZiAoIW1lbnUpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9XG4gICAgICByZXR1cm4gbmV3IE1lbnVJbnRlcmZhY2UobWVudSk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEdldCBhbGwgdGhlIG1lbnUgb2YgdGhlIGN1cnJlbnQgZG9jdW1lbnRcbiAgICAgKlxuICAgICAqIEByZXR1cm5zIFtNZW51SW50ZXJmYWNlXVxuICAgICAqL1xuICAgIGdldE1lbnVzOiBmdW5jdGlvbiBkb2N1bWVudENvbnRyb2xsZXJHZXRNZW51cygpIHtcbiAgICAgIHRoaXMuX2NoZWNrSW5pdGlhbGlzZWRNb2RlbCgpO1xuICAgICAgcmV0dXJuIHRoaXMuX21vZGVsXG4gICAgICAgIC5nZXQoXCJtZW51c1wiKVxuICAgICAgICAubWFwKGZ1bmN0aW9uIGRvY3VtZW50Q29udHJvbGxlcl9tYXBNZW51KGN1cnJlbnRNZW51KSB7XG4gICAgICAgICAgcmV0dXJuIG5ldyBNZW51SW50ZXJmYWNlKGN1cnJlbnRNZW51KTtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIFNlbGVjdCBhIHRhYlxuICAgICAqXG4gICAgICogQHBhcmFtIHRhYklkXG4gICAgICogQHJldHVybnMgdm9pZFxuICAgICAqL1xuICAgIHNlbGVjdFRhYjogZnVuY3Rpb24gZG9jdW1lbnRDb250cm9sbGVyU2VsZWN0VGFiKHRhYklkKSB7XG4gICAgICB0aGlzLl9jaGVja0luaXRpYWxpc2VkTW9kZWwoKTtcbiAgICAgIHZhciBhdHRyaWJ1dGVNb2RlbCA9IHRoaXMuX2dldEF0dHJpYnV0ZU1vZGVsKHRhYklkKTtcbiAgICAgIGlmICghYXR0cmlidXRlTW9kZWwpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGUgYXR0cmlidXRlIFwiJyArIHRhYklkICsgJ1wiIGNhbm5vdCBiZSBmb3VuZC4nKTtcbiAgICAgIH1cbiAgICAgIGlmIChhdHRyaWJ1dGVNb2RlbC5nZXQoXCJ0eXBlXCIpICE9PSBcInRhYlwiKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignVGhlIGF0dHJpYnV0ZSBcIicgKyB0YWJJZCArICdcIiBpcyBub3QgYSB0YWIuJyk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuX21vZGVsLnRyaWdnZXIoXCJkb1NlbGVjdFRhYlwiLCB0YWJJZCk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIERyYXcgdGFiIGNvbnRlbnRcbiAgICAgKlxuICAgICAqIEBwYXJhbSB0YWJJZFxuICAgICAqIEByZXR1cm5zIHZvaWRcbiAgICAgKi9cbiAgICBkcmF3VGFiOiBmdW5jdGlvbiBkb2N1bWVudENvbnRyb2xsZXJEcmF3VGFiKHRhYklkKSB7XG4gICAgICB0aGlzLl9jaGVja0luaXRpYWxpc2VkTW9kZWwoKTtcbiAgICAgIHZhciBhdHRyaWJ1dGVNb2RlbCA9IHRoaXMuX2dldEF0dHJpYnV0ZU1vZGVsKHRhYklkKTtcbiAgICAgIGlmICghYXR0cmlidXRlTW9kZWwpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGUgYXR0cmlidXRlIFwiJyArIHRhYklkICsgJ1wiIGNhbm5vdCBiZSBmb3VuZC4nKTtcbiAgICAgIH1cbiAgICAgIGlmIChhdHRyaWJ1dGVNb2RlbC5nZXQoXCJ0eXBlXCIpICE9PSBcInRhYlwiKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignVGhlIGF0dHJpYnV0ZSBcIicgKyB0YWJJZCArICdcIiBpcyBub3QgYSB0YWIuJyk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuX21vZGVsLnRyaWdnZXIoXCJkb0RyYXdUYWJcIiwgdGFiSWQpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBHZXQgYW4gYXR0cmlidXRlIHZhbHVlXG4gICAgICpcbiAgICAgKiBAcGFyYW0gYXR0cmlidXRlSWRcbiAgICAgKiBAcGFyYW0gdHlwZSBzdHJpbmcgKGN1cnJlbnR8cHJldmlvdXN8aW5pdGlhbHxhbGwpIHdoYXQga2luZCBvZiB2YWx1ZSAoZGVmYXVsdCA6IGN1cnJlbnQpXG4gICAgICogQHJldHVybnMgeyp9XG4gICAgICovXG4gICAgZ2V0VmFsdWU6IGZ1bmN0aW9uIGRvY3VtZW50Q29udHJvbGxlckdldFZhbHVlKGF0dHJpYnV0ZUlkLCB0eXBlKSB7XG4gICAgICB2YXIgYXR0cmlidXRlO1xuICAgICAgdGhpcy5fY2hlY2tJbml0aWFsaXNlZE1vZGVsKCk7XG4gICAgICB2YXIgYXR0cmlidXRlTW9kZWwgPSB0aGlzLl9nZXRBdHRyaWJ1dGVNb2RlbChhdHRyaWJ1dGVJZCk7XG4gICAgICBpZiAoIWF0dHJpYnV0ZU1vZGVsKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuICAgICAgYXR0cmlidXRlID0gbmV3IEF0dHJpYnV0ZUludGVyZmFjZShhdHRyaWJ1dGVNb2RlbCk7XG4gICAgICByZXR1cm4gXy5jbG9uZShhdHRyaWJ1dGUuZ2V0VmFsdWUodHlwZSkpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBHZXQgYWxsIHRoZSB2YWx1ZXNcbiAgICAgKlxuICAgICAqIEByZXR1cm5zIHsqfHt9fVxuICAgICAqL1xuICAgIGdldFZhbHVlczogZnVuY3Rpb24gZG9jdW1lbnRDb250cm9sbGVyR2V0VmFsdWVzKCkge1xuICAgICAgdGhpcy5fY2hlY2tJbml0aWFsaXNlZE1vZGVsKCk7XG4gICAgICByZXR1cm4gdGhpcy5fbW9kZWwuZ2V0VmFsdWVzKCk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEdldCBjdXN0b21EYXRhIGZyb20gcmVuZGVyIHZpZXcgbW9kZWxcbiAgICAgKiBAcmV0dXJucyB7Kn1cbiAgICAgKi9cbiAgICBnZXRDdXN0b21TZXJ2ZXJEYXRhOiBmdW5jdGlvbiBkb2N1bWVudENvbnRyb2xsZXJHZXRTZXJ2ZXJDdXN0b21EYXRhKCkge1xuICAgICAgdGhpcy5fY2hlY2tJbml0aWFsaXNlZE1vZGVsKCk7XG4gICAgICByZXR1cm4gdGhpcy5fbW9kZWwuZ2V0KFwiY3VzdG9tU2VydmVyRGF0YVwiKTtcbiAgICB9LFxuICAgIC8qKlxuICAgICAqIEFkZCBjdXN0b21EYXRhIGZyb20gcmVuZGVyIHZpZXcgbW9kZWxcbiAgICAgKiBAcmV0dXJucyB7Kn1cbiAgICAgKi9cbiAgICBhZGRDdXN0b21DbGllbnREYXRhOiBmdW5jdGlvbiBkb2N1bWVudENvbnRyb2xsZXJBZGRDdXN0b21DbGllbnREYXRhKFxuICAgICAgZG9jdW1lbnRDaGVjayxcbiAgICAgIHZhbHVlXG4gICAgKSB7XG4gICAgICB2YXIgY3VycmVudFdpZGdldCA9IHRoaXM7XG4gICAgICB0aGlzLl9jaGVja0luaXRpYWxpc2VkTW9kZWwoKTtcbiAgICAgIC8vRmlyc3QgY2FzZSBubyBkYXRhLCBzbyBkb2N1bWVudENoZWNrIGlzIGRhdGFcbiAgICAgIGlmIChfLmlzVW5kZWZpbmVkKHZhbHVlKSkge1xuICAgICAgICB2YWx1ZSA9IGRvY3VtZW50Q2hlY2s7XG4gICAgICAgIGRvY3VtZW50Q2hlY2sgPSB7fTtcbiAgICAgIH1cbiAgICAgIC8vU2Vjb25kIGNhc2UgZG9jdW1lbnRDaGVjayBpcyBhIGZ1bmN0aW9uIGFuZCBkYXRhIGlzIG9iamVjdFxuICAgICAgaWYgKF8uaXNGdW5jdGlvbihkb2N1bWVudENoZWNrKSAmJiBfLmlzT2JqZWN0KHZhbHVlKSkge1xuICAgICAgICBkb2N1bWVudENoZWNrID0geyBkb2N1bWVudENoZWNrOiBkb2N1bWVudENoZWNrIH07XG4gICAgICB9XG4gICAgICAvL1RoaXJkIGNhc2UgZG9jdW1lbnRDaGVjayBpcyBhbiBvYmplY3QgYW5kIGRhdGEgaXMgb2JqZWN0ID0+IGNoZWNrIGlmIGRvY3VtZW50Q2hlY2sgcHJvcGVydHkgZXhpc3RcbiAgICAgIGlmIChfLmlzT2JqZWN0KHZhbHVlKSAmJiBfLmlzT2JqZWN0KGRvY3VtZW50Q2hlY2spKSB7XG4gICAgICAgIGRvY3VtZW50Q2hlY2sgPSBfLmRlZmF1bHRzKGRvY3VtZW50Q2hlY2ssIHtcbiAgICAgICAgICBkb2N1bWVudENoZWNrOiBmdW5jdGlvbiBjbGllbnRDdXN0b21PSygpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgb25jZTogdHJ1ZVxuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICBcIkNvbnN0cmFpbnQgbXVzdCBiZSBhbiB2YWx1ZSBvciBhIGZ1bmN0aW9uIGFuZCBhIHZhbHVlXCJcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIC8vUmVnaXN0ZXIgdGhlIGN1c3RvbUNsaWVudERhdGFcbiAgICAgIF8uZWFjaCh2YWx1ZSwgZnVuY3Rpb24gZG9jdW1lbnRDb250cm9sbGVyQWRkQ3VzdG9tQ2xpZW50RGF0YUVhY2goXG4gICAgICAgIGN1cnJlbnRWYWx1ZSxcbiAgICAgICAgY3VycmVudEtleVxuICAgICAgKSB7XG4gICAgICAgIGN1cnJlbnRXaWRnZXQuX2N1c3RvbUNsaWVudERhdGFbY3VycmVudEtleV0gPSB7XG4gICAgICAgICAgdmFsdWU6IGN1cnJlbnRWYWx1ZSxcbiAgICAgICAgICBkb2N1bWVudENoZWNrOiBkb2N1bWVudENoZWNrLmRvY3VtZW50Q2hlY2ssXG4gICAgICAgICAgb25jZTogZG9jdW1lbnRDaGVjay5vbmNlXG4gICAgICAgIH07XG4gICAgICB9KTtcbiAgICB9LFxuICAgIC8qKlxuICAgICAqIEdldCBjdXN0b21EYXRhIGZyb20gcmVuZGVyIHZpZXcgbW9kZWxcbiAgICAgKiBAcmV0dXJucyB7Kn1cbiAgICAgKi9cbiAgICBzZXRDdXN0b21DbGllbnREYXRhOiBmdW5jdGlvbiBkb2N1bWVudENvbnRyb2xsZXJTZXRDdXN0b21DbGllbnREYXRhKFxuICAgICAgZG9jdW1lbnRDaGVjayxcbiAgICAgIHZhbHVlXG4gICAgKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwidGhpcyBmdW5jdGlvbiAoc2V0Q3VzdG9tQ2xpZW50RGF0YSkgaXMgZGVwcmVjYXRlZFwiKTtcbiAgICAgIHJldHVybiB0aGlzLmFkZEN1c3RvbUNsaWVudERhdGEoZG9jdW1lbnRDaGVjaywgdmFsdWUpO1xuICAgIH0sXG4gICAgLyoqXG4gICAgICogR2V0IGN1c3RvbURhdGEgZnJvbSByZW5kZXIgdmlldyBtb2RlbFxuICAgICAqIEByZXR1cm5zIHsqfVxuICAgICAqL1xuICAgIGdldEN1c3RvbUNsaWVudERhdGE6IGZ1bmN0aW9uIGRvY3VtZW50Q29udHJvbGxlclNldEN1c3RvbUNsaWVudERhdGEoXG4gICAgICBkZWxldGVPbmNlXG4gICAgKSB7XG4gICAgICB2YXIgdmFsdWVzID0ge30sXG4gICAgICAgIGN1cnJlbnRXaWRnZXQgPSB0aGlzLFxuICAgICAgICAkZWxlbWVudCxcbiAgICAgICAgcHJvcGVydGllcyxcbiAgICAgICAgbmV3Q3VzdG9tRGF0YSA9IHt9O1xuICAgICAgdGhpcy5fY2hlY2tJbml0aWFsaXNlZE1vZGVsKCk7XG4gICAgICBwcm9wZXJ0aWVzID0gdGhpcy5nZXRQcm9wZXJ0aWVzKCk7XG4gICAgICAkZWxlbWVudCA9ICQoY3VycmVudFdpZGdldC5lbGVtZW50KTtcbiAgICAgIF8uZWFjaChjdXJyZW50V2lkZ2V0Ll9jdXN0b21DbGllbnREYXRhLCBmdW5jdGlvbiBhbmFseXplQ3VzdG9tQ2xpZW50KFxuICAgICAgICBjdXJyZW50Q3VzdG9tLFxuICAgICAgICBrZXlcbiAgICAgICkge1xuICAgICAgICBpZiAoY3VycmVudEN1c3RvbS5kb2N1bWVudENoZWNrLmNhbGwoJGVsZW1lbnQsIHByb3BlcnRpZXMpKSB7XG4gICAgICAgICAgdmFsdWVzW2tleV0gPSBjdXJyZW50Q3VzdG9tLnZhbHVlO1xuICAgICAgICAgIGlmIChkZWxldGVPbmNlID09PSB0cnVlICYmICFjdXJyZW50Q3VzdG9tLm9uY2UpIHtcbiAgICAgICAgICAgIG5ld0N1c3RvbURhdGFba2V5XSA9IGN1cnJlbnRDdXN0b207XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGlmIChkZWxldGVPbmNlID09PSB0cnVlKSB7XG4gICAgICAgICAgICBuZXdDdXN0b21EYXRhW2tleV0gPSBjdXJyZW50Q3VzdG9tO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICBpZiAoZGVsZXRlT25jZSA9PT0gdHJ1ZSkge1xuICAgICAgICBjdXJyZW50V2lkZ2V0Ll9jdXN0b21DbGllbnREYXRhID0gbmV3Q3VzdG9tRGF0YTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB2YWx1ZXM7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIERlbGV0ZSBhIGN1c3RvbSBkYXRhXG4gICAgICogQHJldHVybnMgeyp9XG4gICAgICovXG4gICAgcmVtb3ZlQ3VzdG9tQ2xpZW50RGF0YTogZnVuY3Rpb24gZG9jdW1lbnRDb250cm9sbGVyUmVtb3ZlQ3VzdG9tQ2xpZW50RGF0YShcbiAgICAgIGtleVxuICAgICkge1xuICAgICAgaWYgKHRoaXMuX2N1c3RvbUNsaWVudERhdGFba2V5XSkge1xuICAgICAgICBkZWxldGUgdGhpcy5fY3VzdG9tQ2xpZW50RGF0YVtrZXldO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcbiAgICAvKipcbiAgICAgKiBTZXQgYSB2YWx1ZVxuICAgICAqIFRyaWdnZXIgYSBjaGFuZ2UgZXZlbnRcbiAgICAgKlxuICAgICAqIEBwYXJhbSBhdHRyaWJ1dGVJZCBzdHJpbmcgYXR0cmlidXRlIGlkZW50aWZpZXJcbiAgICAgKiBAcGFyYW0gdmFsdWUgb2JqZWN0IHsgXCJ2YWx1ZVwiIDogKiwgXCJkaXNwbGF5VmFsdWVcIiA6ICp9XG4gICAgICogQHJldHVybnMgeyp9XG4gICAgICovXG4gICAgc2V0VmFsdWU6IGZ1bmN0aW9uIGRvY3VtZW50Q29udHJvbGxlclNldFZhbHVlKGF0dHJpYnV0ZUlkLCB2YWx1ZSkge1xuICAgICAgdGhpcy5fY2hlY2tJbml0aWFsaXNlZE1vZGVsKCk7XG4gICAgICB2YXIgYXR0cmlidXRlTW9kZWwgPSB0aGlzLl9nZXRBdHRyaWJ1dGVNb2RlbChhdHRyaWJ1dGVJZCk7XG4gICAgICBpZiAoIWF0dHJpYnV0ZU1vZGVsKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIlVuYWJsZSB0byBmaW5kIGF0dHJpYnV0ZSBcIiArIGF0dHJpYnV0ZUlkKTtcbiAgICAgIH1cbiAgICAgIHZhciBhdHRyaWJ1dGVJbnRlcmZhY2UgPSBuZXcgQXR0cmlidXRlSW50ZXJmYWNlKGF0dHJpYnV0ZU1vZGVsKTtcbiAgICAgIHZhciBpbmRleDtcbiAgICAgIHZhciBjdXJyZW50VmFsdWVMZW5ndGg7XG4gICAgICB2YXIgaTtcblxuICAgICAgaWYgKGF0dHJpYnV0ZU1vZGVsLmdldFBhcmVudCgpLmdldChcInR5cGVcIikgPT09IFwiYXJyYXlcIikge1xuICAgICAgICBhdHRyaWJ1dGVJbnRlcmZhY2Uuc2V0VmFsdWUodmFsdWUsIHRydWUpOyAvLyBKdXN0IHZlcmlmeSB2YWx1ZSBjb25kaXRpb25zXG4gICAgICAgIGlmICghXy5pc0FycmF5KHZhbHVlKSkge1xuICAgICAgICAgIGluZGV4ID0gdmFsdWUuaW5kZXg7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaW5kZXggPSB2YWx1ZS5sZW5ndGggLSAxO1xuICAgICAgICB9XG4gICAgICAgIGN1cnJlbnRWYWx1ZUxlbmd0aCA9IGF0dHJpYnV0ZUludGVyZmFjZS5nZXRWYWx1ZSgpLmxlbmd0aDtcbiAgICAgICAgYXR0cmlidXRlSW50ZXJmYWNlLnNldFZhbHVlKHZhbHVlKTtcblxuICAgICAgICAvLyBQYWQgdmFsdWVzIG9mIGNvbXBsZXRlIGFycmF5IHdpdGggZGVmYXVsdCB2YWx1ZXNcbiAgICAgICAgdmFyIGFycmF5TW9kZWwgPSBhdHRyaWJ1dGVNb2RlbC5nZXRQYXJlbnQoKTtcbiAgICAgICAgdmFyIG1vZGlmaWVkQ29sdW1ucyA9IHt9O1xuICAgICAgICBhcnJheU1vZGVsLmdldChcImNvbnRlbnRcIikuZWFjaChmdW5jdGlvbihhTW9kZWwpIHtcbiAgICAgICAgICB2YXIgYVZhbHVlID0gXy5jbG9uZShhTW9kZWwuZ2V0KFwiYXR0cmlidXRlVmFsdWVcIikpO1xuICAgICAgICAgIHZhciBkZWZhdWx0VmFsdWUgPSBhTW9kZWwuZ2V0KFwiZGVmYXVsdFZhbHVlXCIpO1xuXG4gICAgICAgICAgaWYgKCFkZWZhdWx0VmFsdWUpIHtcbiAgICAgICAgICAgIGRlZmF1bHRWYWx1ZSA9IGFNb2RlbC5oYXNNdWx0aXBsZU9wdGlvbigpXG4gICAgICAgICAgICAgID8gW11cbiAgICAgICAgICAgICAgOiB7IHZhbHVlOiBudWxsLCBkaXNwbGF5VmFsdWU6IFwiXCIgfTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBmb3IgKGkgPSBjdXJyZW50VmFsdWVMZW5ndGg7IGkgPD0gaW5kZXg7IGkrKykge1xuICAgICAgICAgICAgaWYgKF8uaXNVbmRlZmluZWQoYVZhbHVlW2ldKSkge1xuICAgICAgICAgICAgICBhVmFsdWVbaV0gPSBkZWZhdWx0VmFsdWU7XG4gICAgICAgICAgICAgIG1vZGlmaWVkQ29sdW1uc1thTW9kZWwuaWRdID0geyBtb2RlbDogYU1vZGVsLCB2YWx1ZXM6IGFWYWx1ZSB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgXy5lYWNoKG1vZGlmaWVkQ29sdW1ucywgZnVuY3Rpb24gZG9jdW1lbnRDb250cm9sbGVyUGFkVmFsdWVzKG1vZERhdGEpIHtcbiAgICAgICAgICBfLmRlZmVyKGZ1bmN0aW9uIGRvY3VtZW50Q29udHJvbGxlclBhZFZhbHVlKCkge1xuICAgICAgICAgICAgbW9kRGF0YS5tb2RlbC5zZXQoXCJhdHRyaWJ1dGVWYWx1ZVwiLCBtb2REYXRhLnZhbHVlcyk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHJldHVybiBhdHRyaWJ1dGVJbnRlcmZhY2Uuc2V0VmFsdWUodmFsdWUpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBBZGQgYSByb3cgdG8gYW4gYXJyYXlcbiAgICAgKlxuICAgICAqIEBwYXJhbSBhdHRyaWJ1dGVJZCBzdHJpbmcgYXR0cmlidXRlIGFycmF5XG4gICAgICogQHBhcmFtIHZhbHVlcyBvYmplY3QgeyBcImF0dHJpYnV0ZUlkXCIgOiB7IFwidmFsdWVcIiA6ICosIFwiZGlzcGxheVZhbHVlXCIgOiAqIH0sIC4uLn1cbiAgICAgKi9cbiAgICBhcHBlbmRBcnJheVJvdzogZnVuY3Rpb24gZG9jdW1lbnRDb250cm9sbGVyQWRkQXJyYXlSb3coXG4gICAgICBhdHRyaWJ1dGVJZCxcbiAgICAgIHZhbHVlc1xuICAgICkge1xuICAgICAgdGhpcy5fY2hlY2tJbml0aWFsaXNlZE1vZGVsKCk7XG4gICAgICB2YXIgYXR0cmlidXRlID0gdGhpcy5fZ2V0QXR0cmlidXRlTW9kZWwoYXR0cmlidXRlSWQpO1xuXG4gICAgICBpZiAoIWF0dHJpYnV0ZSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJVbmFibGUgdG8gZmluZCBhdHRyaWJ1dGUgXCIgKyBhdHRyaWJ1dGVJZCk7XG4gICAgICB9XG5cbiAgICAgIGlmIChhdHRyaWJ1dGUuZ2V0KFwidHlwZVwiKSAhPT0gXCJhcnJheVwiKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICBcIkF0dHJpYnV0ZSBcIiArIGF0dHJpYnV0ZUlkICsgXCIgbXVzdCBiZSBhbiBhdHRyaWJ1dGUgb2YgdHlwZSBhcnJheVwiXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICBpZiAoIV8uaXNPYmplY3QodmFsdWVzKSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgXCJWYWx1ZXMgbXVzdCBiZSBhbiBvYmplY3Qgd2hlcmUgZWFjaCBwcm9wZXJ0aWVzIGlzIGFuIGF0dHJpYnV0ZSBvZiB0aGUgYXJyYXkgZm9yIFwiICtcbiAgICAgICAgICAgIGF0dHJpYnV0ZUlkXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICBhdHRyaWJ1dGVcbiAgICAgICAgLmdldChcImNvbnRlbnRcIilcbiAgICAgICAgLmVhY2goZnVuY3Rpb24gZG9jdW1lbnRDb250cm9sbGVyX2FkZEFDZWxsKGN1cnJlbnRBdHRyaWJ1dGUpIHtcbiAgICAgICAgICB2YXIgbmV3VmFsdWUgPSB2YWx1ZXNbY3VycmVudEF0dHJpYnV0ZS5pZF07XG4gICAgICAgICAgdmFyIGN1cnJlbnRWYWx1ZSA9IGN1cnJlbnRBdHRyaWJ1dGUuZ2V0VmFsdWUoKTtcbiAgICAgICAgICBpZiAoXy5pc1VuZGVmaW5lZChuZXdWYWx1ZSkpIHtcbiAgICAgICAgICAgIC8vIFNldCBkZWZhdWx0IHZhbHVlIGlmIG5vIHZhbHVlIGRlZmluZWRcbiAgICAgICAgICAgIGN1cnJlbnRBdHRyaWJ1dGUuY3JlYXRlSW5kZXhlZFZhbHVlKFxuICAgICAgICAgICAgICBjdXJyZW50VmFsdWUubGVuZ3RoLFxuICAgICAgICAgICAgICBmYWxzZSxcbiAgICAgICAgICAgICAgXy5pc0VtcHR5KHZhbHVlcylcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIG5ld1ZhbHVlID0gXy5kZWZhdWx0cyhuZXdWYWx1ZSwge1xuICAgICAgICAgICAgICB2YWx1ZTogXCJcIixcbiAgICAgICAgICAgICAgZGlzcGxheVZhbHVlOiBuZXdWYWx1ZS52YWx1ZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBjdXJyZW50QXR0cmlidXRlLmFkZFZhbHVlKG5ld1ZhbHVlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBBZGQgYSByb3cgYmVmb3JlIGFub3RoZXIgcm93XG4gICAgICpcbiAgICAgKiBAcGFyYW0gYXR0cmlidXRlSWQgc3RyaW5nIGF0dHJpYnV0ZSBhcnJheVxuICAgICAqIEBwYXJhbSB2YWx1ZXMgb2JqZWN0IHsgXCJhdHRyaWJ1dGVJZFwiIDogeyBcInZhbHVlXCIgOiAqLCBcImRpc3BsYXlWYWx1ZVwiIDogKiB9LCAuLi59XG4gICAgICogQHBhcmFtIGluZGV4IGludCBpbmRleCBvZiB0aGUgcm93XG4gICAgICovXG4gICAgaW5zZXJ0QmVmb3JlQXJyYXlSb3c6IGZ1bmN0aW9uIGRvY3VtZW50Q29udHJvbGxlckluc2VydEJlZm9yZUFycmF5Um93KFxuICAgICAgYXR0cmlidXRlSWQsXG4gICAgICB2YWx1ZXMsXG4gICAgICBpbmRleFxuICAgICkge1xuICAgICAgdGhpcy5fY2hlY2tJbml0aWFsaXNlZE1vZGVsKCk7XG4gICAgICB2YXIgYXR0cmlidXRlID0gdGhpcy5fZ2V0QXR0cmlidXRlTW9kZWwoYXR0cmlidXRlSWQpLFxuICAgICAgICBtYXhWYWx1ZTtcbiAgICAgIGlmICghYXR0cmlidXRlKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIlVuYWJsZSB0byBmaW5kIGF0dHJpYnV0ZSBcIiArIGF0dHJpYnV0ZUlkKTtcbiAgICAgIH1cbiAgICAgIGlmIChhdHRyaWJ1dGUuZ2V0KFwidHlwZVwiKSAhPT0gXCJhcnJheVwiKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICBcIkF0dHJpYnV0ZSBcIiArIGF0dHJpYnV0ZUlkICsgXCIgbXVzdCBiZSBhbiBhdHRyaWJ1dGUgb2YgdHlwZSBhcnJheVwiXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICBpZiAoIV8uaXNPYmplY3QodmFsdWVzKSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgXCJWYWx1ZXMgbXVzdCBiZSBhbiBvYmplY3Qgd2hlcmUgZWFjaCBwcm9wZXJ0aWVzIGlzIGFuIGF0dHJpYnV0ZSBvZiB0aGUgYXJyYXkgZm9yIFwiICtcbiAgICAgICAgICAgIGF0dHJpYnV0ZUlkXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICBtYXhWYWx1ZSA9IHRoaXMuX2dldE1heEluZGV4KGF0dHJpYnV0ZSk7XG4gICAgICBpZiAoaW5kZXggPCAwIHx8IGluZGV4ID4gbWF4VmFsdWUpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW5kZXggbXVzdCBiZSBiZXR3ZWVuIDAgYW5kIFwiICsgbWF4VmFsdWUpO1xuICAgICAgfVxuICAgICAgYXR0cmlidXRlXG4gICAgICAgIC5nZXQoXCJjb250ZW50XCIpXG4gICAgICAgIC5lYWNoKGZ1bmN0aW9uIGRvY3VtZW50Q29udHJvbGxlcl9hZGRBQ2VsbChjdXJyZW50QXR0cmlidXRlKSB7XG4gICAgICAgICAgdmFyIGN1cnJlbnRWYWx1ZSA9IHZhbHVlc1tjdXJyZW50QXR0cmlidXRlLmlkXTtcbiAgICAgICAgICBpZiAoIV8uaXNVbmRlZmluZWQoY3VycmVudFZhbHVlKSkge1xuICAgICAgICAgICAgY3VycmVudFZhbHVlID0gXy5kZWZhdWx0cyhjdXJyZW50VmFsdWUsIHtcbiAgICAgICAgICAgICAgdmFsdWU6IFwiXCIsXG4gICAgICAgICAgICAgIGRpc3BsYXlWYWx1ZTogY3VycmVudFZhbHVlLnZhbHVlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY3VycmVudFZhbHVlID0gY3VycmVudEF0dHJpYnV0ZS5hdHRyaWJ1dGVzLmRlZmF1bHRWYWx1ZTtcbiAgICAgICAgICAgIGlmICghY3VycmVudFZhbHVlKSB7XG4gICAgICAgICAgICAgIGN1cnJlbnRWYWx1ZSA9IHsgdmFsdWU6IFwiXCIsIGRpc3BsYXlWYWx1ZTogXCJcIiB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBjdXJyZW50QXR0cmlidXRlLmFkZEluZGV4ZWRWYWx1ZShjdXJyZW50VmFsdWUsIGluZGV4KTtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIFJlbW92ZSBhbiBhcnJheSByb3dcbiAgICAgKiBAcGFyYW0gYXR0cmlidXRlSWQgc3RyaW5nIGF0dHJpYnV0ZSBhcnJheVxuICAgICAqIEBwYXJhbSBpbmRleCBpbnQgaW5kZXggb2YgdGhlIHJvd1xuICAgICAqL1xuICAgIHJlbW92ZUFycmF5Um93OiBmdW5jdGlvbiBkb2N1bWVudENvbnRyb2xsZXJSZW1vdmVBcnJheVJvdyhcbiAgICAgIGF0dHJpYnV0ZUlkLFxuICAgICAgaW5kZXhcbiAgICApIHtcbiAgICAgIHRoaXMuX2NoZWNrSW5pdGlhbGlzZWRNb2RlbCgpO1xuICAgICAgdmFyIGF0dHJpYnV0ZSA9IHRoaXMuX2dldEF0dHJpYnV0ZU1vZGVsKGF0dHJpYnV0ZUlkKSxcbiAgICAgICAgbWF4SW5kZXg7XG4gICAgICBpZiAoIWF0dHJpYnV0ZSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJVbmFibGUgdG8gZmluZCBhdHRyaWJ1dGUgXCIgKyBhdHRyaWJ1dGVJZCk7XG4gICAgICB9XG4gICAgICBpZiAoYXR0cmlidXRlLmdldChcInR5cGVcIikgIT09IFwiYXJyYXlcIikge1xuICAgICAgICB0aHJvdyBFcnJvcihcbiAgICAgICAgICBcIkF0dHJpYnV0ZSBcIiArIGF0dHJpYnV0ZUlkICsgXCIgbXVzdCBiZSBhbiBhdHRyaWJ1dGUgb2YgdHlwZSBhcnJheVwiXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICBtYXhJbmRleCA9IHRoaXMuX2dldE1heEluZGV4KGF0dHJpYnV0ZSkgLSAxO1xuICAgICAgaWYgKGluZGV4IDwgMCB8fCBpbmRleCA+IG1heEluZGV4KSB7XG4gICAgICAgIHRocm93IEVycm9yKFxuICAgICAgICAgIFwiSW5kZXggbXVzdCBiZSBiZXR3ZWVuIDAgYW5kIFwiICsgbWF4SW5kZXggKyBcIiBmb3IgXCIgKyBhdHRyaWJ1dGVJZFxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgYXR0cmlidXRlXG4gICAgICAgIC5nZXQoXCJjb250ZW50XCIpXG4gICAgICAgIC5lYWNoKGZ1bmN0aW9uIGRvY3VtZW50Q29udHJvbGxlcl9yZW1vdmVBQ2VsbChjdXJyZW50QXR0cmlidXRlKSB7XG4gICAgICAgICAgY3VycmVudEF0dHJpYnV0ZS5yZW1vdmVJbmRleFZhbHVlKGluZGV4KTtcbiAgICAgICAgfSk7XG4gICAgICBhdHRyaWJ1dGUucmVtb3ZlSW5kZXhlZExpbmUoaW5kZXgpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBBZGQgYSBjb25zdHJhaW50IHRvIHRoZSB3aWRnZXRcbiAgICAgKlxuICAgICAqIEBwYXJhbSBvcHRpb25zIG9iamVjdCB7IFwibmFtZVwiIDogc3RyaW5nLCBcImRvY3VtZW50Q2hlY2tcIjogZnVuY3Rpb259XG4gICAgICogQHBhcmFtIGNhbGxiYWNrIGZ1bmN0aW9uIGNhbGxiYWNrIGNhbGxlZCB3aGVuIHRoZSBldmVudCBpcyB0cmlnZ2VyZWRcbiAgICAgKiBAcmV0dXJucyB7Kn1cbiAgICAgKi9cbiAgICBhZGRDb25zdHJhaW50OiBmdW5jdGlvbiBkb2N1bWVudENvbnRyb2xsZXJhZGRDb25zdHJhaW50KG9wdGlvbnMsIGNhbGxiYWNrKSB7XG4gICAgICB2YXIgY3VycmVudENvbnN0cmFpbnQsXG4gICAgICAgIGN1cnJlbnRXaWRnZXQgPSB0aGlzLFxuICAgICAgICB1bmlxdWVOYW1lO1xuICAgICAgaWYgKF8uaXNVbmRlZmluZWQoY2FsbGJhY2spICYmIF8uaXNGdW5jdGlvbihvcHRpb25zKSkge1xuICAgICAgICBjYWxsYmFjayA9IG9wdGlvbnM7XG4gICAgICAgIG9wdGlvbnMgPSB7fTtcbiAgICAgIH1cbiAgICAgIGlmIChfLmlzT2JqZWN0KG9wdGlvbnMpICYmIF8uaXNVbmRlZmluZWQoY2FsbGJhY2spKSB7XG4gICAgICAgIGlmICghb3B0aW9ucy5uYW1lKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICAgXCJXaGVuIGEgY29uc3RyYWludCBpcyBpbml0aWF0ZWQgd2l0aCBhIHNpbmdsZSBvYmplY3QsIHRoaXMgb2JqZWN0IG5lZWRzIHRvIGhhdmUgdGhlIG5hbWUgcHJvcGVydHkgXCIuSlNPTi5zdHJpbmdpZnkoXG4gICAgICAgICAgICAgIG9wdGlvbnNcbiAgICAgICAgICAgIClcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBfLmRlZmF1bHRzKG9wdGlvbnMsIHtcbiAgICAgICAgICBkb2N1bWVudENoZWNrOiBmdW5jdGlvbiBkb2N1bWVudENvbnRyb2xsZXJfZGVmYXVsdERvY3VtZW50Q2hlY2soKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGF0dHJpYnV0ZUNoZWNrOiBmdW5jdGlvbiBkb2N1bWVudENvbnRyb2xsZXJfZGVmYXVsdEF0dHJpYnV0ZUNoZWNrKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBjb25zdHJhaW50Q2hlY2s6IGNhbGxiYWNrLFxuICAgICAgICAgIG5hbWU6IF8udW5pcXVlSWQoXCJjb25zdHJhaW50XCIpLFxuICAgICAgICAgIGV4dGVybmFsQ29uc3RyYWludDogZmFsc2UsXG4gICAgICAgICAgb25jZTogZmFsc2VcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBjdXJyZW50Q29uc3RyYWludCA9IG9wdGlvbnM7XG4gICAgICBpZiAoIV8uaXNGdW5jdGlvbihjdXJyZW50Q29uc3RyYWludC5jb25zdHJhaW50Q2hlY2spKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkFuIGV2ZW50IG5lZWQgYSBjYWxsYmFja1wiKTtcbiAgICAgIH1cbiAgICAgIC8vSWYgY29uc3RyYWludCBpcyBvbmNlIDogd3JhcCBpdCBhbiBjYWxsYmFjayB0aGF0IGV4ZWN1dGUgY2FsbGJhY2sgYW5kIGRlbGV0ZSBpdFxuICAgICAgaWYgKGN1cnJlbnRDb25zdHJhaW50Lm9uY2UgPT09IHRydWUpIHtcbiAgICAgICAgY3VycmVudENvbnN0cmFpbnQuZXZlbnRDYWxsYmFjayA9IF8ud3JhcChcbiAgICAgICAgICBjdXJyZW50Q29uc3RyYWludC5jb25zdHJhaW50Q2hlY2ssXG4gICAgICAgICAgZnVuY3Rpb24gZG9jdW1lbnRDb250cm9sbGVyX29uY2VXcmFwcGVyKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICBjYWxsYmFjay5hcHBseSh0aGlzLCBfLnJlc3QoYXJndW1lbnRzKSk7XG4gICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjdXJyZW50V2lkZ2V0LnJlbW92ZUNvbnN0cmFpbnQoXG4gICAgICAgICAgICAgIGN1cnJlbnRDb25zdHJhaW50Lm5hbWUsXG4gICAgICAgICAgICAgIGN1cnJlbnRDb25zdHJhaW50LmV4dGVybmFsQ29uc3RyYWludFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICB1bmlxdWVOYW1lID1cbiAgICAgICAgKGN1cnJlbnRDb25zdHJhaW50LmV4dGVybmFsQ29uc3RyYWludCA/IFwiZXh0ZXJuYWxfXCIgOiBcImludGVybmFsX1wiKSArXG4gICAgICAgIGN1cnJlbnRDb25zdHJhaW50Lm5hbWU7XG4gICAgICB0aGlzLm9wdGlvbnMuY29uc3RyYWludExpc3RbdW5pcXVlTmFtZV0gPSBjdXJyZW50Q29uc3RyYWludDtcbiAgICAgIHRoaXMuX2luaXRBY3RpdmF0ZWRDb25zdHJhaW50KCk7XG4gICAgICByZXR1cm4gY3VycmVudENvbnN0cmFpbnQubmFtZTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogTGlzdCB0aGUgY29uc3RyYWludCBvZiB0aGUgd2lkZ2V0XG4gICAgICpcbiAgICAgKiBAcmV0dXJucyB7Kn1cbiAgICAgKi9cbiAgICBsaXN0Q29uc3RyYWludHM6IGZ1bmN0aW9uIGRvY3VtZW50Q29udHJvbGxlckxpc3RDb25zdHJhaW50KCkge1xuICAgICAgcmV0dXJuIHRoaXMub3B0aW9ucy5jb25zdHJhaW50TGlzdDtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogUmVtb3ZlIGEgY29uc3RyYWludCBvZiB0aGUgd2lkZ2V0XG4gICAgICpcbiAgICAgKiBAcGFyYW0gY29uc3RyYWludE5hbWVcbiAgICAgKiBAcGFyYW0gYWxsS2luZFxuICAgICAqIEByZXR1cm5zIHsqfVxuICAgICAqL1xuICAgIHJlbW92ZUNvbnN0cmFpbnQ6IGZ1bmN0aW9uIGRvY3VtZW50Q29udHJvbGxlclJlbW92ZUNvbnN0cmFpbnQoXG4gICAgICBjb25zdHJhaW50TmFtZSxcbiAgICAgIGFsbEtpbmRcbiAgICApIHtcbiAgICAgIHZhciByZW1vdmVkID0gW10sXG4gICAgICAgIG5ld0NvbnN0cmFpbnRMaXN0LFxuICAgICAgICBjb25zdHJhaW50TGlzdCxcbiAgICAgICAgdGVzdFJlZ0V4cCA9IG5ldyBSZWdFeHAoXCJcXFxcXCIgKyBjb25zdHJhaW50TmFtZSArIFwiJFwiKTtcbiAgICAgIC8vIGpzY3M6ZGlzYWJsZSBkaXNhbGxvd0ltcGxpY2l0VHlwZUNvbnZlcnNpb25cbiAgICAgIGFsbEtpbmQgPSAhIWFsbEtpbmQ7XG4gICAgICAvLyBqc2NzOmVuYWJsZSBkaXNhbGxvd0ltcGxpY2l0VHlwZUNvbnZlcnNpb25cbiAgICAgIG5ld0NvbnN0cmFpbnRMaXN0ID0gXy5maWx0ZXIoXG4gICAgICAgIHRoaXMub3B0aW9ucy5jb25zdHJhaW50TGlzdCxcbiAgICAgICAgZnVuY3Rpb24gZG9jdW1lbnRDb250cm9sbGVyX3JlbW92ZUNvbnN0cmFpbnQoY3VycmVudENvbnN0cmFpdCkge1xuICAgICAgICAgIGlmIChcbiAgICAgICAgICAgIChhbGxLaW5kIHx8ICFjdXJyZW50Q29uc3RyYWl0LmV4dGVybmFsQ29uc3RyYWludCkgJiZcbiAgICAgICAgICAgIChjdXJyZW50Q29uc3RyYWl0Lm5hbWUgPT09IGNvbnN0cmFpbnROYW1lIHx8XG4gICAgICAgICAgICAgIHRlc3RSZWdFeHAudGVzdChjdXJyZW50Q29uc3RyYWl0Lm5hbWUpKVxuICAgICAgICAgICkge1xuICAgICAgICAgICAgcmVtb3ZlZC5wdXNoKGN1cnJlbnRDb25zdHJhaXQpO1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgKTtcbiAgICAgIGNvbnN0cmFpbnRMaXN0ID0ge307XG4gICAgICBfLmVhY2goXG4gICAgICAgIG5ld0NvbnN0cmFpbnRMaXN0LFxuICAgICAgICBmdW5jdGlvbiBkb2N1bWVudENvbnRyb2xsZXJfcmVidWlsZENvbnN0cmFpbnRMaXN0KGN1cnJlbnRDb25zdHJhaW50KSB7XG4gICAgICAgICAgdmFyIHVuaXF1ZU5hbWUgPVxuICAgICAgICAgICAgKGN1cnJlbnRDb25zdHJhaW50LmV4dGVybmFsQ29uc3RyYWludCA/IFwiZXh0ZXJuYWxfXCIgOiBcImludGVybmFsX1wiKSArXG4gICAgICAgICAgICBjdXJyZW50Q29uc3RyYWludC5uYW1lO1xuICAgICAgICAgIGNvbnN0cmFpbnRMaXN0W3VuaXF1ZU5hbWVdID0gY3VycmVudENvbnN0cmFpbnQ7XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgICB0aGlzLm9wdGlvbnMuY29uc3RyYWludExpc3QgPSBjb25zdHJhaW50TGlzdDtcbiAgICAgIHRoaXMuX2luaXRBY3RpdmF0ZWRDb25zdHJhaW50KCk7XG4gICAgICByZXR1cm4gcmVtb3ZlZDtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQWRkIGFuIGV2ZW50IHRvIHRoZSB3aWRnZXRcbiAgICAgKlxuICAgICAqIEBwYXJhbSBldmVudFR5cGUgc3RyaW5nIGtpbmQgb2YgZXZlbnRcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyBvYmplY3QgeyBcIm5hbWVcIiA6IHN0cmluZywgXCJkb2N1bWVudENoZWNrXCI6IGZ1bmN0aW9ufVxuICAgICAqIEBwYXJhbSBjYWxsYmFjayBmdW5jdGlvbiBjYWxsYmFjayBjYWxsZWQgd2hlbiB0aGUgZXZlbnQgaXMgdHJpZ2dlcmVkXG4gICAgICogQHJldHVybnMgeyp8V2luZG93Lm9wdGlvbnMubmFtZX1cbiAgICAgKi9cbiAgICBhZGRFdmVudExpc3RlbmVyOiBmdW5jdGlvbiBkb2N1bWVudENvbnRyb2xsZXJBZGRFdmVudChcbiAgICAgIGV2ZW50VHlwZSxcbiAgICAgIG9wdGlvbnMsXG4gICAgICBjYWxsYmFja1xuICAgICkge1xuICAgICAgdmFyIGN1cnJlbnRFdmVudCxcbiAgICAgICAgY3VycmVudFdpZGdldCA9IHRoaXM7XG4gICAgICAvL29wdGlvbnMgaXMgbm90IG1hbmRhdG9yeSBhbmQgdGhlIGNhbGxiYWNrIGNhbiBiZSB0aGUgc2Vjb25kIHBhcmFtZXRlcnNcbiAgICAgIGlmIChfLmlzVW5kZWZpbmVkKGNhbGxiYWNrKSAmJiBfLmlzRnVuY3Rpb24ob3B0aW9ucykpIHtcbiAgICAgICAgY2FsbGJhY2sgPSBvcHRpb25zO1xuICAgICAgICBvcHRpb25zID0ge307XG4gICAgICB9XG4gICAgICAvLyB0aGUgZmlyc3QgcGFyYW1ldGVycyBjYW4gYmUgdGhlIGZpbmFsIG9iamVjdCAoY2hhaW4gcmVtb3ZlRXZlbnQgYW5kIGFkZEV2ZW50KVxuICAgICAgaWYgKFxuICAgICAgICBfLmlzT2JqZWN0KGV2ZW50VHlwZSkgJiZcbiAgICAgICAgXy5pc1VuZGVmaW5lZChvcHRpb25zKSAmJlxuICAgICAgICBfLmlzVW5kZWZpbmVkKGNhbGxiYWNrKVxuICAgICAgKSB7XG4gICAgICAgIGN1cnJlbnRFdmVudCA9IGV2ZW50VHlwZTtcbiAgICAgICAgaWYgKCFjdXJyZW50RXZlbnQubmFtZSkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAgIFwiV2hlbiBhbiBldmVudCBpcyBpbml0aWF0ZWQgd2l0aCBhIHNpbmdsZSBvYmplY3QsIHRoaXMgb2JqZWN0IG5lZWRzIHRvIGhhdmUgdGhlIG5hbWUgcHJvcGVydHkgXCIgK1xuICAgICAgICAgICAgICBKU09OLnN0cmluZ2lmeShjdXJyZW50RXZlbnQpXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY3VycmVudEV2ZW50ID0gXy5kZWZhdWx0cyhvcHRpb25zLCB7XG4gICAgICAgICAgbmFtZTogXy51bmlxdWVJZChcImV2ZW50X1wiICsgZXZlbnRUeXBlKSxcbiAgICAgICAgICBldmVudFR5cGU6IGV2ZW50VHlwZSxcbiAgICAgICAgICBldmVudENhbGxiYWNrOiBjYWxsYmFjayxcbiAgICAgICAgICBleHRlcm5hbEV2ZW50OiBmYWxzZSxcbiAgICAgICAgICBvbmNlOiBmYWxzZVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIC8vIHRoZSBldmVudFR5cGUgbXVzdCBiZSBvbmUgdGhlIGxpc3RcbiAgICAgIHRoaXMuX2NoZWNrRXZlbnROYW1lKGN1cnJlbnRFdmVudC5ldmVudFR5cGUpO1xuICAgICAgLy8gY2FsbGJhY2sgaXMgbWFuZGF0b3J5IGFuZCBtdXN0IGJlIGEgZnVuY3Rpb25cbiAgICAgIGlmICghXy5pc0Z1bmN0aW9uKGN1cnJlbnRFdmVudC5ldmVudENhbGxiYWNrKSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJBbiBldmVudCBuZWVkcyBhIGNhbGxiYWNrIHRoYXQgaXMgYSBmdW5jdGlvblwiKTtcbiAgICAgIH1cbiAgICAgIC8vSWYgZXZlbnQgaXMgb25jZSA6IHdyYXAgaXQgYW4gY2FsbGJhY2sgdGhhdCBleGVjdXRlIGV2ZW50IGFuZCBkZWxldGUgaXRcbiAgICAgIGlmIChjdXJyZW50RXZlbnQub25jZSA9PT0gdHJ1ZSkge1xuICAgICAgICBjdXJyZW50RXZlbnQuZXZlbnRDYWxsYmFjayA9IF8ud3JhcChcbiAgICAgICAgICBjdXJyZW50RXZlbnQuZXZlbnRDYWxsYmFjayxcbiAgICAgICAgICBmdW5jdGlvbiBkb2N1bWVudENvbnRyb2xsZXJfb25jZVdyYXBwZXIoY2FsbGJhY2spIHtcbiAgICAgICAgICAgIGN1cnJlbnRXaWRnZXQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcbiAgICAgICAgICAgICAgY3VycmVudEV2ZW50Lm5hbWUsXG4gICAgICAgICAgICAgIGN1cnJlbnRFdmVudC5leHRlcm5hbEV2ZW50XG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgY2FsbGJhY2suYXBwbHkodGhpcywgXy5yZXN0KGFyZ3VtZW50cykpO1xuICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuX2FkZEFuZEluaXROZXdFdmVudHMoY3VycmVudEV2ZW50KTtcbiAgICAgIC8vIHJldHVybiB0aGUgbmFtZSBvZiB0aGUgZXZlbnRcbiAgICAgIHJldHVybiBjdXJyZW50RXZlbnQubmFtZTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogTGlzdCBvZiB0aGUgZXZlbnRzIG9mIHRoZSBjdXJyZW50IHdpZGdldFxuICAgICAqXG4gICAgICogQHJldHVybnMgeyp9XG4gICAgICovXG4gICAgbGlzdEV2ZW50TGlzdGVuZXJzOiBmdW5jdGlvbiBkb2N1bWVudENvbnRyb2xsZXJMaXN0RXZlbnRzKCkge1xuICAgICAgcmV0dXJuIHRoaXMub3B0aW9ucy5ldmVudExpc3RlbmVyO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBSZW1vdmUgYW4gZXZlbnQgb2YgdGhlIGN1cnJlbnQgd2lkZ2V0XG4gICAgICpcbiAgICAgKiBAcGFyYW0gZXZlbnROYW1lIHN0cmluZyBjYW4gYmUgYW4gZXZlbnQgbmFtZSBvciBhIG5hbWVzcGFjZVxuICAgICAqIEBwYXJhbSBhbGxLaW5kIHJlbW92ZSBpbnRlcm5hbC9leHRlcm5hbCBldmVudHNcbiAgICAgKiBAcmV0dXJucyB7Kn1cbiAgICAgKi9cbiAgICByZW1vdmVFdmVudExpc3RlbmVyOiBmdW5jdGlvbiBkb2N1bWVudENvbnRyb2xsZXJSZW1vdmVFdmVudChcbiAgICAgIGV2ZW50TmFtZSxcbiAgICAgIGFsbEtpbmRcbiAgICApIHtcbiAgICAgIHZhciByZW1vdmVkID0gW10sXG4gICAgICAgIHRlc3RSZWdFeHAgPSBuZXcgUmVnRXhwKFwiXFxcXFwiICsgZXZlbnROYW1lICsgXCIkXCIpLFxuICAgICAgICBuZXdMaXN0LFxuICAgICAgICBldmVudExpc3Q7XG4gICAgICAvLyBqc2NzOmRpc2FibGVcbiAgICAgIGFsbEtpbmQgPSAhIWFsbEtpbmQ7XG4gICAgICAvLyBqc2NzOmVuYWJsZVxuICAgICAgbmV3TGlzdCA9IF8uZmlsdGVyKFxuICAgICAgICB0aGlzLm9wdGlvbnMuZXZlbnRMaXN0ZW5lcixcbiAgICAgICAgZnVuY3Rpb24gZG9jdW1lbnRDb250cm9sbGVyX3JlbW92ZUN1cnJlbnRFdmVudChjdXJyZW50RXZlbnQpIHtcbiAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAoYWxsS2luZCB8fCAhY3VycmVudEV2ZW50LmV4dGVybmFsRXZlbnQpICYmXG4gICAgICAgICAgICAoY3VycmVudEV2ZW50Lm5hbWUgPT09IGV2ZW50TmFtZSB8fFxuICAgICAgICAgICAgICB0ZXN0UmVnRXhwLnRlc3QoY3VycmVudEV2ZW50Lm5hbWUpKVxuICAgICAgICAgICkge1xuICAgICAgICAgICAgcmVtb3ZlZC5wdXNoKGN1cnJlbnRFdmVudCk7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICApO1xuICAgICAgZXZlbnRMaXN0ID0ge307XG4gICAgICBfLmVhY2gobmV3TGlzdCwgZnVuY3Rpb24gZG9jdW1lbnRDb250cm9sbGVyX19yZWJ1aWxkRXZlbnRMaXN0KFxuICAgICAgICBjdXJyZW50RXZlbnRcbiAgICAgICkge1xuICAgICAgICB2YXIgdW5pcXVlTmFtZSA9XG4gICAgICAgICAgKGN1cnJlbnRFdmVudC5leHRlcm5hbEV2ZW50ID8gXCJleHRlcm5hbF9cIiA6IFwiaW50ZXJuYWxfXCIpICtcbiAgICAgICAgICBjdXJyZW50RXZlbnQubmFtZTtcbiAgICAgICAgZXZlbnRMaXN0W3VuaXF1ZU5hbWVdID0gY3VycmVudEV2ZW50O1xuICAgICAgfSk7XG4gICAgICB0aGlzLm9wdGlvbnMuZXZlbnRMaXN0ZW5lciA9IGV2ZW50TGlzdDtcbiAgICAgIHRoaXMuX2luaXRBY3RpdmF0ZWRFdmVudExpc3RlbmVycyh7IGxhdW5jaFJlYWR5OiBmYWxzZSB9KTtcbiAgICAgIHJldHVybiByZW1vdmVkO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBUcmlnZ2VyIGFuIGV2ZW50XG4gICAgICpcbiAgICAgKiBAcGFyYW0gZXZlbnROYW1lXG4gICAgICovXG4gICAgdHJpZ2dlckV2ZW50OiBmdW5jdGlvbiBkb2N1bWVudENvbnRyb2xsZXJfdHJpZ2dlckV2ZW50KGV2ZW50TmFtZSkge1xuICAgICAgdmFyIGFyZ3MgPSBfLnRvQXJyYXkoYXJndW1lbnRzKTtcbiAgICAgIHRoaXMuX2NoZWNrSW5pdGlhbGlzZWRNb2RlbCgpO1xuICAgICAgdGhpcy5fY2hlY2tFdmVudE5hbWUoZXZlbnROYW1lKTtcblxuICAgICAgYXJncy5zcGxpY2UoMSwgMCwgbnVsbCk7IC8vIEFkZCBudWxsIG9yaWdpbmFsRXZlbnRcbiAgICAgIHJldHVybiB0aGlzLl90cmlnZ2VyQ29udHJvbGxlckV2ZW50LmFwcGx5KHRoaXMsIGFyZ3MpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBIaWRlIGEgdmlzaWJsZSBhdHRyaWJ1dGVcbiAgICAgKlxuICAgICAqIEBwYXJhbSBhdHRyaWJ1dGVJZFxuICAgICAqL1xuICAgIGhpZGVBdHRyaWJ1dGU6IGZ1bmN0aW9uIGRvY3VtZW50Q29udHJvbGxlckhpZGVBdHRyaWJ1dGUoYXR0cmlidXRlSWQpIHtcbiAgICAgIHRoaXMuX2NoZWNrSW5pdGlhbGlzZWRWaWV3KCk7XG4gICAgICB2YXIgYXR0cmlidXRlTW9kZWwgPSB0aGlzLl9nZXRBdHRyaWJ1dGVNb2RlbChhdHRyaWJ1dGVJZCk7XG4gICAgICBpZiAoIWF0dHJpYnV0ZU1vZGVsKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJVbmFibGUgZmluZCBhbmQgaGlkZSB0aGUgYXR0cmlidXRlIFwiICsgYXR0cmlidXRlSWQpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBhdHRyaWJ1dGVNb2RlbC50cmlnZ2VyKFwiaGlkZVwiKTtcbiAgICB9LFxuICAgIC8qKlxuICAgICAqIHNob3cgYSB2aXNpYmxlIGF0dHJpYnV0ZSAocHJldmlvdXNseSBoaWRkZW4pXG4gICAgICpcbiAgICAgKiBAcGFyYW0gYXR0cmlidXRlSWRcbiAgICAgKi9cbiAgICBzaG93QXR0cmlidXRlOiBmdW5jdGlvbiBkb2N1bWVudENvbnRyb2xsZXJTaG93QXR0cmlidXRlKGF0dHJpYnV0ZUlkKSB7XG4gICAgICB0aGlzLl9jaGVja0luaXRpYWxpc2VkVmlldygpO1xuICAgICAgdmFyIGF0dHJpYnV0ZU1vZGVsID0gdGhpcy5fZ2V0QXR0cmlidXRlTW9kZWwoYXR0cmlidXRlSWQpO1xuICAgICAgaWYgKCFhdHRyaWJ1dGVNb2RlbCkge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiVW5hYmxlIGZpbmQgYW5kIHNob3cgdGhlIGF0dHJpYnV0ZSBcIiArIGF0dHJpYnV0ZUlkKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgYXR0cmlidXRlTW9kZWwudHJpZ2dlcihcInNob3dcIik7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIERpc3BsYXkgYSBtZXNzYWdlIHRvIHRoZSB1c2VyXG4gICAgICpcbiAgICAgKiBAcGFyYW0gbWVzc2FnZVxuICAgICAqL1xuICAgIHNob3dNZXNzYWdlOiBmdW5jdGlvbiBkb2N1bWVudENvbnRyb2xsZXJTaG93TWVzc2FnZShtZXNzYWdlKSB7XG4gICAgICB0aGlzLl9jaGVja0luaXRpYWxpc2VkVmlldygpO1xuICAgICAgaWYgKF8uaXNTdHJpbmcobWVzc2FnZSkpIHtcbiAgICAgICAgbWVzc2FnZSA9IHtcbiAgICAgICAgICB0eXBlOiBcImluZm9cIixcbiAgICAgICAgICBtZXNzYWdlOiBtZXNzYWdlXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICBpZiAoXy5pc09iamVjdChtZXNzYWdlKSkge1xuICAgICAgICBtZXNzYWdlID0gXy5kZWZhdWx0cyhtZXNzYWdlLCB7XG4gICAgICAgICAgdHlwZTogXCJpbmZvXCJcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICB0aGlzLiRub3RpZmljYXRpb24uZGNwTm90aWZpY2F0aW9uKFwic2hvd1wiLCBtZXNzYWdlLnR5cGUsIG1lc3NhZ2UpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBEaXNwbGF5IGxvYWRpbmcgYmFyXG4gICAgICpcbiAgICAgKiBAcGFyYW0gbWVzc2FnZVxuICAgICAqIEBwYXJhbSBweFxuICAgICAqL1xuICAgIG1hc2tEb2N1bWVudDogZnVuY3Rpb24gZG9jdW1lbnRDb250cm9sbGVyKG1lc3NhZ2UsIHB4KSB7XG4gICAgICB0aGlzLiRsb2FkaW5nLmRjcExvYWRpbmcoXCJzaG93XCIpO1xuICAgICAgaWYgKG1lc3NhZ2UpIHtcbiAgICAgICAgdGhpcy4kbG9hZGluZy5kY3BMb2FkaW5nKFwic2V0VGl0bGVcIiwgbWVzc2FnZSk7XG4gICAgICB9XG4gICAgICBpZiAocHgpIHtcbiAgICAgICAgdGhpcy4kbG9hZGluZy5kY3BMb2FkaW5nKFwic2V0UGVyY2VudFwiLCBweCk7XG4gICAgICB9XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEhpZGUgbG9hZGluZyBiYXJcbiAgICAgKi9cbiAgICB1bm1hc2tEb2N1bWVudDogZnVuY3Rpb24gZG9jdW1lbnRDb250cm9sbGVyX3VubWFza0RvY3VtZW50KGZvcmNlKSB7XG4gICAgICB0aGlzLiRsb2FkaW5nLmRjcExvYWRpbmcoXCJoaWRlXCIsIGZvcmNlKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQWRkIGFuIGVycm9yIG1lc3NhZ2UgdG8gYW4gYXR0cmlidXRlXG4gICAgICpcbiAgICAgKiBAcGFyYW0gYXR0cmlidXRlSWRcbiAgICAgKiBAcGFyYW0gbWVzc2FnZVxuICAgICAqIEBwYXJhbSBpbmRleFxuICAgICAqL1xuICAgIHNldEF0dHJpYnV0ZUVycm9yTWVzc2FnZTogZnVuY3Rpb24gZG9jdW1lbnRDb250cm9sbGVyc2V0QXR0cmlidXRlRXJyb3JNZXNzYWdlKFxuICAgICAgYXR0cmlidXRlSWQsXG4gICAgICBtZXNzYWdlLFxuICAgICAgaW5kZXhcbiAgICApIHtcbiAgICAgIHRoaXMuX2NoZWNrSW5pdGlhbGlzZWRWaWV3KCk7XG4gICAgICB2YXIgYXR0cmlidXRlTW9kZWwgPSB0aGlzLl9nZXRBdHRyaWJ1dGVNb2RlbChhdHRyaWJ1dGVJZCk7XG4gICAgICBpZiAoIWF0dHJpYnV0ZU1vZGVsKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJVbmFibGUgZmluZCBhbmQgc2hvdyB0aGUgYXR0cmlidXRlIFwiICsgYXR0cmlidXRlSWQpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBhdHRyaWJ1dGVNb2RlbC5zZXRFcnJvck1lc3NhZ2UobWVzc2FnZSwgaW5kZXgpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBDbGVhbiB0aGUgZXJyb3IgbWVzc2FnZSBvZiBhbiBhdHRyaWJ1dGVcbiAgICAgKlxuICAgICAqIEBwYXJhbSBhdHRyaWJ1dGVJZFxuICAgICAqIEBwYXJhbSBpbmRleFxuICAgICAqL1xuICAgIGNsZWFuQXR0cmlidXRlRXJyb3JNZXNzYWdlOiBmdW5jdGlvbiBkb2N1bWVudENvbnRyb2xsZXJjbGVhbkF0dHJpYnV0ZUVycm9yTWVzc2FnZShcbiAgICAgIGF0dHJpYnV0ZUlkLFxuICAgICAgaW5kZXhcbiAgICApIHtcbiAgICAgIHRoaXMuX2NoZWNrSW5pdGlhbGlzZWRWaWV3KCk7XG4gICAgICB2YXIgYXR0cmlidXRlTW9kZWwgPSB0aGlzLl9nZXRBdHRyaWJ1dGVNb2RlbChhdHRyaWJ1dGVJZCk7XG4gICAgICBpZiAoIWF0dHJpYnV0ZU1vZGVsKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJVbmFibGUgZmluZCBhbmQgc2hvdyB0aGUgYXR0cmlidXRlIFwiICsgYXR0cmlidXRlSWQpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBhdHRyaWJ1dGVNb2RlbC5zZXRFcnJvck1lc3NhZ2UobnVsbCwgaW5kZXgpO1xuICAgIH0sXG5cbiAgICBpbmplY3RDU1M6IGZ1bmN0aW9uIGRvY3VtZW50Q29udHJvbGxlcl9pbmplY3RDU1MoY3NzVG9JbmplY3QpIHtcbiAgICAgIHRoaXMuX2NoZWNrSW5pdGlhbGlzZWRWaWV3KCk7XG4gICAgICBpZiAoIV8uaXNBcnJheShjc3NUb0luamVjdCkgJiYgIV8uaXNTdHJpbmcoY3NzVG9JbmplY3QpKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICBcIlRoZSBjc3MgdG8gaW5qZWN0IG11c3QgYmUgYW4gYXJyYXkgc3RyaW5nIG9yIGEgc3RyaW5nXCJcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIGlmIChfLmlzU3RyaW5nKGNzc1RvSW5qZWN0KSkge1xuICAgICAgICBjc3NUb0luamVjdCA9IFtjc3NUb0luamVjdF07XG4gICAgICB9XG5cbiAgICAgIHRoaXMuX21vZGVsLmluamVjdENTUyhjc3NUb0luamVjdCk7XG4gICAgfSxcblxuICAgIGluamVjdEpTOiBmdW5jdGlvbiBkb2N1bWVudENvbnRyb2xsZXJfaW5qZWN0Q1NTKGpzVG9JbmplY3QpIHtcbiAgICAgIHRoaXMuX2NoZWNrSW5pdGlhbGlzZWRWaWV3KCk7XG4gICAgICBpZiAoIV8uaXNBcnJheShqc1RvSW5qZWN0KSAmJiAhXy5pc1N0cmluZyhqc1RvSW5qZWN0KSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJUaGUganMgdG8gaW5qZWN0IG11c3QgYmUgYW4gYXJyYXkgc3RyaW5nIG9yIGEgc3RyaW5nXCIpO1xuICAgICAgfVxuICAgICAgaWYgKF8uaXNTdHJpbmcoanNUb0luamVjdCkpIHtcbiAgICAgICAganNUb0luamVjdCA9IFtqc1RvSW5qZWN0XTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHRoaXMuX21vZGVsLmluamVjdEpTKGpzVG9JbmplY3QpO1xuICAgIH0sXG4gICAgLyoqXG4gICAgICogdHJ5VG9EZXN0cm95IHRoZSB3aWRnZXRcbiAgICAgKlxuICAgICAqIEByZXR1cm4gUHJvbWlzZVxuICAgICAqL1xuICAgIHRyeVRvRGVzdHJveTogZnVuY3Rpb24gZG9jdW1lbnRDb250cm9sbGVyX3RyeVRvRGVzdHJveSgpIHtcbiAgICAgIHZhciBjdXJyZW50V2lkZ2V0ID0gdGhpcztcbiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiBkb2N1bWVudENvbnRyb2xsZXJfcHJvbWlzZURlc3Ryb3koXG4gICAgICAgIHJlc29sdmUsXG4gICAgICAgIHJlamVjdFxuICAgICAgKSB7XG4gICAgICAgIHZhciBldmVudCA9IHsgcHJldmVudDogZmFsc2UgfTtcbiAgICAgICAgaWYgKCFjdXJyZW50V2lkZ2V0Ll9tb2RlbCkge1xuICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKFxuICAgICAgICAgIGN1cnJlbnRXaWRnZXQuX21vZGVsICYmXG4gICAgICAgICAgY3VycmVudFdpZGdldC5fbW9kZWwuaXNNb2RpZmllZCgpICYmXG4gICAgICAgICAgIXdpbmRvdy5jb25maXJtKFxuICAgICAgICAgICAgY3VycmVudFdpZGdldC5fbW9kZWwuZ2V0KFwicHJvcGVydGllc1wiKS5nZXQoXCJ0aXRsZVwiKSArXG4gICAgICAgICAgICAgIFwiXFxuXCIgK1xuICAgICAgICAgICAgICBpMThuLl9fXyhcbiAgICAgICAgICAgICAgICBcIlRoZSBmb3JtIGhhcyBiZWVuIG1vZGlmaWVkIHdpdGhvdXQgc2F2aW5nLCBkbyB5b3Ugd2FudCB0byBjbG9zZSBpdCA/XCIsXG4gICAgICAgICAgICAgICAgXCJkZHVpXCJcbiAgICAgICAgICAgICAgKVxuICAgICAgICAgIClcbiAgICAgICAgKSB7XG4gICAgICAgICAgcmVqZWN0KFwiVW5hYmxlIHRvIGRlc3Ryb3kgYmVjYXVzZSB1c2VyIHJlZnVzZXMgaXRcIik7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGV2ZW50LnByZXZlbnQgPSAhY3VycmVudFdpZGdldC5fdHJpZ2dlckNvbnRyb2xsZXJFdmVudChcbiAgICAgICAgICBcImJlZm9yZUNsb3NlXCIsXG4gICAgICAgICAgbnVsbCxcbiAgICAgICAgICBjdXJyZW50V2lkZ2V0Ll9tb2RlbC5nZXRTZXJ2ZXJQcm9wZXJ0aWVzKClcbiAgICAgICAgKTtcbiAgICAgICAgaWYgKGV2ZW50LnByZXZlbnQpIHtcbiAgICAgICAgICByZWplY3QoXCJVbmFibGUgdG8gZGVzdHJveSBiZWNhdXNlIGJlZm9yZSBjbG9zZSByZWZ1c2VzIGl0XCIpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICByZXNvbHZlKCk7XG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIHJldHVybiAkLmZuLmRvY3VtZW50Q29udHJvbGxlcjtcbn0pO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///63e285088893d0390ab6\n");

/***/ }),

/***/ "652c2ab97314f0cc36e3":
/*!****************************************************************!*\
  !*** ./src/Apps/DOCUMENT/IHM/views/document/header/vHeader.js ***!
  \****************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/*global define*/\n!(__WEBPACK_AMD_DEFINE_ARRAY__ = [\n  __webpack_require__(/*! jquery */ \"127c8cf59f228bb01a21\"),\n  __webpack_require__(/*! underscore */ \"8e08e542008e4aef1f58\"),\n  __webpack_require__(/*! backbone */ \"1858b45bf48591489d06\"),\n  __webpack_require__(/*! mustache */ \"bcd31d01884fc294fd69\")\n], __WEBPACK_AMD_DEFINE_RESULT__ = (function require_vheader($, _, Backbone, Mustache) {\n  \"use strict\";\n\n  return Backbone.View.extend({\n    className: \"dcpDocument\",\n\n    /**\n     * The current model is the document model\n     * The header template comes from template \"sections/header\"\n     */\n    headerTemplate: null,\n\n    initialize: function vHeaderInitialize() {\n      this.listenTo(this.model.get(\"properties\"), \"change\", this.updateHeader);\n      this.listenTo(this.model, \"destroy\", this.remove);\n      this.listenTo(this.model, \"cleanView\", this.remove);\n      this.listenTo(this.model, \"changeValue\", this.documentHasChanged);\n      this.headerTemplate = this.getTemplates(\"sections\").header;\n    },\n\n    /**\n     * apply mustache template to inner content\n     * @returns {*}\n     */\n    render: function vheaderRender() {\n      var currentView = this;\n      return new Promise(\n        _.bind(function vheaderRenderPromise(resolve, reject) {\n          try {\n            var data = currentView.model.toData(),\n              properties = currentView.model.getModelProperties(),\n              security = properties.security || false;\n\n            data.document.properties = properties;\n\n            data.document.properties.security = security || {\n              lock: { lockedBy: null }\n            };\n            data.document.properties.security.lock.isLocked =\n              data.document.properties.security.lock.lockedBy &&\n              data.document.properties.security.lock.lockedBy.id > 0;\n\n            var headerRender = $(\n              Mustache.render(currentView.headerTemplate || \"\", data)\n            );\n            var $header = currentView.$el;\n            $header.empty();\n            _.each(headerRender.children(), function eachChildren(elt) {\n              $header.append(elt);\n            });\n\n            $header\n              .find(\n                \".dcpDocument__header__lock, .dcpDocument__header__readonly, .dcpDocument__header__modified\"\n              )\n              .tooltip({\n                placement: \"bottom\",\n                html: true\n              });\n\n            return resolve(currentView);\n          } catch (e) {\n            reject(e);\n          }\n        }, this)\n      );\n    },\n\n    /**\n     * reset mustache template\n     * update window title also\n     * @returns {*}\n     */\n    updateHeader: function vheaderUpdateHeader() {\n      var doctitle = this.model.get(\"properties\").get(\"title\");\n      if (doctitle) {\n        window.document.title = doctitle;\n      }\n      return this.render();\n    },\n\n    getTemplates: function vheadergetTemplates(key) {\n      var templates = {};\n      if (this.model && this.model.get(\"templates\")) {\n        templates = this.model.get(\"templates\");\n      }\n      if (templates[key]) {\n        return templates[key];\n      }\n      if (window.dcp && window.dcp.templates && window.dcp.templates[key]) {\n        return window.dcp.templates[key];\n      }\n      throw new Error(\"Unknown template  \" + key);\n    },\n    documentHasChanged: function vheaderdocumentHasChanged() {\n      var wTitle = window.document.title.replace(/^\\*+/g, \"\");\n\n      if (this.model.hasAttributesChanged()) {\n        this.$el.find(\".dcpDocument__header__modified\").show();\n        window.document.title = \"*\" + wTitle;\n      } else {\n        this.$el.find(\".dcpDocument__header__modified\").hide();\n        window.document.title = wTitle;\n      }\n      if (this.model.hasUploadingFile()) {\n        this.$el.find(\".dcpDocument__header__modified\").addClass(\"fa-spin\");\n      } else {\n        this.$el.find(\".dcpDocument__header__modified\").removeClass(\"fa-spin\");\n      }\n    }\n  });\n}).apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNjUyYzJhYjk3MzE0ZjBjYzM2ZTMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvQXBwcy9ET0NVTUVOVC9JSE0vdmlld3MvZG9jdW1lbnQvaGVhZGVyL3ZIZWFkZXIuanM/ZmZjMiJdLCJzb3VyY2VzQ29udGVudCI6WyIvKmdsb2JhbCBkZWZpbmUqL1xuZGVmaW5lKFtcbiAgXCJqcXVlcnlcIixcbiAgXCJ1bmRlcnNjb3JlXCIsXG4gIFwiYmFja2JvbmVcIixcbiAgXCJtdXN0YWNoZVwiXG5dLCBmdW5jdGlvbiByZXF1aXJlX3ZoZWFkZXIoJCwgXywgQmFja2JvbmUsIE11c3RhY2hlKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIHJldHVybiBCYWNrYm9uZS5WaWV3LmV4dGVuZCh7XG4gICAgY2xhc3NOYW1lOiBcImRjcERvY3VtZW50XCIsXG5cbiAgICAvKipcbiAgICAgKiBUaGUgY3VycmVudCBtb2RlbCBpcyB0aGUgZG9jdW1lbnQgbW9kZWxcbiAgICAgKiBUaGUgaGVhZGVyIHRlbXBsYXRlIGNvbWVzIGZyb20gdGVtcGxhdGUgXCJzZWN0aW9ucy9oZWFkZXJcIlxuICAgICAqL1xuICAgIGhlYWRlclRlbXBsYXRlOiBudWxsLFxuXG4gICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gdkhlYWRlckluaXRpYWxpemUoKSB7XG4gICAgICB0aGlzLmxpc3RlblRvKHRoaXMubW9kZWwuZ2V0KFwicHJvcGVydGllc1wiKSwgXCJjaGFuZ2VcIiwgdGhpcy51cGRhdGVIZWFkZXIpO1xuICAgICAgdGhpcy5saXN0ZW5Ubyh0aGlzLm1vZGVsLCBcImRlc3Ryb3lcIiwgdGhpcy5yZW1vdmUpO1xuICAgICAgdGhpcy5saXN0ZW5Ubyh0aGlzLm1vZGVsLCBcImNsZWFuVmlld1wiLCB0aGlzLnJlbW92ZSk7XG4gICAgICB0aGlzLmxpc3RlblRvKHRoaXMubW9kZWwsIFwiY2hhbmdlVmFsdWVcIiwgdGhpcy5kb2N1bWVudEhhc0NoYW5nZWQpO1xuICAgICAgdGhpcy5oZWFkZXJUZW1wbGF0ZSA9IHRoaXMuZ2V0VGVtcGxhdGVzKFwic2VjdGlvbnNcIikuaGVhZGVyO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBhcHBseSBtdXN0YWNoZSB0ZW1wbGF0ZSB0byBpbm5lciBjb250ZW50XG4gICAgICogQHJldHVybnMgeyp9XG4gICAgICovXG4gICAgcmVuZGVyOiBmdW5jdGlvbiB2aGVhZGVyUmVuZGVyKCkge1xuICAgICAgdmFyIGN1cnJlbnRWaWV3ID0gdGhpcztcbiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShcbiAgICAgICAgXy5iaW5kKGZ1bmN0aW9uIHZoZWFkZXJSZW5kZXJQcm9taXNlKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICB2YXIgZGF0YSA9IGN1cnJlbnRWaWV3Lm1vZGVsLnRvRGF0YSgpLFxuICAgICAgICAgICAgICBwcm9wZXJ0aWVzID0gY3VycmVudFZpZXcubW9kZWwuZ2V0TW9kZWxQcm9wZXJ0aWVzKCksXG4gICAgICAgICAgICAgIHNlY3VyaXR5ID0gcHJvcGVydGllcy5zZWN1cml0eSB8fCBmYWxzZTtcblxuICAgICAgICAgICAgZGF0YS5kb2N1bWVudC5wcm9wZXJ0aWVzID0gcHJvcGVydGllcztcblxuICAgICAgICAgICAgZGF0YS5kb2N1bWVudC5wcm9wZXJ0aWVzLnNlY3VyaXR5ID0gc2VjdXJpdHkgfHwge1xuICAgICAgICAgICAgICBsb2NrOiB7IGxvY2tlZEJ5OiBudWxsIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBkYXRhLmRvY3VtZW50LnByb3BlcnRpZXMuc2VjdXJpdHkubG9jay5pc0xvY2tlZCA9XG4gICAgICAgICAgICAgIGRhdGEuZG9jdW1lbnQucHJvcGVydGllcy5zZWN1cml0eS5sb2NrLmxvY2tlZEJ5ICYmXG4gICAgICAgICAgICAgIGRhdGEuZG9jdW1lbnQucHJvcGVydGllcy5zZWN1cml0eS5sb2NrLmxvY2tlZEJ5LmlkID4gMDtcblxuICAgICAgICAgICAgdmFyIGhlYWRlclJlbmRlciA9ICQoXG4gICAgICAgICAgICAgIE11c3RhY2hlLnJlbmRlcihjdXJyZW50Vmlldy5oZWFkZXJUZW1wbGF0ZSB8fCBcIlwiLCBkYXRhKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIHZhciAkaGVhZGVyID0gY3VycmVudFZpZXcuJGVsO1xuICAgICAgICAgICAgJGhlYWRlci5lbXB0eSgpO1xuICAgICAgICAgICAgXy5lYWNoKGhlYWRlclJlbmRlci5jaGlsZHJlbigpLCBmdW5jdGlvbiBlYWNoQ2hpbGRyZW4oZWx0KSB7XG4gICAgICAgICAgICAgICRoZWFkZXIuYXBwZW5kKGVsdCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgJGhlYWRlclxuICAgICAgICAgICAgICAuZmluZChcbiAgICAgICAgICAgICAgICBcIi5kY3BEb2N1bWVudF9faGVhZGVyX19sb2NrLCAuZGNwRG9jdW1lbnRfX2hlYWRlcl9fcmVhZG9ubHksIC5kY3BEb2N1bWVudF9faGVhZGVyX19tb2RpZmllZFwiXG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgLnRvb2x0aXAoe1xuICAgICAgICAgICAgICAgIHBsYWNlbWVudDogXCJib3R0b21cIixcbiAgICAgICAgICAgICAgICBodG1sOiB0cnVlXG4gICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gcmVzb2x2ZShjdXJyZW50Vmlldyk7XG4gICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgcmVqZWN0KGUpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSwgdGhpcylcbiAgICAgICk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIHJlc2V0IG11c3RhY2hlIHRlbXBsYXRlXG4gICAgICogdXBkYXRlIHdpbmRvdyB0aXRsZSBhbHNvXG4gICAgICogQHJldHVybnMgeyp9XG4gICAgICovXG4gICAgdXBkYXRlSGVhZGVyOiBmdW5jdGlvbiB2aGVhZGVyVXBkYXRlSGVhZGVyKCkge1xuICAgICAgdmFyIGRvY3RpdGxlID0gdGhpcy5tb2RlbC5nZXQoXCJwcm9wZXJ0aWVzXCIpLmdldChcInRpdGxlXCIpO1xuICAgICAgaWYgKGRvY3RpdGxlKSB7XG4gICAgICAgIHdpbmRvdy5kb2N1bWVudC50aXRsZSA9IGRvY3RpdGxlO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRoaXMucmVuZGVyKCk7XG4gICAgfSxcblxuICAgIGdldFRlbXBsYXRlczogZnVuY3Rpb24gdmhlYWRlcmdldFRlbXBsYXRlcyhrZXkpIHtcbiAgICAgIHZhciB0ZW1wbGF0ZXMgPSB7fTtcbiAgICAgIGlmICh0aGlzLm1vZGVsICYmIHRoaXMubW9kZWwuZ2V0KFwidGVtcGxhdGVzXCIpKSB7XG4gICAgICAgIHRlbXBsYXRlcyA9IHRoaXMubW9kZWwuZ2V0KFwidGVtcGxhdGVzXCIpO1xuICAgICAgfVxuICAgICAgaWYgKHRlbXBsYXRlc1trZXldKSB7XG4gICAgICAgIHJldHVybiB0ZW1wbGF0ZXNba2V5XTtcbiAgICAgIH1cbiAgICAgIGlmICh3aW5kb3cuZGNwICYmIHdpbmRvdy5kY3AudGVtcGxhdGVzICYmIHdpbmRvdy5kY3AudGVtcGxhdGVzW2tleV0pIHtcbiAgICAgICAgcmV0dXJuIHdpbmRvdy5kY3AudGVtcGxhdGVzW2tleV07XG4gICAgICB9XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJVbmtub3duIHRlbXBsYXRlICBcIiArIGtleSk7XG4gICAgfSxcbiAgICBkb2N1bWVudEhhc0NoYW5nZWQ6IGZ1bmN0aW9uIHZoZWFkZXJkb2N1bWVudEhhc0NoYW5nZWQoKSB7XG4gICAgICB2YXIgd1RpdGxlID0gd2luZG93LmRvY3VtZW50LnRpdGxlLnJlcGxhY2UoL15cXCorL2csIFwiXCIpO1xuXG4gICAgICBpZiAodGhpcy5tb2RlbC5oYXNBdHRyaWJ1dGVzQ2hhbmdlZCgpKSB7XG4gICAgICAgIHRoaXMuJGVsLmZpbmQoXCIuZGNwRG9jdW1lbnRfX2hlYWRlcl9fbW9kaWZpZWRcIikuc2hvdygpO1xuICAgICAgICB3aW5kb3cuZG9jdW1lbnQudGl0bGUgPSBcIipcIiArIHdUaXRsZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuJGVsLmZpbmQoXCIuZGNwRG9jdW1lbnRfX2hlYWRlcl9fbW9kaWZpZWRcIikuaGlkZSgpO1xuICAgICAgICB3aW5kb3cuZG9jdW1lbnQudGl0bGUgPSB3VGl0bGU7XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5tb2RlbC5oYXNVcGxvYWRpbmdGaWxlKCkpIHtcbiAgICAgICAgdGhpcy4kZWwuZmluZChcIi5kY3BEb2N1bWVudF9faGVhZGVyX19tb2RpZmllZFwiKS5hZGRDbGFzcyhcImZhLXNwaW5cIik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLiRlbC5maW5kKFwiLmRjcERvY3VtZW50X19oZWFkZXJfX21vZGlmaWVkXCIpLnJlbW92ZUNsYXNzKFwiZmEtc3BpblwiKTtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xufSk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///652c2ab97314f0cc36e3\n");

/***/ }),

/***/ "67953bae88ec8fa1ab26":
/*!***********************************************************!*\
  !*** ./src/Apps/DOCUMENT/IHM/widgets/history/wHistory.js ***!
  \***********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;!(__WEBPACK_AMD_DEFINE_ARRAY__ = [\n  __webpack_require__(/*! jquery */ \"127c8cf59f228bb01a21\"),\n  __webpack_require__(/*! underscore */ \"8e08e542008e4aef1f58\"),\n  __webpack_require__(/*! mustache */ \"bcd31d01884fc294fd69\"),\n  __webpack_require__(/*! dcpDocument/widgets/widget */ \"f562ab9f022eef93542c\"),\n  __webpack_require__(/*! dcpDocument/widgets/history/wRevisionDiff */ \"5d1c50599007150199da\"),\n  __webpack_require__(/*! dcpDocument/widgets/window/wDialog */ \"0bd0aa4c1909a49f67bb\")\n], __WEBPACK_AMD_DEFINE_RESULT__ = (function require_whistory($, _, Mustache) {\n  \"use strict\";\n\n  $.widget(\"dcp.dcpDocumentHistory\", $.dcp.dcpDialog, {\n    options: {\n      documentId: 0,\n      window: {\n        modal: true,\n        title: \"Document history\"\n      },\n      labels: {\n        version: \"Version\",\n        revision: \"Rev\",\n        state: \"State\",\n        activity: \"Activity\",\n        owner: \"Owner\",\n        code: \"Code\",\n        date: \"Date\",\n        diff: \"Diff\",\n        level: \"Level\",\n        message: \"Message\",\n        pastRevision: \"\",\n        showDetail: \"Show details\",\n        hideDetail: \"Hide details\",\n        showNotice: \"Show notices\",\n        hideNotice: \"Hide notices\",\n        noOneNotice: \"No one notices\",\n        filterMessages: \"Filter messages\",\n        linkRevision: \"See revision number #\",\n        historyTitle: \"History for {{title}}\",\n        loading: \"Loading ...\",\n        revisionDiffLabels: {}\n      }\n    },\n    htmlCaneva: function dcpDocumentHistoryhtmlCaneva() {\n      return (\n        '<table class=\"history-main\"><thead>' +\n        '<tr class=\"history-header\">' +\n        '<th class=\"history-header--date\"/>' +\n        '<th class=\"history-header--message\"/>' +\n        '<th class=\"history-header--owner\"/>' +\n        '<th class=\"history-header--version\"/>' +\n        '<th class=\"history-header--revision\"/>' +\n        '<th class=\"history-header--code\"/>' +\n        '<th class=\"history-header--level\"/>' +\n        '<th class=\"history-header--diff\"/>' +\n        \"</tr>\" +\n        \"</thead></table>\"\n      );\n    },\n\n    element: null,\n    _create: function dcpDocumentHistory_create() {\n      var widget = this,\n        $widget = $(this);\n\n      this.element.html(this.htmlCaneva());\n      __webpack_require__.e(/*! require.ensure | ensureDatatables */ \"vendors~ensureDatatables\").then((function dcpDocumentWHistory_initTable() {\n          __webpack_require__(/*! datatables.net-bs4/css/dataTables.bootstrap4.css */ \"ac0cf2e8e04136065d45\");\n          __webpack_require__(/*! datatables */ \"7006cf2c262b498f6c83\");\n          widget._initDatatable();\n        }).bind(null, __webpack_require__)).catch(__webpack_require__.oe);\n\n      this.element.data(\"dcpDocumentHistory\", this);\n\n      this._super();\n\n      this.element.on(\n        \"click\" + this.eventNamespace,\n        \".history-button-showdetail\",\n        function whistoryShowDetail() {\n          var noticeButton = widget.element.find(\".history-button-shownotice\");\n          var noticeShowed = noticeButton.data(\"showNotice\");\n          if ($widget.data(\"showDetail\")) {\n            $widget.data(\"showDetail\", false);\n            $widget.data(\"showNotice\", false);\n            $(this)\n              .text(widget.options.labels.showDetail)\n              .removeClass(\"btn-primary\");\n            widget.element.find(\".history-comment\").hide();\n\n            noticeButton\n              .attr(\"disabled\", \"disabled\")\n              .removeClass(\"btn-primary\")\n              .text(widget.options.labels.showNotice);\n          } else {\n            $widget.data(\"showDetail\", true);\n            widget.element.find(\".history-comment\").show();\n            if (!noticeShowed) {\n              widget.element.find(\".history-level--notice\").hide();\n            }\n            $(this)\n              .text(widget.options.labels.hideDetail)\n              .addClass(\"btn-primary\");\n            noticeButton.removeAttr(\"disabled\");\n          }\n        }\n      );\n      this.element.on(\n        \"click\" + this.eventNamespace,\n        \".history-button-shownotice\",\n        function whistoryShowNotice() {\n          var $notices = widget.element.find(\".history-level--notice\");\n          if ($widget.data(\"showNotice\")) {\n            $widget.data(\"showNotice\", false);\n            $(this)\n              .text(widget.options.labels.showNotice)\n              .removeClass(\"btn-primary\");\n            widget.element.find(\".history-level--notice\").hide();\n          } else {\n            $widget.data(\"showNotice\", true);\n            if ($notices.length > 0) {\n              $notices.show();\n              $(this)\n                .text(widget.options.labels.hideNotice)\n                .addClass(\"btn-primary\");\n            } else {\n              $(this).text(widget.options.labels.noOneNotice);\n            }\n          }\n        }\n      );\n      this.element.on(\n        \"click\" + this.eventNamespace,\n        \".history-diff-input\",\n        function whistoryShowDiff() {\n          var selectedDiff = widget.element.find(\".history-diff-input:checked\");\n\n          if (selectedDiff.length === 2) {\n            widget.element\n              .find(\".history-diff-input:not(:checked)\")\n              .attr(\"disabled\", \"disabled\");\n            var $diffTarget = $('<div class=\"revision-diff\"/>');\n            var diffWidget = $diffTarget\n              .dcpRevisionDiff({\n                documentId: widget.options.documentId,\n                firstRevision: $(selectedDiff.get(1)).data(\"revision\"),\n                secondRevision: $(selectedDiff.get(0)).data(\"revision\"),\n                window: {\n                  width: \"70%\",\n                  height: \"70%\",\n                  title: widget.options.labels.revisionDiffLabels.title\n                },\n                labels: widget.options.labels.revisionDiffLabels\n              })\n              .data(\"dcpRevisionDiff\");\n\n            diffWidget.open();\n          } else if (selectedDiff.length < 2) {\n            widget.element\n              .find(\".history-diff-input\")\n              .removeAttr(\"disabled\", \"disabled\");\n          }\n        }\n      );\n\n      this.element.on(\n        \"click\" + this.eventNamespace,\n        \"a[data-document-id]\",\n        function whistoryShowDocument(event) {\n          var docid = $widget.data(\"document-id\");\n          if (docid) {\n            event.preventDefault();\n            widget.element.trigger(\"viewRevision\", {\n              initid: docid,\n              revision: parseInt($widget.data(\"revision\"))\n            });\n          }\n        }\n      );\n    },\n\n    _fillDataTable: function dcpDocumentHistory_fillDataTable(data) {\n      var myData = [];\n\n      this.dialogWindow.setOptions({\n        title: Mustache.render(\n          this.options.labels.historyTitle,\n          data.data.history[0].properties\n        )\n      });\n\n      _.each(data.data.history, function whistoryFillRevision(revisionInfo) {\n        myData.push({\n          version: revisionInfo.properties.version,\n          revision: revisionInfo.properties.revision,\n          code: \"\",\n          level: \"revision\",\n          message: revisionInfo.properties,\n          owner: revisionInfo.properties.owner.title,\n          date: revisionInfo.properties.revisionDate,\n          diff: 1,\n          color: revisionInfo.properties.state.color,\n          DT_RowClass: \"history-level--revision\"\n        });\n        _.each(revisionInfo.messages, function whistoryFillMessage(message) {\n          myData.push({\n            version: \"\",\n            revision: \"\",\n            code: message.code,\n            level: message.level,\n            message: message.comment,\n            owner: message.uname,\n            date: message.date,\n            diff: 0,\n            DT_RowClass:\n              \"history-comment history-level--\" +\n              message.level +\n              (revisionInfo.properties.status === \"fixed\"\n                ? \" history-comment--fixed\"\n                : \"\")\n          });\n        });\n      });\n\n      return myData;\n    },\n\n    _initDatatable: function dcpDocumentHistory_initDatatable() {\n      var historyWidget = this;\n      this.element\n        .find(\".history-main\")\n        .dataTable({\n          autoWidth: false,\n          ordering: false,\n          dom: \"<'history-head'<'history-buttons'>f>rtip\",\n          paging: false,\n          // \"scrollY\": \"200px\",\n          scrollCollapse: false,\n          info: false,\n          language: {\n            search: \" \",\n            loadingRecords: this.options.labels.loading\n          },\n          columns: [\n            {\n              data: \"date\",\n              name: \"date\",\n              title: historyWidget.options.labels.date,\n              className: \"history-date\",\n              render: function whistoryRenderDate(data) {\n                var theDate = new Date(data.substr(0, 10));\n                // The time is not manage by date because each navigator defer with timezone\n                return kendo.toString(theDate, \"D\") + \" \" + data.substr(11, 8);\n              }\n            },\n            {\n              data: \"message\",\n              name: \"message\",\n              title: historyWidget.options.labels.message,\n              className: \"history-message\",\n              render: function whistoryRenderMessage(data) {\n                if (_.isObject(data)) {\n                  if (data.state.reference) {\n                    return (\n                      '<div class=\"history-state\"><span class=\"history-state-color\" style=\"background-color:' +\n                      data.state.color +\n                      '\" >&nbsp;</span>' +\n                      '<span class=\"history-state-label\">' +\n                      (data.status === \"fixed\"\n                        ? data.state.stateLabel\n                        : data.state.activity) +\n                      \"</span></div>\"\n                    );\n                  }\n                  return $(\"<div/>\")\n                    .text(data.title)\n                    .html();\n                } else {\n                  return $(\"<div/>\")\n                    .text(data)\n                    .html();\n                }\n              }\n            },\n            {\n              data: \"owner\",\n              name: \"owner\",\n              title: historyWidget.options.labels.owner,\n              className: \"history-owner\",\n              render: function whistoryEncodeMessage(data) {\n                return $(\"<div/>\")\n                  .text(data)\n                  .html();\n              }\n            },\n            {\n              data: \"version\",\n              name: \"version\",\n              title: historyWidget.options.labels.version,\n              className: \"history-version\",\n              visible: false,\n              render: function whistoryEncodeMessage(data) {\n                return $(\"<div/>\")\n                  .text(data)\n                  .html();\n              }\n            },\n            {\n              data: \"revision\",\n              name: \"revision\",\n              title: historyWidget.options.labels.revision,\n              className: \"history-revision\",\n              render: function whistoryRenderRevision(data) {\n                if (data !== \"\") {\n                  return (\n                    '<a class=\"history-revision-link btn btn-default\" href=\"api/v2/documents/' +\n                    historyWidget.options.documentId +\n                    \"/revisions/\" +\n                    data +\n                    '.html\"' +\n                    'data-document-id=\"' +\n                    historyWidget.options.documentId +\n                    '\" ' +\n                    'data-revision=\"' +\n                    data +\n                    '\"' +\n                    \">\" +\n                    historyWidget.options.labels.linkRevision.replace(\n                      \"#\",\n                      data\n                    ) +\n                    \"</a>\"\n                  );\n                } else {\n                  return data;\n                }\n              }\n            },\n            {\n              data: \"code\",\n              name: \"code\",\n              title: historyWidget.options.labels.code,\n              className: \"history-code\",\n              visible: false,\n              render: function whistoryEncodeMessage(data) {\n                return $(\"<div/>\")\n                  .text(data)\n                  .html();\n              }\n            },\n            {\n              data: \"level\",\n              name: \"level\",\n              title: historyWidget.options.labels.level,\n              className: \"history-level\",\n              visible: false,\n              render: function whistoryEncodeMessage(data) {\n                return $(\"<div/>\")\n                  .text(data)\n                  .html();\n              }\n            },\n            {\n              data: \"diff\",\n              name: \"diff\",\n              title: historyWidget.options.labels.diff,\n              className: \"history-diff\",\n              render: function whistoryRenderDiff(data, renderType, allData) {\n                if (data === 1) {\n                  return (\n                    '<input class=\"history-diff-input\" data-revision=\"' +\n                    allData.revision +\n                    '\" type=\"checkbox\"/>'\n                  );\n                } else {\n                  return \"\";\n                }\n              }\n            }\n          ],\n\n          drawCallback: function whistorydrawCallback() {\n            var noticeShowed = historyWidget.element\n              .find(\".history-button-shownotice\")\n              .data(\"showNotice\");\n            var detailShowed = historyWidget.element\n              .find(\".history-button-showdetail\")\n              .data(\"showDetail\");\n\n            if (detailShowed) {\n              historyWidget.element.find(\".history-comment\").show();\n              if (!noticeShowed) {\n                historyWidget.element.find(\".history-level--notice\").hide();\n              }\n            } else {\n              historyWidget.element.find(\".history-comment\").hide();\n            }\n          },\n\n          initComplete: function whistoryinitComplete() {\n            var api = this.api();\n            var data = api.rows({ page: \"current\" }).data();\n            // Output the data for the visible rows to the browser's console\n\n            // show version if not null in one row\n            var showVersion = false;\n            var showState = false;\n            var onlyOneRevision = true;\n            for (var i = 0; i < data.length; i++) {\n              if (data[i].version) {\n                showVersion = true;\n              }\n              if (data[i].revision > 0) {\n                onlyOneRevision = false;\n              }\n              if (\n                data[i].message &&\n                data[i].message.state &&\n                data[i].message.state.reference\n              ) {\n                showState = true;\n              }\n            }\n            if (onlyOneRevision) {\n              //api.column(\"revision:name\").visible(!onlyOneRevision);\n              historyWidget.element\n                .find(\".history-diff-input\")\n                .attr(\"disabled\", \"disabled\");\n            }\n\n            if (showVersion) {\n              api.column(\"version:name\").visible(true);\n            }\n            if (showState) {\n              // Change Label\n              historyWidget.element\n                .find(\".history-header--message\")\n                .html(historyWidget.options.labels.activity);\n            }\n            var fixedRevisionRow = historyWidget.element\n              .find(\".history-level--revision\")\n              .get(1);\n            if (fixedRevisionRow) {\n              var trHead = historyWidget.element\n                .find(\".history-header\")\n                .clone();\n              $(\n                '<tr class=\"history-separator\"><td class=\"history-separator-cell\" colspan=\"' +\n                  $(trHead).find(\"th\").length +\n                  '\"><span>' +\n                  historyWidget.options.labels.pastRevision +\n                  \"</span>\" +\n                  \"</td></tr>\"\n              ).insertBefore(fixedRevisionRow);\n              $(trHead).insertBefore(fixedRevisionRow);\n              if (showState) {\n                $($(\".history-header--message\").get(1)).html(\n                  historyWidget.options.labels.state\n                );\n              }\n            }\n            historyWidget.element.find(\".history-comment\").hide();\n            historyWidget.element.find(\".odd\").removeClass(\"odd\");\n            historyWidget.element.find(\".even\").removeClass(\"even\");\n            historyWidget.element\n              .find(\".dataTables_filter input\")\n              .addClass(\"form-control form-control-sm\");\n\n            if (\n              historyWidget.element.find(\".history-button-shownotice\")\n                .length === 0\n            ) {\n              var $buttons = historyWidget.element.find(\".history-buttons\");\n\n              $buttons.append(\n                $(\n                  '<button class=\"history-button-showdetail btn btn-secondary btn-sm\" >' +\n                    historyWidget.options.labels.showDetail +\n                    \"</button>\"\n                )\n              );\n              $buttons.append(\n                $(\n                  '<button disabled=\"disabled\" class=\"history-button-shownotice btn btn-outline-secondary btn-sm\" >' +\n                    historyWidget.options.labels.showNotice +\n                    \"</button>\"\n                )\n              );\n\n              historyWidget.element\n                .find(\".dataTables_filter input\")\n                .attr(\n                  \"placeholder\",\n                  historyWidget.options.labels.filterMessages\n                );\n            }\n          },\n\n          ajax: function whistory_getData(data, callback) {\n            $.getJSON(\n              \"api/v2/documents/\" +\n                historyWidget.options.documentId +\n                \"/history/\"\n            )\n              .done(function whistory_getDataDone(response) {\n                var tableData = historyWidget._fillDataTable(response);\n                callback({ data: tableData });\n              })\n              .fail(function whistory_getDataFail(response) {\n                var result = JSON.parse(response.responseText);\n                _.each(result.messages, function whistory_getDataParseMessage(\n                  error\n                ) {\n                  if (error.type === \"error\") {\n                    $(\"body\").trigger(\"notification\", {\n                      type: error.type,\n                      message: error.contentText\n                    });\n                  }\n                });\n                console.error(\"fail\", response);\n              });\n          }\n        })\n        .addClass(\"table table-condensed table-bordered table-hover\");\n    },\n\n    _destroy: function dcpDocumentHistory_destroy() {\n      var $history = this.element.find(\".history-main\");\n\n      if ($history.DataTable) {\n        $history.DataTable().destroy();\n      }\n      this._super();\n    }\n  });\n}).apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNjc5NTNiYWU4OGVjOGZhMWFiMjYuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvQXBwcy9ET0NVTUVOVC9JSE0vd2lkZ2V0cy9oaXN0b3J5L3dIaXN0b3J5LmpzPzFjYTciXSwic291cmNlc0NvbnRlbnQiOlsiZGVmaW5lKFtcbiAgXCJqcXVlcnlcIixcbiAgXCJ1bmRlcnNjb3JlXCIsXG4gIFwibXVzdGFjaGVcIixcbiAgXCJkY3BEb2N1bWVudC93aWRnZXRzL3dpZGdldFwiLFxuICBcImRjcERvY3VtZW50L3dpZGdldHMvaGlzdG9yeS93UmV2aXNpb25EaWZmXCIsXG4gIFwiZGNwRG9jdW1lbnQvd2lkZ2V0cy93aW5kb3cvd0RpYWxvZ1wiXG5dLCBmdW5jdGlvbiByZXF1aXJlX3doaXN0b3J5KCQsIF8sIE11c3RhY2hlKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gICQud2lkZ2V0KFwiZGNwLmRjcERvY3VtZW50SGlzdG9yeVwiLCAkLmRjcC5kY3BEaWFsb2csIHtcbiAgICBvcHRpb25zOiB7XG4gICAgICBkb2N1bWVudElkOiAwLFxuICAgICAgd2luZG93OiB7XG4gICAgICAgIG1vZGFsOiB0cnVlLFxuICAgICAgICB0aXRsZTogXCJEb2N1bWVudCBoaXN0b3J5XCJcbiAgICAgIH0sXG4gICAgICBsYWJlbHM6IHtcbiAgICAgICAgdmVyc2lvbjogXCJWZXJzaW9uXCIsXG4gICAgICAgIHJldmlzaW9uOiBcIlJldlwiLFxuICAgICAgICBzdGF0ZTogXCJTdGF0ZVwiLFxuICAgICAgICBhY3Rpdml0eTogXCJBY3Rpdml0eVwiLFxuICAgICAgICBvd25lcjogXCJPd25lclwiLFxuICAgICAgICBjb2RlOiBcIkNvZGVcIixcbiAgICAgICAgZGF0ZTogXCJEYXRlXCIsXG4gICAgICAgIGRpZmY6IFwiRGlmZlwiLFxuICAgICAgICBsZXZlbDogXCJMZXZlbFwiLFxuICAgICAgICBtZXNzYWdlOiBcIk1lc3NhZ2VcIixcbiAgICAgICAgcGFzdFJldmlzaW9uOiBcIlwiLFxuICAgICAgICBzaG93RGV0YWlsOiBcIlNob3cgZGV0YWlsc1wiLFxuICAgICAgICBoaWRlRGV0YWlsOiBcIkhpZGUgZGV0YWlsc1wiLFxuICAgICAgICBzaG93Tm90aWNlOiBcIlNob3cgbm90aWNlc1wiLFxuICAgICAgICBoaWRlTm90aWNlOiBcIkhpZGUgbm90aWNlc1wiLFxuICAgICAgICBub09uZU5vdGljZTogXCJObyBvbmUgbm90aWNlc1wiLFxuICAgICAgICBmaWx0ZXJNZXNzYWdlczogXCJGaWx0ZXIgbWVzc2FnZXNcIixcbiAgICAgICAgbGlua1JldmlzaW9uOiBcIlNlZSByZXZpc2lvbiBudW1iZXIgI1wiLFxuICAgICAgICBoaXN0b3J5VGl0bGU6IFwiSGlzdG9yeSBmb3Ige3t0aXRsZX19XCIsXG4gICAgICAgIGxvYWRpbmc6IFwiTG9hZGluZyAuLi5cIixcbiAgICAgICAgcmV2aXNpb25EaWZmTGFiZWxzOiB7fVxuICAgICAgfVxuICAgIH0sXG4gICAgaHRtbENhbmV2YTogZnVuY3Rpb24gZGNwRG9jdW1lbnRIaXN0b3J5aHRtbENhbmV2YSgpIHtcbiAgICAgIHJldHVybiAoXG4gICAgICAgICc8dGFibGUgY2xhc3M9XCJoaXN0b3J5LW1haW5cIj48dGhlYWQ+JyArXG4gICAgICAgICc8dHIgY2xhc3M9XCJoaXN0b3J5LWhlYWRlclwiPicgK1xuICAgICAgICAnPHRoIGNsYXNzPVwiaGlzdG9yeS1oZWFkZXItLWRhdGVcIi8+JyArXG4gICAgICAgICc8dGggY2xhc3M9XCJoaXN0b3J5LWhlYWRlci0tbWVzc2FnZVwiLz4nICtcbiAgICAgICAgJzx0aCBjbGFzcz1cImhpc3RvcnktaGVhZGVyLS1vd25lclwiLz4nICtcbiAgICAgICAgJzx0aCBjbGFzcz1cImhpc3RvcnktaGVhZGVyLS12ZXJzaW9uXCIvPicgK1xuICAgICAgICAnPHRoIGNsYXNzPVwiaGlzdG9yeS1oZWFkZXItLXJldmlzaW9uXCIvPicgK1xuICAgICAgICAnPHRoIGNsYXNzPVwiaGlzdG9yeS1oZWFkZXItLWNvZGVcIi8+JyArXG4gICAgICAgICc8dGggY2xhc3M9XCJoaXN0b3J5LWhlYWRlci0tbGV2ZWxcIi8+JyArXG4gICAgICAgICc8dGggY2xhc3M9XCJoaXN0b3J5LWhlYWRlci0tZGlmZlwiLz4nICtcbiAgICAgICAgXCI8L3RyPlwiICtcbiAgICAgICAgXCI8L3RoZWFkPjwvdGFibGU+XCJcbiAgICAgICk7XG4gICAgfSxcblxuICAgIGVsZW1lbnQ6IG51bGwsXG4gICAgX2NyZWF0ZTogZnVuY3Rpb24gZGNwRG9jdW1lbnRIaXN0b3J5X2NyZWF0ZSgpIHtcbiAgICAgIHZhciB3aWRnZXQgPSB0aGlzLFxuICAgICAgICAkd2lkZ2V0ID0gJCh0aGlzKTtcblxuICAgICAgdGhpcy5lbGVtZW50Lmh0bWwodGhpcy5odG1sQ2FuZXZhKCkpO1xuICAgICAgcmVxdWlyZS5lbnN1cmUoXG4gICAgICAgIFtcImRhdGF0YWJsZXNcIl0sXG4gICAgICAgIGZ1bmN0aW9uIGRjcERvY3VtZW50V0hpc3RvcnlfaW5pdFRhYmxlKCkge1xuICAgICAgICAgIHJlcXVpcmUoXCJkYXRhdGFibGVzLm5ldC1iczQvY3NzL2RhdGFUYWJsZXMuYm9vdHN0cmFwNC5jc3NcIik7XG4gICAgICAgICAgcmVxdWlyZShcImRhdGF0YWJsZXNcIik7XG4gICAgICAgICAgd2lkZ2V0Ll9pbml0RGF0YXRhYmxlKCk7XG4gICAgICAgIH0sXG4gICAgICAgIFwiZW5zdXJlRGF0YXRhYmxlc1wiXG4gICAgICApO1xuXG4gICAgICB0aGlzLmVsZW1lbnQuZGF0YShcImRjcERvY3VtZW50SGlzdG9yeVwiLCB0aGlzKTtcblxuICAgICAgdGhpcy5fc3VwZXIoKTtcblxuICAgICAgdGhpcy5lbGVtZW50Lm9uKFxuICAgICAgICBcImNsaWNrXCIgKyB0aGlzLmV2ZW50TmFtZXNwYWNlLFxuICAgICAgICBcIi5oaXN0b3J5LWJ1dHRvbi1zaG93ZGV0YWlsXCIsXG4gICAgICAgIGZ1bmN0aW9uIHdoaXN0b3J5U2hvd0RldGFpbCgpIHtcbiAgICAgICAgICB2YXIgbm90aWNlQnV0dG9uID0gd2lkZ2V0LmVsZW1lbnQuZmluZChcIi5oaXN0b3J5LWJ1dHRvbi1zaG93bm90aWNlXCIpO1xuICAgICAgICAgIHZhciBub3RpY2VTaG93ZWQgPSBub3RpY2VCdXR0b24uZGF0YShcInNob3dOb3RpY2VcIik7XG4gICAgICAgICAgaWYgKCR3aWRnZXQuZGF0YShcInNob3dEZXRhaWxcIikpIHtcbiAgICAgICAgICAgICR3aWRnZXQuZGF0YShcInNob3dEZXRhaWxcIiwgZmFsc2UpO1xuICAgICAgICAgICAgJHdpZGdldC5kYXRhKFwic2hvd05vdGljZVwiLCBmYWxzZSk7XG4gICAgICAgICAgICAkKHRoaXMpXG4gICAgICAgICAgICAgIC50ZXh0KHdpZGdldC5vcHRpb25zLmxhYmVscy5zaG93RGV0YWlsKVxuICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3MoXCJidG4tcHJpbWFyeVwiKTtcbiAgICAgICAgICAgIHdpZGdldC5lbGVtZW50LmZpbmQoXCIuaGlzdG9yeS1jb21tZW50XCIpLmhpZGUoKTtcblxuICAgICAgICAgICAgbm90aWNlQnV0dG9uXG4gICAgICAgICAgICAgIC5hdHRyKFwiZGlzYWJsZWRcIiwgXCJkaXNhYmxlZFwiKVxuICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3MoXCJidG4tcHJpbWFyeVwiKVxuICAgICAgICAgICAgICAudGV4dCh3aWRnZXQub3B0aW9ucy5sYWJlbHMuc2hvd05vdGljZSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICR3aWRnZXQuZGF0YShcInNob3dEZXRhaWxcIiwgdHJ1ZSk7XG4gICAgICAgICAgICB3aWRnZXQuZWxlbWVudC5maW5kKFwiLmhpc3RvcnktY29tbWVudFwiKS5zaG93KCk7XG4gICAgICAgICAgICBpZiAoIW5vdGljZVNob3dlZCkge1xuICAgICAgICAgICAgICB3aWRnZXQuZWxlbWVudC5maW5kKFwiLmhpc3RvcnktbGV2ZWwtLW5vdGljZVwiKS5oaWRlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAkKHRoaXMpXG4gICAgICAgICAgICAgIC50ZXh0KHdpZGdldC5vcHRpb25zLmxhYmVscy5oaWRlRGV0YWlsKVxuICAgICAgICAgICAgICAuYWRkQ2xhc3MoXCJidG4tcHJpbWFyeVwiKTtcbiAgICAgICAgICAgIG5vdGljZUJ1dHRvbi5yZW1vdmVBdHRyKFwiZGlzYWJsZWRcIik7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICApO1xuICAgICAgdGhpcy5lbGVtZW50Lm9uKFxuICAgICAgICBcImNsaWNrXCIgKyB0aGlzLmV2ZW50TmFtZXNwYWNlLFxuICAgICAgICBcIi5oaXN0b3J5LWJ1dHRvbi1zaG93bm90aWNlXCIsXG4gICAgICAgIGZ1bmN0aW9uIHdoaXN0b3J5U2hvd05vdGljZSgpIHtcbiAgICAgICAgICB2YXIgJG5vdGljZXMgPSB3aWRnZXQuZWxlbWVudC5maW5kKFwiLmhpc3RvcnktbGV2ZWwtLW5vdGljZVwiKTtcbiAgICAgICAgICBpZiAoJHdpZGdldC5kYXRhKFwic2hvd05vdGljZVwiKSkge1xuICAgICAgICAgICAgJHdpZGdldC5kYXRhKFwic2hvd05vdGljZVwiLCBmYWxzZSk7XG4gICAgICAgICAgICAkKHRoaXMpXG4gICAgICAgICAgICAgIC50ZXh0KHdpZGdldC5vcHRpb25zLmxhYmVscy5zaG93Tm90aWNlKVxuICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3MoXCJidG4tcHJpbWFyeVwiKTtcbiAgICAgICAgICAgIHdpZGdldC5lbGVtZW50LmZpbmQoXCIuaGlzdG9yeS1sZXZlbC0tbm90aWNlXCIpLmhpZGUoKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgJHdpZGdldC5kYXRhKFwic2hvd05vdGljZVwiLCB0cnVlKTtcbiAgICAgICAgICAgIGlmICgkbm90aWNlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICRub3RpY2VzLnNob3coKTtcbiAgICAgICAgICAgICAgJCh0aGlzKVxuICAgICAgICAgICAgICAgIC50ZXh0KHdpZGdldC5vcHRpb25zLmxhYmVscy5oaWRlTm90aWNlKVxuICAgICAgICAgICAgICAgIC5hZGRDbGFzcyhcImJ0bi1wcmltYXJ5XCIpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgJCh0aGlzKS50ZXh0KHdpZGdldC5vcHRpb25zLmxhYmVscy5ub09uZU5vdGljZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICApO1xuICAgICAgdGhpcy5lbGVtZW50Lm9uKFxuICAgICAgICBcImNsaWNrXCIgKyB0aGlzLmV2ZW50TmFtZXNwYWNlLFxuICAgICAgICBcIi5oaXN0b3J5LWRpZmYtaW5wdXRcIixcbiAgICAgICAgZnVuY3Rpb24gd2hpc3RvcnlTaG93RGlmZigpIHtcbiAgICAgICAgICB2YXIgc2VsZWN0ZWREaWZmID0gd2lkZ2V0LmVsZW1lbnQuZmluZChcIi5oaXN0b3J5LWRpZmYtaW5wdXQ6Y2hlY2tlZFwiKTtcblxuICAgICAgICAgIGlmIChzZWxlY3RlZERpZmYubGVuZ3RoID09PSAyKSB7XG4gICAgICAgICAgICB3aWRnZXQuZWxlbWVudFxuICAgICAgICAgICAgICAuZmluZChcIi5oaXN0b3J5LWRpZmYtaW5wdXQ6bm90KDpjaGVja2VkKVwiKVxuICAgICAgICAgICAgICAuYXR0cihcImRpc2FibGVkXCIsIFwiZGlzYWJsZWRcIik7XG4gICAgICAgICAgICB2YXIgJGRpZmZUYXJnZXQgPSAkKCc8ZGl2IGNsYXNzPVwicmV2aXNpb24tZGlmZlwiLz4nKTtcbiAgICAgICAgICAgIHZhciBkaWZmV2lkZ2V0ID0gJGRpZmZUYXJnZXRcbiAgICAgICAgICAgICAgLmRjcFJldmlzaW9uRGlmZih7XG4gICAgICAgICAgICAgICAgZG9jdW1lbnRJZDogd2lkZ2V0Lm9wdGlvbnMuZG9jdW1lbnRJZCxcbiAgICAgICAgICAgICAgICBmaXJzdFJldmlzaW9uOiAkKHNlbGVjdGVkRGlmZi5nZXQoMSkpLmRhdGEoXCJyZXZpc2lvblwiKSxcbiAgICAgICAgICAgICAgICBzZWNvbmRSZXZpc2lvbjogJChzZWxlY3RlZERpZmYuZ2V0KDApKS5kYXRhKFwicmV2aXNpb25cIiksXG4gICAgICAgICAgICAgICAgd2luZG93OiB7XG4gICAgICAgICAgICAgICAgICB3aWR0aDogXCI3MCVcIixcbiAgICAgICAgICAgICAgICAgIGhlaWdodDogXCI3MCVcIixcbiAgICAgICAgICAgICAgICAgIHRpdGxlOiB3aWRnZXQub3B0aW9ucy5sYWJlbHMucmV2aXNpb25EaWZmTGFiZWxzLnRpdGxlXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBsYWJlbHM6IHdpZGdldC5vcHRpb25zLmxhYmVscy5yZXZpc2lvbkRpZmZMYWJlbHNcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgLmRhdGEoXCJkY3BSZXZpc2lvbkRpZmZcIik7XG5cbiAgICAgICAgICAgIGRpZmZXaWRnZXQub3BlbigpO1xuICAgICAgICAgIH0gZWxzZSBpZiAoc2VsZWN0ZWREaWZmLmxlbmd0aCA8IDIpIHtcbiAgICAgICAgICAgIHdpZGdldC5lbGVtZW50XG4gICAgICAgICAgICAgIC5maW5kKFwiLmhpc3RvcnktZGlmZi1pbnB1dFwiKVxuICAgICAgICAgICAgICAucmVtb3ZlQXR0cihcImRpc2FibGVkXCIsIFwiZGlzYWJsZWRcIik7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICApO1xuXG4gICAgICB0aGlzLmVsZW1lbnQub24oXG4gICAgICAgIFwiY2xpY2tcIiArIHRoaXMuZXZlbnROYW1lc3BhY2UsXG4gICAgICAgIFwiYVtkYXRhLWRvY3VtZW50LWlkXVwiLFxuICAgICAgICBmdW5jdGlvbiB3aGlzdG9yeVNob3dEb2N1bWVudChldmVudCkge1xuICAgICAgICAgIHZhciBkb2NpZCA9ICR3aWRnZXQuZGF0YShcImRvY3VtZW50LWlkXCIpO1xuICAgICAgICAgIGlmIChkb2NpZCkge1xuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIHdpZGdldC5lbGVtZW50LnRyaWdnZXIoXCJ2aWV3UmV2aXNpb25cIiwge1xuICAgICAgICAgICAgICBpbml0aWQ6IGRvY2lkLFxuICAgICAgICAgICAgICByZXZpc2lvbjogcGFyc2VJbnQoJHdpZGdldC5kYXRhKFwicmV2aXNpb25cIikpXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgfSxcblxuICAgIF9maWxsRGF0YVRhYmxlOiBmdW5jdGlvbiBkY3BEb2N1bWVudEhpc3RvcnlfZmlsbERhdGFUYWJsZShkYXRhKSB7XG4gICAgICB2YXIgbXlEYXRhID0gW107XG5cbiAgICAgIHRoaXMuZGlhbG9nV2luZG93LnNldE9wdGlvbnMoe1xuICAgICAgICB0aXRsZTogTXVzdGFjaGUucmVuZGVyKFxuICAgICAgICAgIHRoaXMub3B0aW9ucy5sYWJlbHMuaGlzdG9yeVRpdGxlLFxuICAgICAgICAgIGRhdGEuZGF0YS5oaXN0b3J5WzBdLnByb3BlcnRpZXNcbiAgICAgICAgKVxuICAgICAgfSk7XG5cbiAgICAgIF8uZWFjaChkYXRhLmRhdGEuaGlzdG9yeSwgZnVuY3Rpb24gd2hpc3RvcnlGaWxsUmV2aXNpb24ocmV2aXNpb25JbmZvKSB7XG4gICAgICAgIG15RGF0YS5wdXNoKHtcbiAgICAgICAgICB2ZXJzaW9uOiByZXZpc2lvbkluZm8ucHJvcGVydGllcy52ZXJzaW9uLFxuICAgICAgICAgIHJldmlzaW9uOiByZXZpc2lvbkluZm8ucHJvcGVydGllcy5yZXZpc2lvbixcbiAgICAgICAgICBjb2RlOiBcIlwiLFxuICAgICAgICAgIGxldmVsOiBcInJldmlzaW9uXCIsXG4gICAgICAgICAgbWVzc2FnZTogcmV2aXNpb25JbmZvLnByb3BlcnRpZXMsXG4gICAgICAgICAgb3duZXI6IHJldmlzaW9uSW5mby5wcm9wZXJ0aWVzLm93bmVyLnRpdGxlLFxuICAgICAgICAgIGRhdGU6IHJldmlzaW9uSW5mby5wcm9wZXJ0aWVzLnJldmlzaW9uRGF0ZSxcbiAgICAgICAgICBkaWZmOiAxLFxuICAgICAgICAgIGNvbG9yOiByZXZpc2lvbkluZm8ucHJvcGVydGllcy5zdGF0ZS5jb2xvcixcbiAgICAgICAgICBEVF9Sb3dDbGFzczogXCJoaXN0b3J5LWxldmVsLS1yZXZpc2lvblwiXG4gICAgICAgIH0pO1xuICAgICAgICBfLmVhY2gocmV2aXNpb25JbmZvLm1lc3NhZ2VzLCBmdW5jdGlvbiB3aGlzdG9yeUZpbGxNZXNzYWdlKG1lc3NhZ2UpIHtcbiAgICAgICAgICBteURhdGEucHVzaCh7XG4gICAgICAgICAgICB2ZXJzaW9uOiBcIlwiLFxuICAgICAgICAgICAgcmV2aXNpb246IFwiXCIsXG4gICAgICAgICAgICBjb2RlOiBtZXNzYWdlLmNvZGUsXG4gICAgICAgICAgICBsZXZlbDogbWVzc2FnZS5sZXZlbCxcbiAgICAgICAgICAgIG1lc3NhZ2U6IG1lc3NhZ2UuY29tbWVudCxcbiAgICAgICAgICAgIG93bmVyOiBtZXNzYWdlLnVuYW1lLFxuICAgICAgICAgICAgZGF0ZTogbWVzc2FnZS5kYXRlLFxuICAgICAgICAgICAgZGlmZjogMCxcbiAgICAgICAgICAgIERUX1Jvd0NsYXNzOlxuICAgICAgICAgICAgICBcImhpc3RvcnktY29tbWVudCBoaXN0b3J5LWxldmVsLS1cIiArXG4gICAgICAgICAgICAgIG1lc3NhZ2UubGV2ZWwgK1xuICAgICAgICAgICAgICAocmV2aXNpb25JbmZvLnByb3BlcnRpZXMuc3RhdHVzID09PSBcImZpeGVkXCJcbiAgICAgICAgICAgICAgICA/IFwiIGhpc3RvcnktY29tbWVudC0tZml4ZWRcIlxuICAgICAgICAgICAgICAgIDogXCJcIilcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIG15RGF0YTtcbiAgICB9LFxuXG4gICAgX2luaXREYXRhdGFibGU6IGZ1bmN0aW9uIGRjcERvY3VtZW50SGlzdG9yeV9pbml0RGF0YXRhYmxlKCkge1xuICAgICAgdmFyIGhpc3RvcnlXaWRnZXQgPSB0aGlzO1xuICAgICAgdGhpcy5lbGVtZW50XG4gICAgICAgIC5maW5kKFwiLmhpc3RvcnktbWFpblwiKVxuICAgICAgICAuZGF0YVRhYmxlKHtcbiAgICAgICAgICBhdXRvV2lkdGg6IGZhbHNlLFxuICAgICAgICAgIG9yZGVyaW5nOiBmYWxzZSxcbiAgICAgICAgICBkb206IFwiPCdoaXN0b3J5LWhlYWQnPCdoaXN0b3J5LWJ1dHRvbnMnPmY+cnRpcFwiLFxuICAgICAgICAgIHBhZ2luZzogZmFsc2UsXG4gICAgICAgICAgLy8gXCJzY3JvbGxZXCI6IFwiMjAwcHhcIixcbiAgICAgICAgICBzY3JvbGxDb2xsYXBzZTogZmFsc2UsXG4gICAgICAgICAgaW5mbzogZmFsc2UsXG4gICAgICAgICAgbGFuZ3VhZ2U6IHtcbiAgICAgICAgICAgIHNlYXJjaDogXCIgXCIsXG4gICAgICAgICAgICBsb2FkaW5nUmVjb3JkczogdGhpcy5vcHRpb25zLmxhYmVscy5sb2FkaW5nXG4gICAgICAgICAgfSxcbiAgICAgICAgICBjb2x1bW5zOiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIGRhdGE6IFwiZGF0ZVwiLFxuICAgICAgICAgICAgICBuYW1lOiBcImRhdGVcIixcbiAgICAgICAgICAgICAgdGl0bGU6IGhpc3RvcnlXaWRnZXQub3B0aW9ucy5sYWJlbHMuZGF0ZSxcbiAgICAgICAgICAgICAgY2xhc3NOYW1lOiBcImhpc3RvcnktZGF0ZVwiLFxuICAgICAgICAgICAgICByZW5kZXI6IGZ1bmN0aW9uIHdoaXN0b3J5UmVuZGVyRGF0ZShkYXRhKSB7XG4gICAgICAgICAgICAgICAgdmFyIHRoZURhdGUgPSBuZXcgRGF0ZShkYXRhLnN1YnN0cigwLCAxMCkpO1xuICAgICAgICAgICAgICAgIC8vIFRoZSB0aW1lIGlzIG5vdCBtYW5hZ2UgYnkgZGF0ZSBiZWNhdXNlIGVhY2ggbmF2aWdhdG9yIGRlZmVyIHdpdGggdGltZXpvbmVcbiAgICAgICAgICAgICAgICByZXR1cm4ga2VuZG8udG9TdHJpbmcodGhlRGF0ZSwgXCJEXCIpICsgXCIgXCIgKyBkYXRhLnN1YnN0cigxMSwgOCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIGRhdGE6IFwibWVzc2FnZVwiLFxuICAgICAgICAgICAgICBuYW1lOiBcIm1lc3NhZ2VcIixcbiAgICAgICAgICAgICAgdGl0bGU6IGhpc3RvcnlXaWRnZXQub3B0aW9ucy5sYWJlbHMubWVzc2FnZSxcbiAgICAgICAgICAgICAgY2xhc3NOYW1lOiBcImhpc3RvcnktbWVzc2FnZVwiLFxuICAgICAgICAgICAgICByZW5kZXI6IGZ1bmN0aW9uIHdoaXN0b3J5UmVuZGVyTWVzc2FnZShkYXRhKSB7XG4gICAgICAgICAgICAgICAgaWYgKF8uaXNPYmplY3QoZGF0YSkpIHtcbiAgICAgICAgICAgICAgICAgIGlmIChkYXRhLnN0YXRlLnJlZmVyZW5jZSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwiaGlzdG9yeS1zdGF0ZVwiPjxzcGFuIGNsYXNzPVwiaGlzdG9yeS1zdGF0ZS1jb2xvclwiIHN0eWxlPVwiYmFja2dyb3VuZC1jb2xvcjonICtcbiAgICAgICAgICAgICAgICAgICAgICBkYXRhLnN0YXRlLmNvbG9yICtcbiAgICAgICAgICAgICAgICAgICAgICAnXCIgPiZuYnNwOzwvc3Bhbj4nICtcbiAgICAgICAgICAgICAgICAgICAgICAnPHNwYW4gY2xhc3M9XCJoaXN0b3J5LXN0YXRlLWxhYmVsXCI+JyArXG4gICAgICAgICAgICAgICAgICAgICAgKGRhdGEuc3RhdHVzID09PSBcImZpeGVkXCJcbiAgICAgICAgICAgICAgICAgICAgICAgID8gZGF0YS5zdGF0ZS5zdGF0ZUxhYmVsXG4gICAgICAgICAgICAgICAgICAgICAgICA6IGRhdGEuc3RhdGUuYWN0aXZpdHkpICtcbiAgICAgICAgICAgICAgICAgICAgICBcIjwvc3Bhbj48L2Rpdj5cIlxuICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgcmV0dXJuICQoXCI8ZGl2Lz5cIilcbiAgICAgICAgICAgICAgICAgICAgLnRleHQoZGF0YS50aXRsZSlcbiAgICAgICAgICAgICAgICAgICAgLmh0bWwoKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgcmV0dXJuICQoXCI8ZGl2Lz5cIilcbiAgICAgICAgICAgICAgICAgICAgLnRleHQoZGF0YSlcbiAgICAgICAgICAgICAgICAgICAgLmh0bWwoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIGRhdGE6IFwib3duZXJcIixcbiAgICAgICAgICAgICAgbmFtZTogXCJvd25lclwiLFxuICAgICAgICAgICAgICB0aXRsZTogaGlzdG9yeVdpZGdldC5vcHRpb25zLmxhYmVscy5vd25lcixcbiAgICAgICAgICAgICAgY2xhc3NOYW1lOiBcImhpc3Rvcnktb3duZXJcIixcbiAgICAgICAgICAgICAgcmVuZGVyOiBmdW5jdGlvbiB3aGlzdG9yeUVuY29kZU1lc3NhZ2UoZGF0YSkge1xuICAgICAgICAgICAgICAgIHJldHVybiAkKFwiPGRpdi8+XCIpXG4gICAgICAgICAgICAgICAgICAudGV4dChkYXRhKVxuICAgICAgICAgICAgICAgICAgLmh0bWwoKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgZGF0YTogXCJ2ZXJzaW9uXCIsXG4gICAgICAgICAgICAgIG5hbWU6IFwidmVyc2lvblwiLFxuICAgICAgICAgICAgICB0aXRsZTogaGlzdG9yeVdpZGdldC5vcHRpb25zLmxhYmVscy52ZXJzaW9uLFxuICAgICAgICAgICAgICBjbGFzc05hbWU6IFwiaGlzdG9yeS12ZXJzaW9uXCIsXG4gICAgICAgICAgICAgIHZpc2libGU6IGZhbHNlLFxuICAgICAgICAgICAgICByZW5kZXI6IGZ1bmN0aW9uIHdoaXN0b3J5RW5jb2RlTWVzc2FnZShkYXRhKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICQoXCI8ZGl2Lz5cIilcbiAgICAgICAgICAgICAgICAgIC50ZXh0KGRhdGEpXG4gICAgICAgICAgICAgICAgICAuaHRtbCgpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBkYXRhOiBcInJldmlzaW9uXCIsXG4gICAgICAgICAgICAgIG5hbWU6IFwicmV2aXNpb25cIixcbiAgICAgICAgICAgICAgdGl0bGU6IGhpc3RvcnlXaWRnZXQub3B0aW9ucy5sYWJlbHMucmV2aXNpb24sXG4gICAgICAgICAgICAgIGNsYXNzTmFtZTogXCJoaXN0b3J5LXJldmlzaW9uXCIsXG4gICAgICAgICAgICAgIHJlbmRlcjogZnVuY3Rpb24gd2hpc3RvcnlSZW5kZXJSZXZpc2lvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgaWYgKGRhdGEgIT09IFwiXCIpIHtcbiAgICAgICAgICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAgICAgICAgICc8YSBjbGFzcz1cImhpc3RvcnktcmV2aXNpb24tbGluayBidG4gYnRuLWRlZmF1bHRcIiBocmVmPVwiYXBpL3YyL2RvY3VtZW50cy8nICtcbiAgICAgICAgICAgICAgICAgICAgaGlzdG9yeVdpZGdldC5vcHRpb25zLmRvY3VtZW50SWQgK1xuICAgICAgICAgICAgICAgICAgICBcIi9yZXZpc2lvbnMvXCIgK1xuICAgICAgICAgICAgICAgICAgICBkYXRhICtcbiAgICAgICAgICAgICAgICAgICAgJy5odG1sXCInICtcbiAgICAgICAgICAgICAgICAgICAgJ2RhdGEtZG9jdW1lbnQtaWQ9XCInICtcbiAgICAgICAgICAgICAgICAgICAgaGlzdG9yeVdpZGdldC5vcHRpb25zLmRvY3VtZW50SWQgK1xuICAgICAgICAgICAgICAgICAgICAnXCIgJyArXG4gICAgICAgICAgICAgICAgICAgICdkYXRhLXJldmlzaW9uPVwiJyArXG4gICAgICAgICAgICAgICAgICAgIGRhdGEgK1xuICAgICAgICAgICAgICAgICAgICAnXCInICtcbiAgICAgICAgICAgICAgICAgICAgXCI+XCIgK1xuICAgICAgICAgICAgICAgICAgICBoaXN0b3J5V2lkZ2V0Lm9wdGlvbnMubGFiZWxzLmxpbmtSZXZpc2lvbi5yZXBsYWNlKFxuICAgICAgICAgICAgICAgICAgICAgIFwiI1wiLFxuICAgICAgICAgICAgICAgICAgICAgIGRhdGFcbiAgICAgICAgICAgICAgICAgICAgKSArXG4gICAgICAgICAgICAgICAgICAgIFwiPC9hPlwiXG4gICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gZGF0YTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIGRhdGE6IFwiY29kZVwiLFxuICAgICAgICAgICAgICBuYW1lOiBcImNvZGVcIixcbiAgICAgICAgICAgICAgdGl0bGU6IGhpc3RvcnlXaWRnZXQub3B0aW9ucy5sYWJlbHMuY29kZSxcbiAgICAgICAgICAgICAgY2xhc3NOYW1lOiBcImhpc3RvcnktY29kZVwiLFxuICAgICAgICAgICAgICB2aXNpYmxlOiBmYWxzZSxcbiAgICAgICAgICAgICAgcmVuZGVyOiBmdW5jdGlvbiB3aGlzdG9yeUVuY29kZU1lc3NhZ2UoZGF0YSkge1xuICAgICAgICAgICAgICAgIHJldHVybiAkKFwiPGRpdi8+XCIpXG4gICAgICAgICAgICAgICAgICAudGV4dChkYXRhKVxuICAgICAgICAgICAgICAgICAgLmh0bWwoKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgZGF0YTogXCJsZXZlbFwiLFxuICAgICAgICAgICAgICBuYW1lOiBcImxldmVsXCIsXG4gICAgICAgICAgICAgIHRpdGxlOiBoaXN0b3J5V2lkZ2V0Lm9wdGlvbnMubGFiZWxzLmxldmVsLFxuICAgICAgICAgICAgICBjbGFzc05hbWU6IFwiaGlzdG9yeS1sZXZlbFwiLFxuICAgICAgICAgICAgICB2aXNpYmxlOiBmYWxzZSxcbiAgICAgICAgICAgICAgcmVuZGVyOiBmdW5jdGlvbiB3aGlzdG9yeUVuY29kZU1lc3NhZ2UoZGF0YSkge1xuICAgICAgICAgICAgICAgIHJldHVybiAkKFwiPGRpdi8+XCIpXG4gICAgICAgICAgICAgICAgICAudGV4dChkYXRhKVxuICAgICAgICAgICAgICAgICAgLmh0bWwoKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgZGF0YTogXCJkaWZmXCIsXG4gICAgICAgICAgICAgIG5hbWU6IFwiZGlmZlwiLFxuICAgICAgICAgICAgICB0aXRsZTogaGlzdG9yeVdpZGdldC5vcHRpb25zLmxhYmVscy5kaWZmLFxuICAgICAgICAgICAgICBjbGFzc05hbWU6IFwiaGlzdG9yeS1kaWZmXCIsXG4gICAgICAgICAgICAgIHJlbmRlcjogZnVuY3Rpb24gd2hpc3RvcnlSZW5kZXJEaWZmKGRhdGEsIHJlbmRlclR5cGUsIGFsbERhdGEpIHtcbiAgICAgICAgICAgICAgICBpZiAoZGF0YSA9PT0gMSkge1xuICAgICAgICAgICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgICAgICAgICAgJzxpbnB1dCBjbGFzcz1cImhpc3RvcnktZGlmZi1pbnB1dFwiIGRhdGEtcmV2aXNpb249XCInICtcbiAgICAgICAgICAgICAgICAgICAgYWxsRGF0YS5yZXZpc2lvbiArXG4gICAgICAgICAgICAgICAgICAgICdcIiB0eXBlPVwiY2hlY2tib3hcIi8+J1xuICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiXCI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgXSxcblxuICAgICAgICAgIGRyYXdDYWxsYmFjazogZnVuY3Rpb24gd2hpc3RvcnlkcmF3Q2FsbGJhY2soKSB7XG4gICAgICAgICAgICB2YXIgbm90aWNlU2hvd2VkID0gaGlzdG9yeVdpZGdldC5lbGVtZW50XG4gICAgICAgICAgICAgIC5maW5kKFwiLmhpc3RvcnktYnV0dG9uLXNob3dub3RpY2VcIilcbiAgICAgICAgICAgICAgLmRhdGEoXCJzaG93Tm90aWNlXCIpO1xuICAgICAgICAgICAgdmFyIGRldGFpbFNob3dlZCA9IGhpc3RvcnlXaWRnZXQuZWxlbWVudFxuICAgICAgICAgICAgICAuZmluZChcIi5oaXN0b3J5LWJ1dHRvbi1zaG93ZGV0YWlsXCIpXG4gICAgICAgICAgICAgIC5kYXRhKFwic2hvd0RldGFpbFwiKTtcblxuICAgICAgICAgICAgaWYgKGRldGFpbFNob3dlZCkge1xuICAgICAgICAgICAgICBoaXN0b3J5V2lkZ2V0LmVsZW1lbnQuZmluZChcIi5oaXN0b3J5LWNvbW1lbnRcIikuc2hvdygpO1xuICAgICAgICAgICAgICBpZiAoIW5vdGljZVNob3dlZCkge1xuICAgICAgICAgICAgICAgIGhpc3RvcnlXaWRnZXQuZWxlbWVudC5maW5kKFwiLmhpc3RvcnktbGV2ZWwtLW5vdGljZVwiKS5oaWRlKCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGhpc3RvcnlXaWRnZXQuZWxlbWVudC5maW5kKFwiLmhpc3RvcnktY29tbWVudFwiKS5oaWRlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcblxuICAgICAgICAgIGluaXRDb21wbGV0ZTogZnVuY3Rpb24gd2hpc3Rvcnlpbml0Q29tcGxldGUoKSB7XG4gICAgICAgICAgICB2YXIgYXBpID0gdGhpcy5hcGkoKTtcbiAgICAgICAgICAgIHZhciBkYXRhID0gYXBpLnJvd3MoeyBwYWdlOiBcImN1cnJlbnRcIiB9KS5kYXRhKCk7XG4gICAgICAgICAgICAvLyBPdXRwdXQgdGhlIGRhdGEgZm9yIHRoZSB2aXNpYmxlIHJvd3MgdG8gdGhlIGJyb3dzZXIncyBjb25zb2xlXG5cbiAgICAgICAgICAgIC8vIHNob3cgdmVyc2lvbiBpZiBub3QgbnVsbCBpbiBvbmUgcm93XG4gICAgICAgICAgICB2YXIgc2hvd1ZlcnNpb24gPSBmYWxzZTtcbiAgICAgICAgICAgIHZhciBzaG93U3RhdGUgPSBmYWxzZTtcbiAgICAgICAgICAgIHZhciBvbmx5T25lUmV2aXNpb24gPSB0cnVlO1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgIGlmIChkYXRhW2ldLnZlcnNpb24pIHtcbiAgICAgICAgICAgICAgICBzaG93VmVyc2lvbiA9IHRydWU7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgaWYgKGRhdGFbaV0ucmV2aXNpb24gPiAwKSB7XG4gICAgICAgICAgICAgICAgb25seU9uZVJldmlzaW9uID0gZmFsc2U7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICAgIGRhdGFbaV0ubWVzc2FnZSAmJlxuICAgICAgICAgICAgICAgIGRhdGFbaV0ubWVzc2FnZS5zdGF0ZSAmJlxuICAgICAgICAgICAgICAgIGRhdGFbaV0ubWVzc2FnZS5zdGF0ZS5yZWZlcmVuY2VcbiAgICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgc2hvd1N0YXRlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG9ubHlPbmVSZXZpc2lvbikge1xuICAgICAgICAgICAgICAvL2FwaS5jb2x1bW4oXCJyZXZpc2lvbjpuYW1lXCIpLnZpc2libGUoIW9ubHlPbmVSZXZpc2lvbik7XG4gICAgICAgICAgICAgIGhpc3RvcnlXaWRnZXQuZWxlbWVudFxuICAgICAgICAgICAgICAgIC5maW5kKFwiLmhpc3RvcnktZGlmZi1pbnB1dFwiKVxuICAgICAgICAgICAgICAgIC5hdHRyKFwiZGlzYWJsZWRcIiwgXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHNob3dWZXJzaW9uKSB7XG4gICAgICAgICAgICAgIGFwaS5jb2x1bW4oXCJ2ZXJzaW9uOm5hbWVcIikudmlzaWJsZSh0cnVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChzaG93U3RhdGUpIHtcbiAgICAgICAgICAgICAgLy8gQ2hhbmdlIExhYmVsXG4gICAgICAgICAgICAgIGhpc3RvcnlXaWRnZXQuZWxlbWVudFxuICAgICAgICAgICAgICAgIC5maW5kKFwiLmhpc3RvcnktaGVhZGVyLS1tZXNzYWdlXCIpXG4gICAgICAgICAgICAgICAgLmh0bWwoaGlzdG9yeVdpZGdldC5vcHRpb25zLmxhYmVscy5hY3Rpdml0eSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgZml4ZWRSZXZpc2lvblJvdyA9IGhpc3RvcnlXaWRnZXQuZWxlbWVudFxuICAgICAgICAgICAgICAuZmluZChcIi5oaXN0b3J5LWxldmVsLS1yZXZpc2lvblwiKVxuICAgICAgICAgICAgICAuZ2V0KDEpO1xuICAgICAgICAgICAgaWYgKGZpeGVkUmV2aXNpb25Sb3cpIHtcbiAgICAgICAgICAgICAgdmFyIHRySGVhZCA9IGhpc3RvcnlXaWRnZXQuZWxlbWVudFxuICAgICAgICAgICAgICAgIC5maW5kKFwiLmhpc3RvcnktaGVhZGVyXCIpXG4gICAgICAgICAgICAgICAgLmNsb25lKCk7XG4gICAgICAgICAgICAgICQoXG4gICAgICAgICAgICAgICAgJzx0ciBjbGFzcz1cImhpc3Rvcnktc2VwYXJhdG9yXCI+PHRkIGNsYXNzPVwiaGlzdG9yeS1zZXBhcmF0b3ItY2VsbFwiIGNvbHNwYW49XCInICtcbiAgICAgICAgICAgICAgICAgICQodHJIZWFkKS5maW5kKFwidGhcIikubGVuZ3RoICtcbiAgICAgICAgICAgICAgICAgICdcIj48c3Bhbj4nICtcbiAgICAgICAgICAgICAgICAgIGhpc3RvcnlXaWRnZXQub3B0aW9ucy5sYWJlbHMucGFzdFJldmlzaW9uICtcbiAgICAgICAgICAgICAgICAgIFwiPC9zcGFuPlwiICtcbiAgICAgICAgICAgICAgICAgIFwiPC90ZD48L3RyPlwiXG4gICAgICAgICAgICAgICkuaW5zZXJ0QmVmb3JlKGZpeGVkUmV2aXNpb25Sb3cpO1xuICAgICAgICAgICAgICAkKHRySGVhZCkuaW5zZXJ0QmVmb3JlKGZpeGVkUmV2aXNpb25Sb3cpO1xuICAgICAgICAgICAgICBpZiAoc2hvd1N0YXRlKSB7XG4gICAgICAgICAgICAgICAgJCgkKFwiLmhpc3RvcnktaGVhZGVyLS1tZXNzYWdlXCIpLmdldCgxKSkuaHRtbChcbiAgICAgICAgICAgICAgICAgIGhpc3RvcnlXaWRnZXQub3B0aW9ucy5sYWJlbHMuc3RhdGVcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBoaXN0b3J5V2lkZ2V0LmVsZW1lbnQuZmluZChcIi5oaXN0b3J5LWNvbW1lbnRcIikuaGlkZSgpO1xuICAgICAgICAgICAgaGlzdG9yeVdpZGdldC5lbGVtZW50LmZpbmQoXCIub2RkXCIpLnJlbW92ZUNsYXNzKFwib2RkXCIpO1xuICAgICAgICAgICAgaGlzdG9yeVdpZGdldC5lbGVtZW50LmZpbmQoXCIuZXZlblwiKS5yZW1vdmVDbGFzcyhcImV2ZW5cIik7XG4gICAgICAgICAgICBoaXN0b3J5V2lkZ2V0LmVsZW1lbnRcbiAgICAgICAgICAgICAgLmZpbmQoXCIuZGF0YVRhYmxlc19maWx0ZXIgaW5wdXRcIilcbiAgICAgICAgICAgICAgLmFkZENsYXNzKFwiZm9ybS1jb250cm9sIGZvcm0tY29udHJvbC1zbVwiKTtcblxuICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICBoaXN0b3J5V2lkZ2V0LmVsZW1lbnQuZmluZChcIi5oaXN0b3J5LWJ1dHRvbi1zaG93bm90aWNlXCIpXG4gICAgICAgICAgICAgICAgLmxlbmd0aCA9PT0gMFxuICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgIHZhciAkYnV0dG9ucyA9IGhpc3RvcnlXaWRnZXQuZWxlbWVudC5maW5kKFwiLmhpc3RvcnktYnV0dG9uc1wiKTtcblxuICAgICAgICAgICAgICAkYnV0dG9ucy5hcHBlbmQoXG4gICAgICAgICAgICAgICAgJChcbiAgICAgICAgICAgICAgICAgICc8YnV0dG9uIGNsYXNzPVwiaGlzdG9yeS1idXR0b24tc2hvd2RldGFpbCBidG4gYnRuLXNlY29uZGFyeSBidG4tc21cIiA+JyArXG4gICAgICAgICAgICAgICAgICAgIGhpc3RvcnlXaWRnZXQub3B0aW9ucy5sYWJlbHMuc2hvd0RldGFpbCArXG4gICAgICAgICAgICAgICAgICAgIFwiPC9idXR0b24+XCJcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICRidXR0b25zLmFwcGVuZChcbiAgICAgICAgICAgICAgICAkKFxuICAgICAgICAgICAgICAgICAgJzxidXR0b24gZGlzYWJsZWQ9XCJkaXNhYmxlZFwiIGNsYXNzPVwiaGlzdG9yeS1idXR0b24tc2hvd25vdGljZSBidG4gYnRuLW91dGxpbmUtc2Vjb25kYXJ5IGJ0bi1zbVwiID4nICtcbiAgICAgICAgICAgICAgICAgICAgaGlzdG9yeVdpZGdldC5vcHRpb25zLmxhYmVscy5zaG93Tm90aWNlICtcbiAgICAgICAgICAgICAgICAgICAgXCI8L2J1dHRvbj5cIlxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgICBoaXN0b3J5V2lkZ2V0LmVsZW1lbnRcbiAgICAgICAgICAgICAgICAuZmluZChcIi5kYXRhVGFibGVzX2ZpbHRlciBpbnB1dFwiKVxuICAgICAgICAgICAgICAgIC5hdHRyKFxuICAgICAgICAgICAgICAgICAgXCJwbGFjZWhvbGRlclwiLFxuICAgICAgICAgICAgICAgICAgaGlzdG9yeVdpZGdldC5vcHRpb25zLmxhYmVscy5maWx0ZXJNZXNzYWdlc1xuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcblxuICAgICAgICAgIGFqYXg6IGZ1bmN0aW9uIHdoaXN0b3J5X2dldERhdGEoZGF0YSwgY2FsbGJhY2spIHtcbiAgICAgICAgICAgICQuZ2V0SlNPTihcbiAgICAgICAgICAgICAgXCJhcGkvdjIvZG9jdW1lbnRzL1wiICtcbiAgICAgICAgICAgICAgICBoaXN0b3J5V2lkZ2V0Lm9wdGlvbnMuZG9jdW1lbnRJZCArXG4gICAgICAgICAgICAgICAgXCIvaGlzdG9yeS9cIlxuICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAuZG9uZShmdW5jdGlvbiB3aGlzdG9yeV9nZXREYXRhRG9uZShyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIHZhciB0YWJsZURhdGEgPSBoaXN0b3J5V2lkZ2V0Ll9maWxsRGF0YVRhYmxlKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayh7IGRhdGE6IHRhYmxlRGF0YSB9KTtcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgLmZhaWwoZnVuY3Rpb24gd2hpc3RvcnlfZ2V0RGF0YUZhaWwocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gSlNPTi5wYXJzZShyZXNwb25zZS5yZXNwb25zZVRleHQpO1xuICAgICAgICAgICAgICAgIF8uZWFjaChyZXN1bHQubWVzc2FnZXMsIGZ1bmN0aW9uIHdoaXN0b3J5X2dldERhdGFQYXJzZU1lc3NhZ2UoXG4gICAgICAgICAgICAgICAgICBlcnJvclxuICAgICAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgICAgaWYgKGVycm9yLnR5cGUgPT09IFwiZXJyb3JcIikge1xuICAgICAgICAgICAgICAgICAgICAkKFwiYm9keVwiKS50cmlnZ2VyKFwibm90aWZpY2F0aW9uXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBlcnJvci50eXBlLFxuICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IGVycm9yLmNvbnRlbnRUZXh0XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJmYWlsXCIsIHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgICAuYWRkQ2xhc3MoXCJ0YWJsZSB0YWJsZS1jb25kZW5zZWQgdGFibGUtYm9yZGVyZWQgdGFibGUtaG92ZXJcIik7XG4gICAgfSxcblxuICAgIF9kZXN0cm95OiBmdW5jdGlvbiBkY3BEb2N1bWVudEhpc3RvcnlfZGVzdHJveSgpIHtcbiAgICAgIHZhciAkaGlzdG9yeSA9IHRoaXMuZWxlbWVudC5maW5kKFwiLmhpc3RvcnktbWFpblwiKTtcblxuICAgICAgaWYgKCRoaXN0b3J5LkRhdGFUYWJsZSkge1xuICAgICAgICAkaGlzdG9yeS5EYXRhVGFibGUoKS5kZXN0cm95KCk7XG4gICAgICB9XG4gICAgICB0aGlzLl9zdXBlcigpO1xuICAgIH1cbiAgfSk7XG59KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1R0FFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlFQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///67953bae88ec8fa1ab26\n");

/***/ }),

/***/ "698d75b157f24ae829cc":
/*!***********************************!*\
  !*** (webpack)/buildin/global.js ***!
  \***********************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("var g;\n\n// This works in non-strict mode\ng = (function() {\n\treturn this;\n})();\n\ntry {\n\t// This works if eval is allowed (see CSP)\n\tg = g || Function(\"return this\")() || (1, eval)(\"this\");\n} catch (e) {\n\t// This works if the window reference is available\n\tif (typeof window === \"object\") g = window;\n}\n\n// g can still be undefined, but nothing to do about it...\n// We return undefined, instead of nothing here, so it's\n// easier to handle this case. if(!global) { ...}\n\nmodule.exports = g;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNjk4ZDc1YjE1N2YyNGFlODI5Y2MuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vKHdlYnBhY2spL2J1aWxkaW4vZ2xvYmFsLmpzP2NkMDAiXSwic291cmNlc0NvbnRlbnQiOlsidmFyIGc7XG5cbi8vIFRoaXMgd29ya3MgaW4gbm9uLXN0cmljdCBtb2RlXG5nID0gKGZ1bmN0aW9uKCkge1xuXHRyZXR1cm4gdGhpcztcbn0pKCk7XG5cbnRyeSB7XG5cdC8vIFRoaXMgd29ya3MgaWYgZXZhbCBpcyBhbGxvd2VkIChzZWUgQ1NQKVxuXHRnID0gZyB8fCBGdW5jdGlvbihcInJldHVybiB0aGlzXCIpKCkgfHwgKDEsIGV2YWwpKFwidGhpc1wiKTtcbn0gY2F0Y2ggKGUpIHtcblx0Ly8gVGhpcyB3b3JrcyBpZiB0aGUgd2luZG93IHJlZmVyZW5jZSBpcyBhdmFpbGFibGVcblx0aWYgKHR5cGVvZiB3aW5kb3cgPT09IFwib2JqZWN0XCIpIGcgPSB3aW5kb3c7XG59XG5cbi8vIGcgY2FuIHN0aWxsIGJlIHVuZGVmaW5lZCwgYnV0IG5vdGhpbmcgdG8gZG8gYWJvdXQgaXQuLi5cbi8vIFdlIHJldHVybiB1bmRlZmluZWQsIGluc3RlYWQgb2Ygbm90aGluZyBoZXJlLCBzbyBpdCdzXG4vLyBlYXNpZXIgdG8gaGFuZGxlIHRoaXMgY2FzZS4gaWYoIWdsb2JhbCkgeyAuLi59XG5cbm1vZHVsZS5leHBvcnRzID0gZztcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///698d75b157f24ae829cc\n");

/***/ }),

/***/ "6ae127aafe284bc9addc":
/*!******************************************************************!*\
  !*** ./src/Apps/DOCUMENT/IHM/widgets/attributes/image/wImage.js ***!
  \******************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;(function umdRequire(root, factory) {\n  \"use strict\";\n\n  if (true) {\n    !(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(/*! jquery */ \"127c8cf59f228bb01a21\"), __webpack_require__(/*! dcpDocument/widgets/attributes/file/wFile */ \"af25306fd60189c120f8\")], __WEBPACK_AMD_DEFINE_FACTORY__ = (factory),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?\n\t\t\t\t(__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n  } else {}\n})(window, function wImageWidget($) {\n  \"use strict\";\n\n  $.widget(\"dcp.dcpImage\", $.dcp.dcpFile, {\n    options: {\n      type: \"image\",\n      labels: {\n        dropFileHere: \"Drop image here\",\n        placeHolder: \"Click to upload an image\",\n        tooltipLabel: \"Choose image\",\n        downloadLabel: \"Download the image\"\n      },\n      renderOptions: {\n        thumbnailSize: \"100x100\"\n      }\n    },\n\n    _initDom: function wImageInitDom() {\n      if (this.getMode() === \"read\") {\n        if (this.options.attributeValue.url) {\n          if (!this.options.renderOptions.htmlLink.url) {\n            if (this.options.renderOptions.thumbnailSize) {\n              var reSize = /sizes\\/([^/]+)/;\n              this.options.attributeValue.thumbnail =\n                this.options.attributeValue.thumbnail.replace(\n                  reSize,\n                  \"sizes/\" + this.options.renderOptions.thumbnailSize\n                ) + \".png\";\n            } else if (!this.options.renderOptions.thumbnailSize) {\n              this.options.attributeValue.thumbnail = this.options.attributeValue.url;\n            }\n          }\n        }\n      }\n      if (this.options.attributeValue.thumbnail) {\n        this.options.attributeValue.hash = this.options.attributeValue.creationDate.replace(\n          /[ :-]/g,\n          \"\"\n        );\n        this.options.attributeValue.thumbnail +=\n          \"?c=\" + this.options.attributeValue.hash;\n      }\n      this._super();\n    },\n\n    _initEvent: function wFileInitEvent() {\n      this._super();\n      if (this.getMode() === \"read\") {\n        this._initDisplayEvent();\n      }\n    },\n\n    _initDisplayEvent: function wImageinitDisplayEvent() {\n      var scope = this;\n      var htmlLink = this.getLink();\n      this.element.off(\"click\");\n      this.element.on(\n        \"click\" + this.eventNamespace,\n        \".dcpAttribute__content__link\",\n        function wImageClick(event) {\n          if (htmlLink.target === \"_dialog\") {\n            event.preventDefault();\n            var bdw = $(\n              '<div class=\"dcpImage-window\"><img class=\"img-responsive\" src=\"' +\n                $(this).attr(\"href\") +\n                '\"/></div>'\n            );\n            $(\"body\").append(bdw);\n            // $(this).attr(\"href\"),\n            var dw = bdw.kendoWindow({\n              title: scope.options.attributeValue.displayValue,\n              width: htmlLink.windowWidth,\n              height: htmlLink.windowHeight,\n              iframe: false,\n              actions: [\"Maximize\", \"Close\"]\n            });\n\n            dw.data(\"kendoWindow\")\n              .center()\n              .open();\n          }\n        }\n      );\n    },\n\n    /**\n     * Condition before upload file\n     * @returns {boolean}\n     */\n    uploadCondition: function wImageUploadCondition(file) {\n      if (file.type.substr(0, 5) !== \"image\") {\n        this.setError(\"Invalid image file\");\n        return false;\n      }\n      this.setError(null);\n      return true;\n    },\n\n    getType: function wImageGetType() {\n      return \"image\";\n    }\n  });\n\n  return $.fn.dcpImage;\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNmFlMTI3YWFmZTI4NGJjOWFkZGMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvQXBwcy9ET0NVTUVOVC9JSE0vd2lkZ2V0cy9hdHRyaWJ1dGVzL2ltYWdlL3dJbWFnZS5qcz9jYjdmIl0sInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiB1bWRSZXF1aXJlKHJvb3QsIGZhY3RvcnkpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgaWYgKHR5cGVvZiBkZWZpbmUgPT09IFwiZnVuY3Rpb25cIiAmJiBkZWZpbmUuYW1kKSB7XG4gICAgZGVmaW5lKFtcImpxdWVyeVwiLCBcImRjcERvY3VtZW50L3dpZGdldHMvYXR0cmlidXRlcy9maWxlL3dGaWxlXCJdLCBmYWN0b3J5KTtcbiAgfSBlbHNlIHtcbiAgICAvL25vaW5zcGVjdGlvbiBKU1VucmVzb2x2ZWRWYXJpYWJsZVxuICAgIGZhY3Rvcnkod2luZG93LmpRdWVyeSwgd2luZG93Lk11c3RhY2hlKTtcbiAgfVxufSkod2luZG93LCBmdW5jdGlvbiB3SW1hZ2VXaWRnZXQoJCkge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICAkLndpZGdldChcImRjcC5kY3BJbWFnZVwiLCAkLmRjcC5kY3BGaWxlLCB7XG4gICAgb3B0aW9uczoge1xuICAgICAgdHlwZTogXCJpbWFnZVwiLFxuICAgICAgbGFiZWxzOiB7XG4gICAgICAgIGRyb3BGaWxlSGVyZTogXCJEcm9wIGltYWdlIGhlcmVcIixcbiAgICAgICAgcGxhY2VIb2xkZXI6IFwiQ2xpY2sgdG8gdXBsb2FkIGFuIGltYWdlXCIsXG4gICAgICAgIHRvb2x0aXBMYWJlbDogXCJDaG9vc2UgaW1hZ2VcIixcbiAgICAgICAgZG93bmxvYWRMYWJlbDogXCJEb3dubG9hZCB0aGUgaW1hZ2VcIlxuICAgICAgfSxcbiAgICAgIHJlbmRlck9wdGlvbnM6IHtcbiAgICAgICAgdGh1bWJuYWlsU2l6ZTogXCIxMDB4MTAwXCJcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgX2luaXREb206IGZ1bmN0aW9uIHdJbWFnZUluaXREb20oKSB7XG4gICAgICBpZiAodGhpcy5nZXRNb2RlKCkgPT09IFwicmVhZFwiKSB7XG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMuYXR0cmlidXRlVmFsdWUudXJsKSB7XG4gICAgICAgICAgaWYgKCF0aGlzLm9wdGlvbnMucmVuZGVyT3B0aW9ucy5odG1sTGluay51cmwpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMucmVuZGVyT3B0aW9ucy50aHVtYm5haWxTaXplKSB7XG4gICAgICAgICAgICAgIHZhciByZVNpemUgPSAvc2l6ZXNcXC8oW14vXSspLztcbiAgICAgICAgICAgICAgdGhpcy5vcHRpb25zLmF0dHJpYnV0ZVZhbHVlLnRodW1ibmFpbCA9XG4gICAgICAgICAgICAgICAgdGhpcy5vcHRpb25zLmF0dHJpYnV0ZVZhbHVlLnRodW1ibmFpbC5yZXBsYWNlKFxuICAgICAgICAgICAgICAgICAgcmVTaXplLFxuICAgICAgICAgICAgICAgICAgXCJzaXplcy9cIiArIHRoaXMub3B0aW9ucy5yZW5kZXJPcHRpb25zLnRodW1ibmFpbFNpemVcbiAgICAgICAgICAgICAgICApICsgXCIucG5nXCI7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKCF0aGlzLm9wdGlvbnMucmVuZGVyT3B0aW9ucy50aHVtYm5haWxTaXplKSB7XG4gICAgICAgICAgICAgIHRoaXMub3B0aW9ucy5hdHRyaWJ1dGVWYWx1ZS50aHVtYm5haWwgPSB0aGlzLm9wdGlvbnMuYXR0cmlidXRlVmFsdWUudXJsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKHRoaXMub3B0aW9ucy5hdHRyaWJ1dGVWYWx1ZS50aHVtYm5haWwpIHtcbiAgICAgICAgdGhpcy5vcHRpb25zLmF0dHJpYnV0ZVZhbHVlLmhhc2ggPSB0aGlzLm9wdGlvbnMuYXR0cmlidXRlVmFsdWUuY3JlYXRpb25EYXRlLnJlcGxhY2UoXG4gICAgICAgICAgL1sgOi1dL2csXG4gICAgICAgICAgXCJcIlxuICAgICAgICApO1xuICAgICAgICB0aGlzLm9wdGlvbnMuYXR0cmlidXRlVmFsdWUudGh1bWJuYWlsICs9XG4gICAgICAgICAgXCI/Yz1cIiArIHRoaXMub3B0aW9ucy5hdHRyaWJ1dGVWYWx1ZS5oYXNoO1xuICAgICAgfVxuICAgICAgdGhpcy5fc3VwZXIoKTtcbiAgICB9LFxuXG4gICAgX2luaXRFdmVudDogZnVuY3Rpb24gd0ZpbGVJbml0RXZlbnQoKSB7XG4gICAgICB0aGlzLl9zdXBlcigpO1xuICAgICAgaWYgKHRoaXMuZ2V0TW9kZSgpID09PSBcInJlYWRcIikge1xuICAgICAgICB0aGlzLl9pbml0RGlzcGxheUV2ZW50KCk7XG4gICAgICB9XG4gICAgfSxcblxuICAgIF9pbml0RGlzcGxheUV2ZW50OiBmdW5jdGlvbiB3SW1hZ2Vpbml0RGlzcGxheUV2ZW50KCkge1xuICAgICAgdmFyIHNjb3BlID0gdGhpcztcbiAgICAgIHZhciBodG1sTGluayA9IHRoaXMuZ2V0TGluaygpO1xuICAgICAgdGhpcy5lbGVtZW50Lm9mZihcImNsaWNrXCIpO1xuICAgICAgdGhpcy5lbGVtZW50Lm9uKFxuICAgICAgICBcImNsaWNrXCIgKyB0aGlzLmV2ZW50TmFtZXNwYWNlLFxuICAgICAgICBcIi5kY3BBdHRyaWJ1dGVfX2NvbnRlbnRfX2xpbmtcIixcbiAgICAgICAgZnVuY3Rpb24gd0ltYWdlQ2xpY2soZXZlbnQpIHtcbiAgICAgICAgICBpZiAoaHRtbExpbmsudGFyZ2V0ID09PSBcIl9kaWFsb2dcIikge1xuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIHZhciBiZHcgPSAkKFxuICAgICAgICAgICAgICAnPGRpdiBjbGFzcz1cImRjcEltYWdlLXdpbmRvd1wiPjxpbWcgY2xhc3M9XCJpbWctcmVzcG9uc2l2ZVwiIHNyYz1cIicgK1xuICAgICAgICAgICAgICAgICQodGhpcykuYXR0cihcImhyZWZcIikgK1xuICAgICAgICAgICAgICAgICdcIi8+PC9kaXY+J1xuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICQoXCJib2R5XCIpLmFwcGVuZChiZHcpO1xuICAgICAgICAgICAgLy8gJCh0aGlzKS5hdHRyKFwiaHJlZlwiKSxcbiAgICAgICAgICAgIHZhciBkdyA9IGJkdy5rZW5kb1dpbmRvdyh7XG4gICAgICAgICAgICAgIHRpdGxlOiBzY29wZS5vcHRpb25zLmF0dHJpYnV0ZVZhbHVlLmRpc3BsYXlWYWx1ZSxcbiAgICAgICAgICAgICAgd2lkdGg6IGh0bWxMaW5rLndpbmRvd1dpZHRoLFxuICAgICAgICAgICAgICBoZWlnaHQ6IGh0bWxMaW5rLndpbmRvd0hlaWdodCxcbiAgICAgICAgICAgICAgaWZyYW1lOiBmYWxzZSxcbiAgICAgICAgICAgICAgYWN0aW9uczogW1wiTWF4aW1pemVcIiwgXCJDbG9zZVwiXVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGR3LmRhdGEoXCJrZW5kb1dpbmRvd1wiKVxuICAgICAgICAgICAgICAuY2VudGVyKClcbiAgICAgICAgICAgICAgLm9wZW4oKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIENvbmRpdGlvbiBiZWZvcmUgdXBsb2FkIGZpbGVcbiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn1cbiAgICAgKi9cbiAgICB1cGxvYWRDb25kaXRpb246IGZ1bmN0aW9uIHdJbWFnZVVwbG9hZENvbmRpdGlvbihmaWxlKSB7XG4gICAgICBpZiAoZmlsZS50eXBlLnN1YnN0cigwLCA1KSAhPT0gXCJpbWFnZVwiKSB7XG4gICAgICAgIHRoaXMuc2V0RXJyb3IoXCJJbnZhbGlkIGltYWdlIGZpbGVcIik7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIHRoaXMuc2V0RXJyb3IobnVsbCk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9LFxuXG4gICAgZ2V0VHlwZTogZnVuY3Rpb24gd0ltYWdlR2V0VHlwZSgpIHtcbiAgICAgIHJldHVybiBcImltYWdlXCI7XG4gICAgfVxuICB9KTtcblxuICByZXR1cm4gJC5mbi5kY3BJbWFnZTtcbn0pO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQ0EsV0FHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///6ae127aafe284bc9addc\n");

/***/ }),

/***/ "6d281ded32c7dc89e58d":
/*!*********************************************************!*\
  !*** ./src/Apps/DOCUMENT/IHM/i18n/translatorFactory.js ***!
  \*********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/*global define*/\n// use \"text!dcpContextRoot/api/v2/i18n/DOCUMENT\" to get only DDUI translation\n\nwindow.dcp = window.dcp || {};\n\n(function umdRequire(root, requireFunction) {\n  \"use strict\";\n\n  if (true) {\n    !(__WEBPACK_AMD_DEFINE_ARRAY__ = [], __WEBPACK_AMD_DEFINE_FACTORY__ = (requireFunction),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?\n\t\t\t\t(__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n  }\n  root.dcp.translatorFactory = requireFunction([]);\n})(window, function require_translatorFactory() {\n  \"use strict\";\n\n  var isString = function isString(obj) {\n    return typeof obj === \"string\";\n  };\n\n  return function catalog(translation) {\n    if (isString(translation)) {\n      try {\n        translation = JSON.parse(translation);\n      } catch (e) {\n        translation = { data: { catalog: {} } };\n        console.error(\"Locale catalog error : \" + e.message);\n      }\n    }\n\n    return {\n      _catalog: translation.data.catalog,\n      _locale: translation.data.locale,\n\n      /**\n       * Return key translation\n       * @param key text to translate\n       * @returns string\n       */\n      _: function i18n_gettext(key) {\n        if (key && this._catalog[key]) {\n          return this._catalog[key];\n        }\n        return key;\n      },\n      /**\n       * Return key translation in context\n       * @param key text to translate\n       * @param ctxt context\n       * @returns {*}\n       */\n      ___: function i18n_pgettext(key, ctxt) {\n        if (\n          key &&\n          this._catalog &&\n          this._catalog._msgctxt_ &&\n          this._catalog._msgctxt_[ctxt] &&\n          this._catalog._msgctxt_[ctxt][key]\n        ) {\n          return this._catalog._msgctxt_[ctxt][key];\n        }\n        return key;\n      },\n      /**\n       * Return some info on the current locale\n       *\n       * @returns {locale|{culture}|*|string|string}\n       */\n      getLocale: function i18n_getLocale() {\n        return this._locale;\n      }\n    };\n  };\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNmQyODFkZWQzMmM3ZGM4OWU1OGQuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvQXBwcy9ET0NVTUVOVC9JSE0vaTE4bi90cmFuc2xhdG9yRmFjdG9yeS5qcz9mM2NiIl0sInNvdXJjZXNDb250ZW50IjpbIi8qZ2xvYmFsIGRlZmluZSovXG4vLyB1c2UgXCJ0ZXh0IWRjcENvbnRleHRSb290L2FwaS92Mi9pMThuL0RPQ1VNRU5UXCIgdG8gZ2V0IG9ubHkgRERVSSB0cmFuc2xhdGlvblxuXG53aW5kb3cuZGNwID0gd2luZG93LmRjcCB8fCB7fTtcblxuKGZ1bmN0aW9uIHVtZFJlcXVpcmUocm9vdCwgcmVxdWlyZUZ1bmN0aW9uKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIGlmICh0eXBlb2YgZGVmaW5lID09PSBcImZ1bmN0aW9uXCIgJiYgZGVmaW5lLmFtZCkge1xuICAgIGRlZmluZShbXSwgcmVxdWlyZUZ1bmN0aW9uKTtcbiAgfVxuICByb290LmRjcC50cmFuc2xhdG9yRmFjdG9yeSA9IHJlcXVpcmVGdW5jdGlvbihbXSk7XG59KSh3aW5kb3csIGZ1bmN0aW9uIHJlcXVpcmVfdHJhbnNsYXRvckZhY3RvcnkoKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIHZhciBpc1N0cmluZyA9IGZ1bmN0aW9uIGlzU3RyaW5nKG9iaikge1xuICAgIHJldHVybiB0eXBlb2Ygb2JqID09PSBcInN0cmluZ1wiO1xuICB9O1xuXG4gIHJldHVybiBmdW5jdGlvbiBjYXRhbG9nKHRyYW5zbGF0aW9uKSB7XG4gICAgaWYgKGlzU3RyaW5nKHRyYW5zbGF0aW9uKSkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgdHJhbnNsYXRpb24gPSBKU09OLnBhcnNlKHRyYW5zbGF0aW9uKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgdHJhbnNsYXRpb24gPSB7IGRhdGE6IHsgY2F0YWxvZzoge30gfSB9O1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiTG9jYWxlIGNhdGFsb2cgZXJyb3IgOiBcIiArIGUubWVzc2FnZSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIF9jYXRhbG9nOiB0cmFuc2xhdGlvbi5kYXRhLmNhdGFsb2csXG4gICAgICBfbG9jYWxlOiB0cmFuc2xhdGlvbi5kYXRhLmxvY2FsZSxcblxuICAgICAgLyoqXG4gICAgICAgKiBSZXR1cm4ga2V5IHRyYW5zbGF0aW9uXG4gICAgICAgKiBAcGFyYW0ga2V5IHRleHQgdG8gdHJhbnNsYXRlXG4gICAgICAgKiBAcmV0dXJucyBzdHJpbmdcbiAgICAgICAqL1xuICAgICAgXzogZnVuY3Rpb24gaTE4bl9nZXR0ZXh0KGtleSkge1xuICAgICAgICBpZiAoa2V5ICYmIHRoaXMuX2NhdGFsb2dba2V5XSkge1xuICAgICAgICAgIHJldHVybiB0aGlzLl9jYXRhbG9nW2tleV07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGtleTtcbiAgICAgIH0sXG4gICAgICAvKipcbiAgICAgICAqIFJldHVybiBrZXkgdHJhbnNsYXRpb24gaW4gY29udGV4dFxuICAgICAgICogQHBhcmFtIGtleSB0ZXh0IHRvIHRyYW5zbGF0ZVxuICAgICAgICogQHBhcmFtIGN0eHQgY29udGV4dFxuICAgICAgICogQHJldHVybnMgeyp9XG4gICAgICAgKi9cbiAgICAgIF9fXzogZnVuY3Rpb24gaTE4bl9wZ2V0dGV4dChrZXksIGN0eHQpIHtcbiAgICAgICAgaWYgKFxuICAgICAgICAgIGtleSAmJlxuICAgICAgICAgIHRoaXMuX2NhdGFsb2cgJiZcbiAgICAgICAgICB0aGlzLl9jYXRhbG9nLl9tc2djdHh0XyAmJlxuICAgICAgICAgIHRoaXMuX2NhdGFsb2cuX21zZ2N0eHRfW2N0eHRdICYmXG4gICAgICAgICAgdGhpcy5fY2F0YWxvZy5fbXNnY3R4dF9bY3R4dF1ba2V5XVxuICAgICAgICApIHtcbiAgICAgICAgICByZXR1cm4gdGhpcy5fY2F0YWxvZy5fbXNnY3R4dF9bY3R4dF1ba2V5XTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4ga2V5O1xuICAgICAgfSxcbiAgICAgIC8qKlxuICAgICAgICogUmV0dXJuIHNvbWUgaW5mbyBvbiB0aGUgY3VycmVudCBsb2NhbGVcbiAgICAgICAqXG4gICAgICAgKiBAcmV0dXJucyB7bG9jYWxlfHtjdWx0dXJlfXwqfHN0cmluZ3xzdHJpbmd9XG4gICAgICAgKi9cbiAgICAgIGdldExvY2FsZTogZnVuY3Rpb24gaTE4bl9nZXRMb2NhbGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9sb2NhbGU7XG4gICAgICB9XG4gICAgfTtcbiAgfTtcbn0pO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///6d281ded32c7dc89e58d\n");

/***/ }),

/***/ "6dbe3b90603a8175dd85":
/*!**************************************************************************!*\
  !*** ./src/Apps/DOCUMENT/IHM/widgets/attributes/timestamp/wTimestamp.js ***!
  \**************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;(function umdRequire(root, factory) {\n  \"use strict\";\n\n  if (true) {\n    !(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(/*! jquery */ \"127c8cf59f228bb01a21\"), __webpack_require__(/*! dcpDocument/widgets/attributes/date/wDate */ \"bd13ec831aaf61fba460\")], __WEBPACK_AMD_DEFINE_FACTORY__ = (factory),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?\n\t\t\t\t(__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n  } else {}\n})(window, function requireTimestamp($) {\n  \"use strict\";\n\n  $.widget(\"dcp.dcpTimestamp\", $.dcp.dcpDate, {\n    options: {\n      type: \"timestamp\",\n      minDate: new Date(1700, 0, 1),\n      renderOptions: {\n        kendoDateConfiguration: {\n          timeFormat: \"HH:mm\", //24 hours format\n          parseFormats: [\n            \"yyyy-MM-dd HH:mm:ss\",\n            \"yyyy-MM-ddTHH:mm:ss\",\n            \"yyyy-MM-ddTHH:mm\"\n          ],\n          format: null\n        }\n      }\n    },\n\n    kendoWidgetClass: \"kendoDateTimePicker\",\n\n    _initDom: function wTimeStampInitDom() {\n      if (this.options.attributeValue.value) {\n        // Add T (iso date) if not set\n\n        this.options.attributeValue.value = this.replaceAt(\n          this.options.attributeValue.value,\n          10,\n          \"T\"\n        );\n      }\n      this._super();\n    },\n\n    replaceAt: function wTimeStampReplaceAt(s, n, t) {\n      return s.substring(0, n) + t + s.substring(n + 1);\n    },\n\n    setValue: function wTimeStampSetValue(value) {\n      if (value.value) {\n        // Add T (iso date) if not set\n        value.value = this.replaceAt(value.value, 10, \"T\");\n      }\n      this._super(value);\n    },\n\n    _activateDate: function wTimeStamp_activateDate(inputValue) {\n      var currentWidget = this;\n      var kendoOptions = this.getKendoOptions();\n      kendoOptions.change = function wTimeStamp_onChange() {\n        if (this.value() !== null) {\n          // only valid date are setted\n          // wrong date are set by blur event\n          var isoDate = currentWidget.convertDateToPseudoIsoString(\n            this.value()\n          );\n          // Need to set by widget to use raw date\n          currentWidget.setValue({\n            value: isoDate,\n            displayValue: inputValue.val()\n          });\n        }\n      };\n      inputValue.kendoDateTimePicker(kendoOptions);\n\n      this._controlDate(inputValue);\n    },\n\n    convertDateToPseudoIsoString: function wTimeStamp_convertDateToPseudoIsoString(\n      dateObject\n    ) {\n      if (dateObject && typeof dateObject === \"object\") {\n        return (\n          dateObject.getFullYear() +\n          \"-\" +\n          this.padNumber(dateObject.getMonth() + 1) +\n          \"-\" +\n          this.padNumber(dateObject.getDate()) +\n          \"T\" +\n          this.padNumber(dateObject.getHours()) +\n          \":\" +\n          this.padNumber(dateObject.getMinutes()) +\n          \":\" +\n          this.padNumber(dateObject.getSeconds())\n        );\n      }\n      return \"\";\n    },\n\n    formatDate: function wTimeStamp_formatDate(value) {\n      if (this.options.renderOptions.kendoDateConfiguration.format) {\n        return kendo.toString(\n          value,\n          this.options.renderOptions.kendoDateConfiguration.format\n        );\n      }\n      return kendo.toString(value, \"g\");\n    },\n\n    getType: function wTimeStamp_getType() {\n      return \"timestamp\";\n    }\n  });\n\n  return $.fn.dcpTimestamp;\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNmRiZTNiOTA2MDNhODE3NWRkODUuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvQXBwcy9ET0NVTUVOVC9JSE0vd2lkZ2V0cy9hdHRyaWJ1dGVzL3RpbWVzdGFtcC93VGltZXN0YW1wLmpzPzQxZjYiXSwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIHVtZFJlcXVpcmUocm9vdCwgZmFjdG9yeSkge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICBpZiAodHlwZW9mIGRlZmluZSA9PT0gXCJmdW5jdGlvblwiICYmIGRlZmluZS5hbWQpIHtcbiAgICBkZWZpbmUoW1wianF1ZXJ5XCIsIFwiZGNwRG9jdW1lbnQvd2lkZ2V0cy9hdHRyaWJ1dGVzL2RhdGUvd0RhdGVcIl0sIGZhY3RvcnkpO1xuICB9IGVsc2Uge1xuICAgIC8vbm9pbnNwZWN0aW9uIEpTVW5yZXNvbHZlZFZhcmlhYmxlXG4gICAgZmFjdG9yeSh3aW5kb3cualF1ZXJ5KTtcbiAgfVxufSkod2luZG93LCBmdW5jdGlvbiByZXF1aXJlVGltZXN0YW1wKCQpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgJC53aWRnZXQoXCJkY3AuZGNwVGltZXN0YW1wXCIsICQuZGNwLmRjcERhdGUsIHtcbiAgICBvcHRpb25zOiB7XG4gICAgICB0eXBlOiBcInRpbWVzdGFtcFwiLFxuICAgICAgbWluRGF0ZTogbmV3IERhdGUoMTcwMCwgMCwgMSksXG4gICAgICByZW5kZXJPcHRpb25zOiB7XG4gICAgICAgIGtlbmRvRGF0ZUNvbmZpZ3VyYXRpb246IHtcbiAgICAgICAgICB0aW1lRm9ybWF0OiBcIkhIOm1tXCIsIC8vMjQgaG91cnMgZm9ybWF0XG4gICAgICAgICAgcGFyc2VGb3JtYXRzOiBbXG4gICAgICAgICAgICBcInl5eXktTU0tZGQgSEg6bW06c3NcIixcbiAgICAgICAgICAgIFwieXl5eS1NTS1kZFRISDptbTpzc1wiLFxuICAgICAgICAgICAgXCJ5eXl5LU1NLWRkVEhIOm1tXCJcbiAgICAgICAgICBdLFxuICAgICAgICAgIGZvcm1hdDogbnVsbFxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcblxuICAgIGtlbmRvV2lkZ2V0Q2xhc3M6IFwia2VuZG9EYXRlVGltZVBpY2tlclwiLFxuXG4gICAgX2luaXREb206IGZ1bmN0aW9uIHdUaW1lU3RhbXBJbml0RG9tKCkge1xuICAgICAgaWYgKHRoaXMub3B0aW9ucy5hdHRyaWJ1dGVWYWx1ZS52YWx1ZSkge1xuICAgICAgICAvLyBBZGQgVCAoaXNvIGRhdGUpIGlmIG5vdCBzZXRcblxuICAgICAgICB0aGlzLm9wdGlvbnMuYXR0cmlidXRlVmFsdWUudmFsdWUgPSB0aGlzLnJlcGxhY2VBdChcbiAgICAgICAgICB0aGlzLm9wdGlvbnMuYXR0cmlidXRlVmFsdWUudmFsdWUsXG4gICAgICAgICAgMTAsXG4gICAgICAgICAgXCJUXCJcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuX3N1cGVyKCk7XG4gICAgfSxcblxuICAgIHJlcGxhY2VBdDogZnVuY3Rpb24gd1RpbWVTdGFtcFJlcGxhY2VBdChzLCBuLCB0KSB7XG4gICAgICByZXR1cm4gcy5zdWJzdHJpbmcoMCwgbikgKyB0ICsgcy5zdWJzdHJpbmcobiArIDEpO1xuICAgIH0sXG5cbiAgICBzZXRWYWx1ZTogZnVuY3Rpb24gd1RpbWVTdGFtcFNldFZhbHVlKHZhbHVlKSB7XG4gICAgICBpZiAodmFsdWUudmFsdWUpIHtcbiAgICAgICAgLy8gQWRkIFQgKGlzbyBkYXRlKSBpZiBub3Qgc2V0XG4gICAgICAgIHZhbHVlLnZhbHVlID0gdGhpcy5yZXBsYWNlQXQodmFsdWUudmFsdWUsIDEwLCBcIlRcIik7XG4gICAgICB9XG4gICAgICB0aGlzLl9zdXBlcih2YWx1ZSk7XG4gICAgfSxcblxuICAgIF9hY3RpdmF0ZURhdGU6IGZ1bmN0aW9uIHdUaW1lU3RhbXBfYWN0aXZhdGVEYXRlKGlucHV0VmFsdWUpIHtcbiAgICAgIHZhciBjdXJyZW50V2lkZ2V0ID0gdGhpcztcbiAgICAgIHZhciBrZW5kb09wdGlvbnMgPSB0aGlzLmdldEtlbmRvT3B0aW9ucygpO1xuICAgICAga2VuZG9PcHRpb25zLmNoYW5nZSA9IGZ1bmN0aW9uIHdUaW1lU3RhbXBfb25DaGFuZ2UoKSB7XG4gICAgICAgIGlmICh0aGlzLnZhbHVlKCkgIT09IG51bGwpIHtcbiAgICAgICAgICAvLyBvbmx5IHZhbGlkIGRhdGUgYXJlIHNldHRlZFxuICAgICAgICAgIC8vIHdyb25nIGRhdGUgYXJlIHNldCBieSBibHVyIGV2ZW50XG4gICAgICAgICAgdmFyIGlzb0RhdGUgPSBjdXJyZW50V2lkZ2V0LmNvbnZlcnREYXRlVG9Qc2V1ZG9Jc29TdHJpbmcoXG4gICAgICAgICAgICB0aGlzLnZhbHVlKClcbiAgICAgICAgICApO1xuICAgICAgICAgIC8vIE5lZWQgdG8gc2V0IGJ5IHdpZGdldCB0byB1c2UgcmF3IGRhdGVcbiAgICAgICAgICBjdXJyZW50V2lkZ2V0LnNldFZhbHVlKHtcbiAgICAgICAgICAgIHZhbHVlOiBpc29EYXRlLFxuICAgICAgICAgICAgZGlzcGxheVZhbHVlOiBpbnB1dFZhbHVlLnZhbCgpXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICBpbnB1dFZhbHVlLmtlbmRvRGF0ZVRpbWVQaWNrZXIoa2VuZG9PcHRpb25zKTtcblxuICAgICAgdGhpcy5fY29udHJvbERhdGUoaW5wdXRWYWx1ZSk7XG4gICAgfSxcblxuICAgIGNvbnZlcnREYXRlVG9Qc2V1ZG9Jc29TdHJpbmc6IGZ1bmN0aW9uIHdUaW1lU3RhbXBfY29udmVydERhdGVUb1BzZXVkb0lzb1N0cmluZyhcbiAgICAgIGRhdGVPYmplY3RcbiAgICApIHtcbiAgICAgIGlmIChkYXRlT2JqZWN0ICYmIHR5cGVvZiBkYXRlT2JqZWN0ID09PSBcIm9iamVjdFwiKSB7XG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgZGF0ZU9iamVjdC5nZXRGdWxsWWVhcigpICtcbiAgICAgICAgICBcIi1cIiArXG4gICAgICAgICAgdGhpcy5wYWROdW1iZXIoZGF0ZU9iamVjdC5nZXRNb250aCgpICsgMSkgK1xuICAgICAgICAgIFwiLVwiICtcbiAgICAgICAgICB0aGlzLnBhZE51bWJlcihkYXRlT2JqZWN0LmdldERhdGUoKSkgK1xuICAgICAgICAgIFwiVFwiICtcbiAgICAgICAgICB0aGlzLnBhZE51bWJlcihkYXRlT2JqZWN0LmdldEhvdXJzKCkpICtcbiAgICAgICAgICBcIjpcIiArXG4gICAgICAgICAgdGhpcy5wYWROdW1iZXIoZGF0ZU9iamVjdC5nZXRNaW51dGVzKCkpICtcbiAgICAgICAgICBcIjpcIiArXG4gICAgICAgICAgdGhpcy5wYWROdW1iZXIoZGF0ZU9iamVjdC5nZXRTZWNvbmRzKCkpXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICByZXR1cm4gXCJcIjtcbiAgICB9LFxuXG4gICAgZm9ybWF0RGF0ZTogZnVuY3Rpb24gd1RpbWVTdGFtcF9mb3JtYXREYXRlKHZhbHVlKSB7XG4gICAgICBpZiAodGhpcy5vcHRpb25zLnJlbmRlck9wdGlvbnMua2VuZG9EYXRlQ29uZmlndXJhdGlvbi5mb3JtYXQpIHtcbiAgICAgICAgcmV0dXJuIGtlbmRvLnRvU3RyaW5nKFxuICAgICAgICAgIHZhbHVlLFxuICAgICAgICAgIHRoaXMub3B0aW9ucy5yZW5kZXJPcHRpb25zLmtlbmRvRGF0ZUNvbmZpZ3VyYXRpb24uZm9ybWF0XG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICByZXR1cm4ga2VuZG8udG9TdHJpbmcodmFsdWUsIFwiZ1wiKTtcbiAgICB9LFxuXG4gICAgZ2V0VHlwZTogZnVuY3Rpb24gd1RpbWVTdGFtcF9nZXRUeXBlKCkge1xuICAgICAgcmV0dXJuIFwidGltZXN0YW1wXCI7XG4gICAgfVxuICB9KTtcblxuICByZXR1cm4gJC5mbi5kY3BUaW1lc3RhbXA7XG59KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUNBLFdBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///6dbe3b90603a8175dd85\n");

/***/ }),

/***/ "72335e037ab5116fdf0c":
/*!********************************************************!*\
  !*** ./src/Apps/DOCUMENT/IHM/models/mAttributeData.js ***!
  \********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;!(__WEBPACK_AMD_DEFINE_ARRAY__ = [\n  __webpack_require__(/*! underscore */ \"8e08e542008e4aef1f58\"),\n  __webpack_require__(/*! dcpDocument/models/mAttribute */ \"0a26bdc45fd66878f3b9\"),\n  __webpack_require__(/*! dcpDocument/controllerObjects/constraintHandler */ \"e10c73398bdea22dc801\")\n], __WEBPACK_AMD_DEFINE_RESULT__ = (function require_mAttributeData(_, AttributeModel, ConstraintHandler) {\n  \"use strict\";\n\n  return AttributeModel.extend({\n    typeModel: \"ddui:attributeData\",\n    defaults: {\n      isValueAttribute: true,\n      multiple: false,\n      attributeValue: null\n    },\n\n    initialize: function mAttributeinitialize() {\n      this.listenTo(this, \"change:attributeValue\", this.checkConstraint);\n      this._initialAttributeValue = this.get(\"attributeValue\") || {\n        value: null\n      };\n      AttributeModel.prototype.initialize.apply(this, arguments);\n    },\n\n    getValue: function mAttributegetValue() {\n      return this.get(\"attributeValue\");\n    },\n    setValue: function mAttributesetValue(value, index) {\n      var currentValue, idx;\n      if (this.get(\"multiple\") && !_.isNumber(index) && !_.isArray(value)) {\n        throw new Error(\n          \"You need to add an index to set value for a multiple id \" + this.id\n        );\n      }\n      if (this.get(\"multiple\") && index >= 0) {\n        currentValue = _.clone(this.get(\"attributeValue\"));\n        if (currentValue.length < index) {\n          for (idx = currentValue.length; idx < index; idx++) {\n            currentValue.push({ value: null, displayValue: \"\" });\n          }\n        }\n        currentValue[index] = value;\n        this.set(\"attributeValue\", currentValue);\n      } else {\n        this.set(\"attributeValue\", value);\n      }\n    },\n\n    addValue: function mAttributeaddValue(value, index, options) {\n      var currentValue;\n      if (this.hasMultipleOption() && !_.isNumber(index) && !_.isArray(value)) {\n        throw new Error(\n          \"You need to add an index or use array to set value for a multiple id \" +\n            this.id\n        );\n      }\n      // clone array references\n      currentValue = _.toArray(_.map(this.get(\"attributeValue\"), _.clone));\n\n      if (this.hasMultipleOption() && index >= 0) {\n        //Init the multiple value if void\n        if (!currentValue[index]) {\n          currentValue[index] = [];\n        }\n        currentValue[index].push(value);\n        this.set(\"attributeValue\", currentValue, options);\n      } else {\n        currentValue.push(value);\n        this.set(\"attributeValue\", _.clone(currentValue), options);\n      }\n    },\n\n    removeIndexValue: function mAttributeremoveIndexValue(index) {\n      var currentValue, oldValue;\n      if (!this.get(\"multiple\") || !_.isNumber(index)) {\n        throw new Error(\n          \"You need to add an index to set value for a multiple id \" + this.id\n        );\n      }\n      oldValue = this.get(\"attributeValue\");\n      currentValue = _.clone(this.get(\"attributeValue\"));\n      _.each(currentValue, function mAttributeRemoveIndex(value, currentIndex) {\n        currentIndex = parseInt(currentIndex, 10);\n        if (currentIndex === index) {\n          delete currentValue[index];\n        }\n        if (currentIndex > index && oldValue[currentIndex]) {\n          delete currentValue[currentIndex];\n          currentValue[currentIndex - 1] = oldValue[currentIndex];\n        }\n      });\n      currentValue = _.filter(currentValue, function removeUndefined(\n        currentValue\n      ) {\n        return !_.isUndefined(currentValue);\n      });\n      this.set(\"attributeValue\", currentValue, { notUpdateArray: true });\n    },\n\n    /**\n     * Add an indexed value with or without default value\n     * Used by attributes in array to add new line or duplicate line\n     *\n     * @param index\n     * @param copy\n     * @param updateArray set to true to resize array widget\n     */\n    createIndexedValue: function mAttributeCreateIndexedValue(\n      index,\n      copy,\n      updateArray\n    ) {\n      var currentValue, defaultValue;\n      var newValue;\n      if (!this.get(\"multiple\") || !_.isNumber(index)) {\n        throw new Error(\n          \"You need to add an index to set value for a multiple id \" + this.id\n        );\n      }\n      currentValue = _.toArray(_.map(this.get(\"attributeValue\"), _.clone));\n      defaultValue = this.attributes.defaultValue;\n      if (copy) {\n        newValue = _.clone(currentValue[index]);\n      } else if (defaultValue) {\n        newValue = defaultValue;\n      } else if (this.hasMultipleOption()) {\n        newValue = [];\n      } else {\n        newValue = { value: null, displayValue: \"\" };\n      }\n\n      if (index > currentValue.length) {\n        currentValue.push(newValue);\n      } else {\n        currentValue.splice(index, 0, newValue);\n      }\n      this.set(\"attributeValue\", currentValue, {\n        notUpdateArray: !updateArray\n      });\n    },\n\n    /**\n     * Add values to indexed element\n     * Used by attributes in array to add new line or duplicate line\n     *\n     * @param newValue\n     * @param index\n     */\n    addIndexedValue: function mAttributeAddIndexedValue(newValue, index) {\n      var currentValue;\n      if (!_.isNumber(index)) {\n        throw new Error(\n          \"You need to add an index to set value indexed value \" + this.id\n        );\n      }\n      currentValue = _.toArray(_.map(this.get(\"attributeValue\"), _.clone));\n\n      if (index > currentValue.length) {\n        currentValue.push(newValue);\n      } else {\n        currentValue.splice(index, 0, newValue);\n      }\n      this.set(\"attributeValue\", currentValue);\n    },\n\n    /**\n     * move a value in multiple value attribute\n     * @param fromIndex\n     * @param toIndex\n     */\n    moveIndexValue: function mAttributemoveIndexValue(fromIndex, toIndex) {\n      var currentValue, fromValue;\n      if (!this.get(\"multiple\")) {\n        throw new Error(\"Move only multiple attribute : \" + this.id);\n      }\n      currentValue = _.toArray(this.get(\"attributeValue\"));\n      fromValue = _.clone(currentValue[fromIndex]);\n\n      currentValue.splice(fromIndex, 1);\n      currentValue.splice(toIndex, 0, fromValue);\n\n      this.set(\"attributeValue\", currentValue);\n      this.trigger(\"moved\", { from: fromIndex, to: toIndex });\n    },\n\n    getNbLines: function mAttributegetNbLines() {\n      var nbLines = 0;\n      if (!this.get(\"multiple\")) {\n        return -1;\n      }\n      _.each(this.get(\"attributeValue\"), function mAttributeGetMaxLine(\n        value,\n        index\n      ) {\n        if (index > nbLines) {\n          nbLines = index;\n        }\n      });\n      return nbLines;\n    },\n\n    isInArray: function mAttributeisInArray() {\n      var aparent = this.getParent();\n      return (\n        aparent && aparent.attributes && aparent.attributes.type === \"array\"\n      );\n    },\n\n    checkConstraint: function mAttributecheckConstraint(config) {\n      var response = new ConstraintHandler(),\n        responseText = {};\n      var scope = this;\n      config = _.extend(\n        { clearError: this.hasInternalError, displayError: true },\n        config\n      );\n      this.trigger(\"constraint\", {\n        model: this,\n        response: response,\n        value: this.get(\"attributeValue\")\n      });\n      if (response.hasConstraintMessages()) {\n        _.each(\n          response.getConstraintMessages(),\n          function mAttributeData_checkConstraintElement(currentResponse) {\n            responseText[currentResponse.index] =\n              responseText[currentResponse.index] || \"\";\n            responseText[currentResponse.index] +=\n              currentResponse.message + \" \";\n          }\n        );\n        if (config.displayError) {\n          this.hasInternalError = true;\n          // Force redraw\n          scope.setErrorMessage(null); // jshint ignore:line\n\n          _.each(responseText, function mAttributeData_checkErrorMessage(\n            text,\n            index\n          ) {\n            index = parseInt(index);\n            scope.setErrorMessage(text, index);\n          });\n        }\n        return false;\n      } else {\n        if (config.clearError) {\n          this.setErrorMessage(null);\n          this.hasInternalError = false;\n        }\n        return true;\n      }\n    }\n  });\n}).apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNzIzMzVlMDM3YWI1MTE2ZmRmMGMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvQXBwcy9ET0NVTUVOVC9JSE0vbW9kZWxzL21BdHRyaWJ1dGVEYXRhLmpzP2U2MDMiXSwic291cmNlc0NvbnRlbnQiOlsiZGVmaW5lKFtcbiAgXCJ1bmRlcnNjb3JlXCIsXG4gIFwiZGNwRG9jdW1lbnQvbW9kZWxzL21BdHRyaWJ1dGVcIixcbiAgXCJkY3BEb2N1bWVudC9jb250cm9sbGVyT2JqZWN0cy9jb25zdHJhaW50SGFuZGxlclwiXG5dLCBmdW5jdGlvbiByZXF1aXJlX21BdHRyaWJ1dGVEYXRhKF8sIEF0dHJpYnV0ZU1vZGVsLCBDb25zdHJhaW50SGFuZGxlcikge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICByZXR1cm4gQXR0cmlidXRlTW9kZWwuZXh0ZW5kKHtcbiAgICB0eXBlTW9kZWw6IFwiZGR1aTphdHRyaWJ1dGVEYXRhXCIsXG4gICAgZGVmYXVsdHM6IHtcbiAgICAgIGlzVmFsdWVBdHRyaWJ1dGU6IHRydWUsXG4gICAgICBtdWx0aXBsZTogZmFsc2UsXG4gICAgICBhdHRyaWJ1dGVWYWx1ZTogbnVsbFxuICAgIH0sXG5cbiAgICBpbml0aWFsaXplOiBmdW5jdGlvbiBtQXR0cmlidXRlaW5pdGlhbGl6ZSgpIHtcbiAgICAgIHRoaXMubGlzdGVuVG8odGhpcywgXCJjaGFuZ2U6YXR0cmlidXRlVmFsdWVcIiwgdGhpcy5jaGVja0NvbnN0cmFpbnQpO1xuICAgICAgdGhpcy5faW5pdGlhbEF0dHJpYnV0ZVZhbHVlID0gdGhpcy5nZXQoXCJhdHRyaWJ1dGVWYWx1ZVwiKSB8fCB7XG4gICAgICAgIHZhbHVlOiBudWxsXG4gICAgICB9O1xuICAgICAgQXR0cmlidXRlTW9kZWwucHJvdG90eXBlLmluaXRpYWxpemUuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICB9LFxuXG4gICAgZ2V0VmFsdWU6IGZ1bmN0aW9uIG1BdHRyaWJ1dGVnZXRWYWx1ZSgpIHtcbiAgICAgIHJldHVybiB0aGlzLmdldChcImF0dHJpYnV0ZVZhbHVlXCIpO1xuICAgIH0sXG4gICAgc2V0VmFsdWU6IGZ1bmN0aW9uIG1BdHRyaWJ1dGVzZXRWYWx1ZSh2YWx1ZSwgaW5kZXgpIHtcbiAgICAgIHZhciBjdXJyZW50VmFsdWUsIGlkeDtcbiAgICAgIGlmICh0aGlzLmdldChcIm11bHRpcGxlXCIpICYmICFfLmlzTnVtYmVyKGluZGV4KSAmJiAhXy5pc0FycmF5KHZhbHVlKSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgXCJZb3UgbmVlZCB0byBhZGQgYW4gaW5kZXggdG8gc2V0IHZhbHVlIGZvciBhIG11bHRpcGxlIGlkIFwiICsgdGhpcy5pZFxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMuZ2V0KFwibXVsdGlwbGVcIikgJiYgaW5kZXggPj0gMCkge1xuICAgICAgICBjdXJyZW50VmFsdWUgPSBfLmNsb25lKHRoaXMuZ2V0KFwiYXR0cmlidXRlVmFsdWVcIikpO1xuICAgICAgICBpZiAoY3VycmVudFZhbHVlLmxlbmd0aCA8IGluZGV4KSB7XG4gICAgICAgICAgZm9yIChpZHggPSBjdXJyZW50VmFsdWUubGVuZ3RoOyBpZHggPCBpbmRleDsgaWR4KyspIHtcbiAgICAgICAgICAgIGN1cnJlbnRWYWx1ZS5wdXNoKHsgdmFsdWU6IG51bGwsIGRpc3BsYXlWYWx1ZTogXCJcIiB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY3VycmVudFZhbHVlW2luZGV4XSA9IHZhbHVlO1xuICAgICAgICB0aGlzLnNldChcImF0dHJpYnV0ZVZhbHVlXCIsIGN1cnJlbnRWYWx1ZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnNldChcImF0dHJpYnV0ZVZhbHVlXCIsIHZhbHVlKTtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgYWRkVmFsdWU6IGZ1bmN0aW9uIG1BdHRyaWJ1dGVhZGRWYWx1ZSh2YWx1ZSwgaW5kZXgsIG9wdGlvbnMpIHtcbiAgICAgIHZhciBjdXJyZW50VmFsdWU7XG4gICAgICBpZiAodGhpcy5oYXNNdWx0aXBsZU9wdGlvbigpICYmICFfLmlzTnVtYmVyKGluZGV4KSAmJiAhXy5pc0FycmF5KHZhbHVlKSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgXCJZb3UgbmVlZCB0byBhZGQgYW4gaW5kZXggb3IgdXNlIGFycmF5IHRvIHNldCB2YWx1ZSBmb3IgYSBtdWx0aXBsZSBpZCBcIiArXG4gICAgICAgICAgICB0aGlzLmlkXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICAvLyBjbG9uZSBhcnJheSByZWZlcmVuY2VzXG4gICAgICBjdXJyZW50VmFsdWUgPSBfLnRvQXJyYXkoXy5tYXAodGhpcy5nZXQoXCJhdHRyaWJ1dGVWYWx1ZVwiKSwgXy5jbG9uZSkpO1xuXG4gICAgICBpZiAodGhpcy5oYXNNdWx0aXBsZU9wdGlvbigpICYmIGluZGV4ID49IDApIHtcbiAgICAgICAgLy9Jbml0IHRoZSBtdWx0aXBsZSB2YWx1ZSBpZiB2b2lkXG4gICAgICAgIGlmICghY3VycmVudFZhbHVlW2luZGV4XSkge1xuICAgICAgICAgIGN1cnJlbnRWYWx1ZVtpbmRleF0gPSBbXTtcbiAgICAgICAgfVxuICAgICAgICBjdXJyZW50VmFsdWVbaW5kZXhdLnB1c2godmFsdWUpO1xuICAgICAgICB0aGlzLnNldChcImF0dHJpYnV0ZVZhbHVlXCIsIGN1cnJlbnRWYWx1ZSwgb3B0aW9ucyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjdXJyZW50VmFsdWUucHVzaCh2YWx1ZSk7XG4gICAgICAgIHRoaXMuc2V0KFwiYXR0cmlidXRlVmFsdWVcIiwgXy5jbG9uZShjdXJyZW50VmFsdWUpLCBvcHRpb25zKTtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgcmVtb3ZlSW5kZXhWYWx1ZTogZnVuY3Rpb24gbUF0dHJpYnV0ZXJlbW92ZUluZGV4VmFsdWUoaW5kZXgpIHtcbiAgICAgIHZhciBjdXJyZW50VmFsdWUsIG9sZFZhbHVlO1xuICAgICAgaWYgKCF0aGlzLmdldChcIm11bHRpcGxlXCIpIHx8ICFfLmlzTnVtYmVyKGluZGV4KSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgXCJZb3UgbmVlZCB0byBhZGQgYW4gaW5kZXggdG8gc2V0IHZhbHVlIGZvciBhIG11bHRpcGxlIGlkIFwiICsgdGhpcy5pZFxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgb2xkVmFsdWUgPSB0aGlzLmdldChcImF0dHJpYnV0ZVZhbHVlXCIpO1xuICAgICAgY3VycmVudFZhbHVlID0gXy5jbG9uZSh0aGlzLmdldChcImF0dHJpYnV0ZVZhbHVlXCIpKTtcbiAgICAgIF8uZWFjaChjdXJyZW50VmFsdWUsIGZ1bmN0aW9uIG1BdHRyaWJ1dGVSZW1vdmVJbmRleCh2YWx1ZSwgY3VycmVudEluZGV4KSB7XG4gICAgICAgIGN1cnJlbnRJbmRleCA9IHBhcnNlSW50KGN1cnJlbnRJbmRleCwgMTApO1xuICAgICAgICBpZiAoY3VycmVudEluZGV4ID09PSBpbmRleCkge1xuICAgICAgICAgIGRlbGV0ZSBjdXJyZW50VmFsdWVbaW5kZXhdO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjdXJyZW50SW5kZXggPiBpbmRleCAmJiBvbGRWYWx1ZVtjdXJyZW50SW5kZXhdKSB7XG4gICAgICAgICAgZGVsZXRlIGN1cnJlbnRWYWx1ZVtjdXJyZW50SW5kZXhdO1xuICAgICAgICAgIGN1cnJlbnRWYWx1ZVtjdXJyZW50SW5kZXggLSAxXSA9IG9sZFZhbHVlW2N1cnJlbnRJbmRleF07XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgY3VycmVudFZhbHVlID0gXy5maWx0ZXIoY3VycmVudFZhbHVlLCBmdW5jdGlvbiByZW1vdmVVbmRlZmluZWQoXG4gICAgICAgIGN1cnJlbnRWYWx1ZVxuICAgICAgKSB7XG4gICAgICAgIHJldHVybiAhXy5pc1VuZGVmaW5lZChjdXJyZW50VmFsdWUpO1xuICAgICAgfSk7XG4gICAgICB0aGlzLnNldChcImF0dHJpYnV0ZVZhbHVlXCIsIGN1cnJlbnRWYWx1ZSwgeyBub3RVcGRhdGVBcnJheTogdHJ1ZSB9KTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQWRkIGFuIGluZGV4ZWQgdmFsdWUgd2l0aCBvciB3aXRob3V0IGRlZmF1bHQgdmFsdWVcbiAgICAgKiBVc2VkIGJ5IGF0dHJpYnV0ZXMgaW4gYXJyYXkgdG8gYWRkIG5ldyBsaW5lIG9yIGR1cGxpY2F0ZSBsaW5lXG4gICAgICpcbiAgICAgKiBAcGFyYW0gaW5kZXhcbiAgICAgKiBAcGFyYW0gY29weVxuICAgICAqIEBwYXJhbSB1cGRhdGVBcnJheSBzZXQgdG8gdHJ1ZSB0byByZXNpemUgYXJyYXkgd2lkZ2V0XG4gICAgICovXG4gICAgY3JlYXRlSW5kZXhlZFZhbHVlOiBmdW5jdGlvbiBtQXR0cmlidXRlQ3JlYXRlSW5kZXhlZFZhbHVlKFxuICAgICAgaW5kZXgsXG4gICAgICBjb3B5LFxuICAgICAgdXBkYXRlQXJyYXlcbiAgICApIHtcbiAgICAgIHZhciBjdXJyZW50VmFsdWUsIGRlZmF1bHRWYWx1ZTtcbiAgICAgIHZhciBuZXdWYWx1ZTtcbiAgICAgIGlmICghdGhpcy5nZXQoXCJtdWx0aXBsZVwiKSB8fCAhXy5pc051bWJlcihpbmRleCkpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgIFwiWW91IG5lZWQgdG8gYWRkIGFuIGluZGV4IHRvIHNldCB2YWx1ZSBmb3IgYSBtdWx0aXBsZSBpZCBcIiArIHRoaXMuaWRcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIGN1cnJlbnRWYWx1ZSA9IF8udG9BcnJheShfLm1hcCh0aGlzLmdldChcImF0dHJpYnV0ZVZhbHVlXCIpLCBfLmNsb25lKSk7XG4gICAgICBkZWZhdWx0VmFsdWUgPSB0aGlzLmF0dHJpYnV0ZXMuZGVmYXVsdFZhbHVlO1xuICAgICAgaWYgKGNvcHkpIHtcbiAgICAgICAgbmV3VmFsdWUgPSBfLmNsb25lKGN1cnJlbnRWYWx1ZVtpbmRleF0pO1xuICAgICAgfSBlbHNlIGlmIChkZWZhdWx0VmFsdWUpIHtcbiAgICAgICAgbmV3VmFsdWUgPSBkZWZhdWx0VmFsdWU7XG4gICAgICB9IGVsc2UgaWYgKHRoaXMuaGFzTXVsdGlwbGVPcHRpb24oKSkge1xuICAgICAgICBuZXdWYWx1ZSA9IFtdO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbmV3VmFsdWUgPSB7IHZhbHVlOiBudWxsLCBkaXNwbGF5VmFsdWU6IFwiXCIgfTtcbiAgICAgIH1cblxuICAgICAgaWYgKGluZGV4ID4gY3VycmVudFZhbHVlLmxlbmd0aCkge1xuICAgICAgICBjdXJyZW50VmFsdWUucHVzaChuZXdWYWx1ZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjdXJyZW50VmFsdWUuc3BsaWNlKGluZGV4LCAwLCBuZXdWYWx1ZSk7XG4gICAgICB9XG4gICAgICB0aGlzLnNldChcImF0dHJpYnV0ZVZhbHVlXCIsIGN1cnJlbnRWYWx1ZSwge1xuICAgICAgICBub3RVcGRhdGVBcnJheTogIXVwZGF0ZUFycmF5XG4gICAgICB9KTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQWRkIHZhbHVlcyB0byBpbmRleGVkIGVsZW1lbnRcbiAgICAgKiBVc2VkIGJ5IGF0dHJpYnV0ZXMgaW4gYXJyYXkgdG8gYWRkIG5ldyBsaW5lIG9yIGR1cGxpY2F0ZSBsaW5lXG4gICAgICpcbiAgICAgKiBAcGFyYW0gbmV3VmFsdWVcbiAgICAgKiBAcGFyYW0gaW5kZXhcbiAgICAgKi9cbiAgICBhZGRJbmRleGVkVmFsdWU6IGZ1bmN0aW9uIG1BdHRyaWJ1dGVBZGRJbmRleGVkVmFsdWUobmV3VmFsdWUsIGluZGV4KSB7XG4gICAgICB2YXIgY3VycmVudFZhbHVlO1xuICAgICAgaWYgKCFfLmlzTnVtYmVyKGluZGV4KSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgXCJZb3UgbmVlZCB0byBhZGQgYW4gaW5kZXggdG8gc2V0IHZhbHVlIGluZGV4ZWQgdmFsdWUgXCIgKyB0aGlzLmlkXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICBjdXJyZW50VmFsdWUgPSBfLnRvQXJyYXkoXy5tYXAodGhpcy5nZXQoXCJhdHRyaWJ1dGVWYWx1ZVwiKSwgXy5jbG9uZSkpO1xuXG4gICAgICBpZiAoaW5kZXggPiBjdXJyZW50VmFsdWUubGVuZ3RoKSB7XG4gICAgICAgIGN1cnJlbnRWYWx1ZS5wdXNoKG5ld1ZhbHVlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGN1cnJlbnRWYWx1ZS5zcGxpY2UoaW5kZXgsIDAsIG5ld1ZhbHVlKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuc2V0KFwiYXR0cmlidXRlVmFsdWVcIiwgY3VycmVudFZhbHVlKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogbW92ZSBhIHZhbHVlIGluIG11bHRpcGxlIHZhbHVlIGF0dHJpYnV0ZVxuICAgICAqIEBwYXJhbSBmcm9tSW5kZXhcbiAgICAgKiBAcGFyYW0gdG9JbmRleFxuICAgICAqL1xuICAgIG1vdmVJbmRleFZhbHVlOiBmdW5jdGlvbiBtQXR0cmlidXRlbW92ZUluZGV4VmFsdWUoZnJvbUluZGV4LCB0b0luZGV4KSB7XG4gICAgICB2YXIgY3VycmVudFZhbHVlLCBmcm9tVmFsdWU7XG4gICAgICBpZiAoIXRoaXMuZ2V0KFwibXVsdGlwbGVcIikpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTW92ZSBvbmx5IG11bHRpcGxlIGF0dHJpYnV0ZSA6IFwiICsgdGhpcy5pZCk7XG4gICAgICB9XG4gICAgICBjdXJyZW50VmFsdWUgPSBfLnRvQXJyYXkodGhpcy5nZXQoXCJhdHRyaWJ1dGVWYWx1ZVwiKSk7XG4gICAgICBmcm9tVmFsdWUgPSBfLmNsb25lKGN1cnJlbnRWYWx1ZVtmcm9tSW5kZXhdKTtcblxuICAgICAgY3VycmVudFZhbHVlLnNwbGljZShmcm9tSW5kZXgsIDEpO1xuICAgICAgY3VycmVudFZhbHVlLnNwbGljZSh0b0luZGV4LCAwLCBmcm9tVmFsdWUpO1xuXG4gICAgICB0aGlzLnNldChcImF0dHJpYnV0ZVZhbHVlXCIsIGN1cnJlbnRWYWx1ZSk7XG4gICAgICB0aGlzLnRyaWdnZXIoXCJtb3ZlZFwiLCB7IGZyb206IGZyb21JbmRleCwgdG86IHRvSW5kZXggfSk7XG4gICAgfSxcblxuICAgIGdldE5iTGluZXM6IGZ1bmN0aW9uIG1BdHRyaWJ1dGVnZXROYkxpbmVzKCkge1xuICAgICAgdmFyIG5iTGluZXMgPSAwO1xuICAgICAgaWYgKCF0aGlzLmdldChcIm11bHRpcGxlXCIpKSB7XG4gICAgICAgIHJldHVybiAtMTtcbiAgICAgIH1cbiAgICAgIF8uZWFjaCh0aGlzLmdldChcImF0dHJpYnV0ZVZhbHVlXCIpLCBmdW5jdGlvbiBtQXR0cmlidXRlR2V0TWF4TGluZShcbiAgICAgICAgdmFsdWUsXG4gICAgICAgIGluZGV4XG4gICAgICApIHtcbiAgICAgICAgaWYgKGluZGV4ID4gbmJMaW5lcykge1xuICAgICAgICAgIG5iTGluZXMgPSBpbmRleDtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICByZXR1cm4gbmJMaW5lcztcbiAgICB9LFxuXG4gICAgaXNJbkFycmF5OiBmdW5jdGlvbiBtQXR0cmlidXRlaXNJbkFycmF5KCkge1xuICAgICAgdmFyIGFwYXJlbnQgPSB0aGlzLmdldFBhcmVudCgpO1xuICAgICAgcmV0dXJuIChcbiAgICAgICAgYXBhcmVudCAmJiBhcGFyZW50LmF0dHJpYnV0ZXMgJiYgYXBhcmVudC5hdHRyaWJ1dGVzLnR5cGUgPT09IFwiYXJyYXlcIlxuICAgICAgKTtcbiAgICB9LFxuXG4gICAgY2hlY2tDb25zdHJhaW50OiBmdW5jdGlvbiBtQXR0cmlidXRlY2hlY2tDb25zdHJhaW50KGNvbmZpZykge1xuICAgICAgdmFyIHJlc3BvbnNlID0gbmV3IENvbnN0cmFpbnRIYW5kbGVyKCksXG4gICAgICAgIHJlc3BvbnNlVGV4dCA9IHt9O1xuICAgICAgdmFyIHNjb3BlID0gdGhpcztcbiAgICAgIGNvbmZpZyA9IF8uZXh0ZW5kKFxuICAgICAgICB7IGNsZWFyRXJyb3I6IHRoaXMuaGFzSW50ZXJuYWxFcnJvciwgZGlzcGxheUVycm9yOiB0cnVlIH0sXG4gICAgICAgIGNvbmZpZ1xuICAgICAgKTtcbiAgICAgIHRoaXMudHJpZ2dlcihcImNvbnN0cmFpbnRcIiwge1xuICAgICAgICBtb2RlbDogdGhpcyxcbiAgICAgICAgcmVzcG9uc2U6IHJlc3BvbnNlLFxuICAgICAgICB2YWx1ZTogdGhpcy5nZXQoXCJhdHRyaWJ1dGVWYWx1ZVwiKVxuICAgICAgfSk7XG4gICAgICBpZiAocmVzcG9uc2UuaGFzQ29uc3RyYWludE1lc3NhZ2VzKCkpIHtcbiAgICAgICAgXy5lYWNoKFxuICAgICAgICAgIHJlc3BvbnNlLmdldENvbnN0cmFpbnRNZXNzYWdlcygpLFxuICAgICAgICAgIGZ1bmN0aW9uIG1BdHRyaWJ1dGVEYXRhX2NoZWNrQ29uc3RyYWludEVsZW1lbnQoY3VycmVudFJlc3BvbnNlKSB7XG4gICAgICAgICAgICByZXNwb25zZVRleHRbY3VycmVudFJlc3BvbnNlLmluZGV4XSA9XG4gICAgICAgICAgICAgIHJlc3BvbnNlVGV4dFtjdXJyZW50UmVzcG9uc2UuaW5kZXhdIHx8IFwiXCI7XG4gICAgICAgICAgICByZXNwb25zZVRleHRbY3VycmVudFJlc3BvbnNlLmluZGV4XSArPVxuICAgICAgICAgICAgICBjdXJyZW50UmVzcG9uc2UubWVzc2FnZSArIFwiIFwiO1xuICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICAgICAgaWYgKGNvbmZpZy5kaXNwbGF5RXJyb3IpIHtcbiAgICAgICAgICB0aGlzLmhhc0ludGVybmFsRXJyb3IgPSB0cnVlO1xuICAgICAgICAgIC8vIEZvcmNlIHJlZHJhd1xuICAgICAgICAgIHNjb3BlLnNldEVycm9yTWVzc2FnZShudWxsKTsgLy8ganNoaW50IGlnbm9yZTpsaW5lXG5cbiAgICAgICAgICBfLmVhY2gocmVzcG9uc2VUZXh0LCBmdW5jdGlvbiBtQXR0cmlidXRlRGF0YV9jaGVja0Vycm9yTWVzc2FnZShcbiAgICAgICAgICAgIHRleHQsXG4gICAgICAgICAgICBpbmRleFxuICAgICAgICAgICkge1xuICAgICAgICAgICAgaW5kZXggPSBwYXJzZUludChpbmRleCk7XG4gICAgICAgICAgICBzY29wZS5zZXRFcnJvck1lc3NhZ2UodGV4dCwgaW5kZXgpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmIChjb25maWcuY2xlYXJFcnJvcikge1xuICAgICAgICAgIHRoaXMuc2V0RXJyb3JNZXNzYWdlKG51bGwpO1xuICAgICAgICAgIHRoaXMuaGFzSW50ZXJuYWxFcnJvciA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG59KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///72335e037ab5116fdf0c\n");

/***/ }),

/***/ "72700e7eabedfcaa8458":
/*!************************************************************************!*\
  !*** ./src/Apps/DOCUMENT/IHM/controllerObjects/transitionInterface.js ***!
  \************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/*global define*/\n!(__WEBPACK_AMD_DEFINE_ARRAY__ = [], __WEBPACK_AMD_DEFINE_RESULT__ = (function require_transitionInterface() {\n  \"use strict\";\n\n  var TransitionInterfacePrototype = function TransitionInterfacePrototype() {};\n\n  TransitionInterfacePrototype.prototype.getValues = function TransitionInterfacePrototype_getValues() {\n    if (!this._TransitionModel) {\n      return null;\n    }\n    return this._TransitionModel.toJSON();\n  };\n\n  TransitionInterfacePrototype.prototype.hide = function TransitionInterfacePrototype_hide() {\n    if (!this._TransitionModel) {\n      return null;\n    }\n    return this._TransitionModel.trigger(\"hide\");\n  };\n\n  TransitionInterfacePrototype.prototype.show = function TransitionInterfacePrototype_show() {\n    if (!this._TransitionModel) {\n      return null;\n    }\n    return this._TransitionModel.trigger(\"show\");\n  };\n\n  TransitionInterfacePrototype.prototype.close = function TransitionInterfacePrototype_close() {\n    if (!this._TransitionModel) {\n      return null;\n    }\n    return this._TransitionModel.trigger(\"close\");\n  };\n\n  var TransitionInterface = function TransitionInterface(\n    transitionModel,\n    $el,\n    nextState,\n    transition\n  ) {\n    this._TransitionModel = transitionModel;\n    this.$el = $el;\n    this.nextState = nextState;\n    this.transition = transition;\n    TransitionInterfacePrototype.call(this);\n  };\n\n  TransitionInterface.prototype = Object.create(\n    TransitionInterfacePrototype.prototype\n  );\n  TransitionInterface.prototype.constructor = TransitionInterfacePrototype;\n\n  return TransitionInterface;\n}).apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNzI3MDBlN2VhYmVkZmNhYTg0NTguanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvQXBwcy9ET0NVTUVOVC9JSE0vY29udHJvbGxlck9iamVjdHMvdHJhbnNpdGlvbkludGVyZmFjZS5qcz8zY2Y3Il0sInNvdXJjZXNDb250ZW50IjpbIi8qZ2xvYmFsIGRlZmluZSovXG5kZWZpbmUoW10sIGZ1bmN0aW9uIHJlcXVpcmVfdHJhbnNpdGlvbkludGVyZmFjZSgpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgdmFyIFRyYW5zaXRpb25JbnRlcmZhY2VQcm90b3R5cGUgPSBmdW5jdGlvbiBUcmFuc2l0aW9uSW50ZXJmYWNlUHJvdG90eXBlKCkge307XG5cbiAgVHJhbnNpdGlvbkludGVyZmFjZVByb3RvdHlwZS5wcm90b3R5cGUuZ2V0VmFsdWVzID0gZnVuY3Rpb24gVHJhbnNpdGlvbkludGVyZmFjZVByb3RvdHlwZV9nZXRWYWx1ZXMoKSB7XG4gICAgaWYgKCF0aGlzLl9UcmFuc2l0aW9uTW9kZWwpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5fVHJhbnNpdGlvbk1vZGVsLnRvSlNPTigpO1xuICB9O1xuXG4gIFRyYW5zaXRpb25JbnRlcmZhY2VQcm90b3R5cGUucHJvdG90eXBlLmhpZGUgPSBmdW5jdGlvbiBUcmFuc2l0aW9uSW50ZXJmYWNlUHJvdG90eXBlX2hpZGUoKSB7XG4gICAgaWYgKCF0aGlzLl9UcmFuc2l0aW9uTW9kZWwpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5fVHJhbnNpdGlvbk1vZGVsLnRyaWdnZXIoXCJoaWRlXCIpO1xuICB9O1xuXG4gIFRyYW5zaXRpb25JbnRlcmZhY2VQcm90b3R5cGUucHJvdG90eXBlLnNob3cgPSBmdW5jdGlvbiBUcmFuc2l0aW9uSW50ZXJmYWNlUHJvdG90eXBlX3Nob3coKSB7XG4gICAgaWYgKCF0aGlzLl9UcmFuc2l0aW9uTW9kZWwpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5fVHJhbnNpdGlvbk1vZGVsLnRyaWdnZXIoXCJzaG93XCIpO1xuICB9O1xuXG4gIFRyYW5zaXRpb25JbnRlcmZhY2VQcm90b3R5cGUucHJvdG90eXBlLmNsb3NlID0gZnVuY3Rpb24gVHJhbnNpdGlvbkludGVyZmFjZVByb3RvdHlwZV9jbG9zZSgpIHtcbiAgICBpZiAoIXRoaXMuX1RyYW5zaXRpb25Nb2RlbCkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLl9UcmFuc2l0aW9uTW9kZWwudHJpZ2dlcihcImNsb3NlXCIpO1xuICB9O1xuXG4gIHZhciBUcmFuc2l0aW9uSW50ZXJmYWNlID0gZnVuY3Rpb24gVHJhbnNpdGlvbkludGVyZmFjZShcbiAgICB0cmFuc2l0aW9uTW9kZWwsXG4gICAgJGVsLFxuICAgIG5leHRTdGF0ZSxcbiAgICB0cmFuc2l0aW9uXG4gICkge1xuICAgIHRoaXMuX1RyYW5zaXRpb25Nb2RlbCA9IHRyYW5zaXRpb25Nb2RlbDtcbiAgICB0aGlzLiRlbCA9ICRlbDtcbiAgICB0aGlzLm5leHRTdGF0ZSA9IG5leHRTdGF0ZTtcbiAgICB0aGlzLnRyYW5zaXRpb24gPSB0cmFuc2l0aW9uO1xuICAgIFRyYW5zaXRpb25JbnRlcmZhY2VQcm90b3R5cGUuY2FsbCh0aGlzKTtcbiAgfTtcblxuICBUcmFuc2l0aW9uSW50ZXJmYWNlLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoXG4gICAgVHJhbnNpdGlvbkludGVyZmFjZVByb3RvdHlwZS5wcm90b3R5cGVcbiAgKTtcbiAgVHJhbnNpdGlvbkludGVyZmFjZS5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBUcmFuc2l0aW9uSW50ZXJmYWNlUHJvdG90eXBlO1xuXG4gIHJldHVybiBUcmFuc2l0aW9uSW50ZXJmYWNlO1xufSk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///72700e7eabedfcaa8458\n");

/***/ }),

/***/ "72eda5b0d863ce233971":
/*!****************************************************************!*\
  !*** ./src/Apps/DOCUMENT/IHM/collections/contentAttributes.js ***!
  \****************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/*global define*/\n!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(/*! underscore */ \"8e08e542008e4aef1f58\"), __webpack_require__(/*! backbone */ \"1858b45bf48591489d06\")], __WEBPACK_AMD_DEFINE_RESULT__ = (function(_, Backbone) {\n  \"use strict\";\n\n  return Backbone.Collection.extend({\n    comparator: \"logicalOrder\",\n\n    toData: function(index, extended) {\n      var elements = [];\n      this.each(function(currentAttribute) {\n        elements.push(currentAttribute.toData(index, extended));\n      });\n      return elements;\n    },\n\n    destroy: function() {\n      var model;\n      while ((model = this.first())) {\n        // jshint ignore:line\n        model.destroy();\n      }\n    },\n\n    propageEvent: function(eventName) {\n      this.each(function(currentModel) {\n        currentModel.trigger(eventName);\n        if (currentModel.get(\"content\")) {\n          currentModel.get(\"content\").propageEvent(eventName);\n        }\n      });\n    }\n  });\n}).apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNzJlZGE1YjBkODYzY2UyMzM5NzEuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvQXBwcy9ET0NVTUVOVC9JSE0vY29sbGVjdGlvbnMvY29udGVudEF0dHJpYnV0ZXMuanM/MTYyNCJdLCJzb3VyY2VzQ29udGVudCI6WyIvKmdsb2JhbCBkZWZpbmUqL1xuZGVmaW5lKFtcInVuZGVyc2NvcmVcIiwgXCJiYWNrYm9uZVwiXSwgZnVuY3Rpb24oXywgQmFja2JvbmUpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgcmV0dXJuIEJhY2tib25lLkNvbGxlY3Rpb24uZXh0ZW5kKHtcbiAgICBjb21wYXJhdG9yOiBcImxvZ2ljYWxPcmRlclwiLFxuXG4gICAgdG9EYXRhOiBmdW5jdGlvbihpbmRleCwgZXh0ZW5kZWQpIHtcbiAgICAgIHZhciBlbGVtZW50cyA9IFtdO1xuICAgICAgdGhpcy5lYWNoKGZ1bmN0aW9uKGN1cnJlbnRBdHRyaWJ1dGUpIHtcbiAgICAgICAgZWxlbWVudHMucHVzaChjdXJyZW50QXR0cmlidXRlLnRvRGF0YShpbmRleCwgZXh0ZW5kZWQpKTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGVsZW1lbnRzO1xuICAgIH0sXG5cbiAgICBkZXN0cm95OiBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBtb2RlbDtcbiAgICAgIHdoaWxlICgobW9kZWwgPSB0aGlzLmZpcnN0KCkpKSB7XG4gICAgICAgIC8vIGpzaGludCBpZ25vcmU6bGluZVxuICAgICAgICBtb2RlbC5kZXN0cm95KCk7XG4gICAgICB9XG4gICAgfSxcblxuICAgIHByb3BhZ2VFdmVudDogZnVuY3Rpb24oZXZlbnROYW1lKSB7XG4gICAgICB0aGlzLmVhY2goZnVuY3Rpb24oY3VycmVudE1vZGVsKSB7XG4gICAgICAgIGN1cnJlbnRNb2RlbC50cmlnZ2VyKGV2ZW50TmFtZSk7XG4gICAgICAgIGlmIChjdXJyZW50TW9kZWwuZ2V0KFwiY29udGVudFwiKSkge1xuICAgICAgICAgIGN1cnJlbnRNb2RlbC5nZXQoXCJjb250ZW50XCIpLnByb3BhZ2VFdmVudChldmVudE5hbWUpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xufSk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///72eda5b0d863ce233971\n");

/***/ }),

/***/ "77d7ff9509612d0e239e":
/*!***************************************************************!*\
  !*** ./src/Apps/DOCUMENT/IHM/widgets/window/wNotification.js ***!
  \***************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;!(__WEBPACK_AMD_DEFINE_ARRAY__ = [\n  __webpack_require__(/*! jquery */ \"127c8cf59f228bb01a21\"),\n  __webpack_require__(/*! underscore */ \"8e08e542008e4aef1f58\"),\n  __webpack_require__(/*! dcpDocument/widgets/widget */ \"f562ab9f022eef93542c\")\n], __WEBPACK_AMD_DEFINE_RESULT__ = (function wNotification($, _) {\n  \"use strict\";\n\n  $.widget(\"dcp.dcpNotification\", {\n    options: {\n      // animation:false,\n      autoHideAfter: 5000,\n      appendTo: \"#dcpNotificationContainer\",\n      position: {\n        top: 60, // override by notification.less\n        right: 100\n      },\n      templates: [\n        {\n          type: \"error\",\n          template:\n            '<div class=\"dcpNotification--content dcpNotification--error\">' +\n            '<span class=\"dcpNotification--symbol fa-stack fa-lg\"><span class=\"fa fa-bolt\"></span></span>' +\n            '<div class=\"dcpNotification--message\"><h1>#: title #</h1>' +\n            \"<p>#: message #</p><p> #= htmlMessage #</p></div></div>\"\n        },\n        {\n          type: \"warning\",\n          template:\n            '<div class=\"dcpNotification--content dcpNotification--warning\">' +\n            '<span class=\"dcpNotification--symbol fa-stack fa-lg\"><span class=\"fa fa-warning fa-inverse\"></span></span>' +\n            '<div class=\"dcpNotification--message\"><h1>#: title #</h1>' +\n            \"<p>#: message #</p><p> #= htmlMessage #</p></div></div>\"\n        },\n        {\n          type: \"info\",\n          template:\n            '<div class=\"dcpNotification--content dcpNotification--info\">' +\n            '<span class=\"dcpNotification--symbol fa-stack fa-lg\"><span class=\"fa fa-info fa-inverse fa-flip-horizontal\"></span></span>' +\n            '<div class=\"dcpNotification--message\"><h1>#: title #</h1>' +\n            \"<p>#: message #</p><p> #= htmlMessage #</p></div></div>\"\n        },\n        {\n          type: \"notice\",\n          template:\n            '<div class=\"dcpNotification--content dcpNotification--notice\">' +\n            '<span class=\"dcpNotification--symbol fa-stack fa-lg\"><span class=\"fa fa-info fa-inverse fa-flip-horizontal\"></span></span>' +\n            '<div class=\"dcpNotification--message\"><h1>#: title #</h1>' +\n            \"<p>#: message #</p><p> #= htmlMessage #</p></div></div>\"\n        },\n        {\n          type: \"success\",\n          template:\n            '<div class=\"dcpNotification--content dcpNotification--info\">' +\n            '<span class=\"dcpNotification--symbol fa-stack fa-lg\"><span class=\"fa fa-check fa-inverse\"></span></span>' +\n            '<div class=\"dcpNotification--message\"><h1>#: title #</h1>' +\n            \"<p>#: message #</p><p> #= htmlMessage #</p></div></div>\"\n        }\n      ],\n\n      labels: {\n        moreButton: \"View more ...\",\n        moreWindowTitle: \"Notification\"\n      }\n    },\n    notificationElement: null,\n\n    _create: function wNotificationCreate() {\n      var scope = this;\n      this.notificationElement = $('<div class=\"dcpNotification--widget\" />');\n\n      this.element.append(\n        $('<div id=\"dcpNotificationContainer\" class=\"dcpNotifications\"/>')\n      );\n      this.element.append(this.notificationElement);\n\n      this.options.show = _.bind(this.showMore, this);\n      this.notificationElement.kendoNotification(this.options);\n\n      this.element.on(\"notification\", function wNotificationOn(event, data) {\n        scope.show(data.type, data);\n      });\n    },\n\n    showMore: function wNotificationShowMessage(event) {\n      var $boxMessage = event.element;\n      var $message = $boxMessage.find(\".dcpNotification--message\");\n      var $more;\n      var widgetNotification = this;\n\n      if ($message.prop(\"scrollHeight\") > $message.height()) {\n        $more = $('<div class=\"dcpNotification--more\"/>').text(\n          this.options.labels.moreButton\n        );\n        $boxMessage.append($more);\n        $more.on(\"click\", function wNotificationClickMode(event) {\n          var $clone = $boxMessage.clone();\n          var cloneWindow;\n\n          if (widgetNotification.cloneWindow) {\n            widgetNotification.cloneWindow.destroy();\n            widgetNotification.cloneWindow = null;\n          }\n          $boxMessage.append($clone);\n          $clone.find(\".dcpNotification--more\").remove();\n          $clone\n            .find(\".dcpNotification--message\")\n            .prepend($clone.find(\".dcpNotification--symbol\"));\n          event.stopPropagation();\n          cloneWindow = $clone\n            .kendoWindow({\n              title: widgetNotification.options.labels.moreWindowTitle,\n              width: \"400px\"\n            })\n            .data(\"kendoWindow\");\n          cloneWindow.center();\n          widgetNotification.cloneWindow = cloneWindow;\n        });\n      }\n    },\n\n    show: function wNotificationShow(type, options) {\n      options.title = options.title || \"\";\n      options.message = options.message || \"\";\n      options.htmlMessage = options.htmlMessage || \"\";\n      if (\n        $.inArray(type, [\"error\", \"info\", \"warning\", \"success\", \"notice\"]) ===\n        -1\n      ) {\n        type = \"info\";\n      }\n      this.notificationElement.data(\"kendoNotification\").show(\n        {\n          title: options.title,\n          message: options.message,\n          htmlMessage: options.htmlMessage // @TODO NEED TO CLEAN HTML TO PREVENT XSS\n        },\n        type\n      );\n\n      if (type === \"error\" && console.error) {\n        console.error(options.title, options.message, options.htmlMessage);\n      }\n    },\n\n    showError: function wNotificationShowError(options) {\n      this.show(\"error\", options);\n    },\n\n    showInfo: function wNotificationShowInfo(options) {\n      this.show(\"info\", options);\n    },\n\n    showWarning: function wNotificationShowWarning(options) {\n      this.show(\"warning\", options);\n    },\n\n    showSuccess: function wNotificationShowSuccess(options) {\n      this.show(\"success\", options);\n    },\n\n    clear: function wNotificationClear() {\n      this.notificationElement.kendoNotification(\"hide\");\n      if (this.cloneWindow) {\n        this.cloneWindow.destroy();\n        this.cloneWindow = null;\n      }\n    }\n  });\n}).apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNzdkN2ZmOTUwOTYxMmQwZTIzOWUuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvQXBwcy9ET0NVTUVOVC9JSE0vd2lkZ2V0cy93aW5kb3cvd05vdGlmaWNhdGlvbi5qcz8xMzMwIl0sInNvdXJjZXNDb250ZW50IjpbImRlZmluZShbXG4gIFwianF1ZXJ5XCIsXG4gIFwidW5kZXJzY29yZVwiLFxuICBcImRjcERvY3VtZW50L3dpZGdldHMvd2lkZ2V0XCJcbl0sIGZ1bmN0aW9uIHdOb3RpZmljYXRpb24oJCwgXykge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICAkLndpZGdldChcImRjcC5kY3BOb3RpZmljYXRpb25cIiwge1xuICAgIG9wdGlvbnM6IHtcbiAgICAgIC8vIGFuaW1hdGlvbjpmYWxzZSxcbiAgICAgIGF1dG9IaWRlQWZ0ZXI6IDUwMDAsXG4gICAgICBhcHBlbmRUbzogXCIjZGNwTm90aWZpY2F0aW9uQ29udGFpbmVyXCIsXG4gICAgICBwb3NpdGlvbjoge1xuICAgICAgICB0b3A6IDYwLCAvLyBvdmVycmlkZSBieSBub3RpZmljYXRpb24ubGVzc1xuICAgICAgICByaWdodDogMTAwXG4gICAgICB9LFxuICAgICAgdGVtcGxhdGVzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICB0eXBlOiBcImVycm9yXCIsXG4gICAgICAgICAgdGVtcGxhdGU6XG4gICAgICAgICAgICAnPGRpdiBjbGFzcz1cImRjcE5vdGlmaWNhdGlvbi0tY29udGVudCBkY3BOb3RpZmljYXRpb24tLWVycm9yXCI+JyArXG4gICAgICAgICAgICAnPHNwYW4gY2xhc3M9XCJkY3BOb3RpZmljYXRpb24tLXN5bWJvbCBmYS1zdGFjayBmYS1sZ1wiPjxzcGFuIGNsYXNzPVwiZmEgZmEtYm9sdFwiPjwvc3Bhbj48L3NwYW4+JyArXG4gICAgICAgICAgICAnPGRpdiBjbGFzcz1cImRjcE5vdGlmaWNhdGlvbi0tbWVzc2FnZVwiPjxoMT4jOiB0aXRsZSAjPC9oMT4nICtcbiAgICAgICAgICAgIFwiPHA+IzogbWVzc2FnZSAjPC9wPjxwPiAjPSBodG1sTWVzc2FnZSAjPC9wPjwvZGl2PjwvZGl2PlwiXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICB0eXBlOiBcIndhcm5pbmdcIixcbiAgICAgICAgICB0ZW1wbGF0ZTpcbiAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwiZGNwTm90aWZpY2F0aW9uLS1jb250ZW50IGRjcE5vdGlmaWNhdGlvbi0td2FybmluZ1wiPicgK1xuICAgICAgICAgICAgJzxzcGFuIGNsYXNzPVwiZGNwTm90aWZpY2F0aW9uLS1zeW1ib2wgZmEtc3RhY2sgZmEtbGdcIj48c3BhbiBjbGFzcz1cImZhIGZhLXdhcm5pbmcgZmEtaW52ZXJzZVwiPjwvc3Bhbj48L3NwYW4+JyArXG4gICAgICAgICAgICAnPGRpdiBjbGFzcz1cImRjcE5vdGlmaWNhdGlvbi0tbWVzc2FnZVwiPjxoMT4jOiB0aXRsZSAjPC9oMT4nICtcbiAgICAgICAgICAgIFwiPHA+IzogbWVzc2FnZSAjPC9wPjxwPiAjPSBodG1sTWVzc2FnZSAjPC9wPjwvZGl2PjwvZGl2PlwiXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICB0eXBlOiBcImluZm9cIixcbiAgICAgICAgICB0ZW1wbGF0ZTpcbiAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwiZGNwTm90aWZpY2F0aW9uLS1jb250ZW50IGRjcE5vdGlmaWNhdGlvbi0taW5mb1wiPicgK1xuICAgICAgICAgICAgJzxzcGFuIGNsYXNzPVwiZGNwTm90aWZpY2F0aW9uLS1zeW1ib2wgZmEtc3RhY2sgZmEtbGdcIj48c3BhbiBjbGFzcz1cImZhIGZhLWluZm8gZmEtaW52ZXJzZSBmYS1mbGlwLWhvcml6b250YWxcIj48L3NwYW4+PC9zcGFuPicgK1xuICAgICAgICAgICAgJzxkaXYgY2xhc3M9XCJkY3BOb3RpZmljYXRpb24tLW1lc3NhZ2VcIj48aDE+IzogdGl0bGUgIzwvaDE+JyArXG4gICAgICAgICAgICBcIjxwPiM6IG1lc3NhZ2UgIzwvcD48cD4gIz0gaHRtbE1lc3NhZ2UgIzwvcD48L2Rpdj48L2Rpdj5cIlxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgdHlwZTogXCJub3RpY2VcIixcbiAgICAgICAgICB0ZW1wbGF0ZTpcbiAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwiZGNwTm90aWZpY2F0aW9uLS1jb250ZW50IGRjcE5vdGlmaWNhdGlvbi0tbm90aWNlXCI+JyArXG4gICAgICAgICAgICAnPHNwYW4gY2xhc3M9XCJkY3BOb3RpZmljYXRpb24tLXN5bWJvbCBmYS1zdGFjayBmYS1sZ1wiPjxzcGFuIGNsYXNzPVwiZmEgZmEtaW5mbyBmYS1pbnZlcnNlIGZhLWZsaXAtaG9yaXpvbnRhbFwiPjwvc3Bhbj48L3NwYW4+JyArXG4gICAgICAgICAgICAnPGRpdiBjbGFzcz1cImRjcE5vdGlmaWNhdGlvbi0tbWVzc2FnZVwiPjxoMT4jOiB0aXRsZSAjPC9oMT4nICtcbiAgICAgICAgICAgIFwiPHA+IzogbWVzc2FnZSAjPC9wPjxwPiAjPSBodG1sTWVzc2FnZSAjPC9wPjwvZGl2PjwvZGl2PlwiXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICB0eXBlOiBcInN1Y2Nlc3NcIixcbiAgICAgICAgICB0ZW1wbGF0ZTpcbiAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwiZGNwTm90aWZpY2F0aW9uLS1jb250ZW50IGRjcE5vdGlmaWNhdGlvbi0taW5mb1wiPicgK1xuICAgICAgICAgICAgJzxzcGFuIGNsYXNzPVwiZGNwTm90aWZpY2F0aW9uLS1zeW1ib2wgZmEtc3RhY2sgZmEtbGdcIj48c3BhbiBjbGFzcz1cImZhIGZhLWNoZWNrIGZhLWludmVyc2VcIj48L3NwYW4+PC9zcGFuPicgK1xuICAgICAgICAgICAgJzxkaXYgY2xhc3M9XCJkY3BOb3RpZmljYXRpb24tLW1lc3NhZ2VcIj48aDE+IzogdGl0bGUgIzwvaDE+JyArXG4gICAgICAgICAgICBcIjxwPiM6IG1lc3NhZ2UgIzwvcD48cD4gIz0gaHRtbE1lc3NhZ2UgIzwvcD48L2Rpdj48L2Rpdj5cIlxuICAgICAgICB9XG4gICAgICBdLFxuXG4gICAgICBsYWJlbHM6IHtcbiAgICAgICAgbW9yZUJ1dHRvbjogXCJWaWV3IG1vcmUgLi4uXCIsXG4gICAgICAgIG1vcmVXaW5kb3dUaXRsZTogXCJOb3RpZmljYXRpb25cIlxuICAgICAgfVxuICAgIH0sXG4gICAgbm90aWZpY2F0aW9uRWxlbWVudDogbnVsbCxcblxuICAgIF9jcmVhdGU6IGZ1bmN0aW9uIHdOb3RpZmljYXRpb25DcmVhdGUoKSB7XG4gICAgICB2YXIgc2NvcGUgPSB0aGlzO1xuICAgICAgdGhpcy5ub3RpZmljYXRpb25FbGVtZW50ID0gJCgnPGRpdiBjbGFzcz1cImRjcE5vdGlmaWNhdGlvbi0td2lkZ2V0XCIgLz4nKTtcblxuICAgICAgdGhpcy5lbGVtZW50LmFwcGVuZChcbiAgICAgICAgJCgnPGRpdiBpZD1cImRjcE5vdGlmaWNhdGlvbkNvbnRhaW5lclwiIGNsYXNzPVwiZGNwTm90aWZpY2F0aW9uc1wiLz4nKVxuICAgICAgKTtcbiAgICAgIHRoaXMuZWxlbWVudC5hcHBlbmQodGhpcy5ub3RpZmljYXRpb25FbGVtZW50KTtcblxuICAgICAgdGhpcy5vcHRpb25zLnNob3cgPSBfLmJpbmQodGhpcy5zaG93TW9yZSwgdGhpcyk7XG4gICAgICB0aGlzLm5vdGlmaWNhdGlvbkVsZW1lbnQua2VuZG9Ob3RpZmljYXRpb24odGhpcy5vcHRpb25zKTtcblxuICAgICAgdGhpcy5lbGVtZW50Lm9uKFwibm90aWZpY2F0aW9uXCIsIGZ1bmN0aW9uIHdOb3RpZmljYXRpb25PbihldmVudCwgZGF0YSkge1xuICAgICAgICBzY29wZS5zaG93KGRhdGEudHlwZSwgZGF0YSk7XG4gICAgICB9KTtcbiAgICB9LFxuXG4gICAgc2hvd01vcmU6IGZ1bmN0aW9uIHdOb3RpZmljYXRpb25TaG93TWVzc2FnZShldmVudCkge1xuICAgICAgdmFyICRib3hNZXNzYWdlID0gZXZlbnQuZWxlbWVudDtcbiAgICAgIHZhciAkbWVzc2FnZSA9ICRib3hNZXNzYWdlLmZpbmQoXCIuZGNwTm90aWZpY2F0aW9uLS1tZXNzYWdlXCIpO1xuICAgICAgdmFyICRtb3JlO1xuICAgICAgdmFyIHdpZGdldE5vdGlmaWNhdGlvbiA9IHRoaXM7XG5cbiAgICAgIGlmICgkbWVzc2FnZS5wcm9wKFwic2Nyb2xsSGVpZ2h0XCIpID4gJG1lc3NhZ2UuaGVpZ2h0KCkpIHtcbiAgICAgICAgJG1vcmUgPSAkKCc8ZGl2IGNsYXNzPVwiZGNwTm90aWZpY2F0aW9uLS1tb3JlXCIvPicpLnRleHQoXG4gICAgICAgICAgdGhpcy5vcHRpb25zLmxhYmVscy5tb3JlQnV0dG9uXG4gICAgICAgICk7XG4gICAgICAgICRib3hNZXNzYWdlLmFwcGVuZCgkbW9yZSk7XG4gICAgICAgICRtb3JlLm9uKFwiY2xpY2tcIiwgZnVuY3Rpb24gd05vdGlmaWNhdGlvbkNsaWNrTW9kZShldmVudCkge1xuICAgICAgICAgIHZhciAkY2xvbmUgPSAkYm94TWVzc2FnZS5jbG9uZSgpO1xuICAgICAgICAgIHZhciBjbG9uZVdpbmRvdztcblxuICAgICAgICAgIGlmICh3aWRnZXROb3RpZmljYXRpb24uY2xvbmVXaW5kb3cpIHtcbiAgICAgICAgICAgIHdpZGdldE5vdGlmaWNhdGlvbi5jbG9uZVdpbmRvdy5kZXN0cm95KCk7XG4gICAgICAgICAgICB3aWRnZXROb3RpZmljYXRpb24uY2xvbmVXaW5kb3cgPSBudWxsO1xuICAgICAgICAgIH1cbiAgICAgICAgICAkYm94TWVzc2FnZS5hcHBlbmQoJGNsb25lKTtcbiAgICAgICAgICAkY2xvbmUuZmluZChcIi5kY3BOb3RpZmljYXRpb24tLW1vcmVcIikucmVtb3ZlKCk7XG4gICAgICAgICAgJGNsb25lXG4gICAgICAgICAgICAuZmluZChcIi5kY3BOb3RpZmljYXRpb24tLW1lc3NhZ2VcIilcbiAgICAgICAgICAgIC5wcmVwZW5kKCRjbG9uZS5maW5kKFwiLmRjcE5vdGlmaWNhdGlvbi0tc3ltYm9sXCIpKTtcbiAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICBjbG9uZVdpbmRvdyA9ICRjbG9uZVxuICAgICAgICAgICAgLmtlbmRvV2luZG93KHtcbiAgICAgICAgICAgICAgdGl0bGU6IHdpZGdldE5vdGlmaWNhdGlvbi5vcHRpb25zLmxhYmVscy5tb3JlV2luZG93VGl0bGUsXG4gICAgICAgICAgICAgIHdpZHRoOiBcIjQwMHB4XCJcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuZGF0YShcImtlbmRvV2luZG93XCIpO1xuICAgICAgICAgIGNsb25lV2luZG93LmNlbnRlcigpO1xuICAgICAgICAgIHdpZGdldE5vdGlmaWNhdGlvbi5jbG9uZVdpbmRvdyA9IGNsb25lV2luZG93O1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgc2hvdzogZnVuY3Rpb24gd05vdGlmaWNhdGlvblNob3codHlwZSwgb3B0aW9ucykge1xuICAgICAgb3B0aW9ucy50aXRsZSA9IG9wdGlvbnMudGl0bGUgfHwgXCJcIjtcbiAgICAgIG9wdGlvbnMubWVzc2FnZSA9IG9wdGlvbnMubWVzc2FnZSB8fCBcIlwiO1xuICAgICAgb3B0aW9ucy5odG1sTWVzc2FnZSA9IG9wdGlvbnMuaHRtbE1lc3NhZ2UgfHwgXCJcIjtcbiAgICAgIGlmIChcbiAgICAgICAgJC5pbkFycmF5KHR5cGUsIFtcImVycm9yXCIsIFwiaW5mb1wiLCBcIndhcm5pbmdcIiwgXCJzdWNjZXNzXCIsIFwibm90aWNlXCJdKSA9PT1cbiAgICAgICAgLTFcbiAgICAgICkge1xuICAgICAgICB0eXBlID0gXCJpbmZvXCI7XG4gICAgICB9XG4gICAgICB0aGlzLm5vdGlmaWNhdGlvbkVsZW1lbnQuZGF0YShcImtlbmRvTm90aWZpY2F0aW9uXCIpLnNob3coXG4gICAgICAgIHtcbiAgICAgICAgICB0aXRsZTogb3B0aW9ucy50aXRsZSxcbiAgICAgICAgICBtZXNzYWdlOiBvcHRpb25zLm1lc3NhZ2UsXG4gICAgICAgICAgaHRtbE1lc3NhZ2U6IG9wdGlvbnMuaHRtbE1lc3NhZ2UgLy8gQFRPRE8gTkVFRCBUTyBDTEVBTiBIVE1MIFRPIFBSRVZFTlQgWFNTXG4gICAgICAgIH0sXG4gICAgICAgIHR5cGVcbiAgICAgICk7XG5cbiAgICAgIGlmICh0eXBlID09PSBcImVycm9yXCIgJiYgY29uc29sZS5lcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKG9wdGlvbnMudGl0bGUsIG9wdGlvbnMubWVzc2FnZSwgb3B0aW9ucy5odG1sTWVzc2FnZSk7XG4gICAgICB9XG4gICAgfSxcblxuICAgIHNob3dFcnJvcjogZnVuY3Rpb24gd05vdGlmaWNhdGlvblNob3dFcnJvcihvcHRpb25zKSB7XG4gICAgICB0aGlzLnNob3coXCJlcnJvclwiLCBvcHRpb25zKTtcbiAgICB9LFxuXG4gICAgc2hvd0luZm86IGZ1bmN0aW9uIHdOb3RpZmljYXRpb25TaG93SW5mbyhvcHRpb25zKSB7XG4gICAgICB0aGlzLnNob3coXCJpbmZvXCIsIG9wdGlvbnMpO1xuICAgIH0sXG5cbiAgICBzaG93V2FybmluZzogZnVuY3Rpb24gd05vdGlmaWNhdGlvblNob3dXYXJuaW5nKG9wdGlvbnMpIHtcbiAgICAgIHRoaXMuc2hvdyhcIndhcm5pbmdcIiwgb3B0aW9ucyk7XG4gICAgfSxcblxuICAgIHNob3dTdWNjZXNzOiBmdW5jdGlvbiB3Tm90aWZpY2F0aW9uU2hvd1N1Y2Nlc3Mob3B0aW9ucykge1xuICAgICAgdGhpcy5zaG93KFwic3VjY2Vzc1wiLCBvcHRpb25zKTtcbiAgICB9LFxuXG4gICAgY2xlYXI6IGZ1bmN0aW9uIHdOb3RpZmljYXRpb25DbGVhcigpIHtcbiAgICAgIHRoaXMubm90aWZpY2F0aW9uRWxlbWVudC5rZW5kb05vdGlmaWNhdGlvbihcImhpZGVcIik7XG4gICAgICBpZiAodGhpcy5jbG9uZVdpbmRvdykge1xuICAgICAgICB0aGlzLmNsb25lV2luZG93LmRlc3Ryb3koKTtcbiAgICAgICAgdGhpcy5jbG9uZVdpbmRvdyA9IG51bGw7XG4gICAgICB9XG4gICAgfVxuICB9KTtcbn0pO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///77d7ff9509612d0e239e\n");

/***/ }),

/***/ "7a4c946b6dd0337fa34b":
/*!****************************************************************!*\
  !*** ./src/Apps/DOCUMENT/IHM/views/attributes/frame/vFrame.js ***!
  \****************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/*global define, console*/\n!(__WEBPACK_AMD_DEFINE_ARRAY__ = [\n  __webpack_require__(/*! jquery */ \"127c8cf59f228bb01a21\"),\n  __webpack_require__(/*! underscore */ \"8e08e542008e4aef1f58\"),\n  __webpack_require__(/*! backbone */ \"1858b45bf48591489d06\"),\n  __webpack_require__(/*! mustache */ \"bcd31d01884fc294fd69\"),\n  __webpack_require__(/*! dcpDocument/views/attributes/vAttribute */ \"fde693488ffc947d1881\"),\n  __webpack_require__(/*! dcpDocument/views/attributes/array/vArray */ \"2396a71337586706882f\"),\n  __webpack_require__(/*! dcpDocument/views/document/attributeTemplate */ \"593c8c94ba4399020f79\")\n], __WEBPACK_AMD_DEFINE_RESULT__ = (function require_vFrame(\n  $,\n  _,\n  Backbone,\n  Mustache,\n  ViewAttribute,\n  ViewAttributeArray,\n  attributeTemplate\n) {\n  \"use strict\";\n\n  return Backbone.View.extend({\n    className: \"card card-default dcpFrame\",\n    customView: false,\n    displayLabel: true,\n\n    events: {\n      \"click .dcpFrame--collapsable\": \"toggle\",\n      'click a[href^=\"#action/\"], a[data-action], button[data-action]':\n        \"externalLinkSelected\"\n    },\n\n    initialize: function vFrame_initialize(options) {\n      if (\n        options.displayLabel === false ||\n        this.model.getOption(\"labelPosition\") === \"none\"\n      ) {\n        this.displayLabel = false;\n      }\n      this.listenTo(this.model, \"change:label\", this.updateLabel);\n      this.listenTo(this.model.get(\"content\"), \"add\", this.render);\n      this.listenTo(this.model.get(\"content\"), \"remove\", this.render);\n      this.listenTo(this.model.get(\"content\"), \"reset\", this.render);\n      this.listenTo(this.model, \"errorMessage\", this.setError);\n      this.listenTo(this.model, \"change:errorMessage\", this.setError);\n      this.listenTo(this.model, \"destroy\", this.remove);\n      this.listenTo(this.model, \"resize\", this.setResponsiveClasse);\n      this.listenTo(this.model, \"cleanView\", this.remove);\n      this.listenTo(this.model, \"hide\", this.hide);\n      this.listenTo(this.model, \"show\", this.show);\n      this.listenTo(this.model, \"haveView\", this._identifyView);\n\n      this.options = options;\n    },\n\n    render: function vFrame_render() {\n      var currentView = this;\n      return new Promise(\n        _.bind(function vFrame_renderPromise(resolve, reject) {\n          var customRender,\n            $content,\n            labelElement,\n            contentElement = \"\",\n            customView = null,\n            event = { prevent: false },\n            contentData,\n            promiseAttributes = [];\n\n          currentView.model.trigger(\"beforeRender\", event, {\n            model: currentView.model,\n            $el: currentView.$el\n          });\n          if (event.prevent) {\n            resolve(currentView);\n            return currentView;\n          }\n\n          if (currentView.options.originalView !== true) {\n            if (currentView.model.getOption(\"template\")) {\n              customRender = attributeTemplate.renderCustomView(\n                currentView.model\n              );\n              currentView.customView = customRender.$el;\n              promiseAttributes.push(customRender.promise);\n            }\n          }\n\n          contentData = currentView.model.toData(null, true);\n          if (currentView.model.getOption(\"attributeLabel\")) {\n            contentData.label = currentView.model.getOption(\"attributeLabel\");\n          }\n          contentData.collapsable =\n            contentData.renderOptions.collapse !== \"none\";\n\n          currentView.templateLabel = currentView.model.getTemplates().attribute.frame.label;\n          labelElement = $(\n            Mustache.render(currentView.templateLabel || \"\", contentData)\n          );\n\n          if (currentView.customView) {\n            contentElement = currentView.customView;\n            contentElement.addClass(\n              \"dcpFrame__content dcpFrame__content--open\"\n            );\n          } else {\n            currentView.templateContent = currentView.model.getTemplates().attribute.frame.content;\n            contentElement = $(\n              Mustache.render(currentView.templateContent || \"\", contentData)\n            );\n          }\n          currentView.$el.empty();\n          if (currentView.displayLabel === true) {\n            currentView.$el.append(labelElement);\n          }\n          currentView.$el.append(contentElement);\n          currentView.$el.attr(\"data-attrid\", currentView.model.id);\n\n          $content = currentView.$el.find(\".dcpFrame__content\");\n          var hasOneContent = currentView.model\n            .get(\"content\")\n            .some(function vFrame_getDisplayable(value) {\n              return value.isDisplayable();\n            });\n\n          if (!currentView.customView) {\n            if (!hasOneContent) {\n              $content.append(currentView.model.getOption(\"showEmptyContent\"));\n            } else {\n              currentView.model\n                .get(\"content\")\n                .each(function vFrame_AnalyzeContent(currentAttr) {\n                  var attributeView;\n                  if (!currentAttr.isDisplayable()) {\n                    return;\n                  }\n                  try {\n                    customView = null;\n                    if (currentAttr.get(\"isValueAttribute\")) {\n                      attributeView = new ViewAttribute({\n                        model: currentAttr,\n                        customView: customView\n                      });\n                      promiseAttributes.push(attributeView.render());\n                      $content.append(attributeView.$el);\n                      return;\n                    }\n                    if (currentAttr.get(\"type\") === \"array\") {\n                      attributeView = new ViewAttributeArray({\n                        model: currentAttr\n                      });\n                      promiseAttributes.push(attributeView.render());\n                      $content.append(attributeView.$el);\n                    }\n                  } catch (e) {\n                    $content.append(\n                      '<h1 class=\"bg-danger\"><span class=\"glyphicon glyphicon-warning-sign\" aria-hidden=\"true\"></span>Unable to render ' +\n                        currentAttr.id +\n                        \"</h1>\"\n                    );\n                    if (window.dcp.logger) {\n                      window.dcp.logger(e);\n                    } else {\n                      console.error(e);\n                    }\n                  }\n                });\n            }\n\n            attributeTemplate.insertDescription(currentView);\n          }\n\n          if (currentView.model.getOption(\"collapse\") === \"collapse\") {\n            currentView.toggle(null, true);\n          }\n          Promise.all(promiseAttributes)\n            .then(function allRenderDone() {\n              currentView.model.trigger(\"renderDone\", {\n                model: currentView.model,\n                $el: currentView.$el\n              });\n              if (currentView.model.getOption(\"responsiveColumns\")) {\n                currentView.responsiveColumns();\n              }\n              resolve(currentView);\n            })\n            .catch(reject);\n        }),\n        this\n      );\n    },\n\n    setResponsiveClasse: function vFrame_setResponsiveClasse() {\n      var _this = this;\n      var fWidth = 0;\n      var matchesResponsive = 0;\n      var responseColumnsDefs = this.model.getOption(\"responsiveColumns\") || [];\n      var isTopBottom = false;\n      var isGrow = false;\n\n      if (responseColumnsDefs.length > 0) {\n        fWidth = $(this.$el).width();\n\n        if (fWidth <= 0) {\n          return;\n        }\n        var $vattrs = this.$el.find(\"> .dcpFrame__content > .row\");\n\n        _.each(responseColumnsDefs, function vFrame_setResponsiveClasses(\n          responseColumnsInfo\n        ) {\n          if (\n            fWidth >= responseColumnsInfo.minAbsWidth &&\n            fWidth < responseColumnsInfo.maxAbsWidth\n          ) {\n            matchesResponsive = responseColumnsInfo.number;\n            if (responseColumnsInfo.grow === true) {\n              _this.$el.addClass(\"dcp-column--grow\");\n              isGrow = true;\n            } else {\n              _this.$el.removeClass(\"dcp-column--grow\");\n              isGrow = false;\n            }\n            isTopBottom = responseColumnsInfo.direction === \"topBottom\";\n\n            if (isGrow) {\n              if ($vattrs.length < matchesResponsive) {\n                matchesResponsive = $vattrs.length;\n              } else if (isTopBottom) {\n                var rowNumber = Math.ceil($vattrs.length / matchesResponsive);\n                for (var i = matchesResponsive; i--; i > 1) {\n                  if (Math.ceil($vattrs.length / i) === rowNumber) {\n                    // Decrease column number if not enough data to avoid empty columns\n                    matchesResponsive = i;\n                  }\n                }\n              }\n            }\n\n            if (matchesResponsive > 1) {\n              _this.$el.addClass(\"dcp-column--\" + matchesResponsive);\n            }\n          } else {\n            _this.$el.removeClass(\"dcp-column--\" + responseColumnsInfo.number);\n          }\n        });\n\n        if (matchesResponsive > 1) {\n          _this.$el.addClass(\"dcp-column\");\n          if (matchesResponsive !== this.frameColumnNumber) {\n            this.frameColumnNumber = matchesResponsive;\n\n            if (isTopBottom) {\n              this.$el.addClass(\"dcp-column--topbottom\");\n              this.$el.removeClass(\"dcp-column--leftright\");\n            } else {\n              this.$el.removeClass(\"dcp-column--topbottom\");\n              this.$el.addClass(\"dcp-column--leftright\");\n            }\n          }\n        } else {\n          this.frameColumnNumber = matchesResponsive;\n          this.$el.removeClass(\"dcp-column\");\n          this.$el.removeClass(\"dcp-column--topbottom\");\n          this.$el.removeClass(\"dcp-column--leftright\");\n          this.$el.removeClass(\"dcp-column--grow\");\n        }\n      }\n    },\n\n    responsiveColumns: function vFrame_responsiveColumns() {\n      var responseColumnsDefs = this.model.getOption(\"responsiveColumns\") || [];\n      var $fake = $(\"<div/>\").css({\n        position: \"absolute\",\n        top: 0,\n        overflow: \"hidden\"\n      });\n      var $fakeWidth = $(\"<div/>\");\n\n      $(\"body\").append($fake.append($fakeWidth));\n\n      // Compute absolute width\n      _.each(responseColumnsDefs, function vFrame_computeResponsiveWidth(\n        responseColumnsInfo\n      ) {\n        if (!responseColumnsInfo.minWidth) {\n          responseColumnsInfo.minAbsWidth = 0;\n        } else {\n          $fakeWidth.width(responseColumnsInfo.minWidth);\n          responseColumnsInfo.minAbsWidth = $fakeWidth.width();\n        }\n\n        if (!responseColumnsInfo.maxWidth) {\n          responseColumnsInfo.maxAbsWidth = Infinity;\n        } else {\n          $fakeWidth.width(responseColumnsInfo.maxWidth);\n          responseColumnsInfo.maxAbsWidth = $fakeWidth.width();\n        }\n      });\n\n      $fake.remove();\n      $(window).on(\n        \"resize.v\" + this.model.cid,\n        _.bind(this.setResponsiveClasse, this)\n      );\n      _.defer(_.bind(this.setResponsiveClasse, this));\n    },\n\n    getAttributeModel: function vFrame_getAttributeModel(attributeId) {\n      var docModel = this.model.getDocumentModel();\n      return docModel.get(\"attributes\").get(attributeId);\n    },\n\n    setError: function vFrame_setError(event, data) {\n      if (data) {\n        this.$el.find(\".dcpFrame__label\").addClass(\"has-error\");\n      } else {\n        this.$el.find(\".dcpFrame__label\").removeClass(\"has-error\");\n      }\n    },\n\n    updateLabel: function vFrame_updateLabel() {\n      this.$el.find(\".dcpFrame__label\").text(this.model.get(\"label\"));\n    },\n\n    toggle: function vFrame_toggle(event, hideNow) {\n      var $contentElement = this.$(\".dcpFrame__content\");\n      this.$(\".dcp__frame__caret\").toggleClass(\"fa-caret-right fa-caret-down\");\n      $contentElement.toggleClass(\n        \"dcpFrame__content--open dcpFrame__content--close\"\n      );\n      if (hideNow) {\n        $contentElement.hide();\n      } else {\n        $contentElement.slideToggle(200);\n        if ($contentElement.hasClass(\"dcpFrame__content--open\")) {\n          this.model.getDocumentModel().trigger(\"redrawErrorMessages\");\n        }\n      }\n    },\n\n    hide: function vFrame_hide() {\n      this.$el.hide();\n    },\n\n    show: function vFrame_show() {\n      this.$el.show();\n    },\n\n    externalLinkSelected: function vAttributeExternalLinkSelected(event) {\n      var $target = $(event.currentTarget),\n        action,\n        options,\n        eventOptions,\n        documentModel,\n        internalEvent = {\n          prevent: false\n        };\n\n      event.preventDefault();\n      if (event.stopPropagation) {\n        event.stopPropagation();\n      }\n\n      action = $target.data(\"action\") || $target.attr(\"href\");\n      options = action.substring(8).split(\":\");\n      eventOptions = {\n        target: event.target,\n        index: -1,\n        eventId: options.shift(),\n        options: options\n      };\n      documentModel = this.model.getDocumentModel();\n\n      this.model.trigger(\"internalLinkSelected\", internalEvent, eventOptions);\n      if (event.prevent) {\n        return this;\n      }\n\n      documentModel.trigger(\"actionAttributeLink\", internalEvent, eventOptions);\n\n      return this;\n    },\n\n    _identifyView: function vFrame_identifyView(event) {\n      event.haveView = true;\n      //Add the pointer to the current jquery element to a list passed by the event\n      event.elements = event.elements.add(this.$el);\n    },\n\n    /**\n     * Destroy the associated widget and suppress event listener before remov the dom\n     *\n     * @returns {*}\n     */\n    remove: function vFrame_Remove() {\n      $(window).off(\".v\" + this.model.cid);\n\n      return Backbone.View.prototype.remove.call(this);\n    }\n  });\n}).apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiN2E0Yzk0NmI2ZGQwMzM3ZmEzNGIuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvQXBwcy9ET0NVTUVOVC9JSE0vdmlld3MvYXR0cmlidXRlcy9mcmFtZS92RnJhbWUuanM/YzdmYSJdLCJzb3VyY2VzQ29udGVudCI6WyIvKmdsb2JhbCBkZWZpbmUsIGNvbnNvbGUqL1xuZGVmaW5lKFtcbiAgXCJqcXVlcnlcIixcbiAgXCJ1bmRlcnNjb3JlXCIsXG4gIFwiYmFja2JvbmVcIixcbiAgXCJtdXN0YWNoZVwiLFxuICBcImRjcERvY3VtZW50L3ZpZXdzL2F0dHJpYnV0ZXMvdkF0dHJpYnV0ZVwiLFxuICBcImRjcERvY3VtZW50L3ZpZXdzL2F0dHJpYnV0ZXMvYXJyYXkvdkFycmF5XCIsXG4gIFwiZGNwRG9jdW1lbnQvdmlld3MvZG9jdW1lbnQvYXR0cmlidXRlVGVtcGxhdGVcIlxuXSwgZnVuY3Rpb24gcmVxdWlyZV92RnJhbWUoXG4gICQsXG4gIF8sXG4gIEJhY2tib25lLFxuICBNdXN0YWNoZSxcbiAgVmlld0F0dHJpYnV0ZSxcbiAgVmlld0F0dHJpYnV0ZUFycmF5LFxuICBhdHRyaWJ1dGVUZW1wbGF0ZVxuKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIHJldHVybiBCYWNrYm9uZS5WaWV3LmV4dGVuZCh7XG4gICAgY2xhc3NOYW1lOiBcImNhcmQgY2FyZC1kZWZhdWx0IGRjcEZyYW1lXCIsXG4gICAgY3VzdG9tVmlldzogZmFsc2UsXG4gICAgZGlzcGxheUxhYmVsOiB0cnVlLFxuXG4gICAgZXZlbnRzOiB7XG4gICAgICBcImNsaWNrIC5kY3BGcmFtZS0tY29sbGFwc2FibGVcIjogXCJ0b2dnbGVcIixcbiAgICAgICdjbGljayBhW2hyZWZePVwiI2FjdGlvbi9cIl0sIGFbZGF0YS1hY3Rpb25dLCBidXR0b25bZGF0YS1hY3Rpb25dJzpcbiAgICAgICAgXCJleHRlcm5hbExpbmtTZWxlY3RlZFwiXG4gICAgfSxcblxuICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uIHZGcmFtZV9pbml0aWFsaXplKG9wdGlvbnMpIHtcbiAgICAgIGlmIChcbiAgICAgICAgb3B0aW9ucy5kaXNwbGF5TGFiZWwgPT09IGZhbHNlIHx8XG4gICAgICAgIHRoaXMubW9kZWwuZ2V0T3B0aW9uKFwibGFiZWxQb3NpdGlvblwiKSA9PT0gXCJub25lXCJcbiAgICAgICkge1xuICAgICAgICB0aGlzLmRpc3BsYXlMYWJlbCA9IGZhbHNlO1xuICAgICAgfVxuICAgICAgdGhpcy5saXN0ZW5Ubyh0aGlzLm1vZGVsLCBcImNoYW5nZTpsYWJlbFwiLCB0aGlzLnVwZGF0ZUxhYmVsKTtcbiAgICAgIHRoaXMubGlzdGVuVG8odGhpcy5tb2RlbC5nZXQoXCJjb250ZW50XCIpLCBcImFkZFwiLCB0aGlzLnJlbmRlcik7XG4gICAgICB0aGlzLmxpc3RlblRvKHRoaXMubW9kZWwuZ2V0KFwiY29udGVudFwiKSwgXCJyZW1vdmVcIiwgdGhpcy5yZW5kZXIpO1xuICAgICAgdGhpcy5saXN0ZW5Ubyh0aGlzLm1vZGVsLmdldChcImNvbnRlbnRcIiksIFwicmVzZXRcIiwgdGhpcy5yZW5kZXIpO1xuICAgICAgdGhpcy5saXN0ZW5Ubyh0aGlzLm1vZGVsLCBcImVycm9yTWVzc2FnZVwiLCB0aGlzLnNldEVycm9yKTtcbiAgICAgIHRoaXMubGlzdGVuVG8odGhpcy5tb2RlbCwgXCJjaGFuZ2U6ZXJyb3JNZXNzYWdlXCIsIHRoaXMuc2V0RXJyb3IpO1xuICAgICAgdGhpcy5saXN0ZW5Ubyh0aGlzLm1vZGVsLCBcImRlc3Ryb3lcIiwgdGhpcy5yZW1vdmUpO1xuICAgICAgdGhpcy5saXN0ZW5Ubyh0aGlzLm1vZGVsLCBcInJlc2l6ZVwiLCB0aGlzLnNldFJlc3BvbnNpdmVDbGFzc2UpO1xuICAgICAgdGhpcy5saXN0ZW5Ubyh0aGlzLm1vZGVsLCBcImNsZWFuVmlld1wiLCB0aGlzLnJlbW92ZSk7XG4gICAgICB0aGlzLmxpc3RlblRvKHRoaXMubW9kZWwsIFwiaGlkZVwiLCB0aGlzLmhpZGUpO1xuICAgICAgdGhpcy5saXN0ZW5Ubyh0aGlzLm1vZGVsLCBcInNob3dcIiwgdGhpcy5zaG93KTtcbiAgICAgIHRoaXMubGlzdGVuVG8odGhpcy5tb2RlbCwgXCJoYXZlVmlld1wiLCB0aGlzLl9pZGVudGlmeVZpZXcpO1xuXG4gICAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zO1xuICAgIH0sXG5cbiAgICByZW5kZXI6IGZ1bmN0aW9uIHZGcmFtZV9yZW5kZXIoKSB7XG4gICAgICB2YXIgY3VycmVudFZpZXcgPSB0aGlzO1xuICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKFxuICAgICAgICBfLmJpbmQoZnVuY3Rpb24gdkZyYW1lX3JlbmRlclByb21pc2UocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgICAgdmFyIGN1c3RvbVJlbmRlcixcbiAgICAgICAgICAgICRjb250ZW50LFxuICAgICAgICAgICAgbGFiZWxFbGVtZW50LFxuICAgICAgICAgICAgY29udGVudEVsZW1lbnQgPSBcIlwiLFxuICAgICAgICAgICAgY3VzdG9tVmlldyA9IG51bGwsXG4gICAgICAgICAgICBldmVudCA9IHsgcHJldmVudDogZmFsc2UgfSxcbiAgICAgICAgICAgIGNvbnRlbnREYXRhLFxuICAgICAgICAgICAgcHJvbWlzZUF0dHJpYnV0ZXMgPSBbXTtcblxuICAgICAgICAgIGN1cnJlbnRWaWV3Lm1vZGVsLnRyaWdnZXIoXCJiZWZvcmVSZW5kZXJcIiwgZXZlbnQsIHtcbiAgICAgICAgICAgIG1vZGVsOiBjdXJyZW50Vmlldy5tb2RlbCxcbiAgICAgICAgICAgICRlbDogY3VycmVudFZpZXcuJGVsXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgaWYgKGV2ZW50LnByZXZlbnQpIHtcbiAgICAgICAgICAgIHJlc29sdmUoY3VycmVudFZpZXcpO1xuICAgICAgICAgICAgcmV0dXJuIGN1cnJlbnRWaWV3O1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmIChjdXJyZW50Vmlldy5vcHRpb25zLm9yaWdpbmFsVmlldyAhPT0gdHJ1ZSkge1xuICAgICAgICAgICAgaWYgKGN1cnJlbnRWaWV3Lm1vZGVsLmdldE9wdGlvbihcInRlbXBsYXRlXCIpKSB7XG4gICAgICAgICAgICAgIGN1c3RvbVJlbmRlciA9IGF0dHJpYnV0ZVRlbXBsYXRlLnJlbmRlckN1c3RvbVZpZXcoXG4gICAgICAgICAgICAgICAgY3VycmVudFZpZXcubW9kZWxcbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgY3VycmVudFZpZXcuY3VzdG9tVmlldyA9IGN1c3RvbVJlbmRlci4kZWw7XG4gICAgICAgICAgICAgIHByb21pc2VBdHRyaWJ1dGVzLnB1c2goY3VzdG9tUmVuZGVyLnByb21pc2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cblxuICAgICAgICAgIGNvbnRlbnREYXRhID0gY3VycmVudFZpZXcubW9kZWwudG9EYXRhKG51bGwsIHRydWUpO1xuICAgICAgICAgIGlmIChjdXJyZW50Vmlldy5tb2RlbC5nZXRPcHRpb24oXCJhdHRyaWJ1dGVMYWJlbFwiKSkge1xuICAgICAgICAgICAgY29udGVudERhdGEubGFiZWwgPSBjdXJyZW50Vmlldy5tb2RlbC5nZXRPcHRpb24oXCJhdHRyaWJ1dGVMYWJlbFwiKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgY29udGVudERhdGEuY29sbGFwc2FibGUgPVxuICAgICAgICAgICAgY29udGVudERhdGEucmVuZGVyT3B0aW9ucy5jb2xsYXBzZSAhPT0gXCJub25lXCI7XG5cbiAgICAgICAgICBjdXJyZW50Vmlldy50ZW1wbGF0ZUxhYmVsID0gY3VycmVudFZpZXcubW9kZWwuZ2V0VGVtcGxhdGVzKCkuYXR0cmlidXRlLmZyYW1lLmxhYmVsO1xuICAgICAgICAgIGxhYmVsRWxlbWVudCA9ICQoXG4gICAgICAgICAgICBNdXN0YWNoZS5yZW5kZXIoY3VycmVudFZpZXcudGVtcGxhdGVMYWJlbCB8fCBcIlwiLCBjb250ZW50RGF0YSlcbiAgICAgICAgICApO1xuXG4gICAgICAgICAgaWYgKGN1cnJlbnRWaWV3LmN1c3RvbVZpZXcpIHtcbiAgICAgICAgICAgIGNvbnRlbnRFbGVtZW50ID0gY3VycmVudFZpZXcuY3VzdG9tVmlldztcbiAgICAgICAgICAgIGNvbnRlbnRFbGVtZW50LmFkZENsYXNzKFxuICAgICAgICAgICAgICBcImRjcEZyYW1lX19jb250ZW50IGRjcEZyYW1lX19jb250ZW50LS1vcGVuXCJcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGN1cnJlbnRWaWV3LnRlbXBsYXRlQ29udGVudCA9IGN1cnJlbnRWaWV3Lm1vZGVsLmdldFRlbXBsYXRlcygpLmF0dHJpYnV0ZS5mcmFtZS5jb250ZW50O1xuICAgICAgICAgICAgY29udGVudEVsZW1lbnQgPSAkKFxuICAgICAgICAgICAgICBNdXN0YWNoZS5yZW5kZXIoY3VycmVudFZpZXcudGVtcGxhdGVDb250ZW50IHx8IFwiXCIsIGNvbnRlbnREYXRhKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgY3VycmVudFZpZXcuJGVsLmVtcHR5KCk7XG4gICAgICAgICAgaWYgKGN1cnJlbnRWaWV3LmRpc3BsYXlMYWJlbCA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgY3VycmVudFZpZXcuJGVsLmFwcGVuZChsYWJlbEVsZW1lbnQpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjdXJyZW50Vmlldy4kZWwuYXBwZW5kKGNvbnRlbnRFbGVtZW50KTtcbiAgICAgICAgICBjdXJyZW50Vmlldy4kZWwuYXR0cihcImRhdGEtYXR0cmlkXCIsIGN1cnJlbnRWaWV3Lm1vZGVsLmlkKTtcblxuICAgICAgICAgICRjb250ZW50ID0gY3VycmVudFZpZXcuJGVsLmZpbmQoXCIuZGNwRnJhbWVfX2NvbnRlbnRcIik7XG4gICAgICAgICAgdmFyIGhhc09uZUNvbnRlbnQgPSBjdXJyZW50Vmlldy5tb2RlbFxuICAgICAgICAgICAgLmdldChcImNvbnRlbnRcIilcbiAgICAgICAgICAgIC5zb21lKGZ1bmN0aW9uIHZGcmFtZV9nZXREaXNwbGF5YWJsZSh2YWx1ZSkge1xuICAgICAgICAgICAgICByZXR1cm4gdmFsdWUuaXNEaXNwbGF5YWJsZSgpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICBpZiAoIWN1cnJlbnRWaWV3LmN1c3RvbVZpZXcpIHtcbiAgICAgICAgICAgIGlmICghaGFzT25lQ29udGVudCkge1xuICAgICAgICAgICAgICAkY29udGVudC5hcHBlbmQoY3VycmVudFZpZXcubW9kZWwuZ2V0T3B0aW9uKFwic2hvd0VtcHR5Q29udGVudFwiKSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBjdXJyZW50Vmlldy5tb2RlbFxuICAgICAgICAgICAgICAgIC5nZXQoXCJjb250ZW50XCIpXG4gICAgICAgICAgICAgICAgLmVhY2goZnVuY3Rpb24gdkZyYW1lX0FuYWx5emVDb250ZW50KGN1cnJlbnRBdHRyKSB7XG4gICAgICAgICAgICAgICAgICB2YXIgYXR0cmlidXRlVmlldztcbiAgICAgICAgICAgICAgICAgIGlmICghY3VycmVudEF0dHIuaXNEaXNwbGF5YWJsZSgpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIGN1c3RvbVZpZXcgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudEF0dHIuZ2V0KFwiaXNWYWx1ZUF0dHJpYnV0ZVwiKSkge1xuICAgICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZVZpZXcgPSBuZXcgVmlld0F0dHJpYnV0ZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICBtb2RlbDogY3VycmVudEF0dHIsXG4gICAgICAgICAgICAgICAgICAgICAgICBjdXN0b21WaWV3OiBjdXN0b21WaWV3XG4gICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgcHJvbWlzZUF0dHJpYnV0ZXMucHVzaChhdHRyaWJ1dGVWaWV3LnJlbmRlcigpKTtcbiAgICAgICAgICAgICAgICAgICAgICAkY29udGVudC5hcHBlbmQoYXR0cmlidXRlVmlldy4kZWwpO1xuICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudEF0dHIuZ2V0KFwidHlwZVwiKSA9PT0gXCJhcnJheVwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlVmlldyA9IG5ldyBWaWV3QXR0cmlidXRlQXJyYXkoe1xuICAgICAgICAgICAgICAgICAgICAgICAgbW9kZWw6IGN1cnJlbnRBdHRyXG4gICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgcHJvbWlzZUF0dHJpYnV0ZXMucHVzaChhdHRyaWJ1dGVWaWV3LnJlbmRlcigpKTtcbiAgICAgICAgICAgICAgICAgICAgICAkY29udGVudC5hcHBlbmQoYXR0cmlidXRlVmlldy4kZWwpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgICAgICRjb250ZW50LmFwcGVuZChcbiAgICAgICAgICAgICAgICAgICAgICAnPGgxIGNsYXNzPVwiYmctZGFuZ2VyXCI+PHNwYW4gY2xhc3M9XCJnbHlwaGljb24gZ2x5cGhpY29uLXdhcm5pbmctc2lnblwiIGFyaWEtaGlkZGVuPVwidHJ1ZVwiPjwvc3Bhbj5VbmFibGUgdG8gcmVuZGVyICcgK1xuICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudEF0dHIuaWQgK1xuICAgICAgICAgICAgICAgICAgICAgICAgXCI8L2gxPlwiXG4gICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuZGNwLmxvZ2dlcikge1xuICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5kY3AubG9nZ2VyKGUpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgYXR0cmlidXRlVGVtcGxhdGUuaW5zZXJ0RGVzY3JpcHRpb24oY3VycmVudFZpZXcpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmIChjdXJyZW50Vmlldy5tb2RlbC5nZXRPcHRpb24oXCJjb2xsYXBzZVwiKSA9PT0gXCJjb2xsYXBzZVwiKSB7XG4gICAgICAgICAgICBjdXJyZW50Vmlldy50b2dnbGUobnVsbCwgdHJ1ZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIFByb21pc2UuYWxsKHByb21pc2VBdHRyaWJ1dGVzKVxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gYWxsUmVuZGVyRG9uZSgpIHtcbiAgICAgICAgICAgICAgY3VycmVudFZpZXcubW9kZWwudHJpZ2dlcihcInJlbmRlckRvbmVcIiwge1xuICAgICAgICAgICAgICAgIG1vZGVsOiBjdXJyZW50Vmlldy5tb2RlbCxcbiAgICAgICAgICAgICAgICAkZWw6IGN1cnJlbnRWaWV3LiRlbFxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgaWYgKGN1cnJlbnRWaWV3Lm1vZGVsLmdldE9wdGlvbihcInJlc3BvbnNpdmVDb2x1bW5zXCIpKSB7XG4gICAgICAgICAgICAgICAgY3VycmVudFZpZXcucmVzcG9uc2l2ZUNvbHVtbnMoKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICByZXNvbHZlKGN1cnJlbnRWaWV3KTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuY2F0Y2gocmVqZWN0KTtcbiAgICAgICAgfSksXG4gICAgICAgIHRoaXNcbiAgICAgICk7XG4gICAgfSxcblxuICAgIHNldFJlc3BvbnNpdmVDbGFzc2U6IGZ1bmN0aW9uIHZGcmFtZV9zZXRSZXNwb25zaXZlQ2xhc3NlKCkge1xuICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgIHZhciBmV2lkdGggPSAwO1xuICAgICAgdmFyIG1hdGNoZXNSZXNwb25zaXZlID0gMDtcbiAgICAgIHZhciByZXNwb25zZUNvbHVtbnNEZWZzID0gdGhpcy5tb2RlbC5nZXRPcHRpb24oXCJyZXNwb25zaXZlQ29sdW1uc1wiKSB8fCBbXTtcbiAgICAgIHZhciBpc1RvcEJvdHRvbSA9IGZhbHNlO1xuICAgICAgdmFyIGlzR3JvdyA9IGZhbHNlO1xuXG4gICAgICBpZiAocmVzcG9uc2VDb2x1bW5zRGVmcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGZXaWR0aCA9ICQodGhpcy4kZWwpLndpZHRoKCk7XG5cbiAgICAgICAgaWYgKGZXaWR0aCA8PSAwKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHZhciAkdmF0dHJzID0gdGhpcy4kZWwuZmluZChcIj4gLmRjcEZyYW1lX19jb250ZW50ID4gLnJvd1wiKTtcblxuICAgICAgICBfLmVhY2gocmVzcG9uc2VDb2x1bW5zRGVmcywgZnVuY3Rpb24gdkZyYW1lX3NldFJlc3BvbnNpdmVDbGFzc2VzKFxuICAgICAgICAgIHJlc3BvbnNlQ29sdW1uc0luZm9cbiAgICAgICAgKSB7XG4gICAgICAgICAgaWYgKFxuICAgICAgICAgICAgZldpZHRoID49IHJlc3BvbnNlQ29sdW1uc0luZm8ubWluQWJzV2lkdGggJiZcbiAgICAgICAgICAgIGZXaWR0aCA8IHJlc3BvbnNlQ29sdW1uc0luZm8ubWF4QWJzV2lkdGhcbiAgICAgICAgICApIHtcbiAgICAgICAgICAgIG1hdGNoZXNSZXNwb25zaXZlID0gcmVzcG9uc2VDb2x1bW5zSW5mby5udW1iZXI7XG4gICAgICAgICAgICBpZiAocmVzcG9uc2VDb2x1bW5zSW5mby5ncm93ID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgIF90aGlzLiRlbC5hZGRDbGFzcyhcImRjcC1jb2x1bW4tLWdyb3dcIik7XG4gICAgICAgICAgICAgIGlzR3JvdyA9IHRydWU7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBfdGhpcy4kZWwucmVtb3ZlQ2xhc3MoXCJkY3AtY29sdW1uLS1ncm93XCIpO1xuICAgICAgICAgICAgICBpc0dyb3cgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlzVG9wQm90dG9tID0gcmVzcG9uc2VDb2x1bW5zSW5mby5kaXJlY3Rpb24gPT09IFwidG9wQm90dG9tXCI7XG5cbiAgICAgICAgICAgIGlmIChpc0dyb3cpIHtcbiAgICAgICAgICAgICAgaWYgKCR2YXR0cnMubGVuZ3RoIDwgbWF0Y2hlc1Jlc3BvbnNpdmUpIHtcbiAgICAgICAgICAgICAgICBtYXRjaGVzUmVzcG9uc2l2ZSA9ICR2YXR0cnMubGVuZ3RoO1xuICAgICAgICAgICAgICB9IGVsc2UgaWYgKGlzVG9wQm90dG9tKSB7XG4gICAgICAgICAgICAgICAgdmFyIHJvd051bWJlciA9IE1hdGguY2VpbCgkdmF0dHJzLmxlbmd0aCAvIG1hdGNoZXNSZXNwb25zaXZlKTtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gbWF0Y2hlc1Jlc3BvbnNpdmU7IGktLTsgaSA+IDEpIHtcbiAgICAgICAgICAgICAgICAgIGlmIChNYXRoLmNlaWwoJHZhdHRycy5sZW5ndGggLyBpKSA9PT0gcm93TnVtYmVyKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIERlY3JlYXNlIGNvbHVtbiBudW1iZXIgaWYgbm90IGVub3VnaCBkYXRhIHRvIGF2b2lkIGVtcHR5IGNvbHVtbnNcbiAgICAgICAgICAgICAgICAgICAgbWF0Y2hlc1Jlc3BvbnNpdmUgPSBpO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAobWF0Y2hlc1Jlc3BvbnNpdmUgPiAxKSB7XG4gICAgICAgICAgICAgIF90aGlzLiRlbC5hZGRDbGFzcyhcImRjcC1jb2x1bW4tLVwiICsgbWF0Y2hlc1Jlc3BvbnNpdmUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBfdGhpcy4kZWwucmVtb3ZlQ2xhc3MoXCJkY3AtY29sdW1uLS1cIiArIHJlc3BvbnNlQ29sdW1uc0luZm8ubnVtYmVyKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmIChtYXRjaGVzUmVzcG9uc2l2ZSA+IDEpIHtcbiAgICAgICAgICBfdGhpcy4kZWwuYWRkQ2xhc3MoXCJkY3AtY29sdW1uXCIpO1xuICAgICAgICAgIGlmIChtYXRjaGVzUmVzcG9uc2l2ZSAhPT0gdGhpcy5mcmFtZUNvbHVtbk51bWJlcikge1xuICAgICAgICAgICAgdGhpcy5mcmFtZUNvbHVtbk51bWJlciA9IG1hdGNoZXNSZXNwb25zaXZlO1xuXG4gICAgICAgICAgICBpZiAoaXNUb3BCb3R0b20pIHtcbiAgICAgICAgICAgICAgdGhpcy4kZWwuYWRkQ2xhc3MoXCJkY3AtY29sdW1uLS10b3Bib3R0b21cIik7XG4gICAgICAgICAgICAgIHRoaXMuJGVsLnJlbW92ZUNsYXNzKFwiZGNwLWNvbHVtbi0tbGVmdHJpZ2h0XCIpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgdGhpcy4kZWwucmVtb3ZlQ2xhc3MoXCJkY3AtY29sdW1uLS10b3Bib3R0b21cIik7XG4gICAgICAgICAgICAgIHRoaXMuJGVsLmFkZENsYXNzKFwiZGNwLWNvbHVtbi0tbGVmdHJpZ2h0XCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLmZyYW1lQ29sdW1uTnVtYmVyID0gbWF0Y2hlc1Jlc3BvbnNpdmU7XG4gICAgICAgICAgdGhpcy4kZWwucmVtb3ZlQ2xhc3MoXCJkY3AtY29sdW1uXCIpO1xuICAgICAgICAgIHRoaXMuJGVsLnJlbW92ZUNsYXNzKFwiZGNwLWNvbHVtbi0tdG9wYm90dG9tXCIpO1xuICAgICAgICAgIHRoaXMuJGVsLnJlbW92ZUNsYXNzKFwiZGNwLWNvbHVtbi0tbGVmdHJpZ2h0XCIpO1xuICAgICAgICAgIHRoaXMuJGVsLnJlbW92ZUNsYXNzKFwiZGNwLWNvbHVtbi0tZ3Jvd1wiKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sXG5cbiAgICByZXNwb25zaXZlQ29sdW1uczogZnVuY3Rpb24gdkZyYW1lX3Jlc3BvbnNpdmVDb2x1bW5zKCkge1xuICAgICAgdmFyIHJlc3BvbnNlQ29sdW1uc0RlZnMgPSB0aGlzLm1vZGVsLmdldE9wdGlvbihcInJlc3BvbnNpdmVDb2x1bW5zXCIpIHx8IFtdO1xuICAgICAgdmFyICRmYWtlID0gJChcIjxkaXYvPlwiKS5jc3Moe1xuICAgICAgICBwb3NpdGlvbjogXCJhYnNvbHV0ZVwiLFxuICAgICAgICB0b3A6IDAsXG4gICAgICAgIG92ZXJmbG93OiBcImhpZGRlblwiXG4gICAgICB9KTtcbiAgICAgIHZhciAkZmFrZVdpZHRoID0gJChcIjxkaXYvPlwiKTtcblxuICAgICAgJChcImJvZHlcIikuYXBwZW5kKCRmYWtlLmFwcGVuZCgkZmFrZVdpZHRoKSk7XG5cbiAgICAgIC8vIENvbXB1dGUgYWJzb2x1dGUgd2lkdGhcbiAgICAgIF8uZWFjaChyZXNwb25zZUNvbHVtbnNEZWZzLCBmdW5jdGlvbiB2RnJhbWVfY29tcHV0ZVJlc3BvbnNpdmVXaWR0aChcbiAgICAgICAgcmVzcG9uc2VDb2x1bW5zSW5mb1xuICAgICAgKSB7XG4gICAgICAgIGlmICghcmVzcG9uc2VDb2x1bW5zSW5mby5taW5XaWR0aCkge1xuICAgICAgICAgIHJlc3BvbnNlQ29sdW1uc0luZm8ubWluQWJzV2lkdGggPSAwO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICRmYWtlV2lkdGgud2lkdGgocmVzcG9uc2VDb2x1bW5zSW5mby5taW5XaWR0aCk7XG4gICAgICAgICAgcmVzcG9uc2VDb2x1bW5zSW5mby5taW5BYnNXaWR0aCA9ICRmYWtlV2lkdGgud2lkdGgoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghcmVzcG9uc2VDb2x1bW5zSW5mby5tYXhXaWR0aCkge1xuICAgICAgICAgIHJlc3BvbnNlQ29sdW1uc0luZm8ubWF4QWJzV2lkdGggPSBJbmZpbml0eTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAkZmFrZVdpZHRoLndpZHRoKHJlc3BvbnNlQ29sdW1uc0luZm8ubWF4V2lkdGgpO1xuICAgICAgICAgIHJlc3BvbnNlQ29sdW1uc0luZm8ubWF4QWJzV2lkdGggPSAkZmFrZVdpZHRoLndpZHRoKCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICAkZmFrZS5yZW1vdmUoKTtcbiAgICAgICQod2luZG93KS5vbihcbiAgICAgICAgXCJyZXNpemUudlwiICsgdGhpcy5tb2RlbC5jaWQsXG4gICAgICAgIF8uYmluZCh0aGlzLnNldFJlc3BvbnNpdmVDbGFzc2UsIHRoaXMpXG4gICAgICApO1xuICAgICAgXy5kZWZlcihfLmJpbmQodGhpcy5zZXRSZXNwb25zaXZlQ2xhc3NlLCB0aGlzKSk7XG4gICAgfSxcblxuICAgIGdldEF0dHJpYnV0ZU1vZGVsOiBmdW5jdGlvbiB2RnJhbWVfZ2V0QXR0cmlidXRlTW9kZWwoYXR0cmlidXRlSWQpIHtcbiAgICAgIHZhciBkb2NNb2RlbCA9IHRoaXMubW9kZWwuZ2V0RG9jdW1lbnRNb2RlbCgpO1xuICAgICAgcmV0dXJuIGRvY01vZGVsLmdldChcImF0dHJpYnV0ZXNcIikuZ2V0KGF0dHJpYnV0ZUlkKTtcbiAgICB9LFxuXG4gICAgc2V0RXJyb3I6IGZ1bmN0aW9uIHZGcmFtZV9zZXRFcnJvcihldmVudCwgZGF0YSkge1xuICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgdGhpcy4kZWwuZmluZChcIi5kY3BGcmFtZV9fbGFiZWxcIikuYWRkQ2xhc3MoXCJoYXMtZXJyb3JcIik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLiRlbC5maW5kKFwiLmRjcEZyYW1lX19sYWJlbFwiKS5yZW1vdmVDbGFzcyhcImhhcy1lcnJvclwiKTtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgdXBkYXRlTGFiZWw6IGZ1bmN0aW9uIHZGcmFtZV91cGRhdGVMYWJlbCgpIHtcbiAgICAgIHRoaXMuJGVsLmZpbmQoXCIuZGNwRnJhbWVfX2xhYmVsXCIpLnRleHQodGhpcy5tb2RlbC5nZXQoXCJsYWJlbFwiKSk7XG4gICAgfSxcblxuICAgIHRvZ2dsZTogZnVuY3Rpb24gdkZyYW1lX3RvZ2dsZShldmVudCwgaGlkZU5vdykge1xuICAgICAgdmFyICRjb250ZW50RWxlbWVudCA9IHRoaXMuJChcIi5kY3BGcmFtZV9fY29udGVudFwiKTtcbiAgICAgIHRoaXMuJChcIi5kY3BfX2ZyYW1lX19jYXJldFwiKS50b2dnbGVDbGFzcyhcImZhLWNhcmV0LXJpZ2h0IGZhLWNhcmV0LWRvd25cIik7XG4gICAgICAkY29udGVudEVsZW1lbnQudG9nZ2xlQ2xhc3MoXG4gICAgICAgIFwiZGNwRnJhbWVfX2NvbnRlbnQtLW9wZW4gZGNwRnJhbWVfX2NvbnRlbnQtLWNsb3NlXCJcbiAgICAgICk7XG4gICAgICBpZiAoaGlkZU5vdykge1xuICAgICAgICAkY29udGVudEVsZW1lbnQuaGlkZSgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgJGNvbnRlbnRFbGVtZW50LnNsaWRlVG9nZ2xlKDIwMCk7XG4gICAgICAgIGlmICgkY29udGVudEVsZW1lbnQuaGFzQ2xhc3MoXCJkY3BGcmFtZV9fY29udGVudC0tb3BlblwiKSkge1xuICAgICAgICAgIHRoaXMubW9kZWwuZ2V0RG9jdW1lbnRNb2RlbCgpLnRyaWdnZXIoXCJyZWRyYXdFcnJvck1lc3NhZ2VzXCIpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcblxuICAgIGhpZGU6IGZ1bmN0aW9uIHZGcmFtZV9oaWRlKCkge1xuICAgICAgdGhpcy4kZWwuaGlkZSgpO1xuICAgIH0sXG5cbiAgICBzaG93OiBmdW5jdGlvbiB2RnJhbWVfc2hvdygpIHtcbiAgICAgIHRoaXMuJGVsLnNob3coKTtcbiAgICB9LFxuXG4gICAgZXh0ZXJuYWxMaW5rU2VsZWN0ZWQ6IGZ1bmN0aW9uIHZBdHRyaWJ1dGVFeHRlcm5hbExpbmtTZWxlY3RlZChldmVudCkge1xuICAgICAgdmFyICR0YXJnZXQgPSAkKGV2ZW50LmN1cnJlbnRUYXJnZXQpLFxuICAgICAgICBhY3Rpb24sXG4gICAgICAgIG9wdGlvbnMsXG4gICAgICAgIGV2ZW50T3B0aW9ucyxcbiAgICAgICAgZG9jdW1lbnRNb2RlbCxcbiAgICAgICAgaW50ZXJuYWxFdmVudCA9IHtcbiAgICAgICAgICBwcmV2ZW50OiBmYWxzZVxuICAgICAgICB9O1xuXG4gICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgaWYgKGV2ZW50LnN0b3BQcm9wYWdhdGlvbikge1xuICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgIH1cblxuICAgICAgYWN0aW9uID0gJHRhcmdldC5kYXRhKFwiYWN0aW9uXCIpIHx8ICR0YXJnZXQuYXR0cihcImhyZWZcIik7XG4gICAgICBvcHRpb25zID0gYWN0aW9uLnN1YnN0cmluZyg4KS5zcGxpdChcIjpcIik7XG4gICAgICBldmVudE9wdGlvbnMgPSB7XG4gICAgICAgIHRhcmdldDogZXZlbnQudGFyZ2V0LFxuICAgICAgICBpbmRleDogLTEsXG4gICAgICAgIGV2ZW50SWQ6IG9wdGlvbnMuc2hpZnQoKSxcbiAgICAgICAgb3B0aW9uczogb3B0aW9uc1xuICAgICAgfTtcbiAgICAgIGRvY3VtZW50TW9kZWwgPSB0aGlzLm1vZGVsLmdldERvY3VtZW50TW9kZWwoKTtcblxuICAgICAgdGhpcy5tb2RlbC50cmlnZ2VyKFwiaW50ZXJuYWxMaW5rU2VsZWN0ZWRcIiwgaW50ZXJuYWxFdmVudCwgZXZlbnRPcHRpb25zKTtcbiAgICAgIGlmIChldmVudC5wcmV2ZW50KSB7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgfVxuXG4gICAgICBkb2N1bWVudE1vZGVsLnRyaWdnZXIoXCJhY3Rpb25BdHRyaWJ1dGVMaW5rXCIsIGludGVybmFsRXZlbnQsIGV2ZW50T3B0aW9ucyk7XG5cbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICBfaWRlbnRpZnlWaWV3OiBmdW5jdGlvbiB2RnJhbWVfaWRlbnRpZnlWaWV3KGV2ZW50KSB7XG4gICAgICBldmVudC5oYXZlVmlldyA9IHRydWU7XG4gICAgICAvL0FkZCB0aGUgcG9pbnRlciB0byB0aGUgY3VycmVudCBqcXVlcnkgZWxlbWVudCB0byBhIGxpc3QgcGFzc2VkIGJ5IHRoZSBldmVudFxuICAgICAgZXZlbnQuZWxlbWVudHMgPSBldmVudC5lbGVtZW50cy5hZGQodGhpcy4kZWwpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBEZXN0cm95IHRoZSBhc3NvY2lhdGVkIHdpZGdldCBhbmQgc3VwcHJlc3MgZXZlbnQgbGlzdGVuZXIgYmVmb3JlIHJlbW92IHRoZSBkb21cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIHsqfVxuICAgICAqL1xuICAgIHJlbW92ZTogZnVuY3Rpb24gdkZyYW1lX1JlbW92ZSgpIHtcbiAgICAgICQod2luZG93KS5vZmYoXCIudlwiICsgdGhpcy5tb2RlbC5jaWQpO1xuXG4gICAgICByZXR1cm4gQmFja2JvbmUuVmlldy5wcm90b3R5cGUucmVtb3ZlLmNhbGwodGhpcyk7XG4gICAgfVxuICB9KTtcbn0pO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///7a4c946b6dd0337fa34b\n");

/***/ }),

/***/ "7bf0c39069ca070152a3":
/*!************************************************************************!*\
  !*** ./src/Apps/DOCUMENT/IHM/widgets/attributes/password/wPassword.js ***!
  \************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/*global define*/\n(function umdRequire(root, factory) {\n  \"use strict\";\n\n  if (true) {\n    !(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(/*! jquery */ \"127c8cf59f228bb01a21\"), __webpack_require__(/*! dcpDocument/widgets/attributes/text/wText */ \"61b480911316cdda77a4\")], __WEBPACK_AMD_DEFINE_FACTORY__ = (factory),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?\n\t\t\t\t(__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n  } else {}\n})(window, function wPassword($) {\n  \"use strict\";\n\n  $.widget(\"dcp.dcpPassword\", $.dcp.dcpText, {\n    options: {\n      type: \"password\",\n\n      renderOptions: {\n        hideValue: \"*****\"\n      },\n      labels: {}\n    },\n\n    _initDom: function wasswordInitDom() {\n      if (this.options.attributeValue.value) {\n        this.options.attributeValue.displayValue = this.options.renderOptions.hideValue;\n      }\n\n      this._super();\n      if (this.getMode() === \"write\") {\n        this._getFocusInput().attr(\"type\", \"password\");\n      }\n    },\n    /**\n     * Hide password to displayValue\n     * @param value\n     */\n    setValue: function wpasswordSetValue(value) {\n      if (value.value) {\n        value.displayValue = this.options.renderOptions.hideValue;\n      }\n\n      this._super(value);\n    },\n    getType: function wIntGetType() {\n      return \"password\";\n    }\n  });\n\n  return $.fn.dcpPassword;\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiN2JmMGMzOTA2OWNhMDcwMTUyYTMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvQXBwcy9ET0NVTUVOVC9JSE0vd2lkZ2V0cy9hdHRyaWJ1dGVzL3Bhc3N3b3JkL3dQYXNzd29yZC5qcz8wNTg1Il0sInNvdXJjZXNDb250ZW50IjpbIi8qZ2xvYmFsIGRlZmluZSovXG4oZnVuY3Rpb24gdW1kUmVxdWlyZShyb290LCBmYWN0b3J5KSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIGlmICh0eXBlb2YgZGVmaW5lID09PSBcImZ1bmN0aW9uXCIgJiYgZGVmaW5lLmFtZCkge1xuICAgIGRlZmluZShbXCJqcXVlcnlcIiwgXCJkY3BEb2N1bWVudC93aWRnZXRzL2F0dHJpYnV0ZXMvdGV4dC93VGV4dFwiXSwgZmFjdG9yeSk7XG4gIH0gZWxzZSB7XG4gICAgLy9ub2luc3BlY3Rpb24gSlNVbnJlc29sdmVkVmFyaWFibGVcbiAgICBmYWN0b3J5KHdpbmRvdy5qUXVlcnkpO1xuICB9XG59KSh3aW5kb3csIGZ1bmN0aW9uIHdQYXNzd29yZCgkKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gICQud2lkZ2V0KFwiZGNwLmRjcFBhc3N3b3JkXCIsICQuZGNwLmRjcFRleHQsIHtcbiAgICBvcHRpb25zOiB7XG4gICAgICB0eXBlOiBcInBhc3N3b3JkXCIsXG5cbiAgICAgIHJlbmRlck9wdGlvbnM6IHtcbiAgICAgICAgaGlkZVZhbHVlOiBcIioqKioqXCJcbiAgICAgIH0sXG4gICAgICBsYWJlbHM6IHt9XG4gICAgfSxcblxuICAgIF9pbml0RG9tOiBmdW5jdGlvbiB3YXNzd29yZEluaXREb20oKSB7XG4gICAgICBpZiAodGhpcy5vcHRpb25zLmF0dHJpYnV0ZVZhbHVlLnZhbHVlKSB7XG4gICAgICAgIHRoaXMub3B0aW9ucy5hdHRyaWJ1dGVWYWx1ZS5kaXNwbGF5VmFsdWUgPSB0aGlzLm9wdGlvbnMucmVuZGVyT3B0aW9ucy5oaWRlVmFsdWU7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuX3N1cGVyKCk7XG4gICAgICBpZiAodGhpcy5nZXRNb2RlKCkgPT09IFwid3JpdGVcIikge1xuICAgICAgICB0aGlzLl9nZXRGb2N1c0lucHV0KCkuYXR0cihcInR5cGVcIiwgXCJwYXNzd29yZFwiKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIC8qKlxuICAgICAqIEhpZGUgcGFzc3dvcmQgdG8gZGlzcGxheVZhbHVlXG4gICAgICogQHBhcmFtIHZhbHVlXG4gICAgICovXG4gICAgc2V0VmFsdWU6IGZ1bmN0aW9uIHdwYXNzd29yZFNldFZhbHVlKHZhbHVlKSB7XG4gICAgICBpZiAodmFsdWUudmFsdWUpIHtcbiAgICAgICAgdmFsdWUuZGlzcGxheVZhbHVlID0gdGhpcy5vcHRpb25zLnJlbmRlck9wdGlvbnMuaGlkZVZhbHVlO1xuICAgICAgfVxuXG4gICAgICB0aGlzLl9zdXBlcih2YWx1ZSk7XG4gICAgfSxcbiAgICBnZXRUeXBlOiBmdW5jdGlvbiB3SW50R2V0VHlwZSgpIHtcbiAgICAgIHJldHVybiBcInBhc3N3b3JkXCI7XG4gICAgfVxuICB9KTtcblxuICByZXR1cm4gJC5mbi5kY3BQYXNzd29yZDtcbn0pO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFDQSxXQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///7bf0c39069ca070152a3\n");

/***/ }),

/***/ "87c09356a22ec84292bb":
/*!*****************************************************!*\
  !*** ./src/Apps/DOCUMENT/IHM/widgets/menu/wMenu.js ***!
  \*****************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;!(__WEBPACK_AMD_DEFINE_ARRAY__ = [\n  __webpack_require__(/*! jquery */ \"127c8cf59f228bb01a21\"),\n  __webpack_require__(/*! underscore */ \"8e08e542008e4aef1f58\"),\n  __webpack_require__(/*! mustache */ \"bcd31d01884fc294fd69\"),\n  __webpack_require__(/*! dcpDocument/i18n/documentCatalog */ \"278ba7757aa1904087c6\"),\n  __webpack_require__(/*! dcpDocument/widgets/widget */ \"f562ab9f022eef93542c\")\n], __WEBPACK_AMD_DEFINE_RESULT__ = (function wMenu($, _, Mustache, i18n) {\n  \"use strict\";\n\n  $.widget(\"dcp.dcpMenu\", {\n    options: {\n      eventPrefix: \"dcpmenu\"\n    },\n\n    kendoMenuWidget: null,\n    _create: function wMenuCreate() {\n      this._tooltips = [];\n      this.popupWindows = [];\n      this._initStructure();\n    },\n\n    _initStructure: function wMenuInitStructure() {\n      var $content,\n        $mainElement,\n        scopeWidget = this;\n      //InitDom\n      $mainElement = $(\n        Mustache.render(\n          this._getTemplate(\"menu\") || \"\",\n          _.extend({ uuid: this.uuid }, this.options)\n        )\n      );\n      $content = $mainElement.find(\".menu__content\");\n      this._insertMenuContent(this.options.menus, $content);\n      this.element.append($mainElement);\n      //Init kendo widget\n      $content.kendoMenu({\n        openOnClick: true,\n        closeOnClick: true,\n\n        select: function wMenuSelect(event) {\n          var $menuElement = $(event.item),\n            eventContent,\n            $elementA,\n            href,\n            configMenu,\n            confirmText,\n            confirmOptions,\n            confirmDcpWindow,\n            target,\n            targetOptions,\n            dcpWindow,\n            $bodyDiv,\n            wFeature = \"\";\n\n          if ($menuElement.hasClass(\"menu__element--callable\")) {\n            scopeWidget.callMenu($menuElement);\n            return;\n          }\n\n          // Use specific select only for terminal items\n          if (!$menuElement.hasClass(\"menu__element--item\")) {\n            return;\n          }\n          $elementA = $(event.item).find(\"a\");\n          href = $elementA.data(\"url\");\n          //noinspection JSHint\n          if (href != \"\") {\n            //Display confirm message\n            if ($elementA.hasClass(\"menu--confirm\")) {\n              confirmText = Mustache.render(\n                $elementA.data(\"confirm-message\") || \"\",\n                scopeWidget.options\n              );\n\n              configMenu = $menuElement.data(\"menuConfiguration\");\n              confirmOptions = configMenu.confirmationOptions || {};\n              confirmDcpWindow = $(\"body\").dcpConfirm({\n                title: Mustache.render(\n                  confirmOptions.title || \"\",\n                  scopeWidget.options\n                ),\n                width: confirmOptions.windowWidth,\n                height: confirmOptions.windowHeight,\n                messages: {\n                  okMessage: Mustache.render(\n                    confirmOptions.confirmButton || \"\",\n                    scopeWidget.options\n                  ),\n                  cancelMessage: Mustache.render(\n                    confirmOptions.cancelButton || \"\",\n                    scopeWidget.options\n                  ),\n                  htmlMessage: confirmText,\n                  textMessage: \"\"\n                },\n                confirm: function wMenuConfirm() {\n                  $elementA.removeClass(\"menu--confirm\");\n                  $elementA.trigger(\"click\");\n                  $elementA.addClass(\"menu--confirm\");\n                },\n                templateData: scopeWidget.options\n              });\n\n              scopeWidget.popupWindows.push(confirmDcpWindow.data(\"dcpWindow\"));\n\n              confirmDcpWindow.data(\"dcpWindow\").open();\n            } else {\n              scopeWidget.element.data(\"menu-opening\", false);\n              //if href is event kind propagate event instead of default behaviour\n              if (href.substring(0, 8) === \"#action/\") {\n                event.preventDefault();\n                if (event.stopPropagation) {\n                  event.stopPropagation();\n                }\n                eventContent = href.substring(8).split(\":\");\n                scopeWidget._trigger(\"externalLinkSelected\", event, {\n                  target: event.target || event.item,\n                  eventId: eventContent.shift(),\n                  options: eventContent\n                });\n              } else {\n                var $base = $(\"base\");\n                var isAbsUrl = new RegExp(\"^(?:[a-z]+:)?//\", \"i\");\n\n                target = $elementA.attr(\"target\") || \"_self\";\n\n                if (\n                  $elementA.attr(\"href\") &&\n                  $elementA.attr(\"href\").substring(0, 1) === \"#\"\n                ) {\n                  href =\n                    window.location.protocol +\n                    \"//\" +\n                    window.location.hostname +\n                    (window.location.port ? \":\" + window.location.port : \"\") +\n                    (window.location.pathname\n                      ? window.location.pathname\n                      : \"/\") +\n                    (window.location.search ? window.location.search : \"\") +\n                    $elementA.attr(\"href\");\n                }\n\n                if (target === \"_self\") {\n                  // For IE : Not honor base href in this case\n\n                  if (!isAbsUrl.test(href)) {\n                    window.location.href = $base.attr(\"href\") + href;\n                  } else {\n                    window.location.href = href;\n                  }\n                } else {\n                  configMenu = $menuElement.data(\"menuConfiguration\");\n                  targetOptions = configMenu.targetOptions || {};\n                  if (target === \"_dialog\") {\n                    $bodyDiv = $(\"<div/>\");\n                    $(\"body\").append($bodyDiv);\n                    dcpWindow = $bodyDiv.dcpWindow({\n                      title: Mustache.render(\n                        targetOptions.title || \"\",\n                        window.dcp.documentData\n                      ),\n                      width: targetOptions.windowWidth,\n                      height: targetOptions.windowHeight,\n                      modal: targetOptions.modal,\n                      content: href,\n                      iframe: true\n                    });\n\n                    scopeWidget.popupWindows.push(dcpWindow.data(\"dcpWindow\"));\n                    dcpWindow\n                      .data(\"dcpWindow\")\n                      .kendoWindow()\n                      .center();\n                    dcpWindow.data(\"dcpWindow\").open();\n                  } else {\n                    if (\n                      targetOptions &&\n                      (targetOptions.windowWidth || targetOptions.windowHeight)\n                    ) {\n                      if (targetOptions.windowWidth) {\n                        wFeature +=\n                          \"width=\" +\n                          parseInt(targetOptions.windowWidth, 10) +\n                          \",\";\n                      }\n                      if (targetOptions.windowHeight) {\n                        wFeature +=\n                          \"height=\" +\n                          parseInt(targetOptions.windowHeight, 10) +\n                          \",\";\n                      }\n                      wFeature += \"resizable=yes,scrollbars=yes\";\n                    }\n                    if (!isAbsUrl.test(href)) {\n                      // For IE : Not honor base href in this case\n                      href = $base.attr(\"href\") + href;\n                    }\n                    window.open(href, target, wFeature);\n                  }\n                }\n              }\n            }\n          }\n        },\n        deactivate: function wMenuDeactivate(event) {\n          var $menuElement = $(event.item);\n\n          // Use for reopen for Dynamic menu\n          if ($menuElement.data(\"menu-openAgain\")) {\n            $menuElement.data(\"menu-openAgain\", false);\n            $menuElement.data(\"menu-noQuery\", true);\n            $content.data(\"kendoMenu\").open($menuElement);\n          }\n        },\n        open: function wMenuOpen(event) {\n          var $menuElement = $(event.item);\n\n          // Due to iOs artefact, an resize event is send, so need to inhibated during opening menu\n          scopeWidget.element.data(\"menu-opening\", true);\n          $menuElement.data(\"bodyWidth\", $(\"body\").width());\n\n          if (!$menuElement.hasClass(\"menu__element--item\")) {\n            var menuUrl = $menuElement.data(\"menu-url\");\n            if (menuUrl) {\n              // Open Dynamic menu : request server to get menu contents\n              if (!$menuElement.data(\"menu-noQuery\")) {\n                var loading = $menuElement.find(\".menu__loading\");\n\n                if (loading.length > 0) {\n                  // record initial loading item\n                  $menuElement.data(\"menu-loading\", loading);\n                }\n\n                // Display loading first\n                if (loading.length === 0 && $menuElement.data(\"menu-loading\")) {\n                  $menuElement\n                    .find(\".listmenu__content\")\n                    .html(\"\")\n                    .append($menuElement.data(\"menu-loading\"));\n                }\n\n                // Get subMenu\n                $.get(menuUrl, function wMenuDone(response) {\n                  var data = response.data;\n                  $menuElement.find(\".listmenu__content\").html(\"\");\n\n                  scopeWidget._insertMenuContent(\n                    data.content,\n                    $menuElement.find(\".listmenu__content\"),\n                    scopeWidget,\n                    $menuElement\n                  );\n                  $menuElement.kendoMenu({\n                    openOnClick: true,\n                    closeOnClick: true\n                  });\n\n                  if (\n                    parseInt(\n                      $menuElement.find(\".k-animation-container\").css(\"left\")\n                    ) !== 0 &&\n                    parseInt(\n                      $menuElement.find(\".k-animation-container\").css(\"right\")\n                    ) !== 0\n                  ) {\n                    // Need to close and reopen to adjust position menu because content has changed\n                    $menuElement.data(\"menu-openAgain\", true);\n                    $content.data(\"kendoMenu\").close($menuElement);\n                  }\n                }).fail(function wMenuFail(data) {\n                  try {\n                    var errorMessage = data.responseText;\n                    $menuElement.find(\".listmenu__content\").html(\n                      $(\"<div/>\")\n                        .text(errorMessage)\n                        .addClass(\"menu--error\")\n                    );\n                  } catch (e) {\n                    if (window.dcp.logger) {\n                      window.dcp.logger(e);\n                    } else {\n                      console.error(e);\n                    }\n                  }\n                });\n              }\n              $menuElement.data(\"menu-noQuery\", false);\n            }\n          }\n        },\n        activate: function wMenuActivate(event) {\n          // Correct Kendo position list when scrollbar is displayed\n          var $menuElement = $(event.item);\n          var $container = $menuElement.find(\".k-animation-container\");\n\n          var bodyWidth = $menuElement.data(\"bodyWidth\");\n          var menuWidth = $menuElement.outerWidth();\n          var menuLeft = $menuElement.offset().left;\n          var listWidth = $container.outerWidth();\n          var listLeft = $container.offset().left;\n\n          // The first condition is for iOS because no scroll window exists\n          if (\n            $(\"body\").width() > bodyWidth ||\n            window.document.documentElement.scrollHeight >\n              window.document.documentElement.clientHeight\n          ) {\n            // If the list menu is out of the body box, need to move it to the right\n            if (listLeft + listWidth > bodyWidth) {\n              $container\n                .css(\"left\", \"auto\")\n                .css(\"right\", menuLeft - bodyWidth + menuWidth + \"px\");\n            }\n          }\n\n          _.delay(function wMenuOpenDelay() {\n            // Due to iOs artefact, an resize event is send, so need to inhibated during opening menu\n            scopeWidget.element.data(\"menu-opening\", false);\n          }, 2000);\n        }\n      });\n\n      this.element\n        .find(\".menu--left\")\n        .last()\n        .addClass(\"menu--lastLeft\");\n      /**\n       * Fix menu when no see header\n       */\n      $(window).off(\"scroll.ddui\"); // reset\n\n      if (this.element.prop(\"nodeName\").toUpperCase() === \"NAV\") {\n        $(window).on(\"scroll.ddui\", function wMenuScroll() {\n          if ($(window).scrollTop() > $mainElement.position().top) {\n            if (!$mainElement.data(\"isFixed\")) {\n              $mainElement.data(\"isFixed\", \"1\");\n              $mainElement.parent().addClass(\"menu--fixed\");\n              $(window.document).trigger(\"redrawErrorMessages\");\n            }\n          } else {\n            if ($mainElement.data(\"isFixed\")) {\n              $mainElement.data(\"isFixed\", null);\n              $mainElement.parent().removeClass(\"menu--fixed\");\n              $(window.document).trigger(\"redrawErrorMessages\");\n            }\n          }\n        });\n      }\n      /**\n       * Responsive Menu\n       */\n      this.kendoMenuWidget = $content.data(\"kendoMenu\");\n      this.kendoMenuWidget.append([\n        {\n          text: i18n.___(\"Other\", \"UImenu\") + '<span class=\"menu--count\" />',\n          cssClass: \"menu__element  menu_element--hamburger \",\n          encoded: false, // Allows use of HTML for item text\n          items: [] // List items\n        }\n      ]);\n      $(window).on(\"resize.dcpMenu\", _.bind(this.inhibitBarMenu, this));\n      $(window).on(\n        \"resize.dcpMenu\",\n        _.debounce(_.bind(this.updateResponsiveMenu, this), 100, false)\n      );\n    },\n\n    callMenu: function callMenu($menuItem) {\n      var scopeWidget = this;\n      var $elementA = $menuItem.find(\"a\");\n\n      $.ajax({\n        dataType: \"json\",\n        url: $elementA.data(\"url\"),\n        method: $elementA.data(\"method\")\n      })\n        .then(function(data) {\n          _.each(data.messages, function(msg) {\n            scopeWidget._trigger(\"showMessage\", event, {\n              title: msg.contentText,\n              type: msg.type\n            });\n          });\n\n          if (data.data.needReload === true) {\n            _.delay(\n              function() {\n                scopeWidget._trigger(\"reload\", event, {});\n              },\n              // wait 1 second to see message before reload\n              data.messages ? 1000 : 0\n            );\n          }\n        })\n        .catch(function(info) {\n          scopeWidget._trigger(\"showMessage\", event, {\n            type: \"error\",\n            message:\n              info.responseJSON.error || info.responseJSON.exceptionMessage\n          });\n        });\n    },\n\n    inhibitBarMenu: function wMenuInhibitBarMenu() {\n      var widgetMenu = this;\n      if (\n        !widgetMenu.element.data(\"menu-opening\") &&\n        this.element.css(\"overflow\") !== \"hidden\"\n      ) {\n        this.element\n          .find(\"li.k-state-border-down\")\n          .each(function wMenuInhibitBarMenuClose() {\n            widgetMenu.kendoMenuWidget.close($(this));\n          });\n      }\n    },\n\n    /**\n     * Get scrollbar width by adding a element\n     * @returns {number|*}\n     */\n    getScrollBarWidth: function wMenugetScrollBarWidth() {\n      if (!this.scrollBarWidth) {\n        var inner = document.createElement(\"p\");\n        inner.style.width = \"100%\";\n        inner.style.height = \"200px\";\n\n        var outer = document.createElement(\"div\");\n        outer.style.position = \"absolute\";\n        outer.style.top = \"0px\";\n        outer.style.left = \"0px\";\n        outer.style.visibility = \"hidden\";\n        outer.style.width = \"200px\";\n        outer.style.height = \"150px\";\n        outer.style.overflow = \"hidden\";\n        outer.appendChild(inner);\n\n        document.body.appendChild(outer);\n        var w1 = inner.offsetWidth;\n        outer.style.overflow = \"scroll\";\n        var w2 = inner.offsetWidth;\n        if (w1 === w2) {\n          w2 = outer.clientWidth;\n        }\n\n        document.body.removeChild(outer);\n        this.scrollBarWidth = w1 - w2;\n      }\n\n      return this.scrollBarWidth;\n    },\n\n    /**\n     * Move menu to hamburger which can be displayed in same line menu\n     */\n    updateResponsiveMenu: function wMenuHideResponsiveMenu() {\n      var barMenu = this.element;\n      var $itemMenu = barMenu.find(\n        \"ul.k-menu > .menu__element:not(.menu--important,.menu_element--hamburger)\"\n      );\n      var $importantItemMenu = barMenu.find(\n        \"ul.k-menu > .menu__element.menu--important\"\n      );\n      var newHiddens = [];\n      var currentWidth = 0;\n      var visibleWidth = 0;\n      var freeWidth = 0;\n      var barmenuWidth = barMenu.width() - 2;\n      var kendoMenu = this.kendoMenuWidget;\n      var $hamburger = barMenu.find(\".menu_element--hamburger\");\n      var hiddenItemsCount;\n      var $hiddenItems = $($hamburger.find(\"ul\").get(0)).find(\"> li.k-item\");\n      var hiddenLeft = $hiddenItems.length;\n\n      if (barMenu.data(\"menu-opening\")) {\n        // Cannot redraw menu while menu is open because kendo failure occurs in touch device\n        return;\n      }\n      this.inhibitBarMenu();\n      $importantItemMenu.each(function wMenuComputeBarmenuWidth() {\n        barmenuWidth -= $(this).outerWidth();\n      });\n\n      barmenuWidth -= $hamburger.outerWidth();\n\n      if (barmenuWidth <= 0) {\n        return;\n      }\n\n      // When no scrollbar need to add hypothetic scrollbar width because no event to refresh when scrollbar appear\n      if (\n        window.document.documentElement.scrollHeight <=\n        window.document.documentElement.clientHeight\n      ) {\n        barmenuWidth -= this.getScrollBarWidth(); // Supposed that scrollbar width is max 20px\n      }\n\n      // Detect free menu available width  and record menu items which not contains to bar menu\n      $itemMenu.each(function wMenuComputeWidth() {\n        currentWidth += $(this).outerWidth();\n        if (currentWidth > barmenuWidth) {\n          $(this).data(\"original-width\", $(this).outerWidth());\n          newHiddens.push(this);\n        } else {\n          visibleWidth += $(this).outerWidth();\n        }\n      });\n\n      freeWidth = barmenuWidth - visibleWidth;\n\n      if (hiddenLeft === 0 && newHiddens.length === 1) {\n        // Special case for the last hidden may visible if hamburger is hide\n        if (\n          $(newHiddens[0]).outerWidth() <\n          freeWidth + $hamburger.outerWidth()\n        ) {\n          newHiddens = [];\n        }\n      }\n\n      // Move each new hidden menu to hamburger\n      _.each(newHiddens.reverse(), function wMenuItemToHamburger(item) {\n        // Prepend new menu to hamburger\n        if ($hamburger.find(\"li.k-item\").length === 0) {\n          kendoMenu.append($(item), $hamburger);\n        } else {\n          kendoMenu.insertBefore(\n            $(item),\n            $($hamburger.find(\"li.k-item\").get(0))\n          );\n        }\n      });\n      // No new hidden menu so ...\n      if (newHiddens.length === 0) {\n        // May be show hidden menu\n        $hiddenItems = $($hamburger.find(\"ul\").get(0)).find(\"> li.k-item\");\n        hiddenLeft = $hiddenItems.length;\n        $hiddenItems.each(function wMenuItemFromHamburger() {\n          if (freeWidth > 0) {\n            if (hiddenLeft === 1) {\n              freeWidth += $hamburger.width();\n            }\n            currentWidth = $(this).data(\"original-width\");\n\n            // If available width show move at initial place (right of the hamburger)\n            if (currentWidth < freeWidth) {\n              kendoMenu.insertBefore($(this), $hamburger);\n              freeWidth -= $(this).outerWidth();\n            } else {\n              freeWidth = -1; // stop test\n            }\n          }\n        });\n      }\n\n      // Number of items in hamburger\n      hiddenItemsCount = $($hamburger.find(\"ul\").get(0)).find(\"> li.k-item\")\n        .length;\n\n      // No view hamburger if empty\n      if (hiddenItemsCount === 0) {\n        $hamburger.hide();\n      }\n\n      // See sub-menu count\n      // $hamburger.find(\".menu--count\").text(hiddenItemsCount);\n\n      // View hamburger if not empty\n      if (newHiddens.length > 0) {\n        $hamburger.show();\n      }\n\n      // Restore css set by other resize callback\n      barMenu.css(\"overflow\", \"\").css(\"max-height\", \"\");\n    },\n\n    _insertMenuContent: function wMenuInsertMenuContent(\n      menus,\n      $content,\n      currentWidget,\n      scopeMenu\n    ) {\n      var subMenu;\n      var hasBeforeContent = false;\n      currentWidget = currentWidget || this;\n\n      if (scopeMenu) {\n        // Add fake before content if at least one element has before content to align all items\n        _.each(menus, function wMenuInsertMenuContentfake(currentMenu) {\n          if (currentMenu.iconUrl || currentMenu.beforeContent) {\n            hasBeforeContent = true;\n          }\n        });\n        if (hasBeforeContent) {\n          _.each(menus, function wMenuInsertMenuContentBeforeContent(\n            currentMenu\n          ) {\n            if (!currentMenu.iconUrl && !currentMenu.beforeContent) {\n              if (currentMenu.type !== \"separatorMenu\") {\n                currentMenu.beforeContent = \" \";\n              }\n            }\n          });\n        }\n      }\n\n      _.each(menus, function wMenuInsertMenuContentSet(currentMenu) {\n        var $currentMenu;\n        if (currentMenu.visibility === \"hidden\") {\n          return;\n        }\n        currentMenu.htmlAttr = [];\n        _.each(\n          currentMenu.htmlAttributes,\n          function wMenuInsertMenuContentSetHtml(attrValue, attrId) {\n            if (attrId === \"class\") {\n              currentMenu.cssClass = attrValue;\n            } else {\n              currentMenu.htmlAttr.push({\n                attrId: attrId,\n                attrValue: attrValue\n              });\n            }\n            if (currentMenu.htmlLabel) {\n              // reRender for variable labels\n              currentMenu.htmlLabel = Mustache.render(\n                currentMenu.htmlLabel || \"\",\n                { document: currentWidget.options.document }\n              );\n            }\n            if (currentMenu.label) {\n              // reRender for variable labels\n              currentMenu.label = Mustache.render(currentMenu.label || \"\", {\n                document: currentWidget.options.document\n              });\n            }\n            if (currentMenu.tooltipLabel) {\n              // reRender for variable labels\n              currentMenu.tooltipLabel = Mustache.render(\n                currentMenu.tooltipLabel || \"\",\n                { document: currentWidget.options.document }\n              );\n            }\n          }\n        );\n\n        currentMenu.contentLabel = currentMenu.htmlLabel || currentMenu.label;\n        currentMenu.disabled = currentMenu.visibility === \"disabled\";\n        if (currentMenu.type === \"listMenu\") {\n          subMenu = \"listMenu\";\n\n          $currentMenu = $(\n            Mustache.render(\n              currentWidget._getTemplate(subMenu) || \"\",\n              currentMenu\n            )\n          );\n          currentWidget._insertMenuContent(\n            currentMenu.content || \"\",\n            $currentMenu.find(\".listmenu__content\"),\n            currentWidget,\n            currentMenu\n          );\n        } else {\n          if (currentMenu.type === \"dynamicMenu\") {\n            subMenu = \"dynamicMenu\";\n            if (currentMenu.url) {\n              currentMenu.document = currentWidget.options.document;\n              currentMenu.url = Mustache.render(\n                currentMenu.url || \"\",\n                currentMenu\n              );\n            }\n            $currentMenu = $(\n              Mustache.render(\n                currentWidget._getTemplate(subMenu) || \"\",\n                currentMenu\n              )\n            );\n          } else {\n            currentMenu.document = currentWidget.options.document;\n            if (currentMenu.url) {\n              currentMenu.url = Mustache.render(\n                currentMenu.url || \"\",\n                currentMenu\n              );\n            }\n            $currentMenu = $(\n              Mustache.render(\n                currentWidget._getTemplate(currentMenu.type) || \"\",\n                currentMenu\n              )\n            );\n          }\n        }\n        if (currentMenu.tooltipLabel) {\n          currentWidget._tooltips.push(\n            $currentMenu.tooltip({\n              trigger: \"hover\",\n              html: currentMenu.tooltipHtml,\n              placement: currentMenu.tooltipPlacement\n                ? currentMenu.tooltipPlacement\n                : \"bottom\",\n              container: \".dcpDocument__menu\"\n            })\n          );\n        }\n        if (currentMenu.important) {\n          $currentMenu.addClass(\"menu--important\");\n        }\n        $currentMenu.data(\"menuConfiguration\", currentMenu);\n        $content.append($currentMenu);\n      });\n    },\n\n    _getTemplate: function wMenuTemplate(name) {\n      if (\n        this.options.templates &&\n        this.options.templates.menu &&\n        this.options.templates.menu[name]\n      ) {\n        return this.options.templates.menu[name];\n      }\n      if (\n        window.dcp.templates &&\n        window.dcp.templates.menu &&\n        window.dcp.templates.menu[name]\n      ) {\n        return window.dcp.templates.menu[name];\n      }\n      throw new Error(\"Menu unknown template \" + name);\n    },\n\n    _destroy: function wMenuDestroy() {\n      var kendoWidget = this.element.find(\".menu__content\").data(\"kendoMenu\");\n      if (kendoWidget) {\n        kendoWidget.destroy();\n      }\n      $(window).off(\".dcpMenu\");\n      _.each(this.popupWindows, function wMenuDestroyPopup(pWindow) {\n        pWindow.destroy();\n      });\n\n      _.each(this._tooltips, function wMenuDestroyTooltip(currentTooltip) {\n        currentTooltip.tooltip(\"dispose\");\n      });\n      this.element.empty();\n      this._super();\n    }\n  });\n}).apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiODdjMDkzNTZhMjJlYzg0MjkyYmIuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvQXBwcy9ET0NVTUVOVC9JSE0vd2lkZ2V0cy9tZW51L3dNZW51LmpzPzM2NDEiXSwic291cmNlc0NvbnRlbnQiOlsiZGVmaW5lKFtcbiAgXCJqcXVlcnlcIixcbiAgXCJ1bmRlcnNjb3JlXCIsXG4gIFwibXVzdGFjaGVcIixcbiAgXCJkY3BEb2N1bWVudC9pMThuL2RvY3VtZW50Q2F0YWxvZ1wiLFxuICBcImRjcERvY3VtZW50L3dpZGdldHMvd2lkZ2V0XCJcbl0sIGZ1bmN0aW9uIHdNZW51KCQsIF8sIE11c3RhY2hlLCBpMThuKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gICQud2lkZ2V0KFwiZGNwLmRjcE1lbnVcIiwge1xuICAgIG9wdGlvbnM6IHtcbiAgICAgIGV2ZW50UHJlZml4OiBcImRjcG1lbnVcIlxuICAgIH0sXG5cbiAgICBrZW5kb01lbnVXaWRnZXQ6IG51bGwsXG4gICAgX2NyZWF0ZTogZnVuY3Rpb24gd01lbnVDcmVhdGUoKSB7XG4gICAgICB0aGlzLl90b29sdGlwcyA9IFtdO1xuICAgICAgdGhpcy5wb3B1cFdpbmRvd3MgPSBbXTtcbiAgICAgIHRoaXMuX2luaXRTdHJ1Y3R1cmUoKTtcbiAgICB9LFxuXG4gICAgX2luaXRTdHJ1Y3R1cmU6IGZ1bmN0aW9uIHdNZW51SW5pdFN0cnVjdHVyZSgpIHtcbiAgICAgIHZhciAkY29udGVudCxcbiAgICAgICAgJG1haW5FbGVtZW50LFxuICAgICAgICBzY29wZVdpZGdldCA9IHRoaXM7XG4gICAgICAvL0luaXREb21cbiAgICAgICRtYWluRWxlbWVudCA9ICQoXG4gICAgICAgIE11c3RhY2hlLnJlbmRlcihcbiAgICAgICAgICB0aGlzLl9nZXRUZW1wbGF0ZShcIm1lbnVcIikgfHwgXCJcIixcbiAgICAgICAgICBfLmV4dGVuZCh7IHV1aWQ6IHRoaXMudXVpZCB9LCB0aGlzLm9wdGlvbnMpXG4gICAgICAgIClcbiAgICAgICk7XG4gICAgICAkY29udGVudCA9ICRtYWluRWxlbWVudC5maW5kKFwiLm1lbnVfX2NvbnRlbnRcIik7XG4gICAgICB0aGlzLl9pbnNlcnRNZW51Q29udGVudCh0aGlzLm9wdGlvbnMubWVudXMsICRjb250ZW50KTtcbiAgICAgIHRoaXMuZWxlbWVudC5hcHBlbmQoJG1haW5FbGVtZW50KTtcbiAgICAgIC8vSW5pdCBrZW5kbyB3aWRnZXRcbiAgICAgICRjb250ZW50LmtlbmRvTWVudSh7XG4gICAgICAgIG9wZW5PbkNsaWNrOiB0cnVlLFxuICAgICAgICBjbG9zZU9uQ2xpY2s6IHRydWUsXG5cbiAgICAgICAgc2VsZWN0OiBmdW5jdGlvbiB3TWVudVNlbGVjdChldmVudCkge1xuICAgICAgICAgIHZhciAkbWVudUVsZW1lbnQgPSAkKGV2ZW50Lml0ZW0pLFxuICAgICAgICAgICAgZXZlbnRDb250ZW50LFxuICAgICAgICAgICAgJGVsZW1lbnRBLFxuICAgICAgICAgICAgaHJlZixcbiAgICAgICAgICAgIGNvbmZpZ01lbnUsXG4gICAgICAgICAgICBjb25maXJtVGV4dCxcbiAgICAgICAgICAgIGNvbmZpcm1PcHRpb25zLFxuICAgICAgICAgICAgY29uZmlybURjcFdpbmRvdyxcbiAgICAgICAgICAgIHRhcmdldCxcbiAgICAgICAgICAgIHRhcmdldE9wdGlvbnMsXG4gICAgICAgICAgICBkY3BXaW5kb3csXG4gICAgICAgICAgICAkYm9keURpdixcbiAgICAgICAgICAgIHdGZWF0dXJlID0gXCJcIjtcblxuICAgICAgICAgIGlmICgkbWVudUVsZW1lbnQuaGFzQ2xhc3MoXCJtZW51X19lbGVtZW50LS1jYWxsYWJsZVwiKSkge1xuICAgICAgICAgICAgc2NvcGVXaWRnZXQuY2FsbE1lbnUoJG1lbnVFbGVtZW50KTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBVc2Ugc3BlY2lmaWMgc2VsZWN0IG9ubHkgZm9yIHRlcm1pbmFsIGl0ZW1zXG4gICAgICAgICAgaWYgKCEkbWVudUVsZW1lbnQuaGFzQ2xhc3MoXCJtZW51X19lbGVtZW50LS1pdGVtXCIpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgICRlbGVtZW50QSA9ICQoZXZlbnQuaXRlbSkuZmluZChcImFcIik7XG4gICAgICAgICAgaHJlZiA9ICRlbGVtZW50QS5kYXRhKFwidXJsXCIpO1xuICAgICAgICAgIC8vbm9pbnNwZWN0aW9uIEpTSGludFxuICAgICAgICAgIGlmIChocmVmICE9IFwiXCIpIHtcbiAgICAgICAgICAgIC8vRGlzcGxheSBjb25maXJtIG1lc3NhZ2VcbiAgICAgICAgICAgIGlmICgkZWxlbWVudEEuaGFzQ2xhc3MoXCJtZW51LS1jb25maXJtXCIpKSB7XG4gICAgICAgICAgICAgIGNvbmZpcm1UZXh0ID0gTXVzdGFjaGUucmVuZGVyKFxuICAgICAgICAgICAgICAgICRlbGVtZW50QS5kYXRhKFwiY29uZmlybS1tZXNzYWdlXCIpIHx8IFwiXCIsXG4gICAgICAgICAgICAgICAgc2NvcGVXaWRnZXQub3B0aW9uc1xuICAgICAgICAgICAgICApO1xuXG4gICAgICAgICAgICAgIGNvbmZpZ01lbnUgPSAkbWVudUVsZW1lbnQuZGF0YShcIm1lbnVDb25maWd1cmF0aW9uXCIpO1xuICAgICAgICAgICAgICBjb25maXJtT3B0aW9ucyA9IGNvbmZpZ01lbnUuY29uZmlybWF0aW9uT3B0aW9ucyB8fCB7fTtcbiAgICAgICAgICAgICAgY29uZmlybURjcFdpbmRvdyA9ICQoXCJib2R5XCIpLmRjcENvbmZpcm0oe1xuICAgICAgICAgICAgICAgIHRpdGxlOiBNdXN0YWNoZS5yZW5kZXIoXG4gICAgICAgICAgICAgICAgICBjb25maXJtT3B0aW9ucy50aXRsZSB8fCBcIlwiLFxuICAgICAgICAgICAgICAgICAgc2NvcGVXaWRnZXQub3B0aW9uc1xuICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgd2lkdGg6IGNvbmZpcm1PcHRpb25zLndpbmRvd1dpZHRoLFxuICAgICAgICAgICAgICAgIGhlaWdodDogY29uZmlybU9wdGlvbnMud2luZG93SGVpZ2h0LFxuICAgICAgICAgICAgICAgIG1lc3NhZ2VzOiB7XG4gICAgICAgICAgICAgICAgICBva01lc3NhZ2U6IE11c3RhY2hlLnJlbmRlcihcbiAgICAgICAgICAgICAgICAgICAgY29uZmlybU9wdGlvbnMuY29uZmlybUJ1dHRvbiB8fCBcIlwiLFxuICAgICAgICAgICAgICAgICAgICBzY29wZVdpZGdldC5vcHRpb25zXG4gICAgICAgICAgICAgICAgICApLFxuICAgICAgICAgICAgICAgICAgY2FuY2VsTWVzc2FnZTogTXVzdGFjaGUucmVuZGVyKFxuICAgICAgICAgICAgICAgICAgICBjb25maXJtT3B0aW9ucy5jYW5jZWxCdXR0b24gfHwgXCJcIixcbiAgICAgICAgICAgICAgICAgICAgc2NvcGVXaWRnZXQub3B0aW9uc1xuICAgICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgICAgIGh0bWxNZXNzYWdlOiBjb25maXJtVGV4dCxcbiAgICAgICAgICAgICAgICAgIHRleHRNZXNzYWdlOiBcIlwiXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBjb25maXJtOiBmdW5jdGlvbiB3TWVudUNvbmZpcm0oKSB7XG4gICAgICAgICAgICAgICAgICAkZWxlbWVudEEucmVtb3ZlQ2xhc3MoXCJtZW51LS1jb25maXJtXCIpO1xuICAgICAgICAgICAgICAgICAgJGVsZW1lbnRBLnRyaWdnZXIoXCJjbGlja1wiKTtcbiAgICAgICAgICAgICAgICAgICRlbGVtZW50QS5hZGRDbGFzcyhcIm1lbnUtLWNvbmZpcm1cIik7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZURhdGE6IHNjb3BlV2lkZ2V0Lm9wdGlvbnNcbiAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgc2NvcGVXaWRnZXQucG9wdXBXaW5kb3dzLnB1c2goY29uZmlybURjcFdpbmRvdy5kYXRhKFwiZGNwV2luZG93XCIpKTtcblxuICAgICAgICAgICAgICBjb25maXJtRGNwV2luZG93LmRhdGEoXCJkY3BXaW5kb3dcIikub3BlbigpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgc2NvcGVXaWRnZXQuZWxlbWVudC5kYXRhKFwibWVudS1vcGVuaW5nXCIsIGZhbHNlKTtcbiAgICAgICAgICAgICAgLy9pZiBocmVmIGlzIGV2ZW50IGtpbmQgcHJvcGFnYXRlIGV2ZW50IGluc3RlYWQgb2YgZGVmYXVsdCBiZWhhdmlvdXJcbiAgICAgICAgICAgICAgaWYgKGhyZWYuc3Vic3RyaW5nKDAsIDgpID09PSBcIiNhY3Rpb24vXCIpIHtcbiAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIGlmIChldmVudC5zdG9wUHJvcGFnYXRpb24pIHtcbiAgICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBldmVudENvbnRlbnQgPSBocmVmLnN1YnN0cmluZyg4KS5zcGxpdChcIjpcIik7XG4gICAgICAgICAgICAgICAgc2NvcGVXaWRnZXQuX3RyaWdnZXIoXCJleHRlcm5hbExpbmtTZWxlY3RlZFwiLCBldmVudCwge1xuICAgICAgICAgICAgICAgICAgdGFyZ2V0OiBldmVudC50YXJnZXQgfHwgZXZlbnQuaXRlbSxcbiAgICAgICAgICAgICAgICAgIGV2ZW50SWQ6IGV2ZW50Q29udGVudC5zaGlmdCgpLFxuICAgICAgICAgICAgICAgICAgb3B0aW9uczogZXZlbnRDb250ZW50XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdmFyICRiYXNlID0gJChcImJhc2VcIik7XG4gICAgICAgICAgICAgICAgdmFyIGlzQWJzVXJsID0gbmV3IFJlZ0V4cChcIl4oPzpbYS16XSs6KT8vL1wiLCBcImlcIik7XG5cbiAgICAgICAgICAgICAgICB0YXJnZXQgPSAkZWxlbWVudEEuYXR0cihcInRhcmdldFwiKSB8fCBcIl9zZWxmXCI7XG5cbiAgICAgICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgICAkZWxlbWVudEEuYXR0cihcImhyZWZcIikgJiZcbiAgICAgICAgICAgICAgICAgICRlbGVtZW50QS5hdHRyKFwiaHJlZlwiKS5zdWJzdHJpbmcoMCwgMSkgPT09IFwiI1wiXG4gICAgICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgICBocmVmID1cbiAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLnByb3RvY29sICtcbiAgICAgICAgICAgICAgICAgICAgXCIvL1wiICtcbiAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhvc3RuYW1lICtcbiAgICAgICAgICAgICAgICAgICAgKHdpbmRvdy5sb2NhdGlvbi5wb3J0ID8gXCI6XCIgKyB3aW5kb3cubG9jYXRpb24ucG9ydCA6IFwiXCIpICtcbiAgICAgICAgICAgICAgICAgICAgKHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZVxuICAgICAgICAgICAgICAgICAgICAgID8gd2luZG93LmxvY2F0aW9uLnBhdGhuYW1lXG4gICAgICAgICAgICAgICAgICAgICAgOiBcIi9cIikgK1xuICAgICAgICAgICAgICAgICAgICAod2luZG93LmxvY2F0aW9uLnNlYXJjaCA/IHdpbmRvdy5sb2NhdGlvbi5zZWFyY2ggOiBcIlwiKSArXG4gICAgICAgICAgICAgICAgICAgICRlbGVtZW50QS5hdHRyKFwiaHJlZlwiKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAodGFyZ2V0ID09PSBcIl9zZWxmXCIpIHtcbiAgICAgICAgICAgICAgICAgIC8vIEZvciBJRSA6IE5vdCBob25vciBiYXNlIGhyZWYgaW4gdGhpcyBjYXNlXG5cbiAgICAgICAgICAgICAgICAgIGlmICghaXNBYnNVcmwudGVzdChocmVmKSkge1xuICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9ICRiYXNlLmF0dHIoXCJocmVmXCIpICsgaHJlZjtcbiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gaHJlZjtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgY29uZmlnTWVudSA9ICRtZW51RWxlbWVudC5kYXRhKFwibWVudUNvbmZpZ3VyYXRpb25cIik7XG4gICAgICAgICAgICAgICAgICB0YXJnZXRPcHRpb25zID0gY29uZmlnTWVudS50YXJnZXRPcHRpb25zIHx8IHt9O1xuICAgICAgICAgICAgICAgICAgaWYgKHRhcmdldCA9PT0gXCJfZGlhbG9nXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgJGJvZHlEaXYgPSAkKFwiPGRpdi8+XCIpO1xuICAgICAgICAgICAgICAgICAgICAkKFwiYm9keVwiKS5hcHBlbmQoJGJvZHlEaXYpO1xuICAgICAgICAgICAgICAgICAgICBkY3BXaW5kb3cgPSAkYm9keURpdi5kY3BXaW5kb3coe1xuICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiBNdXN0YWNoZS5yZW5kZXIoXG4gICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXRPcHRpb25zLnRpdGxlIHx8IFwiXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZGNwLmRvY3VtZW50RGF0YVxuICAgICAgICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IHRhcmdldE9wdGlvbnMud2luZG93V2lkdGgsXG4gICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiB0YXJnZXRPcHRpb25zLndpbmRvd0hlaWdodCxcbiAgICAgICAgICAgICAgICAgICAgICBtb2RhbDogdGFyZ2V0T3B0aW9ucy5tb2RhbCxcbiAgICAgICAgICAgICAgICAgICAgICBjb250ZW50OiBocmVmLFxuICAgICAgICAgICAgICAgICAgICAgIGlmcmFtZTogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICBzY29wZVdpZGdldC5wb3B1cFdpbmRvd3MucHVzaChkY3BXaW5kb3cuZGF0YShcImRjcFdpbmRvd1wiKSk7XG4gICAgICAgICAgICAgICAgICAgIGRjcFdpbmRvd1xuICAgICAgICAgICAgICAgICAgICAgIC5kYXRhKFwiZGNwV2luZG93XCIpXG4gICAgICAgICAgICAgICAgICAgICAgLmtlbmRvV2luZG93KClcbiAgICAgICAgICAgICAgICAgICAgICAuY2VudGVyKCk7XG4gICAgICAgICAgICAgICAgICAgIGRjcFdpbmRvdy5kYXRhKFwiZGNwV2luZG93XCIpLm9wZW4oKTtcbiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgICAgICAgICB0YXJnZXRPcHRpb25zICYmXG4gICAgICAgICAgICAgICAgICAgICAgKHRhcmdldE9wdGlvbnMud2luZG93V2lkdGggfHwgdGFyZ2V0T3B0aW9ucy53aW5kb3dIZWlnaHQpXG4gICAgICAgICAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgICAgICAgIGlmICh0YXJnZXRPcHRpb25zLndpbmRvd1dpZHRoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3RmVhdHVyZSArPVxuICAgICAgICAgICAgICAgICAgICAgICAgICBcIndpZHRoPVwiICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VJbnQodGFyZ2V0T3B0aW9ucy53aW5kb3dXaWR0aCwgMTApICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgXCIsXCI7XG4gICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgIGlmICh0YXJnZXRPcHRpb25zLndpbmRvd0hlaWdodCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgd0ZlYXR1cmUgKz1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgXCJoZWlnaHQ9XCIgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJzZUludCh0YXJnZXRPcHRpb25zLndpbmRvd0hlaWdodCwgMTApICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgXCIsXCI7XG4gICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgIHdGZWF0dXJlICs9IFwicmVzaXphYmxlPXllcyxzY3JvbGxiYXJzPXllc1wiO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmICghaXNBYnNVcmwudGVzdChocmVmKSkge1xuICAgICAgICAgICAgICAgICAgICAgIC8vIEZvciBJRSA6IE5vdCBob25vciBiYXNlIGhyZWYgaW4gdGhpcyBjYXNlXG4gICAgICAgICAgICAgICAgICAgICAgaHJlZiA9ICRiYXNlLmF0dHIoXCJocmVmXCIpICsgaHJlZjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB3aW5kb3cub3BlbihocmVmLCB0YXJnZXQsIHdGZWF0dXJlKTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGRlYWN0aXZhdGU6IGZ1bmN0aW9uIHdNZW51RGVhY3RpdmF0ZShldmVudCkge1xuICAgICAgICAgIHZhciAkbWVudUVsZW1lbnQgPSAkKGV2ZW50Lml0ZW0pO1xuXG4gICAgICAgICAgLy8gVXNlIGZvciByZW9wZW4gZm9yIER5bmFtaWMgbWVudVxuICAgICAgICAgIGlmICgkbWVudUVsZW1lbnQuZGF0YShcIm1lbnUtb3BlbkFnYWluXCIpKSB7XG4gICAgICAgICAgICAkbWVudUVsZW1lbnQuZGF0YShcIm1lbnUtb3BlbkFnYWluXCIsIGZhbHNlKTtcbiAgICAgICAgICAgICRtZW51RWxlbWVudC5kYXRhKFwibWVudS1ub1F1ZXJ5XCIsIHRydWUpO1xuICAgICAgICAgICAgJGNvbnRlbnQuZGF0YShcImtlbmRvTWVudVwiKS5vcGVuKCRtZW51RWxlbWVudCk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBvcGVuOiBmdW5jdGlvbiB3TWVudU9wZW4oZXZlbnQpIHtcbiAgICAgICAgICB2YXIgJG1lbnVFbGVtZW50ID0gJChldmVudC5pdGVtKTtcblxuICAgICAgICAgIC8vIER1ZSB0byBpT3MgYXJ0ZWZhY3QsIGFuIHJlc2l6ZSBldmVudCBpcyBzZW5kLCBzbyBuZWVkIHRvIGluaGliYXRlZCBkdXJpbmcgb3BlbmluZyBtZW51XG4gICAgICAgICAgc2NvcGVXaWRnZXQuZWxlbWVudC5kYXRhKFwibWVudS1vcGVuaW5nXCIsIHRydWUpO1xuICAgICAgICAgICRtZW51RWxlbWVudC5kYXRhKFwiYm9keVdpZHRoXCIsICQoXCJib2R5XCIpLndpZHRoKCkpO1xuXG4gICAgICAgICAgaWYgKCEkbWVudUVsZW1lbnQuaGFzQ2xhc3MoXCJtZW51X19lbGVtZW50LS1pdGVtXCIpKSB7XG4gICAgICAgICAgICB2YXIgbWVudVVybCA9ICRtZW51RWxlbWVudC5kYXRhKFwibWVudS11cmxcIik7XG4gICAgICAgICAgICBpZiAobWVudVVybCkge1xuICAgICAgICAgICAgICAvLyBPcGVuIER5bmFtaWMgbWVudSA6IHJlcXVlc3Qgc2VydmVyIHRvIGdldCBtZW51IGNvbnRlbnRzXG4gICAgICAgICAgICAgIGlmICghJG1lbnVFbGVtZW50LmRhdGEoXCJtZW51LW5vUXVlcnlcIikpIHtcbiAgICAgICAgICAgICAgICB2YXIgbG9hZGluZyA9ICRtZW51RWxlbWVudC5maW5kKFwiLm1lbnVfX2xvYWRpbmdcIik7XG5cbiAgICAgICAgICAgICAgICBpZiAobG9hZGluZy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAvLyByZWNvcmQgaW5pdGlhbCBsb2FkaW5nIGl0ZW1cbiAgICAgICAgICAgICAgICAgICRtZW51RWxlbWVudC5kYXRhKFwibWVudS1sb2FkaW5nXCIsIGxvYWRpbmcpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIERpc3BsYXkgbG9hZGluZyBmaXJzdFxuICAgICAgICAgICAgICAgIGlmIChsb2FkaW5nLmxlbmd0aCA9PT0gMCAmJiAkbWVudUVsZW1lbnQuZGF0YShcIm1lbnUtbG9hZGluZ1wiKSkge1xuICAgICAgICAgICAgICAgICAgJG1lbnVFbGVtZW50XG4gICAgICAgICAgICAgICAgICAgIC5maW5kKFwiLmxpc3RtZW51X19jb250ZW50XCIpXG4gICAgICAgICAgICAgICAgICAgIC5odG1sKFwiXCIpXG4gICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJG1lbnVFbGVtZW50LmRhdGEoXCJtZW51LWxvYWRpbmdcIikpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIEdldCBzdWJNZW51XG4gICAgICAgICAgICAgICAgJC5nZXQobWVudVVybCwgZnVuY3Rpb24gd01lbnVEb25lKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IHJlc3BvbnNlLmRhdGE7XG4gICAgICAgICAgICAgICAgICAkbWVudUVsZW1lbnQuZmluZChcIi5saXN0bWVudV9fY29udGVudFwiKS5odG1sKFwiXCIpO1xuXG4gICAgICAgICAgICAgICAgICBzY29wZVdpZGdldC5faW5zZXJ0TWVudUNvbnRlbnQoXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuY29udGVudCxcbiAgICAgICAgICAgICAgICAgICAgJG1lbnVFbGVtZW50LmZpbmQoXCIubGlzdG1lbnVfX2NvbnRlbnRcIiksXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlV2lkZ2V0LFxuICAgICAgICAgICAgICAgICAgICAkbWVudUVsZW1lbnRcbiAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgICAkbWVudUVsZW1lbnQua2VuZG9NZW51KHtcbiAgICAgICAgICAgICAgICAgICAgb3Blbk9uQ2xpY2s6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGNsb3NlT25DbGljazogdHJ1ZVxuICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgICAgICAgcGFyc2VJbnQoXG4gICAgICAgICAgICAgICAgICAgICAgJG1lbnVFbGVtZW50LmZpbmQoXCIuay1hbmltYXRpb24tY29udGFpbmVyXCIpLmNzcyhcImxlZnRcIilcbiAgICAgICAgICAgICAgICAgICAgKSAhPT0gMCAmJlxuICAgICAgICAgICAgICAgICAgICBwYXJzZUludChcbiAgICAgICAgICAgICAgICAgICAgICAkbWVudUVsZW1lbnQuZmluZChcIi5rLWFuaW1hdGlvbi1jb250YWluZXJcIikuY3NzKFwicmlnaHRcIilcbiAgICAgICAgICAgICAgICAgICAgKSAhPT0gMFxuICAgICAgICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIE5lZWQgdG8gY2xvc2UgYW5kIHJlb3BlbiB0byBhZGp1c3QgcG9zaXRpb24gbWVudSBiZWNhdXNlIGNvbnRlbnQgaGFzIGNoYW5nZWRcbiAgICAgICAgICAgICAgICAgICAgJG1lbnVFbGVtZW50LmRhdGEoXCJtZW51LW9wZW5BZ2FpblwiLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgJGNvbnRlbnQuZGF0YShcImtlbmRvTWVudVwiKS5jbG9zZSgkbWVudUVsZW1lbnQpO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pLmZhaWwoZnVuY3Rpb24gd01lbnVGYWlsKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBlcnJvck1lc3NhZ2UgPSBkYXRhLnJlc3BvbnNlVGV4dDtcbiAgICAgICAgICAgICAgICAgICAgJG1lbnVFbGVtZW50LmZpbmQoXCIubGlzdG1lbnVfX2NvbnRlbnRcIikuaHRtbChcbiAgICAgICAgICAgICAgICAgICAgICAkKFwiPGRpdi8+XCIpXG4gICAgICAgICAgICAgICAgICAgICAgICAudGV4dChlcnJvck1lc3NhZ2UpXG4gICAgICAgICAgICAgICAgICAgICAgICAuYWRkQ2xhc3MoXCJtZW51LS1lcnJvclwiKVxuICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAod2luZG93LmRjcC5sb2dnZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZGNwLmxvZ2dlcihlKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgJG1lbnVFbGVtZW50LmRhdGEoXCJtZW51LW5vUXVlcnlcIiwgZmFsc2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgYWN0aXZhdGU6IGZ1bmN0aW9uIHdNZW51QWN0aXZhdGUoZXZlbnQpIHtcbiAgICAgICAgICAvLyBDb3JyZWN0IEtlbmRvIHBvc2l0aW9uIGxpc3Qgd2hlbiBzY3JvbGxiYXIgaXMgZGlzcGxheWVkXG4gICAgICAgICAgdmFyICRtZW51RWxlbWVudCA9ICQoZXZlbnQuaXRlbSk7XG4gICAgICAgICAgdmFyICRjb250YWluZXIgPSAkbWVudUVsZW1lbnQuZmluZChcIi5rLWFuaW1hdGlvbi1jb250YWluZXJcIik7XG5cbiAgICAgICAgICB2YXIgYm9keVdpZHRoID0gJG1lbnVFbGVtZW50LmRhdGEoXCJib2R5V2lkdGhcIik7XG4gICAgICAgICAgdmFyIG1lbnVXaWR0aCA9ICRtZW51RWxlbWVudC5vdXRlcldpZHRoKCk7XG4gICAgICAgICAgdmFyIG1lbnVMZWZ0ID0gJG1lbnVFbGVtZW50Lm9mZnNldCgpLmxlZnQ7XG4gICAgICAgICAgdmFyIGxpc3RXaWR0aCA9ICRjb250YWluZXIub3V0ZXJXaWR0aCgpO1xuICAgICAgICAgIHZhciBsaXN0TGVmdCA9ICRjb250YWluZXIub2Zmc2V0KCkubGVmdDtcblxuICAgICAgICAgIC8vIFRoZSBmaXJzdCBjb25kaXRpb24gaXMgZm9yIGlPUyBiZWNhdXNlIG5vIHNjcm9sbCB3aW5kb3cgZXhpc3RzXG4gICAgICAgICAgaWYgKFxuICAgICAgICAgICAgJChcImJvZHlcIikud2lkdGgoKSA+IGJvZHlXaWR0aCB8fFxuICAgICAgICAgICAgd2luZG93LmRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxIZWlnaHQgPlxuICAgICAgICAgICAgICB3aW5kb3cuZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodFxuICAgICAgICAgICkge1xuICAgICAgICAgICAgLy8gSWYgdGhlIGxpc3QgbWVudSBpcyBvdXQgb2YgdGhlIGJvZHkgYm94LCBuZWVkIHRvIG1vdmUgaXQgdG8gdGhlIHJpZ2h0XG4gICAgICAgICAgICBpZiAobGlzdExlZnQgKyBsaXN0V2lkdGggPiBib2R5V2lkdGgpIHtcbiAgICAgICAgICAgICAgJGNvbnRhaW5lclxuICAgICAgICAgICAgICAgIC5jc3MoXCJsZWZ0XCIsIFwiYXV0b1wiKVxuICAgICAgICAgICAgICAgIC5jc3MoXCJyaWdodFwiLCBtZW51TGVmdCAtIGJvZHlXaWR0aCArIG1lbnVXaWR0aCArIFwicHhcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgXy5kZWxheShmdW5jdGlvbiB3TWVudU9wZW5EZWxheSgpIHtcbiAgICAgICAgICAgIC8vIER1ZSB0byBpT3MgYXJ0ZWZhY3QsIGFuIHJlc2l6ZSBldmVudCBpcyBzZW5kLCBzbyBuZWVkIHRvIGluaGliYXRlZCBkdXJpbmcgb3BlbmluZyBtZW51XG4gICAgICAgICAgICBzY29wZVdpZGdldC5lbGVtZW50LmRhdGEoXCJtZW51LW9wZW5pbmdcIiwgZmFsc2UpO1xuICAgICAgICAgIH0sIDIwMDApO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgdGhpcy5lbGVtZW50XG4gICAgICAgIC5maW5kKFwiLm1lbnUtLWxlZnRcIilcbiAgICAgICAgLmxhc3QoKVxuICAgICAgICAuYWRkQ2xhc3MoXCJtZW51LS1sYXN0TGVmdFwiKTtcbiAgICAgIC8qKlxuICAgICAgICogRml4IG1lbnUgd2hlbiBubyBzZWUgaGVhZGVyXG4gICAgICAgKi9cbiAgICAgICQod2luZG93KS5vZmYoXCJzY3JvbGwuZGR1aVwiKTsgLy8gcmVzZXRcblxuICAgICAgaWYgKHRoaXMuZWxlbWVudC5wcm9wKFwibm9kZU5hbWVcIikudG9VcHBlckNhc2UoKSA9PT0gXCJOQVZcIikge1xuICAgICAgICAkKHdpbmRvdykub24oXCJzY3JvbGwuZGR1aVwiLCBmdW5jdGlvbiB3TWVudVNjcm9sbCgpIHtcbiAgICAgICAgICBpZiAoJCh3aW5kb3cpLnNjcm9sbFRvcCgpID4gJG1haW5FbGVtZW50LnBvc2l0aW9uKCkudG9wKSB7XG4gICAgICAgICAgICBpZiAoISRtYWluRWxlbWVudC5kYXRhKFwiaXNGaXhlZFwiKSkge1xuICAgICAgICAgICAgICAkbWFpbkVsZW1lbnQuZGF0YShcImlzRml4ZWRcIiwgXCIxXCIpO1xuICAgICAgICAgICAgICAkbWFpbkVsZW1lbnQucGFyZW50KCkuYWRkQ2xhc3MoXCJtZW51LS1maXhlZFwiKTtcbiAgICAgICAgICAgICAgJCh3aW5kb3cuZG9jdW1lbnQpLnRyaWdnZXIoXCJyZWRyYXdFcnJvck1lc3NhZ2VzXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAoJG1haW5FbGVtZW50LmRhdGEoXCJpc0ZpeGVkXCIpKSB7XG4gICAgICAgICAgICAgICRtYWluRWxlbWVudC5kYXRhKFwiaXNGaXhlZFwiLCBudWxsKTtcbiAgICAgICAgICAgICAgJG1haW5FbGVtZW50LnBhcmVudCgpLnJlbW92ZUNsYXNzKFwibWVudS0tZml4ZWRcIik7XG4gICAgICAgICAgICAgICQod2luZG93LmRvY3VtZW50KS50cmlnZ2VyKFwicmVkcmF3RXJyb3JNZXNzYWdlc1wiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgLyoqXG4gICAgICAgKiBSZXNwb25zaXZlIE1lbnVcbiAgICAgICAqL1xuICAgICAgdGhpcy5rZW5kb01lbnVXaWRnZXQgPSAkY29udGVudC5kYXRhKFwia2VuZG9NZW51XCIpO1xuICAgICAgdGhpcy5rZW5kb01lbnVXaWRnZXQuYXBwZW5kKFtcbiAgICAgICAge1xuICAgICAgICAgIHRleHQ6IGkxOG4uX19fKFwiT3RoZXJcIiwgXCJVSW1lbnVcIikgKyAnPHNwYW4gY2xhc3M9XCJtZW51LS1jb3VudFwiIC8+JyxcbiAgICAgICAgICBjc3NDbGFzczogXCJtZW51X19lbGVtZW50ICBtZW51X2VsZW1lbnQtLWhhbWJ1cmdlciBcIixcbiAgICAgICAgICBlbmNvZGVkOiBmYWxzZSwgLy8gQWxsb3dzIHVzZSBvZiBIVE1MIGZvciBpdGVtIHRleHRcbiAgICAgICAgICBpdGVtczogW10gLy8gTGlzdCBpdGVtc1xuICAgICAgICB9XG4gICAgICBdKTtcbiAgICAgICQod2luZG93KS5vbihcInJlc2l6ZS5kY3BNZW51XCIsIF8uYmluZCh0aGlzLmluaGliaXRCYXJNZW51LCB0aGlzKSk7XG4gICAgICAkKHdpbmRvdykub24oXG4gICAgICAgIFwicmVzaXplLmRjcE1lbnVcIixcbiAgICAgICAgXy5kZWJvdW5jZShfLmJpbmQodGhpcy51cGRhdGVSZXNwb25zaXZlTWVudSwgdGhpcyksIDEwMCwgZmFsc2UpXG4gICAgICApO1xuICAgIH0sXG5cbiAgICBjYWxsTWVudTogZnVuY3Rpb24gY2FsbE1lbnUoJG1lbnVJdGVtKSB7XG4gICAgICB2YXIgc2NvcGVXaWRnZXQgPSB0aGlzO1xuICAgICAgdmFyICRlbGVtZW50QSA9ICRtZW51SXRlbS5maW5kKFwiYVwiKTtcblxuICAgICAgJC5hamF4KHtcbiAgICAgICAgZGF0YVR5cGU6IFwianNvblwiLFxuICAgICAgICB1cmw6ICRlbGVtZW50QS5kYXRhKFwidXJsXCIpLFxuICAgICAgICBtZXRob2Q6ICRlbGVtZW50QS5kYXRhKFwibWV0aG9kXCIpXG4gICAgICB9KVxuICAgICAgICAudGhlbihmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgXy5lYWNoKGRhdGEubWVzc2FnZXMsIGZ1bmN0aW9uKG1zZykge1xuICAgICAgICAgICAgc2NvcGVXaWRnZXQuX3RyaWdnZXIoXCJzaG93TWVzc2FnZVwiLCBldmVudCwge1xuICAgICAgICAgICAgICB0aXRsZTogbXNnLmNvbnRlbnRUZXh0LFxuICAgICAgICAgICAgICB0eXBlOiBtc2cudHlwZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICBpZiAoZGF0YS5kYXRhLm5lZWRSZWxvYWQgPT09IHRydWUpIHtcbiAgICAgICAgICAgIF8uZGVsYXkoXG4gICAgICAgICAgICAgIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHNjb3BlV2lkZ2V0Ll90cmlnZ2VyKFwicmVsb2FkXCIsIGV2ZW50LCB7fSk7XG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIC8vIHdhaXQgMSBzZWNvbmQgdG8gc2VlIG1lc3NhZ2UgYmVmb3JlIHJlbG9hZFxuICAgICAgICAgICAgICBkYXRhLm1lc3NhZ2VzID8gMTAwMCA6IDBcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goZnVuY3Rpb24oaW5mbykge1xuICAgICAgICAgIHNjb3BlV2lkZ2V0Ll90cmlnZ2VyKFwic2hvd01lc3NhZ2VcIiwgZXZlbnQsIHtcbiAgICAgICAgICAgIHR5cGU6IFwiZXJyb3JcIixcbiAgICAgICAgICAgIG1lc3NhZ2U6XG4gICAgICAgICAgICAgIGluZm8ucmVzcG9uc2VKU09OLmVycm9yIHx8IGluZm8ucmVzcG9uc2VKU09OLmV4Y2VwdGlvbk1lc3NhZ2VcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIGluaGliaXRCYXJNZW51OiBmdW5jdGlvbiB3TWVudUluaGliaXRCYXJNZW51KCkge1xuICAgICAgdmFyIHdpZGdldE1lbnUgPSB0aGlzO1xuICAgICAgaWYgKFxuICAgICAgICAhd2lkZ2V0TWVudS5lbGVtZW50LmRhdGEoXCJtZW51LW9wZW5pbmdcIikgJiZcbiAgICAgICAgdGhpcy5lbGVtZW50LmNzcyhcIm92ZXJmbG93XCIpICE9PSBcImhpZGRlblwiXG4gICAgICApIHtcbiAgICAgICAgdGhpcy5lbGVtZW50XG4gICAgICAgICAgLmZpbmQoXCJsaS5rLXN0YXRlLWJvcmRlci1kb3duXCIpXG4gICAgICAgICAgLmVhY2goZnVuY3Rpb24gd01lbnVJbmhpYml0QmFyTWVudUNsb3NlKCkge1xuICAgICAgICAgICAgd2lkZ2V0TWVudS5rZW5kb01lbnVXaWRnZXQuY2xvc2UoJCh0aGlzKSk7XG4gICAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEdldCBzY3JvbGxiYXIgd2lkdGggYnkgYWRkaW5nIGEgZWxlbWVudFxuICAgICAqIEByZXR1cm5zIHtudW1iZXJ8Kn1cbiAgICAgKi9cbiAgICBnZXRTY3JvbGxCYXJXaWR0aDogZnVuY3Rpb24gd01lbnVnZXRTY3JvbGxCYXJXaWR0aCgpIHtcbiAgICAgIGlmICghdGhpcy5zY3JvbGxCYXJXaWR0aCkge1xuICAgICAgICB2YXIgaW5uZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwicFwiKTtcbiAgICAgICAgaW5uZXIuc3R5bGUud2lkdGggPSBcIjEwMCVcIjtcbiAgICAgICAgaW5uZXIuc3R5bGUuaGVpZ2h0ID0gXCIyMDBweFwiO1xuXG4gICAgICAgIHZhciBvdXRlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICAgIG91dGVyLnN0eWxlLnBvc2l0aW9uID0gXCJhYnNvbHV0ZVwiO1xuICAgICAgICBvdXRlci5zdHlsZS50b3AgPSBcIjBweFwiO1xuICAgICAgICBvdXRlci5zdHlsZS5sZWZ0ID0gXCIwcHhcIjtcbiAgICAgICAgb3V0ZXIuc3R5bGUudmlzaWJpbGl0eSA9IFwiaGlkZGVuXCI7XG4gICAgICAgIG91dGVyLnN0eWxlLndpZHRoID0gXCIyMDBweFwiO1xuICAgICAgICBvdXRlci5zdHlsZS5oZWlnaHQgPSBcIjE1MHB4XCI7XG4gICAgICAgIG91dGVyLnN0eWxlLm92ZXJmbG93ID0gXCJoaWRkZW5cIjtcbiAgICAgICAgb3V0ZXIuYXBwZW5kQ2hpbGQoaW5uZXIpO1xuXG4gICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQob3V0ZXIpO1xuICAgICAgICB2YXIgdzEgPSBpbm5lci5vZmZzZXRXaWR0aDtcbiAgICAgICAgb3V0ZXIuc3R5bGUub3ZlcmZsb3cgPSBcInNjcm9sbFwiO1xuICAgICAgICB2YXIgdzIgPSBpbm5lci5vZmZzZXRXaWR0aDtcbiAgICAgICAgaWYgKHcxID09PSB3Mikge1xuICAgICAgICAgIHcyID0gb3V0ZXIuY2xpZW50V2lkdGg7XG4gICAgICAgIH1cblxuICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKG91dGVyKTtcbiAgICAgICAgdGhpcy5zY3JvbGxCYXJXaWR0aCA9IHcxIC0gdzI7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0aGlzLnNjcm9sbEJhcldpZHRoO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBNb3ZlIG1lbnUgdG8gaGFtYnVyZ2VyIHdoaWNoIGNhbiBiZSBkaXNwbGF5ZWQgaW4gc2FtZSBsaW5lIG1lbnVcbiAgICAgKi9cbiAgICB1cGRhdGVSZXNwb25zaXZlTWVudTogZnVuY3Rpb24gd01lbnVIaWRlUmVzcG9uc2l2ZU1lbnUoKSB7XG4gICAgICB2YXIgYmFyTWVudSA9IHRoaXMuZWxlbWVudDtcbiAgICAgIHZhciAkaXRlbU1lbnUgPSBiYXJNZW51LmZpbmQoXG4gICAgICAgIFwidWwuay1tZW51ID4gLm1lbnVfX2VsZW1lbnQ6bm90KC5tZW51LS1pbXBvcnRhbnQsLm1lbnVfZWxlbWVudC0taGFtYnVyZ2VyKVwiXG4gICAgICApO1xuICAgICAgdmFyICRpbXBvcnRhbnRJdGVtTWVudSA9IGJhck1lbnUuZmluZChcbiAgICAgICAgXCJ1bC5rLW1lbnUgPiAubWVudV9fZWxlbWVudC5tZW51LS1pbXBvcnRhbnRcIlxuICAgICAgKTtcbiAgICAgIHZhciBuZXdIaWRkZW5zID0gW107XG4gICAgICB2YXIgY3VycmVudFdpZHRoID0gMDtcbiAgICAgIHZhciB2aXNpYmxlV2lkdGggPSAwO1xuICAgICAgdmFyIGZyZWVXaWR0aCA9IDA7XG4gICAgICB2YXIgYmFybWVudVdpZHRoID0gYmFyTWVudS53aWR0aCgpIC0gMjtcbiAgICAgIHZhciBrZW5kb01lbnUgPSB0aGlzLmtlbmRvTWVudVdpZGdldDtcbiAgICAgIHZhciAkaGFtYnVyZ2VyID0gYmFyTWVudS5maW5kKFwiLm1lbnVfZWxlbWVudC0taGFtYnVyZ2VyXCIpO1xuICAgICAgdmFyIGhpZGRlbkl0ZW1zQ291bnQ7XG4gICAgICB2YXIgJGhpZGRlbkl0ZW1zID0gJCgkaGFtYnVyZ2VyLmZpbmQoXCJ1bFwiKS5nZXQoMCkpLmZpbmQoXCI+IGxpLmstaXRlbVwiKTtcbiAgICAgIHZhciBoaWRkZW5MZWZ0ID0gJGhpZGRlbkl0ZW1zLmxlbmd0aDtcblxuICAgICAgaWYgKGJhck1lbnUuZGF0YShcIm1lbnUtb3BlbmluZ1wiKSkge1xuICAgICAgICAvLyBDYW5ub3QgcmVkcmF3IG1lbnUgd2hpbGUgbWVudSBpcyBvcGVuIGJlY2F1c2Uga2VuZG8gZmFpbHVyZSBvY2N1cnMgaW4gdG91Y2ggZGV2aWNlXG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHRoaXMuaW5oaWJpdEJhck1lbnUoKTtcbiAgICAgICRpbXBvcnRhbnRJdGVtTWVudS5lYWNoKGZ1bmN0aW9uIHdNZW51Q29tcHV0ZUJhcm1lbnVXaWR0aCgpIHtcbiAgICAgICAgYmFybWVudVdpZHRoIC09ICQodGhpcykub3V0ZXJXaWR0aCgpO1xuICAgICAgfSk7XG5cbiAgICAgIGJhcm1lbnVXaWR0aCAtPSAkaGFtYnVyZ2VyLm91dGVyV2lkdGgoKTtcblxuICAgICAgaWYgKGJhcm1lbnVXaWR0aCA8PSAwKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgLy8gV2hlbiBubyBzY3JvbGxiYXIgbmVlZCB0byBhZGQgaHlwb3RoZXRpYyBzY3JvbGxiYXIgd2lkdGggYmVjYXVzZSBubyBldmVudCB0byByZWZyZXNoIHdoZW4gc2Nyb2xsYmFyIGFwcGVhclxuICAgICAgaWYgKFxuICAgICAgICB3aW5kb3cuZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbEhlaWdodCA8PVxuICAgICAgICB3aW5kb3cuZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodFxuICAgICAgKSB7XG4gICAgICAgIGJhcm1lbnVXaWR0aCAtPSB0aGlzLmdldFNjcm9sbEJhcldpZHRoKCk7IC8vIFN1cHBvc2VkIHRoYXQgc2Nyb2xsYmFyIHdpZHRoIGlzIG1heCAyMHB4XG4gICAgICB9XG5cbiAgICAgIC8vIERldGVjdCBmcmVlIG1lbnUgYXZhaWxhYmxlIHdpZHRoICBhbmQgcmVjb3JkIG1lbnUgaXRlbXMgd2hpY2ggbm90IGNvbnRhaW5zIHRvIGJhciBtZW51XG4gICAgICAkaXRlbU1lbnUuZWFjaChmdW5jdGlvbiB3TWVudUNvbXB1dGVXaWR0aCgpIHtcbiAgICAgICAgY3VycmVudFdpZHRoICs9ICQodGhpcykub3V0ZXJXaWR0aCgpO1xuICAgICAgICBpZiAoY3VycmVudFdpZHRoID4gYmFybWVudVdpZHRoKSB7XG4gICAgICAgICAgJCh0aGlzKS5kYXRhKFwib3JpZ2luYWwtd2lkdGhcIiwgJCh0aGlzKS5vdXRlcldpZHRoKCkpO1xuICAgICAgICAgIG5ld0hpZGRlbnMucHVzaCh0aGlzKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB2aXNpYmxlV2lkdGggKz0gJCh0aGlzKS5vdXRlcldpZHRoKCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICBmcmVlV2lkdGggPSBiYXJtZW51V2lkdGggLSB2aXNpYmxlV2lkdGg7XG5cbiAgICAgIGlmIChoaWRkZW5MZWZ0ID09PSAwICYmIG5ld0hpZGRlbnMubGVuZ3RoID09PSAxKSB7XG4gICAgICAgIC8vIFNwZWNpYWwgY2FzZSBmb3IgdGhlIGxhc3QgaGlkZGVuIG1heSB2aXNpYmxlIGlmIGhhbWJ1cmdlciBpcyBoaWRlXG4gICAgICAgIGlmIChcbiAgICAgICAgICAkKG5ld0hpZGRlbnNbMF0pLm91dGVyV2lkdGgoKSA8XG4gICAgICAgICAgZnJlZVdpZHRoICsgJGhhbWJ1cmdlci5vdXRlcldpZHRoKClcbiAgICAgICAgKSB7XG4gICAgICAgICAgbmV3SGlkZGVucyA9IFtdO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIE1vdmUgZWFjaCBuZXcgaGlkZGVuIG1lbnUgdG8gaGFtYnVyZ2VyXG4gICAgICBfLmVhY2gobmV3SGlkZGVucy5yZXZlcnNlKCksIGZ1bmN0aW9uIHdNZW51SXRlbVRvSGFtYnVyZ2VyKGl0ZW0pIHtcbiAgICAgICAgLy8gUHJlcGVuZCBuZXcgbWVudSB0byBoYW1idXJnZXJcbiAgICAgICAgaWYgKCRoYW1idXJnZXIuZmluZChcImxpLmstaXRlbVwiKS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICBrZW5kb01lbnUuYXBwZW5kKCQoaXRlbSksICRoYW1idXJnZXIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGtlbmRvTWVudS5pbnNlcnRCZWZvcmUoXG4gICAgICAgICAgICAkKGl0ZW0pLFxuICAgICAgICAgICAgJCgkaGFtYnVyZ2VyLmZpbmQoXCJsaS5rLWl0ZW1cIikuZ2V0KDApKVxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgLy8gTm8gbmV3IGhpZGRlbiBtZW51IHNvIC4uLlxuICAgICAgaWYgKG5ld0hpZGRlbnMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIC8vIE1heSBiZSBzaG93IGhpZGRlbiBtZW51XG4gICAgICAgICRoaWRkZW5JdGVtcyA9ICQoJGhhbWJ1cmdlci5maW5kKFwidWxcIikuZ2V0KDApKS5maW5kKFwiPiBsaS5rLWl0ZW1cIik7XG4gICAgICAgIGhpZGRlbkxlZnQgPSAkaGlkZGVuSXRlbXMubGVuZ3RoO1xuICAgICAgICAkaGlkZGVuSXRlbXMuZWFjaChmdW5jdGlvbiB3TWVudUl0ZW1Gcm9tSGFtYnVyZ2VyKCkge1xuICAgICAgICAgIGlmIChmcmVlV2lkdGggPiAwKSB7XG4gICAgICAgICAgICBpZiAoaGlkZGVuTGVmdCA9PT0gMSkge1xuICAgICAgICAgICAgICBmcmVlV2lkdGggKz0gJGhhbWJ1cmdlci53aWR0aCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY3VycmVudFdpZHRoID0gJCh0aGlzKS5kYXRhKFwib3JpZ2luYWwtd2lkdGhcIik7XG5cbiAgICAgICAgICAgIC8vIElmIGF2YWlsYWJsZSB3aWR0aCBzaG93IG1vdmUgYXQgaW5pdGlhbCBwbGFjZSAocmlnaHQgb2YgdGhlIGhhbWJ1cmdlcilcbiAgICAgICAgICAgIGlmIChjdXJyZW50V2lkdGggPCBmcmVlV2lkdGgpIHtcbiAgICAgICAgICAgICAga2VuZG9NZW51Lmluc2VydEJlZm9yZSgkKHRoaXMpLCAkaGFtYnVyZ2VyKTtcbiAgICAgICAgICAgICAgZnJlZVdpZHRoIC09ICQodGhpcykub3V0ZXJXaWR0aCgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgZnJlZVdpZHRoID0gLTE7IC8vIHN0b3AgdGVzdFxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIE51bWJlciBvZiBpdGVtcyBpbiBoYW1idXJnZXJcbiAgICAgIGhpZGRlbkl0ZW1zQ291bnQgPSAkKCRoYW1idXJnZXIuZmluZChcInVsXCIpLmdldCgwKSkuZmluZChcIj4gbGkuay1pdGVtXCIpXG4gICAgICAgIC5sZW5ndGg7XG5cbiAgICAgIC8vIE5vIHZpZXcgaGFtYnVyZ2VyIGlmIGVtcHR5XG4gICAgICBpZiAoaGlkZGVuSXRlbXNDb3VudCA9PT0gMCkge1xuICAgICAgICAkaGFtYnVyZ2VyLmhpZGUoKTtcbiAgICAgIH1cblxuICAgICAgLy8gU2VlIHN1Yi1tZW51IGNvdW50XG4gICAgICAvLyAkaGFtYnVyZ2VyLmZpbmQoXCIubWVudS0tY291bnRcIikudGV4dChoaWRkZW5JdGVtc0NvdW50KTtcblxuICAgICAgLy8gVmlldyBoYW1idXJnZXIgaWYgbm90IGVtcHR5XG4gICAgICBpZiAobmV3SGlkZGVucy5sZW5ndGggPiAwKSB7XG4gICAgICAgICRoYW1idXJnZXIuc2hvdygpO1xuICAgICAgfVxuXG4gICAgICAvLyBSZXN0b3JlIGNzcyBzZXQgYnkgb3RoZXIgcmVzaXplIGNhbGxiYWNrXG4gICAgICBiYXJNZW51LmNzcyhcIm92ZXJmbG93XCIsIFwiXCIpLmNzcyhcIm1heC1oZWlnaHRcIiwgXCJcIik7XG4gICAgfSxcblxuICAgIF9pbnNlcnRNZW51Q29udGVudDogZnVuY3Rpb24gd01lbnVJbnNlcnRNZW51Q29udGVudChcbiAgICAgIG1lbnVzLFxuICAgICAgJGNvbnRlbnQsXG4gICAgICBjdXJyZW50V2lkZ2V0LFxuICAgICAgc2NvcGVNZW51XG4gICAgKSB7XG4gICAgICB2YXIgc3ViTWVudTtcbiAgICAgIHZhciBoYXNCZWZvcmVDb250ZW50ID0gZmFsc2U7XG4gICAgICBjdXJyZW50V2lkZ2V0ID0gY3VycmVudFdpZGdldCB8fCB0aGlzO1xuXG4gICAgICBpZiAoc2NvcGVNZW51KSB7XG4gICAgICAgIC8vIEFkZCBmYWtlIGJlZm9yZSBjb250ZW50IGlmIGF0IGxlYXN0IG9uZSBlbGVtZW50IGhhcyBiZWZvcmUgY29udGVudCB0byBhbGlnbiBhbGwgaXRlbXNcbiAgICAgICAgXy5lYWNoKG1lbnVzLCBmdW5jdGlvbiB3TWVudUluc2VydE1lbnVDb250ZW50ZmFrZShjdXJyZW50TWVudSkge1xuICAgICAgICAgIGlmIChjdXJyZW50TWVudS5pY29uVXJsIHx8IGN1cnJlbnRNZW51LmJlZm9yZUNvbnRlbnQpIHtcbiAgICAgICAgICAgIGhhc0JlZm9yZUNvbnRlbnQgPSB0cnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGlmIChoYXNCZWZvcmVDb250ZW50KSB7XG4gICAgICAgICAgXy5lYWNoKG1lbnVzLCBmdW5jdGlvbiB3TWVudUluc2VydE1lbnVDb250ZW50QmVmb3JlQ29udGVudChcbiAgICAgICAgICAgIGN1cnJlbnRNZW51XG4gICAgICAgICAgKSB7XG4gICAgICAgICAgICBpZiAoIWN1cnJlbnRNZW51Lmljb25VcmwgJiYgIWN1cnJlbnRNZW51LmJlZm9yZUNvbnRlbnQpIHtcbiAgICAgICAgICAgICAgaWYgKGN1cnJlbnRNZW51LnR5cGUgIT09IFwic2VwYXJhdG9yTWVudVwiKSB7XG4gICAgICAgICAgICAgICAgY3VycmVudE1lbnUuYmVmb3JlQ29udGVudCA9IFwiIFwiO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgXy5lYWNoKG1lbnVzLCBmdW5jdGlvbiB3TWVudUluc2VydE1lbnVDb250ZW50U2V0KGN1cnJlbnRNZW51KSB7XG4gICAgICAgIHZhciAkY3VycmVudE1lbnU7XG4gICAgICAgIGlmIChjdXJyZW50TWVudS52aXNpYmlsaXR5ID09PSBcImhpZGRlblwiKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGN1cnJlbnRNZW51Lmh0bWxBdHRyID0gW107XG4gICAgICAgIF8uZWFjaChcbiAgICAgICAgICBjdXJyZW50TWVudS5odG1sQXR0cmlidXRlcyxcbiAgICAgICAgICBmdW5jdGlvbiB3TWVudUluc2VydE1lbnVDb250ZW50U2V0SHRtbChhdHRyVmFsdWUsIGF0dHJJZCkge1xuICAgICAgICAgICAgaWYgKGF0dHJJZCA9PT0gXCJjbGFzc1wiKSB7XG4gICAgICAgICAgICAgIGN1cnJlbnRNZW51LmNzc0NsYXNzID0gYXR0clZhbHVlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgY3VycmVudE1lbnUuaHRtbEF0dHIucHVzaCh7XG4gICAgICAgICAgICAgICAgYXR0cklkOiBhdHRySWQsXG4gICAgICAgICAgICAgICAgYXR0clZhbHVlOiBhdHRyVmFsdWVcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoY3VycmVudE1lbnUuaHRtbExhYmVsKSB7XG4gICAgICAgICAgICAgIC8vIHJlUmVuZGVyIGZvciB2YXJpYWJsZSBsYWJlbHNcbiAgICAgICAgICAgICAgY3VycmVudE1lbnUuaHRtbExhYmVsID0gTXVzdGFjaGUucmVuZGVyKFxuICAgICAgICAgICAgICAgIGN1cnJlbnRNZW51Lmh0bWxMYWJlbCB8fCBcIlwiLFxuICAgICAgICAgICAgICAgIHsgZG9jdW1lbnQ6IGN1cnJlbnRXaWRnZXQub3B0aW9ucy5kb2N1bWVudCB9XG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoY3VycmVudE1lbnUubGFiZWwpIHtcbiAgICAgICAgICAgICAgLy8gcmVSZW5kZXIgZm9yIHZhcmlhYmxlIGxhYmVsc1xuICAgICAgICAgICAgICBjdXJyZW50TWVudS5sYWJlbCA9IE11c3RhY2hlLnJlbmRlcihjdXJyZW50TWVudS5sYWJlbCB8fCBcIlwiLCB7XG4gICAgICAgICAgICAgICAgZG9jdW1lbnQ6IGN1cnJlbnRXaWRnZXQub3B0aW9ucy5kb2N1bWVudFxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChjdXJyZW50TWVudS50b29sdGlwTGFiZWwpIHtcbiAgICAgICAgICAgICAgLy8gcmVSZW5kZXIgZm9yIHZhcmlhYmxlIGxhYmVsc1xuICAgICAgICAgICAgICBjdXJyZW50TWVudS50b29sdGlwTGFiZWwgPSBNdXN0YWNoZS5yZW5kZXIoXG4gICAgICAgICAgICAgICAgY3VycmVudE1lbnUudG9vbHRpcExhYmVsIHx8IFwiXCIsXG4gICAgICAgICAgICAgICAgeyBkb2N1bWVudDogY3VycmVudFdpZGdldC5vcHRpb25zLmRvY3VtZW50IH1cbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICk7XG5cbiAgICAgICAgY3VycmVudE1lbnUuY29udGVudExhYmVsID0gY3VycmVudE1lbnUuaHRtbExhYmVsIHx8IGN1cnJlbnRNZW51LmxhYmVsO1xuICAgICAgICBjdXJyZW50TWVudS5kaXNhYmxlZCA9IGN1cnJlbnRNZW51LnZpc2liaWxpdHkgPT09IFwiZGlzYWJsZWRcIjtcbiAgICAgICAgaWYgKGN1cnJlbnRNZW51LnR5cGUgPT09IFwibGlzdE1lbnVcIikge1xuICAgICAgICAgIHN1Yk1lbnUgPSBcImxpc3RNZW51XCI7XG5cbiAgICAgICAgICAkY3VycmVudE1lbnUgPSAkKFxuICAgICAgICAgICAgTXVzdGFjaGUucmVuZGVyKFxuICAgICAgICAgICAgICBjdXJyZW50V2lkZ2V0Ll9nZXRUZW1wbGF0ZShzdWJNZW51KSB8fCBcIlwiLFxuICAgICAgICAgICAgICBjdXJyZW50TWVudVxuICAgICAgICAgICAgKVxuICAgICAgICAgICk7XG4gICAgICAgICAgY3VycmVudFdpZGdldC5faW5zZXJ0TWVudUNvbnRlbnQoXG4gICAgICAgICAgICBjdXJyZW50TWVudS5jb250ZW50IHx8IFwiXCIsXG4gICAgICAgICAgICAkY3VycmVudE1lbnUuZmluZChcIi5saXN0bWVudV9fY29udGVudFwiKSxcbiAgICAgICAgICAgIGN1cnJlbnRXaWRnZXQsXG4gICAgICAgICAgICBjdXJyZW50TWVudVxuICAgICAgICAgICk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaWYgKGN1cnJlbnRNZW51LnR5cGUgPT09IFwiZHluYW1pY01lbnVcIikge1xuICAgICAgICAgICAgc3ViTWVudSA9IFwiZHluYW1pY01lbnVcIjtcbiAgICAgICAgICAgIGlmIChjdXJyZW50TWVudS51cmwpIHtcbiAgICAgICAgICAgICAgY3VycmVudE1lbnUuZG9jdW1lbnQgPSBjdXJyZW50V2lkZ2V0Lm9wdGlvbnMuZG9jdW1lbnQ7XG4gICAgICAgICAgICAgIGN1cnJlbnRNZW51LnVybCA9IE11c3RhY2hlLnJlbmRlcihcbiAgICAgICAgICAgICAgICBjdXJyZW50TWVudS51cmwgfHwgXCJcIixcbiAgICAgICAgICAgICAgICBjdXJyZW50TWVudVxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJGN1cnJlbnRNZW51ID0gJChcbiAgICAgICAgICAgICAgTXVzdGFjaGUucmVuZGVyKFxuICAgICAgICAgICAgICAgIGN1cnJlbnRXaWRnZXQuX2dldFRlbXBsYXRlKHN1Yk1lbnUpIHx8IFwiXCIsXG4gICAgICAgICAgICAgICAgY3VycmVudE1lbnVcbiAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY3VycmVudE1lbnUuZG9jdW1lbnQgPSBjdXJyZW50V2lkZ2V0Lm9wdGlvbnMuZG9jdW1lbnQ7XG4gICAgICAgICAgICBpZiAoY3VycmVudE1lbnUudXJsKSB7XG4gICAgICAgICAgICAgIGN1cnJlbnRNZW51LnVybCA9IE11c3RhY2hlLnJlbmRlcihcbiAgICAgICAgICAgICAgICBjdXJyZW50TWVudS51cmwgfHwgXCJcIixcbiAgICAgICAgICAgICAgICBjdXJyZW50TWVudVxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJGN1cnJlbnRNZW51ID0gJChcbiAgICAgICAgICAgICAgTXVzdGFjaGUucmVuZGVyKFxuICAgICAgICAgICAgICAgIGN1cnJlbnRXaWRnZXQuX2dldFRlbXBsYXRlKGN1cnJlbnRNZW51LnR5cGUpIHx8IFwiXCIsXG4gICAgICAgICAgICAgICAgY3VycmVudE1lbnVcbiAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGN1cnJlbnRNZW51LnRvb2x0aXBMYWJlbCkge1xuICAgICAgICAgIGN1cnJlbnRXaWRnZXQuX3Rvb2x0aXBzLnB1c2goXG4gICAgICAgICAgICAkY3VycmVudE1lbnUudG9vbHRpcCh7XG4gICAgICAgICAgICAgIHRyaWdnZXI6IFwiaG92ZXJcIixcbiAgICAgICAgICAgICAgaHRtbDogY3VycmVudE1lbnUudG9vbHRpcEh0bWwsXG4gICAgICAgICAgICAgIHBsYWNlbWVudDogY3VycmVudE1lbnUudG9vbHRpcFBsYWNlbWVudFxuICAgICAgICAgICAgICAgID8gY3VycmVudE1lbnUudG9vbHRpcFBsYWNlbWVudFxuICAgICAgICAgICAgICAgIDogXCJib3R0b21cIixcbiAgICAgICAgICAgICAgY29udGFpbmVyOiBcIi5kY3BEb2N1bWVudF9fbWVudVwiXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGN1cnJlbnRNZW51LmltcG9ydGFudCkge1xuICAgICAgICAgICRjdXJyZW50TWVudS5hZGRDbGFzcyhcIm1lbnUtLWltcG9ydGFudFwiKTtcbiAgICAgICAgfVxuICAgICAgICAkY3VycmVudE1lbnUuZGF0YShcIm1lbnVDb25maWd1cmF0aW9uXCIsIGN1cnJlbnRNZW51KTtcbiAgICAgICAgJGNvbnRlbnQuYXBwZW5kKCRjdXJyZW50TWVudSk7XG4gICAgICB9KTtcbiAgICB9LFxuXG4gICAgX2dldFRlbXBsYXRlOiBmdW5jdGlvbiB3TWVudVRlbXBsYXRlKG5hbWUpIHtcbiAgICAgIGlmIChcbiAgICAgICAgdGhpcy5vcHRpb25zLnRlbXBsYXRlcyAmJlxuICAgICAgICB0aGlzLm9wdGlvbnMudGVtcGxhdGVzLm1lbnUgJiZcbiAgICAgICAgdGhpcy5vcHRpb25zLnRlbXBsYXRlcy5tZW51W25hbWVdXG4gICAgICApIHtcbiAgICAgICAgcmV0dXJuIHRoaXMub3B0aW9ucy50ZW1wbGF0ZXMubWVudVtuYW1lXTtcbiAgICAgIH1cbiAgICAgIGlmIChcbiAgICAgICAgd2luZG93LmRjcC50ZW1wbGF0ZXMgJiZcbiAgICAgICAgd2luZG93LmRjcC50ZW1wbGF0ZXMubWVudSAmJlxuICAgICAgICB3aW5kb3cuZGNwLnRlbXBsYXRlcy5tZW51W25hbWVdXG4gICAgICApIHtcbiAgICAgICAgcmV0dXJuIHdpbmRvdy5kY3AudGVtcGxhdGVzLm1lbnVbbmFtZV07XG4gICAgICB9XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJNZW51IHVua25vd24gdGVtcGxhdGUgXCIgKyBuYW1lKTtcbiAgICB9LFxuXG4gICAgX2Rlc3Ryb3k6IGZ1bmN0aW9uIHdNZW51RGVzdHJveSgpIHtcbiAgICAgIHZhciBrZW5kb1dpZGdldCA9IHRoaXMuZWxlbWVudC5maW5kKFwiLm1lbnVfX2NvbnRlbnRcIikuZGF0YShcImtlbmRvTWVudVwiKTtcbiAgICAgIGlmIChrZW5kb1dpZGdldCkge1xuICAgICAgICBrZW5kb1dpZGdldC5kZXN0cm95KCk7XG4gICAgICB9XG4gICAgICAkKHdpbmRvdykub2ZmKFwiLmRjcE1lbnVcIik7XG4gICAgICBfLmVhY2godGhpcy5wb3B1cFdpbmRvd3MsIGZ1bmN0aW9uIHdNZW51RGVzdHJveVBvcHVwKHBXaW5kb3cpIHtcbiAgICAgICAgcFdpbmRvdy5kZXN0cm95KCk7XG4gICAgICB9KTtcblxuICAgICAgXy5lYWNoKHRoaXMuX3Rvb2x0aXBzLCBmdW5jdGlvbiB3TWVudURlc3Ryb3lUb29sdGlwKGN1cnJlbnRUb29sdGlwKSB7XG4gICAgICAgIGN1cnJlbnRUb29sdGlwLnRvb2x0aXAoXCJkaXNwb3NlXCIpO1xuICAgICAgfSk7XG4gICAgICB0aGlzLmVsZW1lbnQuZW1wdHkoKTtcbiAgICAgIHRoaXMuX3N1cGVyKCk7XG4gICAgfVxuICB9KTtcbn0pO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///87c09356a22ec84292bb\n");

/***/ }),

/***/ "8c1928b0f0f644cba374":
/*!***********************************************!*\
  !*** ./src/Apps/DOCUMENT/IHM/models/mMenu.js ***!
  \***********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/*global define*/\n!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(/*! underscore */ \"8e08e542008e4aef1f58\"), __webpack_require__(/*! backbone */ \"1858b45bf48591489d06\")], __WEBPACK_AMD_DEFINE_RESULT__ = (function mMenu(_, Backbone) {\n  \"use strict\";\n\n  return Backbone.Model.extend({\n    typeModel: \"ddui:menu\",\n    /**\n     * Menu model are not linked to REST element so always new\n     * @returns {boolean}\n     */\n    isNew: function mMenu_isNew() {\n      return true;\n    }\n  });\n}).apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiOGMxOTI4YjBmMGY2NDRjYmEzNzQuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvQXBwcy9ET0NVTUVOVC9JSE0vbW9kZWxzL21NZW51LmpzP2M1ZDEiXSwic291cmNlc0NvbnRlbnQiOlsiLypnbG9iYWwgZGVmaW5lKi9cbmRlZmluZShbXCJ1bmRlcnNjb3JlXCIsIFwiYmFja2JvbmVcIl0sIGZ1bmN0aW9uIG1NZW51KF8sIEJhY2tib25lKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIHJldHVybiBCYWNrYm9uZS5Nb2RlbC5leHRlbmQoe1xuICAgIHR5cGVNb2RlbDogXCJkZHVpOm1lbnVcIixcbiAgICAvKipcbiAgICAgKiBNZW51IG1vZGVsIGFyZSBub3QgbGlua2VkIHRvIFJFU1QgZWxlbWVudCBzbyBhbHdheXMgbmV3XG4gICAgICogQHJldHVybnMge2Jvb2xlYW59XG4gICAgICovXG4gICAgaXNOZXc6IGZ1bmN0aW9uIG1NZW51X2lzTmV3KCkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICB9KTtcbn0pO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///8c1928b0f0f644cba374\n");

/***/ }),

/***/ "8df78adf9774feae5b6e":
/*!****************************************************************!*\
  !*** ./src/Apps/DOCUMENT/IHM/widgets/attributes/enum/wEnum.js ***!
  \****************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/*global define */\n(function umdRequire(root, factory) {\n  \"use strict\";\n\n  if (true) {\n    !(__WEBPACK_AMD_DEFINE_ARRAY__ = [\n      __webpack_require__(/*! jquery */ \"127c8cf59f228bb01a21\"),\n      __webpack_require__(/*! underscore */ \"8e08e542008e4aef1f58\"),\n      __webpack_require__(/*! mustache */ \"bcd31d01884fc294fd69\"),\n      __webpack_require__(/*! dcpDocument/widgets/attributes/wAttribute */ \"d1cffa31e143773735c0\")\n    ], __WEBPACK_AMD_DEFINE_FACTORY__ = (factory),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?\n\t\t\t\t(__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n  } else {}\n})(window, function require_wenum($, _, Mustache) {\n  \"use strict\";\n\n  var localeCompareSupportsLocales = (function testLocaleCompareSupportsLocales() {\n    try {\n      \"foo\".localeCompare(\"bar\", \"i\");\n    } catch (e) {\n      return e.name === \"RangeError\";\n    }\n    return false;\n  })();\n\n  $.widget(\"dcp.dcpEnum\", $.dcp.dcpAttribute, {\n    options: {\n      type: \"enum\",\n      sourceValues: [], // [{key:\"the key\", label:\"the label\"}, ...}]\n      sourceUri: null, // when enum definition is dynamically get by server request\n      labels: {\n        invalidEntry: \"Invalid Entry\",\n        invertSelection: \"Click to answer {{displayValue}}\",\n        selectMessage: \"Select\",\n        unselectMessage: \"UnSelect\",\n        chooseAnotherChoice: \"Choose another choice\",\n        selectAnotherChoice: \"Select choice\",\n        displayOtherChoice: \"** {{value}} **\"\n      },\n      renderOptions: {\n        kendoDropDownConfiguration: {\n          filter: \"none\",\n          autoBind: true\n        },\n        kendoComboBoxConfiguration: {\n          filter: \"startswith\"\n        },\n        kendoMultiSelectConfiguration: {\n          filter: \"startswith\"\n        },\n        editDisplay: \"list\", // possible values are [\"list', 'vertical', 'horizontal', 'autoCompletion']'\n        useFirstChoice: false,\n        useSourceUri: false,\n        useOtherChoice: false,\n        placeHolder: \"Select\", // Message to display when no useFirstChoice is true and no value selected\n        orderBy: false\n      }\n    },\n    _initDom: function wEnumInitDom() {\n      var currentWidget = this;\n      if (\n        this.getMode() === \"write\" &&\n        this.options.renderOptions &&\n        this.options.renderOptions.orderBy\n      ) {\n        switch (this.options.renderOptions.orderBy) {\n          case \"key\":\n            if (this.options.sourceValues && this.options.sourceValues.sort) {\n              this.options.sourceValues = this.options.sourceValues.sort(\n                function wEnum_initDomSortKey(a, b) {\n                  if (a.key === b.key) {\n                    return 0;\n                  }\n                  return a.key < b.key ? -1 : 1;\n                }\n              );\n            }\n            break;\n          case \"label\":\n            if (this.options.sourceValues && this.options.sourceValues.sort) {\n              this.options.sourceValues = this.options.sourceValues.sort(\n                function wEnum_initDomSortLabel(a, b) {\n                  if (localeCompareSupportsLocales) {\n                    return String(a.label).localeCompare(\n                      String(b.label),\n                      currentWidget.options.locale,\n                      {\n                        numeric: true,\n                        caseFirst: false\n                      }\n                    );\n                  } else {\n                    return String(a.label).localeCompare(String(b.label));\n                  }\n                }\n              );\n            }\n            break;\n        }\n      }\n      if (this._isMultiple()) {\n        this.options.isMultiple = true;\n        _.each(this.options.attributeValue, function wEnumDisplayOthers(\n          singleValue\n        ) {\n          if (singleValue) {\n            singleValue.exists = singleValue.exists !== false;\n\n            if (singleValue.exists === false) {\n              singleValue.displayValue = Mustache.render(\n                currentWidget.options.labels.displayOtherChoice,\n                singleValue\n              );\n            }\n          }\n        });\n      } else {\n        if (this.options.attributeValue.exists === false) {\n          this.options.attributeValue.displayValue = Mustache.render(\n            this.options.labels.displayOtherChoice,\n            this.options.attributeValue\n          );\n        }\n      }\n\n      if (this.getMode() === \"read\") {\n        if (this._isMultiple()) {\n          this.options.attributeValues = _.toArray(this.options.attributeValue);\n          this.options.isMultiple = true;\n        } else {\n          this.options.attributeValues = [this.options.attributeValue];\n          this.options.isMultiple = false;\n        }\n        this._super();\n      }\n\n      if (this.getMode() === \"write\") {\n        if (this.options.options && this.options.options.eformat === \"auto\") {\n          this.options.renderOptions.useSourceUri = true;\n        }\n\n        if (this.options.renderOptions.useOtherChoice === true) {\n          this.options.otherUuid = _.uniqueId(\"enum\");\n        }\n        if (this.options.index >= 0) {\n          var enumIndex = this.element.closest(\"table\").data(\"enumIndex\");\n\n          if (!enumIndex) {\n            enumIndex = {};\n          }\n          if (!enumIndex[this.options.id]) {\n            enumIndex[this.options.id] = 0;\n          }\n          this.options.inArray = true;\n          this.options.enumIndex = enumIndex[this.options.id];\n          enumIndex[this.options.id]++;\n          this.element.closest(\"table\").data(\"enumIndex\", enumIndex);\n        }\n        this._initMainElementClass();\n        if (this._isMultiple()) {\n          switch (this.options.renderOptions.editDisplay) {\n            case \"autoCompletion\":\n            case \"list\":\n              this.multipleSelect();\n              break;\n            case \"horizontal\":\n            case \"vertical\":\n              this.checkboxButtons();\n              break;\n            case \"bool\":\n              throw new Error(\n                \"Enum bool display cannot be applied to a multiple attribute : \" +\n                  this.options.id\n              );\n            default:\n              this.multipleSelect();\n          }\n          this.element.on(\n            \"click\" + this.eventNamespace,\n            \".dcpAttribute__value--enum--button\",\n            function wEnumSelectClick(event) {\n              event.preventDefault();\n              currentWidget.kendoWidgetObject.search(\"\");\n            }\n          );\n        } else {\n          switch (this.options.renderOptions.editDisplay) {\n            case \"autoCompletion\":\n              this.singleCombobox();\n              break;\n            case \"list\":\n              this.singleDropdown();\n              break;\n            case \"bool\":\n              this.boolButtons();\n              break;\n            case \"horizontal\":\n            case \"vertical\":\n              this.radioButtons();\n              break;\n            default:\n              this.singleDropdown();\n          }\n        }\n      }\n\n      this.noButtonDisplay();\n    },\n    getSingleEnumData: function wEnumGetSingleEnumData() {\n      var source = [];\n      var scope = this;\n      var selectedIndex = -1;\n      var item;\n\n      if (this.options.renderOptions.useSourceUri) {\n        source = [this.options.attributeValue];\n        selectedIndex = this.options.attributeValue.value;\n      } else {\n        _.each(this.options.sourceValues, function wEnum_prepareValue(\n          enumItem\n        ) {\n          if (enumItem.key !== \"\" && enumItem.key !== \" \") {\n            item = {};\n\n            item.value = enumItem.key;\n            item.displayValue = enumItem.label || \"\";\n            item.exists = enumItem.exists !== false;\n            item.enumUuid = _.uniqueId(\"enum\");\n\n            // : no === because json encode use numeric cast when index is numeric\n            //noinspection JSHint\n            if (enumItem.key == scope.options.attributeValue.value) {\n              selectedIndex = source.length;\n              item.selected = true;\n            } else {\n              item.selected = false;\n            }\n\n            source.push(item);\n          }\n        });\n        if (\n          selectedIndex === -1 &&\n          this.options.attributeValue &&\n          !_.isUndefined(this.options.attributeValue.value) &&\n          this.options.attributeValue.value !== null\n        ) {\n          selectedIndex = source.length;\n          source.push({\n            value: this.options.attributeValue.value,\n            displayValue: this.options.attributeValue.displayValue || \"\",\n            selected: true,\n            exists: false,\n            enumUuid: _.uniqueId(\"enum\")\n          });\n        }\n      }\n\n      return { data: source, index: selectedIndex };\n    },\n\n    getMultipleEnumData: function wEnumGetMultipleEnumData() {\n      var source = [];\n      var selectedValues = [];\n      var isIn = false;\n      var item;\n      var values = [];\n\n      if (\n        this.options.attributeValue &&\n        this.options.attributeValue.value !== null\n      ) {\n        values = _.toArray(this.options.attributeValue);\n      }\n\n      if (this.options.renderOptions.useSourceUri) {\n        source = values;\n        selectedValues = _.pluck(values, \"value\");\n      } else {\n        _.each(this.options.sourceValues, function wEnum_prepareMultipleValue(\n          enumItem\n        ) {\n          item = {};\n          item.value = enumItem.key;\n          item.displayValue = enumItem.label || \"\";\n          item.selected = false;\n          item.exists = enumItem.exists !== false;\n          item.enumUuid = _.uniqueId(\"enum\");\n          isIn = _.some(values, function wEnum_findSelected(aValue) {\n            //noinspection JSHint\n            return aValue.value == enumItem.key;\n          });\n\n          // : no === because json encode use numeric cast when index is numeric\n          //noinspection JSHint\n          if (isIn) {\n            item.selected = true;\n          }\n\n          source.push(item);\n        });\n\n        _.each(values, function wEnum_addOtherValues(singleValue) {\n          if (singleValue.value !== null && singleValue.value !== \"\") {\n            if (singleValue.exists === false) {\n              item = {};\n              item.value = singleValue.value;\n              item.displayValue = singleValue.displayValue;\n              item.selected = true;\n              item.exists = false;\n              item.enumUuid = _.uniqueId(\"enum\");\n              source.push(item);\n            }\n            selectedValues.push(singleValue.value);\n          }\n        });\n      }\n\n      return {\n        data: source,\n        selectedValues: selectedValues\n      };\n    },\n\n    retrieveItems: function wEnumretrieveItemse(done) {\n      var scope = this,\n        requestData = {};\n\n      if (this.options.renderOptions.orderBy) {\n        requestData.orderBy = this.options.renderOptions.orderBy;\n      }\n\n      // Get enums data and defer render\n      $.ajax({\n        type: \"GET\",\n        url: this.options.sourceUri,\n        dataType: \"json\",\n        data: requestData\n      })\n        .done(function wEnum_retrieveDone(result) {\n          scope.options.sourceValues = result.data.enumItems;\n          scope.options.renderOptions.useSourceUri = false;\n          done(scope);\n        })\n        .fail(function wEnum_retrieveFail(response) {\n          $(\"body\").trigger(\"notification\", {\n            htmlMessage: \"Enumerate \" + scope.options.id,\n            message: response.statusText,\n            type: \"error\"\n          });\n        });\n    },\n\n    noButtonDisplay: function wEnumNoDisplayButton() {\n      if (\n        this.element.find(\".dcpAttribute__content__buttons button\").length === 0\n      ) {\n        this.element\n          .find(\".dcpAttribute__value--enumbuttons\")\n          .addClass(\"dcpAttribute__content__nobutton\");\n        this.element.find(\".dcpAttribute__content__buttons\").hide();\n      }\n    },\n\n    boolButtons: function wEnumBoolButtons() {\n      var enumData;\n      var tplOption = this.options;\n      var scope = this;\n\n      if (this.options.renderOptions.useSourceUri) {\n        this.retrieveItems(function wEnum_onRetrieveDone(theWidget) {\n          theWidget.boolButtons();\n        });\n        return;\n      }\n\n      enumData = this.getSingleEnumData();\n      tplOption.enumValues = enumData.data;\n\n      if (tplOption.enumValues.length > 1) {\n        tplOption.enumValues[0].off = true;\n        tplOption.enumValues[1].on = true;\n      }\n\n      this.options.isMultiple = true; // Just to have checkbox\n\n      this.options.renderOptions.useOtherChoice = false; // Always : no use this options\n      this.element.append(\n        Mustache.render(this._getTemplate(\"writeToggle\") || \"\", this.options)\n      );\n      this.options.isMultiple = false; // restore isMultiple : it never can be multiple\n\n      if (scope.options.labels.invertSelection) {\n        this.element\n          .find(\".dcpAttribute__value--toggle\")\n          .each(function wEnum_insertTooltip(kItem) {\n            if (tplOption.enumValues[kItem]) {\n              $(this).tooltip({\n                trigger: \"hover\",\n                container: scope.element,\n                title: Mustache.render(\n                  scope.options.labels.invertSelection || \"\",\n                  tplOption.enumValues[(kItem + 1) % 2]\n                )\n              });\n            }\n          });\n      }\n\n      this.noButtonDisplay();\n\n      this.element.on(\n        \"click\" + this.eventNamespace,\n        \".dcpAttribute__value--toggle\",\n        function wEnum_booleanClick(event) {\n          event.preventDefault();\n          // Invert selection\n          _.some(tplOption.enumValues, function wEnum_comboSetValue(item) {\n            if (\n              scope.options.attributeValue.value === null ||\n              item.value !== scope.options.attributeValue.value\n            ) {\n              scope.setValue(item, event);\n              return true;\n            }\n            return false;\n          });\n        }\n      );\n\n      this.getContentElements().each(function wEnum_addKButton() {\n        $(this)\n          .closest(\".dcpAttribute__value--enumlabel\")\n          .addClass(\"k-button\");\n      });\n      if (scope.options.attributeValue.value === null) {\n        // Set to first enum item if empty\n        var firstItem = tplOption.enumValues[0];\n        if (firstItem) {\n          scope.setValue({\n            value: firstItem.value,\n            displayValue: firstItem.displayValue\n          });\n        }\n      }\n    },\n    /**\n     * Identify the input where is the raw value\n     * @returns {*}\n     */\n    getContentElements: function wEnum_getContentElements() {\n      if (\n        this.options.inArray &&\n        (this.options.renderOptions.editDisplay === \"horizontal\" ||\n          this.options.renderOptions.editDisplay === \"vertical\" ||\n          this.options.renderOptions.editDisplay === \"bool\")\n      ) {\n        return this.element.find(\n          '.dcpAttribute__value[name=\"' +\n            this.options.id +\n            \"[\" +\n            this.options.enumIndex +\n            ']\"]'\n        );\n      } else {\n        return this._super();\n      }\n    },\n\n    radioButtons: function wEnumRadioButtons() {\n      var enumData;\n      var tplOption = this.options;\n      var labels;\n      var scope = this;\n      var hasNotExists;\n\n      if (this.options.renderOptions.useSourceUri) {\n        this.retrieveItems(function wEnum_retrieveDone(theWidget) {\n          theWidget.radioButtons();\n        });\n        return;\n      }\n\n      enumData = this.getSingleEnumData();\n\n      tplOption.enumValues = enumData.data;\n      hasNotExists = _.some(enumData.data, function wEnum_findNotExistItem(\n        item\n      ) {\n        return item.exists === false;\n      });\n\n      if (hasNotExists === true) {\n        // No set twice for radio\n        this.options.renderOptions.useOtherChoice = false;\n      }\n      this.element.append(\n        Mustache.render(this._getTemplate(\"writeRadio\") || \"\", this.options)\n      );\n      labels = this.element.find(\".dcpAttribute__value--enumlabel\");\n\n      this.noButtonDisplay();\n      labels.on(\n        \"change\" + this.eventNamespace,\n        \"input[type=radio]\",\n        function wEnum_onchange(event) {\n          var newValue = {};\n          newValue.value = $(this).val();\n          newValue.displayValue = $(this)\n            .closest(\".dcpAttribute__value--enumlabel\")\n            .find(\"label\")\n            .text()\n            .trim();\n          scope.setValue(newValue, event);\n        }\n      );\n\n      this.getContentElements().each(function wEnum_addKButton() {\n        $(this)\n          .closest(\"label\")\n          .addClass(\"k-button\");\n      });\n      if (\n        scope.options.renderOptions.useFirstChoice &&\n        scope.options.attributeValue.value === null\n      ) {\n        // Set to first enum item if empty\n        var firstItem = tplOption.enumValues[0];\n        if (firstItem) {\n          scope.setValue({\n            value: firstItem.value,\n            displayValue: firstItem.displayValue\n          });\n        }\n      }\n\n      if (scope.options.labels.selectMessage) {\n        this.element.find(\".dcpAttribute__value--enumbuttons\").tooltip({\n          container: \".dcpDocument\",\n          selector: \".dcpAttribute__value--enumlabel--text\",\n          trigger: \"hover\",\n          title: function wEnum_titleTooltip() {\n            if (\n              $(this)\n                .closest(\".dcpAttribute__value--enumlabel\")\n                .find(\"input\")\n                .prop(\"checked\")\n            ) {\n              return null;\n            } else {\n              return Mustache.render(scope.options.labels.selectMessage, {\n                displayValue: $(this).text(),\n                value: $(this)\n                  .parent()\n                  .find(\"input\")\n                  .val()\n              });\n            }\n          }\n        });\n      }\n\n      this._checkRadioOther();\n    },\n    checkboxButtons: function wEnumRadioButtons() {\n      var enumData;\n      var tplOption = this.options;\n      var scope = this;\n\n      if (this.options.renderOptions.useSourceUri) {\n        this.retrieveItems(function wEnum_onDone(theWidget) {\n          theWidget.checkboxButtons();\n        });\n        return;\n      }\n      enumData = this.getMultipleEnumData();\n      tplOption.enumValues = enumData.data;\n\n      this.element.append(\n        Mustache.render(this._getTemplate(\"writeRadio\") || \"\", this.options)\n      );\n\n      this.noButtonDisplay();\n      this.element.on(\n        \"change\" + this.eventNamespace,\n        \".dcpAttribute__value--enumlabel input[type=checkbox]\",\n        function wEnum_onChange(event) {\n          var newValue = [];\n\n          scope.getContentElements().each(function wEnum_findChecked() {\n            var $this = $(this);\n            if ($this.prop(\"checked\")) {\n              var itemValue = {};\n              itemValue.value = $this.val();\n              itemValue.displayValue = $this\n                .closest(\"label\")\n                .text()\n                .trim();\n              newValue.push(itemValue);\n            }\n          });\n\n          scope.setValue(newValue, event);\n        }\n      );\n\n      this.getContentElements().each(function wEnum_addKButton() {\n        $(this)\n          .closest(\"label\")\n          .addClass(\"k-button\");\n      });\n\n      if (this.options.labels.selectMessage) {\n        this.element.find(\".dcpAttribute__value--enumbuttons\").tooltip({\n          container: \".dcpDocument\",\n          selector: \".dcpAttribute__value--enumlabel--text\",\n          trigger: \"hover\",\n          title: function wEnum_Cb_titleTooltip() {\n            var $this = $(this);\n            if (\n              $this\n                .closest(\".dcpAttribute__value--enumlabel\")\n                .find(\"input\")\n                .prop(\"checked\")\n            ) {\n              return Mustache.render(scope.options.labels.unselectMessage, {\n                displayValue: $(this).text(),\n                value: $(this)\n                  .parent()\n                  .find(\"input\")\n                  .val()\n              });\n            } else {\n              return Mustache.render(scope.options.labels.selectMessage, {\n                displayValue: $(this).text(),\n                value: $(this)\n                  .parent()\n                  .find(\"input\")\n                  .val()\n              });\n            }\n          }\n        });\n      }\n      if (this.options.renderOptions.useOtherChoice === true) {\n        this._checkBoxOther();\n      }\n    },\n\n    /**\n     * Manage other input for radio\n     * @private\n     */\n    _checkRadioOther: function wEnum__checkRadioOther() {\n      this.element\n        .find(\".dcpAttribute__value--enum--other\")\n        .on(\n          \"focus\" + this.eventNamespace,\n          function wEnumRadioOtherInputClick() {\n            $(this).trigger(\"change\");\n          }\n        )\n        .on(\n          \"change\" + this.eventNamespace,\n          function wEnumRadioOtherInputChange() {\n            var $label = $(this).closest(\".dcpAttribute__value--enumlabel\");\n            var $input = $label.find(\".dcpAttribute__value--edit\");\n            $input.val($(this).val());\n            // Trigger change label input to real set value\n            $label.find(\"input[type=radio]\").trigger(\"change\");\n          }\n        )\n        .on(\n          \"keyup\" + this.eventNamespace,\n          function wEnumRadioOtherInputKeyReturn(event) {\n            var code = event.keyCode ? event.keyCode : event.which;\n            if (code === 13 || code === 10) {\n              $(this).blur();\n            }\n          }\n        );\n    },\n\n    /**\n     * Manage other input for checkbox\n     * @private\n     */\n    _checkBoxOther: function wEnum__checkBoxOther() {\n      this.element\n        .on(\n          \"focus\" + this.eventNamespace,\n          \".dcpAttribute__value--enum--other\",\n          function wEnumCheckOtherInputClick() {\n            $(this).trigger(\"change\");\n          }\n        )\n        .on(\n          \"change\" + this.eventNamespace,\n          \".dcpAttribute__value--enum--other\",\n          function wEnumCheckOtherInputChange() {\n            var $label = $(this).closest(\".dcpAttribute__value--enumlabel\");\n            var $input = $label.find(\".dcpAttribute__value--edit\");\n            var $hasEmpty;\n            var $checkbox = $label.find(\"input[type=checkbox]\");\n\n            $input.val($(this).val());\n\n            $hasEmpty = _.some(\n              $(this)\n                .closest(\".dcpAttribute__value--enumbuttons\")\n                .find(\".dcpAttribute__value--enum--other\"),\n              function wEnum_findEmptyOther(item) {\n                return $(item).val() === \"\";\n              }\n            );\n\n            if (!$hasEmpty) {\n              var $newOne = $label.clone();\n              var uuid = _.uniqueId(\"enum\");\n              $newOne.find(\"input[type=checkbox]\").attr(\"id\", uuid);\n              $newOne.find(\"label\").attr(\"for\", uuid);\n              // add new input if no one free found\n              $label.parent().append($newOne);\n              $newOne\n                .find(\"input\")\n                .val(\"\")\n                .prop(\"checked\", false);\n\n              if (!$checkbox.prop(\"checked\")) {\n                $label.find(\"label\").trigger(\"click\");\n              }\n            }\n            // resend change trigger because this hook is call before the checkbox onchange event\n            $checkbox.trigger(\"change\");\n          }\n        )\n        .on(\n          \"keyup\" + this.eventNamespace,\n          \".dcpAttribute__value--enum--other\",\n          function wEnumCheckOtherInputKeyReturn(event) {\n            var code = event.keyCode ? event.keyCode : event.which;\n            if (code === 13 || code === 10) {\n              $(this).blur(); // Change event will be triggered\n            }\n          }\n        );\n    },\n    singleDropdown: function wEnumSingleDropdown() {\n      var kendoOptions = this.getKendoOptions();\n      var kddl;\n      this.element.append(\n        Mustache.render(this._getTemplate(\"write\") || \"\", this.options)\n      );\n      this.kendoWidget = this.element.find(\".dcpAttribute__value--edit\");\n      kddl = this.kendoWidget\n        .kendoDropDownList(kendoOptions)\n        .data(\"kendoDropDownList\");\n      this.kendoWidgetObject = this.kendoWidget.data(\"kendoDrobDownList\");\n      kddl.list.find(\".k-list-optionlabel\").addClass(\"placeholder--clear\");\n    },\n    multipleSelect: function wEnumMultipleSelect() {\n      var kendoOptions = this.getKendoOptions();\n      this.element.append(\n        Mustache.render(this._getTemplate(\"write\") || \"\", this.options)\n      );\n      this.kendoWidget = this.element.find(\".dcpAttribute__value--edit\");\n      this.kendoWidget.kendoMultiSelect(kendoOptions);\n      this.kendoWidgetObject = this.kendoWidget.data(\"kendoMultiSelect\");\n    },\n\n    singleCombobox: function wEnumSingleCombobox() {\n      var kendoOptions = this.getKendoOptions();\n      var kddl;\n      var currentWidget = this;\n\n      this.element.append(\n        Mustache.render(this._getTemplate(\"write\") || \"\", this.options)\n      );\n      this.kendoWidget = this.element.find(\".dcpAttribute__value--edit\");\n\n      kddl = this.kendoWidget.kendoComboBox(kendoOptions).data(\"kendoComboBox\");\n\n      this.kendoWidgetObject = kddl;\n      if (this.options.renderOptions.useSourceUri) {\n        if (this.options.attributeValue.value === null) {\n          //kddl.dataSource.data([]);\n          kddl.value(\"\");\n        } else {\n          kddl.dataSource.data([this.options.attributeValue]);\n          kddl.value(this.options.attributeValue.value);\n        }\n      } else {\n        if (this.options.attributeValue.value) {\n          kddl.value(this.options.attributeValue.value);\n        }\n      }\n      this.element.on(\n        \"click\" + this.eventNamespace,\n        \".dcpAttribute__content__button--delete\",\n        function wEnumDeleteFilter() {\n          currentWidget.setError(null);\n          kddl.dataSource.filter({});\n          kddl.value(\"\");\n        }\n      );\n    },\n\n    /**\n     *Set new value to widget\n     * @param value value {value:...., displayValue} or array of {value:...., displayValue}\n     * @param event\n     */\n    setValue: function wEnumSetValue(value, event) {\n      var kddl, newValues;\n      var currentWidget = this;\n      if (this.options.renderOptions.editDisplay === \"bool\") {\n        // This display has only 2 values and cannot be set to null\n        if (value.value === null) {\n          if (this.options.enumValues[0]) {\n            value = this.options.enumValues[0];\n          }\n        }\n      }\n      this._super(value, event);\n      if (this.getMode() === \"write\") {\n        if (this._isMultiple()) {\n          switch (this.options.renderOptions.editDisplay) {\n            case \"autoCompletion\":\n            case \"list\":\n              kddl = this.kendoWidget.data(\"kendoMultiSelect\");\n              newValues = _.map(value, function wEnum_findValues(val) {\n                if (!currentWidget.options.renderOptions.useSourceUri) {\n                  if (!kddl.dataSource.get(val.value)) {\n                    kddl.dataSource.add(val);\n                  }\n                }\n                return val.value;\n              });\n              if (!_.isEqual(kddl.value(), newValues)) {\n                this.flashElement();\n                if (this.options.renderOptions.useSourceUri) {\n                  if (newValues.length > 0) {\n                    _.each(value, function wEnumCompleteExists(singleValue) {\n                      singleValue.exists = singleValue.exists !== false;\n                    });\n                    kddl.dataSource.data(value);\n                  }\n                }\n                kddl.value(newValues);\n              }\n              break;\n\n            case \"horizontal\":\n            case \"vertical\":\n              this.getContentElements().each(function wEnum_findValues() {\n                var $this = $(this);\n                var inputValue = $this.val();\n\n                var isIn = _.some(value, function wEnum_isIn(x) {\n                  //noinspection JSHint\n                  return x.value == inputValue;\n                });\n                if (isIn) {\n                  $this.prop(\"checked\", true);\n                  $this\n                    .closest(\".dcpAttribute__value--enumlabel\")\n                    .addClass(\"selected\");\n                } else {\n                  $this.prop(\"checked\", false);\n                  $this\n                    .closest(\".dcpAttribute__value--enumlabel\")\n                    .removeClass(\"selected\");\n                }\n              });\n\n              this.element\n                .find(\".dcpAttribute__value--enumlabel--text\")\n                .tooltip(\"hide\");\n              break;\n            default:\n              throw new Error(\n                \"Unknow Enum mode : \" + this.options.renderOptions.editDisplay\n              );\n          }\n        } else {\n          switch (this.options.renderOptions.editDisplay) {\n            case \"autoCompletion\":\n              kddl = this.kendoWidget.data(\"kendoComboBox\");\n              if (!_.isEqual(kddl.value(), value.value)) {\n                this.flashElement();\n\n                if (value.value !== null) {\n                  if (this.options.renderOptions.useSourceUri) {\n                    kddl.dataSource.data([value]);\n                  } else {\n                    if (!kddl.dataSource.get(value.value)) {\n                      kddl.dataSource.add(value);\n                    }\n                  }\n                  this.setError(null);\n                  kddl.value(value.value);\n                } else {\n                  kddl.value(\"\");\n                }\n              }\n              break;\n            case \"list\":\n              kddl = this.kendoWidget.data(\"kendoDropDownList\");\n\n              if (!_.isEqual(kddl.value(), value.value || \"\")) {\n                this.flashElement();\n                if (!kddl.dataSource.get(value.value)) {\n                  kddl.dataSource.add(value);\n                }\n\n                // kendo need empty string (not null) to clear input\n                kddl.value(value.value || \"\");\n              }\n              break;\n            case \"bool\":\n              this.getContentElements().each(function wEnum_parseElements() {\n                var $this = $(this);\n                var isOn;\n                //noinspection JSHint\n                if ($this.data(\"togglevalue\").toString() === value.value) {\n                  if (!$this.hasClass(\"selected\")) {\n                    if ($this.hasClass(\"on\")) {\n                      isOn = true;\n                      $this.removeClass(\"on\").addClass(\"off\");\n                    } else if ($this.hasClass(\"off\")) {\n                      $this.removeClass(\"off\").addClass(\"on\");\n                      isOn = false;\n                    }\n                    $this.addClass(\"selected\").removeClass(\"unselected\");\n\n                    _.defer(function wEnumAnimateBool() {\n                      if (isOn === true) {\n                        $this.addClass(\"on\").removeClass(\"off\");\n                      } else {\n                        $this.addClass(\"off\").removeClass(\"on\");\n                      }\n                    });\n                  }\n                } else {\n                  $this.removeClass(\"selected\").addClass(\"unselected\");\n                }\n              });\n              this.element\n                .find(\".dcpAttribute__value--enumlabel\")\n                .tooltip(\"hide\");\n\n              break;\n            case \"horizontal\":\n            case \"vertical\":\n              this.getContentElements().each(function wEnum_parseElements() {\n                var $this = $(this);\n                //noinspection JSHint\n                if ($this.val() == value.value) {\n                  $this.prop(\"checked\", true);\n                  $this\n                    .closest(\".dcpAttribute__value--enumlabel\")\n                    .addClass(\"selected\");\n                } else {\n                  $this.prop(\"checked\", false);\n                  $this\n                    .closest(\".dcpAttribute__value--enumlabel\")\n                    .removeClass(\"selected\");\n                }\n              });\n\n              this.element\n                .find(\".dcpAttribute__value--enumlabel--text\")\n                .tooltip(\"hide\");\n              break;\n            default:\n              throw new Error(\n                \"Unknow Enum mode : \" + this.options.renderOptions.editDisplay\n              );\n          }\n        }\n      } else {\n        this._super(value, event);\n        this.redraw();\n      }\n    },\n    /**\n     * method use for transport multiselect widget\n     * @param options\n     */\n    autocompleteRequestEnum: function wEnumAutocompleteRequestEnum(options) {\n      var requestData = {},\n        scope = this;\n\n      if (\n        options.data.filter &&\n        options.data.filter.filters &&\n        options.data.filter.filters.length > 0\n      ) {\n        requestData.keyword = options.data.filter.filters[0].value;\n        requestData.operator = options.data.filter.filters[0].operator;\n      }\n      if (this.options.renderOptions.orderBy) {\n        requestData.orderBy = this.options.renderOptions.orderBy;\n      }\n\n      if (!this.options.sourceUri) {\n        throw new Error(\n          \"Enum : sourceUri must be defined if renderOption useSourceUri is set to true\"\n        );\n      }\n      $.ajax({\n        type: \"GET\",\n        url: this.options.sourceUri,\n        data: requestData,\n        dataType: \"json\",\n        success: function wEnum_onAutoCompleteSuccess(result) {\n          var info = [];\n          _.each(result.data.enumItems, function wEnum_analyzeResult(enumItem) {\n            info.push({\n              value: enumItem.key,\n              displayValue: enumItem.label || \"\",\n              exists: enumItem.exists !== false\n            });\n          });\n          if (!scope._isMultiple()) {\n            if (scope.options.attributeValue.value !== null) {\n              if (\n                !_.contains(\n                  _.pluck(info, \"value\"),\n                  scope.options.attributeValue.value\n                )\n              ) {\n                if (\n                  scope.options.attributeValue.displayValue ===\n                  scope.options.attributeValue.value\n                ) {\n                  scope.options.attributeValue.displayValue = Mustache.render(\n                    scope.options.labels.displayOtherChoice,\n                    scope.options.attributeValue\n                  );\n                }\n                info.push(scope.options.attributeValue);\n              }\n            }\n          } else {\n            _.each(scope.options.attributeValue, function wEnumAddOtherInUri(\n              singleValue\n            ) {\n              var hasValue = _.some(info, function wEnumVerifyValue(\n                singleInfo\n              ) {\n                return singleInfo.value === singleValue.value;\n              });\n              if (!hasValue) {\n                info.push(singleValue);\n              }\n            });\n          }\n\n          // notify the data source that the request succeeded\n          options.success(info);\n        },\n        error: function wEnum_onAutoCompleteError(result) {\n          // notify the data source that the request failed\n          options.error(result);\n        }\n      });\n    },\n    /**\n     * Get kendo option from normal options and from renderOptions.kendoNumeric\n     * @returns {*}\n     */\n    getKendoOptions: function wEnumGetKendoOptions() {\n      var scope = this,\n        source = null,\n        kendoOptions = {},\n        defaultOptions = {};\n\n      if (this._isMultiple()) {\n        source = this.getMultipleEnumData();\n\n        defaultOptions = {\n          dataTextField: \"displayValue\",\n          dataValueField: \"value\",\n          clearButton: false,\n          dataSource: this.options.renderOptions.useSourceUri\n            ? source.data\n            : new kendo.data.DataSource({\n                data: source.data,\n                schema: { model: { id: \"value\" } }\n              }),\n          placeholder: this.options.renderOptions.placeHolder,\n          value: source.selectedValues,\n\n          change: function wEnum_onChange(event) {\n            event.preventDefault(); // no fire change event\n            // set in case of delete item\n\n            var kdData = _.toArray(\n              scope.kendoWidget.data(\"kendoMultiSelect\").dataItems()\n            );\n            var newValues = [];\n            _.each(kdData, function wEnum_pushNewValues(val) {\n              newValues.push({\n                value: val.value,\n                displayValue: val.displayValue,\n                exists: val.exists !== false\n              });\n            });\n            scope.setValue(newValues, event);\n          },\n          open: function wEnum_open(event) {\n            _.bind(scope._kOpen, scope, event, this)();\n          },\n          /**\n           * When other input is in list do not autoclose list to enter a new value\n           * @param event\n           */\n          close: function wEnum_multipleClose(event) {\n            _.bind(scope._kClose, scope, event, this)();\n          }\n        };\n\n        if (\n          _.isObject(scope.options.renderOptions.kendoMultiSelectConfiguration)\n        ) {\n          kendoOptions =\n            scope.options.renderOptions.kendoMultiSelectConfiguration;\n        }\n      } else {\n        source = this.getSingleEnumData();\n\n        defaultOptions = {\n          /*valuePrimitive: true,*/\n          dataTextField: \"displayValue\",\n          dataValueField: \"value\",\n          clearButton: false,\n          optionLabel: {\n            displayValue: this.options.renderOptions.placeHolder + \" \",\n            value: \"\",\n            exists: true\n          },\n          optionLabelTemplate:\n            '<span class=\"placeholder\">#: displayValue #</span>',\n          dataSource: this.options.renderOptions.useSourceUri\n            ? source.data\n            : new kendo.data.DataSource({\n                data: source.data,\n                schema: { model: { id: \"value\" } }\n              }),\n          index: source.index < 0 ? undefined : source.index,\n          autoBind: false,\n\n          change: function wEnum_onChange(event) {\n            if (this.value() && this.selectedIndex === -1) {\n              scope.setError(scope.options.labels.invalidEntry);\n              scope._getFocusInput().each(function wEnum_onChange() {\n                this.focus();\n              });\n            } else {\n              scope.setError(null);\n\n              var newValue = { value: this.value(), displayValue: this.text() };\n              scope.setValue(newValue, event);\n            }\n          },\n          dataBound: function wEnum_dataBound() {\n            if (\n              scope.options.renderOptions.useFirstChoice &&\n              scope.options.attributeValue.value === null\n            ) {\n              // Set to first enum item if empty\n              var firstItem = this.dataSource.at(0);\n              if (firstItem) {\n                scope.setValue({\n                  value: firstItem.value,\n                  displayValue: firstItem.displayValue\n                });\n              }\n            }\n          },\n          open: function wEnum_open(event) {\n            _.bind(scope._kOpen, scope, event, this)();\n          },\n          /**\n           * When other input is in list do not autoclose list to enter a new value\n           * @param event\n           */\n          close: function wEnum_close(event) {\n            _.bind(scope._kClose, scope, event, this)();\n          }\n        };\n\n        if (this.options.renderOptions.editDisplay === \"autoCompletion\") {\n          defaultOptions.index = -1;\n          defaultOptions.value = this.options.attributeValue.value;\n          defaultOptions.placeholder = this.options.renderOptions.placeHolder;\n\n          if (\n            _.isObject(scope.options.renderOptions.kendoComboBoxConfiguration)\n          ) {\n            kendoOptions =\n              scope.options.renderOptions.kendoComboBoxConfiguration;\n          }\n        } else {\n          if (\n            _.isObject(scope.options.renderOptions.kendoDropDownConfiguration)\n          ) {\n            kendoOptions =\n              scope.options.renderOptions.kendoDropDownConfiguration;\n          }\n        }\n      }\n\n      if (scope.options.renderOptions.useOtherChoice === true) {\n        // add \"other\" input in header list\n        defaultOptions.headerTemplate = $(\n          '<div><div class=\"dcpAttribute__value--enum-other\"><div class=\"input-group dcpAttribute__value--enum-other-content\">' +\n            '<input class=\"form-control\" type=\"text\" placeholder=\"' +\n            scope.options.labels.chooseAnotherChoice +\n            '\"/>' +\n            '<div class=\"input-group-append\"> <div class=\"input-group-text\">' +\n            '<button class=\"btn btn-primary dcpAttribute__value--enum-other-select\">' +\n            scope.options.labels.selectAnotherChoice +\n            \"</button></div> \" +\n            \"</div></div></div></div>\"\n        ).html();\n      }\n\n      if (this.options.renderOptions.useSourceUri) {\n        defaultOptions.dataSource = {\n          data: source.data,\n          index: source.index,\n          // type: \"json\",\n          serverFiltering: true,\n          minLength: 0,\n          transport: {\n            read: _.bind(scope.autocompleteRequestEnum, scope)\n          }\n        };\n      }\n      return _.extend(defaultOptions, kendoOptions);\n    },\n\n    _kSelectOther: function wEnumkSelect(event, kWidget, newValue) {\n      kWidget.dataSource.filter({});\n      if (this._isMultiple()) {\n        var kdData = _.toArray(kWidget.dataItems());\n        var newValues = [];\n\n        _.each(kdData, function wEnum_pushNewValues(val) {\n          newValues.push({\n            value: val.value,\n            displayValue: val.displayValue,\n            exists: val.exists\n          });\n        });\n\n        newValues.push({\n          value: newValue,\n          exists: false,\n          displayValue: Mustache.render(\n            this.options.labels.displayOtherChoice,\n            { value: newValue }\n          )\n        });\n\n        this.setValue(newValues, event);\n      } else {\n        this.setValue(\n          {\n            value: newValue,\n            exists: false,\n            displayValue: Mustache.render(\n              this.options.labels.displayOtherChoice,\n              { value: newValue }\n            )\n          },\n          event\n        );\n      }\n\n      $(\".dcpAttribute__value--enum-other input\").blur();\n      kWidget.close();\n    },\n\n    /**\n     * When other input is in list do not autoclose list to enter a new value\n     * @param event\n     * @param kWidget kendo widget\n     */\n    _kClose: function wEnumkClose(event, kWidget) {\n      if (this.options.renderOptions.useOtherChoice === true) {\n        var $otherInput = kWidget.ul\n          .closest(\".k-list-container\")\n          .find(\".dcpAttribute__value--enum-other\");\n        if (\n          $otherInput.data(\"dcpEnumOtherFirstClose\") !== false ||\n          $otherInput.find(\"input\").is(\":focus\")\n        ) {\n          event.preventDefault();\n          $otherInput.data(\"dcpEnumOtherFirstClose\", false);\n        }\n      }\n    },\n\n    _kOpen: function wEnumkOpen(event, kWidget) {\n      var scope = this;\n      /**\n       * Special events for \"other\" choice input\n       */\n      if (this.options.renderOptions.useOtherChoice === true) {\n        var $container = kWidget.ul.closest(\".k-list-container\");\n        var $otherInput = $container.find(\".dcpAttribute__value--enum-other\");\n\n        if (\n          $otherInput.length === 1 &&\n          $otherInput.data(\"dcpEnumOtherInitialized\") !== true\n        ) {\n          $otherInput.data(\"dcpEnumOtherInitialized\", true);\n          $otherInput\n            .find(\".dcpAttribute__value--enum-other-select\")\n            .prop(\"disabled\", true);\n          $container.prepend($otherInput);\n\n          $otherInput.on(\n            \"click\" + this.eventNamespace,\n            \"input\",\n            /**\n             * Apply setValue and close list when confirm button is clicked\n             * @param event\n             */\n            function wEnumSetOtherClick(event) {\n              event.preventDefault();\n              $(this).focus();\n              $(this).data(\"dcpEnumOtherHasFocus\", true);\n            }\n          );\n          $container.on(\n            \"click\" + this.eventNamespace,\n            \"li.k-item\",\n            /**\n             * Force close for \"normal\" choice because autoclose is disabled\n             */\n            function wEnumItemClick() {\n              var $input = $container.find(\n                \".dcpAttribute__value--enum-other input\"\n              );\n              $input.blur();\n              kWidget.close();\n            }\n          );\n\n          $otherInput.on(\n            \"keyup\" + this.eventNamespace,\n            \"input\",\n            /**\n             * Apply setValue and close list when return key is pressed\n             * @param event\n             */\n            function wEnumSetOtherKeyPress(event) {\n              var code = event.keyCode ? event.keyCode : event.which;\n              var $input = $container.find(\n                \".dcpAttribute__value--enum-other input\"\n              );\n              var newValue = $input.val();\n              if (code === 13 || code === 10) {\n                if (newValue) {\n                  _.bind(\n                    scope._kSelectOther,\n                    scope,\n                    event,\n                    kWidget,\n                    newValue\n                  )();\n                }\n              } else {\n                kWidget.search(newValue);\n              }\n              $otherInput\n                .find(\".dcpAttribute__value--enum-other-select\")\n                .prop(\"disabled\", !newValue);\n            }\n          );\n\n          $otherInput.on(\n            \"click\" + this.eventNamespace,\n            \".dcpAttribute__value--enum-other-select\",\n            function wEnumSetOtherClick(event) {\n              var $input = $container.find(\n                \".dcpAttribute__value--enum-other input\"\n              );\n              var newValue = $input.val();\n              if (newValue) {\n                _.bind(scope._kSelectOther, scope, event, kWidget, newValue)();\n              }\n            }\n          );\n        }\n\n        $container\n          .find(\".dcpAttribute__value--enum-other\")\n          .data(\"dcpEnumOtherFirstClose\", true);\n      }\n    },\n\n    close: function wEnum_close() {\n      if (this.kendoWidget && this.kendoWidget.data(\"kendoDropDownList\")) {\n        this.kendoWidget.data(\"kendoDropDownList\").close();\n      }\n      if (this.kendoWidget && this.kendoWidget.data(\"kendoComboBox\")) {\n        this.kendoWidget.data(\"kendoComboBox\").close();\n      }\n      if (this.kendoWidget && this.kendoWidget.data(\"kendoMultiSelect\")) {\n        this.kendoWidget.data(\"kendoMultiSelect\").close();\n      }\n      return this._super();\n    },\n\n    getType: function wEnum_getType() {\n      return \"enum\";\n    },\n\n    _destroy: function wEnum_destroy() {\n      if (this.kendoWidget && this.kendoWidget.data(\"kendoDropDownList\")) {\n        this.kendoWidget.data(\"kendoDropDownList\").destroy();\n      }\n      if (this.kendoWidget && this.kendoWidget.data(\"kendoComboBox\")) {\n        this.kendoWidget.data(\"kendoComboBox\").destroy();\n      }\n      if (this.kendoWidget && this.kendoWidget.data(\"kendoMultiSelect\")) {\n        this.kendoWidget.data(\"kendoMultiSelect\").destroy();\n      }\n      this._super();\n    }\n  });\n\n  return $.fn.dcpEnum;\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiOGRmNzhhZGY5Nzc0ZmVhZTViNmUuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvQXBwcy9ET0NVTUVOVC9JSE0vd2lkZ2V0cy9hdHRyaWJ1dGVzL2VudW0vd0VudW0uanM/Y2U1OSJdLCJzb3VyY2VzQ29udGVudCI6WyIvKmdsb2JhbCBkZWZpbmUgKi9cbihmdW5jdGlvbiB1bWRSZXF1aXJlKHJvb3QsIGZhY3RvcnkpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgaWYgKHR5cGVvZiBkZWZpbmUgPT09IFwiZnVuY3Rpb25cIiAmJiBkZWZpbmUuYW1kKSB7XG4gICAgZGVmaW5lKFtcbiAgICAgIFwianF1ZXJ5XCIsXG4gICAgICBcInVuZGVyc2NvcmVcIixcbiAgICAgIFwibXVzdGFjaGVcIixcbiAgICAgIFwiZGNwRG9jdW1lbnQvd2lkZ2V0cy9hdHRyaWJ1dGVzL3dBdHRyaWJ1dGVcIlxuICAgIF0sIGZhY3RvcnkpO1xuICB9IGVsc2Uge1xuICAgIC8vbm9pbnNwZWN0aW9uIEpTVW5yZXNvbHZlZFZhcmlhYmxlXG4gICAgZmFjdG9yeSh3aW5kb3cualF1ZXJ5LCB3aW5kb3cuXywgd2luZG93Lk11c3RhY2hlKTtcbiAgfVxufSkod2luZG93LCBmdW5jdGlvbiByZXF1aXJlX3dlbnVtKCQsIF8sIE11c3RhY2hlKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIHZhciBsb2NhbGVDb21wYXJlU3VwcG9ydHNMb2NhbGVzID0gKGZ1bmN0aW9uIHRlc3RMb2NhbGVDb21wYXJlU3VwcG9ydHNMb2NhbGVzKCkge1xuICAgIHRyeSB7XG4gICAgICBcImZvb1wiLmxvY2FsZUNvbXBhcmUoXCJiYXJcIiwgXCJpXCIpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIHJldHVybiBlLm5hbWUgPT09IFwiUmFuZ2VFcnJvclwiO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH0pKCk7XG5cbiAgJC53aWRnZXQoXCJkY3AuZGNwRW51bVwiLCAkLmRjcC5kY3BBdHRyaWJ1dGUsIHtcbiAgICBvcHRpb25zOiB7XG4gICAgICB0eXBlOiBcImVudW1cIixcbiAgICAgIHNvdXJjZVZhbHVlczogW10sIC8vIFt7a2V5OlwidGhlIGtleVwiLCBsYWJlbDpcInRoZSBsYWJlbFwifSwgLi4ufV1cbiAgICAgIHNvdXJjZVVyaTogbnVsbCwgLy8gd2hlbiBlbnVtIGRlZmluaXRpb24gaXMgZHluYW1pY2FsbHkgZ2V0IGJ5IHNlcnZlciByZXF1ZXN0XG4gICAgICBsYWJlbHM6IHtcbiAgICAgICAgaW52YWxpZEVudHJ5OiBcIkludmFsaWQgRW50cnlcIixcbiAgICAgICAgaW52ZXJ0U2VsZWN0aW9uOiBcIkNsaWNrIHRvIGFuc3dlciB7e2Rpc3BsYXlWYWx1ZX19XCIsXG4gICAgICAgIHNlbGVjdE1lc3NhZ2U6IFwiU2VsZWN0XCIsXG4gICAgICAgIHVuc2VsZWN0TWVzc2FnZTogXCJVblNlbGVjdFwiLFxuICAgICAgICBjaG9vc2VBbm90aGVyQ2hvaWNlOiBcIkNob29zZSBhbm90aGVyIGNob2ljZVwiLFxuICAgICAgICBzZWxlY3RBbm90aGVyQ2hvaWNlOiBcIlNlbGVjdCBjaG9pY2VcIixcbiAgICAgICAgZGlzcGxheU90aGVyQ2hvaWNlOiBcIioqIHt7dmFsdWV9fSAqKlwiXG4gICAgICB9LFxuICAgICAgcmVuZGVyT3B0aW9uczoge1xuICAgICAgICBrZW5kb0Ryb3BEb3duQ29uZmlndXJhdGlvbjoge1xuICAgICAgICAgIGZpbHRlcjogXCJub25lXCIsXG4gICAgICAgICAgYXV0b0JpbmQ6IHRydWVcbiAgICAgICAgfSxcbiAgICAgICAga2VuZG9Db21ib0JveENvbmZpZ3VyYXRpb246IHtcbiAgICAgICAgICBmaWx0ZXI6IFwic3RhcnRzd2l0aFwiXG4gICAgICAgIH0sXG4gICAgICAgIGtlbmRvTXVsdGlTZWxlY3RDb25maWd1cmF0aW9uOiB7XG4gICAgICAgICAgZmlsdGVyOiBcInN0YXJ0c3dpdGhcIlxuICAgICAgICB9LFxuICAgICAgICBlZGl0RGlzcGxheTogXCJsaXN0XCIsIC8vIHBvc3NpYmxlIHZhbHVlcyBhcmUgW1wibGlzdCcsICd2ZXJ0aWNhbCcsICdob3Jpem9udGFsJywgJ2F1dG9Db21wbGV0aW9uJ10nXG4gICAgICAgIHVzZUZpcnN0Q2hvaWNlOiBmYWxzZSxcbiAgICAgICAgdXNlU291cmNlVXJpOiBmYWxzZSxcbiAgICAgICAgdXNlT3RoZXJDaG9pY2U6IGZhbHNlLFxuICAgICAgICBwbGFjZUhvbGRlcjogXCJTZWxlY3RcIiwgLy8gTWVzc2FnZSB0byBkaXNwbGF5IHdoZW4gbm8gdXNlRmlyc3RDaG9pY2UgaXMgdHJ1ZSBhbmQgbm8gdmFsdWUgc2VsZWN0ZWRcbiAgICAgICAgb3JkZXJCeTogZmFsc2VcbiAgICAgIH1cbiAgICB9LFxuICAgIF9pbml0RG9tOiBmdW5jdGlvbiB3RW51bUluaXREb20oKSB7XG4gICAgICB2YXIgY3VycmVudFdpZGdldCA9IHRoaXM7XG4gICAgICBpZiAoXG4gICAgICAgIHRoaXMuZ2V0TW9kZSgpID09PSBcIndyaXRlXCIgJiZcbiAgICAgICAgdGhpcy5vcHRpb25zLnJlbmRlck9wdGlvbnMgJiZcbiAgICAgICAgdGhpcy5vcHRpb25zLnJlbmRlck9wdGlvbnMub3JkZXJCeVxuICAgICAgKSB7XG4gICAgICAgIHN3aXRjaCAodGhpcy5vcHRpb25zLnJlbmRlck9wdGlvbnMub3JkZXJCeSkge1xuICAgICAgICAgIGNhc2UgXCJrZXlcIjpcbiAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMuc291cmNlVmFsdWVzICYmIHRoaXMub3B0aW9ucy5zb3VyY2VWYWx1ZXMuc29ydCkge1xuICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMuc291cmNlVmFsdWVzID0gdGhpcy5vcHRpb25zLnNvdXJjZVZhbHVlcy5zb3J0KFxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHdFbnVtX2luaXREb21Tb3J0S2V5KGEsIGIpIHtcbiAgICAgICAgICAgICAgICAgIGlmIChhLmtleSA9PT0gYi5rZXkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICByZXR1cm4gYS5rZXkgPCBiLmtleSA/IC0xIDogMTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIFwibGFiZWxcIjpcbiAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMuc291cmNlVmFsdWVzICYmIHRoaXMub3B0aW9ucy5zb3VyY2VWYWx1ZXMuc29ydCkge1xuICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMuc291cmNlVmFsdWVzID0gdGhpcy5vcHRpb25zLnNvdXJjZVZhbHVlcy5zb3J0KFxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHdFbnVtX2luaXREb21Tb3J0TGFiZWwoYSwgYikge1xuICAgICAgICAgICAgICAgICAgaWYgKGxvY2FsZUNvbXBhcmVTdXBwb3J0c0xvY2FsZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFN0cmluZyhhLmxhYmVsKS5sb2NhbGVDb21wYXJlKFxuICAgICAgICAgICAgICAgICAgICAgIFN0cmluZyhiLmxhYmVsKSxcbiAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50V2lkZ2V0Lm9wdGlvbnMubG9jYWxlLFxuICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG51bWVyaWM6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlRmlyc3Q6IGZhbHNlXG4gICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFN0cmluZyhhLmxhYmVsKS5sb2NhbGVDb21wYXJlKFN0cmluZyhiLmxhYmVsKSk7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLl9pc011bHRpcGxlKCkpIHtcbiAgICAgICAgdGhpcy5vcHRpb25zLmlzTXVsdGlwbGUgPSB0cnVlO1xuICAgICAgICBfLmVhY2godGhpcy5vcHRpb25zLmF0dHJpYnV0ZVZhbHVlLCBmdW5jdGlvbiB3RW51bURpc3BsYXlPdGhlcnMoXG4gICAgICAgICAgc2luZ2xlVmFsdWVcbiAgICAgICAgKSB7XG4gICAgICAgICAgaWYgKHNpbmdsZVZhbHVlKSB7XG4gICAgICAgICAgICBzaW5nbGVWYWx1ZS5leGlzdHMgPSBzaW5nbGVWYWx1ZS5leGlzdHMgIT09IGZhbHNlO1xuXG4gICAgICAgICAgICBpZiAoc2luZ2xlVmFsdWUuZXhpc3RzID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICBzaW5nbGVWYWx1ZS5kaXNwbGF5VmFsdWUgPSBNdXN0YWNoZS5yZW5kZXIoXG4gICAgICAgICAgICAgICAgY3VycmVudFdpZGdldC5vcHRpb25zLmxhYmVscy5kaXNwbGF5T3RoZXJDaG9pY2UsXG4gICAgICAgICAgICAgICAgc2luZ2xlVmFsdWVcbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5hdHRyaWJ1dGVWYWx1ZS5leGlzdHMgPT09IGZhbHNlKSB7XG4gICAgICAgICAgdGhpcy5vcHRpb25zLmF0dHJpYnV0ZVZhbHVlLmRpc3BsYXlWYWx1ZSA9IE11c3RhY2hlLnJlbmRlcihcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucy5sYWJlbHMuZGlzcGxheU90aGVyQ2hvaWNlLFxuICAgICAgICAgICAgdGhpcy5vcHRpb25zLmF0dHJpYnV0ZVZhbHVlXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy5nZXRNb2RlKCkgPT09IFwicmVhZFwiKSB7XG4gICAgICAgIGlmICh0aGlzLl9pc011bHRpcGxlKCkpIHtcbiAgICAgICAgICB0aGlzLm9wdGlvbnMuYXR0cmlidXRlVmFsdWVzID0gXy50b0FycmF5KHRoaXMub3B0aW9ucy5hdHRyaWJ1dGVWYWx1ZSk7XG4gICAgICAgICAgdGhpcy5vcHRpb25zLmlzTXVsdGlwbGUgPSB0cnVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMub3B0aW9ucy5hdHRyaWJ1dGVWYWx1ZXMgPSBbdGhpcy5vcHRpb25zLmF0dHJpYnV0ZVZhbHVlXTtcbiAgICAgICAgICB0aGlzLm9wdGlvbnMuaXNNdWx0aXBsZSA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3N1cGVyKCk7XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLmdldE1vZGUoKSA9PT0gXCJ3cml0ZVwiKSB7XG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMub3B0aW9ucyAmJiB0aGlzLm9wdGlvbnMub3B0aW9ucy5lZm9ybWF0ID09PSBcImF1dG9cIikge1xuICAgICAgICAgIHRoaXMub3B0aW9ucy5yZW5kZXJPcHRpb25zLnVzZVNvdXJjZVVyaSA9IHRydWU7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5vcHRpb25zLnJlbmRlck9wdGlvbnMudXNlT3RoZXJDaG9pY2UgPT09IHRydWUpIHtcbiAgICAgICAgICB0aGlzLm9wdGlvbnMub3RoZXJVdWlkID0gXy51bmlxdWVJZChcImVudW1cIik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5pbmRleCA+PSAwKSB7XG4gICAgICAgICAgdmFyIGVudW1JbmRleCA9IHRoaXMuZWxlbWVudC5jbG9zZXN0KFwidGFibGVcIikuZGF0YShcImVudW1JbmRleFwiKTtcblxuICAgICAgICAgIGlmICghZW51bUluZGV4KSB7XG4gICAgICAgICAgICBlbnVtSW5kZXggPSB7fTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKCFlbnVtSW5kZXhbdGhpcy5vcHRpb25zLmlkXSkge1xuICAgICAgICAgICAgZW51bUluZGV4W3RoaXMub3B0aW9ucy5pZF0gPSAwO1xuICAgICAgICAgIH1cbiAgICAgICAgICB0aGlzLm9wdGlvbnMuaW5BcnJheSA9IHRydWU7XG4gICAgICAgICAgdGhpcy5vcHRpb25zLmVudW1JbmRleCA9IGVudW1JbmRleFt0aGlzLm9wdGlvbnMuaWRdO1xuICAgICAgICAgIGVudW1JbmRleFt0aGlzLm9wdGlvbnMuaWRdKys7XG4gICAgICAgICAgdGhpcy5lbGVtZW50LmNsb3Nlc3QoXCJ0YWJsZVwiKS5kYXRhKFwiZW51bUluZGV4XCIsIGVudW1JbmRleCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5faW5pdE1haW5FbGVtZW50Q2xhc3MoKTtcbiAgICAgICAgaWYgKHRoaXMuX2lzTXVsdGlwbGUoKSkge1xuICAgICAgICAgIHN3aXRjaCAodGhpcy5vcHRpb25zLnJlbmRlck9wdGlvbnMuZWRpdERpc3BsYXkpIHtcbiAgICAgICAgICAgIGNhc2UgXCJhdXRvQ29tcGxldGlvblwiOlxuICAgICAgICAgICAgY2FzZSBcImxpc3RcIjpcbiAgICAgICAgICAgICAgdGhpcy5tdWx0aXBsZVNlbGVjdCgpO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJob3Jpem9udGFsXCI6XG4gICAgICAgICAgICBjYXNlIFwidmVydGljYWxcIjpcbiAgICAgICAgICAgICAgdGhpcy5jaGVja2JveEJ1dHRvbnMoKTtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiYm9vbFwiOlxuICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgICAgICAgXCJFbnVtIGJvb2wgZGlzcGxheSBjYW5ub3QgYmUgYXBwbGllZCB0byBhIG11bHRpcGxlIGF0dHJpYnV0ZSA6IFwiICtcbiAgICAgICAgICAgICAgICAgIHRoaXMub3B0aW9ucy5pZFxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgdGhpcy5tdWx0aXBsZVNlbGVjdCgpO1xuICAgICAgICAgIH1cbiAgICAgICAgICB0aGlzLmVsZW1lbnQub24oXG4gICAgICAgICAgICBcImNsaWNrXCIgKyB0aGlzLmV2ZW50TmFtZXNwYWNlLFxuICAgICAgICAgICAgXCIuZGNwQXR0cmlidXRlX192YWx1ZS0tZW51bS0tYnV0dG9uXCIsXG4gICAgICAgICAgICBmdW5jdGlvbiB3RW51bVNlbGVjdENsaWNrKGV2ZW50KSB7XG4gICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgIGN1cnJlbnRXaWRnZXQua2VuZG9XaWRnZXRPYmplY3Quc2VhcmNoKFwiXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgc3dpdGNoICh0aGlzLm9wdGlvbnMucmVuZGVyT3B0aW9ucy5lZGl0RGlzcGxheSkge1xuICAgICAgICAgICAgY2FzZSBcImF1dG9Db21wbGV0aW9uXCI6XG4gICAgICAgICAgICAgIHRoaXMuc2luZ2xlQ29tYm9ib3goKTtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwibGlzdFwiOlxuICAgICAgICAgICAgICB0aGlzLnNpbmdsZURyb3Bkb3duKCk7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcImJvb2xcIjpcbiAgICAgICAgICAgICAgdGhpcy5ib29sQnV0dG9ucygpO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJob3Jpem9udGFsXCI6XG4gICAgICAgICAgICBjYXNlIFwidmVydGljYWxcIjpcbiAgICAgICAgICAgICAgdGhpcy5yYWRpb0J1dHRvbnMoKTtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICB0aGlzLnNpbmdsZURyb3Bkb3duKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHRoaXMubm9CdXR0b25EaXNwbGF5KCk7XG4gICAgfSxcbiAgICBnZXRTaW5nbGVFbnVtRGF0YTogZnVuY3Rpb24gd0VudW1HZXRTaW5nbGVFbnVtRGF0YSgpIHtcbiAgICAgIHZhciBzb3VyY2UgPSBbXTtcbiAgICAgIHZhciBzY29wZSA9IHRoaXM7XG4gICAgICB2YXIgc2VsZWN0ZWRJbmRleCA9IC0xO1xuICAgICAgdmFyIGl0ZW07XG5cbiAgICAgIGlmICh0aGlzLm9wdGlvbnMucmVuZGVyT3B0aW9ucy51c2VTb3VyY2VVcmkpIHtcbiAgICAgICAgc291cmNlID0gW3RoaXMub3B0aW9ucy5hdHRyaWJ1dGVWYWx1ZV07XG4gICAgICAgIHNlbGVjdGVkSW5kZXggPSB0aGlzLm9wdGlvbnMuYXR0cmlidXRlVmFsdWUudmFsdWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBfLmVhY2godGhpcy5vcHRpb25zLnNvdXJjZVZhbHVlcywgZnVuY3Rpb24gd0VudW1fcHJlcGFyZVZhbHVlKFxuICAgICAgICAgIGVudW1JdGVtXG4gICAgICAgICkge1xuICAgICAgICAgIGlmIChlbnVtSXRlbS5rZXkgIT09IFwiXCIgJiYgZW51bUl0ZW0ua2V5ICE9PSBcIiBcIikge1xuICAgICAgICAgICAgaXRlbSA9IHt9O1xuXG4gICAgICAgICAgICBpdGVtLnZhbHVlID0gZW51bUl0ZW0ua2V5O1xuICAgICAgICAgICAgaXRlbS5kaXNwbGF5VmFsdWUgPSBlbnVtSXRlbS5sYWJlbCB8fCBcIlwiO1xuICAgICAgICAgICAgaXRlbS5leGlzdHMgPSBlbnVtSXRlbS5leGlzdHMgIT09IGZhbHNlO1xuICAgICAgICAgICAgaXRlbS5lbnVtVXVpZCA9IF8udW5pcXVlSWQoXCJlbnVtXCIpO1xuXG4gICAgICAgICAgICAvLyA6IG5vID09PSBiZWNhdXNlIGpzb24gZW5jb2RlIHVzZSBudW1lcmljIGNhc3Qgd2hlbiBpbmRleCBpcyBudW1lcmljXG4gICAgICAgICAgICAvL25vaW5zcGVjdGlvbiBKU0hpbnRcbiAgICAgICAgICAgIGlmIChlbnVtSXRlbS5rZXkgPT0gc2NvcGUub3B0aW9ucy5hdHRyaWJ1dGVWYWx1ZS52YWx1ZSkge1xuICAgICAgICAgICAgICBzZWxlY3RlZEluZGV4ID0gc291cmNlLmxlbmd0aDtcbiAgICAgICAgICAgICAgaXRlbS5zZWxlY3RlZCA9IHRydWU7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBpdGVtLnNlbGVjdGVkID0gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHNvdXJjZS5wdXNoKGl0ZW0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGlmIChcbiAgICAgICAgICBzZWxlY3RlZEluZGV4ID09PSAtMSAmJlxuICAgICAgICAgIHRoaXMub3B0aW9ucy5hdHRyaWJ1dGVWYWx1ZSAmJlxuICAgICAgICAgICFfLmlzVW5kZWZpbmVkKHRoaXMub3B0aW9ucy5hdHRyaWJ1dGVWYWx1ZS52YWx1ZSkgJiZcbiAgICAgICAgICB0aGlzLm9wdGlvbnMuYXR0cmlidXRlVmFsdWUudmFsdWUgIT09IG51bGxcbiAgICAgICAgKSB7XG4gICAgICAgICAgc2VsZWN0ZWRJbmRleCA9IHNvdXJjZS5sZW5ndGg7XG4gICAgICAgICAgc291cmNlLnB1c2goe1xuICAgICAgICAgICAgdmFsdWU6IHRoaXMub3B0aW9ucy5hdHRyaWJ1dGVWYWx1ZS52YWx1ZSxcbiAgICAgICAgICAgIGRpc3BsYXlWYWx1ZTogdGhpcy5vcHRpb25zLmF0dHJpYnV0ZVZhbHVlLmRpc3BsYXlWYWx1ZSB8fCBcIlwiLFxuICAgICAgICAgICAgc2VsZWN0ZWQ6IHRydWUsXG4gICAgICAgICAgICBleGlzdHM6IGZhbHNlLFxuICAgICAgICAgICAgZW51bVV1aWQ6IF8udW5pcXVlSWQoXCJlbnVtXCIpXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHsgZGF0YTogc291cmNlLCBpbmRleDogc2VsZWN0ZWRJbmRleCB9O1xuICAgIH0sXG5cbiAgICBnZXRNdWx0aXBsZUVudW1EYXRhOiBmdW5jdGlvbiB3RW51bUdldE11bHRpcGxlRW51bURhdGEoKSB7XG4gICAgICB2YXIgc291cmNlID0gW107XG4gICAgICB2YXIgc2VsZWN0ZWRWYWx1ZXMgPSBbXTtcbiAgICAgIHZhciBpc0luID0gZmFsc2U7XG4gICAgICB2YXIgaXRlbTtcbiAgICAgIHZhciB2YWx1ZXMgPSBbXTtcblxuICAgICAgaWYgKFxuICAgICAgICB0aGlzLm9wdGlvbnMuYXR0cmlidXRlVmFsdWUgJiZcbiAgICAgICAgdGhpcy5vcHRpb25zLmF0dHJpYnV0ZVZhbHVlLnZhbHVlICE9PSBudWxsXG4gICAgICApIHtcbiAgICAgICAgdmFsdWVzID0gXy50b0FycmF5KHRoaXMub3B0aW9ucy5hdHRyaWJ1dGVWYWx1ZSk7XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLm9wdGlvbnMucmVuZGVyT3B0aW9ucy51c2VTb3VyY2VVcmkpIHtcbiAgICAgICAgc291cmNlID0gdmFsdWVzO1xuICAgICAgICBzZWxlY3RlZFZhbHVlcyA9IF8ucGx1Y2sodmFsdWVzLCBcInZhbHVlXCIpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgXy5lYWNoKHRoaXMub3B0aW9ucy5zb3VyY2VWYWx1ZXMsIGZ1bmN0aW9uIHdFbnVtX3ByZXBhcmVNdWx0aXBsZVZhbHVlKFxuICAgICAgICAgIGVudW1JdGVtXG4gICAgICAgICkge1xuICAgICAgICAgIGl0ZW0gPSB7fTtcbiAgICAgICAgICBpdGVtLnZhbHVlID0gZW51bUl0ZW0ua2V5O1xuICAgICAgICAgIGl0ZW0uZGlzcGxheVZhbHVlID0gZW51bUl0ZW0ubGFiZWwgfHwgXCJcIjtcbiAgICAgICAgICBpdGVtLnNlbGVjdGVkID0gZmFsc2U7XG4gICAgICAgICAgaXRlbS5leGlzdHMgPSBlbnVtSXRlbS5leGlzdHMgIT09IGZhbHNlO1xuICAgICAgICAgIGl0ZW0uZW51bVV1aWQgPSBfLnVuaXF1ZUlkKFwiZW51bVwiKTtcbiAgICAgICAgICBpc0luID0gXy5zb21lKHZhbHVlcywgZnVuY3Rpb24gd0VudW1fZmluZFNlbGVjdGVkKGFWYWx1ZSkge1xuICAgICAgICAgICAgLy9ub2luc3BlY3Rpb24gSlNIaW50XG4gICAgICAgICAgICByZXR1cm4gYVZhbHVlLnZhbHVlID09IGVudW1JdGVtLmtleTtcbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIC8vIDogbm8gPT09IGJlY2F1c2UganNvbiBlbmNvZGUgdXNlIG51bWVyaWMgY2FzdCB3aGVuIGluZGV4IGlzIG51bWVyaWNcbiAgICAgICAgICAvL25vaW5zcGVjdGlvbiBKU0hpbnRcbiAgICAgICAgICBpZiAoaXNJbikge1xuICAgICAgICAgICAgaXRlbS5zZWxlY3RlZCA9IHRydWU7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgc291cmNlLnB1c2goaXRlbSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIF8uZWFjaCh2YWx1ZXMsIGZ1bmN0aW9uIHdFbnVtX2FkZE90aGVyVmFsdWVzKHNpbmdsZVZhbHVlKSB7XG4gICAgICAgICAgaWYgKHNpbmdsZVZhbHVlLnZhbHVlICE9PSBudWxsICYmIHNpbmdsZVZhbHVlLnZhbHVlICE9PSBcIlwiKSB7XG4gICAgICAgICAgICBpZiAoc2luZ2xlVmFsdWUuZXhpc3RzID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICBpdGVtID0ge307XG4gICAgICAgICAgICAgIGl0ZW0udmFsdWUgPSBzaW5nbGVWYWx1ZS52YWx1ZTtcbiAgICAgICAgICAgICAgaXRlbS5kaXNwbGF5VmFsdWUgPSBzaW5nbGVWYWx1ZS5kaXNwbGF5VmFsdWU7XG4gICAgICAgICAgICAgIGl0ZW0uc2VsZWN0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgICBpdGVtLmV4aXN0cyA9IGZhbHNlO1xuICAgICAgICAgICAgICBpdGVtLmVudW1VdWlkID0gXy51bmlxdWVJZChcImVudW1cIik7XG4gICAgICAgICAgICAgIHNvdXJjZS5wdXNoKGl0ZW0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc2VsZWN0ZWRWYWx1ZXMucHVzaChzaW5nbGVWYWx1ZS52YWx1ZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZGF0YTogc291cmNlLFxuICAgICAgICBzZWxlY3RlZFZhbHVlczogc2VsZWN0ZWRWYWx1ZXNcbiAgICAgIH07XG4gICAgfSxcblxuICAgIHJldHJpZXZlSXRlbXM6IGZ1bmN0aW9uIHdFbnVtcmV0cmlldmVJdGVtc2UoZG9uZSkge1xuICAgICAgdmFyIHNjb3BlID0gdGhpcyxcbiAgICAgICAgcmVxdWVzdERhdGEgPSB7fTtcblxuICAgICAgaWYgKHRoaXMub3B0aW9ucy5yZW5kZXJPcHRpb25zLm9yZGVyQnkpIHtcbiAgICAgICAgcmVxdWVzdERhdGEub3JkZXJCeSA9IHRoaXMub3B0aW9ucy5yZW5kZXJPcHRpb25zLm9yZGVyQnk7XG4gICAgICB9XG5cbiAgICAgIC8vIEdldCBlbnVtcyBkYXRhIGFuZCBkZWZlciByZW5kZXJcbiAgICAgICQuYWpheCh7XG4gICAgICAgIHR5cGU6IFwiR0VUXCIsXG4gICAgICAgIHVybDogdGhpcy5vcHRpb25zLnNvdXJjZVVyaSxcbiAgICAgICAgZGF0YVR5cGU6IFwianNvblwiLFxuICAgICAgICBkYXRhOiByZXF1ZXN0RGF0YVxuICAgICAgfSlcbiAgICAgICAgLmRvbmUoZnVuY3Rpb24gd0VudW1fcmV0cmlldmVEb25lKHJlc3VsdCkge1xuICAgICAgICAgIHNjb3BlLm9wdGlvbnMuc291cmNlVmFsdWVzID0gcmVzdWx0LmRhdGEuZW51bUl0ZW1zO1xuICAgICAgICAgIHNjb3BlLm9wdGlvbnMucmVuZGVyT3B0aW9ucy51c2VTb3VyY2VVcmkgPSBmYWxzZTtcbiAgICAgICAgICBkb25lKHNjb3BlKTtcbiAgICAgICAgfSlcbiAgICAgICAgLmZhaWwoZnVuY3Rpb24gd0VudW1fcmV0cmlldmVGYWlsKHJlc3BvbnNlKSB7XG4gICAgICAgICAgJChcImJvZHlcIikudHJpZ2dlcihcIm5vdGlmaWNhdGlvblwiLCB7XG4gICAgICAgICAgICBodG1sTWVzc2FnZTogXCJFbnVtZXJhdGUgXCIgKyBzY29wZS5vcHRpb25zLmlkLFxuICAgICAgICAgICAgbWVzc2FnZTogcmVzcG9uc2Uuc3RhdHVzVGV4dCxcbiAgICAgICAgICAgIHR5cGU6IFwiZXJyb3JcIlxuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgbm9CdXR0b25EaXNwbGF5OiBmdW5jdGlvbiB3RW51bU5vRGlzcGxheUJ1dHRvbigpIHtcbiAgICAgIGlmIChcbiAgICAgICAgdGhpcy5lbGVtZW50LmZpbmQoXCIuZGNwQXR0cmlidXRlX19jb250ZW50X19idXR0b25zIGJ1dHRvblwiKS5sZW5ndGggPT09IDBcbiAgICAgICkge1xuICAgICAgICB0aGlzLmVsZW1lbnRcbiAgICAgICAgICAuZmluZChcIi5kY3BBdHRyaWJ1dGVfX3ZhbHVlLS1lbnVtYnV0dG9uc1wiKVxuICAgICAgICAgIC5hZGRDbGFzcyhcImRjcEF0dHJpYnV0ZV9fY29udGVudF9fbm9idXR0b25cIik7XG4gICAgICAgIHRoaXMuZWxlbWVudC5maW5kKFwiLmRjcEF0dHJpYnV0ZV9fY29udGVudF9fYnV0dG9uc1wiKS5oaWRlKCk7XG4gICAgICB9XG4gICAgfSxcblxuICAgIGJvb2xCdXR0b25zOiBmdW5jdGlvbiB3RW51bUJvb2xCdXR0b25zKCkge1xuICAgICAgdmFyIGVudW1EYXRhO1xuICAgICAgdmFyIHRwbE9wdGlvbiA9IHRoaXMub3B0aW9ucztcbiAgICAgIHZhciBzY29wZSA9IHRoaXM7XG5cbiAgICAgIGlmICh0aGlzLm9wdGlvbnMucmVuZGVyT3B0aW9ucy51c2VTb3VyY2VVcmkpIHtcbiAgICAgICAgdGhpcy5yZXRyaWV2ZUl0ZW1zKGZ1bmN0aW9uIHdFbnVtX29uUmV0cmlldmVEb25lKHRoZVdpZGdldCkge1xuICAgICAgICAgIHRoZVdpZGdldC5ib29sQnV0dG9ucygpO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBlbnVtRGF0YSA9IHRoaXMuZ2V0U2luZ2xlRW51bURhdGEoKTtcbiAgICAgIHRwbE9wdGlvbi5lbnVtVmFsdWVzID0gZW51bURhdGEuZGF0YTtcblxuICAgICAgaWYgKHRwbE9wdGlvbi5lbnVtVmFsdWVzLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgdHBsT3B0aW9uLmVudW1WYWx1ZXNbMF0ub2ZmID0gdHJ1ZTtcbiAgICAgICAgdHBsT3B0aW9uLmVudW1WYWx1ZXNbMV0ub24gPSB0cnVlO1xuICAgICAgfVxuXG4gICAgICB0aGlzLm9wdGlvbnMuaXNNdWx0aXBsZSA9IHRydWU7IC8vIEp1c3QgdG8gaGF2ZSBjaGVja2JveFxuXG4gICAgICB0aGlzLm9wdGlvbnMucmVuZGVyT3B0aW9ucy51c2VPdGhlckNob2ljZSA9IGZhbHNlOyAvLyBBbHdheXMgOiBubyB1c2UgdGhpcyBvcHRpb25zXG4gICAgICB0aGlzLmVsZW1lbnQuYXBwZW5kKFxuICAgICAgICBNdXN0YWNoZS5yZW5kZXIodGhpcy5fZ2V0VGVtcGxhdGUoXCJ3cml0ZVRvZ2dsZVwiKSB8fCBcIlwiLCB0aGlzLm9wdGlvbnMpXG4gICAgICApO1xuICAgICAgdGhpcy5vcHRpb25zLmlzTXVsdGlwbGUgPSBmYWxzZTsgLy8gcmVzdG9yZSBpc011bHRpcGxlIDogaXQgbmV2ZXIgY2FuIGJlIG11bHRpcGxlXG5cbiAgICAgIGlmIChzY29wZS5vcHRpb25zLmxhYmVscy5pbnZlcnRTZWxlY3Rpb24pIHtcbiAgICAgICAgdGhpcy5lbGVtZW50XG4gICAgICAgICAgLmZpbmQoXCIuZGNwQXR0cmlidXRlX192YWx1ZS0tdG9nZ2xlXCIpXG4gICAgICAgICAgLmVhY2goZnVuY3Rpb24gd0VudW1faW5zZXJ0VG9vbHRpcChrSXRlbSkge1xuICAgICAgICAgICAgaWYgKHRwbE9wdGlvbi5lbnVtVmFsdWVzW2tJdGVtXSkge1xuICAgICAgICAgICAgICAkKHRoaXMpLnRvb2x0aXAoe1xuICAgICAgICAgICAgICAgIHRyaWdnZXI6IFwiaG92ZXJcIixcbiAgICAgICAgICAgICAgICBjb250YWluZXI6IHNjb3BlLmVsZW1lbnQsXG4gICAgICAgICAgICAgICAgdGl0bGU6IE11c3RhY2hlLnJlbmRlcihcbiAgICAgICAgICAgICAgICAgIHNjb3BlLm9wdGlvbnMubGFiZWxzLmludmVydFNlbGVjdGlvbiB8fCBcIlwiLFxuICAgICAgICAgICAgICAgICAgdHBsT3B0aW9uLmVudW1WYWx1ZXNbKGtJdGVtICsgMSkgJSAyXVxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMubm9CdXR0b25EaXNwbGF5KCk7XG5cbiAgICAgIHRoaXMuZWxlbWVudC5vbihcbiAgICAgICAgXCJjbGlja1wiICsgdGhpcy5ldmVudE5hbWVzcGFjZSxcbiAgICAgICAgXCIuZGNwQXR0cmlidXRlX192YWx1ZS0tdG9nZ2xlXCIsXG4gICAgICAgIGZ1bmN0aW9uIHdFbnVtX2Jvb2xlYW5DbGljayhldmVudCkge1xuICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgLy8gSW52ZXJ0IHNlbGVjdGlvblxuICAgICAgICAgIF8uc29tZSh0cGxPcHRpb24uZW51bVZhbHVlcywgZnVuY3Rpb24gd0VudW1fY29tYm9TZXRWYWx1ZShpdGVtKSB7XG4gICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgIHNjb3BlLm9wdGlvbnMuYXR0cmlidXRlVmFsdWUudmFsdWUgPT09IG51bGwgfHxcbiAgICAgICAgICAgICAgaXRlbS52YWx1ZSAhPT0gc2NvcGUub3B0aW9ucy5hdHRyaWJ1dGVWYWx1ZS52YWx1ZVxuICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgIHNjb3BlLnNldFZhbHVlKGl0ZW0sIGV2ZW50KTtcbiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICk7XG5cbiAgICAgIHRoaXMuZ2V0Q29udGVudEVsZW1lbnRzKCkuZWFjaChmdW5jdGlvbiB3RW51bV9hZGRLQnV0dG9uKCkge1xuICAgICAgICAkKHRoaXMpXG4gICAgICAgICAgLmNsb3Nlc3QoXCIuZGNwQXR0cmlidXRlX192YWx1ZS0tZW51bWxhYmVsXCIpXG4gICAgICAgICAgLmFkZENsYXNzKFwiay1idXR0b25cIik7XG4gICAgICB9KTtcbiAgICAgIGlmIChzY29wZS5vcHRpb25zLmF0dHJpYnV0ZVZhbHVlLnZhbHVlID09PSBudWxsKSB7XG4gICAgICAgIC8vIFNldCB0byBmaXJzdCBlbnVtIGl0ZW0gaWYgZW1wdHlcbiAgICAgICAgdmFyIGZpcnN0SXRlbSA9IHRwbE9wdGlvbi5lbnVtVmFsdWVzWzBdO1xuICAgICAgICBpZiAoZmlyc3RJdGVtKSB7XG4gICAgICAgICAgc2NvcGUuc2V0VmFsdWUoe1xuICAgICAgICAgICAgdmFsdWU6IGZpcnN0SXRlbS52YWx1ZSxcbiAgICAgICAgICAgIGRpc3BsYXlWYWx1ZTogZmlyc3RJdGVtLmRpc3BsYXlWYWx1ZVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcbiAgICAvKipcbiAgICAgKiBJZGVudGlmeSB0aGUgaW5wdXQgd2hlcmUgaXMgdGhlIHJhdyB2YWx1ZVxuICAgICAqIEByZXR1cm5zIHsqfVxuICAgICAqL1xuICAgIGdldENvbnRlbnRFbGVtZW50czogZnVuY3Rpb24gd0VudW1fZ2V0Q29udGVudEVsZW1lbnRzKCkge1xuICAgICAgaWYgKFxuICAgICAgICB0aGlzLm9wdGlvbnMuaW5BcnJheSAmJlxuICAgICAgICAodGhpcy5vcHRpb25zLnJlbmRlck9wdGlvbnMuZWRpdERpc3BsYXkgPT09IFwiaG9yaXpvbnRhbFwiIHx8XG4gICAgICAgICAgdGhpcy5vcHRpb25zLnJlbmRlck9wdGlvbnMuZWRpdERpc3BsYXkgPT09IFwidmVydGljYWxcIiB8fFxuICAgICAgICAgIHRoaXMub3B0aW9ucy5yZW5kZXJPcHRpb25zLmVkaXREaXNwbGF5ID09PSBcImJvb2xcIilcbiAgICAgICkge1xuICAgICAgICByZXR1cm4gdGhpcy5lbGVtZW50LmZpbmQoXG4gICAgICAgICAgJy5kY3BBdHRyaWJ1dGVfX3ZhbHVlW25hbWU9XCInICtcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucy5pZCArXG4gICAgICAgICAgICBcIltcIiArXG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMuZW51bUluZGV4ICtcbiAgICAgICAgICAgICddXCJdJ1xuICAgICAgICApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3N1cGVyKCk7XG4gICAgICB9XG4gICAgfSxcblxuICAgIHJhZGlvQnV0dG9uczogZnVuY3Rpb24gd0VudW1SYWRpb0J1dHRvbnMoKSB7XG4gICAgICB2YXIgZW51bURhdGE7XG4gICAgICB2YXIgdHBsT3B0aW9uID0gdGhpcy5vcHRpb25zO1xuICAgICAgdmFyIGxhYmVscztcbiAgICAgIHZhciBzY29wZSA9IHRoaXM7XG4gICAgICB2YXIgaGFzTm90RXhpc3RzO1xuXG4gICAgICBpZiAodGhpcy5vcHRpb25zLnJlbmRlck9wdGlvbnMudXNlU291cmNlVXJpKSB7XG4gICAgICAgIHRoaXMucmV0cmlldmVJdGVtcyhmdW5jdGlvbiB3RW51bV9yZXRyaWV2ZURvbmUodGhlV2lkZ2V0KSB7XG4gICAgICAgICAgdGhlV2lkZ2V0LnJhZGlvQnV0dG9ucygpO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBlbnVtRGF0YSA9IHRoaXMuZ2V0U2luZ2xlRW51bURhdGEoKTtcblxuICAgICAgdHBsT3B0aW9uLmVudW1WYWx1ZXMgPSBlbnVtRGF0YS5kYXRhO1xuICAgICAgaGFzTm90RXhpc3RzID0gXy5zb21lKGVudW1EYXRhLmRhdGEsIGZ1bmN0aW9uIHdFbnVtX2ZpbmROb3RFeGlzdEl0ZW0oXG4gICAgICAgIGl0ZW1cbiAgICAgICkge1xuICAgICAgICByZXR1cm4gaXRlbS5leGlzdHMgPT09IGZhbHNlO1xuICAgICAgfSk7XG5cbiAgICAgIGlmIChoYXNOb3RFeGlzdHMgPT09IHRydWUpIHtcbiAgICAgICAgLy8gTm8gc2V0IHR3aWNlIGZvciByYWRpb1xuICAgICAgICB0aGlzLm9wdGlvbnMucmVuZGVyT3B0aW9ucy51c2VPdGhlckNob2ljZSA9IGZhbHNlO1xuICAgICAgfVxuICAgICAgdGhpcy5lbGVtZW50LmFwcGVuZChcbiAgICAgICAgTXVzdGFjaGUucmVuZGVyKHRoaXMuX2dldFRlbXBsYXRlKFwid3JpdGVSYWRpb1wiKSB8fCBcIlwiLCB0aGlzLm9wdGlvbnMpXG4gICAgICApO1xuICAgICAgbGFiZWxzID0gdGhpcy5lbGVtZW50LmZpbmQoXCIuZGNwQXR0cmlidXRlX192YWx1ZS0tZW51bWxhYmVsXCIpO1xuXG4gICAgICB0aGlzLm5vQnV0dG9uRGlzcGxheSgpO1xuICAgICAgbGFiZWxzLm9uKFxuICAgICAgICBcImNoYW5nZVwiICsgdGhpcy5ldmVudE5hbWVzcGFjZSxcbiAgICAgICAgXCJpbnB1dFt0eXBlPXJhZGlvXVwiLFxuICAgICAgICBmdW5jdGlvbiB3RW51bV9vbmNoYW5nZShldmVudCkge1xuICAgICAgICAgIHZhciBuZXdWYWx1ZSA9IHt9O1xuICAgICAgICAgIG5ld1ZhbHVlLnZhbHVlID0gJCh0aGlzKS52YWwoKTtcbiAgICAgICAgICBuZXdWYWx1ZS5kaXNwbGF5VmFsdWUgPSAkKHRoaXMpXG4gICAgICAgICAgICAuY2xvc2VzdChcIi5kY3BBdHRyaWJ1dGVfX3ZhbHVlLS1lbnVtbGFiZWxcIilcbiAgICAgICAgICAgIC5maW5kKFwibGFiZWxcIilcbiAgICAgICAgICAgIC50ZXh0KClcbiAgICAgICAgICAgIC50cmltKCk7XG4gICAgICAgICAgc2NvcGUuc2V0VmFsdWUobmV3VmFsdWUsIGV2ZW50KTtcbiAgICAgICAgfVxuICAgICAgKTtcblxuICAgICAgdGhpcy5nZXRDb250ZW50RWxlbWVudHMoKS5lYWNoKGZ1bmN0aW9uIHdFbnVtX2FkZEtCdXR0b24oKSB7XG4gICAgICAgICQodGhpcylcbiAgICAgICAgICAuY2xvc2VzdChcImxhYmVsXCIpXG4gICAgICAgICAgLmFkZENsYXNzKFwiay1idXR0b25cIik7XG4gICAgICB9KTtcbiAgICAgIGlmIChcbiAgICAgICAgc2NvcGUub3B0aW9ucy5yZW5kZXJPcHRpb25zLnVzZUZpcnN0Q2hvaWNlICYmXG4gICAgICAgIHNjb3BlLm9wdGlvbnMuYXR0cmlidXRlVmFsdWUudmFsdWUgPT09IG51bGxcbiAgICAgICkge1xuICAgICAgICAvLyBTZXQgdG8gZmlyc3QgZW51bSBpdGVtIGlmIGVtcHR5XG4gICAgICAgIHZhciBmaXJzdEl0ZW0gPSB0cGxPcHRpb24uZW51bVZhbHVlc1swXTtcbiAgICAgICAgaWYgKGZpcnN0SXRlbSkge1xuICAgICAgICAgIHNjb3BlLnNldFZhbHVlKHtcbiAgICAgICAgICAgIHZhbHVlOiBmaXJzdEl0ZW0udmFsdWUsXG4gICAgICAgICAgICBkaXNwbGF5VmFsdWU6IGZpcnN0SXRlbS5kaXNwbGF5VmFsdWVcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAoc2NvcGUub3B0aW9ucy5sYWJlbHMuc2VsZWN0TWVzc2FnZSkge1xuICAgICAgICB0aGlzLmVsZW1lbnQuZmluZChcIi5kY3BBdHRyaWJ1dGVfX3ZhbHVlLS1lbnVtYnV0dG9uc1wiKS50b29sdGlwKHtcbiAgICAgICAgICBjb250YWluZXI6IFwiLmRjcERvY3VtZW50XCIsXG4gICAgICAgICAgc2VsZWN0b3I6IFwiLmRjcEF0dHJpYnV0ZV9fdmFsdWUtLWVudW1sYWJlbC0tdGV4dFwiLFxuICAgICAgICAgIHRyaWdnZXI6IFwiaG92ZXJcIixcbiAgICAgICAgICB0aXRsZTogZnVuY3Rpb24gd0VudW1fdGl0bGVUb29sdGlwKCkge1xuICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICAkKHRoaXMpXG4gICAgICAgICAgICAgICAgLmNsb3Nlc3QoXCIuZGNwQXR0cmlidXRlX192YWx1ZS0tZW51bWxhYmVsXCIpXG4gICAgICAgICAgICAgICAgLmZpbmQoXCJpbnB1dFwiKVxuICAgICAgICAgICAgICAgIC5wcm9wKFwiY2hlY2tlZFwiKVxuICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgcmV0dXJuIE11c3RhY2hlLnJlbmRlcihzY29wZS5vcHRpb25zLmxhYmVscy5zZWxlY3RNZXNzYWdlLCB7XG4gICAgICAgICAgICAgICAgZGlzcGxheVZhbHVlOiAkKHRoaXMpLnRleHQoKSxcbiAgICAgICAgICAgICAgICB2YWx1ZTogJCh0aGlzKVxuICAgICAgICAgICAgICAgICAgLnBhcmVudCgpXG4gICAgICAgICAgICAgICAgICAuZmluZChcImlucHV0XCIpXG4gICAgICAgICAgICAgICAgICAudmFsKClcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5fY2hlY2tSYWRpb090aGVyKCk7XG4gICAgfSxcbiAgICBjaGVja2JveEJ1dHRvbnM6IGZ1bmN0aW9uIHdFbnVtUmFkaW9CdXR0b25zKCkge1xuICAgICAgdmFyIGVudW1EYXRhO1xuICAgICAgdmFyIHRwbE9wdGlvbiA9IHRoaXMub3B0aW9ucztcbiAgICAgIHZhciBzY29wZSA9IHRoaXM7XG5cbiAgICAgIGlmICh0aGlzLm9wdGlvbnMucmVuZGVyT3B0aW9ucy51c2VTb3VyY2VVcmkpIHtcbiAgICAgICAgdGhpcy5yZXRyaWV2ZUl0ZW1zKGZ1bmN0aW9uIHdFbnVtX29uRG9uZSh0aGVXaWRnZXQpIHtcbiAgICAgICAgICB0aGVXaWRnZXQuY2hlY2tib3hCdXR0b25zKCk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBlbnVtRGF0YSA9IHRoaXMuZ2V0TXVsdGlwbGVFbnVtRGF0YSgpO1xuICAgICAgdHBsT3B0aW9uLmVudW1WYWx1ZXMgPSBlbnVtRGF0YS5kYXRhO1xuXG4gICAgICB0aGlzLmVsZW1lbnQuYXBwZW5kKFxuICAgICAgICBNdXN0YWNoZS5yZW5kZXIodGhpcy5fZ2V0VGVtcGxhdGUoXCJ3cml0ZVJhZGlvXCIpIHx8IFwiXCIsIHRoaXMub3B0aW9ucylcbiAgICAgICk7XG5cbiAgICAgIHRoaXMubm9CdXR0b25EaXNwbGF5KCk7XG4gICAgICB0aGlzLmVsZW1lbnQub24oXG4gICAgICAgIFwiY2hhbmdlXCIgKyB0aGlzLmV2ZW50TmFtZXNwYWNlLFxuICAgICAgICBcIi5kY3BBdHRyaWJ1dGVfX3ZhbHVlLS1lbnVtbGFiZWwgaW5wdXRbdHlwZT1jaGVja2JveF1cIixcbiAgICAgICAgZnVuY3Rpb24gd0VudW1fb25DaGFuZ2UoZXZlbnQpIHtcbiAgICAgICAgICB2YXIgbmV3VmFsdWUgPSBbXTtcblxuICAgICAgICAgIHNjb3BlLmdldENvbnRlbnRFbGVtZW50cygpLmVhY2goZnVuY3Rpb24gd0VudW1fZmluZENoZWNrZWQoKSB7XG4gICAgICAgICAgICB2YXIgJHRoaXMgPSAkKHRoaXMpO1xuICAgICAgICAgICAgaWYgKCR0aGlzLnByb3AoXCJjaGVja2VkXCIpKSB7XG4gICAgICAgICAgICAgIHZhciBpdGVtVmFsdWUgPSB7fTtcbiAgICAgICAgICAgICAgaXRlbVZhbHVlLnZhbHVlID0gJHRoaXMudmFsKCk7XG4gICAgICAgICAgICAgIGl0ZW1WYWx1ZS5kaXNwbGF5VmFsdWUgPSAkdGhpc1xuICAgICAgICAgICAgICAgIC5jbG9zZXN0KFwibGFiZWxcIilcbiAgICAgICAgICAgICAgICAudGV4dCgpXG4gICAgICAgICAgICAgICAgLnRyaW0oKTtcbiAgICAgICAgICAgICAgbmV3VmFsdWUucHVzaChpdGVtVmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgc2NvcGUuc2V0VmFsdWUobmV3VmFsdWUsIGV2ZW50KTtcbiAgICAgICAgfVxuICAgICAgKTtcblxuICAgICAgdGhpcy5nZXRDb250ZW50RWxlbWVudHMoKS5lYWNoKGZ1bmN0aW9uIHdFbnVtX2FkZEtCdXR0b24oKSB7XG4gICAgICAgICQodGhpcylcbiAgICAgICAgICAuY2xvc2VzdChcImxhYmVsXCIpXG4gICAgICAgICAgLmFkZENsYXNzKFwiay1idXR0b25cIik7XG4gICAgICB9KTtcblxuICAgICAgaWYgKHRoaXMub3B0aW9ucy5sYWJlbHMuc2VsZWN0TWVzc2FnZSkge1xuICAgICAgICB0aGlzLmVsZW1lbnQuZmluZChcIi5kY3BBdHRyaWJ1dGVfX3ZhbHVlLS1lbnVtYnV0dG9uc1wiKS50b29sdGlwKHtcbiAgICAgICAgICBjb250YWluZXI6IFwiLmRjcERvY3VtZW50XCIsXG4gICAgICAgICAgc2VsZWN0b3I6IFwiLmRjcEF0dHJpYnV0ZV9fdmFsdWUtLWVudW1sYWJlbC0tdGV4dFwiLFxuICAgICAgICAgIHRyaWdnZXI6IFwiaG92ZXJcIixcbiAgICAgICAgICB0aXRsZTogZnVuY3Rpb24gd0VudW1fQ2JfdGl0bGVUb29sdGlwKCkge1xuICAgICAgICAgICAgdmFyICR0aGlzID0gJCh0aGlzKTtcbiAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgJHRoaXNcbiAgICAgICAgICAgICAgICAuY2xvc2VzdChcIi5kY3BBdHRyaWJ1dGVfX3ZhbHVlLS1lbnVtbGFiZWxcIilcbiAgICAgICAgICAgICAgICAuZmluZChcImlucHV0XCIpXG4gICAgICAgICAgICAgICAgLnByb3AoXCJjaGVja2VkXCIpXG4gICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgcmV0dXJuIE11c3RhY2hlLnJlbmRlcihzY29wZS5vcHRpb25zLmxhYmVscy51bnNlbGVjdE1lc3NhZ2UsIHtcbiAgICAgICAgICAgICAgICBkaXNwbGF5VmFsdWU6ICQodGhpcykudGV4dCgpLFxuICAgICAgICAgICAgICAgIHZhbHVlOiAkKHRoaXMpXG4gICAgICAgICAgICAgICAgICAucGFyZW50KClcbiAgICAgICAgICAgICAgICAgIC5maW5kKFwiaW5wdXRcIilcbiAgICAgICAgICAgICAgICAgIC52YWwoKVxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHJldHVybiBNdXN0YWNoZS5yZW5kZXIoc2NvcGUub3B0aW9ucy5sYWJlbHMuc2VsZWN0TWVzc2FnZSwge1xuICAgICAgICAgICAgICAgIGRpc3BsYXlWYWx1ZTogJCh0aGlzKS50ZXh0KCksXG4gICAgICAgICAgICAgICAgdmFsdWU6ICQodGhpcylcbiAgICAgICAgICAgICAgICAgIC5wYXJlbnQoKVxuICAgICAgICAgICAgICAgICAgLmZpbmQoXCJpbnB1dFwiKVxuICAgICAgICAgICAgICAgICAgLnZhbCgpXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5vcHRpb25zLnJlbmRlck9wdGlvbnMudXNlT3RoZXJDaG9pY2UgPT09IHRydWUpIHtcbiAgICAgICAgdGhpcy5fY2hlY2tCb3hPdGhlcigpO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBNYW5hZ2Ugb3RoZXIgaW5wdXQgZm9yIHJhZGlvXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfY2hlY2tSYWRpb090aGVyOiBmdW5jdGlvbiB3RW51bV9fY2hlY2tSYWRpb090aGVyKCkge1xuICAgICAgdGhpcy5lbGVtZW50XG4gICAgICAgIC5maW5kKFwiLmRjcEF0dHJpYnV0ZV9fdmFsdWUtLWVudW0tLW90aGVyXCIpXG4gICAgICAgIC5vbihcbiAgICAgICAgICBcImZvY3VzXCIgKyB0aGlzLmV2ZW50TmFtZXNwYWNlLFxuICAgICAgICAgIGZ1bmN0aW9uIHdFbnVtUmFkaW9PdGhlcklucHV0Q2xpY2soKSB7XG4gICAgICAgICAgICAkKHRoaXMpLnRyaWdnZXIoXCJjaGFuZ2VcIik7XG4gICAgICAgICAgfVxuICAgICAgICApXG4gICAgICAgIC5vbihcbiAgICAgICAgICBcImNoYW5nZVwiICsgdGhpcy5ldmVudE5hbWVzcGFjZSxcbiAgICAgICAgICBmdW5jdGlvbiB3RW51bVJhZGlvT3RoZXJJbnB1dENoYW5nZSgpIHtcbiAgICAgICAgICAgIHZhciAkbGFiZWwgPSAkKHRoaXMpLmNsb3Nlc3QoXCIuZGNwQXR0cmlidXRlX192YWx1ZS0tZW51bWxhYmVsXCIpO1xuICAgICAgICAgICAgdmFyICRpbnB1dCA9ICRsYWJlbC5maW5kKFwiLmRjcEF0dHJpYnV0ZV9fdmFsdWUtLWVkaXRcIik7XG4gICAgICAgICAgICAkaW5wdXQudmFsKCQodGhpcykudmFsKCkpO1xuICAgICAgICAgICAgLy8gVHJpZ2dlciBjaGFuZ2UgbGFiZWwgaW5wdXQgdG8gcmVhbCBzZXQgdmFsdWVcbiAgICAgICAgICAgICRsYWJlbC5maW5kKFwiaW5wdXRbdHlwZT1yYWRpb11cIikudHJpZ2dlcihcImNoYW5nZVwiKTtcbiAgICAgICAgICB9XG4gICAgICAgIClcbiAgICAgICAgLm9uKFxuICAgICAgICAgIFwia2V5dXBcIiArIHRoaXMuZXZlbnROYW1lc3BhY2UsXG4gICAgICAgICAgZnVuY3Rpb24gd0VudW1SYWRpb090aGVySW5wdXRLZXlSZXR1cm4oZXZlbnQpIHtcbiAgICAgICAgICAgIHZhciBjb2RlID0gZXZlbnQua2V5Q29kZSA/IGV2ZW50LmtleUNvZGUgOiBldmVudC53aGljaDtcbiAgICAgICAgICAgIGlmIChjb2RlID09PSAxMyB8fCBjb2RlID09PSAxMCkge1xuICAgICAgICAgICAgICAkKHRoaXMpLmJsdXIoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIE1hbmFnZSBvdGhlciBpbnB1dCBmb3IgY2hlY2tib3hcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9jaGVja0JveE90aGVyOiBmdW5jdGlvbiB3RW51bV9fY2hlY2tCb3hPdGhlcigpIHtcbiAgICAgIHRoaXMuZWxlbWVudFxuICAgICAgICAub24oXG4gICAgICAgICAgXCJmb2N1c1wiICsgdGhpcy5ldmVudE5hbWVzcGFjZSxcbiAgICAgICAgICBcIi5kY3BBdHRyaWJ1dGVfX3ZhbHVlLS1lbnVtLS1vdGhlclwiLFxuICAgICAgICAgIGZ1bmN0aW9uIHdFbnVtQ2hlY2tPdGhlcklucHV0Q2xpY2soKSB7XG4gICAgICAgICAgICAkKHRoaXMpLnRyaWdnZXIoXCJjaGFuZ2VcIik7XG4gICAgICAgICAgfVxuICAgICAgICApXG4gICAgICAgIC5vbihcbiAgICAgICAgICBcImNoYW5nZVwiICsgdGhpcy5ldmVudE5hbWVzcGFjZSxcbiAgICAgICAgICBcIi5kY3BBdHRyaWJ1dGVfX3ZhbHVlLS1lbnVtLS1vdGhlclwiLFxuICAgICAgICAgIGZ1bmN0aW9uIHdFbnVtQ2hlY2tPdGhlcklucHV0Q2hhbmdlKCkge1xuICAgICAgICAgICAgdmFyICRsYWJlbCA9ICQodGhpcykuY2xvc2VzdChcIi5kY3BBdHRyaWJ1dGVfX3ZhbHVlLS1lbnVtbGFiZWxcIik7XG4gICAgICAgICAgICB2YXIgJGlucHV0ID0gJGxhYmVsLmZpbmQoXCIuZGNwQXR0cmlidXRlX192YWx1ZS0tZWRpdFwiKTtcbiAgICAgICAgICAgIHZhciAkaGFzRW1wdHk7XG4gICAgICAgICAgICB2YXIgJGNoZWNrYm94ID0gJGxhYmVsLmZpbmQoXCJpbnB1dFt0eXBlPWNoZWNrYm94XVwiKTtcblxuICAgICAgICAgICAgJGlucHV0LnZhbCgkKHRoaXMpLnZhbCgpKTtcblxuICAgICAgICAgICAgJGhhc0VtcHR5ID0gXy5zb21lKFxuICAgICAgICAgICAgICAkKHRoaXMpXG4gICAgICAgICAgICAgICAgLmNsb3Nlc3QoXCIuZGNwQXR0cmlidXRlX192YWx1ZS0tZW51bWJ1dHRvbnNcIilcbiAgICAgICAgICAgICAgICAuZmluZChcIi5kY3BBdHRyaWJ1dGVfX3ZhbHVlLS1lbnVtLS1vdGhlclwiKSxcbiAgICAgICAgICAgICAgZnVuY3Rpb24gd0VudW1fZmluZEVtcHR5T3RoZXIoaXRlbSkge1xuICAgICAgICAgICAgICAgIHJldHVybiAkKGl0ZW0pLnZhbCgpID09PSBcIlwiO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApO1xuXG4gICAgICAgICAgICBpZiAoISRoYXNFbXB0eSkge1xuICAgICAgICAgICAgICB2YXIgJG5ld09uZSA9ICRsYWJlbC5jbG9uZSgpO1xuICAgICAgICAgICAgICB2YXIgdXVpZCA9IF8udW5pcXVlSWQoXCJlbnVtXCIpO1xuICAgICAgICAgICAgICAkbmV3T25lLmZpbmQoXCJpbnB1dFt0eXBlPWNoZWNrYm94XVwiKS5hdHRyKFwiaWRcIiwgdXVpZCk7XG4gICAgICAgICAgICAgICRuZXdPbmUuZmluZChcImxhYmVsXCIpLmF0dHIoXCJmb3JcIiwgdXVpZCk7XG4gICAgICAgICAgICAgIC8vIGFkZCBuZXcgaW5wdXQgaWYgbm8gb25lIGZyZWUgZm91bmRcbiAgICAgICAgICAgICAgJGxhYmVsLnBhcmVudCgpLmFwcGVuZCgkbmV3T25lKTtcbiAgICAgICAgICAgICAgJG5ld09uZVxuICAgICAgICAgICAgICAgIC5maW5kKFwiaW5wdXRcIilcbiAgICAgICAgICAgICAgICAudmFsKFwiXCIpXG4gICAgICAgICAgICAgICAgLnByb3AoXCJjaGVja2VkXCIsIGZhbHNlKTtcblxuICAgICAgICAgICAgICBpZiAoISRjaGVja2JveC5wcm9wKFwiY2hlY2tlZFwiKSkge1xuICAgICAgICAgICAgICAgICRsYWJlbC5maW5kKFwibGFiZWxcIikudHJpZ2dlcihcImNsaWNrXCIpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyByZXNlbmQgY2hhbmdlIHRyaWdnZXIgYmVjYXVzZSB0aGlzIGhvb2sgaXMgY2FsbCBiZWZvcmUgdGhlIGNoZWNrYm94IG9uY2hhbmdlIGV2ZW50XG4gICAgICAgICAgICAkY2hlY2tib3gudHJpZ2dlcihcImNoYW5nZVwiKTtcbiAgICAgICAgICB9XG4gICAgICAgIClcbiAgICAgICAgLm9uKFxuICAgICAgICAgIFwia2V5dXBcIiArIHRoaXMuZXZlbnROYW1lc3BhY2UsXG4gICAgICAgICAgXCIuZGNwQXR0cmlidXRlX192YWx1ZS0tZW51bS0tb3RoZXJcIixcbiAgICAgICAgICBmdW5jdGlvbiB3RW51bUNoZWNrT3RoZXJJbnB1dEtleVJldHVybihldmVudCkge1xuICAgICAgICAgICAgdmFyIGNvZGUgPSBldmVudC5rZXlDb2RlID8gZXZlbnQua2V5Q29kZSA6IGV2ZW50LndoaWNoO1xuICAgICAgICAgICAgaWYgKGNvZGUgPT09IDEzIHx8IGNvZGUgPT09IDEwKSB7XG4gICAgICAgICAgICAgICQodGhpcykuYmx1cigpOyAvLyBDaGFuZ2UgZXZlbnQgd2lsbCBiZSB0cmlnZ2VyZWRcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgfSxcbiAgICBzaW5nbGVEcm9wZG93bjogZnVuY3Rpb24gd0VudW1TaW5nbGVEcm9wZG93bigpIHtcbiAgICAgIHZhciBrZW5kb09wdGlvbnMgPSB0aGlzLmdldEtlbmRvT3B0aW9ucygpO1xuICAgICAgdmFyIGtkZGw7XG4gICAgICB0aGlzLmVsZW1lbnQuYXBwZW5kKFxuICAgICAgICBNdXN0YWNoZS5yZW5kZXIodGhpcy5fZ2V0VGVtcGxhdGUoXCJ3cml0ZVwiKSB8fCBcIlwiLCB0aGlzLm9wdGlvbnMpXG4gICAgICApO1xuICAgICAgdGhpcy5rZW5kb1dpZGdldCA9IHRoaXMuZWxlbWVudC5maW5kKFwiLmRjcEF0dHJpYnV0ZV9fdmFsdWUtLWVkaXRcIik7XG4gICAgICBrZGRsID0gdGhpcy5rZW5kb1dpZGdldFxuICAgICAgICAua2VuZG9Ecm9wRG93bkxpc3Qoa2VuZG9PcHRpb25zKVxuICAgICAgICAuZGF0YShcImtlbmRvRHJvcERvd25MaXN0XCIpO1xuICAgICAgdGhpcy5rZW5kb1dpZGdldE9iamVjdCA9IHRoaXMua2VuZG9XaWRnZXQuZGF0YShcImtlbmRvRHJvYkRvd25MaXN0XCIpO1xuICAgICAga2RkbC5saXN0LmZpbmQoXCIuay1saXN0LW9wdGlvbmxhYmVsXCIpLmFkZENsYXNzKFwicGxhY2Vob2xkZXItLWNsZWFyXCIpO1xuICAgIH0sXG4gICAgbXVsdGlwbGVTZWxlY3Q6IGZ1bmN0aW9uIHdFbnVtTXVsdGlwbGVTZWxlY3QoKSB7XG4gICAgICB2YXIga2VuZG9PcHRpb25zID0gdGhpcy5nZXRLZW5kb09wdGlvbnMoKTtcbiAgICAgIHRoaXMuZWxlbWVudC5hcHBlbmQoXG4gICAgICAgIE11c3RhY2hlLnJlbmRlcih0aGlzLl9nZXRUZW1wbGF0ZShcIndyaXRlXCIpIHx8IFwiXCIsIHRoaXMub3B0aW9ucylcbiAgICAgICk7XG4gICAgICB0aGlzLmtlbmRvV2lkZ2V0ID0gdGhpcy5lbGVtZW50LmZpbmQoXCIuZGNwQXR0cmlidXRlX192YWx1ZS0tZWRpdFwiKTtcbiAgICAgIHRoaXMua2VuZG9XaWRnZXQua2VuZG9NdWx0aVNlbGVjdChrZW5kb09wdGlvbnMpO1xuICAgICAgdGhpcy5rZW5kb1dpZGdldE9iamVjdCA9IHRoaXMua2VuZG9XaWRnZXQuZGF0YShcImtlbmRvTXVsdGlTZWxlY3RcIik7XG4gICAgfSxcblxuICAgIHNpbmdsZUNvbWJvYm94OiBmdW5jdGlvbiB3RW51bVNpbmdsZUNvbWJvYm94KCkge1xuICAgICAgdmFyIGtlbmRvT3B0aW9ucyA9IHRoaXMuZ2V0S2VuZG9PcHRpb25zKCk7XG4gICAgICB2YXIga2RkbDtcbiAgICAgIHZhciBjdXJyZW50V2lkZ2V0ID0gdGhpcztcblxuICAgICAgdGhpcy5lbGVtZW50LmFwcGVuZChcbiAgICAgICAgTXVzdGFjaGUucmVuZGVyKHRoaXMuX2dldFRlbXBsYXRlKFwid3JpdGVcIikgfHwgXCJcIiwgdGhpcy5vcHRpb25zKVxuICAgICAgKTtcbiAgICAgIHRoaXMua2VuZG9XaWRnZXQgPSB0aGlzLmVsZW1lbnQuZmluZChcIi5kY3BBdHRyaWJ1dGVfX3ZhbHVlLS1lZGl0XCIpO1xuXG4gICAgICBrZGRsID0gdGhpcy5rZW5kb1dpZGdldC5rZW5kb0NvbWJvQm94KGtlbmRvT3B0aW9ucykuZGF0YShcImtlbmRvQ29tYm9Cb3hcIik7XG5cbiAgICAgIHRoaXMua2VuZG9XaWRnZXRPYmplY3QgPSBrZGRsO1xuICAgICAgaWYgKHRoaXMub3B0aW9ucy5yZW5kZXJPcHRpb25zLnVzZVNvdXJjZVVyaSkge1xuICAgICAgICBpZiAodGhpcy5vcHRpb25zLmF0dHJpYnV0ZVZhbHVlLnZhbHVlID09PSBudWxsKSB7XG4gICAgICAgICAgLy9rZGRsLmRhdGFTb3VyY2UuZGF0YShbXSk7XG4gICAgICAgICAga2RkbC52YWx1ZShcIlwiKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBrZGRsLmRhdGFTb3VyY2UuZGF0YShbdGhpcy5vcHRpb25zLmF0dHJpYnV0ZVZhbHVlXSk7XG4gICAgICAgICAga2RkbC52YWx1ZSh0aGlzLm9wdGlvbnMuYXR0cmlidXRlVmFsdWUudmFsdWUpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAodGhpcy5vcHRpb25zLmF0dHJpYnV0ZVZhbHVlLnZhbHVlKSB7XG4gICAgICAgICAga2RkbC52YWx1ZSh0aGlzLm9wdGlvbnMuYXR0cmlidXRlVmFsdWUudmFsdWUpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICB0aGlzLmVsZW1lbnQub24oXG4gICAgICAgIFwiY2xpY2tcIiArIHRoaXMuZXZlbnROYW1lc3BhY2UsXG4gICAgICAgIFwiLmRjcEF0dHJpYnV0ZV9fY29udGVudF9fYnV0dG9uLS1kZWxldGVcIixcbiAgICAgICAgZnVuY3Rpb24gd0VudW1EZWxldGVGaWx0ZXIoKSB7XG4gICAgICAgICAgY3VycmVudFdpZGdldC5zZXRFcnJvcihudWxsKTtcbiAgICAgICAgICBrZGRsLmRhdGFTb3VyY2UuZmlsdGVyKHt9KTtcbiAgICAgICAgICBrZGRsLnZhbHVlKFwiXCIpO1xuICAgICAgICB9XG4gICAgICApO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKlNldCBuZXcgdmFsdWUgdG8gd2lkZ2V0XG4gICAgICogQHBhcmFtIHZhbHVlIHZhbHVlIHt2YWx1ZTouLi4uLCBkaXNwbGF5VmFsdWV9IG9yIGFycmF5IG9mIHt2YWx1ZTouLi4uLCBkaXNwbGF5VmFsdWV9XG4gICAgICogQHBhcmFtIGV2ZW50XG4gICAgICovXG4gICAgc2V0VmFsdWU6IGZ1bmN0aW9uIHdFbnVtU2V0VmFsdWUodmFsdWUsIGV2ZW50KSB7XG4gICAgICB2YXIga2RkbCwgbmV3VmFsdWVzO1xuICAgICAgdmFyIGN1cnJlbnRXaWRnZXQgPSB0aGlzO1xuICAgICAgaWYgKHRoaXMub3B0aW9ucy5yZW5kZXJPcHRpb25zLmVkaXREaXNwbGF5ID09PSBcImJvb2xcIikge1xuICAgICAgICAvLyBUaGlzIGRpc3BsYXkgaGFzIG9ubHkgMiB2YWx1ZXMgYW5kIGNhbm5vdCBiZSBzZXQgdG8gbnVsbFxuICAgICAgICBpZiAodmFsdWUudmFsdWUgPT09IG51bGwpIHtcbiAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLmVudW1WYWx1ZXNbMF0pIHtcbiAgICAgICAgICAgIHZhbHVlID0gdGhpcy5vcHRpb25zLmVudW1WYWx1ZXNbMF07XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICB0aGlzLl9zdXBlcih2YWx1ZSwgZXZlbnQpO1xuICAgICAgaWYgKHRoaXMuZ2V0TW9kZSgpID09PSBcIndyaXRlXCIpIHtcbiAgICAgICAgaWYgKHRoaXMuX2lzTXVsdGlwbGUoKSkge1xuICAgICAgICAgIHN3aXRjaCAodGhpcy5vcHRpb25zLnJlbmRlck9wdGlvbnMuZWRpdERpc3BsYXkpIHtcbiAgICAgICAgICAgIGNhc2UgXCJhdXRvQ29tcGxldGlvblwiOlxuICAgICAgICAgICAgY2FzZSBcImxpc3RcIjpcbiAgICAgICAgICAgICAga2RkbCA9IHRoaXMua2VuZG9XaWRnZXQuZGF0YShcImtlbmRvTXVsdGlTZWxlY3RcIik7XG4gICAgICAgICAgICAgIG5ld1ZhbHVlcyA9IF8ubWFwKHZhbHVlLCBmdW5jdGlvbiB3RW51bV9maW5kVmFsdWVzKHZhbCkge1xuICAgICAgICAgICAgICAgIGlmICghY3VycmVudFdpZGdldC5vcHRpb25zLnJlbmRlck9wdGlvbnMudXNlU291cmNlVXJpKSB7XG4gICAgICAgICAgICAgICAgICBpZiAoIWtkZGwuZGF0YVNvdXJjZS5nZXQodmFsLnZhbHVlKSkge1xuICAgICAgICAgICAgICAgICAgICBrZGRsLmRhdGFTb3VyY2UuYWRkKHZhbCk7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiB2YWwudmFsdWU7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICBpZiAoIV8uaXNFcXVhbChrZGRsLnZhbHVlKCksIG5ld1ZhbHVlcykpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmZsYXNoRWxlbWVudCgpO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMucmVuZGVyT3B0aW9ucy51c2VTb3VyY2VVcmkpIHtcbiAgICAgICAgICAgICAgICAgIGlmIChuZXdWYWx1ZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBfLmVhY2godmFsdWUsIGZ1bmN0aW9uIHdFbnVtQ29tcGxldGVFeGlzdHMoc2luZ2xlVmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICBzaW5nbGVWYWx1ZS5leGlzdHMgPSBzaW5nbGVWYWx1ZS5leGlzdHMgIT09IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAga2RkbC5kYXRhU291cmNlLmRhdGEodmFsdWUpO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBrZGRsLnZhbHVlKG5ld1ZhbHVlcyk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgXCJob3Jpem9udGFsXCI6XG4gICAgICAgICAgICBjYXNlIFwidmVydGljYWxcIjpcbiAgICAgICAgICAgICAgdGhpcy5nZXRDb250ZW50RWxlbWVudHMoKS5lYWNoKGZ1bmN0aW9uIHdFbnVtX2ZpbmRWYWx1ZXMoKSB7XG4gICAgICAgICAgICAgICAgdmFyICR0aGlzID0gJCh0aGlzKTtcbiAgICAgICAgICAgICAgICB2YXIgaW5wdXRWYWx1ZSA9ICR0aGlzLnZhbCgpO1xuXG4gICAgICAgICAgICAgICAgdmFyIGlzSW4gPSBfLnNvbWUodmFsdWUsIGZ1bmN0aW9uIHdFbnVtX2lzSW4oeCkge1xuICAgICAgICAgICAgICAgICAgLy9ub2luc3BlY3Rpb24gSlNIaW50XG4gICAgICAgICAgICAgICAgICByZXR1cm4geC52YWx1ZSA9PSBpbnB1dFZhbHVlO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGlmIChpc0luKSB7XG4gICAgICAgICAgICAgICAgICAkdGhpcy5wcm9wKFwiY2hlY2tlZFwiLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICR0aGlzXG4gICAgICAgICAgICAgICAgICAgIC5jbG9zZXN0KFwiLmRjcEF0dHJpYnV0ZV9fdmFsdWUtLWVudW1sYWJlbFwiKVxuICAgICAgICAgICAgICAgICAgICAuYWRkQ2xhc3MoXCJzZWxlY3RlZFwiKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgJHRoaXMucHJvcChcImNoZWNrZWRcIiwgZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgJHRoaXNcbiAgICAgICAgICAgICAgICAgICAgLmNsb3Nlc3QoXCIuZGNwQXR0cmlidXRlX192YWx1ZS0tZW51bWxhYmVsXCIpXG4gICAgICAgICAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhcInNlbGVjdGVkXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgdGhpcy5lbGVtZW50XG4gICAgICAgICAgICAgICAgLmZpbmQoXCIuZGNwQXR0cmlidXRlX192YWx1ZS0tZW51bWxhYmVsLS10ZXh0XCIpXG4gICAgICAgICAgICAgICAgLnRvb2x0aXAoXCJoaWRlXCIpO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAgICAgICBcIlVua25vdyBFbnVtIG1vZGUgOiBcIiArIHRoaXMub3B0aW9ucy5yZW5kZXJPcHRpb25zLmVkaXREaXNwbGF5XG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHN3aXRjaCAodGhpcy5vcHRpb25zLnJlbmRlck9wdGlvbnMuZWRpdERpc3BsYXkpIHtcbiAgICAgICAgICAgIGNhc2UgXCJhdXRvQ29tcGxldGlvblwiOlxuICAgICAgICAgICAgICBrZGRsID0gdGhpcy5rZW5kb1dpZGdldC5kYXRhKFwia2VuZG9Db21ib0JveFwiKTtcbiAgICAgICAgICAgICAgaWYgKCFfLmlzRXF1YWwoa2RkbC52YWx1ZSgpLCB2YWx1ZS52YWx1ZSkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmZsYXNoRWxlbWVudCgpO1xuXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlLnZhbHVlICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLnJlbmRlck9wdGlvbnMudXNlU291cmNlVXJpKSB7XG4gICAgICAgICAgICAgICAgICAgIGtkZGwuZGF0YVNvdXJjZS5kYXRhKFt2YWx1ZV0pO1xuICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFrZGRsLmRhdGFTb3VyY2UuZ2V0KHZhbHVlLnZhbHVlKSkge1xuICAgICAgICAgICAgICAgICAgICAgIGtkZGwuZGF0YVNvdXJjZS5hZGQodmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICB0aGlzLnNldEVycm9yKG51bGwpO1xuICAgICAgICAgICAgICAgICAga2RkbC52YWx1ZSh2YWx1ZS52YWx1ZSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgIGtkZGwudmFsdWUoXCJcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcImxpc3RcIjpcbiAgICAgICAgICAgICAga2RkbCA9IHRoaXMua2VuZG9XaWRnZXQuZGF0YShcImtlbmRvRHJvcERvd25MaXN0XCIpO1xuXG4gICAgICAgICAgICAgIGlmICghXy5pc0VxdWFsKGtkZGwudmFsdWUoKSwgdmFsdWUudmFsdWUgfHwgXCJcIikpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmZsYXNoRWxlbWVudCgpO1xuICAgICAgICAgICAgICAgIGlmICgha2RkbC5kYXRhU291cmNlLmdldCh2YWx1ZS52YWx1ZSkpIHtcbiAgICAgICAgICAgICAgICAgIGtkZGwuZGF0YVNvdXJjZS5hZGQodmFsdWUpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIGtlbmRvIG5lZWQgZW1wdHkgc3RyaW5nIChub3QgbnVsbCkgdG8gY2xlYXIgaW5wdXRcbiAgICAgICAgICAgICAgICBrZGRsLnZhbHVlKHZhbHVlLnZhbHVlIHx8IFwiXCIpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcImJvb2xcIjpcbiAgICAgICAgICAgICAgdGhpcy5nZXRDb250ZW50RWxlbWVudHMoKS5lYWNoKGZ1bmN0aW9uIHdFbnVtX3BhcnNlRWxlbWVudHMoKSB7XG4gICAgICAgICAgICAgICAgdmFyICR0aGlzID0gJCh0aGlzKTtcbiAgICAgICAgICAgICAgICB2YXIgaXNPbjtcbiAgICAgICAgICAgICAgICAvL25vaW5zcGVjdGlvbiBKU0hpbnRcbiAgICAgICAgICAgICAgICBpZiAoJHRoaXMuZGF0YShcInRvZ2dsZXZhbHVlXCIpLnRvU3RyaW5nKCkgPT09IHZhbHVlLnZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICBpZiAoISR0aGlzLmhhc0NsYXNzKFwic2VsZWN0ZWRcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCR0aGlzLmhhc0NsYXNzKFwib25cIikpIHtcbiAgICAgICAgICAgICAgICAgICAgICBpc09uID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAkdGhpcy5yZW1vdmVDbGFzcyhcIm9uXCIpLmFkZENsYXNzKFwib2ZmXCIpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCR0aGlzLmhhc0NsYXNzKFwib2ZmXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgJHRoaXMucmVtb3ZlQ2xhc3MoXCJvZmZcIikuYWRkQ2xhc3MoXCJvblwiKTtcbiAgICAgICAgICAgICAgICAgICAgICBpc09uID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgJHRoaXMuYWRkQ2xhc3MoXCJzZWxlY3RlZFwiKS5yZW1vdmVDbGFzcyhcInVuc2VsZWN0ZWRcIik7XG5cbiAgICAgICAgICAgICAgICAgICAgXy5kZWZlcihmdW5jdGlvbiB3RW51bUFuaW1hdGVCb29sKCkge1xuICAgICAgICAgICAgICAgICAgICAgIGlmIChpc09uID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy5hZGRDbGFzcyhcIm9uXCIpLnJlbW92ZUNsYXNzKFwib2ZmXCIpO1xuICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy5hZGRDbGFzcyhcIm9mZlwiKS5yZW1vdmVDbGFzcyhcIm9uXCIpO1xuICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICR0aGlzLnJlbW92ZUNsYXNzKFwic2VsZWN0ZWRcIikuYWRkQ2xhc3MoXCJ1bnNlbGVjdGVkXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIHRoaXMuZWxlbWVudFxuICAgICAgICAgICAgICAgIC5maW5kKFwiLmRjcEF0dHJpYnV0ZV9fdmFsdWUtLWVudW1sYWJlbFwiKVxuICAgICAgICAgICAgICAgIC50b29sdGlwKFwiaGlkZVwiKTtcblxuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJob3Jpem9udGFsXCI6XG4gICAgICAgICAgICBjYXNlIFwidmVydGljYWxcIjpcbiAgICAgICAgICAgICAgdGhpcy5nZXRDb250ZW50RWxlbWVudHMoKS5lYWNoKGZ1bmN0aW9uIHdFbnVtX3BhcnNlRWxlbWVudHMoKSB7XG4gICAgICAgICAgICAgICAgdmFyICR0aGlzID0gJCh0aGlzKTtcbiAgICAgICAgICAgICAgICAvL25vaW5zcGVjdGlvbiBKU0hpbnRcbiAgICAgICAgICAgICAgICBpZiAoJHRoaXMudmFsKCkgPT0gdmFsdWUudmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICR0aGlzLnByb3AoXCJjaGVja2VkXCIsIHRydWUpO1xuICAgICAgICAgICAgICAgICAgJHRoaXNcbiAgICAgICAgICAgICAgICAgICAgLmNsb3Nlc3QoXCIuZGNwQXR0cmlidXRlX192YWx1ZS0tZW51bWxhYmVsXCIpXG4gICAgICAgICAgICAgICAgICAgIC5hZGRDbGFzcyhcInNlbGVjdGVkXCIpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAkdGhpcy5wcm9wKFwiY2hlY2tlZFwiLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAkdGhpc1xuICAgICAgICAgICAgICAgICAgICAuY2xvc2VzdChcIi5kY3BBdHRyaWJ1dGVfX3ZhbHVlLS1lbnVtbGFiZWxcIilcbiAgICAgICAgICAgICAgICAgICAgLnJlbW92ZUNsYXNzKFwic2VsZWN0ZWRcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICB0aGlzLmVsZW1lbnRcbiAgICAgICAgICAgICAgICAuZmluZChcIi5kY3BBdHRyaWJ1dGVfX3ZhbHVlLS1lbnVtbGFiZWwtLXRleHRcIilcbiAgICAgICAgICAgICAgICAudG9vbHRpcChcImhpZGVcIik7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICAgICAgIFwiVW5rbm93IEVudW0gbW9kZSA6IFwiICsgdGhpcy5vcHRpb25zLnJlbmRlck9wdGlvbnMuZWRpdERpc3BsYXlcbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuX3N1cGVyKHZhbHVlLCBldmVudCk7XG4gICAgICAgIHRoaXMucmVkcmF3KCk7XG4gICAgICB9XG4gICAgfSxcbiAgICAvKipcbiAgICAgKiBtZXRob2QgdXNlIGZvciB0cmFuc3BvcnQgbXVsdGlzZWxlY3Qgd2lkZ2V0XG4gICAgICogQHBhcmFtIG9wdGlvbnNcbiAgICAgKi9cbiAgICBhdXRvY29tcGxldGVSZXF1ZXN0RW51bTogZnVuY3Rpb24gd0VudW1BdXRvY29tcGxldGVSZXF1ZXN0RW51bShvcHRpb25zKSB7XG4gICAgICB2YXIgcmVxdWVzdERhdGEgPSB7fSxcbiAgICAgICAgc2NvcGUgPSB0aGlzO1xuXG4gICAgICBpZiAoXG4gICAgICAgIG9wdGlvbnMuZGF0YS5maWx0ZXIgJiZcbiAgICAgICAgb3B0aW9ucy5kYXRhLmZpbHRlci5maWx0ZXJzICYmXG4gICAgICAgIG9wdGlvbnMuZGF0YS5maWx0ZXIuZmlsdGVycy5sZW5ndGggPiAwXG4gICAgICApIHtcbiAgICAgICAgcmVxdWVzdERhdGEua2V5d29yZCA9IG9wdGlvbnMuZGF0YS5maWx0ZXIuZmlsdGVyc1swXS52YWx1ZTtcbiAgICAgICAgcmVxdWVzdERhdGEub3BlcmF0b3IgPSBvcHRpb25zLmRhdGEuZmlsdGVyLmZpbHRlcnNbMF0ub3BlcmF0b3I7XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5vcHRpb25zLnJlbmRlck9wdGlvbnMub3JkZXJCeSkge1xuICAgICAgICByZXF1ZXN0RGF0YS5vcmRlckJ5ID0gdGhpcy5vcHRpb25zLnJlbmRlck9wdGlvbnMub3JkZXJCeTtcbiAgICAgIH1cblxuICAgICAgaWYgKCF0aGlzLm9wdGlvbnMuc291cmNlVXJpKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICBcIkVudW0gOiBzb3VyY2VVcmkgbXVzdCBiZSBkZWZpbmVkIGlmIHJlbmRlck9wdGlvbiB1c2VTb3VyY2VVcmkgaXMgc2V0IHRvIHRydWVcIlxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgJC5hamF4KHtcbiAgICAgICAgdHlwZTogXCJHRVRcIixcbiAgICAgICAgdXJsOiB0aGlzLm9wdGlvbnMuc291cmNlVXJpLFxuICAgICAgICBkYXRhOiByZXF1ZXN0RGF0YSxcbiAgICAgICAgZGF0YVR5cGU6IFwianNvblwiLFxuICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiB3RW51bV9vbkF1dG9Db21wbGV0ZVN1Y2Nlc3MocmVzdWx0KSB7XG4gICAgICAgICAgdmFyIGluZm8gPSBbXTtcbiAgICAgICAgICBfLmVhY2gocmVzdWx0LmRhdGEuZW51bUl0ZW1zLCBmdW5jdGlvbiB3RW51bV9hbmFseXplUmVzdWx0KGVudW1JdGVtKSB7XG4gICAgICAgICAgICBpbmZvLnB1c2goe1xuICAgICAgICAgICAgICB2YWx1ZTogZW51bUl0ZW0ua2V5LFxuICAgICAgICAgICAgICBkaXNwbGF5VmFsdWU6IGVudW1JdGVtLmxhYmVsIHx8IFwiXCIsXG4gICAgICAgICAgICAgIGV4aXN0czogZW51bUl0ZW0uZXhpc3RzICE9PSBmYWxzZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgaWYgKCFzY29wZS5faXNNdWx0aXBsZSgpKSB7XG4gICAgICAgICAgICBpZiAoc2NvcGUub3B0aW9ucy5hdHRyaWJ1dGVWYWx1ZS52YWx1ZSAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgIV8uY29udGFpbnMoXG4gICAgICAgICAgICAgICAgICBfLnBsdWNrKGluZm8sIFwidmFsdWVcIiksXG4gICAgICAgICAgICAgICAgICBzY29wZS5vcHRpb25zLmF0dHJpYnV0ZVZhbHVlLnZhbHVlXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgICBzY29wZS5vcHRpb25zLmF0dHJpYnV0ZVZhbHVlLmRpc3BsYXlWYWx1ZSA9PT1cbiAgICAgICAgICAgICAgICAgIHNjb3BlLm9wdGlvbnMuYXR0cmlidXRlVmFsdWUudmFsdWVcbiAgICAgICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICAgIHNjb3BlLm9wdGlvbnMuYXR0cmlidXRlVmFsdWUuZGlzcGxheVZhbHVlID0gTXVzdGFjaGUucmVuZGVyKFxuICAgICAgICAgICAgICAgICAgICBzY29wZS5vcHRpb25zLmxhYmVscy5kaXNwbGF5T3RoZXJDaG9pY2UsXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLm9wdGlvbnMuYXR0cmlidXRlVmFsdWVcbiAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGluZm8ucHVzaChzY29wZS5vcHRpb25zLmF0dHJpYnV0ZVZhbHVlKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBfLmVhY2goc2NvcGUub3B0aW9ucy5hdHRyaWJ1dGVWYWx1ZSwgZnVuY3Rpb24gd0VudW1BZGRPdGhlckluVXJpKFxuICAgICAgICAgICAgICBzaW5nbGVWYWx1ZVxuICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgIHZhciBoYXNWYWx1ZSA9IF8uc29tZShpbmZvLCBmdW5jdGlvbiB3RW51bVZlcmlmeVZhbHVlKFxuICAgICAgICAgICAgICAgIHNpbmdsZUluZm9cbiAgICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHNpbmdsZUluZm8udmFsdWUgPT09IHNpbmdsZVZhbHVlLnZhbHVlO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgaWYgKCFoYXNWYWx1ZSkge1xuICAgICAgICAgICAgICAgIGluZm8ucHVzaChzaW5nbGVWYWx1ZSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIG5vdGlmeSB0aGUgZGF0YSBzb3VyY2UgdGhhdCB0aGUgcmVxdWVzdCBzdWNjZWVkZWRcbiAgICAgICAgICBvcHRpb25zLnN1Y2Nlc3MoaW5mbyk7XG4gICAgICAgIH0sXG4gICAgICAgIGVycm9yOiBmdW5jdGlvbiB3RW51bV9vbkF1dG9Db21wbGV0ZUVycm9yKHJlc3VsdCkge1xuICAgICAgICAgIC8vIG5vdGlmeSB0aGUgZGF0YSBzb3VyY2UgdGhhdCB0aGUgcmVxdWVzdCBmYWlsZWRcbiAgICAgICAgICBvcHRpb25zLmVycm9yKHJlc3VsdCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0sXG4gICAgLyoqXG4gICAgICogR2V0IGtlbmRvIG9wdGlvbiBmcm9tIG5vcm1hbCBvcHRpb25zIGFuZCBmcm9tIHJlbmRlck9wdGlvbnMua2VuZG9OdW1lcmljXG4gICAgICogQHJldHVybnMgeyp9XG4gICAgICovXG4gICAgZ2V0S2VuZG9PcHRpb25zOiBmdW5jdGlvbiB3RW51bUdldEtlbmRvT3B0aW9ucygpIHtcbiAgICAgIHZhciBzY29wZSA9IHRoaXMsXG4gICAgICAgIHNvdXJjZSA9IG51bGwsXG4gICAgICAgIGtlbmRvT3B0aW9ucyA9IHt9LFxuICAgICAgICBkZWZhdWx0T3B0aW9ucyA9IHt9O1xuXG4gICAgICBpZiAodGhpcy5faXNNdWx0aXBsZSgpKSB7XG4gICAgICAgIHNvdXJjZSA9IHRoaXMuZ2V0TXVsdGlwbGVFbnVtRGF0YSgpO1xuXG4gICAgICAgIGRlZmF1bHRPcHRpb25zID0ge1xuICAgICAgICAgIGRhdGFUZXh0RmllbGQ6IFwiZGlzcGxheVZhbHVlXCIsXG4gICAgICAgICAgZGF0YVZhbHVlRmllbGQ6IFwidmFsdWVcIixcbiAgICAgICAgICBjbGVhckJ1dHRvbjogZmFsc2UsXG4gICAgICAgICAgZGF0YVNvdXJjZTogdGhpcy5vcHRpb25zLnJlbmRlck9wdGlvbnMudXNlU291cmNlVXJpXG4gICAgICAgICAgICA/IHNvdXJjZS5kYXRhXG4gICAgICAgICAgICA6IG5ldyBrZW5kby5kYXRhLkRhdGFTb3VyY2Uoe1xuICAgICAgICAgICAgICAgIGRhdGE6IHNvdXJjZS5kYXRhLFxuICAgICAgICAgICAgICAgIHNjaGVtYTogeyBtb2RlbDogeyBpZDogXCJ2YWx1ZVwiIH0gfVxuICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICBwbGFjZWhvbGRlcjogdGhpcy5vcHRpb25zLnJlbmRlck9wdGlvbnMucGxhY2VIb2xkZXIsXG4gICAgICAgICAgdmFsdWU6IHNvdXJjZS5zZWxlY3RlZFZhbHVlcyxcblxuICAgICAgICAgIGNoYW5nZTogZnVuY3Rpb24gd0VudW1fb25DaGFuZ2UoZXZlbnQpIHtcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7IC8vIG5vIGZpcmUgY2hhbmdlIGV2ZW50XG4gICAgICAgICAgICAvLyBzZXQgaW4gY2FzZSBvZiBkZWxldGUgaXRlbVxuXG4gICAgICAgICAgICB2YXIga2REYXRhID0gXy50b0FycmF5KFxuICAgICAgICAgICAgICBzY29wZS5rZW5kb1dpZGdldC5kYXRhKFwia2VuZG9NdWx0aVNlbGVjdFwiKS5kYXRhSXRlbXMoKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIHZhciBuZXdWYWx1ZXMgPSBbXTtcbiAgICAgICAgICAgIF8uZWFjaChrZERhdGEsIGZ1bmN0aW9uIHdFbnVtX3B1c2hOZXdWYWx1ZXModmFsKSB7XG4gICAgICAgICAgICAgIG5ld1ZhbHVlcy5wdXNoKHtcbiAgICAgICAgICAgICAgICB2YWx1ZTogdmFsLnZhbHVlLFxuICAgICAgICAgICAgICAgIGRpc3BsYXlWYWx1ZTogdmFsLmRpc3BsYXlWYWx1ZSxcbiAgICAgICAgICAgICAgICBleGlzdHM6IHZhbC5leGlzdHMgIT09IGZhbHNlXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBzY29wZS5zZXRWYWx1ZShuZXdWYWx1ZXMsIGV2ZW50KTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIG9wZW46IGZ1bmN0aW9uIHdFbnVtX29wZW4oZXZlbnQpIHtcbiAgICAgICAgICAgIF8uYmluZChzY29wZS5fa09wZW4sIHNjb3BlLCBldmVudCwgdGhpcykoKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIC8qKlxuICAgICAgICAgICAqIFdoZW4gb3RoZXIgaW5wdXQgaXMgaW4gbGlzdCBkbyBub3QgYXV0b2Nsb3NlIGxpc3QgdG8gZW50ZXIgYSBuZXcgdmFsdWVcbiAgICAgICAgICAgKiBAcGFyYW0gZXZlbnRcbiAgICAgICAgICAgKi9cbiAgICAgICAgICBjbG9zZTogZnVuY3Rpb24gd0VudW1fbXVsdGlwbGVDbG9zZShldmVudCkge1xuICAgICAgICAgICAgXy5iaW5kKHNjb3BlLl9rQ2xvc2UsIHNjb3BlLCBldmVudCwgdGhpcykoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgaWYgKFxuICAgICAgICAgIF8uaXNPYmplY3Qoc2NvcGUub3B0aW9ucy5yZW5kZXJPcHRpb25zLmtlbmRvTXVsdGlTZWxlY3RDb25maWd1cmF0aW9uKVxuICAgICAgICApIHtcbiAgICAgICAgICBrZW5kb09wdGlvbnMgPVxuICAgICAgICAgICAgc2NvcGUub3B0aW9ucy5yZW5kZXJPcHRpb25zLmtlbmRvTXVsdGlTZWxlY3RDb25maWd1cmF0aW9uO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzb3VyY2UgPSB0aGlzLmdldFNpbmdsZUVudW1EYXRhKCk7XG5cbiAgICAgICAgZGVmYXVsdE9wdGlvbnMgPSB7XG4gICAgICAgICAgLyp2YWx1ZVByaW1pdGl2ZTogdHJ1ZSwqL1xuICAgICAgICAgIGRhdGFUZXh0RmllbGQ6IFwiZGlzcGxheVZhbHVlXCIsXG4gICAgICAgICAgZGF0YVZhbHVlRmllbGQ6IFwidmFsdWVcIixcbiAgICAgICAgICBjbGVhckJ1dHRvbjogZmFsc2UsXG4gICAgICAgICAgb3B0aW9uTGFiZWw6IHtcbiAgICAgICAgICAgIGRpc3BsYXlWYWx1ZTogdGhpcy5vcHRpb25zLnJlbmRlck9wdGlvbnMucGxhY2VIb2xkZXIgKyBcIiBcIixcbiAgICAgICAgICAgIHZhbHVlOiBcIlwiLFxuICAgICAgICAgICAgZXhpc3RzOiB0cnVlXG4gICAgICAgICAgfSxcbiAgICAgICAgICBvcHRpb25MYWJlbFRlbXBsYXRlOlxuICAgICAgICAgICAgJzxzcGFuIGNsYXNzPVwicGxhY2Vob2xkZXJcIj4jOiBkaXNwbGF5VmFsdWUgIzwvc3Bhbj4nLFxuICAgICAgICAgIGRhdGFTb3VyY2U6IHRoaXMub3B0aW9ucy5yZW5kZXJPcHRpb25zLnVzZVNvdXJjZVVyaVxuICAgICAgICAgICAgPyBzb3VyY2UuZGF0YVxuICAgICAgICAgICAgOiBuZXcga2VuZG8uZGF0YS5EYXRhU291cmNlKHtcbiAgICAgICAgICAgICAgICBkYXRhOiBzb3VyY2UuZGF0YSxcbiAgICAgICAgICAgICAgICBzY2hlbWE6IHsgbW9kZWw6IHsgaWQ6IFwidmFsdWVcIiB9IH1cbiAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgaW5kZXg6IHNvdXJjZS5pbmRleCA8IDAgPyB1bmRlZmluZWQgOiBzb3VyY2UuaW5kZXgsXG4gICAgICAgICAgYXV0b0JpbmQ6IGZhbHNlLFxuXG4gICAgICAgICAgY2hhbmdlOiBmdW5jdGlvbiB3RW51bV9vbkNoYW5nZShldmVudCkge1xuICAgICAgICAgICAgaWYgKHRoaXMudmFsdWUoKSAmJiB0aGlzLnNlbGVjdGVkSW5kZXggPT09IC0xKSB7XG4gICAgICAgICAgICAgIHNjb3BlLnNldEVycm9yKHNjb3BlLm9wdGlvbnMubGFiZWxzLmludmFsaWRFbnRyeSk7XG4gICAgICAgICAgICAgIHNjb3BlLl9nZXRGb2N1c0lucHV0KCkuZWFjaChmdW5jdGlvbiB3RW51bV9vbkNoYW5nZSgpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmZvY3VzKCk7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgc2NvcGUuc2V0RXJyb3IobnVsbCk7XG5cbiAgICAgICAgICAgICAgdmFyIG5ld1ZhbHVlID0geyB2YWx1ZTogdGhpcy52YWx1ZSgpLCBkaXNwbGF5VmFsdWU6IHRoaXMudGV4dCgpIH07XG4gICAgICAgICAgICAgIHNjb3BlLnNldFZhbHVlKG5ld1ZhbHVlLCBldmVudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICBkYXRhQm91bmQ6IGZ1bmN0aW9uIHdFbnVtX2RhdGFCb3VuZCgpIHtcbiAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgc2NvcGUub3B0aW9ucy5yZW5kZXJPcHRpb25zLnVzZUZpcnN0Q2hvaWNlICYmXG4gICAgICAgICAgICAgIHNjb3BlLm9wdGlvbnMuYXR0cmlidXRlVmFsdWUudmFsdWUgPT09IG51bGxcbiAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAvLyBTZXQgdG8gZmlyc3QgZW51bSBpdGVtIGlmIGVtcHR5XG4gICAgICAgICAgICAgIHZhciBmaXJzdEl0ZW0gPSB0aGlzLmRhdGFTb3VyY2UuYXQoMCk7XG4gICAgICAgICAgICAgIGlmIChmaXJzdEl0ZW0pIHtcbiAgICAgICAgICAgICAgICBzY29wZS5zZXRWYWx1ZSh7XG4gICAgICAgICAgICAgICAgICB2YWx1ZTogZmlyc3RJdGVtLnZhbHVlLFxuICAgICAgICAgICAgICAgICAgZGlzcGxheVZhbHVlOiBmaXJzdEl0ZW0uZGlzcGxheVZhbHVlXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIG9wZW46IGZ1bmN0aW9uIHdFbnVtX29wZW4oZXZlbnQpIHtcbiAgICAgICAgICAgIF8uYmluZChzY29wZS5fa09wZW4sIHNjb3BlLCBldmVudCwgdGhpcykoKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIC8qKlxuICAgICAgICAgICAqIFdoZW4gb3RoZXIgaW5wdXQgaXMgaW4gbGlzdCBkbyBub3QgYXV0b2Nsb3NlIGxpc3QgdG8gZW50ZXIgYSBuZXcgdmFsdWVcbiAgICAgICAgICAgKiBAcGFyYW0gZXZlbnRcbiAgICAgICAgICAgKi9cbiAgICAgICAgICBjbG9zZTogZnVuY3Rpb24gd0VudW1fY2xvc2UoZXZlbnQpIHtcbiAgICAgICAgICAgIF8uYmluZChzY29wZS5fa0Nsb3NlLCBzY29wZSwgZXZlbnQsIHRoaXMpKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMucmVuZGVyT3B0aW9ucy5lZGl0RGlzcGxheSA9PT0gXCJhdXRvQ29tcGxldGlvblwiKSB7XG4gICAgICAgICAgZGVmYXVsdE9wdGlvbnMuaW5kZXggPSAtMTtcbiAgICAgICAgICBkZWZhdWx0T3B0aW9ucy52YWx1ZSA9IHRoaXMub3B0aW9ucy5hdHRyaWJ1dGVWYWx1ZS52YWx1ZTtcbiAgICAgICAgICBkZWZhdWx0T3B0aW9ucy5wbGFjZWhvbGRlciA9IHRoaXMub3B0aW9ucy5yZW5kZXJPcHRpb25zLnBsYWNlSG9sZGVyO1xuXG4gICAgICAgICAgaWYgKFxuICAgICAgICAgICAgXy5pc09iamVjdChzY29wZS5vcHRpb25zLnJlbmRlck9wdGlvbnMua2VuZG9Db21ib0JveENvbmZpZ3VyYXRpb24pXG4gICAgICAgICAgKSB7XG4gICAgICAgICAgICBrZW5kb09wdGlvbnMgPVxuICAgICAgICAgICAgICBzY29wZS5vcHRpb25zLnJlbmRlck9wdGlvbnMua2VuZG9Db21ib0JveENvbmZpZ3VyYXRpb247XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGlmIChcbiAgICAgICAgICAgIF8uaXNPYmplY3Qoc2NvcGUub3B0aW9ucy5yZW5kZXJPcHRpb25zLmtlbmRvRHJvcERvd25Db25maWd1cmF0aW9uKVxuICAgICAgICAgICkge1xuICAgICAgICAgICAga2VuZG9PcHRpb25zID1cbiAgICAgICAgICAgICAgc2NvcGUub3B0aW9ucy5yZW5kZXJPcHRpb25zLmtlbmRvRHJvcERvd25Db25maWd1cmF0aW9uO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAoc2NvcGUub3B0aW9ucy5yZW5kZXJPcHRpb25zLnVzZU90aGVyQ2hvaWNlID09PSB0cnVlKSB7XG4gICAgICAgIC8vIGFkZCBcIm90aGVyXCIgaW5wdXQgaW4gaGVhZGVyIGxpc3RcbiAgICAgICAgZGVmYXVsdE9wdGlvbnMuaGVhZGVyVGVtcGxhdGUgPSAkKFxuICAgICAgICAgICc8ZGl2PjxkaXYgY2xhc3M9XCJkY3BBdHRyaWJ1dGVfX3ZhbHVlLS1lbnVtLW90aGVyXCI+PGRpdiBjbGFzcz1cImlucHV0LWdyb3VwIGRjcEF0dHJpYnV0ZV9fdmFsdWUtLWVudW0tb3RoZXItY29udGVudFwiPicgK1xuICAgICAgICAgICAgJzxpbnB1dCBjbGFzcz1cImZvcm0tY29udHJvbFwiIHR5cGU9XCJ0ZXh0XCIgcGxhY2Vob2xkZXI9XCInICtcbiAgICAgICAgICAgIHNjb3BlLm9wdGlvbnMubGFiZWxzLmNob29zZUFub3RoZXJDaG9pY2UgK1xuICAgICAgICAgICAgJ1wiLz4nICtcbiAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwiaW5wdXQtZ3JvdXAtYXBwZW5kXCI+IDxkaXYgY2xhc3M9XCJpbnB1dC1ncm91cC10ZXh0XCI+JyArXG4gICAgICAgICAgICAnPGJ1dHRvbiBjbGFzcz1cImJ0biBidG4tcHJpbWFyeSBkY3BBdHRyaWJ1dGVfX3ZhbHVlLS1lbnVtLW90aGVyLXNlbGVjdFwiPicgK1xuICAgICAgICAgICAgc2NvcGUub3B0aW9ucy5sYWJlbHMuc2VsZWN0QW5vdGhlckNob2ljZSArXG4gICAgICAgICAgICBcIjwvYnV0dG9uPjwvZGl2PiBcIiArXG4gICAgICAgICAgICBcIjwvZGl2PjwvZGl2PjwvZGl2PjwvZGl2PlwiXG4gICAgICAgICkuaHRtbCgpO1xuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy5vcHRpb25zLnJlbmRlck9wdGlvbnMudXNlU291cmNlVXJpKSB7XG4gICAgICAgIGRlZmF1bHRPcHRpb25zLmRhdGFTb3VyY2UgPSB7XG4gICAgICAgICAgZGF0YTogc291cmNlLmRhdGEsXG4gICAgICAgICAgaW5kZXg6IHNvdXJjZS5pbmRleCxcbiAgICAgICAgICAvLyB0eXBlOiBcImpzb25cIixcbiAgICAgICAgICBzZXJ2ZXJGaWx0ZXJpbmc6IHRydWUsXG4gICAgICAgICAgbWluTGVuZ3RoOiAwLFxuICAgICAgICAgIHRyYW5zcG9ydDoge1xuICAgICAgICAgICAgcmVhZDogXy5iaW5kKHNjb3BlLmF1dG9jb21wbGV0ZVJlcXVlc3RFbnVtLCBzY29wZSlcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICByZXR1cm4gXy5leHRlbmQoZGVmYXVsdE9wdGlvbnMsIGtlbmRvT3B0aW9ucyk7XG4gICAgfSxcblxuICAgIF9rU2VsZWN0T3RoZXI6IGZ1bmN0aW9uIHdFbnVta1NlbGVjdChldmVudCwga1dpZGdldCwgbmV3VmFsdWUpIHtcbiAgICAgIGtXaWRnZXQuZGF0YVNvdXJjZS5maWx0ZXIoe30pO1xuICAgICAgaWYgKHRoaXMuX2lzTXVsdGlwbGUoKSkge1xuICAgICAgICB2YXIga2REYXRhID0gXy50b0FycmF5KGtXaWRnZXQuZGF0YUl0ZW1zKCkpO1xuICAgICAgICB2YXIgbmV3VmFsdWVzID0gW107XG5cbiAgICAgICAgXy5lYWNoKGtkRGF0YSwgZnVuY3Rpb24gd0VudW1fcHVzaE5ld1ZhbHVlcyh2YWwpIHtcbiAgICAgICAgICBuZXdWYWx1ZXMucHVzaCh7XG4gICAgICAgICAgICB2YWx1ZTogdmFsLnZhbHVlLFxuICAgICAgICAgICAgZGlzcGxheVZhbHVlOiB2YWwuZGlzcGxheVZhbHVlLFxuICAgICAgICAgICAgZXhpc3RzOiB2YWwuZXhpc3RzXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIG5ld1ZhbHVlcy5wdXNoKHtcbiAgICAgICAgICB2YWx1ZTogbmV3VmFsdWUsXG4gICAgICAgICAgZXhpc3RzOiBmYWxzZSxcbiAgICAgICAgICBkaXNwbGF5VmFsdWU6IE11c3RhY2hlLnJlbmRlcihcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucy5sYWJlbHMuZGlzcGxheU90aGVyQ2hvaWNlLFxuICAgICAgICAgICAgeyB2YWx1ZTogbmV3VmFsdWUgfVxuICAgICAgICAgIClcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5zZXRWYWx1ZShuZXdWYWx1ZXMsIGV2ZW50KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuc2V0VmFsdWUoXG4gICAgICAgICAge1xuICAgICAgICAgICAgdmFsdWU6IG5ld1ZhbHVlLFxuICAgICAgICAgICAgZXhpc3RzOiBmYWxzZSxcbiAgICAgICAgICAgIGRpc3BsYXlWYWx1ZTogTXVzdGFjaGUucmVuZGVyKFxuICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMubGFiZWxzLmRpc3BsYXlPdGhlckNob2ljZSxcbiAgICAgICAgICAgICAgeyB2YWx1ZTogbmV3VmFsdWUgfVxuICAgICAgICAgICAgKVxuICAgICAgICAgIH0sXG4gICAgICAgICAgZXZlbnRcbiAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgJChcIi5kY3BBdHRyaWJ1dGVfX3ZhbHVlLS1lbnVtLW90aGVyIGlucHV0XCIpLmJsdXIoKTtcbiAgICAgIGtXaWRnZXQuY2xvc2UoKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogV2hlbiBvdGhlciBpbnB1dCBpcyBpbiBsaXN0IGRvIG5vdCBhdXRvY2xvc2UgbGlzdCB0byBlbnRlciBhIG5ldyB2YWx1ZVxuICAgICAqIEBwYXJhbSBldmVudFxuICAgICAqIEBwYXJhbSBrV2lkZ2V0IGtlbmRvIHdpZGdldFxuICAgICAqL1xuICAgIF9rQ2xvc2U6IGZ1bmN0aW9uIHdFbnVta0Nsb3NlKGV2ZW50LCBrV2lkZ2V0KSB7XG4gICAgICBpZiAodGhpcy5vcHRpb25zLnJlbmRlck9wdGlvbnMudXNlT3RoZXJDaG9pY2UgPT09IHRydWUpIHtcbiAgICAgICAgdmFyICRvdGhlcklucHV0ID0ga1dpZGdldC51bFxuICAgICAgICAgIC5jbG9zZXN0KFwiLmstbGlzdC1jb250YWluZXJcIilcbiAgICAgICAgICAuZmluZChcIi5kY3BBdHRyaWJ1dGVfX3ZhbHVlLS1lbnVtLW90aGVyXCIpO1xuICAgICAgICBpZiAoXG4gICAgICAgICAgJG90aGVySW5wdXQuZGF0YShcImRjcEVudW1PdGhlckZpcnN0Q2xvc2VcIikgIT09IGZhbHNlIHx8XG4gICAgICAgICAgJG90aGVySW5wdXQuZmluZChcImlucHV0XCIpLmlzKFwiOmZvY3VzXCIpXG4gICAgICAgICkge1xuICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgJG90aGVySW5wdXQuZGF0YShcImRjcEVudW1PdGhlckZpcnN0Q2xvc2VcIiwgZmFsc2UpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcblxuICAgIF9rT3BlbjogZnVuY3Rpb24gd0VudW1rT3BlbihldmVudCwga1dpZGdldCkge1xuICAgICAgdmFyIHNjb3BlID0gdGhpcztcbiAgICAgIC8qKlxuICAgICAgICogU3BlY2lhbCBldmVudHMgZm9yIFwib3RoZXJcIiBjaG9pY2UgaW5wdXRcbiAgICAgICAqL1xuICAgICAgaWYgKHRoaXMub3B0aW9ucy5yZW5kZXJPcHRpb25zLnVzZU90aGVyQ2hvaWNlID09PSB0cnVlKSB7XG4gICAgICAgIHZhciAkY29udGFpbmVyID0ga1dpZGdldC51bC5jbG9zZXN0KFwiLmstbGlzdC1jb250YWluZXJcIik7XG4gICAgICAgIHZhciAkb3RoZXJJbnB1dCA9ICRjb250YWluZXIuZmluZChcIi5kY3BBdHRyaWJ1dGVfX3ZhbHVlLS1lbnVtLW90aGVyXCIpO1xuXG4gICAgICAgIGlmIChcbiAgICAgICAgICAkb3RoZXJJbnB1dC5sZW5ndGggPT09IDEgJiZcbiAgICAgICAgICAkb3RoZXJJbnB1dC5kYXRhKFwiZGNwRW51bU90aGVySW5pdGlhbGl6ZWRcIikgIT09IHRydWVcbiAgICAgICAgKSB7XG4gICAgICAgICAgJG90aGVySW5wdXQuZGF0YShcImRjcEVudW1PdGhlckluaXRpYWxpemVkXCIsIHRydWUpO1xuICAgICAgICAgICRvdGhlcklucHV0XG4gICAgICAgICAgICAuZmluZChcIi5kY3BBdHRyaWJ1dGVfX3ZhbHVlLS1lbnVtLW90aGVyLXNlbGVjdFwiKVxuICAgICAgICAgICAgLnByb3AoXCJkaXNhYmxlZFwiLCB0cnVlKTtcbiAgICAgICAgICAkY29udGFpbmVyLnByZXBlbmQoJG90aGVySW5wdXQpO1xuXG4gICAgICAgICAgJG90aGVySW5wdXQub24oXG4gICAgICAgICAgICBcImNsaWNrXCIgKyB0aGlzLmV2ZW50TmFtZXNwYWNlLFxuICAgICAgICAgICAgXCJpbnB1dFwiLFxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBBcHBseSBzZXRWYWx1ZSBhbmQgY2xvc2UgbGlzdCB3aGVuIGNvbmZpcm0gYnV0dG9uIGlzIGNsaWNrZWRcbiAgICAgICAgICAgICAqIEBwYXJhbSBldmVudFxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBmdW5jdGlvbiB3RW51bVNldE90aGVyQ2xpY2soZXZlbnQpIHtcbiAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgJCh0aGlzKS5mb2N1cygpO1xuICAgICAgICAgICAgICAkKHRoaXMpLmRhdGEoXCJkY3BFbnVtT3RoZXJIYXNGb2N1c1wiLCB0cnVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICApO1xuICAgICAgICAgICRjb250YWluZXIub24oXG4gICAgICAgICAgICBcImNsaWNrXCIgKyB0aGlzLmV2ZW50TmFtZXNwYWNlLFxuICAgICAgICAgICAgXCJsaS5rLWl0ZW1cIixcbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogRm9yY2UgY2xvc2UgZm9yIFwibm9ybWFsXCIgY2hvaWNlIGJlY2F1c2UgYXV0b2Nsb3NlIGlzIGRpc2FibGVkXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIGZ1bmN0aW9uIHdFbnVtSXRlbUNsaWNrKCkge1xuICAgICAgICAgICAgICB2YXIgJGlucHV0ID0gJGNvbnRhaW5lci5maW5kKFxuICAgICAgICAgICAgICAgIFwiLmRjcEF0dHJpYnV0ZV9fdmFsdWUtLWVudW0tb3RoZXIgaW5wdXRcIlxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAkaW5wdXQuYmx1cigpO1xuICAgICAgICAgICAgICBrV2lkZ2V0LmNsb3NlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgKTtcblxuICAgICAgICAgICRvdGhlcklucHV0Lm9uKFxuICAgICAgICAgICAgXCJrZXl1cFwiICsgdGhpcy5ldmVudE5hbWVzcGFjZSxcbiAgICAgICAgICAgIFwiaW5wdXRcIixcbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogQXBwbHkgc2V0VmFsdWUgYW5kIGNsb3NlIGxpc3Qgd2hlbiByZXR1cm4ga2V5IGlzIHByZXNzZWRcbiAgICAgICAgICAgICAqIEBwYXJhbSBldmVudFxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBmdW5jdGlvbiB3RW51bVNldE90aGVyS2V5UHJlc3MoZXZlbnQpIHtcbiAgICAgICAgICAgICAgdmFyIGNvZGUgPSBldmVudC5rZXlDb2RlID8gZXZlbnQua2V5Q29kZSA6IGV2ZW50LndoaWNoO1xuICAgICAgICAgICAgICB2YXIgJGlucHV0ID0gJGNvbnRhaW5lci5maW5kKFxuICAgICAgICAgICAgICAgIFwiLmRjcEF0dHJpYnV0ZV9fdmFsdWUtLWVudW0tb3RoZXIgaW5wdXRcIlxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICB2YXIgbmV3VmFsdWUgPSAkaW5wdXQudmFsKCk7XG4gICAgICAgICAgICAgIGlmIChjb2RlID09PSAxMyB8fCBjb2RlID09PSAxMCkge1xuICAgICAgICAgICAgICAgIGlmIChuZXdWYWx1ZSkge1xuICAgICAgICAgICAgICAgICAgXy5iaW5kKFxuICAgICAgICAgICAgICAgICAgICBzY29wZS5fa1NlbGVjdE90aGVyLFxuICAgICAgICAgICAgICAgICAgICBzY29wZSxcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQsXG4gICAgICAgICAgICAgICAgICAgIGtXaWRnZXQsXG4gICAgICAgICAgICAgICAgICAgIG5ld1ZhbHVlXG4gICAgICAgICAgICAgICAgICApKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGtXaWRnZXQuc2VhcmNoKG5ld1ZhbHVlKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAkb3RoZXJJbnB1dFxuICAgICAgICAgICAgICAgIC5maW5kKFwiLmRjcEF0dHJpYnV0ZV9fdmFsdWUtLWVudW0tb3RoZXItc2VsZWN0XCIpXG4gICAgICAgICAgICAgICAgLnByb3AoXCJkaXNhYmxlZFwiLCAhbmV3VmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICk7XG5cbiAgICAgICAgICAkb3RoZXJJbnB1dC5vbihcbiAgICAgICAgICAgIFwiY2xpY2tcIiArIHRoaXMuZXZlbnROYW1lc3BhY2UsXG4gICAgICAgICAgICBcIi5kY3BBdHRyaWJ1dGVfX3ZhbHVlLS1lbnVtLW90aGVyLXNlbGVjdFwiLFxuICAgICAgICAgICAgZnVuY3Rpb24gd0VudW1TZXRPdGhlckNsaWNrKGV2ZW50KSB7XG4gICAgICAgICAgICAgIHZhciAkaW5wdXQgPSAkY29udGFpbmVyLmZpbmQoXG4gICAgICAgICAgICAgICAgXCIuZGNwQXR0cmlidXRlX192YWx1ZS0tZW51bS1vdGhlciBpbnB1dFwiXG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgIHZhciBuZXdWYWx1ZSA9ICRpbnB1dC52YWwoKTtcbiAgICAgICAgICAgICAgaWYgKG5ld1ZhbHVlKSB7XG4gICAgICAgICAgICAgICAgXy5iaW5kKHNjb3BlLl9rU2VsZWN0T3RoZXIsIHNjb3BlLCBldmVudCwga1dpZGdldCwgbmV3VmFsdWUpKCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgJGNvbnRhaW5lclxuICAgICAgICAgIC5maW5kKFwiLmRjcEF0dHJpYnV0ZV9fdmFsdWUtLWVudW0tb3RoZXJcIilcbiAgICAgICAgICAuZGF0YShcImRjcEVudW1PdGhlckZpcnN0Q2xvc2VcIiwgdHJ1ZSk7XG4gICAgICB9XG4gICAgfSxcblxuICAgIGNsb3NlOiBmdW5jdGlvbiB3RW51bV9jbG9zZSgpIHtcbiAgICAgIGlmICh0aGlzLmtlbmRvV2lkZ2V0ICYmIHRoaXMua2VuZG9XaWRnZXQuZGF0YShcImtlbmRvRHJvcERvd25MaXN0XCIpKSB7XG4gICAgICAgIHRoaXMua2VuZG9XaWRnZXQuZGF0YShcImtlbmRvRHJvcERvd25MaXN0XCIpLmNsb3NlKCk7XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5rZW5kb1dpZGdldCAmJiB0aGlzLmtlbmRvV2lkZ2V0LmRhdGEoXCJrZW5kb0NvbWJvQm94XCIpKSB7XG4gICAgICAgIHRoaXMua2VuZG9XaWRnZXQuZGF0YShcImtlbmRvQ29tYm9Cb3hcIikuY2xvc2UoKTtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLmtlbmRvV2lkZ2V0ICYmIHRoaXMua2VuZG9XaWRnZXQuZGF0YShcImtlbmRvTXVsdGlTZWxlY3RcIikpIHtcbiAgICAgICAgdGhpcy5rZW5kb1dpZGdldC5kYXRhKFwia2VuZG9NdWx0aVNlbGVjdFwiKS5jbG9zZSgpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRoaXMuX3N1cGVyKCk7XG4gICAgfSxcblxuICAgIGdldFR5cGU6IGZ1bmN0aW9uIHdFbnVtX2dldFR5cGUoKSB7XG4gICAgICByZXR1cm4gXCJlbnVtXCI7XG4gICAgfSxcblxuICAgIF9kZXN0cm95OiBmdW5jdGlvbiB3RW51bV9kZXN0cm95KCkge1xuICAgICAgaWYgKHRoaXMua2VuZG9XaWRnZXQgJiYgdGhpcy5rZW5kb1dpZGdldC5kYXRhKFwia2VuZG9Ecm9wRG93bkxpc3RcIikpIHtcbiAgICAgICAgdGhpcy5rZW5kb1dpZGdldC5kYXRhKFwia2VuZG9Ecm9wRG93bkxpc3RcIikuZGVzdHJveSgpO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMua2VuZG9XaWRnZXQgJiYgdGhpcy5rZW5kb1dpZGdldC5kYXRhKFwia2VuZG9Db21ib0JveFwiKSkge1xuICAgICAgICB0aGlzLmtlbmRvV2lkZ2V0LmRhdGEoXCJrZW5kb0NvbWJvQm94XCIpLmRlc3Ryb3koKTtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLmtlbmRvV2lkZ2V0ICYmIHRoaXMua2VuZG9XaWRnZXQuZGF0YShcImtlbmRvTXVsdGlTZWxlY3RcIikpIHtcbiAgICAgICAgdGhpcy5rZW5kb1dpZGdldC5kYXRhKFwia2VuZG9NdWx0aVNlbGVjdFwiKS5kZXN0cm95KCk7XG4gICAgICB9XG4gICAgICB0aGlzLl9zdXBlcigpO1xuICAgIH1cbiAgfSk7XG5cbiAgcmV0dXJuICQuZm4uZGNwRW51bTtcbn0pO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQ0EsV0FHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///8df78adf9774feae5b6e\n");

/***/ }),

/***/ "8e08e542008e4aef1f58":
/*!***********************************************!*\
  !*** ./node_modules/underscore/underscore.js ***!
  \***********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("/* WEBPACK VAR INJECTION */(function(global, module) {var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;//     Underscore.js 1.9.1\n//     http://underscorejs.org\n//     (c) 2009-2018 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors\n//     Underscore may be freely distributed under the MIT license.\n\n(function() {\n\n  // Baseline setup\n  // --------------\n\n  // Establish the root object, `window` (`self`) in the browser, `global`\n  // on the server, or `this` in some virtual machines. We use `self`\n  // instead of `window` for `WebWorker` support.\n  var root = typeof self == 'object' && self.self === self && self ||\n            typeof global == 'object' && global.global === global && global ||\n            this ||\n            {};\n\n  // Save the previous value of the `_` variable.\n  var previousUnderscore = root._;\n\n  // Save bytes in the minified (but not gzipped) version:\n  var ArrayProto = Array.prototype, ObjProto = Object.prototype;\n  var SymbolProto = typeof Symbol !== 'undefined' ? Symbol.prototype : null;\n\n  // Create quick reference variables for speed access to core prototypes.\n  var push = ArrayProto.push,\n      slice = ArrayProto.slice,\n      toString = ObjProto.toString,\n      hasOwnProperty = ObjProto.hasOwnProperty;\n\n  // All **ECMAScript 5** native function implementations that we hope to use\n  // are declared here.\n  var nativeIsArray = Array.isArray,\n      nativeKeys = Object.keys,\n      nativeCreate = Object.create;\n\n  // Naked function reference for surrogate-prototype-swapping.\n  var Ctor = function(){};\n\n  // Create a safe reference to the Underscore object for use below.\n  var _ = function(obj) {\n    if (obj instanceof _) return obj;\n    if (!(this instanceof _)) return new _(obj);\n    this._wrapped = obj;\n  };\n\n  // Export the Underscore object for **Node.js**, with\n  // backwards-compatibility for their old module API. If we're in\n  // the browser, add `_` as a global object.\n  // (`nodeType` is checked to ensure that `module`\n  // and `exports` are not HTML elements.)\n  if ( true && !exports.nodeType) {\n    if ( true && !module.nodeType && module.exports) {\n      exports = module.exports = _;\n    }\n    exports._ = _;\n  } else {\n    root._ = _;\n  }\n\n  // Current version.\n  _.VERSION = '1.9.1';\n\n  // Internal function that returns an efficient (for current engines) version\n  // of the passed-in callback, to be repeatedly applied in other Underscore\n  // functions.\n  var optimizeCb = function(func, context, argCount) {\n    if (context === void 0) return func;\n    switch (argCount == null ? 3 : argCount) {\n      case 1: return function(value) {\n        return func.call(context, value);\n      };\n      // The 2-argument case is omitted because were not using it.\n      case 3: return function(value, index, collection) {\n        return func.call(context, value, index, collection);\n      };\n      case 4: return function(accumulator, value, index, collection) {\n        return func.call(context, accumulator, value, index, collection);\n      };\n    }\n    return function() {\n      return func.apply(context, arguments);\n    };\n  };\n\n  var builtinIteratee;\n\n  // An internal function to generate callbacks that can be applied to each\n  // element in a collection, returning the desired result  either `identity`,\n  // an arbitrary callback, a property matcher, or a property accessor.\n  var cb = function(value, context, argCount) {\n    if (_.iteratee !== builtinIteratee) return _.iteratee(value, context);\n    if (value == null) return _.identity;\n    if (_.isFunction(value)) return optimizeCb(value, context, argCount);\n    if (_.isObject(value) && !_.isArray(value)) return _.matcher(value);\n    return _.property(value);\n  };\n\n  // External wrapper for our callback generator. Users may customize\n  // `_.iteratee` if they want additional predicate/iteratee shorthand styles.\n  // This abstraction hides the internal-only argCount argument.\n  _.iteratee = builtinIteratee = function(value, context) {\n    return cb(value, context, Infinity);\n  };\n\n  // Some functions take a variable number of arguments, or a few expected\n  // arguments at the beginning and then a variable number of values to operate\n  // on. This helper accumulates all remaining arguments past the functions\n  // argument length (or an explicit `startIndex`), into an array that becomes\n  // the last argument. Similar to ES6s \"rest parameter\".\n  var restArguments = function(func, startIndex) {\n    startIndex = startIndex == null ? func.length - 1 : +startIndex;\n    return function() {\n      var length = Math.max(arguments.length - startIndex, 0),\n          rest = Array(length),\n          index = 0;\n      for (; index < length; index++) {\n        rest[index] = arguments[index + startIndex];\n      }\n      switch (startIndex) {\n        case 0: return func.call(this, rest);\n        case 1: return func.call(this, arguments[0], rest);\n        case 2: return func.call(this, arguments[0], arguments[1], rest);\n      }\n      var args = Array(startIndex + 1);\n      for (index = 0; index < startIndex; index++) {\n        args[index] = arguments[index];\n      }\n      args[startIndex] = rest;\n      return func.apply(this, args);\n    };\n  };\n\n  // An internal function for creating a new object that inherits from another.\n  var baseCreate = function(prototype) {\n    if (!_.isObject(prototype)) return {};\n    if (nativeCreate) return nativeCreate(prototype);\n    Ctor.prototype = prototype;\n    var result = new Ctor;\n    Ctor.prototype = null;\n    return result;\n  };\n\n  var shallowProperty = function(key) {\n    return function(obj) {\n      return obj == null ? void 0 : obj[key];\n    };\n  };\n\n  var has = function(obj, path) {\n    return obj != null && hasOwnProperty.call(obj, path);\n  }\n\n  var deepGet = function(obj, path) {\n    var length = path.length;\n    for (var i = 0; i < length; i++) {\n      if (obj == null) return void 0;\n      obj = obj[path[i]];\n    }\n    return length ? obj : void 0;\n  };\n\n  // Helper for collection methods to determine whether a collection\n  // should be iterated as an array or as an object.\n  // Related: http://people.mozilla.org/~jorendorff/es6-draft.html#sec-tolength\n  // Avoids a very nasty iOS 8 JIT bug on ARM-64. #2094\n  var MAX_ARRAY_INDEX = Math.pow(2, 53) - 1;\n  var getLength = shallowProperty('length');\n  var isArrayLike = function(collection) {\n    var length = getLength(collection);\n    return typeof length == 'number' && length >= 0 && length <= MAX_ARRAY_INDEX;\n  };\n\n  // Collection Functions\n  // --------------------\n\n  // The cornerstone, an `each` implementation, aka `forEach`.\n  // Handles raw objects in addition to array-likes. Treats all\n  // sparse array-likes as if they were dense.\n  _.each = _.forEach = function(obj, iteratee, context) {\n    iteratee = optimizeCb(iteratee, context);\n    var i, length;\n    if (isArrayLike(obj)) {\n      for (i = 0, length = obj.length; i < length; i++) {\n        iteratee(obj[i], i, obj);\n      }\n    } else {\n      var keys = _.keys(obj);\n      for (i = 0, length = keys.length; i < length; i++) {\n        iteratee(obj[keys[i]], keys[i], obj);\n      }\n    }\n    return obj;\n  };\n\n  // Return the results of applying the iteratee to each element.\n  _.map = _.collect = function(obj, iteratee, context) {\n    iteratee = cb(iteratee, context);\n    var keys = !isArrayLike(obj) && _.keys(obj),\n        length = (keys || obj).length,\n        results = Array(length);\n    for (var index = 0; index < length; index++) {\n      var currentKey = keys ? keys[index] : index;\n      results[index] = iteratee(obj[currentKey], currentKey, obj);\n    }\n    return results;\n  };\n\n  // Create a reducing function iterating left or right.\n  var createReduce = function(dir) {\n    // Wrap code that reassigns argument variables in a separate function than\n    // the one that accesses `arguments.length` to avoid a perf hit. (#1991)\n    var reducer = function(obj, iteratee, memo, initial) {\n      var keys = !isArrayLike(obj) && _.keys(obj),\n          length = (keys || obj).length,\n          index = dir > 0 ? 0 : length - 1;\n      if (!initial) {\n        memo = obj[keys ? keys[index] : index];\n        index += dir;\n      }\n      for (; index >= 0 && index < length; index += dir) {\n        var currentKey = keys ? keys[index] : index;\n        memo = iteratee(memo, obj[currentKey], currentKey, obj);\n      }\n      return memo;\n    };\n\n    return function(obj, iteratee, memo, context) {\n      var initial = arguments.length >= 3;\n      return reducer(obj, optimizeCb(iteratee, context, 4), memo, initial);\n    };\n  };\n\n  // **Reduce** builds up a single result from a list of values, aka `inject`,\n  // or `foldl`.\n  _.reduce = _.foldl = _.inject = createReduce(1);\n\n  // The right-associative version of reduce, also known as `foldr`.\n  _.reduceRight = _.foldr = createReduce(-1);\n\n  // Return the first value which passes a truth test. Aliased as `detect`.\n  _.find = _.detect = function(obj, predicate, context) {\n    var keyFinder = isArrayLike(obj) ? _.findIndex : _.findKey;\n    var key = keyFinder(obj, predicate, context);\n    if (key !== void 0 && key !== -1) return obj[key];\n  };\n\n  // Return all the elements that pass a truth test.\n  // Aliased as `select`.\n  _.filter = _.select = function(obj, predicate, context) {\n    var results = [];\n    predicate = cb(predicate, context);\n    _.each(obj, function(value, index, list) {\n      if (predicate(value, index, list)) results.push(value);\n    });\n    return results;\n  };\n\n  // Return all the elements for which a truth test fails.\n  _.reject = function(obj, predicate, context) {\n    return _.filter(obj, _.negate(cb(predicate)), context);\n  };\n\n  // Determine whether all of the elements match a truth test.\n  // Aliased as `all`.\n  _.every = _.all = function(obj, predicate, context) {\n    predicate = cb(predicate, context);\n    var keys = !isArrayLike(obj) && _.keys(obj),\n        length = (keys || obj).length;\n    for (var index = 0; index < length; index++) {\n      var currentKey = keys ? keys[index] : index;\n      if (!predicate(obj[currentKey], currentKey, obj)) return false;\n    }\n    return true;\n  };\n\n  // Determine if at least one element in the object matches a truth test.\n  // Aliased as `any`.\n  _.some = _.any = function(obj, predicate, context) {\n    predicate = cb(predicate, context);\n    var keys = !isArrayLike(obj) && _.keys(obj),\n        length = (keys || obj).length;\n    for (var index = 0; index < length; index++) {\n      var currentKey = keys ? keys[index] : index;\n      if (predicate(obj[currentKey], currentKey, obj)) return true;\n    }\n    return false;\n  };\n\n  // Determine if the array or object contains a given item (using `===`).\n  // Aliased as `includes` and `include`.\n  _.contains = _.includes = _.include = function(obj, item, fromIndex, guard) {\n    if (!isArrayLike(obj)) obj = _.values(obj);\n    if (typeof fromIndex != 'number' || guard) fromIndex = 0;\n    return _.indexOf(obj, item, fromIndex) >= 0;\n  };\n\n  // Invoke a method (with arguments) on every item in a collection.\n  _.invoke = restArguments(function(obj, path, args) {\n    var contextPath, func;\n    if (_.isFunction(path)) {\n      func = path;\n    } else if (_.isArray(path)) {\n      contextPath = path.slice(0, -1);\n      path = path[path.length - 1];\n    }\n    return _.map(obj, function(context) {\n      var method = func;\n      if (!method) {\n        if (contextPath && contextPath.length) {\n          context = deepGet(context, contextPath);\n        }\n        if (context == null) return void 0;\n        method = context[path];\n      }\n      return method == null ? method : method.apply(context, args);\n    });\n  });\n\n  // Convenience version of a common use case of `map`: fetching a property.\n  _.pluck = function(obj, key) {\n    return _.map(obj, _.property(key));\n  };\n\n  // Convenience version of a common use case of `filter`: selecting only objects\n  // containing specific `key:value` pairs.\n  _.where = function(obj, attrs) {\n    return _.filter(obj, _.matcher(attrs));\n  };\n\n  // Convenience version of a common use case of `find`: getting the first object\n  // containing specific `key:value` pairs.\n  _.findWhere = function(obj, attrs) {\n    return _.find(obj, _.matcher(attrs));\n  };\n\n  // Return the maximum element (or element-based computation).\n  _.max = function(obj, iteratee, context) {\n    var result = -Infinity, lastComputed = -Infinity,\n        value, computed;\n    if (iteratee == null || typeof iteratee == 'number' && typeof obj[0] != 'object' && obj != null) {\n      obj = isArrayLike(obj) ? obj : _.values(obj);\n      for (var i = 0, length = obj.length; i < length; i++) {\n        value = obj[i];\n        if (value != null && value > result) {\n          result = value;\n        }\n      }\n    } else {\n      iteratee = cb(iteratee, context);\n      _.each(obj, function(v, index, list) {\n        computed = iteratee(v, index, list);\n        if (computed > lastComputed || computed === -Infinity && result === -Infinity) {\n          result = v;\n          lastComputed = computed;\n        }\n      });\n    }\n    return result;\n  };\n\n  // Return the minimum element (or element-based computation).\n  _.min = function(obj, iteratee, context) {\n    var result = Infinity, lastComputed = Infinity,\n        value, computed;\n    if (iteratee == null || typeof iteratee == 'number' && typeof obj[0] != 'object' && obj != null) {\n      obj = isArrayLike(obj) ? obj : _.values(obj);\n      for (var i = 0, length = obj.length; i < length; i++) {\n        value = obj[i];\n        if (value != null && value < result) {\n          result = value;\n        }\n      }\n    } else {\n      iteratee = cb(iteratee, context);\n      _.each(obj, function(v, index, list) {\n        computed = iteratee(v, index, list);\n        if (computed < lastComputed || computed === Infinity && result === Infinity) {\n          result = v;\n          lastComputed = computed;\n        }\n      });\n    }\n    return result;\n  };\n\n  // Shuffle a collection.\n  _.shuffle = function(obj) {\n    return _.sample(obj, Infinity);\n  };\n\n  // Sample **n** random values from a collection using the modern version of the\n  // [Fisher-Yates shuffle](http://en.wikipedia.org/wiki/FisherYates_shuffle).\n  // If **n** is not specified, returns a single random element.\n  // The internal `guard` argument allows it to work with `map`.\n  _.sample = function(obj, n, guard) {\n    if (n == null || guard) {\n      if (!isArrayLike(obj)) obj = _.values(obj);\n      return obj[_.random(obj.length - 1)];\n    }\n    var sample = isArrayLike(obj) ? _.clone(obj) : _.values(obj);\n    var length = getLength(sample);\n    n = Math.max(Math.min(n, length), 0);\n    var last = length - 1;\n    for (var index = 0; index < n; index++) {\n      var rand = _.random(index, last);\n      var temp = sample[index];\n      sample[index] = sample[rand];\n      sample[rand] = temp;\n    }\n    return sample.slice(0, n);\n  };\n\n  // Sort the object's values by a criterion produced by an iteratee.\n  _.sortBy = function(obj, iteratee, context) {\n    var index = 0;\n    iteratee = cb(iteratee, context);\n    return _.pluck(_.map(obj, function(value, key, list) {\n      return {\n        value: value,\n        index: index++,\n        criteria: iteratee(value, key, list)\n      };\n    }).sort(function(left, right) {\n      var a = left.criteria;\n      var b = right.criteria;\n      if (a !== b) {\n        if (a > b || a === void 0) return 1;\n        if (a < b || b === void 0) return -1;\n      }\n      return left.index - right.index;\n    }), 'value');\n  };\n\n  // An internal function used for aggregate \"group by\" operations.\n  var group = function(behavior, partition) {\n    return function(obj, iteratee, context) {\n      var result = partition ? [[], []] : {};\n      iteratee = cb(iteratee, context);\n      _.each(obj, function(value, index) {\n        var key = iteratee(value, index, obj);\n        behavior(result, value, key);\n      });\n      return result;\n    };\n  };\n\n  // Groups the object's values by a criterion. Pass either a string attribute\n  // to group by, or a function that returns the criterion.\n  _.groupBy = group(function(result, value, key) {\n    if (has(result, key)) result[key].push(value); else result[key] = [value];\n  });\n\n  // Indexes the object's values by a criterion, similar to `groupBy`, but for\n  // when you know that your index values will be unique.\n  _.indexBy = group(function(result, value, key) {\n    result[key] = value;\n  });\n\n  // Counts instances of an object that group by a certain criterion. Pass\n  // either a string attribute to count by, or a function that returns the\n  // criterion.\n  _.countBy = group(function(result, value, key) {\n    if (has(result, key)) result[key]++; else result[key] = 1;\n  });\n\n  var reStrSymbol = /[^\\ud800-\\udfff]|[\\ud800-\\udbff][\\udc00-\\udfff]|[\\ud800-\\udfff]/g;\n  // Safely create a real, live array from anything iterable.\n  _.toArray = function(obj) {\n    if (!obj) return [];\n    if (_.isArray(obj)) return slice.call(obj);\n    if (_.isString(obj)) {\n      // Keep surrogate pair characters together\n      return obj.match(reStrSymbol);\n    }\n    if (isArrayLike(obj)) return _.map(obj, _.identity);\n    return _.values(obj);\n  };\n\n  // Return the number of elements in an object.\n  _.size = function(obj) {\n    if (obj == null) return 0;\n    return isArrayLike(obj) ? obj.length : _.keys(obj).length;\n  };\n\n  // Split a collection into two arrays: one whose elements all satisfy the given\n  // predicate, and one whose elements all do not satisfy the predicate.\n  _.partition = group(function(result, value, pass) {\n    result[pass ? 0 : 1].push(value);\n  }, true);\n\n  // Array Functions\n  // ---------------\n\n  // Get the first element of an array. Passing **n** will return the first N\n  // values in the array. Aliased as `head` and `take`. The **guard** check\n  // allows it to work with `_.map`.\n  _.first = _.head = _.take = function(array, n, guard) {\n    if (array == null || array.length < 1) return n == null ? void 0 : [];\n    if (n == null || guard) return array[0];\n    return _.initial(array, array.length - n);\n  };\n\n  // Returns everything but the last entry of the array. Especially useful on\n  // the arguments object. Passing **n** will return all the values in\n  // the array, excluding the last N.\n  _.initial = function(array, n, guard) {\n    return slice.call(array, 0, Math.max(0, array.length - (n == null || guard ? 1 : n)));\n  };\n\n  // Get the last element of an array. Passing **n** will return the last N\n  // values in the array.\n  _.last = function(array, n, guard) {\n    if (array == null || array.length < 1) return n == null ? void 0 : [];\n    if (n == null || guard) return array[array.length - 1];\n    return _.rest(array, Math.max(0, array.length - n));\n  };\n\n  // Returns everything but the first entry of the array. Aliased as `tail` and `drop`.\n  // Especially useful on the arguments object. Passing an **n** will return\n  // the rest N values in the array.\n  _.rest = _.tail = _.drop = function(array, n, guard) {\n    return slice.call(array, n == null || guard ? 1 : n);\n  };\n\n  // Trim out all falsy values from an array.\n  _.compact = function(array) {\n    return _.filter(array, Boolean);\n  };\n\n  // Internal implementation of a recursive `flatten` function.\n  var flatten = function(input, shallow, strict, output) {\n    output = output || [];\n    var idx = output.length;\n    for (var i = 0, length = getLength(input); i < length; i++) {\n      var value = input[i];\n      if (isArrayLike(value) && (_.isArray(value) || _.isArguments(value))) {\n        // Flatten current level of array or arguments object.\n        if (shallow) {\n          var j = 0, len = value.length;\n          while (j < len) output[idx++] = value[j++];\n        } else {\n          flatten(value, shallow, strict, output);\n          idx = output.length;\n        }\n      } else if (!strict) {\n        output[idx++] = value;\n      }\n    }\n    return output;\n  };\n\n  // Flatten out an array, either recursively (by default), or just one level.\n  _.flatten = function(array, shallow) {\n    return flatten(array, shallow, false);\n  };\n\n  // Return a version of the array that does not contain the specified value(s).\n  _.without = restArguments(function(array, otherArrays) {\n    return _.difference(array, otherArrays);\n  });\n\n  // Produce a duplicate-free version of the array. If the array has already\n  // been sorted, you have the option of using a faster algorithm.\n  // The faster algorithm will not work with an iteratee if the iteratee\n  // is not a one-to-one function, so providing an iteratee will disable\n  // the faster algorithm.\n  // Aliased as `unique`.\n  _.uniq = _.unique = function(array, isSorted, iteratee, context) {\n    if (!_.isBoolean(isSorted)) {\n      context = iteratee;\n      iteratee = isSorted;\n      isSorted = false;\n    }\n    if (iteratee != null) iteratee = cb(iteratee, context);\n    var result = [];\n    var seen = [];\n    for (var i = 0, length = getLength(array); i < length; i++) {\n      var value = array[i],\n          computed = iteratee ? iteratee(value, i, array) : value;\n      if (isSorted && !iteratee) {\n        if (!i || seen !== computed) result.push(value);\n        seen = computed;\n      } else if (iteratee) {\n        if (!_.contains(seen, computed)) {\n          seen.push(computed);\n          result.push(value);\n        }\n      } else if (!_.contains(result, value)) {\n        result.push(value);\n      }\n    }\n    return result;\n  };\n\n  // Produce an array that contains the union: each distinct element from all of\n  // the passed-in arrays.\n  _.union = restArguments(function(arrays) {\n    return _.uniq(flatten(arrays, true, true));\n  });\n\n  // Produce an array that contains every item shared between all the\n  // passed-in arrays.\n  _.intersection = function(array) {\n    var result = [];\n    var argsLength = arguments.length;\n    for (var i = 0, length = getLength(array); i < length; i++) {\n      var item = array[i];\n      if (_.contains(result, item)) continue;\n      var j;\n      for (j = 1; j < argsLength; j++) {\n        if (!_.contains(arguments[j], item)) break;\n      }\n      if (j === argsLength) result.push(item);\n    }\n    return result;\n  };\n\n  // Take the difference between one array and a number of other arrays.\n  // Only the elements present in just the first array will remain.\n  _.difference = restArguments(function(array, rest) {\n    rest = flatten(rest, true, true);\n    return _.filter(array, function(value){\n      return !_.contains(rest, value);\n    });\n  });\n\n  // Complement of _.zip. Unzip accepts an array of arrays and groups\n  // each array's elements on shared indices.\n  _.unzip = function(array) {\n    var length = array && _.max(array, getLength).length || 0;\n    var result = Array(length);\n\n    for (var index = 0; index < length; index++) {\n      result[index] = _.pluck(array, index);\n    }\n    return result;\n  };\n\n  // Zip together multiple lists into a single array -- elements that share\n  // an index go together.\n  _.zip = restArguments(_.unzip);\n\n  // Converts lists into objects. Pass either a single array of `[key, value]`\n  // pairs, or two parallel arrays of the same length -- one of keys, and one of\n  // the corresponding values. Passing by pairs is the reverse of _.pairs.\n  _.object = function(list, values) {\n    var result = {};\n    for (var i = 0, length = getLength(list); i < length; i++) {\n      if (values) {\n        result[list[i]] = values[i];\n      } else {\n        result[list[i][0]] = list[i][1];\n      }\n    }\n    return result;\n  };\n\n  // Generator function to create the findIndex and findLastIndex functions.\n  var createPredicateIndexFinder = function(dir) {\n    return function(array, predicate, context) {\n      predicate = cb(predicate, context);\n      var length = getLength(array);\n      var index = dir > 0 ? 0 : length - 1;\n      for (; index >= 0 && index < length; index += dir) {\n        if (predicate(array[index], index, array)) return index;\n      }\n      return -1;\n    };\n  };\n\n  // Returns the first index on an array-like that passes a predicate test.\n  _.findIndex = createPredicateIndexFinder(1);\n  _.findLastIndex = createPredicateIndexFinder(-1);\n\n  // Use a comparator function to figure out the smallest index at which\n  // an object should be inserted so as to maintain order. Uses binary search.\n  _.sortedIndex = function(array, obj, iteratee, context) {\n    iteratee = cb(iteratee, context, 1);\n    var value = iteratee(obj);\n    var low = 0, high = getLength(array);\n    while (low < high) {\n      var mid = Math.floor((low + high) / 2);\n      if (iteratee(array[mid]) < value) low = mid + 1; else high = mid;\n    }\n    return low;\n  };\n\n  // Generator function to create the indexOf and lastIndexOf functions.\n  var createIndexFinder = function(dir, predicateFind, sortedIndex) {\n    return function(array, item, idx) {\n      var i = 0, length = getLength(array);\n      if (typeof idx == 'number') {\n        if (dir > 0) {\n          i = idx >= 0 ? idx : Math.max(idx + length, i);\n        } else {\n          length = idx >= 0 ? Math.min(idx + 1, length) : idx + length + 1;\n        }\n      } else if (sortedIndex && idx && length) {\n        idx = sortedIndex(array, item);\n        return array[idx] === item ? idx : -1;\n      }\n      if (item !== item) {\n        idx = predicateFind(slice.call(array, i, length), _.isNaN);\n        return idx >= 0 ? idx + i : -1;\n      }\n      for (idx = dir > 0 ? i : length - 1; idx >= 0 && idx < length; idx += dir) {\n        if (array[idx] === item) return idx;\n      }\n      return -1;\n    };\n  };\n\n  // Return the position of the first occurrence of an item in an array,\n  // or -1 if the item is not included in the array.\n  // If the array is large and already in sort order, pass `true`\n  // for **isSorted** to use binary search.\n  _.indexOf = createIndexFinder(1, _.findIndex, _.sortedIndex);\n  _.lastIndexOf = createIndexFinder(-1, _.findLastIndex);\n\n  // Generate an integer Array containing an arithmetic progression. A port of\n  // the native Python `range()` function. See\n  // [the Python documentation](http://docs.python.org/library/functions.html#range).\n  _.range = function(start, stop, step) {\n    if (stop == null) {\n      stop = start || 0;\n      start = 0;\n    }\n    if (!step) {\n      step = stop < start ? -1 : 1;\n    }\n\n    var length = Math.max(Math.ceil((stop - start) / step), 0);\n    var range = Array(length);\n\n    for (var idx = 0; idx < length; idx++, start += step) {\n      range[idx] = start;\n    }\n\n    return range;\n  };\n\n  // Chunk a single array into multiple arrays, each containing `count` or fewer\n  // items.\n  _.chunk = function(array, count) {\n    if (count == null || count < 1) return [];\n    var result = [];\n    var i = 0, length = array.length;\n    while (i < length) {\n      result.push(slice.call(array, i, i += count));\n    }\n    return result;\n  };\n\n  // Function (ahem) Functions\n  // ------------------\n\n  // Determines whether to execute a function as a constructor\n  // or a normal function with the provided arguments.\n  var executeBound = function(sourceFunc, boundFunc, context, callingContext, args) {\n    if (!(callingContext instanceof boundFunc)) return sourceFunc.apply(context, args);\n    var self = baseCreate(sourceFunc.prototype);\n    var result = sourceFunc.apply(self, args);\n    if (_.isObject(result)) return result;\n    return self;\n  };\n\n  // Create a function bound to a given object (assigning `this`, and arguments,\n  // optionally). Delegates to **ECMAScript 5**'s native `Function.bind` if\n  // available.\n  _.bind = restArguments(function(func, context, args) {\n    if (!_.isFunction(func)) throw new TypeError('Bind must be called on a function');\n    var bound = restArguments(function(callArgs) {\n      return executeBound(func, bound, context, this, args.concat(callArgs));\n    });\n    return bound;\n  });\n\n  // Partially apply a function by creating a version that has had some of its\n  // arguments pre-filled, without changing its dynamic `this` context. _ acts\n  // as a placeholder by default, allowing any combination of arguments to be\n  // pre-filled. Set `_.partial.placeholder` for a custom placeholder argument.\n  _.partial = restArguments(function(func, boundArgs) {\n    var placeholder = _.partial.placeholder;\n    var bound = function() {\n      var position = 0, length = boundArgs.length;\n      var args = Array(length);\n      for (var i = 0; i < length; i++) {\n        args[i] = boundArgs[i] === placeholder ? arguments[position++] : boundArgs[i];\n      }\n      while (position < arguments.length) args.push(arguments[position++]);\n      return executeBound(func, bound, this, this, args);\n    };\n    return bound;\n  });\n\n  _.partial.placeholder = _;\n\n  // Bind a number of an object's methods to that object. Remaining arguments\n  // are the method names to be bound. Useful for ensuring that all callbacks\n  // defined on an object belong to it.\n  _.bindAll = restArguments(function(obj, keys) {\n    keys = flatten(keys, false, false);\n    var index = keys.length;\n    if (index < 1) throw new Error('bindAll must be passed function names');\n    while (index--) {\n      var key = keys[index];\n      obj[key] = _.bind(obj[key], obj);\n    }\n  });\n\n  // Memoize an expensive function by storing its results.\n  _.memoize = function(func, hasher) {\n    var memoize = function(key) {\n      var cache = memoize.cache;\n      var address = '' + (hasher ? hasher.apply(this, arguments) : key);\n      if (!has(cache, address)) cache[address] = func.apply(this, arguments);\n      return cache[address];\n    };\n    memoize.cache = {};\n    return memoize;\n  };\n\n  // Delays a function for the given number of milliseconds, and then calls\n  // it with the arguments supplied.\n  _.delay = restArguments(function(func, wait, args) {\n    return setTimeout(function() {\n      return func.apply(null, args);\n    }, wait);\n  });\n\n  // Defers a function, scheduling it to run after the current call stack has\n  // cleared.\n  _.defer = _.partial(_.delay, _, 1);\n\n  // Returns a function, that, when invoked, will only be triggered at most once\n  // during a given window of time. Normally, the throttled function will run\n  // as much as it can, without ever going more than once per `wait` duration;\n  // but if you'd like to disable the execution on the leading edge, pass\n  // `{leading: false}`. To disable execution on the trailing edge, ditto.\n  _.throttle = function(func, wait, options) {\n    var timeout, context, args, result;\n    var previous = 0;\n    if (!options) options = {};\n\n    var later = function() {\n      previous = options.leading === false ? 0 : _.now();\n      timeout = null;\n      result = func.apply(context, args);\n      if (!timeout) context = args = null;\n    };\n\n    var throttled = function() {\n      var now = _.now();\n      if (!previous && options.leading === false) previous = now;\n      var remaining = wait - (now - previous);\n      context = this;\n      args = arguments;\n      if (remaining <= 0 || remaining > wait) {\n        if (timeout) {\n          clearTimeout(timeout);\n          timeout = null;\n        }\n        previous = now;\n        result = func.apply(context, args);\n        if (!timeout) context = args = null;\n      } else if (!timeout && options.trailing !== false) {\n        timeout = setTimeout(later, remaining);\n      }\n      return result;\n    };\n\n    throttled.cancel = function() {\n      clearTimeout(timeout);\n      previous = 0;\n      timeout = context = args = null;\n    };\n\n    return throttled;\n  };\n\n  // Returns a function, that, as long as it continues to be invoked, will not\n  // be triggered. The function will be called after it stops being called for\n  // N milliseconds. If `immediate` is passed, trigger the function on the\n  // leading edge, instead of the trailing.\n  _.debounce = function(func, wait, immediate) {\n    var timeout, result;\n\n    var later = function(context, args) {\n      timeout = null;\n      if (args) result = func.apply(context, args);\n    };\n\n    var debounced = restArguments(function(args) {\n      if (timeout) clearTimeout(timeout);\n      if (immediate) {\n        var callNow = !timeout;\n        timeout = setTimeout(later, wait);\n        if (callNow) result = func.apply(this, args);\n      } else {\n        timeout = _.delay(later, wait, this, args);\n      }\n\n      return result;\n    });\n\n    debounced.cancel = function() {\n      clearTimeout(timeout);\n      timeout = null;\n    };\n\n    return debounced;\n  };\n\n  // Returns the first function passed as an argument to the second,\n  // allowing you to adjust arguments, run code before and after, and\n  // conditionally execute the original function.\n  _.wrap = function(func, wrapper) {\n    return _.partial(wrapper, func);\n  };\n\n  // Returns a negated version of the passed-in predicate.\n  _.negate = function(predicate) {\n    return function() {\n      return !predicate.apply(this, arguments);\n    };\n  };\n\n  // Returns a function that is the composition of a list of functions, each\n  // consuming the return value of the function that follows.\n  _.compose = function() {\n    var args = arguments;\n    var start = args.length - 1;\n    return function() {\n      var i = start;\n      var result = args[start].apply(this, arguments);\n      while (i--) result = args[i].call(this, result);\n      return result;\n    };\n  };\n\n  // Returns a function that will only be executed on and after the Nth call.\n  _.after = function(times, func) {\n    return function() {\n      if (--times < 1) {\n        return func.apply(this, arguments);\n      }\n    };\n  };\n\n  // Returns a function that will only be executed up to (but not including) the Nth call.\n  _.before = function(times, func) {\n    var memo;\n    return function() {\n      if (--times > 0) {\n        memo = func.apply(this, arguments);\n      }\n      if (times <= 1) func = null;\n      return memo;\n    };\n  };\n\n  // Returns a function that will be executed at most one time, no matter how\n  // often you call it. Useful for lazy initialization.\n  _.once = _.partial(_.before, 2);\n\n  _.restArguments = restArguments;\n\n  // Object Functions\n  // ----------------\n\n  // Keys in IE < 9 that won't be iterated by `for key in ...` and thus missed.\n  var hasEnumBug = !{toString: null}.propertyIsEnumerable('toString');\n  var nonEnumerableProps = ['valueOf', 'isPrototypeOf', 'toString',\n    'propertyIsEnumerable', 'hasOwnProperty', 'toLocaleString'];\n\n  var collectNonEnumProps = function(obj, keys) {\n    var nonEnumIdx = nonEnumerableProps.length;\n    var constructor = obj.constructor;\n    var proto = _.isFunction(constructor) && constructor.prototype || ObjProto;\n\n    // Constructor is a special case.\n    var prop = 'constructor';\n    if (has(obj, prop) && !_.contains(keys, prop)) keys.push(prop);\n\n    while (nonEnumIdx--) {\n      prop = nonEnumerableProps[nonEnumIdx];\n      if (prop in obj && obj[prop] !== proto[prop] && !_.contains(keys, prop)) {\n        keys.push(prop);\n      }\n    }\n  };\n\n  // Retrieve the names of an object's own properties.\n  // Delegates to **ECMAScript 5**'s native `Object.keys`.\n  _.keys = function(obj) {\n    if (!_.isObject(obj)) return [];\n    if (nativeKeys) return nativeKeys(obj);\n    var keys = [];\n    for (var key in obj) if (has(obj, key)) keys.push(key);\n    // Ahem, IE < 9.\n    if (hasEnumBug) collectNonEnumProps(obj, keys);\n    return keys;\n  };\n\n  // Retrieve all the property names of an object.\n  _.allKeys = function(obj) {\n    if (!_.isObject(obj)) return [];\n    var keys = [];\n    for (var key in obj) keys.push(key);\n    // Ahem, IE < 9.\n    if (hasEnumBug) collectNonEnumProps(obj, keys);\n    return keys;\n  };\n\n  // Retrieve the values of an object's properties.\n  _.values = function(obj) {\n    var keys = _.keys(obj);\n    var length = keys.length;\n    var values = Array(length);\n    for (var i = 0; i < length; i++) {\n      values[i] = obj[keys[i]];\n    }\n    return values;\n  };\n\n  // Returns the results of applying the iteratee to each element of the object.\n  // In contrast to _.map it returns an object.\n  _.mapObject = function(obj, iteratee, context) {\n    iteratee = cb(iteratee, context);\n    var keys = _.keys(obj),\n        length = keys.length,\n        results = {};\n    for (var index = 0; index < length; index++) {\n      var currentKey = keys[index];\n      results[currentKey] = iteratee(obj[currentKey], currentKey, obj);\n    }\n    return results;\n  };\n\n  // Convert an object into a list of `[key, value]` pairs.\n  // The opposite of _.object.\n  _.pairs = function(obj) {\n    var keys = _.keys(obj);\n    var length = keys.length;\n    var pairs = Array(length);\n    for (var i = 0; i < length; i++) {\n      pairs[i] = [keys[i], obj[keys[i]]];\n    }\n    return pairs;\n  };\n\n  // Invert the keys and values of an object. The values must be serializable.\n  _.invert = function(obj) {\n    var result = {};\n    var keys = _.keys(obj);\n    for (var i = 0, length = keys.length; i < length; i++) {\n      result[obj[keys[i]]] = keys[i];\n    }\n    return result;\n  };\n\n  // Return a sorted list of the function names available on the object.\n  // Aliased as `methods`.\n  _.functions = _.methods = function(obj) {\n    var names = [];\n    for (var key in obj) {\n      if (_.isFunction(obj[key])) names.push(key);\n    }\n    return names.sort();\n  };\n\n  // An internal function for creating assigner functions.\n  var createAssigner = function(keysFunc, defaults) {\n    return function(obj) {\n      var length = arguments.length;\n      if (defaults) obj = Object(obj);\n      if (length < 2 || obj == null) return obj;\n      for (var index = 1; index < length; index++) {\n        var source = arguments[index],\n            keys = keysFunc(source),\n            l = keys.length;\n        for (var i = 0; i < l; i++) {\n          var key = keys[i];\n          if (!defaults || obj[key] === void 0) obj[key] = source[key];\n        }\n      }\n      return obj;\n    };\n  };\n\n  // Extend a given object with all the properties in passed-in object(s).\n  _.extend = createAssigner(_.allKeys);\n\n  // Assigns a given object with all the own properties in the passed-in object(s).\n  // (https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object/assign)\n  _.extendOwn = _.assign = createAssigner(_.keys);\n\n  // Returns the first key on an object that passes a predicate test.\n  _.findKey = function(obj, predicate, context) {\n    predicate = cb(predicate, context);\n    var keys = _.keys(obj), key;\n    for (var i = 0, length = keys.length; i < length; i++) {\n      key = keys[i];\n      if (predicate(obj[key], key, obj)) return key;\n    }\n  };\n\n  // Internal pick helper function to determine if `obj` has key `key`.\n  var keyInObj = function(value, key, obj) {\n    return key in obj;\n  };\n\n  // Return a copy of the object only containing the whitelisted properties.\n  _.pick = restArguments(function(obj, keys) {\n    var result = {}, iteratee = keys[0];\n    if (obj == null) return result;\n    if (_.isFunction(iteratee)) {\n      if (keys.length > 1) iteratee = optimizeCb(iteratee, keys[1]);\n      keys = _.allKeys(obj);\n    } else {\n      iteratee = keyInObj;\n      keys = flatten(keys, false, false);\n      obj = Object(obj);\n    }\n    for (var i = 0, length = keys.length; i < length; i++) {\n      var key = keys[i];\n      var value = obj[key];\n      if (iteratee(value, key, obj)) result[key] = value;\n    }\n    return result;\n  });\n\n  // Return a copy of the object without the blacklisted properties.\n  _.omit = restArguments(function(obj, keys) {\n    var iteratee = keys[0], context;\n    if (_.isFunction(iteratee)) {\n      iteratee = _.negate(iteratee);\n      if (keys.length > 1) context = keys[1];\n    } else {\n      keys = _.map(flatten(keys, false, false), String);\n      iteratee = function(value, key) {\n        return !_.contains(keys, key);\n      };\n    }\n    return _.pick(obj, iteratee, context);\n  });\n\n  // Fill in a given object with default properties.\n  _.defaults = createAssigner(_.allKeys, true);\n\n  // Creates an object that inherits from the given prototype object.\n  // If additional properties are provided then they will be added to the\n  // created object.\n  _.create = function(prototype, props) {\n    var result = baseCreate(prototype);\n    if (props) _.extendOwn(result, props);\n    return result;\n  };\n\n  // Create a (shallow-cloned) duplicate of an object.\n  _.clone = function(obj) {\n    if (!_.isObject(obj)) return obj;\n    return _.isArray(obj) ? obj.slice() : _.extend({}, obj);\n  };\n\n  // Invokes interceptor with the obj, and then returns obj.\n  // The primary purpose of this method is to \"tap into\" a method chain, in\n  // order to perform operations on intermediate results within the chain.\n  _.tap = function(obj, interceptor) {\n    interceptor(obj);\n    return obj;\n  };\n\n  // Returns whether an object has a given set of `key:value` pairs.\n  _.isMatch = function(object, attrs) {\n    var keys = _.keys(attrs), length = keys.length;\n    if (object == null) return !length;\n    var obj = Object(object);\n    for (var i = 0; i < length; i++) {\n      var key = keys[i];\n      if (attrs[key] !== obj[key] || !(key in obj)) return false;\n    }\n    return true;\n  };\n\n\n  // Internal recursive comparison function for `isEqual`.\n  var eq, deepEq;\n  eq = function(a, b, aStack, bStack) {\n    // Identical objects are equal. `0 === -0`, but they aren't identical.\n    // See the [Harmony `egal` proposal](http://wiki.ecmascript.org/doku.php?id=harmony:egal).\n    if (a === b) return a !== 0 || 1 / a === 1 / b;\n    // `null` or `undefined` only equal to itself (strict comparison).\n    if (a == null || b == null) return false;\n    // `NaN`s are equivalent, but non-reflexive.\n    if (a !== a) return b !== b;\n    // Exhaust primitive checks\n    var type = typeof a;\n    if (type !== 'function' && type !== 'object' && typeof b != 'object') return false;\n    return deepEq(a, b, aStack, bStack);\n  };\n\n  // Internal recursive comparison function for `isEqual`.\n  deepEq = function(a, b, aStack, bStack) {\n    // Unwrap any wrapped objects.\n    if (a instanceof _) a = a._wrapped;\n    if (b instanceof _) b = b._wrapped;\n    // Compare `[[Class]]` names.\n    var className = toString.call(a);\n    if (className !== toString.call(b)) return false;\n    switch (className) {\n      // Strings, numbers, regular expressions, dates, and booleans are compared by value.\n      case '[object RegExp]':\n      // RegExps are coerced to strings for comparison (Note: '' + /a/i === '/a/i')\n      case '[object String]':\n        // Primitives and their corresponding object wrappers are equivalent; thus, `\"5\"` is\n        // equivalent to `new String(\"5\")`.\n        return '' + a === '' + b;\n      case '[object Number]':\n        // `NaN`s are equivalent, but non-reflexive.\n        // Object(NaN) is equivalent to NaN.\n        if (+a !== +a) return +b !== +b;\n        // An `egal` comparison is performed for other numeric values.\n        return +a === 0 ? 1 / +a === 1 / b : +a === +b;\n      case '[object Date]':\n      case '[object Boolean]':\n        // Coerce dates and booleans to numeric primitive values. Dates are compared by their\n        // millisecond representations. Note that invalid dates with millisecond representations\n        // of `NaN` are not equivalent.\n        return +a === +b;\n      case '[object Symbol]':\n        return SymbolProto.valueOf.call(a) === SymbolProto.valueOf.call(b);\n    }\n\n    var areArrays = className === '[object Array]';\n    if (!areArrays) {\n      if (typeof a != 'object' || typeof b != 'object') return false;\n\n      // Objects with different constructors are not equivalent, but `Object`s or `Array`s\n      // from different frames are.\n      var aCtor = a.constructor, bCtor = b.constructor;\n      if (aCtor !== bCtor && !(_.isFunction(aCtor) && aCtor instanceof aCtor &&\n                               _.isFunction(bCtor) && bCtor instanceof bCtor)\n                          && ('constructor' in a && 'constructor' in b)) {\n        return false;\n      }\n    }\n    // Assume equality for cyclic structures. The algorithm for detecting cyclic\n    // structures is adapted from ES 5.1 section 15.12.3, abstract operation `JO`.\n\n    // Initializing stack of traversed objects.\n    // It's done here since we only need them for objects and arrays comparison.\n    aStack = aStack || [];\n    bStack = bStack || [];\n    var length = aStack.length;\n    while (length--) {\n      // Linear search. Performance is inversely proportional to the number of\n      // unique nested structures.\n      if (aStack[length] === a) return bStack[length] === b;\n    }\n\n    // Add the first object to the stack of traversed objects.\n    aStack.push(a);\n    bStack.push(b);\n\n    // Recursively compare objects and arrays.\n    if (areArrays) {\n      // Compare array lengths to determine if a deep comparison is necessary.\n      length = a.length;\n      if (length !== b.length) return false;\n      // Deep compare the contents, ignoring non-numeric properties.\n      while (length--) {\n        if (!eq(a[length], b[length], aStack, bStack)) return false;\n      }\n    } else {\n      // Deep compare objects.\n      var keys = _.keys(a), key;\n      length = keys.length;\n      // Ensure that both objects contain the same number of properties before comparing deep equality.\n      if (_.keys(b).length !== length) return false;\n      while (length--) {\n        // Deep compare each member\n        key = keys[length];\n        if (!(has(b, key) && eq(a[key], b[key], aStack, bStack))) return false;\n      }\n    }\n    // Remove the first object from the stack of traversed objects.\n    aStack.pop();\n    bStack.pop();\n    return true;\n  };\n\n  // Perform a deep comparison to check if two objects are equal.\n  _.isEqual = function(a, b) {\n    return eq(a, b);\n  };\n\n  // Is a given array, string, or object empty?\n  // An \"empty\" object has no enumerable own-properties.\n  _.isEmpty = function(obj) {\n    if (obj == null) return true;\n    if (isArrayLike(obj) && (_.isArray(obj) || _.isString(obj) || _.isArguments(obj))) return obj.length === 0;\n    return _.keys(obj).length === 0;\n  };\n\n  // Is a given value a DOM element?\n  _.isElement = function(obj) {\n    return !!(obj && obj.nodeType === 1);\n  };\n\n  // Is a given value an array?\n  // Delegates to ECMA5's native Array.isArray\n  _.isArray = nativeIsArray || function(obj) {\n    return toString.call(obj) === '[object Array]';\n  };\n\n  // Is a given variable an object?\n  _.isObject = function(obj) {\n    var type = typeof obj;\n    return type === 'function' || type === 'object' && !!obj;\n  };\n\n  // Add some isType methods: isArguments, isFunction, isString, isNumber, isDate, isRegExp, isError, isMap, isWeakMap, isSet, isWeakSet.\n  _.each(['Arguments', 'Function', 'String', 'Number', 'Date', 'RegExp', 'Error', 'Symbol', 'Map', 'WeakMap', 'Set', 'WeakSet'], function(name) {\n    _['is' + name] = function(obj) {\n      return toString.call(obj) === '[object ' + name + ']';\n    };\n  });\n\n  // Define a fallback version of the method in browsers (ahem, IE < 9), where\n  // there isn't any inspectable \"Arguments\" type.\n  if (!_.isArguments(arguments)) {\n    _.isArguments = function(obj) {\n      return has(obj, 'callee');\n    };\n  }\n\n  // Optimize `isFunction` if appropriate. Work around some typeof bugs in old v8,\n  // IE 11 (#1621), Safari 8 (#1929), and PhantomJS (#2236).\n  var nodelist = root.document && root.document.childNodes;\n  if ( true && typeof Int8Array != 'object' && typeof nodelist != 'function') {\n    _.isFunction = function(obj) {\n      return typeof obj == 'function' || false;\n    };\n  }\n\n  // Is a given object a finite number?\n  _.isFinite = function(obj) {\n    return !_.isSymbol(obj) && isFinite(obj) && !isNaN(parseFloat(obj));\n  };\n\n  // Is the given value `NaN`?\n  _.isNaN = function(obj) {\n    return _.isNumber(obj) && isNaN(obj);\n  };\n\n  // Is a given value a boolean?\n  _.isBoolean = function(obj) {\n    return obj === true || obj === false || toString.call(obj) === '[object Boolean]';\n  };\n\n  // Is a given value equal to null?\n  _.isNull = function(obj) {\n    return obj === null;\n  };\n\n  // Is a given variable undefined?\n  _.isUndefined = function(obj) {\n    return obj === void 0;\n  };\n\n  // Shortcut function for checking if an object has a given property directly\n  // on itself (in other words, not on a prototype).\n  _.has = function(obj, path) {\n    if (!_.isArray(path)) {\n      return has(obj, path);\n    }\n    var length = path.length;\n    for (var i = 0; i < length; i++) {\n      var key = path[i];\n      if (obj == null || !hasOwnProperty.call(obj, key)) {\n        return false;\n      }\n      obj = obj[key];\n    }\n    return !!length;\n  };\n\n  // Utility Functions\n  // -----------------\n\n  // Run Underscore.js in *noConflict* mode, returning the `_` variable to its\n  // previous owner. Returns a reference to the Underscore object.\n  _.noConflict = function() {\n    root._ = previousUnderscore;\n    return this;\n  };\n\n  // Keep the identity function around for default iteratees.\n  _.identity = function(value) {\n    return value;\n  };\n\n  // Predicate-generating functions. Often useful outside of Underscore.\n  _.constant = function(value) {\n    return function() {\n      return value;\n    };\n  };\n\n  _.noop = function(){};\n\n  // Creates a function that, when passed an object, will traverse that objects\n  // properties down the given `path`, specified as an array of keys or indexes.\n  _.property = function(path) {\n    if (!_.isArray(path)) {\n      return shallowProperty(path);\n    }\n    return function(obj) {\n      return deepGet(obj, path);\n    };\n  };\n\n  // Generates a function for a given object that returns a given property.\n  _.propertyOf = function(obj) {\n    if (obj == null) {\n      return function(){};\n    }\n    return function(path) {\n      return !_.isArray(path) ? obj[path] : deepGet(obj, path);\n    };\n  };\n\n  // Returns a predicate for checking whether an object has a given set of\n  // `key:value` pairs.\n  _.matcher = _.matches = function(attrs) {\n    attrs = _.extendOwn({}, attrs);\n    return function(obj) {\n      return _.isMatch(obj, attrs);\n    };\n  };\n\n  // Run a function **n** times.\n  _.times = function(n, iteratee, context) {\n    var accum = Array(Math.max(0, n));\n    iteratee = optimizeCb(iteratee, context, 1);\n    for (var i = 0; i < n; i++) accum[i] = iteratee(i);\n    return accum;\n  };\n\n  // Return a random integer between min and max (inclusive).\n  _.random = function(min, max) {\n    if (max == null) {\n      max = min;\n      min = 0;\n    }\n    return min + Math.floor(Math.random() * (max - min + 1));\n  };\n\n  // A (possibly faster) way to get the current timestamp as an integer.\n  _.now = Date.now || function() {\n    return new Date().getTime();\n  };\n\n  // List of HTML entities for escaping.\n  var escapeMap = {\n    '&': '&amp;',\n    '<': '&lt;',\n    '>': '&gt;',\n    '\"': '&quot;',\n    \"'\": '&#x27;',\n    '`': '&#x60;'\n  };\n  var unescapeMap = _.invert(escapeMap);\n\n  // Functions for escaping and unescaping strings to/from HTML interpolation.\n  var createEscaper = function(map) {\n    var escaper = function(match) {\n      return map[match];\n    };\n    // Regexes for identifying a key that needs to be escaped.\n    var source = '(?:' + _.keys(map).join('|') + ')';\n    var testRegexp = RegExp(source);\n    var replaceRegexp = RegExp(source, 'g');\n    return function(string) {\n      string = string == null ? '' : '' + string;\n      return testRegexp.test(string) ? string.replace(replaceRegexp, escaper) : string;\n    };\n  };\n  _.escape = createEscaper(escapeMap);\n  _.unescape = createEscaper(unescapeMap);\n\n  // Traverses the children of `obj` along `path`. If a child is a function, it\n  // is invoked with its parent as context. Returns the value of the final\n  // child, or `fallback` if any child is undefined.\n  _.result = function(obj, path, fallback) {\n    if (!_.isArray(path)) path = [path];\n    var length = path.length;\n    if (!length) {\n      return _.isFunction(fallback) ? fallback.call(obj) : fallback;\n    }\n    for (var i = 0; i < length; i++) {\n      var prop = obj == null ? void 0 : obj[path[i]];\n      if (prop === void 0) {\n        prop = fallback;\n        i = length; // Ensure we don't continue iterating.\n      }\n      obj = _.isFunction(prop) ? prop.call(obj) : prop;\n    }\n    return obj;\n  };\n\n  // Generate a unique integer id (unique within the entire client session).\n  // Useful for temporary DOM ids.\n  var idCounter = 0;\n  _.uniqueId = function(prefix) {\n    var id = ++idCounter + '';\n    return prefix ? prefix + id : id;\n  };\n\n  // By default, Underscore uses ERB-style template delimiters, change the\n  // following template settings to use alternative delimiters.\n  _.templateSettings = {\n    evaluate: /<%([\\s\\S]+?)%>/g,\n    interpolate: /<%=([\\s\\S]+?)%>/g,\n    escape: /<%-([\\s\\S]+?)%>/g\n  };\n\n  // When customizing `templateSettings`, if you don't want to define an\n  // interpolation, evaluation or escaping regex, we need one that is\n  // guaranteed not to match.\n  var noMatch = /(.)^/;\n\n  // Certain characters need to be escaped so that they can be put into a\n  // string literal.\n  var escapes = {\n    \"'\": \"'\",\n    '\\\\': '\\\\',\n    '\\r': 'r',\n    '\\n': 'n',\n    '\\u2028': 'u2028',\n    '\\u2029': 'u2029'\n  };\n\n  var escapeRegExp = /\\\\|'|\\r|\\n|\\u2028|\\u2029/g;\n\n  var escapeChar = function(match) {\n    return '\\\\' + escapes[match];\n  };\n\n  // JavaScript micro-templating, similar to John Resig's implementation.\n  // Underscore templating handles arbitrary delimiters, preserves whitespace,\n  // and correctly escapes quotes within interpolated code.\n  // NB: `oldSettings` only exists for backwards compatibility.\n  _.template = function(text, settings, oldSettings) {\n    if (!settings && oldSettings) settings = oldSettings;\n    settings = _.defaults({}, settings, _.templateSettings);\n\n    // Combine delimiters into one regular expression via alternation.\n    var matcher = RegExp([\n      (settings.escape || noMatch).source,\n      (settings.interpolate || noMatch).source,\n      (settings.evaluate || noMatch).source\n    ].join('|') + '|$', 'g');\n\n    // Compile the template source, escaping string literals appropriately.\n    var index = 0;\n    var source = \"__p+='\";\n    text.replace(matcher, function(match, escape, interpolate, evaluate, offset) {\n      source += text.slice(index, offset).replace(escapeRegExp, escapeChar);\n      index = offset + match.length;\n\n      if (escape) {\n        source += \"'+\\n((__t=(\" + escape + \"))==null?'':_.escape(__t))+\\n'\";\n      } else if (interpolate) {\n        source += \"'+\\n((__t=(\" + interpolate + \"))==null?'':__t)+\\n'\";\n      } else if (evaluate) {\n        source += \"';\\n\" + evaluate + \"\\n__p+='\";\n      }\n\n      // Adobe VMs need the match returned to produce the correct offset.\n      return match;\n    });\n    source += \"';\\n\";\n\n    // If a variable is not specified, place data values in local scope.\n    if (!settings.variable) source = 'with(obj||{}){\\n' + source + '}\\n';\n\n    source = \"var __t,__p='',__j=Array.prototype.join,\" +\n      \"print=function(){__p+=__j.call(arguments,'');};\\n\" +\n      source + 'return __p;\\n';\n\n    var render;\n    try {\n      render = new Function(settings.variable || 'obj', '_', source);\n    } catch (e) {\n      e.source = source;\n      throw e;\n    }\n\n    var template = function(data) {\n      return render.call(this, data, _);\n    };\n\n    // Provide the compiled source as a convenience for precompilation.\n    var argument = settings.variable || 'obj';\n    template.source = 'function(' + argument + '){\\n' + source + '}';\n\n    return template;\n  };\n\n  // Add a \"chain\" function. Start chaining a wrapped Underscore object.\n  _.chain = function(obj) {\n    var instance = _(obj);\n    instance._chain = true;\n    return instance;\n  };\n\n  // OOP\n  // ---------------\n  // If Underscore is called as a function, it returns a wrapped object that\n  // can be used OO-style. This wrapper holds altered versions of all the\n  // underscore functions. Wrapped objects may be chained.\n\n  // Helper function to continue chaining intermediate results.\n  var chainResult = function(instance, obj) {\n    return instance._chain ? _(obj).chain() : obj;\n  };\n\n  // Add your own custom functions to the Underscore object.\n  _.mixin = function(obj) {\n    _.each(_.functions(obj), function(name) {\n      var func = _[name] = obj[name];\n      _.prototype[name] = function() {\n        var args = [this._wrapped];\n        push.apply(args, arguments);\n        return chainResult(this, func.apply(_, args));\n      };\n    });\n    return _;\n  };\n\n  // Add all of the Underscore functions to the wrapper object.\n  _.mixin(_);\n\n  // Add all mutator Array functions to the wrapper.\n  _.each(['pop', 'push', 'reverse', 'shift', 'sort', 'splice', 'unshift'], function(name) {\n    var method = ArrayProto[name];\n    _.prototype[name] = function() {\n      var obj = this._wrapped;\n      method.apply(obj, arguments);\n      if ((name === 'shift' || name === 'splice') && obj.length === 0) delete obj[0];\n      return chainResult(this, obj);\n    };\n  });\n\n  // Add all accessor Array functions to the wrapper.\n  _.each(['concat', 'join', 'slice'], function(name) {\n    var method = ArrayProto[name];\n    _.prototype[name] = function() {\n      return chainResult(this, method.apply(this._wrapped, arguments));\n    };\n  });\n\n  // Extracts the result from a wrapped and chained object.\n  _.prototype.value = function() {\n    return this._wrapped;\n  };\n\n  // Provide unwrapping proxy for some methods used in engine operations\n  // such as arithmetic and JSON stringification.\n  _.prototype.valueOf = _.prototype.toJSON = _.prototype.value;\n\n  _.prototype.toString = function() {\n    return String(this._wrapped);\n  };\n\n  // AMD registration happens at the end for compatibility with AMD loaders\n  // that may not enforce next-turn semantics on modules. Even though general\n  // practice for AMD registration is to be anonymous, underscore registers\n  // as a named module because, like jQuery, it is a base library that is\n  // popular enough to be bundled in a third party lib, but not be part of\n  // an AMD load request. Those cases could generate an error when an\n  // anonymous define() is called outside of a loader request.\n  if (true) {\n    !(__WEBPACK_AMD_DEFINE_ARRAY__ = [], __WEBPACK_AMD_DEFINE_RESULT__ = (function() {\n      return _;\n    }).apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n  }\n}());\n\n/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(/*! ./../webpack/buildin/global.js */ \"698d75b157f24ae829cc\"), __webpack_require__(/*! ./../webpack/buildin/module.js */ \"f586cf5b9f4b7719b2c1\")(module)))//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiOGUwOGU1NDIwMDhlNGFlZjFmNTguanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvdW5kZXJzY29yZS91bmRlcnNjb3JlLmpzPzE3ZmIiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gICAgIFVuZGVyc2NvcmUuanMgMS45LjFcbi8vICAgICBodHRwOi8vdW5kZXJzY29yZWpzLm9yZ1xuLy8gICAgIChjKSAyMDA5LTIwMTggSmVyZW15IEFzaGtlbmFzLCBEb2N1bWVudENsb3VkIGFuZCBJbnZlc3RpZ2F0aXZlIFJlcG9ydGVycyAmIEVkaXRvcnNcbi8vICAgICBVbmRlcnNjb3JlIG1heSBiZSBmcmVlbHkgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlLlxuXG4oZnVuY3Rpb24oKSB7XG5cbiAgLy8gQmFzZWxpbmUgc2V0dXBcbiAgLy8gLS0tLS0tLS0tLS0tLS1cblxuICAvLyBFc3RhYmxpc2ggdGhlIHJvb3Qgb2JqZWN0LCBgd2luZG93YCAoYHNlbGZgKSBpbiB0aGUgYnJvd3NlciwgYGdsb2JhbGBcbiAgLy8gb24gdGhlIHNlcnZlciwgb3IgYHRoaXNgIGluIHNvbWUgdmlydHVhbCBtYWNoaW5lcy4gV2UgdXNlIGBzZWxmYFxuICAvLyBpbnN0ZWFkIG9mIGB3aW5kb3dgIGZvciBgV2ViV29ya2VyYCBzdXBwb3J0LlxuICB2YXIgcm9vdCA9IHR5cGVvZiBzZWxmID09ICdvYmplY3QnICYmIHNlbGYuc2VsZiA9PT0gc2VsZiAmJiBzZWxmIHx8XG4gICAgICAgICAgICB0eXBlb2YgZ2xvYmFsID09ICdvYmplY3QnICYmIGdsb2JhbC5nbG9iYWwgPT09IGdsb2JhbCAmJiBnbG9iYWwgfHxcbiAgICAgICAgICAgIHRoaXMgfHxcbiAgICAgICAgICAgIHt9O1xuXG4gIC8vIFNhdmUgdGhlIHByZXZpb3VzIHZhbHVlIG9mIHRoZSBgX2AgdmFyaWFibGUuXG4gIHZhciBwcmV2aW91c1VuZGVyc2NvcmUgPSByb290Ll87XG5cbiAgLy8gU2F2ZSBieXRlcyBpbiB0aGUgbWluaWZpZWQgKGJ1dCBub3QgZ3ppcHBlZCkgdmVyc2lvbjpcbiAgdmFyIEFycmF5UHJvdG8gPSBBcnJheS5wcm90b3R5cGUsIE9ialByb3RvID0gT2JqZWN0LnByb3RvdHlwZTtcbiAgdmFyIFN5bWJvbFByb3RvID0gdHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCcgPyBTeW1ib2wucHJvdG90eXBlIDogbnVsbDtcblxuICAvLyBDcmVhdGUgcXVpY2sgcmVmZXJlbmNlIHZhcmlhYmxlcyBmb3Igc3BlZWQgYWNjZXNzIHRvIGNvcmUgcHJvdG90eXBlcy5cbiAgdmFyIHB1c2ggPSBBcnJheVByb3RvLnB1c2gsXG4gICAgICBzbGljZSA9IEFycmF5UHJvdG8uc2xpY2UsXG4gICAgICB0b1N0cmluZyA9IE9ialByb3RvLnRvU3RyaW5nLFxuICAgICAgaGFzT3duUHJvcGVydHkgPSBPYmpQcm90by5oYXNPd25Qcm9wZXJ0eTtcblxuICAvLyBBbGwgKipFQ01BU2NyaXB0IDUqKiBuYXRpdmUgZnVuY3Rpb24gaW1wbGVtZW50YXRpb25zIHRoYXQgd2UgaG9wZSB0byB1c2VcbiAgLy8gYXJlIGRlY2xhcmVkIGhlcmUuXG4gIHZhciBuYXRpdmVJc0FycmF5ID0gQXJyYXkuaXNBcnJheSxcbiAgICAgIG5hdGl2ZUtleXMgPSBPYmplY3Qua2V5cyxcbiAgICAgIG5hdGl2ZUNyZWF0ZSA9IE9iamVjdC5jcmVhdGU7XG5cbiAgLy8gTmFrZWQgZnVuY3Rpb24gcmVmZXJlbmNlIGZvciBzdXJyb2dhdGUtcHJvdG90eXBlLXN3YXBwaW5nLlxuICB2YXIgQ3RvciA9IGZ1bmN0aW9uKCl7fTtcblxuICAvLyBDcmVhdGUgYSBzYWZlIHJlZmVyZW5jZSB0byB0aGUgVW5kZXJzY29yZSBvYmplY3QgZm9yIHVzZSBiZWxvdy5cbiAgdmFyIF8gPSBmdW5jdGlvbihvYmopIHtcbiAgICBpZiAob2JqIGluc3RhbmNlb2YgXykgcmV0dXJuIG9iajtcbiAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgXykpIHJldHVybiBuZXcgXyhvYmopO1xuICAgIHRoaXMuX3dyYXBwZWQgPSBvYmo7XG4gIH07XG5cbiAgLy8gRXhwb3J0IHRoZSBVbmRlcnNjb3JlIG9iamVjdCBmb3IgKipOb2RlLmpzKiosIHdpdGhcbiAgLy8gYmFja3dhcmRzLWNvbXBhdGliaWxpdHkgZm9yIHRoZWlyIG9sZCBtb2R1bGUgQVBJLiBJZiB3ZSdyZSBpblxuICAvLyB0aGUgYnJvd3NlciwgYWRkIGBfYCBhcyBhIGdsb2JhbCBvYmplY3QuXG4gIC8vIChgbm9kZVR5cGVgIGlzIGNoZWNrZWQgdG8gZW5zdXJlIHRoYXQgYG1vZHVsZWBcbiAgLy8gYW5kIGBleHBvcnRzYCBhcmUgbm90IEhUTUwgZWxlbWVudHMuKVxuICBpZiAodHlwZW9mIGV4cG9ydHMgIT0gJ3VuZGVmaW5lZCcgJiYgIWV4cG9ydHMubm9kZVR5cGUpIHtcbiAgICBpZiAodHlwZW9mIG1vZHVsZSAhPSAndW5kZWZpbmVkJyAmJiAhbW9kdWxlLm5vZGVUeXBlICYmIG1vZHVsZS5leHBvcnRzKSB7XG4gICAgICBleHBvcnRzID0gbW9kdWxlLmV4cG9ydHMgPSBfO1xuICAgIH1cbiAgICBleHBvcnRzLl8gPSBfO1xuICB9IGVsc2Uge1xuICAgIHJvb3QuXyA9IF87XG4gIH1cblxuICAvLyBDdXJyZW50IHZlcnNpb24uXG4gIF8uVkVSU0lPTiA9ICcxLjkuMSc7XG5cbiAgLy8gSW50ZXJuYWwgZnVuY3Rpb24gdGhhdCByZXR1cm5zIGFuIGVmZmljaWVudCAoZm9yIGN1cnJlbnQgZW5naW5lcykgdmVyc2lvblxuICAvLyBvZiB0aGUgcGFzc2VkLWluIGNhbGxiYWNrLCB0byBiZSByZXBlYXRlZGx5IGFwcGxpZWQgaW4gb3RoZXIgVW5kZXJzY29yZVxuICAvLyBmdW5jdGlvbnMuXG4gIHZhciBvcHRpbWl6ZUNiID0gZnVuY3Rpb24oZnVuYywgY29udGV4dCwgYXJnQ291bnQpIHtcbiAgICBpZiAoY29udGV4dCA9PT0gdm9pZCAwKSByZXR1cm4gZnVuYztcbiAgICBzd2l0Y2ggKGFyZ0NvdW50ID09IG51bGwgPyAzIDogYXJnQ291bnQpIHtcbiAgICAgIGNhc2UgMTogcmV0dXJuIGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICAgIHJldHVybiBmdW5jLmNhbGwoY29udGV4dCwgdmFsdWUpO1xuICAgICAgfTtcbiAgICAgIC8vIFRoZSAyLWFyZ3VtZW50IGNhc2UgaXMgb21pdHRlZCBiZWNhdXNlIHdl4oCZcmUgbm90IHVzaW5nIGl0LlxuICAgICAgY2FzZSAzOiByZXR1cm4gZnVuY3Rpb24odmFsdWUsIGluZGV4LCBjb2xsZWN0aW9uKSB7XG4gICAgICAgIHJldHVybiBmdW5jLmNhbGwoY29udGV4dCwgdmFsdWUsIGluZGV4LCBjb2xsZWN0aW9uKTtcbiAgICAgIH07XG4gICAgICBjYXNlIDQ6IHJldHVybiBmdW5jdGlvbihhY2N1bXVsYXRvciwgdmFsdWUsIGluZGV4LCBjb2xsZWN0aW9uKSB7XG4gICAgICAgIHJldHVybiBmdW5jLmNhbGwoY29udGV4dCwgYWNjdW11bGF0b3IsIHZhbHVlLCBpbmRleCwgY29sbGVjdGlvbik7XG4gICAgICB9O1xuICAgIH1cbiAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gZnVuYy5hcHBseShjb250ZXh0LCBhcmd1bWVudHMpO1xuICAgIH07XG4gIH07XG5cbiAgdmFyIGJ1aWx0aW5JdGVyYXRlZTtcblxuICAvLyBBbiBpbnRlcm5hbCBmdW5jdGlvbiB0byBnZW5lcmF0ZSBjYWxsYmFja3MgdGhhdCBjYW4gYmUgYXBwbGllZCB0byBlYWNoXG4gIC8vIGVsZW1lbnQgaW4gYSBjb2xsZWN0aW9uLCByZXR1cm5pbmcgdGhlIGRlc2lyZWQgcmVzdWx0IOKAlCBlaXRoZXIgYGlkZW50aXR5YCxcbiAgLy8gYW4gYXJiaXRyYXJ5IGNhbGxiYWNrLCBhIHByb3BlcnR5IG1hdGNoZXIsIG9yIGEgcHJvcGVydHkgYWNjZXNzb3IuXG4gIHZhciBjYiA9IGZ1bmN0aW9uKHZhbHVlLCBjb250ZXh0LCBhcmdDb3VudCkge1xuICAgIGlmIChfLml0ZXJhdGVlICE9PSBidWlsdGluSXRlcmF0ZWUpIHJldHVybiBfLml0ZXJhdGVlKHZhbHVlLCBjb250ZXh0KTtcbiAgICBpZiAodmFsdWUgPT0gbnVsbCkgcmV0dXJuIF8uaWRlbnRpdHk7XG4gICAgaWYgKF8uaXNGdW5jdGlvbih2YWx1ZSkpIHJldHVybiBvcHRpbWl6ZUNiKHZhbHVlLCBjb250ZXh0LCBhcmdDb3VudCk7XG4gICAgaWYgKF8uaXNPYmplY3QodmFsdWUpICYmICFfLmlzQXJyYXkodmFsdWUpKSByZXR1cm4gXy5tYXRjaGVyKHZhbHVlKTtcbiAgICByZXR1cm4gXy5wcm9wZXJ0eSh2YWx1ZSk7XG4gIH07XG5cbiAgLy8gRXh0ZXJuYWwgd3JhcHBlciBmb3Igb3VyIGNhbGxiYWNrIGdlbmVyYXRvci4gVXNlcnMgbWF5IGN1c3RvbWl6ZVxuICAvLyBgXy5pdGVyYXRlZWAgaWYgdGhleSB3YW50IGFkZGl0aW9uYWwgcHJlZGljYXRlL2l0ZXJhdGVlIHNob3J0aGFuZCBzdHlsZXMuXG4gIC8vIFRoaXMgYWJzdHJhY3Rpb24gaGlkZXMgdGhlIGludGVybmFsLW9ubHkgYXJnQ291bnQgYXJndW1lbnQuXG4gIF8uaXRlcmF0ZWUgPSBidWlsdGluSXRlcmF0ZWUgPSBmdW5jdGlvbih2YWx1ZSwgY29udGV4dCkge1xuICAgIHJldHVybiBjYih2YWx1ZSwgY29udGV4dCwgSW5maW5pdHkpO1xuICB9O1xuXG4gIC8vIFNvbWUgZnVuY3Rpb25zIHRha2UgYSB2YXJpYWJsZSBudW1iZXIgb2YgYXJndW1lbnRzLCBvciBhIGZldyBleHBlY3RlZFxuICAvLyBhcmd1bWVudHMgYXQgdGhlIGJlZ2lubmluZyBhbmQgdGhlbiBhIHZhcmlhYmxlIG51bWJlciBvZiB2YWx1ZXMgdG8gb3BlcmF0ZVxuICAvLyBvbi4gVGhpcyBoZWxwZXIgYWNjdW11bGF0ZXMgYWxsIHJlbWFpbmluZyBhcmd1bWVudHMgcGFzdCB0aGUgZnVuY3Rpb27igJlzXG4gIC8vIGFyZ3VtZW50IGxlbmd0aCAob3IgYW4gZXhwbGljaXQgYHN0YXJ0SW5kZXhgKSwgaW50byBhbiBhcnJheSB0aGF0IGJlY29tZXNcbiAgLy8gdGhlIGxhc3QgYXJndW1lbnQuIFNpbWlsYXIgdG8gRVM24oCZcyBcInJlc3QgcGFyYW1ldGVyXCIuXG4gIHZhciByZXN0QXJndW1lbnRzID0gZnVuY3Rpb24oZnVuYywgc3RhcnRJbmRleCkge1xuICAgIHN0YXJ0SW5kZXggPSBzdGFydEluZGV4ID09IG51bGwgPyBmdW5jLmxlbmd0aCAtIDEgOiArc3RhcnRJbmRleDtcbiAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgbGVuZ3RoID0gTWF0aC5tYXgoYXJndW1lbnRzLmxlbmd0aCAtIHN0YXJ0SW5kZXgsIDApLFxuICAgICAgICAgIHJlc3QgPSBBcnJheShsZW5ndGgpLFxuICAgICAgICAgIGluZGV4ID0gMDtcbiAgICAgIGZvciAoOyBpbmRleCA8IGxlbmd0aDsgaW5kZXgrKykge1xuICAgICAgICByZXN0W2luZGV4XSA9IGFyZ3VtZW50c1tpbmRleCArIHN0YXJ0SW5kZXhdO1xuICAgICAgfVxuICAgICAgc3dpdGNoIChzdGFydEluZGV4KSB7XG4gICAgICAgIGNhc2UgMDogcmV0dXJuIGZ1bmMuY2FsbCh0aGlzLCByZXN0KTtcbiAgICAgICAgY2FzZSAxOiByZXR1cm4gZnVuYy5jYWxsKHRoaXMsIGFyZ3VtZW50c1swXSwgcmVzdCk7XG4gICAgICAgIGNhc2UgMjogcmV0dXJuIGZ1bmMuY2FsbCh0aGlzLCBhcmd1bWVudHNbMF0sIGFyZ3VtZW50c1sxXSwgcmVzdCk7XG4gICAgICB9XG4gICAgICB2YXIgYXJncyA9IEFycmF5KHN0YXJ0SW5kZXggKyAxKTtcbiAgICAgIGZvciAoaW5kZXggPSAwOyBpbmRleCA8IHN0YXJ0SW5kZXg7IGluZGV4KyspIHtcbiAgICAgICAgYXJnc1tpbmRleF0gPSBhcmd1bWVudHNbaW5kZXhdO1xuICAgICAgfVxuICAgICAgYXJnc1tzdGFydEluZGV4XSA9IHJlc3Q7XG4gICAgICByZXR1cm4gZnVuYy5hcHBseSh0aGlzLCBhcmdzKTtcbiAgICB9O1xuICB9O1xuXG4gIC8vIEFuIGludGVybmFsIGZ1bmN0aW9uIGZvciBjcmVhdGluZyBhIG5ldyBvYmplY3QgdGhhdCBpbmhlcml0cyBmcm9tIGFub3RoZXIuXG4gIHZhciBiYXNlQ3JlYXRlID0gZnVuY3Rpb24ocHJvdG90eXBlKSB7XG4gICAgaWYgKCFfLmlzT2JqZWN0KHByb3RvdHlwZSkpIHJldHVybiB7fTtcbiAgICBpZiAobmF0aXZlQ3JlYXRlKSByZXR1cm4gbmF0aXZlQ3JlYXRlKHByb3RvdHlwZSk7XG4gICAgQ3Rvci5wcm90b3R5cGUgPSBwcm90b3R5cGU7XG4gICAgdmFyIHJlc3VsdCA9IG5ldyBDdG9yO1xuICAgIEN0b3IucHJvdG90eXBlID0gbnVsbDtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9O1xuXG4gIHZhciBzaGFsbG93UHJvcGVydHkgPSBmdW5jdGlvbihrZXkpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24ob2JqKSB7XG4gICAgICByZXR1cm4gb2JqID09IG51bGwgPyB2b2lkIDAgOiBvYmpba2V5XTtcbiAgICB9O1xuICB9O1xuXG4gIHZhciBoYXMgPSBmdW5jdGlvbihvYmosIHBhdGgpIHtcbiAgICByZXR1cm4gb2JqICE9IG51bGwgJiYgaGFzT3duUHJvcGVydHkuY2FsbChvYmosIHBhdGgpO1xuICB9XG5cbiAgdmFyIGRlZXBHZXQgPSBmdW5jdGlvbihvYmosIHBhdGgpIHtcbiAgICB2YXIgbGVuZ3RoID0gcGF0aC5sZW5ndGg7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgaWYgKG9iaiA9PSBudWxsKSByZXR1cm4gdm9pZCAwO1xuICAgICAgb2JqID0gb2JqW3BhdGhbaV1dO1xuICAgIH1cbiAgICByZXR1cm4gbGVuZ3RoID8gb2JqIDogdm9pZCAwO1xuICB9O1xuXG4gIC8vIEhlbHBlciBmb3IgY29sbGVjdGlvbiBtZXRob2RzIHRvIGRldGVybWluZSB3aGV0aGVyIGEgY29sbGVjdGlvblxuICAvLyBzaG91bGQgYmUgaXRlcmF0ZWQgYXMgYW4gYXJyYXkgb3IgYXMgYW4gb2JqZWN0LlxuICAvLyBSZWxhdGVkOiBodHRwOi8vcGVvcGxlLm1vemlsbGEub3JnL35qb3JlbmRvcmZmL2VzNi1kcmFmdC5odG1sI3NlYy10b2xlbmd0aFxuICAvLyBBdm9pZHMgYSB2ZXJ5IG5hc3R5IGlPUyA4IEpJVCBidWcgb24gQVJNLTY0LiAjMjA5NFxuICB2YXIgTUFYX0FSUkFZX0lOREVYID0gTWF0aC5wb3coMiwgNTMpIC0gMTtcbiAgdmFyIGdldExlbmd0aCA9IHNoYWxsb3dQcm9wZXJ0eSgnbGVuZ3RoJyk7XG4gIHZhciBpc0FycmF5TGlrZSA9IGZ1bmN0aW9uKGNvbGxlY3Rpb24pIHtcbiAgICB2YXIgbGVuZ3RoID0gZ2V0TGVuZ3RoKGNvbGxlY3Rpb24pO1xuICAgIHJldHVybiB0eXBlb2YgbGVuZ3RoID09ICdudW1iZXInICYmIGxlbmd0aCA+PSAwICYmIGxlbmd0aCA8PSBNQVhfQVJSQVlfSU5ERVg7XG4gIH07XG5cbiAgLy8gQ29sbGVjdGlvbiBGdW5jdGlvbnNcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuICAvLyBUaGUgY29ybmVyc3RvbmUsIGFuIGBlYWNoYCBpbXBsZW1lbnRhdGlvbiwgYWthIGBmb3JFYWNoYC5cbiAgLy8gSGFuZGxlcyByYXcgb2JqZWN0cyBpbiBhZGRpdGlvbiB0byBhcnJheS1saWtlcy4gVHJlYXRzIGFsbFxuICAvLyBzcGFyc2UgYXJyYXktbGlrZXMgYXMgaWYgdGhleSB3ZXJlIGRlbnNlLlxuICBfLmVhY2ggPSBfLmZvckVhY2ggPSBmdW5jdGlvbihvYmosIGl0ZXJhdGVlLCBjb250ZXh0KSB7XG4gICAgaXRlcmF0ZWUgPSBvcHRpbWl6ZUNiKGl0ZXJhdGVlLCBjb250ZXh0KTtcbiAgICB2YXIgaSwgbGVuZ3RoO1xuICAgIGlmIChpc0FycmF5TGlrZShvYmopKSB7XG4gICAgICBmb3IgKGkgPSAwLCBsZW5ndGggPSBvYmoubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgICAgaXRlcmF0ZWUob2JqW2ldLCBpLCBvYmopO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICB2YXIga2V5cyA9IF8ua2V5cyhvYmopO1xuICAgICAgZm9yIChpID0gMCwgbGVuZ3RoID0ga2V5cy5sZW5ndGg7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgICBpdGVyYXRlZShvYmpba2V5c1tpXV0sIGtleXNbaV0sIG9iaik7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBvYmo7XG4gIH07XG5cbiAgLy8gUmV0dXJuIHRoZSByZXN1bHRzIG9mIGFwcGx5aW5nIHRoZSBpdGVyYXRlZSB0byBlYWNoIGVsZW1lbnQuXG4gIF8ubWFwID0gXy5jb2xsZWN0ID0gZnVuY3Rpb24ob2JqLCBpdGVyYXRlZSwgY29udGV4dCkge1xuICAgIGl0ZXJhdGVlID0gY2IoaXRlcmF0ZWUsIGNvbnRleHQpO1xuICAgIHZhciBrZXlzID0gIWlzQXJyYXlMaWtlKG9iaikgJiYgXy5rZXlzKG9iaiksXG4gICAgICAgIGxlbmd0aCA9IChrZXlzIHx8IG9iaikubGVuZ3RoLFxuICAgICAgICByZXN1bHRzID0gQXJyYXkobGVuZ3RoKTtcbiAgICBmb3IgKHZhciBpbmRleCA9IDA7IGluZGV4IDwgbGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICB2YXIgY3VycmVudEtleSA9IGtleXMgPyBrZXlzW2luZGV4XSA6IGluZGV4O1xuICAgICAgcmVzdWx0c1tpbmRleF0gPSBpdGVyYXRlZShvYmpbY3VycmVudEtleV0sIGN1cnJlbnRLZXksIG9iaik7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHRzO1xuICB9O1xuXG4gIC8vIENyZWF0ZSBhIHJlZHVjaW5nIGZ1bmN0aW9uIGl0ZXJhdGluZyBsZWZ0IG9yIHJpZ2h0LlxuICB2YXIgY3JlYXRlUmVkdWNlID0gZnVuY3Rpb24oZGlyKSB7XG4gICAgLy8gV3JhcCBjb2RlIHRoYXQgcmVhc3NpZ25zIGFyZ3VtZW50IHZhcmlhYmxlcyBpbiBhIHNlcGFyYXRlIGZ1bmN0aW9uIHRoYW5cbiAgICAvLyB0aGUgb25lIHRoYXQgYWNjZXNzZXMgYGFyZ3VtZW50cy5sZW5ndGhgIHRvIGF2b2lkIGEgcGVyZiBoaXQuICgjMTk5MSlcbiAgICB2YXIgcmVkdWNlciA9IGZ1bmN0aW9uKG9iaiwgaXRlcmF0ZWUsIG1lbW8sIGluaXRpYWwpIHtcbiAgICAgIHZhciBrZXlzID0gIWlzQXJyYXlMaWtlKG9iaikgJiYgXy5rZXlzKG9iaiksXG4gICAgICAgICAgbGVuZ3RoID0gKGtleXMgfHwgb2JqKS5sZW5ndGgsXG4gICAgICAgICAgaW5kZXggPSBkaXIgPiAwID8gMCA6IGxlbmd0aCAtIDE7XG4gICAgICBpZiAoIWluaXRpYWwpIHtcbiAgICAgICAgbWVtbyA9IG9ialtrZXlzID8ga2V5c1tpbmRleF0gOiBpbmRleF07XG4gICAgICAgIGluZGV4ICs9IGRpcjtcbiAgICAgIH1cbiAgICAgIGZvciAoOyBpbmRleCA+PSAwICYmIGluZGV4IDwgbGVuZ3RoOyBpbmRleCArPSBkaXIpIHtcbiAgICAgICAgdmFyIGN1cnJlbnRLZXkgPSBrZXlzID8ga2V5c1tpbmRleF0gOiBpbmRleDtcbiAgICAgICAgbWVtbyA9IGl0ZXJhdGVlKG1lbW8sIG9ialtjdXJyZW50S2V5XSwgY3VycmVudEtleSwgb2JqKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBtZW1vO1xuICAgIH07XG5cbiAgICByZXR1cm4gZnVuY3Rpb24ob2JqLCBpdGVyYXRlZSwgbWVtbywgY29udGV4dCkge1xuICAgICAgdmFyIGluaXRpYWwgPSBhcmd1bWVudHMubGVuZ3RoID49IDM7XG4gICAgICByZXR1cm4gcmVkdWNlcihvYmosIG9wdGltaXplQ2IoaXRlcmF0ZWUsIGNvbnRleHQsIDQpLCBtZW1vLCBpbml0aWFsKTtcbiAgICB9O1xuICB9O1xuXG4gIC8vICoqUmVkdWNlKiogYnVpbGRzIHVwIGEgc2luZ2xlIHJlc3VsdCBmcm9tIGEgbGlzdCBvZiB2YWx1ZXMsIGFrYSBgaW5qZWN0YCxcbiAgLy8gb3IgYGZvbGRsYC5cbiAgXy5yZWR1Y2UgPSBfLmZvbGRsID0gXy5pbmplY3QgPSBjcmVhdGVSZWR1Y2UoMSk7XG5cbiAgLy8gVGhlIHJpZ2h0LWFzc29jaWF0aXZlIHZlcnNpb24gb2YgcmVkdWNlLCBhbHNvIGtub3duIGFzIGBmb2xkcmAuXG4gIF8ucmVkdWNlUmlnaHQgPSBfLmZvbGRyID0gY3JlYXRlUmVkdWNlKC0xKTtcblxuICAvLyBSZXR1cm4gdGhlIGZpcnN0IHZhbHVlIHdoaWNoIHBhc3NlcyBhIHRydXRoIHRlc3QuIEFsaWFzZWQgYXMgYGRldGVjdGAuXG4gIF8uZmluZCA9IF8uZGV0ZWN0ID0gZnVuY3Rpb24ob2JqLCBwcmVkaWNhdGUsIGNvbnRleHQpIHtcbiAgICB2YXIga2V5RmluZGVyID0gaXNBcnJheUxpa2Uob2JqKSA/IF8uZmluZEluZGV4IDogXy5maW5kS2V5O1xuICAgIHZhciBrZXkgPSBrZXlGaW5kZXIob2JqLCBwcmVkaWNhdGUsIGNvbnRleHQpO1xuICAgIGlmIChrZXkgIT09IHZvaWQgMCAmJiBrZXkgIT09IC0xKSByZXR1cm4gb2JqW2tleV07XG4gIH07XG5cbiAgLy8gUmV0dXJuIGFsbCB0aGUgZWxlbWVudHMgdGhhdCBwYXNzIGEgdHJ1dGggdGVzdC5cbiAgLy8gQWxpYXNlZCBhcyBgc2VsZWN0YC5cbiAgXy5maWx0ZXIgPSBfLnNlbGVjdCA9IGZ1bmN0aW9uKG9iaiwgcHJlZGljYXRlLCBjb250ZXh0KSB7XG4gICAgdmFyIHJlc3VsdHMgPSBbXTtcbiAgICBwcmVkaWNhdGUgPSBjYihwcmVkaWNhdGUsIGNvbnRleHQpO1xuICAgIF8uZWFjaChvYmosIGZ1bmN0aW9uKHZhbHVlLCBpbmRleCwgbGlzdCkge1xuICAgICAgaWYgKHByZWRpY2F0ZSh2YWx1ZSwgaW5kZXgsIGxpc3QpKSByZXN1bHRzLnB1c2godmFsdWUpO1xuICAgIH0pO1xuICAgIHJldHVybiByZXN1bHRzO1xuICB9O1xuXG4gIC8vIFJldHVybiBhbGwgdGhlIGVsZW1lbnRzIGZvciB3aGljaCBhIHRydXRoIHRlc3QgZmFpbHMuXG4gIF8ucmVqZWN0ID0gZnVuY3Rpb24ob2JqLCBwcmVkaWNhdGUsIGNvbnRleHQpIHtcbiAgICByZXR1cm4gXy5maWx0ZXIob2JqLCBfLm5lZ2F0ZShjYihwcmVkaWNhdGUpKSwgY29udGV4dCk7XG4gIH07XG5cbiAgLy8gRGV0ZXJtaW5lIHdoZXRoZXIgYWxsIG9mIHRoZSBlbGVtZW50cyBtYXRjaCBhIHRydXRoIHRlc3QuXG4gIC8vIEFsaWFzZWQgYXMgYGFsbGAuXG4gIF8uZXZlcnkgPSBfLmFsbCA9IGZ1bmN0aW9uKG9iaiwgcHJlZGljYXRlLCBjb250ZXh0KSB7XG4gICAgcHJlZGljYXRlID0gY2IocHJlZGljYXRlLCBjb250ZXh0KTtcbiAgICB2YXIga2V5cyA9ICFpc0FycmF5TGlrZShvYmopICYmIF8ua2V5cyhvYmopLFxuICAgICAgICBsZW5ndGggPSAoa2V5cyB8fCBvYmopLmxlbmd0aDtcbiAgICBmb3IgKHZhciBpbmRleCA9IDA7IGluZGV4IDwgbGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICB2YXIgY3VycmVudEtleSA9IGtleXMgPyBrZXlzW2luZGV4XSA6IGluZGV4O1xuICAgICAgaWYgKCFwcmVkaWNhdGUob2JqW2N1cnJlbnRLZXldLCBjdXJyZW50S2V5LCBvYmopKSByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xuICB9O1xuXG4gIC8vIERldGVybWluZSBpZiBhdCBsZWFzdCBvbmUgZWxlbWVudCBpbiB0aGUgb2JqZWN0IG1hdGNoZXMgYSB0cnV0aCB0ZXN0LlxuICAvLyBBbGlhc2VkIGFzIGBhbnlgLlxuICBfLnNvbWUgPSBfLmFueSA9IGZ1bmN0aW9uKG9iaiwgcHJlZGljYXRlLCBjb250ZXh0KSB7XG4gICAgcHJlZGljYXRlID0gY2IocHJlZGljYXRlLCBjb250ZXh0KTtcbiAgICB2YXIga2V5cyA9ICFpc0FycmF5TGlrZShvYmopICYmIF8ua2V5cyhvYmopLFxuICAgICAgICBsZW5ndGggPSAoa2V5cyB8fCBvYmopLmxlbmd0aDtcbiAgICBmb3IgKHZhciBpbmRleCA9IDA7IGluZGV4IDwgbGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICB2YXIgY3VycmVudEtleSA9IGtleXMgPyBrZXlzW2luZGV4XSA6IGluZGV4O1xuICAgICAgaWYgKHByZWRpY2F0ZShvYmpbY3VycmVudEtleV0sIGN1cnJlbnRLZXksIG9iaikpIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH07XG5cbiAgLy8gRGV0ZXJtaW5lIGlmIHRoZSBhcnJheSBvciBvYmplY3QgY29udGFpbnMgYSBnaXZlbiBpdGVtICh1c2luZyBgPT09YCkuXG4gIC8vIEFsaWFzZWQgYXMgYGluY2x1ZGVzYCBhbmQgYGluY2x1ZGVgLlxuICBfLmNvbnRhaW5zID0gXy5pbmNsdWRlcyA9IF8uaW5jbHVkZSA9IGZ1bmN0aW9uKG9iaiwgaXRlbSwgZnJvbUluZGV4LCBndWFyZCkge1xuICAgIGlmICghaXNBcnJheUxpa2Uob2JqKSkgb2JqID0gXy52YWx1ZXMob2JqKTtcbiAgICBpZiAodHlwZW9mIGZyb21JbmRleCAhPSAnbnVtYmVyJyB8fCBndWFyZCkgZnJvbUluZGV4ID0gMDtcbiAgICByZXR1cm4gXy5pbmRleE9mKG9iaiwgaXRlbSwgZnJvbUluZGV4KSA+PSAwO1xuICB9O1xuXG4gIC8vIEludm9rZSBhIG1ldGhvZCAod2l0aCBhcmd1bWVudHMpIG9uIGV2ZXJ5IGl0ZW0gaW4gYSBjb2xsZWN0aW9uLlxuICBfLmludm9rZSA9IHJlc3RBcmd1bWVudHMoZnVuY3Rpb24ob2JqLCBwYXRoLCBhcmdzKSB7XG4gICAgdmFyIGNvbnRleHRQYXRoLCBmdW5jO1xuICAgIGlmIChfLmlzRnVuY3Rpb24ocGF0aCkpIHtcbiAgICAgIGZ1bmMgPSBwYXRoO1xuICAgIH0gZWxzZSBpZiAoXy5pc0FycmF5KHBhdGgpKSB7XG4gICAgICBjb250ZXh0UGF0aCA9IHBhdGguc2xpY2UoMCwgLTEpO1xuICAgICAgcGF0aCA9IHBhdGhbcGF0aC5sZW5ndGggLSAxXTtcbiAgICB9XG4gICAgcmV0dXJuIF8ubWFwKG9iaiwgZnVuY3Rpb24oY29udGV4dCkge1xuICAgICAgdmFyIG1ldGhvZCA9IGZ1bmM7XG4gICAgICBpZiAoIW1ldGhvZCkge1xuICAgICAgICBpZiAoY29udGV4dFBhdGggJiYgY29udGV4dFBhdGgubGVuZ3RoKSB7XG4gICAgICAgICAgY29udGV4dCA9IGRlZXBHZXQoY29udGV4dCwgY29udGV4dFBhdGgpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb250ZXh0ID09IG51bGwpIHJldHVybiB2b2lkIDA7XG4gICAgICAgIG1ldGhvZCA9IGNvbnRleHRbcGF0aF07XG4gICAgICB9XG4gICAgICByZXR1cm4gbWV0aG9kID09IG51bGwgPyBtZXRob2QgOiBtZXRob2QuYXBwbHkoY29udGV4dCwgYXJncyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIC8vIENvbnZlbmllbmNlIHZlcnNpb24gb2YgYSBjb21tb24gdXNlIGNhc2Ugb2YgYG1hcGA6IGZldGNoaW5nIGEgcHJvcGVydHkuXG4gIF8ucGx1Y2sgPSBmdW5jdGlvbihvYmosIGtleSkge1xuICAgIHJldHVybiBfLm1hcChvYmosIF8ucHJvcGVydHkoa2V5KSk7XG4gIH07XG5cbiAgLy8gQ29udmVuaWVuY2UgdmVyc2lvbiBvZiBhIGNvbW1vbiB1c2UgY2FzZSBvZiBgZmlsdGVyYDogc2VsZWN0aW5nIG9ubHkgb2JqZWN0c1xuICAvLyBjb250YWluaW5nIHNwZWNpZmljIGBrZXk6dmFsdWVgIHBhaXJzLlxuICBfLndoZXJlID0gZnVuY3Rpb24ob2JqLCBhdHRycykge1xuICAgIHJldHVybiBfLmZpbHRlcihvYmosIF8ubWF0Y2hlcihhdHRycykpO1xuICB9O1xuXG4gIC8vIENvbnZlbmllbmNlIHZlcnNpb24gb2YgYSBjb21tb24gdXNlIGNhc2Ugb2YgYGZpbmRgOiBnZXR0aW5nIHRoZSBmaXJzdCBvYmplY3RcbiAgLy8gY29udGFpbmluZyBzcGVjaWZpYyBga2V5OnZhbHVlYCBwYWlycy5cbiAgXy5maW5kV2hlcmUgPSBmdW5jdGlvbihvYmosIGF0dHJzKSB7XG4gICAgcmV0dXJuIF8uZmluZChvYmosIF8ubWF0Y2hlcihhdHRycykpO1xuICB9O1xuXG4gIC8vIFJldHVybiB0aGUgbWF4aW11bSBlbGVtZW50IChvciBlbGVtZW50LWJhc2VkIGNvbXB1dGF0aW9uKS5cbiAgXy5tYXggPSBmdW5jdGlvbihvYmosIGl0ZXJhdGVlLCBjb250ZXh0KSB7XG4gICAgdmFyIHJlc3VsdCA9IC1JbmZpbml0eSwgbGFzdENvbXB1dGVkID0gLUluZmluaXR5LFxuICAgICAgICB2YWx1ZSwgY29tcHV0ZWQ7XG4gICAgaWYgKGl0ZXJhdGVlID09IG51bGwgfHwgdHlwZW9mIGl0ZXJhdGVlID09ICdudW1iZXInICYmIHR5cGVvZiBvYmpbMF0gIT0gJ29iamVjdCcgJiYgb2JqICE9IG51bGwpIHtcbiAgICAgIG9iaiA9IGlzQXJyYXlMaWtlKG9iaikgPyBvYmogOiBfLnZhbHVlcyhvYmopO1xuICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aCA9IG9iai5sZW5ndGg7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgICB2YWx1ZSA9IG9ialtpXTtcbiAgICAgICAgaWYgKHZhbHVlICE9IG51bGwgJiYgdmFsdWUgPiByZXN1bHQpIHtcbiAgICAgICAgICByZXN1bHQgPSB2YWx1ZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBpdGVyYXRlZSA9IGNiKGl0ZXJhdGVlLCBjb250ZXh0KTtcbiAgICAgIF8uZWFjaChvYmosIGZ1bmN0aW9uKHYsIGluZGV4LCBsaXN0KSB7XG4gICAgICAgIGNvbXB1dGVkID0gaXRlcmF0ZWUodiwgaW5kZXgsIGxpc3QpO1xuICAgICAgICBpZiAoY29tcHV0ZWQgPiBsYXN0Q29tcHV0ZWQgfHwgY29tcHV0ZWQgPT09IC1JbmZpbml0eSAmJiByZXN1bHQgPT09IC1JbmZpbml0eSkge1xuICAgICAgICAgIHJlc3VsdCA9IHY7XG4gICAgICAgICAgbGFzdENvbXB1dGVkID0gY29tcHV0ZWQ7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9O1xuXG4gIC8vIFJldHVybiB0aGUgbWluaW11bSBlbGVtZW50IChvciBlbGVtZW50LWJhc2VkIGNvbXB1dGF0aW9uKS5cbiAgXy5taW4gPSBmdW5jdGlvbihvYmosIGl0ZXJhdGVlLCBjb250ZXh0KSB7XG4gICAgdmFyIHJlc3VsdCA9IEluZmluaXR5LCBsYXN0Q29tcHV0ZWQgPSBJbmZpbml0eSxcbiAgICAgICAgdmFsdWUsIGNvbXB1dGVkO1xuICAgIGlmIChpdGVyYXRlZSA9PSBudWxsIHx8IHR5cGVvZiBpdGVyYXRlZSA9PSAnbnVtYmVyJyAmJiB0eXBlb2Ygb2JqWzBdICE9ICdvYmplY3QnICYmIG9iaiAhPSBudWxsKSB7XG4gICAgICBvYmogPSBpc0FycmF5TGlrZShvYmopID8gb2JqIDogXy52YWx1ZXMob2JqKTtcbiAgICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGggPSBvYmoubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgICAgdmFsdWUgPSBvYmpbaV07XG4gICAgICAgIGlmICh2YWx1ZSAhPSBudWxsICYmIHZhbHVlIDwgcmVzdWx0KSB7XG4gICAgICAgICAgcmVzdWx0ID0gdmFsdWU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgaXRlcmF0ZWUgPSBjYihpdGVyYXRlZSwgY29udGV4dCk7XG4gICAgICBfLmVhY2gob2JqLCBmdW5jdGlvbih2LCBpbmRleCwgbGlzdCkge1xuICAgICAgICBjb21wdXRlZCA9IGl0ZXJhdGVlKHYsIGluZGV4LCBsaXN0KTtcbiAgICAgICAgaWYgKGNvbXB1dGVkIDwgbGFzdENvbXB1dGVkIHx8IGNvbXB1dGVkID09PSBJbmZpbml0eSAmJiByZXN1bHQgPT09IEluZmluaXR5KSB7XG4gICAgICAgICAgcmVzdWx0ID0gdjtcbiAgICAgICAgICBsYXN0Q29tcHV0ZWQgPSBjb21wdXRlZDtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG4gIH07XG5cbiAgLy8gU2h1ZmZsZSBhIGNvbGxlY3Rpb24uXG4gIF8uc2h1ZmZsZSA9IGZ1bmN0aW9uKG9iaikge1xuICAgIHJldHVybiBfLnNhbXBsZShvYmosIEluZmluaXR5KTtcbiAgfTtcblxuICAvLyBTYW1wbGUgKipuKiogcmFuZG9tIHZhbHVlcyBmcm9tIGEgY29sbGVjdGlvbiB1c2luZyB0aGUgbW9kZXJuIHZlcnNpb24gb2YgdGhlXG4gIC8vIFtGaXNoZXItWWF0ZXMgc2h1ZmZsZV0oaHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9GaXNoZXLigJNZYXRlc19zaHVmZmxlKS5cbiAgLy8gSWYgKipuKiogaXMgbm90IHNwZWNpZmllZCwgcmV0dXJucyBhIHNpbmdsZSByYW5kb20gZWxlbWVudC5cbiAgLy8gVGhlIGludGVybmFsIGBndWFyZGAgYXJndW1lbnQgYWxsb3dzIGl0IHRvIHdvcmsgd2l0aCBgbWFwYC5cbiAgXy5zYW1wbGUgPSBmdW5jdGlvbihvYmosIG4sIGd1YXJkKSB7XG4gICAgaWYgKG4gPT0gbnVsbCB8fCBndWFyZCkge1xuICAgICAgaWYgKCFpc0FycmF5TGlrZShvYmopKSBvYmogPSBfLnZhbHVlcyhvYmopO1xuICAgICAgcmV0dXJuIG9ialtfLnJhbmRvbShvYmoubGVuZ3RoIC0gMSldO1xuICAgIH1cbiAgICB2YXIgc2FtcGxlID0gaXNBcnJheUxpa2Uob2JqKSA/IF8uY2xvbmUob2JqKSA6IF8udmFsdWVzKG9iaik7XG4gICAgdmFyIGxlbmd0aCA9IGdldExlbmd0aChzYW1wbGUpO1xuICAgIG4gPSBNYXRoLm1heChNYXRoLm1pbihuLCBsZW5ndGgpLCAwKTtcbiAgICB2YXIgbGFzdCA9IGxlbmd0aCAtIDE7XG4gICAgZm9yICh2YXIgaW5kZXggPSAwOyBpbmRleCA8IG47IGluZGV4KyspIHtcbiAgICAgIHZhciByYW5kID0gXy5yYW5kb20oaW5kZXgsIGxhc3QpO1xuICAgICAgdmFyIHRlbXAgPSBzYW1wbGVbaW5kZXhdO1xuICAgICAgc2FtcGxlW2luZGV4XSA9IHNhbXBsZVtyYW5kXTtcbiAgICAgIHNhbXBsZVtyYW5kXSA9IHRlbXA7XG4gICAgfVxuICAgIHJldHVybiBzYW1wbGUuc2xpY2UoMCwgbik7XG4gIH07XG5cbiAgLy8gU29ydCB0aGUgb2JqZWN0J3MgdmFsdWVzIGJ5IGEgY3JpdGVyaW9uIHByb2R1Y2VkIGJ5IGFuIGl0ZXJhdGVlLlxuICBfLnNvcnRCeSA9IGZ1bmN0aW9uKG9iaiwgaXRlcmF0ZWUsIGNvbnRleHQpIHtcbiAgICB2YXIgaW5kZXggPSAwO1xuICAgIGl0ZXJhdGVlID0gY2IoaXRlcmF0ZWUsIGNvbnRleHQpO1xuICAgIHJldHVybiBfLnBsdWNrKF8ubWFwKG9iaiwgZnVuY3Rpb24odmFsdWUsIGtleSwgbGlzdCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdmFsdWU6IHZhbHVlLFxuICAgICAgICBpbmRleDogaW5kZXgrKyxcbiAgICAgICAgY3JpdGVyaWE6IGl0ZXJhdGVlKHZhbHVlLCBrZXksIGxpc3QpXG4gICAgICB9O1xuICAgIH0pLnNvcnQoZnVuY3Rpb24obGVmdCwgcmlnaHQpIHtcbiAgICAgIHZhciBhID0gbGVmdC5jcml0ZXJpYTtcbiAgICAgIHZhciBiID0gcmlnaHQuY3JpdGVyaWE7XG4gICAgICBpZiAoYSAhPT0gYikge1xuICAgICAgICBpZiAoYSA+IGIgfHwgYSA9PT0gdm9pZCAwKSByZXR1cm4gMTtcbiAgICAgICAgaWYgKGEgPCBiIHx8IGIgPT09IHZvaWQgMCkgcmV0dXJuIC0xO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGxlZnQuaW5kZXggLSByaWdodC5pbmRleDtcbiAgICB9KSwgJ3ZhbHVlJyk7XG4gIH07XG5cbiAgLy8gQW4gaW50ZXJuYWwgZnVuY3Rpb24gdXNlZCBmb3IgYWdncmVnYXRlIFwiZ3JvdXAgYnlcIiBvcGVyYXRpb25zLlxuICB2YXIgZ3JvdXAgPSBmdW5jdGlvbihiZWhhdmlvciwgcGFydGl0aW9uKSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uKG9iaiwgaXRlcmF0ZWUsIGNvbnRleHQpIHtcbiAgICAgIHZhciByZXN1bHQgPSBwYXJ0aXRpb24gPyBbW10sIFtdXSA6IHt9O1xuICAgICAgaXRlcmF0ZWUgPSBjYihpdGVyYXRlZSwgY29udGV4dCk7XG4gICAgICBfLmVhY2gob2JqLCBmdW5jdGlvbih2YWx1ZSwgaW5kZXgpIHtcbiAgICAgICAgdmFyIGtleSA9IGl0ZXJhdGVlKHZhbHVlLCBpbmRleCwgb2JqKTtcbiAgICAgICAgYmVoYXZpb3IocmVzdWx0LCB2YWx1ZSwga2V5KTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9O1xuICB9O1xuXG4gIC8vIEdyb3VwcyB0aGUgb2JqZWN0J3MgdmFsdWVzIGJ5IGEgY3JpdGVyaW9uLiBQYXNzIGVpdGhlciBhIHN0cmluZyBhdHRyaWJ1dGVcbiAgLy8gdG8gZ3JvdXAgYnksIG9yIGEgZnVuY3Rpb24gdGhhdCByZXR1cm5zIHRoZSBjcml0ZXJpb24uXG4gIF8uZ3JvdXBCeSA9IGdyb3VwKGZ1bmN0aW9uKHJlc3VsdCwgdmFsdWUsIGtleSkge1xuICAgIGlmIChoYXMocmVzdWx0LCBrZXkpKSByZXN1bHRba2V5XS5wdXNoKHZhbHVlKTsgZWxzZSByZXN1bHRba2V5XSA9IFt2YWx1ZV07XG4gIH0pO1xuXG4gIC8vIEluZGV4ZXMgdGhlIG9iamVjdCdzIHZhbHVlcyBieSBhIGNyaXRlcmlvbiwgc2ltaWxhciB0byBgZ3JvdXBCeWAsIGJ1dCBmb3JcbiAgLy8gd2hlbiB5b3Uga25vdyB0aGF0IHlvdXIgaW5kZXggdmFsdWVzIHdpbGwgYmUgdW5pcXVlLlxuICBfLmluZGV4QnkgPSBncm91cChmdW5jdGlvbihyZXN1bHQsIHZhbHVlLCBrZXkpIHtcbiAgICByZXN1bHRba2V5XSA9IHZhbHVlO1xuICB9KTtcblxuICAvLyBDb3VudHMgaW5zdGFuY2VzIG9mIGFuIG9iamVjdCB0aGF0IGdyb3VwIGJ5IGEgY2VydGFpbiBjcml0ZXJpb24uIFBhc3NcbiAgLy8gZWl0aGVyIGEgc3RyaW5nIGF0dHJpYnV0ZSB0byBjb3VudCBieSwgb3IgYSBmdW5jdGlvbiB0aGF0IHJldHVybnMgdGhlXG4gIC8vIGNyaXRlcmlvbi5cbiAgXy5jb3VudEJ5ID0gZ3JvdXAoZnVuY3Rpb24ocmVzdWx0LCB2YWx1ZSwga2V5KSB7XG4gICAgaWYgKGhhcyhyZXN1bHQsIGtleSkpIHJlc3VsdFtrZXldKys7IGVsc2UgcmVzdWx0W2tleV0gPSAxO1xuICB9KTtcblxuICB2YXIgcmVTdHJTeW1ib2wgPSAvW15cXHVkODAwLVxcdWRmZmZdfFtcXHVkODAwLVxcdWRiZmZdW1xcdWRjMDAtXFx1ZGZmZl18W1xcdWQ4MDAtXFx1ZGZmZl0vZztcbiAgLy8gU2FmZWx5IGNyZWF0ZSBhIHJlYWwsIGxpdmUgYXJyYXkgZnJvbSBhbnl0aGluZyBpdGVyYWJsZS5cbiAgXy50b0FycmF5ID0gZnVuY3Rpb24ob2JqKSB7XG4gICAgaWYgKCFvYmopIHJldHVybiBbXTtcbiAgICBpZiAoXy5pc0FycmF5KG9iaikpIHJldHVybiBzbGljZS5jYWxsKG9iaik7XG4gICAgaWYgKF8uaXNTdHJpbmcob2JqKSkge1xuICAgICAgLy8gS2VlcCBzdXJyb2dhdGUgcGFpciBjaGFyYWN0ZXJzIHRvZ2V0aGVyXG4gICAgICByZXR1cm4gb2JqLm1hdGNoKHJlU3RyU3ltYm9sKTtcbiAgICB9XG4gICAgaWYgKGlzQXJyYXlMaWtlKG9iaikpIHJldHVybiBfLm1hcChvYmosIF8uaWRlbnRpdHkpO1xuICAgIHJldHVybiBfLnZhbHVlcyhvYmopO1xuICB9O1xuXG4gIC8vIFJldHVybiB0aGUgbnVtYmVyIG9mIGVsZW1lbnRzIGluIGFuIG9iamVjdC5cbiAgXy5zaXplID0gZnVuY3Rpb24ob2JqKSB7XG4gICAgaWYgKG9iaiA9PSBudWxsKSByZXR1cm4gMDtcbiAgICByZXR1cm4gaXNBcnJheUxpa2Uob2JqKSA/IG9iai5sZW5ndGggOiBfLmtleXMob2JqKS5sZW5ndGg7XG4gIH07XG5cbiAgLy8gU3BsaXQgYSBjb2xsZWN0aW9uIGludG8gdHdvIGFycmF5czogb25lIHdob3NlIGVsZW1lbnRzIGFsbCBzYXRpc2Z5IHRoZSBnaXZlblxuICAvLyBwcmVkaWNhdGUsIGFuZCBvbmUgd2hvc2UgZWxlbWVudHMgYWxsIGRvIG5vdCBzYXRpc2Z5IHRoZSBwcmVkaWNhdGUuXG4gIF8ucGFydGl0aW9uID0gZ3JvdXAoZnVuY3Rpb24ocmVzdWx0LCB2YWx1ZSwgcGFzcykge1xuICAgIHJlc3VsdFtwYXNzID8gMCA6IDFdLnB1c2godmFsdWUpO1xuICB9LCB0cnVlKTtcblxuICAvLyBBcnJheSBGdW5jdGlvbnNcbiAgLy8gLS0tLS0tLS0tLS0tLS0tXG5cbiAgLy8gR2V0IHRoZSBmaXJzdCBlbGVtZW50IG9mIGFuIGFycmF5LiBQYXNzaW5nICoqbioqIHdpbGwgcmV0dXJuIHRoZSBmaXJzdCBOXG4gIC8vIHZhbHVlcyBpbiB0aGUgYXJyYXkuIEFsaWFzZWQgYXMgYGhlYWRgIGFuZCBgdGFrZWAuIFRoZSAqKmd1YXJkKiogY2hlY2tcbiAgLy8gYWxsb3dzIGl0IHRvIHdvcmsgd2l0aCBgXy5tYXBgLlxuICBfLmZpcnN0ID0gXy5oZWFkID0gXy50YWtlID0gZnVuY3Rpb24oYXJyYXksIG4sIGd1YXJkKSB7XG4gICAgaWYgKGFycmF5ID09IG51bGwgfHwgYXJyYXkubGVuZ3RoIDwgMSkgcmV0dXJuIG4gPT0gbnVsbCA/IHZvaWQgMCA6IFtdO1xuICAgIGlmIChuID09IG51bGwgfHwgZ3VhcmQpIHJldHVybiBhcnJheVswXTtcbiAgICByZXR1cm4gXy5pbml0aWFsKGFycmF5LCBhcnJheS5sZW5ndGggLSBuKTtcbiAgfTtcblxuICAvLyBSZXR1cm5zIGV2ZXJ5dGhpbmcgYnV0IHRoZSBsYXN0IGVudHJ5IG9mIHRoZSBhcnJheS4gRXNwZWNpYWxseSB1c2VmdWwgb25cbiAgLy8gdGhlIGFyZ3VtZW50cyBvYmplY3QuIFBhc3NpbmcgKipuKiogd2lsbCByZXR1cm4gYWxsIHRoZSB2YWx1ZXMgaW5cbiAgLy8gdGhlIGFycmF5LCBleGNsdWRpbmcgdGhlIGxhc3QgTi5cbiAgXy5pbml0aWFsID0gZnVuY3Rpb24oYXJyYXksIG4sIGd1YXJkKSB7XG4gICAgcmV0dXJuIHNsaWNlLmNhbGwoYXJyYXksIDAsIE1hdGgubWF4KDAsIGFycmF5Lmxlbmd0aCAtIChuID09IG51bGwgfHwgZ3VhcmQgPyAxIDogbikpKTtcbiAgfTtcblxuICAvLyBHZXQgdGhlIGxhc3QgZWxlbWVudCBvZiBhbiBhcnJheS4gUGFzc2luZyAqKm4qKiB3aWxsIHJldHVybiB0aGUgbGFzdCBOXG4gIC8vIHZhbHVlcyBpbiB0aGUgYXJyYXkuXG4gIF8ubGFzdCA9IGZ1bmN0aW9uKGFycmF5LCBuLCBndWFyZCkge1xuICAgIGlmIChhcnJheSA9PSBudWxsIHx8IGFycmF5Lmxlbmd0aCA8IDEpIHJldHVybiBuID09IG51bGwgPyB2b2lkIDAgOiBbXTtcbiAgICBpZiAobiA9PSBudWxsIHx8IGd1YXJkKSByZXR1cm4gYXJyYXlbYXJyYXkubGVuZ3RoIC0gMV07XG4gICAgcmV0dXJuIF8ucmVzdChhcnJheSwgTWF0aC5tYXgoMCwgYXJyYXkubGVuZ3RoIC0gbikpO1xuICB9O1xuXG4gIC8vIFJldHVybnMgZXZlcnl0aGluZyBidXQgdGhlIGZpcnN0IGVudHJ5IG9mIHRoZSBhcnJheS4gQWxpYXNlZCBhcyBgdGFpbGAgYW5kIGBkcm9wYC5cbiAgLy8gRXNwZWNpYWxseSB1c2VmdWwgb24gdGhlIGFyZ3VtZW50cyBvYmplY3QuIFBhc3NpbmcgYW4gKipuKiogd2lsbCByZXR1cm5cbiAgLy8gdGhlIHJlc3QgTiB2YWx1ZXMgaW4gdGhlIGFycmF5LlxuICBfLnJlc3QgPSBfLnRhaWwgPSBfLmRyb3AgPSBmdW5jdGlvbihhcnJheSwgbiwgZ3VhcmQpIHtcbiAgICByZXR1cm4gc2xpY2UuY2FsbChhcnJheSwgbiA9PSBudWxsIHx8IGd1YXJkID8gMSA6IG4pO1xuICB9O1xuXG4gIC8vIFRyaW0gb3V0IGFsbCBmYWxzeSB2YWx1ZXMgZnJvbSBhbiBhcnJheS5cbiAgXy5jb21wYWN0ID0gZnVuY3Rpb24oYXJyYXkpIHtcbiAgICByZXR1cm4gXy5maWx0ZXIoYXJyYXksIEJvb2xlYW4pO1xuICB9O1xuXG4gIC8vIEludGVybmFsIGltcGxlbWVudGF0aW9uIG9mIGEgcmVjdXJzaXZlIGBmbGF0dGVuYCBmdW5jdGlvbi5cbiAgdmFyIGZsYXR0ZW4gPSBmdW5jdGlvbihpbnB1dCwgc2hhbGxvdywgc3RyaWN0LCBvdXRwdXQpIHtcbiAgICBvdXRwdXQgPSBvdXRwdXQgfHwgW107XG4gICAgdmFyIGlkeCA9IG91dHB1dC5sZW5ndGg7XG4gICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aCA9IGdldExlbmd0aChpbnB1dCk7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgdmFyIHZhbHVlID0gaW5wdXRbaV07XG4gICAgICBpZiAoaXNBcnJheUxpa2UodmFsdWUpICYmIChfLmlzQXJyYXkodmFsdWUpIHx8IF8uaXNBcmd1bWVudHModmFsdWUpKSkge1xuICAgICAgICAvLyBGbGF0dGVuIGN1cnJlbnQgbGV2ZWwgb2YgYXJyYXkgb3IgYXJndW1lbnRzIG9iamVjdC5cbiAgICAgICAgaWYgKHNoYWxsb3cpIHtcbiAgICAgICAgICB2YXIgaiA9IDAsIGxlbiA9IHZhbHVlLmxlbmd0aDtcbiAgICAgICAgICB3aGlsZSAoaiA8IGxlbikgb3V0cHV0W2lkeCsrXSA9IHZhbHVlW2orK107XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZmxhdHRlbih2YWx1ZSwgc2hhbGxvdywgc3RyaWN0LCBvdXRwdXQpO1xuICAgICAgICAgIGlkeCA9IG91dHB1dC5sZW5ndGg7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAoIXN0cmljdCkge1xuICAgICAgICBvdXRwdXRbaWR4KytdID0gdmFsdWU7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBvdXRwdXQ7XG4gIH07XG5cbiAgLy8gRmxhdHRlbiBvdXQgYW4gYXJyYXksIGVpdGhlciByZWN1cnNpdmVseSAoYnkgZGVmYXVsdCksIG9yIGp1c3Qgb25lIGxldmVsLlxuICBfLmZsYXR0ZW4gPSBmdW5jdGlvbihhcnJheSwgc2hhbGxvdykge1xuICAgIHJldHVybiBmbGF0dGVuKGFycmF5LCBzaGFsbG93LCBmYWxzZSk7XG4gIH07XG5cbiAgLy8gUmV0dXJuIGEgdmVyc2lvbiBvZiB0aGUgYXJyYXkgdGhhdCBkb2VzIG5vdCBjb250YWluIHRoZSBzcGVjaWZpZWQgdmFsdWUocykuXG4gIF8ud2l0aG91dCA9IHJlc3RBcmd1bWVudHMoZnVuY3Rpb24oYXJyYXksIG90aGVyQXJyYXlzKSB7XG4gICAgcmV0dXJuIF8uZGlmZmVyZW5jZShhcnJheSwgb3RoZXJBcnJheXMpO1xuICB9KTtcblxuICAvLyBQcm9kdWNlIGEgZHVwbGljYXRlLWZyZWUgdmVyc2lvbiBvZiB0aGUgYXJyYXkuIElmIHRoZSBhcnJheSBoYXMgYWxyZWFkeVxuICAvLyBiZWVuIHNvcnRlZCwgeW91IGhhdmUgdGhlIG9wdGlvbiBvZiB1c2luZyBhIGZhc3RlciBhbGdvcml0aG0uXG4gIC8vIFRoZSBmYXN0ZXIgYWxnb3JpdGhtIHdpbGwgbm90IHdvcmsgd2l0aCBhbiBpdGVyYXRlZSBpZiB0aGUgaXRlcmF0ZWVcbiAgLy8gaXMgbm90IGEgb25lLXRvLW9uZSBmdW5jdGlvbiwgc28gcHJvdmlkaW5nIGFuIGl0ZXJhdGVlIHdpbGwgZGlzYWJsZVxuICAvLyB0aGUgZmFzdGVyIGFsZ29yaXRobS5cbiAgLy8gQWxpYXNlZCBhcyBgdW5pcXVlYC5cbiAgXy51bmlxID0gXy51bmlxdWUgPSBmdW5jdGlvbihhcnJheSwgaXNTb3J0ZWQsIGl0ZXJhdGVlLCBjb250ZXh0KSB7XG4gICAgaWYgKCFfLmlzQm9vbGVhbihpc1NvcnRlZCkpIHtcbiAgICAgIGNvbnRleHQgPSBpdGVyYXRlZTtcbiAgICAgIGl0ZXJhdGVlID0gaXNTb3J0ZWQ7XG4gICAgICBpc1NvcnRlZCA9IGZhbHNlO1xuICAgIH1cbiAgICBpZiAoaXRlcmF0ZWUgIT0gbnVsbCkgaXRlcmF0ZWUgPSBjYihpdGVyYXRlZSwgY29udGV4dCk7XG4gICAgdmFyIHJlc3VsdCA9IFtdO1xuICAgIHZhciBzZWVuID0gW107XG4gICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aCA9IGdldExlbmd0aChhcnJheSk7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgdmFyIHZhbHVlID0gYXJyYXlbaV0sXG4gICAgICAgICAgY29tcHV0ZWQgPSBpdGVyYXRlZSA/IGl0ZXJhdGVlKHZhbHVlLCBpLCBhcnJheSkgOiB2YWx1ZTtcbiAgICAgIGlmIChpc1NvcnRlZCAmJiAhaXRlcmF0ZWUpIHtcbiAgICAgICAgaWYgKCFpIHx8IHNlZW4gIT09IGNvbXB1dGVkKSByZXN1bHQucHVzaCh2YWx1ZSk7XG4gICAgICAgIHNlZW4gPSBjb21wdXRlZDtcbiAgICAgIH0gZWxzZSBpZiAoaXRlcmF0ZWUpIHtcbiAgICAgICAgaWYgKCFfLmNvbnRhaW5zKHNlZW4sIGNvbXB1dGVkKSkge1xuICAgICAgICAgIHNlZW4ucHVzaChjb21wdXRlZCk7XG4gICAgICAgICAgcmVzdWx0LnB1c2godmFsdWUpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKCFfLmNvbnRhaW5zKHJlc3VsdCwgdmFsdWUpKSB7XG4gICAgICAgIHJlc3VsdC5wdXNoKHZhbHVlKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfTtcblxuICAvLyBQcm9kdWNlIGFuIGFycmF5IHRoYXQgY29udGFpbnMgdGhlIHVuaW9uOiBlYWNoIGRpc3RpbmN0IGVsZW1lbnQgZnJvbSBhbGwgb2ZcbiAgLy8gdGhlIHBhc3NlZC1pbiBhcnJheXMuXG4gIF8udW5pb24gPSByZXN0QXJndW1lbnRzKGZ1bmN0aW9uKGFycmF5cykge1xuICAgIHJldHVybiBfLnVuaXEoZmxhdHRlbihhcnJheXMsIHRydWUsIHRydWUpKTtcbiAgfSk7XG5cbiAgLy8gUHJvZHVjZSBhbiBhcnJheSB0aGF0IGNvbnRhaW5zIGV2ZXJ5IGl0ZW0gc2hhcmVkIGJldHdlZW4gYWxsIHRoZVxuICAvLyBwYXNzZWQtaW4gYXJyYXlzLlxuICBfLmludGVyc2VjdGlvbiA9IGZ1bmN0aW9uKGFycmF5KSB7XG4gICAgdmFyIHJlc3VsdCA9IFtdO1xuICAgIHZhciBhcmdzTGVuZ3RoID0gYXJndW1lbnRzLmxlbmd0aDtcbiAgICBmb3IgKHZhciBpID0gMCwgbGVuZ3RoID0gZ2V0TGVuZ3RoKGFycmF5KTsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgICB2YXIgaXRlbSA9IGFycmF5W2ldO1xuICAgICAgaWYgKF8uY29udGFpbnMocmVzdWx0LCBpdGVtKSkgY29udGludWU7XG4gICAgICB2YXIgajtcbiAgICAgIGZvciAoaiA9IDE7IGogPCBhcmdzTGVuZ3RoOyBqKyspIHtcbiAgICAgICAgaWYgKCFfLmNvbnRhaW5zKGFyZ3VtZW50c1tqXSwgaXRlbSkpIGJyZWFrO1xuICAgICAgfVxuICAgICAgaWYgKGogPT09IGFyZ3NMZW5ndGgpIHJlc3VsdC5wdXNoKGl0ZW0pO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9O1xuXG4gIC8vIFRha2UgdGhlIGRpZmZlcmVuY2UgYmV0d2VlbiBvbmUgYXJyYXkgYW5kIGEgbnVtYmVyIG9mIG90aGVyIGFycmF5cy5cbiAgLy8gT25seSB0aGUgZWxlbWVudHMgcHJlc2VudCBpbiBqdXN0IHRoZSBmaXJzdCBhcnJheSB3aWxsIHJlbWFpbi5cbiAgXy5kaWZmZXJlbmNlID0gcmVzdEFyZ3VtZW50cyhmdW5jdGlvbihhcnJheSwgcmVzdCkge1xuICAgIHJlc3QgPSBmbGF0dGVuKHJlc3QsIHRydWUsIHRydWUpO1xuICAgIHJldHVybiBfLmZpbHRlcihhcnJheSwgZnVuY3Rpb24odmFsdWUpe1xuICAgICAgcmV0dXJuICFfLmNvbnRhaW5zKHJlc3QsIHZhbHVlKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgLy8gQ29tcGxlbWVudCBvZiBfLnppcC4gVW56aXAgYWNjZXB0cyBhbiBhcnJheSBvZiBhcnJheXMgYW5kIGdyb3Vwc1xuICAvLyBlYWNoIGFycmF5J3MgZWxlbWVudHMgb24gc2hhcmVkIGluZGljZXMuXG4gIF8udW56aXAgPSBmdW5jdGlvbihhcnJheSkge1xuICAgIHZhciBsZW5ndGggPSBhcnJheSAmJiBfLm1heChhcnJheSwgZ2V0TGVuZ3RoKS5sZW5ndGggfHwgMDtcbiAgICB2YXIgcmVzdWx0ID0gQXJyYXkobGVuZ3RoKTtcblxuICAgIGZvciAodmFyIGluZGV4ID0gMDsgaW5kZXggPCBsZW5ndGg7IGluZGV4KyspIHtcbiAgICAgIHJlc3VsdFtpbmRleF0gPSBfLnBsdWNrKGFycmF5LCBpbmRleCk7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG4gIH07XG5cbiAgLy8gWmlwIHRvZ2V0aGVyIG11bHRpcGxlIGxpc3RzIGludG8gYSBzaW5nbGUgYXJyYXkgLS0gZWxlbWVudHMgdGhhdCBzaGFyZVxuICAvLyBhbiBpbmRleCBnbyB0b2dldGhlci5cbiAgXy56aXAgPSByZXN0QXJndW1lbnRzKF8udW56aXApO1xuXG4gIC8vIENvbnZlcnRzIGxpc3RzIGludG8gb2JqZWN0cy4gUGFzcyBlaXRoZXIgYSBzaW5nbGUgYXJyYXkgb2YgYFtrZXksIHZhbHVlXWBcbiAgLy8gcGFpcnMsIG9yIHR3byBwYXJhbGxlbCBhcnJheXMgb2YgdGhlIHNhbWUgbGVuZ3RoIC0tIG9uZSBvZiBrZXlzLCBhbmQgb25lIG9mXG4gIC8vIHRoZSBjb3JyZXNwb25kaW5nIHZhbHVlcy4gUGFzc2luZyBieSBwYWlycyBpcyB0aGUgcmV2ZXJzZSBvZiBfLnBhaXJzLlxuICBfLm9iamVjdCA9IGZ1bmN0aW9uKGxpc3QsIHZhbHVlcykge1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBmb3IgKHZhciBpID0gMCwgbGVuZ3RoID0gZ2V0TGVuZ3RoKGxpc3QpOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgIGlmICh2YWx1ZXMpIHtcbiAgICAgICAgcmVzdWx0W2xpc3RbaV1dID0gdmFsdWVzW2ldO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVzdWx0W2xpc3RbaV1bMF1dID0gbGlzdFtpXVsxXTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfTtcblxuICAvLyBHZW5lcmF0b3IgZnVuY3Rpb24gdG8gY3JlYXRlIHRoZSBmaW5kSW5kZXggYW5kIGZpbmRMYXN0SW5kZXggZnVuY3Rpb25zLlxuICB2YXIgY3JlYXRlUHJlZGljYXRlSW5kZXhGaW5kZXIgPSBmdW5jdGlvbihkaXIpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24oYXJyYXksIHByZWRpY2F0ZSwgY29udGV4dCkge1xuICAgICAgcHJlZGljYXRlID0gY2IocHJlZGljYXRlLCBjb250ZXh0KTtcbiAgICAgIHZhciBsZW5ndGggPSBnZXRMZW5ndGgoYXJyYXkpO1xuICAgICAgdmFyIGluZGV4ID0gZGlyID4gMCA/IDAgOiBsZW5ndGggLSAxO1xuICAgICAgZm9yICg7IGluZGV4ID49IDAgJiYgaW5kZXggPCBsZW5ndGg7IGluZGV4ICs9IGRpcikge1xuICAgICAgICBpZiAocHJlZGljYXRlKGFycmF5W2luZGV4XSwgaW5kZXgsIGFycmF5KSkgcmV0dXJuIGluZGV4O1xuICAgICAgfVxuICAgICAgcmV0dXJuIC0xO1xuICAgIH07XG4gIH07XG5cbiAgLy8gUmV0dXJucyB0aGUgZmlyc3QgaW5kZXggb24gYW4gYXJyYXktbGlrZSB0aGF0IHBhc3NlcyBhIHByZWRpY2F0ZSB0ZXN0LlxuICBfLmZpbmRJbmRleCA9IGNyZWF0ZVByZWRpY2F0ZUluZGV4RmluZGVyKDEpO1xuICBfLmZpbmRMYXN0SW5kZXggPSBjcmVhdGVQcmVkaWNhdGVJbmRleEZpbmRlcigtMSk7XG5cbiAgLy8gVXNlIGEgY29tcGFyYXRvciBmdW5jdGlvbiB0byBmaWd1cmUgb3V0IHRoZSBzbWFsbGVzdCBpbmRleCBhdCB3aGljaFxuICAvLyBhbiBvYmplY3Qgc2hvdWxkIGJlIGluc2VydGVkIHNvIGFzIHRvIG1haW50YWluIG9yZGVyLiBVc2VzIGJpbmFyeSBzZWFyY2guXG4gIF8uc29ydGVkSW5kZXggPSBmdW5jdGlvbihhcnJheSwgb2JqLCBpdGVyYXRlZSwgY29udGV4dCkge1xuICAgIGl0ZXJhdGVlID0gY2IoaXRlcmF0ZWUsIGNvbnRleHQsIDEpO1xuICAgIHZhciB2YWx1ZSA9IGl0ZXJhdGVlKG9iaik7XG4gICAgdmFyIGxvdyA9IDAsIGhpZ2ggPSBnZXRMZW5ndGgoYXJyYXkpO1xuICAgIHdoaWxlIChsb3cgPCBoaWdoKSB7XG4gICAgICB2YXIgbWlkID0gTWF0aC5mbG9vcigobG93ICsgaGlnaCkgLyAyKTtcbiAgICAgIGlmIChpdGVyYXRlZShhcnJheVttaWRdKSA8IHZhbHVlKSBsb3cgPSBtaWQgKyAxOyBlbHNlIGhpZ2ggPSBtaWQ7XG4gICAgfVxuICAgIHJldHVybiBsb3c7XG4gIH07XG5cbiAgLy8gR2VuZXJhdG9yIGZ1bmN0aW9uIHRvIGNyZWF0ZSB0aGUgaW5kZXhPZiBhbmQgbGFzdEluZGV4T2YgZnVuY3Rpb25zLlxuICB2YXIgY3JlYXRlSW5kZXhGaW5kZXIgPSBmdW5jdGlvbihkaXIsIHByZWRpY2F0ZUZpbmQsIHNvcnRlZEluZGV4KSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uKGFycmF5LCBpdGVtLCBpZHgpIHtcbiAgICAgIHZhciBpID0gMCwgbGVuZ3RoID0gZ2V0TGVuZ3RoKGFycmF5KTtcbiAgICAgIGlmICh0eXBlb2YgaWR4ID09ICdudW1iZXInKSB7XG4gICAgICAgIGlmIChkaXIgPiAwKSB7XG4gICAgICAgICAgaSA9IGlkeCA+PSAwID8gaWR4IDogTWF0aC5tYXgoaWR4ICsgbGVuZ3RoLCBpKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBsZW5ndGggPSBpZHggPj0gMCA/IE1hdGgubWluKGlkeCArIDEsIGxlbmd0aCkgOiBpZHggKyBsZW5ndGggKyAxO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKHNvcnRlZEluZGV4ICYmIGlkeCAmJiBsZW5ndGgpIHtcbiAgICAgICAgaWR4ID0gc29ydGVkSW5kZXgoYXJyYXksIGl0ZW0pO1xuICAgICAgICByZXR1cm4gYXJyYXlbaWR4XSA9PT0gaXRlbSA/IGlkeCA6IC0xO1xuICAgICAgfVxuICAgICAgaWYgKGl0ZW0gIT09IGl0ZW0pIHtcbiAgICAgICAgaWR4ID0gcHJlZGljYXRlRmluZChzbGljZS5jYWxsKGFycmF5LCBpLCBsZW5ndGgpLCBfLmlzTmFOKTtcbiAgICAgICAgcmV0dXJuIGlkeCA+PSAwID8gaWR4ICsgaSA6IC0xO1xuICAgICAgfVxuICAgICAgZm9yIChpZHggPSBkaXIgPiAwID8gaSA6IGxlbmd0aCAtIDE7IGlkeCA+PSAwICYmIGlkeCA8IGxlbmd0aDsgaWR4ICs9IGRpcikge1xuICAgICAgICBpZiAoYXJyYXlbaWR4XSA9PT0gaXRlbSkgcmV0dXJuIGlkeDtcbiAgICAgIH1cbiAgICAgIHJldHVybiAtMTtcbiAgICB9O1xuICB9O1xuXG4gIC8vIFJldHVybiB0aGUgcG9zaXRpb24gb2YgdGhlIGZpcnN0IG9jY3VycmVuY2Ugb2YgYW4gaXRlbSBpbiBhbiBhcnJheSxcbiAgLy8gb3IgLTEgaWYgdGhlIGl0ZW0gaXMgbm90IGluY2x1ZGVkIGluIHRoZSBhcnJheS5cbiAgLy8gSWYgdGhlIGFycmF5IGlzIGxhcmdlIGFuZCBhbHJlYWR5IGluIHNvcnQgb3JkZXIsIHBhc3MgYHRydWVgXG4gIC8vIGZvciAqKmlzU29ydGVkKiogdG8gdXNlIGJpbmFyeSBzZWFyY2guXG4gIF8uaW5kZXhPZiA9IGNyZWF0ZUluZGV4RmluZGVyKDEsIF8uZmluZEluZGV4LCBfLnNvcnRlZEluZGV4KTtcbiAgXy5sYXN0SW5kZXhPZiA9IGNyZWF0ZUluZGV4RmluZGVyKC0xLCBfLmZpbmRMYXN0SW5kZXgpO1xuXG4gIC8vIEdlbmVyYXRlIGFuIGludGVnZXIgQXJyYXkgY29udGFpbmluZyBhbiBhcml0aG1ldGljIHByb2dyZXNzaW9uLiBBIHBvcnQgb2ZcbiAgLy8gdGhlIG5hdGl2ZSBQeXRob24gYHJhbmdlKClgIGZ1bmN0aW9uLiBTZWVcbiAgLy8gW3RoZSBQeXRob24gZG9jdW1lbnRhdGlvbl0oaHR0cDovL2RvY3MucHl0aG9uLm9yZy9saWJyYXJ5L2Z1bmN0aW9ucy5odG1sI3JhbmdlKS5cbiAgXy5yYW5nZSA9IGZ1bmN0aW9uKHN0YXJ0LCBzdG9wLCBzdGVwKSB7XG4gICAgaWYgKHN0b3AgPT0gbnVsbCkge1xuICAgICAgc3RvcCA9IHN0YXJ0IHx8IDA7XG4gICAgICBzdGFydCA9IDA7XG4gICAgfVxuICAgIGlmICghc3RlcCkge1xuICAgICAgc3RlcCA9IHN0b3AgPCBzdGFydCA/IC0xIDogMTtcbiAgICB9XG5cbiAgICB2YXIgbGVuZ3RoID0gTWF0aC5tYXgoTWF0aC5jZWlsKChzdG9wIC0gc3RhcnQpIC8gc3RlcCksIDApO1xuICAgIHZhciByYW5nZSA9IEFycmF5KGxlbmd0aCk7XG5cbiAgICBmb3IgKHZhciBpZHggPSAwOyBpZHggPCBsZW5ndGg7IGlkeCsrLCBzdGFydCArPSBzdGVwKSB7XG4gICAgICByYW5nZVtpZHhdID0gc3RhcnQ7XG4gICAgfVxuXG4gICAgcmV0dXJuIHJhbmdlO1xuICB9O1xuXG4gIC8vIENodW5rIGEgc2luZ2xlIGFycmF5IGludG8gbXVsdGlwbGUgYXJyYXlzLCBlYWNoIGNvbnRhaW5pbmcgYGNvdW50YCBvciBmZXdlclxuICAvLyBpdGVtcy5cbiAgXy5jaHVuayA9IGZ1bmN0aW9uKGFycmF5LCBjb3VudCkge1xuICAgIGlmIChjb3VudCA9PSBudWxsIHx8IGNvdW50IDwgMSkgcmV0dXJuIFtdO1xuICAgIHZhciByZXN1bHQgPSBbXTtcbiAgICB2YXIgaSA9IDAsIGxlbmd0aCA9IGFycmF5Lmxlbmd0aDtcbiAgICB3aGlsZSAoaSA8IGxlbmd0aCkge1xuICAgICAgcmVzdWx0LnB1c2goc2xpY2UuY2FsbChhcnJheSwgaSwgaSArPSBjb3VudCkpO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9O1xuXG4gIC8vIEZ1bmN0aW9uIChhaGVtKSBGdW5jdGlvbnNcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tXG5cbiAgLy8gRGV0ZXJtaW5lcyB3aGV0aGVyIHRvIGV4ZWN1dGUgYSBmdW5jdGlvbiBhcyBhIGNvbnN0cnVjdG9yXG4gIC8vIG9yIGEgbm9ybWFsIGZ1bmN0aW9uIHdpdGggdGhlIHByb3ZpZGVkIGFyZ3VtZW50cy5cbiAgdmFyIGV4ZWN1dGVCb3VuZCA9IGZ1bmN0aW9uKHNvdXJjZUZ1bmMsIGJvdW5kRnVuYywgY29udGV4dCwgY2FsbGluZ0NvbnRleHQsIGFyZ3MpIHtcbiAgICBpZiAoIShjYWxsaW5nQ29udGV4dCBpbnN0YW5jZW9mIGJvdW5kRnVuYykpIHJldHVybiBzb3VyY2VGdW5jLmFwcGx5KGNvbnRleHQsIGFyZ3MpO1xuICAgIHZhciBzZWxmID0gYmFzZUNyZWF0ZShzb3VyY2VGdW5jLnByb3RvdHlwZSk7XG4gICAgdmFyIHJlc3VsdCA9IHNvdXJjZUZ1bmMuYXBwbHkoc2VsZiwgYXJncyk7XG4gICAgaWYgKF8uaXNPYmplY3QocmVzdWx0KSkgcmV0dXJuIHJlc3VsdDtcbiAgICByZXR1cm4gc2VsZjtcbiAgfTtcblxuICAvLyBDcmVhdGUgYSBmdW5jdGlvbiBib3VuZCB0byBhIGdpdmVuIG9iamVjdCAoYXNzaWduaW5nIGB0aGlzYCwgYW5kIGFyZ3VtZW50cyxcbiAgLy8gb3B0aW9uYWxseSkuIERlbGVnYXRlcyB0byAqKkVDTUFTY3JpcHQgNSoqJ3MgbmF0aXZlIGBGdW5jdGlvbi5iaW5kYCBpZlxuICAvLyBhdmFpbGFibGUuXG4gIF8uYmluZCA9IHJlc3RBcmd1bWVudHMoZnVuY3Rpb24oZnVuYywgY29udGV4dCwgYXJncykge1xuICAgIGlmICghXy5pc0Z1bmN0aW9uKGZ1bmMpKSB0aHJvdyBuZXcgVHlwZUVycm9yKCdCaW5kIG11c3QgYmUgY2FsbGVkIG9uIGEgZnVuY3Rpb24nKTtcbiAgICB2YXIgYm91bmQgPSByZXN0QXJndW1lbnRzKGZ1bmN0aW9uKGNhbGxBcmdzKSB7XG4gICAgICByZXR1cm4gZXhlY3V0ZUJvdW5kKGZ1bmMsIGJvdW5kLCBjb250ZXh0LCB0aGlzLCBhcmdzLmNvbmNhdChjYWxsQXJncykpO1xuICAgIH0pO1xuICAgIHJldHVybiBib3VuZDtcbiAgfSk7XG5cbiAgLy8gUGFydGlhbGx5IGFwcGx5IGEgZnVuY3Rpb24gYnkgY3JlYXRpbmcgYSB2ZXJzaW9uIHRoYXQgaGFzIGhhZCBzb21lIG9mIGl0c1xuICAvLyBhcmd1bWVudHMgcHJlLWZpbGxlZCwgd2l0aG91dCBjaGFuZ2luZyBpdHMgZHluYW1pYyBgdGhpc2AgY29udGV4dC4gXyBhY3RzXG4gIC8vIGFzIGEgcGxhY2Vob2xkZXIgYnkgZGVmYXVsdCwgYWxsb3dpbmcgYW55IGNvbWJpbmF0aW9uIG9mIGFyZ3VtZW50cyB0byBiZVxuICAvLyBwcmUtZmlsbGVkLiBTZXQgYF8ucGFydGlhbC5wbGFjZWhvbGRlcmAgZm9yIGEgY3VzdG9tIHBsYWNlaG9sZGVyIGFyZ3VtZW50LlxuICBfLnBhcnRpYWwgPSByZXN0QXJndW1lbnRzKGZ1bmN0aW9uKGZ1bmMsIGJvdW5kQXJncykge1xuICAgIHZhciBwbGFjZWhvbGRlciA9IF8ucGFydGlhbC5wbGFjZWhvbGRlcjtcbiAgICB2YXIgYm91bmQgPSBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBwb3NpdGlvbiA9IDAsIGxlbmd0aCA9IGJvdW5kQXJncy5sZW5ndGg7XG4gICAgICB2YXIgYXJncyA9IEFycmF5KGxlbmd0aCk7XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGFyZ3NbaV0gPSBib3VuZEFyZ3NbaV0gPT09IHBsYWNlaG9sZGVyID8gYXJndW1lbnRzW3Bvc2l0aW9uKytdIDogYm91bmRBcmdzW2ldO1xuICAgICAgfVxuICAgICAgd2hpbGUgKHBvc2l0aW9uIDwgYXJndW1lbnRzLmxlbmd0aCkgYXJncy5wdXNoKGFyZ3VtZW50c1twb3NpdGlvbisrXSk7XG4gICAgICByZXR1cm4gZXhlY3V0ZUJvdW5kKGZ1bmMsIGJvdW5kLCB0aGlzLCB0aGlzLCBhcmdzKTtcbiAgICB9O1xuICAgIHJldHVybiBib3VuZDtcbiAgfSk7XG5cbiAgXy5wYXJ0aWFsLnBsYWNlaG9sZGVyID0gXztcblxuICAvLyBCaW5kIGEgbnVtYmVyIG9mIGFuIG9iamVjdCdzIG1ldGhvZHMgdG8gdGhhdCBvYmplY3QuIFJlbWFpbmluZyBhcmd1bWVudHNcbiAgLy8gYXJlIHRoZSBtZXRob2QgbmFtZXMgdG8gYmUgYm91bmQuIFVzZWZ1bCBmb3IgZW5zdXJpbmcgdGhhdCBhbGwgY2FsbGJhY2tzXG4gIC8vIGRlZmluZWQgb24gYW4gb2JqZWN0IGJlbG9uZyB0byBpdC5cbiAgXy5iaW5kQWxsID0gcmVzdEFyZ3VtZW50cyhmdW5jdGlvbihvYmosIGtleXMpIHtcbiAgICBrZXlzID0gZmxhdHRlbihrZXlzLCBmYWxzZSwgZmFsc2UpO1xuICAgIHZhciBpbmRleCA9IGtleXMubGVuZ3RoO1xuICAgIGlmIChpbmRleCA8IDEpIHRocm93IG5ldyBFcnJvcignYmluZEFsbCBtdXN0IGJlIHBhc3NlZCBmdW5jdGlvbiBuYW1lcycpO1xuICAgIHdoaWxlIChpbmRleC0tKSB7XG4gICAgICB2YXIga2V5ID0ga2V5c1tpbmRleF07XG4gICAgICBvYmpba2V5XSA9IF8uYmluZChvYmpba2V5XSwgb2JqKTtcbiAgICB9XG4gIH0pO1xuXG4gIC8vIE1lbW9pemUgYW4gZXhwZW5zaXZlIGZ1bmN0aW9uIGJ5IHN0b3JpbmcgaXRzIHJlc3VsdHMuXG4gIF8ubWVtb2l6ZSA9IGZ1bmN0aW9uKGZ1bmMsIGhhc2hlcikge1xuICAgIHZhciBtZW1vaXplID0gZnVuY3Rpb24oa2V5KSB7XG4gICAgICB2YXIgY2FjaGUgPSBtZW1vaXplLmNhY2hlO1xuICAgICAgdmFyIGFkZHJlc3MgPSAnJyArIChoYXNoZXIgPyBoYXNoZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSA6IGtleSk7XG4gICAgICBpZiAoIWhhcyhjYWNoZSwgYWRkcmVzcykpIGNhY2hlW2FkZHJlc3NdID0gZnVuYy5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgcmV0dXJuIGNhY2hlW2FkZHJlc3NdO1xuICAgIH07XG4gICAgbWVtb2l6ZS5jYWNoZSA9IHt9O1xuICAgIHJldHVybiBtZW1vaXplO1xuICB9O1xuXG4gIC8vIERlbGF5cyBhIGZ1bmN0aW9uIGZvciB0aGUgZ2l2ZW4gbnVtYmVyIG9mIG1pbGxpc2Vjb25kcywgYW5kIHRoZW4gY2FsbHNcbiAgLy8gaXQgd2l0aCB0aGUgYXJndW1lbnRzIHN1cHBsaWVkLlxuICBfLmRlbGF5ID0gcmVzdEFyZ3VtZW50cyhmdW5jdGlvbihmdW5jLCB3YWl0LCBhcmdzKSB7XG4gICAgcmV0dXJuIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gZnVuYy5hcHBseShudWxsLCBhcmdzKTtcbiAgICB9LCB3YWl0KTtcbiAgfSk7XG5cbiAgLy8gRGVmZXJzIGEgZnVuY3Rpb24sIHNjaGVkdWxpbmcgaXQgdG8gcnVuIGFmdGVyIHRoZSBjdXJyZW50IGNhbGwgc3RhY2sgaGFzXG4gIC8vIGNsZWFyZWQuXG4gIF8uZGVmZXIgPSBfLnBhcnRpYWwoXy5kZWxheSwgXywgMSk7XG5cbiAgLy8gUmV0dXJucyBhIGZ1bmN0aW9uLCB0aGF0LCB3aGVuIGludm9rZWQsIHdpbGwgb25seSBiZSB0cmlnZ2VyZWQgYXQgbW9zdCBvbmNlXG4gIC8vIGR1cmluZyBhIGdpdmVuIHdpbmRvdyBvZiB0aW1lLiBOb3JtYWxseSwgdGhlIHRocm90dGxlZCBmdW5jdGlvbiB3aWxsIHJ1blxuICAvLyBhcyBtdWNoIGFzIGl0IGNhbiwgd2l0aG91dCBldmVyIGdvaW5nIG1vcmUgdGhhbiBvbmNlIHBlciBgd2FpdGAgZHVyYXRpb247XG4gIC8vIGJ1dCBpZiB5b3UnZCBsaWtlIHRvIGRpc2FibGUgdGhlIGV4ZWN1dGlvbiBvbiB0aGUgbGVhZGluZyBlZGdlLCBwYXNzXG4gIC8vIGB7bGVhZGluZzogZmFsc2V9YC4gVG8gZGlzYWJsZSBleGVjdXRpb24gb24gdGhlIHRyYWlsaW5nIGVkZ2UsIGRpdHRvLlxuICBfLnRocm90dGxlID0gZnVuY3Rpb24oZnVuYywgd2FpdCwgb3B0aW9ucykge1xuICAgIHZhciB0aW1lb3V0LCBjb250ZXh0LCBhcmdzLCByZXN1bHQ7XG4gICAgdmFyIHByZXZpb3VzID0gMDtcbiAgICBpZiAoIW9wdGlvbnMpIG9wdGlvbnMgPSB7fTtcblxuICAgIHZhciBsYXRlciA9IGZ1bmN0aW9uKCkge1xuICAgICAgcHJldmlvdXMgPSBvcHRpb25zLmxlYWRpbmcgPT09IGZhbHNlID8gMCA6IF8ubm93KCk7XG4gICAgICB0aW1lb3V0ID0gbnVsbDtcbiAgICAgIHJlc3VsdCA9IGZ1bmMuYXBwbHkoY29udGV4dCwgYXJncyk7XG4gICAgICBpZiAoIXRpbWVvdXQpIGNvbnRleHQgPSBhcmdzID0gbnVsbDtcbiAgICB9O1xuXG4gICAgdmFyIHRocm90dGxlZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIG5vdyA9IF8ubm93KCk7XG4gICAgICBpZiAoIXByZXZpb3VzICYmIG9wdGlvbnMubGVhZGluZyA9PT0gZmFsc2UpIHByZXZpb3VzID0gbm93O1xuICAgICAgdmFyIHJlbWFpbmluZyA9IHdhaXQgLSAobm93IC0gcHJldmlvdXMpO1xuICAgICAgY29udGV4dCA9IHRoaXM7XG4gICAgICBhcmdzID0gYXJndW1lbnRzO1xuICAgICAgaWYgKHJlbWFpbmluZyA8PSAwIHx8IHJlbWFpbmluZyA+IHdhaXQpIHtcbiAgICAgICAgaWYgKHRpbWVvdXQpIHtcbiAgICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dCk7XG4gICAgICAgICAgdGltZW91dCA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgcHJldmlvdXMgPSBub3c7XG4gICAgICAgIHJlc3VsdCA9IGZ1bmMuYXBwbHkoY29udGV4dCwgYXJncyk7XG4gICAgICAgIGlmICghdGltZW91dCkgY29udGV4dCA9IGFyZ3MgPSBudWxsO1xuICAgICAgfSBlbHNlIGlmICghdGltZW91dCAmJiBvcHRpb25zLnRyYWlsaW5nICE9PSBmYWxzZSkge1xuICAgICAgICB0aW1lb3V0ID0gc2V0VGltZW91dChsYXRlciwgcmVtYWluaW5nKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfTtcblxuICAgIHRocm90dGxlZC5jYW5jZWwgPSBmdW5jdGlvbigpIHtcbiAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0KTtcbiAgICAgIHByZXZpb3VzID0gMDtcbiAgICAgIHRpbWVvdXQgPSBjb250ZXh0ID0gYXJncyA9IG51bGw7XG4gICAgfTtcblxuICAgIHJldHVybiB0aHJvdHRsZWQ7XG4gIH07XG5cbiAgLy8gUmV0dXJucyBhIGZ1bmN0aW9uLCB0aGF0LCBhcyBsb25nIGFzIGl0IGNvbnRpbnVlcyB0byBiZSBpbnZva2VkLCB3aWxsIG5vdFxuICAvLyBiZSB0cmlnZ2VyZWQuIFRoZSBmdW5jdGlvbiB3aWxsIGJlIGNhbGxlZCBhZnRlciBpdCBzdG9wcyBiZWluZyBjYWxsZWQgZm9yXG4gIC8vIE4gbWlsbGlzZWNvbmRzLiBJZiBgaW1tZWRpYXRlYCBpcyBwYXNzZWQsIHRyaWdnZXIgdGhlIGZ1bmN0aW9uIG9uIHRoZVxuICAvLyBsZWFkaW5nIGVkZ2UsIGluc3RlYWQgb2YgdGhlIHRyYWlsaW5nLlxuICBfLmRlYm91bmNlID0gZnVuY3Rpb24oZnVuYywgd2FpdCwgaW1tZWRpYXRlKSB7XG4gICAgdmFyIHRpbWVvdXQsIHJlc3VsdDtcblxuICAgIHZhciBsYXRlciA9IGZ1bmN0aW9uKGNvbnRleHQsIGFyZ3MpIHtcbiAgICAgIHRpbWVvdXQgPSBudWxsO1xuICAgICAgaWYgKGFyZ3MpIHJlc3VsdCA9IGZ1bmMuYXBwbHkoY29udGV4dCwgYXJncyk7XG4gICAgfTtcblxuICAgIHZhciBkZWJvdW5jZWQgPSByZXN0QXJndW1lbnRzKGZ1bmN0aW9uKGFyZ3MpIHtcbiAgICAgIGlmICh0aW1lb3V0KSBjbGVhclRpbWVvdXQodGltZW91dCk7XG4gICAgICBpZiAoaW1tZWRpYXRlKSB7XG4gICAgICAgIHZhciBjYWxsTm93ID0gIXRpbWVvdXQ7XG4gICAgICAgIHRpbWVvdXQgPSBzZXRUaW1lb3V0KGxhdGVyLCB3YWl0KTtcbiAgICAgICAgaWYgKGNhbGxOb3cpIHJlc3VsdCA9IGZ1bmMuYXBwbHkodGhpcywgYXJncyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aW1lb3V0ID0gXy5kZWxheShsYXRlciwgd2FpdCwgdGhpcywgYXJncyk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfSk7XG5cbiAgICBkZWJvdW5jZWQuY2FuY2VsID0gZnVuY3Rpb24oKSB7XG4gICAgICBjbGVhclRpbWVvdXQodGltZW91dCk7XG4gICAgICB0aW1lb3V0ID0gbnVsbDtcbiAgICB9O1xuXG4gICAgcmV0dXJuIGRlYm91bmNlZDtcbiAgfTtcblxuICAvLyBSZXR1cm5zIHRoZSBmaXJzdCBmdW5jdGlvbiBwYXNzZWQgYXMgYW4gYXJndW1lbnQgdG8gdGhlIHNlY29uZCxcbiAgLy8gYWxsb3dpbmcgeW91IHRvIGFkanVzdCBhcmd1bWVudHMsIHJ1biBjb2RlIGJlZm9yZSBhbmQgYWZ0ZXIsIGFuZFxuICAvLyBjb25kaXRpb25hbGx5IGV4ZWN1dGUgdGhlIG9yaWdpbmFsIGZ1bmN0aW9uLlxuICBfLndyYXAgPSBmdW5jdGlvbihmdW5jLCB3cmFwcGVyKSB7XG4gICAgcmV0dXJuIF8ucGFydGlhbCh3cmFwcGVyLCBmdW5jKTtcbiAgfTtcblxuICAvLyBSZXR1cm5zIGEgbmVnYXRlZCB2ZXJzaW9uIG9mIHRoZSBwYXNzZWQtaW4gcHJlZGljYXRlLlxuICBfLm5lZ2F0ZSA9IGZ1bmN0aW9uKHByZWRpY2F0ZSkge1xuICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiAhcHJlZGljYXRlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgfTtcbiAgfTtcblxuICAvLyBSZXR1cm5zIGEgZnVuY3Rpb24gdGhhdCBpcyB0aGUgY29tcG9zaXRpb24gb2YgYSBsaXN0IG9mIGZ1bmN0aW9ucywgZWFjaFxuICAvLyBjb25zdW1pbmcgdGhlIHJldHVybiB2YWx1ZSBvZiB0aGUgZnVuY3Rpb24gdGhhdCBmb2xsb3dzLlxuICBfLmNvbXBvc2UgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgYXJncyA9IGFyZ3VtZW50cztcbiAgICB2YXIgc3RhcnQgPSBhcmdzLmxlbmd0aCAtIDE7XG4gICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGkgPSBzdGFydDtcbiAgICAgIHZhciByZXN1bHQgPSBhcmdzW3N0YXJ0XS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgd2hpbGUgKGktLSkgcmVzdWx0ID0gYXJnc1tpXS5jYWxsKHRoaXMsIHJlc3VsdCk7XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH07XG4gIH07XG5cbiAgLy8gUmV0dXJucyBhIGZ1bmN0aW9uIHRoYXQgd2lsbCBvbmx5IGJlIGV4ZWN1dGVkIG9uIGFuZCBhZnRlciB0aGUgTnRoIGNhbGwuXG4gIF8uYWZ0ZXIgPSBmdW5jdGlvbih0aW1lcywgZnVuYykge1xuICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgIGlmICgtLXRpbWVzIDwgMSkge1xuICAgICAgICByZXR1cm4gZnVuYy5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgfVxuICAgIH07XG4gIH07XG5cbiAgLy8gUmV0dXJucyBhIGZ1bmN0aW9uIHRoYXQgd2lsbCBvbmx5IGJlIGV4ZWN1dGVkIHVwIHRvIChidXQgbm90IGluY2x1ZGluZykgdGhlIE50aCBjYWxsLlxuICBfLmJlZm9yZSA9IGZ1bmN0aW9uKHRpbWVzLCBmdW5jKSB7XG4gICAgdmFyIG1lbW87XG4gICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgaWYgKC0tdGltZXMgPiAwKSB7XG4gICAgICAgIG1lbW8gPSBmdW5jLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICB9XG4gICAgICBpZiAodGltZXMgPD0gMSkgZnVuYyA9IG51bGw7XG4gICAgICByZXR1cm4gbWVtbztcbiAgICB9O1xuICB9O1xuXG4gIC8vIFJldHVybnMgYSBmdW5jdGlvbiB0aGF0IHdpbGwgYmUgZXhlY3V0ZWQgYXQgbW9zdCBvbmUgdGltZSwgbm8gbWF0dGVyIGhvd1xuICAvLyBvZnRlbiB5b3UgY2FsbCBpdC4gVXNlZnVsIGZvciBsYXp5IGluaXRpYWxpemF0aW9uLlxuICBfLm9uY2UgPSBfLnBhcnRpYWwoXy5iZWZvcmUsIDIpO1xuXG4gIF8ucmVzdEFyZ3VtZW50cyA9IHJlc3RBcmd1bWVudHM7XG5cbiAgLy8gT2JqZWN0IEZ1bmN0aW9uc1xuICAvLyAtLS0tLS0tLS0tLS0tLS0tXG5cbiAgLy8gS2V5cyBpbiBJRSA8IDkgdGhhdCB3b24ndCBiZSBpdGVyYXRlZCBieSBgZm9yIGtleSBpbiAuLi5gIGFuZCB0aHVzIG1pc3NlZC5cbiAgdmFyIGhhc0VudW1CdWcgPSAhe3RvU3RyaW5nOiBudWxsfS5wcm9wZXJ0eUlzRW51bWVyYWJsZSgndG9TdHJpbmcnKTtcbiAgdmFyIG5vbkVudW1lcmFibGVQcm9wcyA9IFsndmFsdWVPZicsICdpc1Byb3RvdHlwZU9mJywgJ3RvU3RyaW5nJyxcbiAgICAncHJvcGVydHlJc0VudW1lcmFibGUnLCAnaGFzT3duUHJvcGVydHknLCAndG9Mb2NhbGVTdHJpbmcnXTtcblxuICB2YXIgY29sbGVjdE5vbkVudW1Qcm9wcyA9IGZ1bmN0aW9uKG9iaiwga2V5cykge1xuICAgIHZhciBub25FbnVtSWR4ID0gbm9uRW51bWVyYWJsZVByb3BzLmxlbmd0aDtcbiAgICB2YXIgY29uc3RydWN0b3IgPSBvYmouY29uc3RydWN0b3I7XG4gICAgdmFyIHByb3RvID0gXy5pc0Z1bmN0aW9uKGNvbnN0cnVjdG9yKSAmJiBjb25zdHJ1Y3Rvci5wcm90b3R5cGUgfHwgT2JqUHJvdG87XG5cbiAgICAvLyBDb25zdHJ1Y3RvciBpcyBhIHNwZWNpYWwgY2FzZS5cbiAgICB2YXIgcHJvcCA9ICdjb25zdHJ1Y3Rvcic7XG4gICAgaWYgKGhhcyhvYmosIHByb3ApICYmICFfLmNvbnRhaW5zKGtleXMsIHByb3ApKSBrZXlzLnB1c2gocHJvcCk7XG5cbiAgICB3aGlsZSAobm9uRW51bUlkeC0tKSB7XG4gICAgICBwcm9wID0gbm9uRW51bWVyYWJsZVByb3BzW25vbkVudW1JZHhdO1xuICAgICAgaWYgKHByb3AgaW4gb2JqICYmIG9ialtwcm9wXSAhPT0gcHJvdG9bcHJvcF0gJiYgIV8uY29udGFpbnMoa2V5cywgcHJvcCkpIHtcbiAgICAgICAga2V5cy5wdXNoKHByb3ApO1xuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICAvLyBSZXRyaWV2ZSB0aGUgbmFtZXMgb2YgYW4gb2JqZWN0J3Mgb3duIHByb3BlcnRpZXMuXG4gIC8vIERlbGVnYXRlcyB0byAqKkVDTUFTY3JpcHQgNSoqJ3MgbmF0aXZlIGBPYmplY3Qua2V5c2AuXG4gIF8ua2V5cyA9IGZ1bmN0aW9uKG9iaikge1xuICAgIGlmICghXy5pc09iamVjdChvYmopKSByZXR1cm4gW107XG4gICAgaWYgKG5hdGl2ZUtleXMpIHJldHVybiBuYXRpdmVLZXlzKG9iaik7XG4gICAgdmFyIGtleXMgPSBbXTtcbiAgICBmb3IgKHZhciBrZXkgaW4gb2JqKSBpZiAoaGFzKG9iaiwga2V5KSkga2V5cy5wdXNoKGtleSk7XG4gICAgLy8gQWhlbSwgSUUgPCA5LlxuICAgIGlmIChoYXNFbnVtQnVnKSBjb2xsZWN0Tm9uRW51bVByb3BzKG9iaiwga2V5cyk7XG4gICAgcmV0dXJuIGtleXM7XG4gIH07XG5cbiAgLy8gUmV0cmlldmUgYWxsIHRoZSBwcm9wZXJ0eSBuYW1lcyBvZiBhbiBvYmplY3QuXG4gIF8uYWxsS2V5cyA9IGZ1bmN0aW9uKG9iaikge1xuICAgIGlmICghXy5pc09iamVjdChvYmopKSByZXR1cm4gW107XG4gICAgdmFyIGtleXMgPSBbXTtcbiAgICBmb3IgKHZhciBrZXkgaW4gb2JqKSBrZXlzLnB1c2goa2V5KTtcbiAgICAvLyBBaGVtLCBJRSA8IDkuXG4gICAgaWYgKGhhc0VudW1CdWcpIGNvbGxlY3ROb25FbnVtUHJvcHMob2JqLCBrZXlzKTtcbiAgICByZXR1cm4ga2V5cztcbiAgfTtcblxuICAvLyBSZXRyaWV2ZSB0aGUgdmFsdWVzIG9mIGFuIG9iamVjdCdzIHByb3BlcnRpZXMuXG4gIF8udmFsdWVzID0gZnVuY3Rpb24ob2JqKSB7XG4gICAgdmFyIGtleXMgPSBfLmtleXMob2JqKTtcbiAgICB2YXIgbGVuZ3RoID0ga2V5cy5sZW5ndGg7XG4gICAgdmFyIHZhbHVlcyA9IEFycmF5KGxlbmd0aCk7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgdmFsdWVzW2ldID0gb2JqW2tleXNbaV1dO1xuICAgIH1cbiAgICByZXR1cm4gdmFsdWVzO1xuICB9O1xuXG4gIC8vIFJldHVybnMgdGhlIHJlc3VsdHMgb2YgYXBwbHlpbmcgdGhlIGl0ZXJhdGVlIHRvIGVhY2ggZWxlbWVudCBvZiB0aGUgb2JqZWN0LlxuICAvLyBJbiBjb250cmFzdCB0byBfLm1hcCBpdCByZXR1cm5zIGFuIG9iamVjdC5cbiAgXy5tYXBPYmplY3QgPSBmdW5jdGlvbihvYmosIGl0ZXJhdGVlLCBjb250ZXh0KSB7XG4gICAgaXRlcmF0ZWUgPSBjYihpdGVyYXRlZSwgY29udGV4dCk7XG4gICAgdmFyIGtleXMgPSBfLmtleXMob2JqKSxcbiAgICAgICAgbGVuZ3RoID0ga2V5cy5sZW5ndGgsXG4gICAgICAgIHJlc3VsdHMgPSB7fTtcbiAgICBmb3IgKHZhciBpbmRleCA9IDA7IGluZGV4IDwgbGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICB2YXIgY3VycmVudEtleSA9IGtleXNbaW5kZXhdO1xuICAgICAgcmVzdWx0c1tjdXJyZW50S2V5XSA9IGl0ZXJhdGVlKG9ialtjdXJyZW50S2V5XSwgY3VycmVudEtleSwgb2JqKTtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdHM7XG4gIH07XG5cbiAgLy8gQ29udmVydCBhbiBvYmplY3QgaW50byBhIGxpc3Qgb2YgYFtrZXksIHZhbHVlXWAgcGFpcnMuXG4gIC8vIFRoZSBvcHBvc2l0ZSBvZiBfLm9iamVjdC5cbiAgXy5wYWlycyA9IGZ1bmN0aW9uKG9iaikge1xuICAgIHZhciBrZXlzID0gXy5rZXlzKG9iaik7XG4gICAgdmFyIGxlbmd0aCA9IGtleXMubGVuZ3RoO1xuICAgIHZhciBwYWlycyA9IEFycmF5KGxlbmd0aCk7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgcGFpcnNbaV0gPSBba2V5c1tpXSwgb2JqW2tleXNbaV1dXTtcbiAgICB9XG4gICAgcmV0dXJuIHBhaXJzO1xuICB9O1xuXG4gIC8vIEludmVydCB0aGUga2V5cyBhbmQgdmFsdWVzIG9mIGFuIG9iamVjdC4gVGhlIHZhbHVlcyBtdXN0IGJlIHNlcmlhbGl6YWJsZS5cbiAgXy5pbnZlcnQgPSBmdW5jdGlvbihvYmopIHtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgdmFyIGtleXMgPSBfLmtleXMob2JqKTtcbiAgICBmb3IgKHZhciBpID0gMCwgbGVuZ3RoID0ga2V5cy5sZW5ndGg7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgcmVzdWx0W29ialtrZXlzW2ldXV0gPSBrZXlzW2ldO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9O1xuXG4gIC8vIFJldHVybiBhIHNvcnRlZCBsaXN0IG9mIHRoZSBmdW5jdGlvbiBuYW1lcyBhdmFpbGFibGUgb24gdGhlIG9iamVjdC5cbiAgLy8gQWxpYXNlZCBhcyBgbWV0aG9kc2AuXG4gIF8uZnVuY3Rpb25zID0gXy5tZXRob2RzID0gZnVuY3Rpb24ob2JqKSB7XG4gICAgdmFyIG5hbWVzID0gW107XG4gICAgZm9yICh2YXIga2V5IGluIG9iaikge1xuICAgICAgaWYgKF8uaXNGdW5jdGlvbihvYmpba2V5XSkpIG5hbWVzLnB1c2goa2V5KTtcbiAgICB9XG4gICAgcmV0dXJuIG5hbWVzLnNvcnQoKTtcbiAgfTtcblxuICAvLyBBbiBpbnRlcm5hbCBmdW5jdGlvbiBmb3IgY3JlYXRpbmcgYXNzaWduZXIgZnVuY3Rpb25zLlxuICB2YXIgY3JlYXRlQXNzaWduZXIgPSBmdW5jdGlvbihrZXlzRnVuYywgZGVmYXVsdHMpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24ob2JqKSB7XG4gICAgICB2YXIgbGVuZ3RoID0gYXJndW1lbnRzLmxlbmd0aDtcbiAgICAgIGlmIChkZWZhdWx0cykgb2JqID0gT2JqZWN0KG9iaik7XG4gICAgICBpZiAobGVuZ3RoIDwgMiB8fCBvYmogPT0gbnVsbCkgcmV0dXJuIG9iajtcbiAgICAgIGZvciAodmFyIGluZGV4ID0gMTsgaW5kZXggPCBsZW5ndGg7IGluZGV4KyspIHtcbiAgICAgICAgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpbmRleF0sXG4gICAgICAgICAgICBrZXlzID0ga2V5c0Z1bmMoc291cmNlKSxcbiAgICAgICAgICAgIGwgPSBrZXlzLmxlbmd0aDtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsOyBpKyspIHtcbiAgICAgICAgICB2YXIga2V5ID0ga2V5c1tpXTtcbiAgICAgICAgICBpZiAoIWRlZmF1bHRzIHx8IG9ialtrZXldID09PSB2b2lkIDApIG9ialtrZXldID0gc291cmNlW2tleV07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBvYmo7XG4gICAgfTtcbiAgfTtcblxuICAvLyBFeHRlbmQgYSBnaXZlbiBvYmplY3Qgd2l0aCBhbGwgdGhlIHByb3BlcnRpZXMgaW4gcGFzc2VkLWluIG9iamVjdChzKS5cbiAgXy5leHRlbmQgPSBjcmVhdGVBc3NpZ25lcihfLmFsbEtleXMpO1xuXG4gIC8vIEFzc2lnbnMgYSBnaXZlbiBvYmplY3Qgd2l0aCBhbGwgdGhlIG93biBwcm9wZXJ0aWVzIGluIHRoZSBwYXNzZWQtaW4gb2JqZWN0KHMpLlxuICAvLyAoaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvR2xvYmFsX09iamVjdHMvT2JqZWN0L2Fzc2lnbilcbiAgXy5leHRlbmRPd24gPSBfLmFzc2lnbiA9IGNyZWF0ZUFzc2lnbmVyKF8ua2V5cyk7XG5cbiAgLy8gUmV0dXJucyB0aGUgZmlyc3Qga2V5IG9uIGFuIG9iamVjdCB0aGF0IHBhc3NlcyBhIHByZWRpY2F0ZSB0ZXN0LlxuICBfLmZpbmRLZXkgPSBmdW5jdGlvbihvYmosIHByZWRpY2F0ZSwgY29udGV4dCkge1xuICAgIHByZWRpY2F0ZSA9IGNiKHByZWRpY2F0ZSwgY29udGV4dCk7XG4gICAgdmFyIGtleXMgPSBfLmtleXMob2JqKSwga2V5O1xuICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGggPSBrZXlzLmxlbmd0aDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgICBrZXkgPSBrZXlzW2ldO1xuICAgICAgaWYgKHByZWRpY2F0ZShvYmpba2V5XSwga2V5LCBvYmopKSByZXR1cm4ga2V5O1xuICAgIH1cbiAgfTtcblxuICAvLyBJbnRlcm5hbCBwaWNrIGhlbHBlciBmdW5jdGlvbiB0byBkZXRlcm1pbmUgaWYgYG9iamAgaGFzIGtleSBga2V5YC5cbiAgdmFyIGtleUluT2JqID0gZnVuY3Rpb24odmFsdWUsIGtleSwgb2JqKSB7XG4gICAgcmV0dXJuIGtleSBpbiBvYmo7XG4gIH07XG5cbiAgLy8gUmV0dXJuIGEgY29weSBvZiB0aGUgb2JqZWN0IG9ubHkgY29udGFpbmluZyB0aGUgd2hpdGVsaXN0ZWQgcHJvcGVydGllcy5cbiAgXy5waWNrID0gcmVzdEFyZ3VtZW50cyhmdW5jdGlvbihvYmosIGtleXMpIHtcbiAgICB2YXIgcmVzdWx0ID0ge30sIGl0ZXJhdGVlID0ga2V5c1swXTtcbiAgICBpZiAob2JqID09IG51bGwpIHJldHVybiByZXN1bHQ7XG4gICAgaWYgKF8uaXNGdW5jdGlvbihpdGVyYXRlZSkpIHtcbiAgICAgIGlmIChrZXlzLmxlbmd0aCA+IDEpIGl0ZXJhdGVlID0gb3B0aW1pemVDYihpdGVyYXRlZSwga2V5c1sxXSk7XG4gICAgICBrZXlzID0gXy5hbGxLZXlzKG9iaik7XG4gICAgfSBlbHNlIHtcbiAgICAgIGl0ZXJhdGVlID0ga2V5SW5PYmo7XG4gICAgICBrZXlzID0gZmxhdHRlbihrZXlzLCBmYWxzZSwgZmFsc2UpO1xuICAgICAgb2JqID0gT2JqZWN0KG9iaik7XG4gICAgfVxuICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGggPSBrZXlzLmxlbmd0aDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgICB2YXIga2V5ID0ga2V5c1tpXTtcbiAgICAgIHZhciB2YWx1ZSA9IG9ialtrZXldO1xuICAgICAgaWYgKGl0ZXJhdGVlKHZhbHVlLCBrZXksIG9iaikpIHJlc3VsdFtrZXldID0gdmFsdWU7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG4gIH0pO1xuXG4gIC8vIFJldHVybiBhIGNvcHkgb2YgdGhlIG9iamVjdCB3aXRob3V0IHRoZSBibGFja2xpc3RlZCBwcm9wZXJ0aWVzLlxuICBfLm9taXQgPSByZXN0QXJndW1lbnRzKGZ1bmN0aW9uKG9iaiwga2V5cykge1xuICAgIHZhciBpdGVyYXRlZSA9IGtleXNbMF0sIGNvbnRleHQ7XG4gICAgaWYgKF8uaXNGdW5jdGlvbihpdGVyYXRlZSkpIHtcbiAgICAgIGl0ZXJhdGVlID0gXy5uZWdhdGUoaXRlcmF0ZWUpO1xuICAgICAgaWYgKGtleXMubGVuZ3RoID4gMSkgY29udGV4dCA9IGtleXNbMV07XG4gICAgfSBlbHNlIHtcbiAgICAgIGtleXMgPSBfLm1hcChmbGF0dGVuKGtleXMsIGZhbHNlLCBmYWxzZSksIFN0cmluZyk7XG4gICAgICBpdGVyYXRlZSA9IGZ1bmN0aW9uKHZhbHVlLCBrZXkpIHtcbiAgICAgICAgcmV0dXJuICFfLmNvbnRhaW5zKGtleXMsIGtleSk7XG4gICAgICB9O1xuICAgIH1cbiAgICByZXR1cm4gXy5waWNrKG9iaiwgaXRlcmF0ZWUsIGNvbnRleHQpO1xuICB9KTtcblxuICAvLyBGaWxsIGluIGEgZ2l2ZW4gb2JqZWN0IHdpdGggZGVmYXVsdCBwcm9wZXJ0aWVzLlxuICBfLmRlZmF1bHRzID0gY3JlYXRlQXNzaWduZXIoXy5hbGxLZXlzLCB0cnVlKTtcblxuICAvLyBDcmVhdGVzIGFuIG9iamVjdCB0aGF0IGluaGVyaXRzIGZyb20gdGhlIGdpdmVuIHByb3RvdHlwZSBvYmplY3QuXG4gIC8vIElmIGFkZGl0aW9uYWwgcHJvcGVydGllcyBhcmUgcHJvdmlkZWQgdGhlbiB0aGV5IHdpbGwgYmUgYWRkZWQgdG8gdGhlXG4gIC8vIGNyZWF0ZWQgb2JqZWN0LlxuICBfLmNyZWF0ZSA9IGZ1bmN0aW9uKHByb3RvdHlwZSwgcHJvcHMpIHtcbiAgICB2YXIgcmVzdWx0ID0gYmFzZUNyZWF0ZShwcm90b3R5cGUpO1xuICAgIGlmIChwcm9wcykgXy5leHRlbmRPd24ocmVzdWx0LCBwcm9wcyk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfTtcblxuICAvLyBDcmVhdGUgYSAoc2hhbGxvdy1jbG9uZWQpIGR1cGxpY2F0ZSBvZiBhbiBvYmplY3QuXG4gIF8uY2xvbmUgPSBmdW5jdGlvbihvYmopIHtcbiAgICBpZiAoIV8uaXNPYmplY3Qob2JqKSkgcmV0dXJuIG9iajtcbiAgICByZXR1cm4gXy5pc0FycmF5KG9iaikgPyBvYmouc2xpY2UoKSA6IF8uZXh0ZW5kKHt9LCBvYmopO1xuICB9O1xuXG4gIC8vIEludm9rZXMgaW50ZXJjZXB0b3Igd2l0aCB0aGUgb2JqLCBhbmQgdGhlbiByZXR1cm5zIG9iai5cbiAgLy8gVGhlIHByaW1hcnkgcHVycG9zZSBvZiB0aGlzIG1ldGhvZCBpcyB0byBcInRhcCBpbnRvXCIgYSBtZXRob2QgY2hhaW4sIGluXG4gIC8vIG9yZGVyIHRvIHBlcmZvcm0gb3BlcmF0aW9ucyBvbiBpbnRlcm1lZGlhdGUgcmVzdWx0cyB3aXRoaW4gdGhlIGNoYWluLlxuICBfLnRhcCA9IGZ1bmN0aW9uKG9iaiwgaW50ZXJjZXB0b3IpIHtcbiAgICBpbnRlcmNlcHRvcihvYmopO1xuICAgIHJldHVybiBvYmo7XG4gIH07XG5cbiAgLy8gUmV0dXJucyB3aGV0aGVyIGFuIG9iamVjdCBoYXMgYSBnaXZlbiBzZXQgb2YgYGtleTp2YWx1ZWAgcGFpcnMuXG4gIF8uaXNNYXRjaCA9IGZ1bmN0aW9uKG9iamVjdCwgYXR0cnMpIHtcbiAgICB2YXIga2V5cyA9IF8ua2V5cyhhdHRycyksIGxlbmd0aCA9IGtleXMubGVuZ3RoO1xuICAgIGlmIChvYmplY3QgPT0gbnVsbCkgcmV0dXJuICFsZW5ndGg7XG4gICAgdmFyIG9iaiA9IE9iamVjdChvYmplY3QpO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgIHZhciBrZXkgPSBrZXlzW2ldO1xuICAgICAgaWYgKGF0dHJzW2tleV0gIT09IG9ialtrZXldIHx8ICEoa2V5IGluIG9iaikpIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgcmV0dXJuIHRydWU7XG4gIH07XG5cblxuICAvLyBJbnRlcm5hbCByZWN1cnNpdmUgY29tcGFyaXNvbiBmdW5jdGlvbiBmb3IgYGlzRXF1YWxgLlxuICB2YXIgZXEsIGRlZXBFcTtcbiAgZXEgPSBmdW5jdGlvbihhLCBiLCBhU3RhY2ssIGJTdGFjaykge1xuICAgIC8vIElkZW50aWNhbCBvYmplY3RzIGFyZSBlcXVhbC4gYDAgPT09IC0wYCwgYnV0IHRoZXkgYXJlbid0IGlkZW50aWNhbC5cbiAgICAvLyBTZWUgdGhlIFtIYXJtb255IGBlZ2FsYCBwcm9wb3NhbF0oaHR0cDovL3dpa2kuZWNtYXNjcmlwdC5vcmcvZG9rdS5waHA/aWQ9aGFybW9ueTplZ2FsKS5cbiAgICBpZiAoYSA9PT0gYikgcmV0dXJuIGEgIT09IDAgfHwgMSAvIGEgPT09IDEgLyBiO1xuICAgIC8vIGBudWxsYCBvciBgdW5kZWZpbmVkYCBvbmx5IGVxdWFsIHRvIGl0c2VsZiAoc3RyaWN0IGNvbXBhcmlzb24pLlxuICAgIGlmIChhID09IG51bGwgfHwgYiA9PSBudWxsKSByZXR1cm4gZmFsc2U7XG4gICAgLy8gYE5hTmBzIGFyZSBlcXVpdmFsZW50LCBidXQgbm9uLXJlZmxleGl2ZS5cbiAgICBpZiAoYSAhPT0gYSkgcmV0dXJuIGIgIT09IGI7XG4gICAgLy8gRXhoYXVzdCBwcmltaXRpdmUgY2hlY2tzXG4gICAgdmFyIHR5cGUgPSB0eXBlb2YgYTtcbiAgICBpZiAodHlwZSAhPT0gJ2Z1bmN0aW9uJyAmJiB0eXBlICE9PSAnb2JqZWN0JyAmJiB0eXBlb2YgYiAhPSAnb2JqZWN0JykgcmV0dXJuIGZhbHNlO1xuICAgIHJldHVybiBkZWVwRXEoYSwgYiwgYVN0YWNrLCBiU3RhY2spO1xuICB9O1xuXG4gIC8vIEludGVybmFsIHJlY3Vyc2l2ZSBjb21wYXJpc29uIGZ1bmN0aW9uIGZvciBgaXNFcXVhbGAuXG4gIGRlZXBFcSA9IGZ1bmN0aW9uKGEsIGIsIGFTdGFjaywgYlN0YWNrKSB7XG4gICAgLy8gVW53cmFwIGFueSB3cmFwcGVkIG9iamVjdHMuXG4gICAgaWYgKGEgaW5zdGFuY2VvZiBfKSBhID0gYS5fd3JhcHBlZDtcbiAgICBpZiAoYiBpbnN0YW5jZW9mIF8pIGIgPSBiLl93cmFwcGVkO1xuICAgIC8vIENvbXBhcmUgYFtbQ2xhc3NdXWAgbmFtZXMuXG4gICAgdmFyIGNsYXNzTmFtZSA9IHRvU3RyaW5nLmNhbGwoYSk7XG4gICAgaWYgKGNsYXNzTmFtZSAhPT0gdG9TdHJpbmcuY2FsbChiKSkgcmV0dXJuIGZhbHNlO1xuICAgIHN3aXRjaCAoY2xhc3NOYW1lKSB7XG4gICAgICAvLyBTdHJpbmdzLCBudW1iZXJzLCByZWd1bGFyIGV4cHJlc3Npb25zLCBkYXRlcywgYW5kIGJvb2xlYW5zIGFyZSBjb21wYXJlZCBieSB2YWx1ZS5cbiAgICAgIGNhc2UgJ1tvYmplY3QgUmVnRXhwXSc6XG4gICAgICAvLyBSZWdFeHBzIGFyZSBjb2VyY2VkIHRvIHN0cmluZ3MgZm9yIGNvbXBhcmlzb24gKE5vdGU6ICcnICsgL2EvaSA9PT0gJy9hL2knKVxuICAgICAgY2FzZSAnW29iamVjdCBTdHJpbmddJzpcbiAgICAgICAgLy8gUHJpbWl0aXZlcyBhbmQgdGhlaXIgY29ycmVzcG9uZGluZyBvYmplY3Qgd3JhcHBlcnMgYXJlIGVxdWl2YWxlbnQ7IHRodXMsIGBcIjVcImAgaXNcbiAgICAgICAgLy8gZXF1aXZhbGVudCB0byBgbmV3IFN0cmluZyhcIjVcIilgLlxuICAgICAgICByZXR1cm4gJycgKyBhID09PSAnJyArIGI7XG4gICAgICBjYXNlICdbb2JqZWN0IE51bWJlcl0nOlxuICAgICAgICAvLyBgTmFOYHMgYXJlIGVxdWl2YWxlbnQsIGJ1dCBub24tcmVmbGV4aXZlLlxuICAgICAgICAvLyBPYmplY3QoTmFOKSBpcyBlcXVpdmFsZW50IHRvIE5hTi5cbiAgICAgICAgaWYgKCthICE9PSArYSkgcmV0dXJuICtiICE9PSArYjtcbiAgICAgICAgLy8gQW4gYGVnYWxgIGNvbXBhcmlzb24gaXMgcGVyZm9ybWVkIGZvciBvdGhlciBudW1lcmljIHZhbHVlcy5cbiAgICAgICAgcmV0dXJuICthID09PSAwID8gMSAvICthID09PSAxIC8gYiA6ICthID09PSArYjtcbiAgICAgIGNhc2UgJ1tvYmplY3QgRGF0ZV0nOlxuICAgICAgY2FzZSAnW29iamVjdCBCb29sZWFuXSc6XG4gICAgICAgIC8vIENvZXJjZSBkYXRlcyBhbmQgYm9vbGVhbnMgdG8gbnVtZXJpYyBwcmltaXRpdmUgdmFsdWVzLiBEYXRlcyBhcmUgY29tcGFyZWQgYnkgdGhlaXJcbiAgICAgICAgLy8gbWlsbGlzZWNvbmQgcmVwcmVzZW50YXRpb25zLiBOb3RlIHRoYXQgaW52YWxpZCBkYXRlcyB3aXRoIG1pbGxpc2Vjb25kIHJlcHJlc2VudGF0aW9uc1xuICAgICAgICAvLyBvZiBgTmFOYCBhcmUgbm90IGVxdWl2YWxlbnQuXG4gICAgICAgIHJldHVybiArYSA9PT0gK2I7XG4gICAgICBjYXNlICdbb2JqZWN0IFN5bWJvbF0nOlxuICAgICAgICByZXR1cm4gU3ltYm9sUHJvdG8udmFsdWVPZi5jYWxsKGEpID09PSBTeW1ib2xQcm90by52YWx1ZU9mLmNhbGwoYik7XG4gICAgfVxuXG4gICAgdmFyIGFyZUFycmF5cyA9IGNsYXNzTmFtZSA9PT0gJ1tvYmplY3QgQXJyYXldJztcbiAgICBpZiAoIWFyZUFycmF5cykge1xuICAgICAgaWYgKHR5cGVvZiBhICE9ICdvYmplY3QnIHx8IHR5cGVvZiBiICE9ICdvYmplY3QnKSByZXR1cm4gZmFsc2U7XG5cbiAgICAgIC8vIE9iamVjdHMgd2l0aCBkaWZmZXJlbnQgY29uc3RydWN0b3JzIGFyZSBub3QgZXF1aXZhbGVudCwgYnV0IGBPYmplY3RgcyBvciBgQXJyYXlgc1xuICAgICAgLy8gZnJvbSBkaWZmZXJlbnQgZnJhbWVzIGFyZS5cbiAgICAgIHZhciBhQ3RvciA9IGEuY29uc3RydWN0b3IsIGJDdG9yID0gYi5jb25zdHJ1Y3RvcjtcbiAgICAgIGlmIChhQ3RvciAhPT0gYkN0b3IgJiYgIShfLmlzRnVuY3Rpb24oYUN0b3IpICYmIGFDdG9yIGluc3RhbmNlb2YgYUN0b3IgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfLmlzRnVuY3Rpb24oYkN0b3IpICYmIGJDdG9yIGluc3RhbmNlb2YgYkN0b3IpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICYmICgnY29uc3RydWN0b3InIGluIGEgJiYgJ2NvbnN0cnVjdG9yJyBpbiBiKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuICAgIC8vIEFzc3VtZSBlcXVhbGl0eSBmb3IgY3ljbGljIHN0cnVjdHVyZXMuIFRoZSBhbGdvcml0aG0gZm9yIGRldGVjdGluZyBjeWNsaWNcbiAgICAvLyBzdHJ1Y3R1cmVzIGlzIGFkYXB0ZWQgZnJvbSBFUyA1LjEgc2VjdGlvbiAxNS4xMi4zLCBhYnN0cmFjdCBvcGVyYXRpb24gYEpPYC5cblxuICAgIC8vIEluaXRpYWxpemluZyBzdGFjayBvZiB0cmF2ZXJzZWQgb2JqZWN0cy5cbiAgICAvLyBJdCdzIGRvbmUgaGVyZSBzaW5jZSB3ZSBvbmx5IG5lZWQgdGhlbSBmb3Igb2JqZWN0cyBhbmQgYXJyYXlzIGNvbXBhcmlzb24uXG4gICAgYVN0YWNrID0gYVN0YWNrIHx8IFtdO1xuICAgIGJTdGFjayA9IGJTdGFjayB8fCBbXTtcbiAgICB2YXIgbGVuZ3RoID0gYVN0YWNrLmxlbmd0aDtcbiAgICB3aGlsZSAobGVuZ3RoLS0pIHtcbiAgICAgIC8vIExpbmVhciBzZWFyY2guIFBlcmZvcm1hbmNlIGlzIGludmVyc2VseSBwcm9wb3J0aW9uYWwgdG8gdGhlIG51bWJlciBvZlxuICAgICAgLy8gdW5pcXVlIG5lc3RlZCBzdHJ1Y3R1cmVzLlxuICAgICAgaWYgKGFTdGFja1tsZW5ndGhdID09PSBhKSByZXR1cm4gYlN0YWNrW2xlbmd0aF0gPT09IGI7XG4gICAgfVxuXG4gICAgLy8gQWRkIHRoZSBmaXJzdCBvYmplY3QgdG8gdGhlIHN0YWNrIG9mIHRyYXZlcnNlZCBvYmplY3RzLlxuICAgIGFTdGFjay5wdXNoKGEpO1xuICAgIGJTdGFjay5wdXNoKGIpO1xuXG4gICAgLy8gUmVjdXJzaXZlbHkgY29tcGFyZSBvYmplY3RzIGFuZCBhcnJheXMuXG4gICAgaWYgKGFyZUFycmF5cykge1xuICAgICAgLy8gQ29tcGFyZSBhcnJheSBsZW5ndGhzIHRvIGRldGVybWluZSBpZiBhIGRlZXAgY29tcGFyaXNvbiBpcyBuZWNlc3NhcnkuXG4gICAgICBsZW5ndGggPSBhLmxlbmd0aDtcbiAgICAgIGlmIChsZW5ndGggIT09IGIubGVuZ3RoKSByZXR1cm4gZmFsc2U7XG4gICAgICAvLyBEZWVwIGNvbXBhcmUgdGhlIGNvbnRlbnRzLCBpZ25vcmluZyBub24tbnVtZXJpYyBwcm9wZXJ0aWVzLlxuICAgICAgd2hpbGUgKGxlbmd0aC0tKSB7XG4gICAgICAgIGlmICghZXEoYVtsZW5ndGhdLCBiW2xlbmd0aF0sIGFTdGFjaywgYlN0YWNrKSkgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAvLyBEZWVwIGNvbXBhcmUgb2JqZWN0cy5cbiAgICAgIHZhciBrZXlzID0gXy5rZXlzKGEpLCBrZXk7XG4gICAgICBsZW5ndGggPSBrZXlzLmxlbmd0aDtcbiAgICAgIC8vIEVuc3VyZSB0aGF0IGJvdGggb2JqZWN0cyBjb250YWluIHRoZSBzYW1lIG51bWJlciBvZiBwcm9wZXJ0aWVzIGJlZm9yZSBjb21wYXJpbmcgZGVlcCBlcXVhbGl0eS5cbiAgICAgIGlmIChfLmtleXMoYikubGVuZ3RoICE9PSBsZW5ndGgpIHJldHVybiBmYWxzZTtcbiAgICAgIHdoaWxlIChsZW5ndGgtLSkge1xuICAgICAgICAvLyBEZWVwIGNvbXBhcmUgZWFjaCBtZW1iZXJcbiAgICAgICAga2V5ID0ga2V5c1tsZW5ndGhdO1xuICAgICAgICBpZiAoIShoYXMoYiwga2V5KSAmJiBlcShhW2tleV0sIGJba2V5XSwgYVN0YWNrLCBiU3RhY2spKSkgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH1cbiAgICAvLyBSZW1vdmUgdGhlIGZpcnN0IG9iamVjdCBmcm9tIHRoZSBzdGFjayBvZiB0cmF2ZXJzZWQgb2JqZWN0cy5cbiAgICBhU3RhY2sucG9wKCk7XG4gICAgYlN0YWNrLnBvcCgpO1xuICAgIHJldHVybiB0cnVlO1xuICB9O1xuXG4gIC8vIFBlcmZvcm0gYSBkZWVwIGNvbXBhcmlzb24gdG8gY2hlY2sgaWYgdHdvIG9iamVjdHMgYXJlIGVxdWFsLlxuICBfLmlzRXF1YWwgPSBmdW5jdGlvbihhLCBiKSB7XG4gICAgcmV0dXJuIGVxKGEsIGIpO1xuICB9O1xuXG4gIC8vIElzIGEgZ2l2ZW4gYXJyYXksIHN0cmluZywgb3Igb2JqZWN0IGVtcHR5P1xuICAvLyBBbiBcImVtcHR5XCIgb2JqZWN0IGhhcyBubyBlbnVtZXJhYmxlIG93bi1wcm9wZXJ0aWVzLlxuICBfLmlzRW1wdHkgPSBmdW5jdGlvbihvYmopIHtcbiAgICBpZiAob2JqID09IG51bGwpIHJldHVybiB0cnVlO1xuICAgIGlmIChpc0FycmF5TGlrZShvYmopICYmIChfLmlzQXJyYXkob2JqKSB8fCBfLmlzU3RyaW5nKG9iaikgfHwgXy5pc0FyZ3VtZW50cyhvYmopKSkgcmV0dXJuIG9iai5sZW5ndGggPT09IDA7XG4gICAgcmV0dXJuIF8ua2V5cyhvYmopLmxlbmd0aCA9PT0gMDtcbiAgfTtcblxuICAvLyBJcyBhIGdpdmVuIHZhbHVlIGEgRE9NIGVsZW1lbnQ/XG4gIF8uaXNFbGVtZW50ID0gZnVuY3Rpb24ob2JqKSB7XG4gICAgcmV0dXJuICEhKG9iaiAmJiBvYmoubm9kZVR5cGUgPT09IDEpO1xuICB9O1xuXG4gIC8vIElzIGEgZ2l2ZW4gdmFsdWUgYW4gYXJyYXk/XG4gIC8vIERlbGVnYXRlcyB0byBFQ01BNSdzIG5hdGl2ZSBBcnJheS5pc0FycmF5XG4gIF8uaXNBcnJheSA9IG5hdGl2ZUlzQXJyYXkgfHwgZnVuY3Rpb24ob2JqKSB7XG4gICAgcmV0dXJuIHRvU3RyaW5nLmNhbGwob2JqKSA9PT0gJ1tvYmplY3QgQXJyYXldJztcbiAgfTtcblxuICAvLyBJcyBhIGdpdmVuIHZhcmlhYmxlIGFuIG9iamVjdD9cbiAgXy5pc09iamVjdCA9IGZ1bmN0aW9uKG9iaikge1xuICAgIHZhciB0eXBlID0gdHlwZW9mIG9iajtcbiAgICByZXR1cm4gdHlwZSA9PT0gJ2Z1bmN0aW9uJyB8fCB0eXBlID09PSAnb2JqZWN0JyAmJiAhIW9iajtcbiAgfTtcblxuICAvLyBBZGQgc29tZSBpc1R5cGUgbWV0aG9kczogaXNBcmd1bWVudHMsIGlzRnVuY3Rpb24sIGlzU3RyaW5nLCBpc051bWJlciwgaXNEYXRlLCBpc1JlZ0V4cCwgaXNFcnJvciwgaXNNYXAsIGlzV2Vha01hcCwgaXNTZXQsIGlzV2Vha1NldC5cbiAgXy5lYWNoKFsnQXJndW1lbnRzJywgJ0Z1bmN0aW9uJywgJ1N0cmluZycsICdOdW1iZXInLCAnRGF0ZScsICdSZWdFeHAnLCAnRXJyb3InLCAnU3ltYm9sJywgJ01hcCcsICdXZWFrTWFwJywgJ1NldCcsICdXZWFrU2V0J10sIGZ1bmN0aW9uKG5hbWUpIHtcbiAgICBfWydpcycgKyBuYW1lXSA9IGZ1bmN0aW9uKG9iaikge1xuICAgICAgcmV0dXJuIHRvU3RyaW5nLmNhbGwob2JqKSA9PT0gJ1tvYmplY3QgJyArIG5hbWUgKyAnXSc7XG4gICAgfTtcbiAgfSk7XG5cbiAgLy8gRGVmaW5lIGEgZmFsbGJhY2sgdmVyc2lvbiBvZiB0aGUgbWV0aG9kIGluIGJyb3dzZXJzIChhaGVtLCBJRSA8IDkpLCB3aGVyZVxuICAvLyB0aGVyZSBpc24ndCBhbnkgaW5zcGVjdGFibGUgXCJBcmd1bWVudHNcIiB0eXBlLlxuICBpZiAoIV8uaXNBcmd1bWVudHMoYXJndW1lbnRzKSkge1xuICAgIF8uaXNBcmd1bWVudHMgPSBmdW5jdGlvbihvYmopIHtcbiAgICAgIHJldHVybiBoYXMob2JqLCAnY2FsbGVlJyk7XG4gICAgfTtcbiAgfVxuXG4gIC8vIE9wdGltaXplIGBpc0Z1bmN0aW9uYCBpZiBhcHByb3ByaWF0ZS4gV29yayBhcm91bmQgc29tZSB0eXBlb2YgYnVncyBpbiBvbGQgdjgsXG4gIC8vIElFIDExICgjMTYyMSksIFNhZmFyaSA4ICgjMTkyOSksIGFuZCBQaGFudG9tSlMgKCMyMjM2KS5cbiAgdmFyIG5vZGVsaXN0ID0gcm9vdC5kb2N1bWVudCAmJiByb290LmRvY3VtZW50LmNoaWxkTm9kZXM7XG4gIGlmICh0eXBlb2YgLy4vICE9ICdmdW5jdGlvbicgJiYgdHlwZW9mIEludDhBcnJheSAhPSAnb2JqZWN0JyAmJiB0eXBlb2Ygbm9kZWxpc3QgIT0gJ2Z1bmN0aW9uJykge1xuICAgIF8uaXNGdW5jdGlvbiA9IGZ1bmN0aW9uKG9iaikge1xuICAgICAgcmV0dXJuIHR5cGVvZiBvYmogPT0gJ2Z1bmN0aW9uJyB8fCBmYWxzZTtcbiAgICB9O1xuICB9XG5cbiAgLy8gSXMgYSBnaXZlbiBvYmplY3QgYSBmaW5pdGUgbnVtYmVyP1xuICBfLmlzRmluaXRlID0gZnVuY3Rpb24ob2JqKSB7XG4gICAgcmV0dXJuICFfLmlzU3ltYm9sKG9iaikgJiYgaXNGaW5pdGUob2JqKSAmJiAhaXNOYU4ocGFyc2VGbG9hdChvYmopKTtcbiAgfTtcblxuICAvLyBJcyB0aGUgZ2l2ZW4gdmFsdWUgYE5hTmA/XG4gIF8uaXNOYU4gPSBmdW5jdGlvbihvYmopIHtcbiAgICByZXR1cm4gXy5pc051bWJlcihvYmopICYmIGlzTmFOKG9iaik7XG4gIH07XG5cbiAgLy8gSXMgYSBnaXZlbiB2YWx1ZSBhIGJvb2xlYW4/XG4gIF8uaXNCb29sZWFuID0gZnVuY3Rpb24ob2JqKSB7XG4gICAgcmV0dXJuIG9iaiA9PT0gdHJ1ZSB8fCBvYmogPT09IGZhbHNlIHx8IHRvU3RyaW5nLmNhbGwob2JqKSA9PT0gJ1tvYmplY3QgQm9vbGVhbl0nO1xuICB9O1xuXG4gIC8vIElzIGEgZ2l2ZW4gdmFsdWUgZXF1YWwgdG8gbnVsbD9cbiAgXy5pc051bGwgPSBmdW5jdGlvbihvYmopIHtcbiAgICByZXR1cm4gb2JqID09PSBudWxsO1xuICB9O1xuXG4gIC8vIElzIGEgZ2l2ZW4gdmFyaWFibGUgdW5kZWZpbmVkP1xuICBfLmlzVW5kZWZpbmVkID0gZnVuY3Rpb24ob2JqKSB7XG4gICAgcmV0dXJuIG9iaiA9PT0gdm9pZCAwO1xuICB9O1xuXG4gIC8vIFNob3J0Y3V0IGZ1bmN0aW9uIGZvciBjaGVja2luZyBpZiBhbiBvYmplY3QgaGFzIGEgZ2l2ZW4gcHJvcGVydHkgZGlyZWN0bHlcbiAgLy8gb24gaXRzZWxmIChpbiBvdGhlciB3b3Jkcywgbm90IG9uIGEgcHJvdG90eXBlKS5cbiAgXy5oYXMgPSBmdW5jdGlvbihvYmosIHBhdGgpIHtcbiAgICBpZiAoIV8uaXNBcnJheShwYXRoKSkge1xuICAgICAgcmV0dXJuIGhhcyhvYmosIHBhdGgpO1xuICAgIH1cbiAgICB2YXIgbGVuZ3RoID0gcGF0aC5sZW5ndGg7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgdmFyIGtleSA9IHBhdGhbaV07XG4gICAgICBpZiAob2JqID09IG51bGwgfHwgIWhhc093blByb3BlcnR5LmNhbGwob2JqLCBrZXkpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIG9iaiA9IG9ialtrZXldO1xuICAgIH1cbiAgICByZXR1cm4gISFsZW5ndGg7XG4gIH07XG5cbiAgLy8gVXRpbGl0eSBGdW5jdGlvbnNcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS1cblxuICAvLyBSdW4gVW5kZXJzY29yZS5qcyBpbiAqbm9Db25mbGljdCogbW9kZSwgcmV0dXJuaW5nIHRoZSBgX2AgdmFyaWFibGUgdG8gaXRzXG4gIC8vIHByZXZpb3VzIG93bmVyLiBSZXR1cm5zIGEgcmVmZXJlbmNlIHRvIHRoZSBVbmRlcnNjb3JlIG9iamVjdC5cbiAgXy5ub0NvbmZsaWN0ID0gZnVuY3Rpb24oKSB7XG4gICAgcm9vdC5fID0gcHJldmlvdXNVbmRlcnNjb3JlO1xuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIC8vIEtlZXAgdGhlIGlkZW50aXR5IGZ1bmN0aW9uIGFyb3VuZCBmb3IgZGVmYXVsdCBpdGVyYXRlZXMuXG4gIF8uaWRlbnRpdHkgPSBmdW5jdGlvbih2YWx1ZSkge1xuICAgIHJldHVybiB2YWx1ZTtcbiAgfTtcblxuICAvLyBQcmVkaWNhdGUtZ2VuZXJhdGluZyBmdW5jdGlvbnMuIE9mdGVuIHVzZWZ1bCBvdXRzaWRlIG9mIFVuZGVyc2NvcmUuXG4gIF8uY29uc3RhbnQgPSBmdW5jdGlvbih2YWx1ZSkge1xuICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiB2YWx1ZTtcbiAgICB9O1xuICB9O1xuXG4gIF8ubm9vcCA9IGZ1bmN0aW9uKCl7fTtcblxuICAvLyBDcmVhdGVzIGEgZnVuY3Rpb24gdGhhdCwgd2hlbiBwYXNzZWQgYW4gb2JqZWN0LCB3aWxsIHRyYXZlcnNlIHRoYXQgb2JqZWN04oCZc1xuICAvLyBwcm9wZXJ0aWVzIGRvd24gdGhlIGdpdmVuIGBwYXRoYCwgc3BlY2lmaWVkIGFzIGFuIGFycmF5IG9mIGtleXMgb3IgaW5kZXhlcy5cbiAgXy5wcm9wZXJ0eSA9IGZ1bmN0aW9uKHBhdGgpIHtcbiAgICBpZiAoIV8uaXNBcnJheShwYXRoKSkge1xuICAgICAgcmV0dXJuIHNoYWxsb3dQcm9wZXJ0eShwYXRoKTtcbiAgICB9XG4gICAgcmV0dXJuIGZ1bmN0aW9uKG9iaikge1xuICAgICAgcmV0dXJuIGRlZXBHZXQob2JqLCBwYXRoKTtcbiAgICB9O1xuICB9O1xuXG4gIC8vIEdlbmVyYXRlcyBhIGZ1bmN0aW9uIGZvciBhIGdpdmVuIG9iamVjdCB0aGF0IHJldHVybnMgYSBnaXZlbiBwcm9wZXJ0eS5cbiAgXy5wcm9wZXJ0eU9mID0gZnVuY3Rpb24ob2JqKSB7XG4gICAgaWYgKG9iaiA9PSBudWxsKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24oKXt9O1xuICAgIH1cbiAgICByZXR1cm4gZnVuY3Rpb24ocGF0aCkge1xuICAgICAgcmV0dXJuICFfLmlzQXJyYXkocGF0aCkgPyBvYmpbcGF0aF0gOiBkZWVwR2V0KG9iaiwgcGF0aCk7XG4gICAgfTtcbiAgfTtcblxuICAvLyBSZXR1cm5zIGEgcHJlZGljYXRlIGZvciBjaGVja2luZyB3aGV0aGVyIGFuIG9iamVjdCBoYXMgYSBnaXZlbiBzZXQgb2ZcbiAgLy8gYGtleTp2YWx1ZWAgcGFpcnMuXG4gIF8ubWF0Y2hlciA9IF8ubWF0Y2hlcyA9IGZ1bmN0aW9uKGF0dHJzKSB7XG4gICAgYXR0cnMgPSBfLmV4dGVuZE93bih7fSwgYXR0cnMpO1xuICAgIHJldHVybiBmdW5jdGlvbihvYmopIHtcbiAgICAgIHJldHVybiBfLmlzTWF0Y2gob2JqLCBhdHRycyk7XG4gICAgfTtcbiAgfTtcblxuICAvLyBSdW4gYSBmdW5jdGlvbiAqKm4qKiB0aW1lcy5cbiAgXy50aW1lcyA9IGZ1bmN0aW9uKG4sIGl0ZXJhdGVlLCBjb250ZXh0KSB7XG4gICAgdmFyIGFjY3VtID0gQXJyYXkoTWF0aC5tYXgoMCwgbikpO1xuICAgIGl0ZXJhdGVlID0gb3B0aW1pemVDYihpdGVyYXRlZSwgY29udGV4dCwgMSk7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBuOyBpKyspIGFjY3VtW2ldID0gaXRlcmF0ZWUoaSk7XG4gICAgcmV0dXJuIGFjY3VtO1xuICB9O1xuXG4gIC8vIFJldHVybiBhIHJhbmRvbSBpbnRlZ2VyIGJldHdlZW4gbWluIGFuZCBtYXggKGluY2x1c2l2ZSkuXG4gIF8ucmFuZG9tID0gZnVuY3Rpb24obWluLCBtYXgpIHtcbiAgICBpZiAobWF4ID09IG51bGwpIHtcbiAgICAgIG1heCA9IG1pbjtcbiAgICAgIG1pbiA9IDA7XG4gICAgfVxuICAgIHJldHVybiBtaW4gKyBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAobWF4IC0gbWluICsgMSkpO1xuICB9O1xuXG4gIC8vIEEgKHBvc3NpYmx5IGZhc3Rlcikgd2F5IHRvIGdldCB0aGUgY3VycmVudCB0aW1lc3RhbXAgYXMgYW4gaW50ZWdlci5cbiAgXy5ub3cgPSBEYXRlLm5vdyB8fCBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gbmV3IERhdGUoKS5nZXRUaW1lKCk7XG4gIH07XG5cbiAgLy8gTGlzdCBvZiBIVE1MIGVudGl0aWVzIGZvciBlc2NhcGluZy5cbiAgdmFyIGVzY2FwZU1hcCA9IHtcbiAgICAnJic6ICcmYW1wOycsXG4gICAgJzwnOiAnJmx0OycsXG4gICAgJz4nOiAnJmd0OycsXG4gICAgJ1wiJzogJyZxdW90OycsXG4gICAgXCInXCI6ICcmI3gyNzsnLFxuICAgICdgJzogJyYjeDYwOydcbiAgfTtcbiAgdmFyIHVuZXNjYXBlTWFwID0gXy5pbnZlcnQoZXNjYXBlTWFwKTtcblxuICAvLyBGdW5jdGlvbnMgZm9yIGVzY2FwaW5nIGFuZCB1bmVzY2FwaW5nIHN0cmluZ3MgdG8vZnJvbSBIVE1MIGludGVycG9sYXRpb24uXG4gIHZhciBjcmVhdGVFc2NhcGVyID0gZnVuY3Rpb24obWFwKSB7XG4gICAgdmFyIGVzY2FwZXIgPSBmdW5jdGlvbihtYXRjaCkge1xuICAgICAgcmV0dXJuIG1hcFttYXRjaF07XG4gICAgfTtcbiAgICAvLyBSZWdleGVzIGZvciBpZGVudGlmeWluZyBhIGtleSB0aGF0IG5lZWRzIHRvIGJlIGVzY2FwZWQuXG4gICAgdmFyIHNvdXJjZSA9ICcoPzonICsgXy5rZXlzKG1hcCkuam9pbignfCcpICsgJyknO1xuICAgIHZhciB0ZXN0UmVnZXhwID0gUmVnRXhwKHNvdXJjZSk7XG4gICAgdmFyIHJlcGxhY2VSZWdleHAgPSBSZWdFeHAoc291cmNlLCAnZycpO1xuICAgIHJldHVybiBmdW5jdGlvbihzdHJpbmcpIHtcbiAgICAgIHN0cmluZyA9IHN0cmluZyA9PSBudWxsID8gJycgOiAnJyArIHN0cmluZztcbiAgICAgIHJldHVybiB0ZXN0UmVnZXhwLnRlc3Qoc3RyaW5nKSA/IHN0cmluZy5yZXBsYWNlKHJlcGxhY2VSZWdleHAsIGVzY2FwZXIpIDogc3RyaW5nO1xuICAgIH07XG4gIH07XG4gIF8uZXNjYXBlID0gY3JlYXRlRXNjYXBlcihlc2NhcGVNYXApO1xuICBfLnVuZXNjYXBlID0gY3JlYXRlRXNjYXBlcih1bmVzY2FwZU1hcCk7XG5cbiAgLy8gVHJhdmVyc2VzIHRoZSBjaGlsZHJlbiBvZiBgb2JqYCBhbG9uZyBgcGF0aGAuIElmIGEgY2hpbGQgaXMgYSBmdW5jdGlvbiwgaXRcbiAgLy8gaXMgaW52b2tlZCB3aXRoIGl0cyBwYXJlbnQgYXMgY29udGV4dC4gUmV0dXJucyB0aGUgdmFsdWUgb2YgdGhlIGZpbmFsXG4gIC8vIGNoaWxkLCBvciBgZmFsbGJhY2tgIGlmIGFueSBjaGlsZCBpcyB1bmRlZmluZWQuXG4gIF8ucmVzdWx0ID0gZnVuY3Rpb24ob2JqLCBwYXRoLCBmYWxsYmFjaykge1xuICAgIGlmICghXy5pc0FycmF5KHBhdGgpKSBwYXRoID0gW3BhdGhdO1xuICAgIHZhciBsZW5ndGggPSBwYXRoLmxlbmd0aDtcbiAgICBpZiAoIWxlbmd0aCkge1xuICAgICAgcmV0dXJuIF8uaXNGdW5jdGlvbihmYWxsYmFjaykgPyBmYWxsYmFjay5jYWxsKG9iaikgOiBmYWxsYmFjaztcbiAgICB9XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgdmFyIHByb3AgPSBvYmogPT0gbnVsbCA/IHZvaWQgMCA6IG9ialtwYXRoW2ldXTtcbiAgICAgIGlmIChwcm9wID09PSB2b2lkIDApIHtcbiAgICAgICAgcHJvcCA9IGZhbGxiYWNrO1xuICAgICAgICBpID0gbGVuZ3RoOyAvLyBFbnN1cmUgd2UgZG9uJ3QgY29udGludWUgaXRlcmF0aW5nLlxuICAgICAgfVxuICAgICAgb2JqID0gXy5pc0Z1bmN0aW9uKHByb3ApID8gcHJvcC5jYWxsKG9iaikgOiBwcm9wO1xuICAgIH1cbiAgICByZXR1cm4gb2JqO1xuICB9O1xuXG4gIC8vIEdlbmVyYXRlIGEgdW5pcXVlIGludGVnZXIgaWQgKHVuaXF1ZSB3aXRoaW4gdGhlIGVudGlyZSBjbGllbnQgc2Vzc2lvbikuXG4gIC8vIFVzZWZ1bCBmb3IgdGVtcG9yYXJ5IERPTSBpZHMuXG4gIHZhciBpZENvdW50ZXIgPSAwO1xuICBfLnVuaXF1ZUlkID0gZnVuY3Rpb24ocHJlZml4KSB7XG4gICAgdmFyIGlkID0gKytpZENvdW50ZXIgKyAnJztcbiAgICByZXR1cm4gcHJlZml4ID8gcHJlZml4ICsgaWQgOiBpZDtcbiAgfTtcblxuICAvLyBCeSBkZWZhdWx0LCBVbmRlcnNjb3JlIHVzZXMgRVJCLXN0eWxlIHRlbXBsYXRlIGRlbGltaXRlcnMsIGNoYW5nZSB0aGVcbiAgLy8gZm9sbG93aW5nIHRlbXBsYXRlIHNldHRpbmdzIHRvIHVzZSBhbHRlcm5hdGl2ZSBkZWxpbWl0ZXJzLlxuICBfLnRlbXBsYXRlU2V0dGluZ3MgPSB7XG4gICAgZXZhbHVhdGU6IC88JShbXFxzXFxTXSs/KSU+L2csXG4gICAgaW50ZXJwb2xhdGU6IC88JT0oW1xcc1xcU10rPyklPi9nLFxuICAgIGVzY2FwZTogLzwlLShbXFxzXFxTXSs/KSU+L2dcbiAgfTtcblxuICAvLyBXaGVuIGN1c3RvbWl6aW5nIGB0ZW1wbGF0ZVNldHRpbmdzYCwgaWYgeW91IGRvbid0IHdhbnQgdG8gZGVmaW5lIGFuXG4gIC8vIGludGVycG9sYXRpb24sIGV2YWx1YXRpb24gb3IgZXNjYXBpbmcgcmVnZXgsIHdlIG5lZWQgb25lIHRoYXQgaXNcbiAgLy8gZ3VhcmFudGVlZCBub3QgdG8gbWF0Y2guXG4gIHZhciBub01hdGNoID0gLyguKV4vO1xuXG4gIC8vIENlcnRhaW4gY2hhcmFjdGVycyBuZWVkIHRvIGJlIGVzY2FwZWQgc28gdGhhdCB0aGV5IGNhbiBiZSBwdXQgaW50byBhXG4gIC8vIHN0cmluZyBsaXRlcmFsLlxuICB2YXIgZXNjYXBlcyA9IHtcbiAgICBcIidcIjogXCInXCIsXG4gICAgJ1xcXFwnOiAnXFxcXCcsXG4gICAgJ1xccic6ICdyJyxcbiAgICAnXFxuJzogJ24nLFxuICAgICdcXHUyMDI4JzogJ3UyMDI4JyxcbiAgICAnXFx1MjAyOSc6ICd1MjAyOSdcbiAgfTtcblxuICB2YXIgZXNjYXBlUmVnRXhwID0gL1xcXFx8J3xcXHJ8XFxufFxcdTIwMjh8XFx1MjAyOS9nO1xuXG4gIHZhciBlc2NhcGVDaGFyID0gZnVuY3Rpb24obWF0Y2gpIHtcbiAgICByZXR1cm4gJ1xcXFwnICsgZXNjYXBlc1ttYXRjaF07XG4gIH07XG5cbiAgLy8gSmF2YVNjcmlwdCBtaWNyby10ZW1wbGF0aW5nLCBzaW1pbGFyIHRvIEpvaG4gUmVzaWcncyBpbXBsZW1lbnRhdGlvbi5cbiAgLy8gVW5kZXJzY29yZSB0ZW1wbGF0aW5nIGhhbmRsZXMgYXJiaXRyYXJ5IGRlbGltaXRlcnMsIHByZXNlcnZlcyB3aGl0ZXNwYWNlLFxuICAvLyBhbmQgY29ycmVjdGx5IGVzY2FwZXMgcXVvdGVzIHdpdGhpbiBpbnRlcnBvbGF0ZWQgY29kZS5cbiAgLy8gTkI6IGBvbGRTZXR0aW5nc2Agb25seSBleGlzdHMgZm9yIGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5LlxuICBfLnRlbXBsYXRlID0gZnVuY3Rpb24odGV4dCwgc2V0dGluZ3MsIG9sZFNldHRpbmdzKSB7XG4gICAgaWYgKCFzZXR0aW5ncyAmJiBvbGRTZXR0aW5ncykgc2V0dGluZ3MgPSBvbGRTZXR0aW5ncztcbiAgICBzZXR0aW5ncyA9IF8uZGVmYXVsdHMoe30sIHNldHRpbmdzLCBfLnRlbXBsYXRlU2V0dGluZ3MpO1xuXG4gICAgLy8gQ29tYmluZSBkZWxpbWl0ZXJzIGludG8gb25lIHJlZ3VsYXIgZXhwcmVzc2lvbiB2aWEgYWx0ZXJuYXRpb24uXG4gICAgdmFyIG1hdGNoZXIgPSBSZWdFeHAoW1xuICAgICAgKHNldHRpbmdzLmVzY2FwZSB8fCBub01hdGNoKS5zb3VyY2UsXG4gICAgICAoc2V0dGluZ3MuaW50ZXJwb2xhdGUgfHwgbm9NYXRjaCkuc291cmNlLFxuICAgICAgKHNldHRpbmdzLmV2YWx1YXRlIHx8IG5vTWF0Y2gpLnNvdXJjZVxuICAgIF0uam9pbignfCcpICsgJ3wkJywgJ2cnKTtcblxuICAgIC8vIENvbXBpbGUgdGhlIHRlbXBsYXRlIHNvdXJjZSwgZXNjYXBpbmcgc3RyaW5nIGxpdGVyYWxzIGFwcHJvcHJpYXRlbHkuXG4gICAgdmFyIGluZGV4ID0gMDtcbiAgICB2YXIgc291cmNlID0gXCJfX3ArPSdcIjtcbiAgICB0ZXh0LnJlcGxhY2UobWF0Y2hlciwgZnVuY3Rpb24obWF0Y2gsIGVzY2FwZSwgaW50ZXJwb2xhdGUsIGV2YWx1YXRlLCBvZmZzZXQpIHtcbiAgICAgIHNvdXJjZSArPSB0ZXh0LnNsaWNlKGluZGV4LCBvZmZzZXQpLnJlcGxhY2UoZXNjYXBlUmVnRXhwLCBlc2NhcGVDaGFyKTtcbiAgICAgIGluZGV4ID0gb2Zmc2V0ICsgbWF0Y2gubGVuZ3RoO1xuXG4gICAgICBpZiAoZXNjYXBlKSB7XG4gICAgICAgIHNvdXJjZSArPSBcIicrXFxuKChfX3Q9KFwiICsgZXNjYXBlICsgXCIpKT09bnVsbD8nJzpfLmVzY2FwZShfX3QpKStcXG4nXCI7XG4gICAgICB9IGVsc2UgaWYgKGludGVycG9sYXRlKSB7XG4gICAgICAgIHNvdXJjZSArPSBcIicrXFxuKChfX3Q9KFwiICsgaW50ZXJwb2xhdGUgKyBcIikpPT1udWxsPycnOl9fdCkrXFxuJ1wiO1xuICAgICAgfSBlbHNlIGlmIChldmFsdWF0ZSkge1xuICAgICAgICBzb3VyY2UgKz0gXCInO1xcblwiICsgZXZhbHVhdGUgKyBcIlxcbl9fcCs9J1wiO1xuICAgICAgfVxuXG4gICAgICAvLyBBZG9iZSBWTXMgbmVlZCB0aGUgbWF0Y2ggcmV0dXJuZWQgdG8gcHJvZHVjZSB0aGUgY29ycmVjdCBvZmZzZXQuXG4gICAgICByZXR1cm4gbWF0Y2g7XG4gICAgfSk7XG4gICAgc291cmNlICs9IFwiJztcXG5cIjtcblxuICAgIC8vIElmIGEgdmFyaWFibGUgaXMgbm90IHNwZWNpZmllZCwgcGxhY2UgZGF0YSB2YWx1ZXMgaW4gbG9jYWwgc2NvcGUuXG4gICAgaWYgKCFzZXR0aW5ncy52YXJpYWJsZSkgc291cmNlID0gJ3dpdGgob2JqfHx7fSl7XFxuJyArIHNvdXJjZSArICd9XFxuJztcblxuICAgIHNvdXJjZSA9IFwidmFyIF9fdCxfX3A9JycsX19qPUFycmF5LnByb3RvdHlwZS5qb2luLFwiICtcbiAgICAgIFwicHJpbnQ9ZnVuY3Rpb24oKXtfX3ArPV9fai5jYWxsKGFyZ3VtZW50cywnJyk7fTtcXG5cIiArXG4gICAgICBzb3VyY2UgKyAncmV0dXJuIF9fcDtcXG4nO1xuXG4gICAgdmFyIHJlbmRlcjtcbiAgICB0cnkge1xuICAgICAgcmVuZGVyID0gbmV3IEZ1bmN0aW9uKHNldHRpbmdzLnZhcmlhYmxlIHx8ICdvYmonLCAnXycsIHNvdXJjZSk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgZS5zb3VyY2UgPSBzb3VyY2U7XG4gICAgICB0aHJvdyBlO1xuICAgIH1cblxuICAgIHZhciB0ZW1wbGF0ZSA9IGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgIHJldHVybiByZW5kZXIuY2FsbCh0aGlzLCBkYXRhLCBfKTtcbiAgICB9O1xuXG4gICAgLy8gUHJvdmlkZSB0aGUgY29tcGlsZWQgc291cmNlIGFzIGEgY29udmVuaWVuY2UgZm9yIHByZWNvbXBpbGF0aW9uLlxuICAgIHZhciBhcmd1bWVudCA9IHNldHRpbmdzLnZhcmlhYmxlIHx8ICdvYmonO1xuICAgIHRlbXBsYXRlLnNvdXJjZSA9ICdmdW5jdGlvbignICsgYXJndW1lbnQgKyAnKXtcXG4nICsgc291cmNlICsgJ30nO1xuXG4gICAgcmV0dXJuIHRlbXBsYXRlO1xuICB9O1xuXG4gIC8vIEFkZCBhIFwiY2hhaW5cIiBmdW5jdGlvbi4gU3RhcnQgY2hhaW5pbmcgYSB3cmFwcGVkIFVuZGVyc2NvcmUgb2JqZWN0LlxuICBfLmNoYWluID0gZnVuY3Rpb24ob2JqKSB7XG4gICAgdmFyIGluc3RhbmNlID0gXyhvYmopO1xuICAgIGluc3RhbmNlLl9jaGFpbiA9IHRydWU7XG4gICAgcmV0dXJuIGluc3RhbmNlO1xuICB9O1xuXG4gIC8vIE9PUFxuICAvLyAtLS0tLS0tLS0tLS0tLS1cbiAgLy8gSWYgVW5kZXJzY29yZSBpcyBjYWxsZWQgYXMgYSBmdW5jdGlvbiwgaXQgcmV0dXJucyBhIHdyYXBwZWQgb2JqZWN0IHRoYXRcbiAgLy8gY2FuIGJlIHVzZWQgT08tc3R5bGUuIFRoaXMgd3JhcHBlciBob2xkcyBhbHRlcmVkIHZlcnNpb25zIG9mIGFsbCB0aGVcbiAgLy8gdW5kZXJzY29yZSBmdW5jdGlvbnMuIFdyYXBwZWQgb2JqZWN0cyBtYXkgYmUgY2hhaW5lZC5cblxuICAvLyBIZWxwZXIgZnVuY3Rpb24gdG8gY29udGludWUgY2hhaW5pbmcgaW50ZXJtZWRpYXRlIHJlc3VsdHMuXG4gIHZhciBjaGFpblJlc3VsdCA9IGZ1bmN0aW9uKGluc3RhbmNlLCBvYmopIHtcbiAgICByZXR1cm4gaW5zdGFuY2UuX2NoYWluID8gXyhvYmopLmNoYWluKCkgOiBvYmo7XG4gIH07XG5cbiAgLy8gQWRkIHlvdXIgb3duIGN1c3RvbSBmdW5jdGlvbnMgdG8gdGhlIFVuZGVyc2NvcmUgb2JqZWN0LlxuICBfLm1peGluID0gZnVuY3Rpb24ob2JqKSB7XG4gICAgXy5lYWNoKF8uZnVuY3Rpb25zKG9iaiksIGZ1bmN0aW9uKG5hbWUpIHtcbiAgICAgIHZhciBmdW5jID0gX1tuYW1lXSA9IG9ialtuYW1lXTtcbiAgICAgIF8ucHJvdG90eXBlW25hbWVdID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBhcmdzID0gW3RoaXMuX3dyYXBwZWRdO1xuICAgICAgICBwdXNoLmFwcGx5KGFyZ3MsIGFyZ3VtZW50cyk7XG4gICAgICAgIHJldHVybiBjaGFpblJlc3VsdCh0aGlzLCBmdW5jLmFwcGx5KF8sIGFyZ3MpKTtcbiAgICAgIH07XG4gICAgfSk7XG4gICAgcmV0dXJuIF87XG4gIH07XG5cbiAgLy8gQWRkIGFsbCBvZiB0aGUgVW5kZXJzY29yZSBmdW5jdGlvbnMgdG8gdGhlIHdyYXBwZXIgb2JqZWN0LlxuICBfLm1peGluKF8pO1xuXG4gIC8vIEFkZCBhbGwgbXV0YXRvciBBcnJheSBmdW5jdGlvbnMgdG8gdGhlIHdyYXBwZXIuXG4gIF8uZWFjaChbJ3BvcCcsICdwdXNoJywgJ3JldmVyc2UnLCAnc2hpZnQnLCAnc29ydCcsICdzcGxpY2UnLCAndW5zaGlmdCddLCBmdW5jdGlvbihuYW1lKSB7XG4gICAgdmFyIG1ldGhvZCA9IEFycmF5UHJvdG9bbmFtZV07XG4gICAgXy5wcm90b3R5cGVbbmFtZV0gPSBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBvYmogPSB0aGlzLl93cmFwcGVkO1xuICAgICAgbWV0aG9kLmFwcGx5KG9iaiwgYXJndW1lbnRzKTtcbiAgICAgIGlmICgobmFtZSA9PT0gJ3NoaWZ0JyB8fCBuYW1lID09PSAnc3BsaWNlJykgJiYgb2JqLmxlbmd0aCA9PT0gMCkgZGVsZXRlIG9ialswXTtcbiAgICAgIHJldHVybiBjaGFpblJlc3VsdCh0aGlzLCBvYmopO1xuICAgIH07XG4gIH0pO1xuXG4gIC8vIEFkZCBhbGwgYWNjZXNzb3IgQXJyYXkgZnVuY3Rpb25zIHRvIHRoZSB3cmFwcGVyLlxuICBfLmVhY2goWydjb25jYXQnLCAnam9pbicsICdzbGljZSddLCBmdW5jdGlvbihuYW1lKSB7XG4gICAgdmFyIG1ldGhvZCA9IEFycmF5UHJvdG9bbmFtZV07XG4gICAgXy5wcm90b3R5cGVbbmFtZV0gPSBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiBjaGFpblJlc3VsdCh0aGlzLCBtZXRob2QuYXBwbHkodGhpcy5fd3JhcHBlZCwgYXJndW1lbnRzKSk7XG4gICAgfTtcbiAgfSk7XG5cbiAgLy8gRXh0cmFjdHMgdGhlIHJlc3VsdCBmcm9tIGEgd3JhcHBlZCBhbmQgY2hhaW5lZCBvYmplY3QuXG4gIF8ucHJvdG90eXBlLnZhbHVlID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuX3dyYXBwZWQ7XG4gIH07XG5cbiAgLy8gUHJvdmlkZSB1bndyYXBwaW5nIHByb3h5IGZvciBzb21lIG1ldGhvZHMgdXNlZCBpbiBlbmdpbmUgb3BlcmF0aW9uc1xuICAvLyBzdWNoIGFzIGFyaXRobWV0aWMgYW5kIEpTT04gc3RyaW5naWZpY2F0aW9uLlxuICBfLnByb3RvdHlwZS52YWx1ZU9mID0gXy5wcm90b3R5cGUudG9KU09OID0gXy5wcm90b3R5cGUudmFsdWU7XG5cbiAgXy5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gU3RyaW5nKHRoaXMuX3dyYXBwZWQpO1xuICB9O1xuXG4gIC8vIEFNRCByZWdpc3RyYXRpb24gaGFwcGVucyBhdCB0aGUgZW5kIGZvciBjb21wYXRpYmlsaXR5IHdpdGggQU1EIGxvYWRlcnNcbiAgLy8gdGhhdCBtYXkgbm90IGVuZm9yY2UgbmV4dC10dXJuIHNlbWFudGljcyBvbiBtb2R1bGVzLiBFdmVuIHRob3VnaCBnZW5lcmFsXG4gIC8vIHByYWN0aWNlIGZvciBBTUQgcmVnaXN0cmF0aW9uIGlzIHRvIGJlIGFub255bW91cywgdW5kZXJzY29yZSByZWdpc3RlcnNcbiAgLy8gYXMgYSBuYW1lZCBtb2R1bGUgYmVjYXVzZSwgbGlrZSBqUXVlcnksIGl0IGlzIGEgYmFzZSBsaWJyYXJ5IHRoYXQgaXNcbiAgLy8gcG9wdWxhciBlbm91Z2ggdG8gYmUgYnVuZGxlZCBpbiBhIHRoaXJkIHBhcnR5IGxpYiwgYnV0IG5vdCBiZSBwYXJ0IG9mXG4gIC8vIGFuIEFNRCBsb2FkIHJlcXVlc3QuIFRob3NlIGNhc2VzIGNvdWxkIGdlbmVyYXRlIGFuIGVycm9yIHdoZW4gYW5cbiAgLy8gYW5vbnltb3VzIGRlZmluZSgpIGlzIGNhbGxlZCBvdXRzaWRlIG9mIGEgbG9hZGVyIHJlcXVlc3QuXG4gIGlmICh0eXBlb2YgZGVmaW5lID09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkge1xuICAgIGRlZmluZSgndW5kZXJzY29yZScsIFtdLCBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiBfO1xuICAgIH0pO1xuICB9XG59KCkpO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTs7QSIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///8e08e542008e4aef1f58\n");

/***/ }),

/***/ "97640554fbb3ff20724f":
/*!***********************************************!*\
  !*** ./src/Apps/DOCUMENT/IHM/mainDocument.js ***!
  \***********************************************/
/*! no exports provided */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ \"127c8cf59f228bb01a21\");\n/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);\n/**\n * Main bootstraper\n */\n/*global require, console*/\n\n\njquery__WEBPACK_IMPORTED_MODULE_0___default.a.get(\"api/v2/i18n/DOCUMENT\").done(function translationLoaded(catalog) {\n  //Trigger an event when translation loaded\n  window.dcp.i18n = catalog;\n\n  var _ = __webpack_require__(/*! underscore */ \"8e08e542008e4aef1f58\");\n  __webpack_require__(/*! dcpExternals/KendoUI/KendoUI */ \"59b870d5aad30b0e7e20\");\n  __webpack_require__(/*! dcpDocument/widgets/documentController/documentController */ \"63e285088893d0390ab6\");\n\n  (\"use strict\");\n  console.timeEnd(\"js loading\");\n\n  var $document = jquery__WEBPACK_IMPORTED_MODULE_0___default()(\".document\"),\n    currentValues,\n    varWidgetValue = \"widgetValue\";\n\n  window.dcp = window.dcp || {};\n\n  window.dcp.documentReady = false;\n\n  if (!window.dcp.viewData && window.location.hash) {\n    currentValues = window.location.hash;\n    if (currentValues[0] === \"#\") {\n      currentValues = currentValues.slice(1);\n    }\n    if (currentValues.indexOf(varWidgetValue) === 0) {\n      try {\n        window.dcp.viewData = JSON.parse(\n          currentValues.slice(varWidgetValue.length)\n        );\n      } catch (ex1) {\n        try {\n          window.dcp.viewData = JSON.parse(\n            decodeURI(currentValues.slice(varWidgetValue.length))\n          );\n        } catch (ex2) {\n          $document.documentController(\"showMessage\", {\n            type: \"error\",\n            message: \"unable to retrieve document\"\n          });\n        }\n      }\n    }\n  }\n\n  window.dcp.triggerReload = function triggerReload() {\n    // Init bind events in case of use extern document controller\n    if (\n      window.documentLoaded &&\n      _.isFunction(window.documentLoaded) &&\n      !window.dcp.documentReady\n    ) {\n      window.documentLoaded($document, window.dcp.viewData);\n      window.dcp.documentReady = true;\n    }\n  };\n\n  if (window.dcp.viewData !== false && window.dcp.viewData.initid) {\n    $document.documentController(window.dcp.viewData);\n    $document.one(\"documentready\", function launchReady() {\n      window.dcp.triggerReload();\n      _.each(window.dcp.messages, function(msg) {\n        $document.documentController(\"showMessage\", {\n          type: msg.type,\n          message: msg.contentText\n        });\n      });\n    });\n  } else {\n    $document.documentController();\n    window.dcp.triggerReload();\n  }\n\n  window.dcp.document = $document;\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiOTc2NDA1NTRmYmIzZmYyMDcyNGYuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvQXBwcy9ET0NVTUVOVC9JSE0vbWFpbkRvY3VtZW50LmpzP2UyZGIiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBNYWluIGJvb3RzdHJhcGVyXG4gKi9cbi8qZ2xvYmFsIHJlcXVpcmUsIGNvbnNvbGUqL1xuaW1wb3J0ICQgZnJvbSBcImpxdWVyeVwiO1xuXG4kLmdldChcImFwaS92Mi9pMThuL0RPQ1VNRU5UXCIpLmRvbmUoZnVuY3Rpb24gdHJhbnNsYXRpb25Mb2FkZWQoY2F0YWxvZykge1xuICAvL1RyaWdnZXIgYW4gZXZlbnQgd2hlbiB0cmFuc2xhdGlvbiBsb2FkZWRcbiAgd2luZG93LmRjcC5pMThuID0gY2F0YWxvZztcblxuICB2YXIgXyA9IHJlcXVpcmUoXCJ1bmRlcnNjb3JlXCIpO1xuICByZXF1aXJlKFwiZGNwRXh0ZXJuYWxzL0tlbmRvVUkvS2VuZG9VSVwiKTtcbiAgcmVxdWlyZShcImRjcERvY3VtZW50L3dpZGdldHMvZG9jdW1lbnRDb250cm9sbGVyL2RvY3VtZW50Q29udHJvbGxlclwiKTtcblxuICAoXCJ1c2Ugc3RyaWN0XCIpO1xuICBjb25zb2xlLnRpbWVFbmQoXCJqcyBsb2FkaW5nXCIpO1xuXG4gIHZhciAkZG9jdW1lbnQgPSAkKFwiLmRvY3VtZW50XCIpLFxuICAgIGN1cnJlbnRWYWx1ZXMsXG4gICAgdmFyV2lkZ2V0VmFsdWUgPSBcIndpZGdldFZhbHVlXCI7XG5cbiAgd2luZG93LmRjcCA9IHdpbmRvdy5kY3AgfHwge307XG5cbiAgd2luZG93LmRjcC5kb2N1bWVudFJlYWR5ID0gZmFsc2U7XG5cbiAgaWYgKCF3aW5kb3cuZGNwLnZpZXdEYXRhICYmIHdpbmRvdy5sb2NhdGlvbi5oYXNoKSB7XG4gICAgY3VycmVudFZhbHVlcyA9IHdpbmRvdy5sb2NhdGlvbi5oYXNoO1xuICAgIGlmIChjdXJyZW50VmFsdWVzWzBdID09PSBcIiNcIikge1xuICAgICAgY3VycmVudFZhbHVlcyA9IGN1cnJlbnRWYWx1ZXMuc2xpY2UoMSk7XG4gICAgfVxuICAgIGlmIChjdXJyZW50VmFsdWVzLmluZGV4T2YodmFyV2lkZ2V0VmFsdWUpID09PSAwKSB7XG4gICAgICB0cnkge1xuICAgICAgICB3aW5kb3cuZGNwLnZpZXdEYXRhID0gSlNPTi5wYXJzZShcbiAgICAgICAgICBjdXJyZW50VmFsdWVzLnNsaWNlKHZhcldpZGdldFZhbHVlLmxlbmd0aClcbiAgICAgICAgKTtcbiAgICAgIH0gY2F0Y2ggKGV4MSkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIHdpbmRvdy5kY3Audmlld0RhdGEgPSBKU09OLnBhcnNlKFxuICAgICAgICAgICAgZGVjb2RlVVJJKGN1cnJlbnRWYWx1ZXMuc2xpY2UodmFyV2lkZ2V0VmFsdWUubGVuZ3RoKSlcbiAgICAgICAgICApO1xuICAgICAgICB9IGNhdGNoIChleDIpIHtcbiAgICAgICAgICAkZG9jdW1lbnQuZG9jdW1lbnRDb250cm9sbGVyKFwic2hvd01lc3NhZ2VcIiwge1xuICAgICAgICAgICAgdHlwZTogXCJlcnJvclwiLFxuICAgICAgICAgICAgbWVzc2FnZTogXCJ1bmFibGUgdG8gcmV0cmlldmUgZG9jdW1lbnRcIlxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgd2luZG93LmRjcC50cmlnZ2VyUmVsb2FkID0gZnVuY3Rpb24gdHJpZ2dlclJlbG9hZCgpIHtcbiAgICAvLyBJbml0IGJpbmQgZXZlbnRzIGluIGNhc2Ugb2YgdXNlIGV4dGVybiBkb2N1bWVudCBjb250cm9sbGVyXG4gICAgaWYgKFxuICAgICAgd2luZG93LmRvY3VtZW50TG9hZGVkICYmXG4gICAgICBfLmlzRnVuY3Rpb24od2luZG93LmRvY3VtZW50TG9hZGVkKSAmJlxuICAgICAgIXdpbmRvdy5kY3AuZG9jdW1lbnRSZWFkeVxuICAgICkge1xuICAgICAgd2luZG93LmRvY3VtZW50TG9hZGVkKCRkb2N1bWVudCwgd2luZG93LmRjcC52aWV3RGF0YSk7XG4gICAgICB3aW5kb3cuZGNwLmRvY3VtZW50UmVhZHkgPSB0cnVlO1xuICAgIH1cbiAgfTtcblxuICBpZiAod2luZG93LmRjcC52aWV3RGF0YSAhPT0gZmFsc2UgJiYgd2luZG93LmRjcC52aWV3RGF0YS5pbml0aWQpIHtcbiAgICAkZG9jdW1lbnQuZG9jdW1lbnRDb250cm9sbGVyKHdpbmRvdy5kY3Audmlld0RhdGEpO1xuICAgICRkb2N1bWVudC5vbmUoXCJkb2N1bWVudHJlYWR5XCIsIGZ1bmN0aW9uIGxhdW5jaFJlYWR5KCkge1xuICAgICAgd2luZG93LmRjcC50cmlnZ2VyUmVsb2FkKCk7XG4gICAgICBfLmVhY2god2luZG93LmRjcC5tZXNzYWdlcywgZnVuY3Rpb24obXNnKSB7XG4gICAgICAgICRkb2N1bWVudC5kb2N1bWVudENvbnRyb2xsZXIoXCJzaG93TWVzc2FnZVwiLCB7XG4gICAgICAgICAgdHlwZTogbXNnLnR5cGUsXG4gICAgICAgICAgbWVzc2FnZTogbXNnLmNvbnRlbnRUZXh0XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH0gZWxzZSB7XG4gICAgJGRvY3VtZW50LmRvY3VtZW50Q29udHJvbGxlcigpO1xuICAgIHdpbmRvdy5kY3AudHJpZ2dlclJlbG9hZCgpO1xuICB9XG5cbiAgd2luZG93LmRjcC5kb2N1bWVudCA9ICRkb2N1bWVudDtcbn0pO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///97640554fbb3ff20724f\n");

/***/ }),

/***/ "97de2f4cc762b1768ee2":
/*!**********************************************************!*\
  !*** ./src/Apps/DOCUMENT/IHM/models/mTransitionGraph.js ***!
  \**********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/*global define*/\n!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(/*! underscore */ \"8e08e542008e4aef1f58\"), __webpack_require__(/*! backbone */ \"1858b45bf48591489d06\"), __webpack_require__(/*! dcpDocument/models/mDocument */ \"ab4ce4f91706f6c2712e\")], __WEBPACK_AMD_DEFINE_RESULT__ = (function(\n  _,\n  Backbone\n) {\n  \"use strict\";\n\n  return Backbone.Model.extend({\n    typeModel: \"ddui:transitionGraph\",\n    defaults: {\n      documentId: undefined,\n      state: undefined\n    },\n\n    /**\n     * Compute the REST URL for the current document\n     *\n     * Used internaly by backbone in fetch, save, destroy\n     *\n     * @returns {string}\n     */\n    url: function mTransition_url() {\n      var urlData =\n        \"api/v2/documents/<%= documentId %>/workflows/states/?allStates=1\";\n\n      urlData = urlData.replace(\n        \"<%= documentId %>\",\n        encodeURIComponent(this.get(\"documentId\"))\n      );\n\n      return urlData;\n    },\n    /**\n     * Parse the return of the REST API\n     * @param response\n     * @returns {{properties: (*|properties|exports.defaults.properties|exports.parse.properties|.createObjectExpression.properties), menus: (app.views.shared.menu|*), locale: *, renderMode: string, attributes: Array, templates: *, renderOptions: *}}\n     */\n    parse: function mTransition_Parse(response) {\n      var values;\n      if (response.success === false) {\n        throw new Error(\"Unable to get the data from change state\");\n      }\n\n      values = {\n        state: this.get(\"state\"),\n        messages: response.messages,\n        workflowStates: response.data.states\n      };\n      return values;\n    }\n  });\n}).apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiOTdkZTJmNGNjNzYyYjE3NjhlZTIuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvQXBwcy9ET0NVTUVOVC9JSE0vbW9kZWxzL21UcmFuc2l0aW9uR3JhcGguanM/ODk0ZiJdLCJzb3VyY2VzQ29udGVudCI6WyIvKmdsb2JhbCBkZWZpbmUqL1xuZGVmaW5lKFtcInVuZGVyc2NvcmVcIiwgXCJiYWNrYm9uZVwiLCBcImRjcERvY3VtZW50L21vZGVscy9tRG9jdW1lbnRcIl0sIGZ1bmN0aW9uKFxuICBfLFxuICBCYWNrYm9uZVxuKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIHJldHVybiBCYWNrYm9uZS5Nb2RlbC5leHRlbmQoe1xuICAgIHR5cGVNb2RlbDogXCJkZHVpOnRyYW5zaXRpb25HcmFwaFwiLFxuICAgIGRlZmF1bHRzOiB7XG4gICAgICBkb2N1bWVudElkOiB1bmRlZmluZWQsXG4gICAgICBzdGF0ZTogdW5kZWZpbmVkXG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIENvbXB1dGUgdGhlIFJFU1QgVVJMIGZvciB0aGUgY3VycmVudCBkb2N1bWVudFxuICAgICAqXG4gICAgICogVXNlZCBpbnRlcm5hbHkgYnkgYmFja2JvbmUgaW4gZmV0Y2gsIHNhdmUsIGRlc3Ryb3lcbiAgICAgKlxuICAgICAqIEByZXR1cm5zIHtzdHJpbmd9XG4gICAgICovXG4gICAgdXJsOiBmdW5jdGlvbiBtVHJhbnNpdGlvbl91cmwoKSB7XG4gICAgICB2YXIgdXJsRGF0YSA9XG4gICAgICAgIFwiYXBpL3YyL2RvY3VtZW50cy88JT0gZG9jdW1lbnRJZCAlPi93b3JrZmxvd3Mvc3RhdGVzLz9hbGxTdGF0ZXM9MVwiO1xuXG4gICAgICB1cmxEYXRhID0gdXJsRGF0YS5yZXBsYWNlKFxuICAgICAgICBcIjwlPSBkb2N1bWVudElkICU+XCIsXG4gICAgICAgIGVuY29kZVVSSUNvbXBvbmVudCh0aGlzLmdldChcImRvY3VtZW50SWRcIikpXG4gICAgICApO1xuXG4gICAgICByZXR1cm4gdXJsRGF0YTtcbiAgICB9LFxuICAgIC8qKlxuICAgICAqIFBhcnNlIHRoZSByZXR1cm4gb2YgdGhlIFJFU1QgQVBJXG4gICAgICogQHBhcmFtIHJlc3BvbnNlXG4gICAgICogQHJldHVybnMge3twcm9wZXJ0aWVzOiAoKnxwcm9wZXJ0aWVzfGV4cG9ydHMuZGVmYXVsdHMucHJvcGVydGllc3xleHBvcnRzLnBhcnNlLnByb3BlcnRpZXN8LmNyZWF0ZU9iamVjdEV4cHJlc3Npb24ucHJvcGVydGllcyksIG1lbnVzOiAoYXBwLnZpZXdzLnNoYXJlZC5tZW51fCopLCBsb2NhbGU6ICosIHJlbmRlck1vZGU6IHN0cmluZywgYXR0cmlidXRlczogQXJyYXksIHRlbXBsYXRlczogKiwgcmVuZGVyT3B0aW9uczogKn19XG4gICAgICovXG4gICAgcGFyc2U6IGZ1bmN0aW9uIG1UcmFuc2l0aW9uX1BhcnNlKHJlc3BvbnNlKSB7XG4gICAgICB2YXIgdmFsdWVzO1xuICAgICAgaWYgKHJlc3BvbnNlLnN1Y2Nlc3MgPT09IGZhbHNlKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIlVuYWJsZSB0byBnZXQgdGhlIGRhdGEgZnJvbSBjaGFuZ2Ugc3RhdGVcIik7XG4gICAgICB9XG5cbiAgICAgIHZhbHVlcyA9IHtcbiAgICAgICAgc3RhdGU6IHRoaXMuZ2V0KFwic3RhdGVcIiksXG4gICAgICAgIG1lc3NhZ2VzOiByZXNwb25zZS5tZXNzYWdlcyxcbiAgICAgICAgd29ya2Zsb3dTdGF0ZXM6IHJlc3BvbnNlLmRhdGEuc3RhdGVzXG4gICAgICB9O1xuICAgICAgcmV0dXJuIHZhbHVlcztcbiAgICB9XG4gIH0pO1xufSk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///97de2f4cc762b1768ee2\n");

/***/ }),

/***/ "98221531f3fb9af2dff1":
/*!************************************************************************!*\
  !*** ./src/Apps/DOCUMENT/IHM/widgets/attributes/htmltext/wHtmltext.js ***!
  \************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/*global define */\n(function umdRequire(root, factory) {\n  \"use strict\";\n\n  if (true) {\n    !(__WEBPACK_AMD_DEFINE_ARRAY__ = [\n      __webpack_require__(/*! jquery */ \"127c8cf59f228bb01a21\"),\n      __webpack_require__(/*! underscore */ \"8e08e542008e4aef1f58\"),\n      __webpack_require__(/*! dcpDocument/widgets/attributes/text/wText */ \"61b480911316cdda77a4\")\n    ], __WEBPACK_AMD_DEFINE_FACTORY__ = (factory),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?\n\t\t\t\t(__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n  } else {}\n})(window, function require_htmltext($, _, themePath) {\n  \"use strict\";\n\n  $.widget(\"dcp.dcpHtmltext\", $.dcp.dcpText, {\n    options: {\n      type: \"htmltext\",\n      renderOptions: {\n        anchors: {\n          target: \"_blank\"\n        },\n        toolbar: \"Basic\",\n        height: \"100px\",\n        toolbarStartupExpanded: true,\n        ckEditorConfiguration: {},\n        ckEditorAllowAllTags: false\n      },\n      inline: false,\n      locale: \"en\"\n    },\n\n    ckEditorInstance: null,\n\n    _initDom: function wHtmltext_InitDom() {\n      var currentWidget = this,\n        bind_super = _.bind(this._super, this),\n        bindInitEvent = _.bind(this._initEvent, this);\n      try {\n        this.popupWindows = {};\n        if (this.options.renderOptions.ckEditorInline) {\n          this.options.inline = true;\n        }\n        if (this.getMode() === \"write\") {\n          (function wHtmltext_umdRequire(factory) {\n            var init = function() {\n              fetch(\"/Anakeen/manifest/theme/prod.json\")\n                .then(function(response) {\n                  return response.json();\n                })\n                .then(function(data) {\n                  factory(data[\"ckeditor\"][\"css\"]);\n                });\n            };\n            if (true) {\n              Promise.all(/*! require.ensure | documentCkEditor */[__webpack_require__.e(\"vendors~documentCkEditor\"), __webpack_require__.e(\"documentCkEditor\")]).then((function() {\n                  __webpack_require__(/*! documentCkEditor */ \"94561e1138d7484d0327\");\n                  init();\n                }).bind(null, __webpack_require__)).catch(__webpack_require__.oe);\n            } else {}\n          })(function wHtmltext_initEditDom(cssPath) {\n            var options = _.extend(\n              currentWidget.ckOptions(cssPath),\n              currentWidget.options.renderOptions.ckEditorConfiguration\n            );\n            bind_super();\n            if (currentWidget.options.renderOptions.ckEditorAllowAllTags) {\n              // Allow all HTML tags\n              options.allowedContent = {\n                $1: {\n                  // Use the ability to specify elements as an object.\n                  elements: window.CKEDITOR.dtd,\n                  attributes: true,\n                  styles: true,\n                  classes: true\n                }\n              };\n              options.disallowedContent = \"script; *[on*]\";\n            }\n\n            currentWidget.ckEditorInstance = currentWidget\n              .getContentElements()\n              .ckeditor(options).editor;\n            currentWidget.options.attributeValue.value = currentWidget.ckEditorInstance.getData();\n            bindInitEvent();\n          });\n        } else {\n          bind_super();\n        }\n      } catch (e) {\n        if (window.dcp.logger) {\n          window.dcp.logger(e);\n        } else {\n          console.error(e);\n        }\n      }\n    },\n\n    /**\n     * Define option set for ckEditor widget\n     * @returns {{language: string, contentsCss: string[], removePlugins: string, toolbarCanCollapse: boolean, entities: boolean, filebrowserImageBrowseUrl: string, filebrowserImageUploadUrl: string, toolbar_Full: *[], toolbar_Default: *[], toolbar_Simple: *[], toolbar_Basic: *[], removeButtons: string}}\n     */\n    ckOptions: function wHtmlTextCkOptions(cssPath) {\n      var locale = this.options.locale;\n      var hrefBase = $(\"head base\").attr(\"href\") || \"\"; // no use document.baseURI because get complete url if no base href defined\n      if (this.options.renderOptions.toolbar) {\n        this.options.renderOptions.ckEditorConfiguration.toolbar = this.options.renderOptions.toolbar;\n      }\n      if (this.options.renderOptions.height) {\n        this.options.renderOptions.ckEditorConfiguration.height = this.options.renderOptions.height;\n      }\n      if (!_.isUndefined(this.options.renderOptions.toolbarStartupExpanded)) {\n        this.options.renderOptions.ckEditorConfiguration.toolbarStartupExpanded = this.options.renderOptions.toolbarStartupExpanded;\n      }\n      return {\n        language: locale.substring(0, 2),\n        contentsCss: [cssPath],\n        removePlugins: \"elementspath\", // no see HTML path elements\n        extraPlugins:\n          \"a11yhelp,about,basicstyles,blockquote,clipboard,colorbutton,contextmenu,elementspath,enterkey,entities,filebrowser,floatingspace,font,format,horizontalrule,htmlwriter,image,indentlist,justify,link,list,magicline,maximize,pastefromword,pastetext,removeformat,resize,scayt,showborders,sourcearea,sourcedialog,specialchar,stylescombo,tab,table,tabletools,toolbar,undo,wsc,wysiwygarea\",\n        toolbarCanCollapse: true,\n        entities: false, // no use HTML entities\n        baseHref: hrefBase,\n        title: \"\",\n        toolbar_Full: [\n          {\n            name: \"document\",\n            items: [\n              \"Sourcedialog\",\n              \"-\",\n              \"NewPage\",\n              \"DocProps\",\n              \"Preview\",\n              \"Print\",\n              \"-\",\n              \"Templates\"\n            ]\n          },\n          {\n            name: \"clipboard\",\n            items: [\n              \"Cut\",\n              \"Copy\",\n              \"Paste\",\n              \"PasteText\",\n              \"PasteFromWord\",\n              \"-\",\n              \"Undo\",\n              \"Redo\"\n            ]\n          },\n          {\n            name: \"editing\",\n            items: [\"Find\", \"Replace\", \"-\", \"SelectAll\", \"-\"]\n          },\n          {\n            name: \"forms\",\n            items: [\n              \"Form\",\n              \"Checkbox\",\n              \"Radio\",\n              \"TextField\",\n              \"Textarea\",\n              \"Select\",\n              \"Button\",\n              \"ImageButton\",\n              \"HiddenField\"\n            ]\n          },\n          \"/\",\n          {\n            name: \"basicstyles\",\n            items: [\n              \"Bold\",\n              \"Italic\",\n              \"Underline\",\n              \"Strike\",\n              \"Subscript\",\n              \"Superscript\",\n              \"-\",\n              \"RemoveFormat\"\n            ]\n          },\n          {\n            name: \"paragraph\",\n            items: [\n              \"NumberedList\",\n              \"BulletedList\",\n              \"-\",\n              \"Outdent\",\n              \"Indent\",\n              \"-\",\n              \"Blockquote\",\n              \"CreateDiv\",\n              \"-\",\n              \"JustifyLeft\",\n              \"JustifyCenter\",\n              \"JustifyRight\",\n              \"JustifyBlock\",\n              \"-\",\n              \"BidiLtr\",\n              \"BidiRtl\"\n            ]\n          },\n          { name: \"links\", items: [\"Link\", \"Unlink\"] },\n          {\n            name: \"insert\",\n            items: [\n              \"Image\",\n              \"Table\",\n              \"HorizontalRule\",\n              \"Smiley\",\n              \"SpecialChar\",\n              \"PageBreak\",\n              \"Iframe\"\n            ]\n          },\n          \"/\",\n          { name: \"styles\", items: [\"Styles\", \"Format\", \"Font\", \"FontSize\"] },\n          { name: \"colors\", items: [\"TextColor\", \"BGColor\"] },\n          { name: \"tools\", items: [\"Maximize\", \"ShowBlocks\", \"-\", \"About\"] }\n        ],\n        toolbar_Default: [\n          { name: \"document\", items: [\"Sourcedialog\"] },\n          {\n            name: \"clipboard\",\n            items: [\n              \"Cut\",\n              \"Copy\",\n              \"Paste\",\n              \"PasteText\",\n              \"PasteFromWord\",\n              \"-\",\n              \"Undo\",\n              \"Redo\"\n            ]\n          },\n          { name: \"editing\", items: [\"Find\", \"Replace\", \"-\", \"SelectAll\"] },\n          {\n            name: \"basicstyles\",\n            items: [\n              \"Bold\",\n              \"Italic\",\n              \"Underline\",\n              \"Strike\",\n              \"Subscript\",\n              \"Superscript\",\n              \"-\",\n              \"RemoveFormat\"\n            ]\n          },\n          {\n            name: \"paragraph\",\n            items: [\n              \"NumberedList\",\n              \"BulletedList\",\n              \"-\",\n              \"Outdent\",\n              \"Indent\",\n              \"-\",\n              \"Blockquote\",\n              \"CreateDiv\",\n              \"-\",\n              \"JustifyLeft\",\n              \"JustifyCenter\",\n              \"JustifyRight\",\n              \"JustifyBlock\",\n              \"-\",\n              \"BidiLtr\",\n              \"BidiRtl\"\n            ]\n          },\n          { name: \"links\", items: [\"Link\", \"Unlink\"] },\n          {\n            name: \"insert\",\n            items: [\n              \"Image\",\n              \"Table\",\n              \"HorizontalRule\",\n              \"SpecialChar\",\n              \"PageBreak\",\n              \"Iframe\"\n            ]\n          },\n          { name: \"styles\", items: [\"Styles\", \"Format\", \"Font\", \"FontSize\"] },\n          { name: \"colors\", items: [\"TextColor\", \"BGColor\"] },\n          { name: \"tools\", items: [\"Maximize\", \"ShowBlocks\", \"-\", \"About\"] }\n        ],\n        toolbar_Simple: [\n          { name: \"document\", items: [] },\n          {\n            name: \"basicstyles\",\n            items: [\n              \"Bold\",\n              \"Italic\",\n              \"Underline\",\n              \"Strike\",\n              \"-\",\n              \"RemoveFormat\"\n            ]\n          },\n          {\n            name: \"paragraph\",\n            items: [\n              \"NumberedList\",\n              \"BulletedList\",\n              \"-\",\n              \"Outdent\",\n              \"Indent\",\n              \"-\",\n              \"-\",\n              \"JustifyLeft\",\n              \"JustifyCenter\",\n              \"JustifyRight\",\n              \"JustifyBlock\"\n            ]\n          },\n          { name: \"links\", items: [\"Link\", \"Unlink\"] },\n          { name: \"insert\", items: [\"Image\", \"Table\", \"SpecialChar\"] },\n          { name: \"styles\", items: [\"Format\", \"FontSize\"] },\n          { name: \"colors\", items: [\"TextColor\", \"BGColor\"] },\n          { name: \"tools\", items: [\"Maximize\", \"Sourcedialog\", \"-\", \"About\"] }\n        ],\n        toolbar_Basic: [\n          {\n            name: \"links\",\n            items: [\n              \"Bold\",\n              \"Italic\",\n              \"-\",\n              \"NumberedList\",\n              \"BulletedList\",\n              \"-\",\n              \"Link\",\n              \"Unlink\",\n              \"-\",\n              \"Maximize\",\n              \"About\"\n            ]\n          }\n        ],\n        removeButtons: \"\"\n      };\n    },\n\n    _initEvent: function _initEvent() {\n      var currentWidget = this;\n      this._super();\n      if (this.ckEditorInstance) {\n        this.ckEditorInstance.on(\"change\", function wHtmltext_change() {\n          currentWidget.setValue({ value: this.getData() });\n        });\n\n        this.ckEditorInstance.on(\"focus\", function wHtmltext_focus() {\n          var ktTarget = currentWidget.element.find(\".input-group\");\n          currentWidget.showInputTooltip(ktTarget);\n          currentWidget.element.find(\".cke\").addClass(\"k-state-focused\");\n          currentWidget.element\n            .closest(\".dcpAttribute__content\")\n            .addClass(\"dcpAttribute--focus\");\n        });\n\n        this.ckEditorInstance.on(\"blur\", function wHtmltext_blur() {\n          var ktTarget = currentWidget.element.find(\".input-group\");\n          currentWidget.hideInputTooltip(ktTarget);\n          currentWidget.element.find(\".cke\").removeClass(\"k-state-focused\");\n          currentWidget.element\n            .closest(\".dcpAttribute__content\")\n            .removeClass(\"dcpAttribute--focus\");\n        });\n\n        this.ckEditorInstance.on(\"instanceReady\", function wHtmltext_loaded() {\n          currentWidget._trigger(\"widgetReady\");\n        });\n\n        this.element.on(\n          \"postMoved\" + this.eventNamespace,\n          function wHtmlTextOnPostMoved(event, eventData) {\n            if (eventData && eventData.to === currentWidget.options.index) {\n              currentWidget.redraw();\n            }\n          }\n        );\n      }\n\n      //If we are not in CKEDITOR mode, we take care of anchor and redirect it\n      if (this.getMode() !== \"write\") {\n        this.element.on(\n          \"click.\" + this.eventNamespace,\n          'a:not([href^=\"#action/\"]):not([data-action])',\n          function wHtmlAnchorClick(event) {\n            var internalEvent = { prevent: false },\n              anchor = this,\n              $anchor = $(this),\n              isNotPrevented,\n              anchorsConfig,\n              anchorsTarget,\n              wFeature = \"\",\n              href,\n              dcpWindow;\n\n            if (event.stopPropagation) {\n              event.stopPropagation();\n            }\n            event.preventDefault();\n\n            anchorsConfig = _.extend(\n              {},\n              currentWidget.options.renderOptions.anchors\n            );\n\n            isNotPrevented = currentWidget._trigger(\n              \"anchorClick\",\n              internalEvent,\n              {\n                $el: currentWidget.element,\n                index: currentWidget._getIndex(),\n                options: {\n                  anchor: anchor,\n                  anchorsConfig: anchorsConfig\n                }\n              }\n            );\n            if (isNotPrevented) {\n              var $base = $(\"base\");\n              var isAbsUrl = new RegExp(\"^(?:[a-z]+:)?//\", \"i\");\n\n              anchorsTarget = anchorsConfig.target || \"_blank\";\n              href = anchor.href;\n\n              if (\n                $anchor.attr(\"href\") &&\n                $anchor.attr(\"href\").substring(0, 1) === \"#\"\n              ) {\n                href =\n                  window.location.protocol +\n                  \"//\" +\n                  window.location.hostname +\n                  (window.location.port ? \":\" + window.location.port : \"\") +\n                  (window.location.pathname ? window.location.pathname : \"/\") +\n                  (window.location.search ? window.location.search : \"\") +\n                  $anchor.attr(\"href\");\n              }\n\n              switch (anchorsTarget) {\n                case \"_dialog\":\n                  if (currentWidget.popupWindows[href]) {\n                    dcpWindow = currentWidget.popupWindows[href];\n                  } else {\n                    dcpWindow = $(\"<div/>\")\n                      .appendTo(\"body\")\n                      .dcpWindow({\n                        width: anchorsConfig.windowWidth,\n                        height: anchorsConfig.windowHeight,\n                        modal: anchorsConfig.modal,\n                        content: href,\n                        iframe: true\n                      });\n\n                    currentWidget.popupWindows[href] = dcpWindow;\n                    dcpWindow\n                      .data(\"dcpWindow\")\n                      .kendoWindow()\n                      .center();\n                  }\n                  dcpWindow.data(\"dcpWindow\").open();\n                  break;\n                case \"_self\":\n                  // For IE : Not honor base href in this case\n                  if (!isAbsUrl.test(href)) {\n                    window.location.href = $base.attr(\"href\") + href;\n                  } else {\n                    window.location.href = href;\n                  }\n                  break;\n                default:\n                  if (anchorsConfig.windowWidth || anchorsConfig.windowHeight) {\n                    if (anchorsConfig.windowWidth) {\n                      wFeature +=\n                        \"width=\" +\n                        parseInt(anchorsConfig.windowWidth, 10) +\n                        \",\";\n                    }\n                    if (anchorsConfig.windowHeight) {\n                      wFeature +=\n                        \"height=\" +\n                        parseInt(anchorsConfig.windowHeight, 10) +\n                        \",\";\n                    }\n                    wFeature += \"resizable=yes,scrollbars=yes\";\n                  }\n                  if (!isAbsUrl.test(href)) {\n                    href = $base.attr(\"href\") + href;\n                  }\n                  window.open(href, anchorsTarget, wFeature);\n                  break;\n              }\n            }\n          }\n        );\n      }\n    },\n    /**\n     * Define inputs for focus\n     * @protected\n     */\n    _getFocusInput: function wHtmltext_getFocusInput() {\n      return this.element;\n    },\n    /**\n     * No use parent change\n     */\n    _initChangeEvent: function wHtmltext_initChangeEvent() {},\n\n    getWidgetValue: function wHtmltext_getWidgetValue() {\n      return this.getContentElements().val();\n    },\n\n    /**\n     * Change the value of the widget\n     * @param value\n     */\n    setValue: function wHtmltextSetValue(value) {\n      value = _.clone(value);\n      if (value.value === null) {\n        // ckEditor restore original value if set to null\n        value.value = \"\";\n      }\n      if (_.has(value, \"value\") && !_.has(value, \"displayValue\")) {\n        value.displayValue = value.value;\n      }\n      if (this.getMode() === \"write\") {\n        // Flash element only\n        var originalValue = this.ckEditorInstance.getData();\n        // : explicit lazy equal\n\n        //noinspection JSHint\n        if (originalValue.trim() != value.value.trim()) {\n          // Modify value only if different\n          if (this.options.inline) {\n            this.getContentElements().html(value.value);\n          } else {\n            this.getContentElements().val(value.value);\n            this.flashElement(this.element.find(\"iframe\"));\n          }\n        }\n      } else if (this.getMode() === \"read\") {\n        this.getContentElements().html(value.displayValue);\n      } else {\n        throw new Error(\n          \"Attribute \" + this.options.id + \" unknown mode \" + this.getMode()\n        );\n      }\n\n      // call wAttribute::setValue()\n      $.dcp.dcpAttribute.prototype.setValue.call(this, value);\n    },\n\n    getType: function wHtmltext_getType() {\n      return \"htmltext\";\n    },\n\n    _destroy: function wHtmlTextDestroy() {\n      var currentWidget = this;\n      if (this.ckEditorInstance && this.ckEditorInstance.destroy) {\n        if (\n          this.ckEditorInstance.status === \"loaded\" ||\n          this.ckEditorInstance.status === \"ready\"\n        ) {\n          this.ckEditorInstance.destroy();\n          _.defer(function wHtmltext_deferDestroy() {\n            currentWidget._destroy();\n          });\n          return;\n        } else if (this.ckEditorInstance.status === \"unloaded\") {\n          this.ckEditorInstance.on(\"loaded\", function wHtmltext_loaded() {\n            currentWidget._destroy();\n          });\n          return;\n        }\n      }\n      _.each(this.popupWindows, function wHtmltextDestroyPopup(pWindow) {\n        pWindow.data(\"dcpWindow\").destroy();\n      });\n      this._super();\n    },\n\n    /**\n     * Trigger a ready event when widget is render\n     */\n    _triggerReady: function wAttributeReady() {\n      if (this.getMode() !== \"write\") {\n        this._super();\n      }\n    }\n  });\n\n  return $.fn.dcpHtmltext;\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiOTgyMjE1MzFmM2ZiOWFmMmRmZjEuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvQXBwcy9ET0NVTUVOVC9JSE0vd2lkZ2V0cy9hdHRyaWJ1dGVzL2h0bWx0ZXh0L3dIdG1sdGV4dC5qcz8xYmE4Il0sInNvdXJjZXNDb250ZW50IjpbIi8qZ2xvYmFsIGRlZmluZSAqL1xuKGZ1bmN0aW9uIHVtZFJlcXVpcmUocm9vdCwgZmFjdG9yeSkge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICBpZiAodHlwZW9mIGRlZmluZSA9PT0gXCJmdW5jdGlvblwiICYmIGRlZmluZS5hbWQpIHtcbiAgICBkZWZpbmUoW1xuICAgICAgXCJqcXVlcnlcIixcbiAgICAgIFwidW5kZXJzY29yZVwiLFxuICAgICAgXCJkY3BEb2N1bWVudC93aWRnZXRzL2F0dHJpYnV0ZXMvdGV4dC93VGV4dFwiXG4gICAgXSwgZmFjdG9yeSk7XG4gIH0gZWxzZSB7XG4gICAgLy9ub2luc3BlY3Rpb24gSlNVbnJlc29sdmVkVmFyaWFibGVcbiAgICBmYWN0b3J5KHdpbmRvdy5qUXVlcnksIHdpbmRvdy5fKTtcbiAgfVxufSkod2luZG93LCBmdW5jdGlvbiByZXF1aXJlX2h0bWx0ZXh0KCQsIF8sIHRoZW1lUGF0aCkge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICAkLndpZGdldChcImRjcC5kY3BIdG1sdGV4dFwiLCAkLmRjcC5kY3BUZXh0LCB7XG4gICAgb3B0aW9uczoge1xuICAgICAgdHlwZTogXCJodG1sdGV4dFwiLFxuICAgICAgcmVuZGVyT3B0aW9uczoge1xuICAgICAgICBhbmNob3JzOiB7XG4gICAgICAgICAgdGFyZ2V0OiBcIl9ibGFua1wiXG4gICAgICAgIH0sXG4gICAgICAgIHRvb2xiYXI6IFwiQmFzaWNcIixcbiAgICAgICAgaGVpZ2h0OiBcIjEwMHB4XCIsXG4gICAgICAgIHRvb2xiYXJTdGFydHVwRXhwYW5kZWQ6IHRydWUsXG4gICAgICAgIGNrRWRpdG9yQ29uZmlndXJhdGlvbjoge30sXG4gICAgICAgIGNrRWRpdG9yQWxsb3dBbGxUYWdzOiBmYWxzZVxuICAgICAgfSxcbiAgICAgIGlubGluZTogZmFsc2UsXG4gICAgICBsb2NhbGU6IFwiZW5cIlxuICAgIH0sXG5cbiAgICBja0VkaXRvckluc3RhbmNlOiBudWxsLFxuXG4gICAgX2luaXREb206IGZ1bmN0aW9uIHdIdG1sdGV4dF9Jbml0RG9tKCkge1xuICAgICAgdmFyIGN1cnJlbnRXaWRnZXQgPSB0aGlzLFxuICAgICAgICBiaW5kX3N1cGVyID0gXy5iaW5kKHRoaXMuX3N1cGVyLCB0aGlzKSxcbiAgICAgICAgYmluZEluaXRFdmVudCA9IF8uYmluZCh0aGlzLl9pbml0RXZlbnQsIHRoaXMpO1xuICAgICAgdHJ5IHtcbiAgICAgICAgdGhpcy5wb3B1cFdpbmRvd3MgPSB7fTtcbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5yZW5kZXJPcHRpb25zLmNrRWRpdG9ySW5saW5lKSB7XG4gICAgICAgICAgdGhpcy5vcHRpb25zLmlubGluZSA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuZ2V0TW9kZSgpID09PSBcIndyaXRlXCIpIHtcbiAgICAgICAgICAoZnVuY3Rpb24gd0h0bWx0ZXh0X3VtZFJlcXVpcmUoZmFjdG9yeSkge1xuICAgICAgICAgICAgdmFyIGluaXQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgZmV0Y2goXCIvQW5ha2Vlbi9tYW5pZmVzdC90aGVtZS9wcm9kLmpzb25cIilcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgIGZhY3RvcnkoZGF0YVtcImNrZWRpdG9yXCJdW1wiY3NzXCJdKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBpZiAodHlwZW9mIGRlZmluZSA9PT0gXCJmdW5jdGlvblwiICYmIGRlZmluZS5hbWQpIHtcbiAgICAgICAgICAgICAgcmVxdWlyZS5lbnN1cmUoXG4gICAgICAgICAgICAgICAgW1wiZG9jdW1lbnRDa0VkaXRvclwiXSxcbiAgICAgICAgICAgICAgICBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgIHJlcXVpcmUoXCJkb2N1bWVudENrRWRpdG9yXCIpO1xuICAgICAgICAgICAgICAgICAgaW5pdCgpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgXCJkb2N1bWVudENrRWRpdG9yXCJcbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIC8vbm9pbnNwZWN0aW9uIEpTVW5yZXNvbHZlZFZhcmlhYmxlXG4gICAgICAgICAgICAgIGluaXQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KShmdW5jdGlvbiB3SHRtbHRleHRfaW5pdEVkaXREb20oY3NzUGF0aCkge1xuICAgICAgICAgICAgdmFyIG9wdGlvbnMgPSBfLmV4dGVuZChcbiAgICAgICAgICAgICAgY3VycmVudFdpZGdldC5ja09wdGlvbnMoY3NzUGF0aCksXG4gICAgICAgICAgICAgIGN1cnJlbnRXaWRnZXQub3B0aW9ucy5yZW5kZXJPcHRpb25zLmNrRWRpdG9yQ29uZmlndXJhdGlvblxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIGJpbmRfc3VwZXIoKTtcbiAgICAgICAgICAgIGlmIChjdXJyZW50V2lkZ2V0Lm9wdGlvbnMucmVuZGVyT3B0aW9ucy5ja0VkaXRvckFsbG93QWxsVGFncykge1xuICAgICAgICAgICAgICAvLyBBbGxvdyBhbGwgSFRNTCB0YWdzXG4gICAgICAgICAgICAgIG9wdGlvbnMuYWxsb3dlZENvbnRlbnQgPSB7XG4gICAgICAgICAgICAgICAgJDE6IHtcbiAgICAgICAgICAgICAgICAgIC8vIFVzZSB0aGUgYWJpbGl0eSB0byBzcGVjaWZ5IGVsZW1lbnRzIGFzIGFuIG9iamVjdC5cbiAgICAgICAgICAgICAgICAgIGVsZW1lbnRzOiB3aW5kb3cuQ0tFRElUT1IuZHRkLFxuICAgICAgICAgICAgICAgICAgYXR0cmlidXRlczogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgIHN0eWxlczogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgIGNsYXNzZXM6IHRydWVcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgIG9wdGlvbnMuZGlzYWxsb3dlZENvbnRlbnQgPSBcInNjcmlwdDsgKltvbipdXCI7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGN1cnJlbnRXaWRnZXQuY2tFZGl0b3JJbnN0YW5jZSA9IGN1cnJlbnRXaWRnZXRcbiAgICAgICAgICAgICAgLmdldENvbnRlbnRFbGVtZW50cygpXG4gICAgICAgICAgICAgIC5ja2VkaXRvcihvcHRpb25zKS5lZGl0b3I7XG4gICAgICAgICAgICBjdXJyZW50V2lkZ2V0Lm9wdGlvbnMuYXR0cmlidXRlVmFsdWUudmFsdWUgPSBjdXJyZW50V2lkZ2V0LmNrRWRpdG9ySW5zdGFuY2UuZ2V0RGF0YSgpO1xuICAgICAgICAgICAgYmluZEluaXRFdmVudCgpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGJpbmRfc3VwZXIoKTtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICBpZiAod2luZG93LmRjcC5sb2dnZXIpIHtcbiAgICAgICAgICB3aW5kb3cuZGNwLmxvZ2dlcihlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKGUpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIERlZmluZSBvcHRpb24gc2V0IGZvciBja0VkaXRvciB3aWRnZXRcbiAgICAgKiBAcmV0dXJucyB7e2xhbmd1YWdlOiBzdHJpbmcsIGNvbnRlbnRzQ3NzOiBzdHJpbmdbXSwgcmVtb3ZlUGx1Z2luczogc3RyaW5nLCB0b29sYmFyQ2FuQ29sbGFwc2U6IGJvb2xlYW4sIGVudGl0aWVzOiBib29sZWFuLCBmaWxlYnJvd3NlckltYWdlQnJvd3NlVXJsOiBzdHJpbmcsIGZpbGVicm93c2VySW1hZ2VVcGxvYWRVcmw6IHN0cmluZywgdG9vbGJhcl9GdWxsOiAqW10sIHRvb2xiYXJfRGVmYXVsdDogKltdLCB0b29sYmFyX1NpbXBsZTogKltdLCB0b29sYmFyX0Jhc2ljOiAqW10sIHJlbW92ZUJ1dHRvbnM6IHN0cmluZ319XG4gICAgICovXG4gICAgY2tPcHRpb25zOiBmdW5jdGlvbiB3SHRtbFRleHRDa09wdGlvbnMoY3NzUGF0aCkge1xuICAgICAgdmFyIGxvY2FsZSA9IHRoaXMub3B0aW9ucy5sb2NhbGU7XG4gICAgICB2YXIgaHJlZkJhc2UgPSAkKFwiaGVhZCBiYXNlXCIpLmF0dHIoXCJocmVmXCIpIHx8IFwiXCI7IC8vIG5vIHVzZSBkb2N1bWVudC5iYXNlVVJJIGJlY2F1c2UgZ2V0IGNvbXBsZXRlIHVybCBpZiBubyBiYXNlIGhyZWYgZGVmaW5lZFxuICAgICAgaWYgKHRoaXMub3B0aW9ucy5yZW5kZXJPcHRpb25zLnRvb2xiYXIpIHtcbiAgICAgICAgdGhpcy5vcHRpb25zLnJlbmRlck9wdGlvbnMuY2tFZGl0b3JDb25maWd1cmF0aW9uLnRvb2xiYXIgPSB0aGlzLm9wdGlvbnMucmVuZGVyT3B0aW9ucy50b29sYmFyO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMub3B0aW9ucy5yZW5kZXJPcHRpb25zLmhlaWdodCkge1xuICAgICAgICB0aGlzLm9wdGlvbnMucmVuZGVyT3B0aW9ucy5ja0VkaXRvckNvbmZpZ3VyYXRpb24uaGVpZ2h0ID0gdGhpcy5vcHRpb25zLnJlbmRlck9wdGlvbnMuaGVpZ2h0O1xuICAgICAgfVxuICAgICAgaWYgKCFfLmlzVW5kZWZpbmVkKHRoaXMub3B0aW9ucy5yZW5kZXJPcHRpb25zLnRvb2xiYXJTdGFydHVwRXhwYW5kZWQpKSB7XG4gICAgICAgIHRoaXMub3B0aW9ucy5yZW5kZXJPcHRpb25zLmNrRWRpdG9yQ29uZmlndXJhdGlvbi50b29sYmFyU3RhcnR1cEV4cGFuZGVkID0gdGhpcy5vcHRpb25zLnJlbmRlck9wdGlvbnMudG9vbGJhclN0YXJ0dXBFeHBhbmRlZDtcbiAgICAgIH1cbiAgICAgIHJldHVybiB7XG4gICAgICAgIGxhbmd1YWdlOiBsb2NhbGUuc3Vic3RyaW5nKDAsIDIpLFxuICAgICAgICBjb250ZW50c0NzczogW2Nzc1BhdGhdLFxuICAgICAgICByZW1vdmVQbHVnaW5zOiBcImVsZW1lbnRzcGF0aFwiLCAvLyBubyBzZWUgSFRNTCBwYXRoIGVsZW1lbnRzXG4gICAgICAgIGV4dHJhUGx1Z2luczpcbiAgICAgICAgICBcImExMXloZWxwLGFib3V0LGJhc2ljc3R5bGVzLGJsb2NrcXVvdGUsY2xpcGJvYXJkLGNvbG9yYnV0dG9uLGNvbnRleHRtZW51LGVsZW1lbnRzcGF0aCxlbnRlcmtleSxlbnRpdGllcyxmaWxlYnJvd3NlcixmbG9hdGluZ3NwYWNlLGZvbnQsZm9ybWF0LGhvcml6b250YWxydWxlLGh0bWx3cml0ZXIsaW1hZ2UsaW5kZW50bGlzdCxqdXN0aWZ5LGxpbmssbGlzdCxtYWdpY2xpbmUsbWF4aW1pemUscGFzdGVmcm9td29yZCxwYXN0ZXRleHQscmVtb3ZlZm9ybWF0LHJlc2l6ZSxzY2F5dCxzaG93Ym9yZGVycyxzb3VyY2VhcmVhLHNvdXJjZWRpYWxvZyxzcGVjaWFsY2hhcixzdHlsZXNjb21ibyx0YWIsdGFibGUsdGFibGV0b29scyx0b29sYmFyLHVuZG8sd3NjLHd5c2l3eWdhcmVhXCIsXG4gICAgICAgIHRvb2xiYXJDYW5Db2xsYXBzZTogdHJ1ZSxcbiAgICAgICAgZW50aXRpZXM6IGZhbHNlLCAvLyBubyB1c2UgSFRNTCBlbnRpdGllc1xuICAgICAgICBiYXNlSHJlZjogaHJlZkJhc2UsXG4gICAgICAgIHRpdGxlOiBcIlwiLFxuICAgICAgICB0b29sYmFyX0Z1bGw6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICBuYW1lOiBcImRvY3VtZW50XCIsXG4gICAgICAgICAgICBpdGVtczogW1xuICAgICAgICAgICAgICBcIlNvdXJjZWRpYWxvZ1wiLFxuICAgICAgICAgICAgICBcIi1cIixcbiAgICAgICAgICAgICAgXCJOZXdQYWdlXCIsXG4gICAgICAgICAgICAgIFwiRG9jUHJvcHNcIixcbiAgICAgICAgICAgICAgXCJQcmV2aWV3XCIsXG4gICAgICAgICAgICAgIFwiUHJpbnRcIixcbiAgICAgICAgICAgICAgXCItXCIsXG4gICAgICAgICAgICAgIFwiVGVtcGxhdGVzXCJcbiAgICAgICAgICAgIF1cbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIG5hbWU6IFwiY2xpcGJvYXJkXCIsXG4gICAgICAgICAgICBpdGVtczogW1xuICAgICAgICAgICAgICBcIkN1dFwiLFxuICAgICAgICAgICAgICBcIkNvcHlcIixcbiAgICAgICAgICAgICAgXCJQYXN0ZVwiLFxuICAgICAgICAgICAgICBcIlBhc3RlVGV4dFwiLFxuICAgICAgICAgICAgICBcIlBhc3RlRnJvbVdvcmRcIixcbiAgICAgICAgICAgICAgXCItXCIsXG4gICAgICAgICAgICAgIFwiVW5kb1wiLFxuICAgICAgICAgICAgICBcIlJlZG9cIlxuICAgICAgICAgICAgXVxuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgbmFtZTogXCJlZGl0aW5nXCIsXG4gICAgICAgICAgICBpdGVtczogW1wiRmluZFwiLCBcIlJlcGxhY2VcIiwgXCItXCIsIFwiU2VsZWN0QWxsXCIsIFwiLVwiXVxuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgbmFtZTogXCJmb3Jtc1wiLFxuICAgICAgICAgICAgaXRlbXM6IFtcbiAgICAgICAgICAgICAgXCJGb3JtXCIsXG4gICAgICAgICAgICAgIFwiQ2hlY2tib3hcIixcbiAgICAgICAgICAgICAgXCJSYWRpb1wiLFxuICAgICAgICAgICAgICBcIlRleHRGaWVsZFwiLFxuICAgICAgICAgICAgICBcIlRleHRhcmVhXCIsXG4gICAgICAgICAgICAgIFwiU2VsZWN0XCIsXG4gICAgICAgICAgICAgIFwiQnV0dG9uXCIsXG4gICAgICAgICAgICAgIFwiSW1hZ2VCdXR0b25cIixcbiAgICAgICAgICAgICAgXCJIaWRkZW5GaWVsZFwiXG4gICAgICAgICAgICBdXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcIi9cIixcbiAgICAgICAgICB7XG4gICAgICAgICAgICBuYW1lOiBcImJhc2ljc3R5bGVzXCIsXG4gICAgICAgICAgICBpdGVtczogW1xuICAgICAgICAgICAgICBcIkJvbGRcIixcbiAgICAgICAgICAgICAgXCJJdGFsaWNcIixcbiAgICAgICAgICAgICAgXCJVbmRlcmxpbmVcIixcbiAgICAgICAgICAgICAgXCJTdHJpa2VcIixcbiAgICAgICAgICAgICAgXCJTdWJzY3JpcHRcIixcbiAgICAgICAgICAgICAgXCJTdXBlcnNjcmlwdFwiLFxuICAgICAgICAgICAgICBcIi1cIixcbiAgICAgICAgICAgICAgXCJSZW1vdmVGb3JtYXRcIlxuICAgICAgICAgICAgXVxuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgbmFtZTogXCJwYXJhZ3JhcGhcIixcbiAgICAgICAgICAgIGl0ZW1zOiBbXG4gICAgICAgICAgICAgIFwiTnVtYmVyZWRMaXN0XCIsXG4gICAgICAgICAgICAgIFwiQnVsbGV0ZWRMaXN0XCIsXG4gICAgICAgICAgICAgIFwiLVwiLFxuICAgICAgICAgICAgICBcIk91dGRlbnRcIixcbiAgICAgICAgICAgICAgXCJJbmRlbnRcIixcbiAgICAgICAgICAgICAgXCItXCIsXG4gICAgICAgICAgICAgIFwiQmxvY2txdW90ZVwiLFxuICAgICAgICAgICAgICBcIkNyZWF0ZURpdlwiLFxuICAgICAgICAgICAgICBcIi1cIixcbiAgICAgICAgICAgICAgXCJKdXN0aWZ5TGVmdFwiLFxuICAgICAgICAgICAgICBcIkp1c3RpZnlDZW50ZXJcIixcbiAgICAgICAgICAgICAgXCJKdXN0aWZ5UmlnaHRcIixcbiAgICAgICAgICAgICAgXCJKdXN0aWZ5QmxvY2tcIixcbiAgICAgICAgICAgICAgXCItXCIsXG4gICAgICAgICAgICAgIFwiQmlkaUx0clwiLFxuICAgICAgICAgICAgICBcIkJpZGlSdGxcIlxuICAgICAgICAgICAgXVxuICAgICAgICAgIH0sXG4gICAgICAgICAgeyBuYW1lOiBcImxpbmtzXCIsIGl0ZW1zOiBbXCJMaW5rXCIsIFwiVW5saW5rXCJdIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgbmFtZTogXCJpbnNlcnRcIixcbiAgICAgICAgICAgIGl0ZW1zOiBbXG4gICAgICAgICAgICAgIFwiSW1hZ2VcIixcbiAgICAgICAgICAgICAgXCJUYWJsZVwiLFxuICAgICAgICAgICAgICBcIkhvcml6b250YWxSdWxlXCIsXG4gICAgICAgICAgICAgIFwiU21pbGV5XCIsXG4gICAgICAgICAgICAgIFwiU3BlY2lhbENoYXJcIixcbiAgICAgICAgICAgICAgXCJQYWdlQnJlYWtcIixcbiAgICAgICAgICAgICAgXCJJZnJhbWVcIlxuICAgICAgICAgICAgXVxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCIvXCIsXG4gICAgICAgICAgeyBuYW1lOiBcInN0eWxlc1wiLCBpdGVtczogW1wiU3R5bGVzXCIsIFwiRm9ybWF0XCIsIFwiRm9udFwiLCBcIkZvbnRTaXplXCJdIH0sXG4gICAgICAgICAgeyBuYW1lOiBcImNvbG9yc1wiLCBpdGVtczogW1wiVGV4dENvbG9yXCIsIFwiQkdDb2xvclwiXSB9LFxuICAgICAgICAgIHsgbmFtZTogXCJ0b29sc1wiLCBpdGVtczogW1wiTWF4aW1pemVcIiwgXCJTaG93QmxvY2tzXCIsIFwiLVwiLCBcIkFib3V0XCJdIH1cbiAgICAgICAgXSxcbiAgICAgICAgdG9vbGJhcl9EZWZhdWx0OiBbXG4gICAgICAgICAgeyBuYW1lOiBcImRvY3VtZW50XCIsIGl0ZW1zOiBbXCJTb3VyY2VkaWFsb2dcIl0gfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICBuYW1lOiBcImNsaXBib2FyZFwiLFxuICAgICAgICAgICAgaXRlbXM6IFtcbiAgICAgICAgICAgICAgXCJDdXRcIixcbiAgICAgICAgICAgICAgXCJDb3B5XCIsXG4gICAgICAgICAgICAgIFwiUGFzdGVcIixcbiAgICAgICAgICAgICAgXCJQYXN0ZVRleHRcIixcbiAgICAgICAgICAgICAgXCJQYXN0ZUZyb21Xb3JkXCIsXG4gICAgICAgICAgICAgIFwiLVwiLFxuICAgICAgICAgICAgICBcIlVuZG9cIixcbiAgICAgICAgICAgICAgXCJSZWRvXCJcbiAgICAgICAgICAgIF1cbiAgICAgICAgICB9LFxuICAgICAgICAgIHsgbmFtZTogXCJlZGl0aW5nXCIsIGl0ZW1zOiBbXCJGaW5kXCIsIFwiUmVwbGFjZVwiLCBcIi1cIiwgXCJTZWxlY3RBbGxcIl0gfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICBuYW1lOiBcImJhc2ljc3R5bGVzXCIsXG4gICAgICAgICAgICBpdGVtczogW1xuICAgICAgICAgICAgICBcIkJvbGRcIixcbiAgICAgICAgICAgICAgXCJJdGFsaWNcIixcbiAgICAgICAgICAgICAgXCJVbmRlcmxpbmVcIixcbiAgICAgICAgICAgICAgXCJTdHJpa2VcIixcbiAgICAgICAgICAgICAgXCJTdWJzY3JpcHRcIixcbiAgICAgICAgICAgICAgXCJTdXBlcnNjcmlwdFwiLFxuICAgICAgICAgICAgICBcIi1cIixcbiAgICAgICAgICAgICAgXCJSZW1vdmVGb3JtYXRcIlxuICAgICAgICAgICAgXVxuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgbmFtZTogXCJwYXJhZ3JhcGhcIixcbiAgICAgICAgICAgIGl0ZW1zOiBbXG4gICAgICAgICAgICAgIFwiTnVtYmVyZWRMaXN0XCIsXG4gICAgICAgICAgICAgIFwiQnVsbGV0ZWRMaXN0XCIsXG4gICAgICAgICAgICAgIFwiLVwiLFxuICAgICAgICAgICAgICBcIk91dGRlbnRcIixcbiAgICAgICAgICAgICAgXCJJbmRlbnRcIixcbiAgICAgICAgICAgICAgXCItXCIsXG4gICAgICAgICAgICAgIFwiQmxvY2txdW90ZVwiLFxuICAgICAgICAgICAgICBcIkNyZWF0ZURpdlwiLFxuICAgICAgICAgICAgICBcIi1cIixcbiAgICAgICAgICAgICAgXCJKdXN0aWZ5TGVmdFwiLFxuICAgICAgICAgICAgICBcIkp1c3RpZnlDZW50ZXJcIixcbiAgICAgICAgICAgICAgXCJKdXN0aWZ5UmlnaHRcIixcbiAgICAgICAgICAgICAgXCJKdXN0aWZ5QmxvY2tcIixcbiAgICAgICAgICAgICAgXCItXCIsXG4gICAgICAgICAgICAgIFwiQmlkaUx0clwiLFxuICAgICAgICAgICAgICBcIkJpZGlSdGxcIlxuICAgICAgICAgICAgXVxuICAgICAgICAgIH0sXG4gICAgICAgICAgeyBuYW1lOiBcImxpbmtzXCIsIGl0ZW1zOiBbXCJMaW5rXCIsIFwiVW5saW5rXCJdIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgbmFtZTogXCJpbnNlcnRcIixcbiAgICAgICAgICAgIGl0ZW1zOiBbXG4gICAgICAgICAgICAgIFwiSW1hZ2VcIixcbiAgICAgICAgICAgICAgXCJUYWJsZVwiLFxuICAgICAgICAgICAgICBcIkhvcml6b250YWxSdWxlXCIsXG4gICAgICAgICAgICAgIFwiU3BlY2lhbENoYXJcIixcbiAgICAgICAgICAgICAgXCJQYWdlQnJlYWtcIixcbiAgICAgICAgICAgICAgXCJJZnJhbWVcIlxuICAgICAgICAgICAgXVxuICAgICAgICAgIH0sXG4gICAgICAgICAgeyBuYW1lOiBcInN0eWxlc1wiLCBpdGVtczogW1wiU3R5bGVzXCIsIFwiRm9ybWF0XCIsIFwiRm9udFwiLCBcIkZvbnRTaXplXCJdIH0sXG4gICAgICAgICAgeyBuYW1lOiBcImNvbG9yc1wiLCBpdGVtczogW1wiVGV4dENvbG9yXCIsIFwiQkdDb2xvclwiXSB9LFxuICAgICAgICAgIHsgbmFtZTogXCJ0b29sc1wiLCBpdGVtczogW1wiTWF4aW1pemVcIiwgXCJTaG93QmxvY2tzXCIsIFwiLVwiLCBcIkFib3V0XCJdIH1cbiAgICAgICAgXSxcbiAgICAgICAgdG9vbGJhcl9TaW1wbGU6IFtcbiAgICAgICAgICB7IG5hbWU6IFwiZG9jdW1lbnRcIiwgaXRlbXM6IFtdIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgbmFtZTogXCJiYXNpY3N0eWxlc1wiLFxuICAgICAgICAgICAgaXRlbXM6IFtcbiAgICAgICAgICAgICAgXCJCb2xkXCIsXG4gICAgICAgICAgICAgIFwiSXRhbGljXCIsXG4gICAgICAgICAgICAgIFwiVW5kZXJsaW5lXCIsXG4gICAgICAgICAgICAgIFwiU3RyaWtlXCIsXG4gICAgICAgICAgICAgIFwiLVwiLFxuICAgICAgICAgICAgICBcIlJlbW92ZUZvcm1hdFwiXG4gICAgICAgICAgICBdXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICBuYW1lOiBcInBhcmFncmFwaFwiLFxuICAgICAgICAgICAgaXRlbXM6IFtcbiAgICAgICAgICAgICAgXCJOdW1iZXJlZExpc3RcIixcbiAgICAgICAgICAgICAgXCJCdWxsZXRlZExpc3RcIixcbiAgICAgICAgICAgICAgXCItXCIsXG4gICAgICAgICAgICAgIFwiT3V0ZGVudFwiLFxuICAgICAgICAgICAgICBcIkluZGVudFwiLFxuICAgICAgICAgICAgICBcIi1cIixcbiAgICAgICAgICAgICAgXCItXCIsXG4gICAgICAgICAgICAgIFwiSnVzdGlmeUxlZnRcIixcbiAgICAgICAgICAgICAgXCJKdXN0aWZ5Q2VudGVyXCIsXG4gICAgICAgICAgICAgIFwiSnVzdGlmeVJpZ2h0XCIsXG4gICAgICAgICAgICAgIFwiSnVzdGlmeUJsb2NrXCJcbiAgICAgICAgICAgIF1cbiAgICAgICAgICB9LFxuICAgICAgICAgIHsgbmFtZTogXCJsaW5rc1wiLCBpdGVtczogW1wiTGlua1wiLCBcIlVubGlua1wiXSB9LFxuICAgICAgICAgIHsgbmFtZTogXCJpbnNlcnRcIiwgaXRlbXM6IFtcIkltYWdlXCIsIFwiVGFibGVcIiwgXCJTcGVjaWFsQ2hhclwiXSB9LFxuICAgICAgICAgIHsgbmFtZTogXCJzdHlsZXNcIiwgaXRlbXM6IFtcIkZvcm1hdFwiLCBcIkZvbnRTaXplXCJdIH0sXG4gICAgICAgICAgeyBuYW1lOiBcImNvbG9yc1wiLCBpdGVtczogW1wiVGV4dENvbG9yXCIsIFwiQkdDb2xvclwiXSB9LFxuICAgICAgICAgIHsgbmFtZTogXCJ0b29sc1wiLCBpdGVtczogW1wiTWF4aW1pemVcIiwgXCJTb3VyY2VkaWFsb2dcIiwgXCItXCIsIFwiQWJvdXRcIl0gfVxuICAgICAgICBdLFxuICAgICAgICB0b29sYmFyX0Jhc2ljOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgbmFtZTogXCJsaW5rc1wiLFxuICAgICAgICAgICAgaXRlbXM6IFtcbiAgICAgICAgICAgICAgXCJCb2xkXCIsXG4gICAgICAgICAgICAgIFwiSXRhbGljXCIsXG4gICAgICAgICAgICAgIFwiLVwiLFxuICAgICAgICAgICAgICBcIk51bWJlcmVkTGlzdFwiLFxuICAgICAgICAgICAgICBcIkJ1bGxldGVkTGlzdFwiLFxuICAgICAgICAgICAgICBcIi1cIixcbiAgICAgICAgICAgICAgXCJMaW5rXCIsXG4gICAgICAgICAgICAgIFwiVW5saW5rXCIsXG4gICAgICAgICAgICAgIFwiLVwiLFxuICAgICAgICAgICAgICBcIk1heGltaXplXCIsXG4gICAgICAgICAgICAgIFwiQWJvdXRcIlxuICAgICAgICAgICAgXVxuICAgICAgICAgIH1cbiAgICAgICAgXSxcbiAgICAgICAgcmVtb3ZlQnV0dG9uczogXCJcIlxuICAgICAgfTtcbiAgICB9LFxuXG4gICAgX2luaXRFdmVudDogZnVuY3Rpb24gX2luaXRFdmVudCgpIHtcbiAgICAgIHZhciBjdXJyZW50V2lkZ2V0ID0gdGhpcztcbiAgICAgIHRoaXMuX3N1cGVyKCk7XG4gICAgICBpZiAodGhpcy5ja0VkaXRvckluc3RhbmNlKSB7XG4gICAgICAgIHRoaXMuY2tFZGl0b3JJbnN0YW5jZS5vbihcImNoYW5nZVwiLCBmdW5jdGlvbiB3SHRtbHRleHRfY2hhbmdlKCkge1xuICAgICAgICAgIGN1cnJlbnRXaWRnZXQuc2V0VmFsdWUoeyB2YWx1ZTogdGhpcy5nZXREYXRhKCkgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuY2tFZGl0b3JJbnN0YW5jZS5vbihcImZvY3VzXCIsIGZ1bmN0aW9uIHdIdG1sdGV4dF9mb2N1cygpIHtcbiAgICAgICAgICB2YXIga3RUYXJnZXQgPSBjdXJyZW50V2lkZ2V0LmVsZW1lbnQuZmluZChcIi5pbnB1dC1ncm91cFwiKTtcbiAgICAgICAgICBjdXJyZW50V2lkZ2V0LnNob3dJbnB1dFRvb2x0aXAoa3RUYXJnZXQpO1xuICAgICAgICAgIGN1cnJlbnRXaWRnZXQuZWxlbWVudC5maW5kKFwiLmNrZVwiKS5hZGRDbGFzcyhcImstc3RhdGUtZm9jdXNlZFwiKTtcbiAgICAgICAgICBjdXJyZW50V2lkZ2V0LmVsZW1lbnRcbiAgICAgICAgICAgIC5jbG9zZXN0KFwiLmRjcEF0dHJpYnV0ZV9fY29udGVudFwiKVxuICAgICAgICAgICAgLmFkZENsYXNzKFwiZGNwQXR0cmlidXRlLS1mb2N1c1wiKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5ja0VkaXRvckluc3RhbmNlLm9uKFwiYmx1clwiLCBmdW5jdGlvbiB3SHRtbHRleHRfYmx1cigpIHtcbiAgICAgICAgICB2YXIga3RUYXJnZXQgPSBjdXJyZW50V2lkZ2V0LmVsZW1lbnQuZmluZChcIi5pbnB1dC1ncm91cFwiKTtcbiAgICAgICAgICBjdXJyZW50V2lkZ2V0LmhpZGVJbnB1dFRvb2x0aXAoa3RUYXJnZXQpO1xuICAgICAgICAgIGN1cnJlbnRXaWRnZXQuZWxlbWVudC5maW5kKFwiLmNrZVwiKS5yZW1vdmVDbGFzcyhcImstc3RhdGUtZm9jdXNlZFwiKTtcbiAgICAgICAgICBjdXJyZW50V2lkZ2V0LmVsZW1lbnRcbiAgICAgICAgICAgIC5jbG9zZXN0KFwiLmRjcEF0dHJpYnV0ZV9fY29udGVudFwiKVxuICAgICAgICAgICAgLnJlbW92ZUNsYXNzKFwiZGNwQXR0cmlidXRlLS1mb2N1c1wiKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5ja0VkaXRvckluc3RhbmNlLm9uKFwiaW5zdGFuY2VSZWFkeVwiLCBmdW5jdGlvbiB3SHRtbHRleHRfbG9hZGVkKCkge1xuICAgICAgICAgIGN1cnJlbnRXaWRnZXQuX3RyaWdnZXIoXCJ3aWRnZXRSZWFkeVwiKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5lbGVtZW50Lm9uKFxuICAgICAgICAgIFwicG9zdE1vdmVkXCIgKyB0aGlzLmV2ZW50TmFtZXNwYWNlLFxuICAgICAgICAgIGZ1bmN0aW9uIHdIdG1sVGV4dE9uUG9zdE1vdmVkKGV2ZW50LCBldmVudERhdGEpIHtcbiAgICAgICAgICAgIGlmIChldmVudERhdGEgJiYgZXZlbnREYXRhLnRvID09PSBjdXJyZW50V2lkZ2V0Lm9wdGlvbnMuaW5kZXgpIHtcbiAgICAgICAgICAgICAgY3VycmVudFdpZGdldC5yZWRyYXcoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIC8vSWYgd2UgYXJlIG5vdCBpbiBDS0VESVRPUiBtb2RlLCB3ZSB0YWtlIGNhcmUgb2YgYW5jaG9yIGFuZCByZWRpcmVjdCBpdFxuICAgICAgaWYgKHRoaXMuZ2V0TW9kZSgpICE9PSBcIndyaXRlXCIpIHtcbiAgICAgICAgdGhpcy5lbGVtZW50Lm9uKFxuICAgICAgICAgIFwiY2xpY2suXCIgKyB0aGlzLmV2ZW50TmFtZXNwYWNlLFxuICAgICAgICAgICdhOm5vdChbaHJlZl49XCIjYWN0aW9uL1wiXSk6bm90KFtkYXRhLWFjdGlvbl0pJyxcbiAgICAgICAgICBmdW5jdGlvbiB3SHRtbEFuY2hvckNsaWNrKGV2ZW50KSB7XG4gICAgICAgICAgICB2YXIgaW50ZXJuYWxFdmVudCA9IHsgcHJldmVudDogZmFsc2UgfSxcbiAgICAgICAgICAgICAgYW5jaG9yID0gdGhpcyxcbiAgICAgICAgICAgICAgJGFuY2hvciA9ICQodGhpcyksXG4gICAgICAgICAgICAgIGlzTm90UHJldmVudGVkLFxuICAgICAgICAgICAgICBhbmNob3JzQ29uZmlnLFxuICAgICAgICAgICAgICBhbmNob3JzVGFyZ2V0LFxuICAgICAgICAgICAgICB3RmVhdHVyZSA9IFwiXCIsXG4gICAgICAgICAgICAgIGhyZWYsXG4gICAgICAgICAgICAgIGRjcFdpbmRvdztcblxuICAgICAgICAgICAgaWYgKGV2ZW50LnN0b3BQcm9wYWdhdGlvbikge1xuICAgICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgICAgIGFuY2hvcnNDb25maWcgPSBfLmV4dGVuZChcbiAgICAgICAgICAgICAge30sXG4gICAgICAgICAgICAgIGN1cnJlbnRXaWRnZXQub3B0aW9ucy5yZW5kZXJPcHRpb25zLmFuY2hvcnNcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIGlzTm90UHJldmVudGVkID0gY3VycmVudFdpZGdldC5fdHJpZ2dlcihcbiAgICAgICAgICAgICAgXCJhbmNob3JDbGlja1wiLFxuICAgICAgICAgICAgICBpbnRlcm5hbEV2ZW50LFxuICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgJGVsOiBjdXJyZW50V2lkZ2V0LmVsZW1lbnQsXG4gICAgICAgICAgICAgICAgaW5kZXg6IGN1cnJlbnRXaWRnZXQuX2dldEluZGV4KCksXG4gICAgICAgICAgICAgICAgb3B0aW9uczoge1xuICAgICAgICAgICAgICAgICAgYW5jaG9yOiBhbmNob3IsXG4gICAgICAgICAgICAgICAgICBhbmNob3JzQ29uZmlnOiBhbmNob3JzQ29uZmlnXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgaWYgKGlzTm90UHJldmVudGVkKSB7XG4gICAgICAgICAgICAgIHZhciAkYmFzZSA9ICQoXCJiYXNlXCIpO1xuICAgICAgICAgICAgICB2YXIgaXNBYnNVcmwgPSBuZXcgUmVnRXhwKFwiXig/OlthLXpdKzopPy8vXCIsIFwiaVwiKTtcblxuICAgICAgICAgICAgICBhbmNob3JzVGFyZ2V0ID0gYW5jaG9yc0NvbmZpZy50YXJnZXQgfHwgXCJfYmxhbmtcIjtcbiAgICAgICAgICAgICAgaHJlZiA9IGFuY2hvci5ocmVmO1xuXG4gICAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgICAkYW5jaG9yLmF0dHIoXCJocmVmXCIpICYmXG4gICAgICAgICAgICAgICAgJGFuY2hvci5hdHRyKFwiaHJlZlwiKS5zdWJzdHJpbmcoMCwgMSkgPT09IFwiI1wiXG4gICAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgIGhyZWYgPVxuICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLnByb3RvY29sICtcbiAgICAgICAgICAgICAgICAgIFwiLy9cIiArXG4gICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaG9zdG5hbWUgK1xuICAgICAgICAgICAgICAgICAgKHdpbmRvdy5sb2NhdGlvbi5wb3J0ID8gXCI6XCIgKyB3aW5kb3cubG9jYXRpb24ucG9ydCA6IFwiXCIpICtcbiAgICAgICAgICAgICAgICAgICh3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUgPyB3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUgOiBcIi9cIikgK1xuICAgICAgICAgICAgICAgICAgKHdpbmRvdy5sb2NhdGlvbi5zZWFyY2ggPyB3aW5kb3cubG9jYXRpb24uc2VhcmNoIDogXCJcIikgK1xuICAgICAgICAgICAgICAgICAgJGFuY2hvci5hdHRyKFwiaHJlZlwiKTtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIHN3aXRjaCAoYW5jaG9yc1RhcmdldCkge1xuICAgICAgICAgICAgICAgIGNhc2UgXCJfZGlhbG9nXCI6XG4gICAgICAgICAgICAgICAgICBpZiAoY3VycmVudFdpZGdldC5wb3B1cFdpbmRvd3NbaHJlZl0pIHtcbiAgICAgICAgICAgICAgICAgICAgZGNwV2luZG93ID0gY3VycmVudFdpZGdldC5wb3B1cFdpbmRvd3NbaHJlZl07XG4gICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBkY3BXaW5kb3cgPSAkKFwiPGRpdi8+XCIpXG4gICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZFRvKFwiYm9keVwiKVxuICAgICAgICAgICAgICAgICAgICAgIC5kY3BXaW5kb3coe1xuICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IGFuY2hvcnNDb25maWcud2luZG93V2lkdGgsXG4gICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IGFuY2hvcnNDb25maWcud2luZG93SGVpZ2h0LFxuICAgICAgICAgICAgICAgICAgICAgICAgbW9kYWw6IGFuY2hvcnNDb25maWcubW9kYWwsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50OiBocmVmLFxuICAgICAgICAgICAgICAgICAgICAgICAgaWZyYW1lOiB0cnVlXG4gICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgY3VycmVudFdpZGdldC5wb3B1cFdpbmRvd3NbaHJlZl0gPSBkY3BXaW5kb3c7XG4gICAgICAgICAgICAgICAgICAgIGRjcFdpbmRvd1xuICAgICAgICAgICAgICAgICAgICAgIC5kYXRhKFwiZGNwV2luZG93XCIpXG4gICAgICAgICAgICAgICAgICAgICAgLmtlbmRvV2luZG93KClcbiAgICAgICAgICAgICAgICAgICAgICAuY2VudGVyKCk7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICBkY3BXaW5kb3cuZGF0YShcImRjcFdpbmRvd1wiKS5vcGVuKCk7XG4gICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwiX3NlbGZcIjpcbiAgICAgICAgICAgICAgICAgIC8vIEZvciBJRSA6IE5vdCBob25vciBiYXNlIGhyZWYgaW4gdGhpcyBjYXNlXG4gICAgICAgICAgICAgICAgICBpZiAoIWlzQWJzVXJsLnRlc3QoaHJlZikpIHtcbiAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSAkYmFzZS5hdHRyKFwiaHJlZlwiKSArIGhyZWY7XG4gICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IGhyZWY7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgaWYgKGFuY2hvcnNDb25maWcud2luZG93V2lkdGggfHwgYW5jaG9yc0NvbmZpZy53aW5kb3dIZWlnaHQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFuY2hvcnNDb25maWcud2luZG93V2lkdGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICB3RmVhdHVyZSArPVxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ3aWR0aD1cIiArXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJzZUludChhbmNob3JzQ29uZmlnLndpbmRvd1dpZHRoLCAxMCkgK1xuICAgICAgICAgICAgICAgICAgICAgICAgXCIsXCI7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKGFuY2hvcnNDb25maWcud2luZG93SGVpZ2h0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgd0ZlYXR1cmUgKz1cbiAgICAgICAgICAgICAgICAgICAgICAgIFwiaGVpZ2h0PVwiICtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlSW50KGFuY2hvcnNDb25maWcud2luZG93SGVpZ2h0LCAxMCkgK1xuICAgICAgICAgICAgICAgICAgICAgICAgXCIsXCI7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgd0ZlYXR1cmUgKz0gXCJyZXNpemFibGU9eWVzLHNjcm9sbGJhcnM9eWVzXCI7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICBpZiAoIWlzQWJzVXJsLnRlc3QoaHJlZikpIHtcbiAgICAgICAgICAgICAgICAgICAgaHJlZiA9ICRiYXNlLmF0dHIoXCJocmVmXCIpICsgaHJlZjtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIHdpbmRvdy5vcGVuKGhyZWYsIGFuY2hvcnNUYXJnZXQsIHdGZWF0dXJlKTtcbiAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICApO1xuICAgICAgfVxuICAgIH0sXG4gICAgLyoqXG4gICAgICogRGVmaW5lIGlucHV0cyBmb3IgZm9jdXNcbiAgICAgKiBAcHJvdGVjdGVkXG4gICAgICovXG4gICAgX2dldEZvY3VzSW5wdXQ6IGZ1bmN0aW9uIHdIdG1sdGV4dF9nZXRGb2N1c0lucHV0KCkge1xuICAgICAgcmV0dXJuIHRoaXMuZWxlbWVudDtcbiAgICB9LFxuICAgIC8qKlxuICAgICAqIE5vIHVzZSBwYXJlbnQgY2hhbmdlXG4gICAgICovXG4gICAgX2luaXRDaGFuZ2VFdmVudDogZnVuY3Rpb24gd0h0bWx0ZXh0X2luaXRDaGFuZ2VFdmVudCgpIHt9LFxuXG4gICAgZ2V0V2lkZ2V0VmFsdWU6IGZ1bmN0aW9uIHdIdG1sdGV4dF9nZXRXaWRnZXRWYWx1ZSgpIHtcbiAgICAgIHJldHVybiB0aGlzLmdldENvbnRlbnRFbGVtZW50cygpLnZhbCgpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBDaGFuZ2UgdGhlIHZhbHVlIG9mIHRoZSB3aWRnZXRcbiAgICAgKiBAcGFyYW0gdmFsdWVcbiAgICAgKi9cbiAgICBzZXRWYWx1ZTogZnVuY3Rpb24gd0h0bWx0ZXh0U2V0VmFsdWUodmFsdWUpIHtcbiAgICAgIHZhbHVlID0gXy5jbG9uZSh2YWx1ZSk7XG4gICAgICBpZiAodmFsdWUudmFsdWUgPT09IG51bGwpIHtcbiAgICAgICAgLy8gY2tFZGl0b3IgcmVzdG9yZSBvcmlnaW5hbCB2YWx1ZSBpZiBzZXQgdG8gbnVsbFxuICAgICAgICB2YWx1ZS52YWx1ZSA9IFwiXCI7XG4gICAgICB9XG4gICAgICBpZiAoXy5oYXModmFsdWUsIFwidmFsdWVcIikgJiYgIV8uaGFzKHZhbHVlLCBcImRpc3BsYXlWYWx1ZVwiKSkge1xuICAgICAgICB2YWx1ZS5kaXNwbGF5VmFsdWUgPSB2YWx1ZS52YWx1ZTtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLmdldE1vZGUoKSA9PT0gXCJ3cml0ZVwiKSB7XG4gICAgICAgIC8vIEZsYXNoIGVsZW1lbnQgb25seVxuICAgICAgICB2YXIgb3JpZ2luYWxWYWx1ZSA9IHRoaXMuY2tFZGl0b3JJbnN0YW5jZS5nZXREYXRhKCk7XG4gICAgICAgIC8vIDogZXhwbGljaXQgbGF6eSBlcXVhbFxuXG4gICAgICAgIC8vbm9pbnNwZWN0aW9uIEpTSGludFxuICAgICAgICBpZiAob3JpZ2luYWxWYWx1ZS50cmltKCkgIT0gdmFsdWUudmFsdWUudHJpbSgpKSB7XG4gICAgICAgICAgLy8gTW9kaWZ5IHZhbHVlIG9ubHkgaWYgZGlmZmVyZW50XG4gICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5pbmxpbmUpIHtcbiAgICAgICAgICAgIHRoaXMuZ2V0Q29udGVudEVsZW1lbnRzKCkuaHRtbCh2YWx1ZS52YWx1ZSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuZ2V0Q29udGVudEVsZW1lbnRzKCkudmFsKHZhbHVlLnZhbHVlKTtcbiAgICAgICAgICAgIHRoaXMuZmxhc2hFbGVtZW50KHRoaXMuZWxlbWVudC5maW5kKFwiaWZyYW1lXCIpKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAodGhpcy5nZXRNb2RlKCkgPT09IFwicmVhZFwiKSB7XG4gICAgICAgIHRoaXMuZ2V0Q29udGVudEVsZW1lbnRzKCkuaHRtbCh2YWx1ZS5kaXNwbGF5VmFsdWUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgIFwiQXR0cmlidXRlIFwiICsgdGhpcy5vcHRpb25zLmlkICsgXCIgdW5rbm93biBtb2RlIFwiICsgdGhpcy5nZXRNb2RlKClcbiAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgLy8gY2FsbCB3QXR0cmlidXRlOjpzZXRWYWx1ZSgpXG4gICAgICAkLmRjcC5kY3BBdHRyaWJ1dGUucHJvdG90eXBlLnNldFZhbHVlLmNhbGwodGhpcywgdmFsdWUpO1xuICAgIH0sXG5cbiAgICBnZXRUeXBlOiBmdW5jdGlvbiB3SHRtbHRleHRfZ2V0VHlwZSgpIHtcbiAgICAgIHJldHVybiBcImh0bWx0ZXh0XCI7XG4gICAgfSxcblxuICAgIF9kZXN0cm95OiBmdW5jdGlvbiB3SHRtbFRleHREZXN0cm95KCkge1xuICAgICAgdmFyIGN1cnJlbnRXaWRnZXQgPSB0aGlzO1xuICAgICAgaWYgKHRoaXMuY2tFZGl0b3JJbnN0YW5jZSAmJiB0aGlzLmNrRWRpdG9ySW5zdGFuY2UuZGVzdHJveSkge1xuICAgICAgICBpZiAoXG4gICAgICAgICAgdGhpcy5ja0VkaXRvckluc3RhbmNlLnN0YXR1cyA9PT0gXCJsb2FkZWRcIiB8fFxuICAgICAgICAgIHRoaXMuY2tFZGl0b3JJbnN0YW5jZS5zdGF0dXMgPT09IFwicmVhZHlcIlxuICAgICAgICApIHtcbiAgICAgICAgICB0aGlzLmNrRWRpdG9ySW5zdGFuY2UuZGVzdHJveSgpO1xuICAgICAgICAgIF8uZGVmZXIoZnVuY3Rpb24gd0h0bWx0ZXh0X2RlZmVyRGVzdHJveSgpIHtcbiAgICAgICAgICAgIGN1cnJlbnRXaWRnZXQuX2Rlc3Ryb3koKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5ja0VkaXRvckluc3RhbmNlLnN0YXR1cyA9PT0gXCJ1bmxvYWRlZFwiKSB7XG4gICAgICAgICAgdGhpcy5ja0VkaXRvckluc3RhbmNlLm9uKFwibG9hZGVkXCIsIGZ1bmN0aW9uIHdIdG1sdGV4dF9sb2FkZWQoKSB7XG4gICAgICAgICAgICBjdXJyZW50V2lkZ2V0Ll9kZXN0cm95KCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBfLmVhY2godGhpcy5wb3B1cFdpbmRvd3MsIGZ1bmN0aW9uIHdIdG1sdGV4dERlc3Ryb3lQb3B1cChwV2luZG93KSB7XG4gICAgICAgIHBXaW5kb3cuZGF0YShcImRjcFdpbmRvd1wiKS5kZXN0cm95KCk7XG4gICAgICB9KTtcbiAgICAgIHRoaXMuX3N1cGVyKCk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIFRyaWdnZXIgYSByZWFkeSBldmVudCB3aGVuIHdpZGdldCBpcyByZW5kZXJcbiAgICAgKi9cbiAgICBfdHJpZ2dlclJlYWR5OiBmdW5jdGlvbiB3QXR0cmlidXRlUmVhZHkoKSB7XG4gICAgICBpZiAodGhpcy5nZXRNb2RlKCkgIT09IFwid3JpdGVcIikge1xuICAgICAgICB0aGlzLl9zdXBlcigpO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG5cbiAgcmV0dXJuICQuZm4uZGNwSHRtbHRleHQ7XG59KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFDQSxXQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3S0FFQTtBQUNBO0FBQ0E7QUFDQSxpRkFFQTtBQUNBLHFCQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///98221531f3fb9af2dff1\n");

/***/ }),

/***/ "ab4ce4f91706f6c2712e":
/*!***************************************************!*\
  !*** ./src/Apps/DOCUMENT/IHM/models/mDocument.js ***!
  \***************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/*global define, console, require*/\n!(__WEBPACK_AMD_DEFINE_ARRAY__ = [\n  __webpack_require__(/*! jquery */ \"127c8cf59f228bb01a21\"),\n  __webpack_require__(/*! underscore */ \"8e08e542008e4aef1f58\"),\n  __webpack_require__(/*! backbone */ \"1858b45bf48591489d06\"),\n  __webpack_require__(/*! little-loader */ \"bcb63a5837345ee29aa0\"),\n  __webpack_require__(/*! dcpDocument/models/mDocumentProperties */ \"11e1c9c4ee0385434097\"),\n  __webpack_require__(/*! dcpDocument/models/mDocumentLock */ \"37746b3b205813560cd8\"),\n  __webpack_require__(/*! dcpDocument/models/mFamilyStructure */ \"2ea670d287981a202ee6\"),\n  __webpack_require__(/*! dcpDocument/collections/attributes */ \"fb3f606ecd8a48d7cad0\"),\n  __webpack_require__(/*! dcpDocument/collections/menus */ \"ff769b61d7927dad04ed\"),\n  __webpack_require__(/*! dcpDocument/i18n/documentCatalog */ \"278ba7757aa1904087c6\")\n], __WEBPACK_AMD_DEFINE_RESULT__ = (function mDocument(\n  $,\n  _,\n  Backbone,\n  load,\n  DocumentProperties,\n  DocumentLock,\n  FamilyStructure,\n  CollectionAttributes,\n  CollectionMenus,\n  i18n\n) {\n  \"use strict\";\n\n  var flattenAttributes = function mDocumentflattenAttributes(\n    currentAttributes,\n    attributes,\n    parent\n  ) {\n    if (!_.isArray(attributes)) {\n      attributes = _.values(attributes);\n    }\n    if (parent) {\n      _.each(attributes, function mDocumentEachflattenParentAttributes(value) {\n        value.parent = parent;\n      });\n    }\n    currentAttributes = _.union(currentAttributes, attributes);\n    _.each(attributes, function mDocumentEachflattenAttributes(currentAttr) {\n      if (currentAttr.content) {\n        currentAttributes = _.union(\n          currentAttributes,\n          flattenAttributes(\n            currentAttributes,\n            currentAttr.content,\n            currentAttr.id\n          )\n        );\n      }\n    });\n    return currentAttributes;\n  };\n\n  //noinspection JSValidateJSDoc\n  return Backbone.Model.extend({\n    typeModel: \"ddui:document\",\n    idAttribute: \"initid\",\n\n    defaults: {\n      revision: -1,\n      viewId: undefined,\n      renderMode: \"view\",\n      properties: undefined,\n      menus: undefined,\n      attributes: undefined\n    },\n    // Record custom data in model directly - not in model property because must not be reset by clear method\n    _customClientData: {},\n    _uploadingFile: 0,\n    /**\n     * Compute the REST URL for the current document\n     *\n     * Used internaly by backbone in fetch, save, destroy\n     *\n     * @returns {string}\n     */\n    url: function mDocumenturl() {\n      var urlData = \"api/v2/\",\n        viewId = this.get(\"viewId\");\n      var customClientData = this._customClientData;\n      var currentMethod = this.get(\"currentHttpMethod\");\n      var revision = this.get(\"revision\");\n\n      if (this.get(\"creationFamid\") && this.id === null) {\n        urlData +=\n          \"families/\" +\n          encodeURIComponent(this.get(\"creationFamid\")) +\n          \"/documentsViews/\";\n      } else {\n        urlData += \"documents/\" + encodeURIComponent(this.id);\n        //Don't add revision for the deletion of a alive document\n        if (revision !== null && currentMethod !== \"delete\") {\n          if (_.isObject(revision) && revision.state) {\n            urlData +=\n              \"/revisions/\" + encodeURIComponent(\"state:\" + revision.state);\n          } else if (revision >= 0) {\n            urlData += \"/revisions/\" + encodeURIComponent(revision);\n          }\n        }\n        if (viewId === undefined) {\n          if (this.get(\"renderMode\") === \"view\" || currentMethod === \"delete\") {\n            viewId = \"!defaultConsultation\";\n          } else if (this.get(\"renderMode\") === \"edit\") {\n            viewId = \"!defaultEdition\";\n          } else {\n            viewId = \"!defaultConsultation\";\n          }\n        }\n        if (currentMethod === \"delete\" && this.get(\"renderMode\") === \"edit\") {\n          viewId = \"!defaultConsultation\";\n        }\n        urlData += \"/views/\" + encodeURIComponent(viewId);\n      }\n\n      if (\n        !_.isEmpty(customClientData) &&\n        (currentMethod === \"read\" || currentMethod === \"delete\")\n      ) {\n        urlData +=\n          \"?customClientData=\" +\n          encodeURIComponent(JSON.stringify(customClientData));\n      }\n      return urlData;\n    },\n\n    /**\n     * override Backbone sync to record method\n     * @param method\n     * @param model\n     * @param options\n     * @returns {*}\n     */\n    sync: function mDocumentSync(method, model, options) {\n      this.set(\"currentHttpMethod\", method); // record for url method\n      options.attrs = this._customRequestData;\n      return Backbone.Model.prototype.sync.apply(this, arguments);\n    },\n    /**\n     * Initialize event handling\n     *\n     */\n    initialize: function mDocumentinitialize() {\n      var theModel = this;\n\n      this.listenTo(this, \"dduiDocumentFail\", this.propagateSynchroError);\n      this.listenTo(this, \"destroy\", this.destroySubcollection);\n      this.listenTo(this, \"destroy\", this.unbindLoadEvent);\n\n      $(window).on(\n        \"beforeunload.\" + this.cid,\n        function mDocumentBeforeUnload() {\n          var security = theModel.get(\"properties\")\n              ? theModel.get(\"properties\").get(\"security\")\n              : null,\n            event = { prevent: false };\n          if (theModel.hasAttributesChanged()) {\n            return i18n.___(\n              \"The form has been modified and is is not saved\",\n              \"ddui\"\n            );\n          }\n\n          theModel.trigger(\n            \"beforeClose\",\n            event,\n            theModel.getServerProperties(),\n            this._customClientData\n          );\n\n          if (event.prevent) {\n            return i18n.___(\"Unable to close the document\", \"ddui\");\n          }\n\n          if (\n            theModel.get(\"renderMode\") === \"edit\" &&\n            security &&\n            security.lock &&\n            security.lock.temporary\n          ) {\n            // No use model destroy : page is destroyed before request is some case\n            $.ajax({\n              url:\n                \"api/v2/documents/\" +\n                theModel.get(\"initid\") +\n                \"/locks/temporary\",\n              type: \"DELETE\",\n              async: false\n            });\n            theModel.set(\"unlocking\", true);\n          }\n        }\n      );\n\n      $(window).on(\"pagehide.\" + this.cid, function mDocumentPageHide(event) {\n        var security = theModel.get(\"properties\")\n          ? theModel.get(\"properties\").get(\"security\")\n          : null;\n        var unlocking = theModel.get(\"unlocking\");\n\n        theModel.trigger(\n          \"close\",\n          event,\n          theModel.getServerProperties(),\n          this._customClientData\n        );\n\n        if (\n          !unlocking &&\n          theModel.get(\"renderMode\") === \"edit\" &&\n          security &&\n          security.lock &&\n          security.lock.temporary\n        ) {\n          $.ajax({\n            url:\n              \"api/v2/documents/\" + theModel.get(\"initid\") + \"/locks/temporary\",\n            type: \"DELETE\",\n            async: false\n          });\n        }\n      });\n    },\n\n    /**\n     * Return a plain object of the current document for an usage in the view\n     *\n     * @returns {{document: {}}}\n     */\n    toData: function mDocumenttoData() {\n      var returnObject = {\n        document: {}\n      };\n      returnObject.document.properties = this.getServerProperties();\n      returnObject.menus = this.get(\"menus\").toJSON();\n      returnObject.templates = this.get(\"templates\");\n      return returnObject;\n    },\n\n    /**\n     * Return all the values of the current document\n     * @var onlyModified\n     * @returns {{}}\n     */\n    getValues: function mDocumentdocumentGetValues(onlyModified) {\n      var values = {};\n      if (!this.get(\"attributes\")) {\n        return values;\n      }\n      this.get(\"attributes\").each(function mDocumentGetValue(currentAttribute) {\n        var currentValue = currentAttribute.get(\"attributeValue\"),\n          i,\n          arrayValues = [];\n        if (\n          currentValue === null ||\n          !currentAttribute.get(\"isValueAttribute\")\n        ) {\n          return;\n        }\n        if (\n          onlyModified === true &&\n          currentAttribute.hasValueChanged() === false\n        ) {\n          return;\n        }\n        if (currentAttribute.get(\"multiple\")) {\n          currentValue = _.toArray(currentValue);\n          if (currentValue.length > 0) {\n            for (i = 0; i < currentValue.length; i += 1) {\n              arrayValues.push(currentValue[i] || { value: null });\n            }\n          } else {\n            arrayValues = []; //{value: null};\n          }\n          values[currentAttribute.id] = arrayValues;\n        } else {\n          values[currentAttribute.id] = currentValue;\n        }\n      });\n      return values;\n    },\n\n    /**\n     * reset all values with a new set of values\n     */\n    setValues: function mDocumentdocumentSetValues(values) {\n      this.get(\"attributes\").each(function mDocumentSetValue(currentAttribute) {\n        var newValue = values[currentAttribute.id];\n        if (!currentAttribute.get(\"isValueAttribute\")) {\n          return;\n        }\n        currentAttribute.set(\"attributeValue\", newValue);\n        // reset change also\n        currentAttribute.changed = {};\n      });\n    },\n\n    /**\n     * reset all properties with a new set of properties\n     */\n    setProperties: function mDocumentdocumentSetProperties(values) {\n      var model = this;\n      _.each(values, function mDocumentSetProperties(value, key) {\n        model.get(\"properties\").set(key, value);\n      });\n    },\n\n    lockDocument: function mDocumentLockDocument() {\n      var docModel = this;\n      var lockModel = new DocumentLock({\n        initid: this.get(\"initid\"),\n        type: \"permanent\"\n      });\n      var security = this.get(\"properties\").get(\"security\");\n      lockModel.save(\n        {},\n        {\n          success: function mDocumentLockDocumentSuccess(theModel, data) {\n            var menu = docModel.get(\"menus\");\n            security.lock = data.data.lock;\n            docModel.get(\"properties\").set(\"security,\", security);\n\n            menu.setMenu(\"lock\", \"visibility\", \"hidden\");\n            menu.setMenu(\"unlock\", \"visibility\", \"visible\");\n\n            docModel.get(\"properties\").trigger(\"change\");\n          },\n          error: function mDocumentLockDocumentError(theModel, HttpResponse) {\n            var response = JSON.parse(HttpResponse.responseText);\n\n            docModel.trigger(\"showError\", {\n              title: response.exceptionMessage\n            });\n          }\n        }\n      );\n    },\n\n    unlockDocument: function mDocumentUnLockDocument() {\n      var docModel = this;\n      //  type = empty means Delete all locks\n      var lockModel = new DocumentLock({\n        initid: this.get(\"initid\"),\n        type: \"\"\n      });\n      var security = this.get(\"properties\").get(\"security\");\n      lockModel.destroy({\n        success: function mDocumentUnLockDocumentSuccess() {\n          var menu = docModel.get(\"menus\");\n          security.lock = {\n            lockedBy: {\n              id: 0\n            }\n          };\n          docModel.get(\"properties\").set(\"security,\", security);\n\n          menu.setMenu(\"lock\", \"visibility\", \"visible\");\n          menu.setMenu(\"unlock\", \"visibility\", \"hidden\");\n          docModel.get(\"properties\").trigger(\"change\");\n        },\n        error: function mDocumentUnLockDocumentError(theModel, HttpResponse) {\n          var response = JSON.parse(HttpResponse.responseText);\n\n          docModel.trigger(\"showError\", {\n            title: response.exceptionMessage\n          });\n        }\n      });\n    },\n    /**\n     * Get a plain object with properties of the document\n     *\n     * @returns {*}\n     */\n    getModelProperties: function mDocumentdocumentGetProperties() {\n      var properties = {};\n      if (this.get(\"properties\")) {\n        properties = this.get(\"properties\").toJSON();\n      }\n      properties.initid = this.get(\"initid\");\n      properties.revision = this.get(\"revision\");\n      properties.viewId = this.get(\"viewId\");\n      properties.renderMode = this.get(\"renderMode\");\n\n      return properties;\n    },\n\n    /**\n     * Get the initial properties as transfered by the server\n     * @returns {*|{revision, viewId, renderMode, properties, menus, attributes}|{resizeMarginHeight, resizeMarginWidth, resizeDebounceTime, withoutResize, eventPrefix}|{content}|{title, isValueAttribute, parent, mode, errorMessage}|{documentId, documentModel, state, attributes}}\n     */\n    getServerProperties: function mDocument_getCurrentProperties() {\n      var properties;\n      properties = this.initialProperties;\n      if (properties) {\n        properties.hasUploadingFiles = this.hasUploadingFile();\n      }\n      return properties;\n    },\n\n    /**\n     * Indicate if one attribute of the document is modified\n     *\n     * @returns {*|boolean}\n     */\n    isModified: function mDocument_isModified() {\n      return this.hasAttributesChanged();\n    },\n\n    /**\n     * Get document properties, values and labels of attributes\n     */\n    getDocumentData: function mDocumentGetDocumentData() {\n      var documentData = {\n        properties: this.getModelProperties(),\n        attributeValues: this.getValues(false),\n        attributeLabels: {},\n        createAttributeView: function mDocumentGetDocumentDataCreate() {\n          return this.id;\n        }\n      };\n      this.get(\"attributes\").each(function mDocumentGetDocumentDataEach(\n        currentAttribute\n      ) {\n        documentData.attributeLabels[\n          currentAttribute.id\n        ] = currentAttribute.get(\"label\");\n      });\n      return documentData;\n    },\n    /**\n     * Return true if one the attribute of the document hasChanged\n     *\n     * @returns {boolean|*}\n     */\n    hasAttributesChanged: function mDocumenthasAttributesChanged() {\n      if (!this.get(\"attributes\")) {\n        return false;\n      }\n      return this.get(\"attributes\").some(\n        function mDocumenthasAttributesChangedSome(currentAttr) {\n          return currentAttr.hasValueChanged();\n        }\n      );\n    },\n\n    hasUploadingFile: function mdocumenthasUploadingFile() {\n      return this._uploadingFile > 0;\n    },\n\n    /**\n     * Analyze return in case of sync uncomplete and trigger event error\n     *\n     * @param model\n     * @param xhr\n     */\n    propagateSynchroError: function mDocumentpropagateSynchroError(model, xhr) {\n      var attrModel,\n        currentModel = this,\n        parsedReturn,\n        errorCode = null,\n        title = \"\",\n        properties;\n      //Analyze XHR\n      var messages = [];\n      var result;\n      try {\n        if (!xhr) {\n          if (model && model.message) {\n            messages.push({ type: \"error\", contentText: model.message });\n          }\n          xhr = { status: 500, statusText: \"Internal - No HTTP response\" };\n        } else {\n          result = JSON.parse(xhr.responseText);\n          if (result.message) {\n            messages.push(result);\n          } else if (result.messages) {\n            messages = result.messages;\n          }\n        }\n      } catch (e) {\n        //Unable to parse responseText (error is not in JSON)\n        this.cleanErrorMessages();\n        if (window.dcp.logger) {\n          window.dcp.logger(e);\n        } else {\n          console.error(e);\n        }\n        properties = currentModel.getServerProperties();\n        if (!properties || !properties.initid) {\n          //First loading, unable to load display reload iframe panel\n          currentModel.trigger(\"displayNetworkError\");\n          return;\n        }\n        //There is an initd, so there is a document\n        //We display a message and let the user try again\n        //Status 0 indicate offline browser\n        if (xhr && xhr.status === 0) {\n          currentModel.trigger(\"showError\", {\n            errorCode: \"offline\",\n            title: i18n.___(\"Your navigator seems offline, try later\", \"ddui\")\n          });\n        } else {\n          currentModel.trigger(\"showError\", {\n            errorCode: \"unableToParseJson\",\n            title: i18n.___(\"Server return unreadable\", \"ddui\")\n          });\n        }\n        currentModel.setProperties(properties);\n        this.trigger(\"dduiDocumentDisplayView\");\n        return;\n      }\n\n      parsedReturn = {\n        messages: messages || [],\n        responseText: \"Unexpected error: \" + xhr.status + \" \" + xhr.statusText\n      };\n\n      this.cleanErrorMessages();\n      if (parsedReturn.messages.length === 0) {\n        if (result && result.exceptionMessage) {\n          parsedReturn.responseText = result.exceptionMessage;\n        }\n\n        if (currentModel.get(\"properties\")) {\n          title = currentModel.get(\"properties\").get(\"title\");\n        }\n        currentModel.trigger(\"showError\", {\n          errorCode: errorCode,\n          title: i18n.___(\"Unexpected error \", \"ddui\") + \" : \" + title,\n          message: parsedReturn.responseText\n        });\n      }\n      _.each(\n        parsedReturn.messages,\n        function mDocumentpropagateSynchroErrorMessages(message) {\n          switch (message.code) {\n            case \"ROUTES0107\": // Syntax Error\n              if (message.data && message.data.id) {\n                attrModel = currentModel.get(\"attributes\").get(message.data.id);\n                if (attrModel) {\n                  attrModel.setErrorMessage(\n                    message.data.err,\n                    message.data.index\n                  );\n                  currentModel.trigger(\"showError\", {\n                    title: message.contentText,\n                    htmlMessage: message.contentHtml,\n                    message:\n                      attrModel.attributes.label + \" : \" + message.data.err,\n                    errorCode: message.code\n                  });\n                } else {\n                  currentModel.trigger(\"showError\", {\n                    title: message.contentText,\n                    htmlMessage: message.contentHtml,\n                    message: message.data.err,\n                    errorCode: message.code\n                  });\n                }\n              }\n              break;\n            case \"ROUTES0109\": // Constraint Error\n              if (message.data && message.data.constraint) {\n                _.each(\n                  message.data.constraint,\n                  function mDocumentpropagateSynchroError0212(constraint) {\n                    attrModel = currentModel\n                      .get(\"attributes\")\n                      .get(constraint.id);\n                    if (attrModel) {\n                      attrModel.setErrorMessage(\n                        constraint.err,\n                        constraint.index\n                      );\n                      currentModel.trigger(\"showError\", {\n                        title: message.contentText,\n                        htmlMessage: message.contentHtml,\n                        message:\n                          attrModel.attributes.label + \" : \" + constraint.err,\n                        errorCode: message.code\n                      });\n                    } else {\n                      currentModel.trigger(\"showError\", {\n                        title: message.contentText,\n                        htmlMessage: message.contentHtml,\n                        message: constraint.err,\n                        errorCode: message.code\n                      });\n                    }\n                  }\n                );\n              }\n              if (message.data && message.data.preStore) {\n                currentModel.trigger(\"showError\", {\n                  title: message.contentText,\n                  htmlMessage: message.contentHtml,\n                  message: message.data.preStore,\n                  errorCode: message.code\n                });\n              }\n              break;\n\n            default:\n              if (message.exceptionMessage) {\n                currentModel.trigger(\"showError\", {\n                  title:\n                    message.message + \" \" + (message.code ? message.code : \"\"),\n                  errorCode: message.code\n                });\n              } else {\n                if (message.type === \"error\" && message.contentText) {\n                  currentModel.trigger(\"showError\", {\n                    title:\n                      message.contentText +\n                      \" \" +\n                      (message.code ? message.code : \"\"),\n                    type: message.type,\n                    message: message.contentText,\n                    htmlMessage: message.contentHtml,\n                    errorCode: message.code\n                  });\n                } else {\n                  if (message.type && message.contentText) {\n                    currentModel.trigger(\"showMessage\", {\n                      title:\n                        message.contentText +\n                        \" \" +\n                        (message.code ? message.code : \"\"),\n                      type: message.type,\n                      message: message.contentText,\n                      htmlMessage: message.contentHtml,\n                      errorCode: message.code\n                    });\n                  } else {\n                    console.error(\"Error\", message);\n                  }\n                }\n              }\n          }\n        }\n      );\n      this.trigger(\"dduiDocumentDisplayView\");\n    },\n\n    /**\n     * Validate the content of the model before synchro\n     */\n    validate: function mDocumentvalidate(documentElements, options) {\n      var success = true,\n        currentDocument = this,\n        errorMessage = [],\n        event = { prevent: false },\n        templateMessage,\n        error;\n      try {\n        this.trigger(\"validate\", event);\n        if (event.prevent) {\n          return {\n            title: \"Unable to save\"\n          };\n        }\n\n        this.get(\"attributes\").each(function mDocumentvalidateClearErrorEach(\n          currentAttribute\n        ) {\n          currentAttribute.setErrorMessage(null);\n        });\n\n        this.get(\"attributes\").each(function mDocumentvalidateEach(\n          currentAttribute\n        ) {\n          var parentAttribute = currentDocument\n            .get(\"attributes\")\n            .get(currentAttribute.get(\"parent\"));\n\n          if (currentAttribute.get(\"needed\") === true) {\n            var currentValue = currentAttribute.get(\"attributeValue\"),\n              oneSuccess = true;\n\n            if (currentAttribute.get(\"multiple\")) {\n              if (parentAttribute.get(\"type\") === \"array\") {\n                // Verify each index\n                _.each(currentValue, function mDocumentvalidateArray(\n                  attributeValue,\n                  index\n                ) {\n                  //If the attribute is multiple we check if the array has a size superior to 0\n                  if (_.isArray(attributeValue) && attributeValue.length > 0) {\n                    return;\n                  }\n                  if (\n                    (!attributeValue || !attributeValue.value) &&\n                    attributeValue.value !== 0\n                  ) {\n                    currentAttribute.setErrorMessage(\n                      i18n.___(\"Empty value not allowed\", \"ddui\"),\n                      index\n                    );\n\n                    templateMessage = _.template(\n                      i18n.___(\n                        \"{{parentLabel}} / {{label}} (row # {{index}}) is needed\",\n                        \"ddui\"\n                      ),\n                      { escape: /\\{\\{(.+?)\\}\\}/g }\n                    );\n                    errorMessage.push(\n                      templateMessage({\n                        parentLabel: parentAttribute.get(\"label\"),\n                        label: currentAttribute.get(\"label\"),\n                        index: index + 1\n                      })\n                    );\n                    success = false;\n                  }\n                });\n              } else {\n                if (!currentValue || currentValue.length === 0) {\n                  oneSuccess = false;\n                }\n              }\n            } else {\n              if (\n                (!currentValue || !currentValue.value) &&\n                currentValue.value !== 0\n              ) {\n                oneSuccess = false;\n              }\n            }\n            if (!oneSuccess) {\n              templateMessage = _.template(\n                i18n.___(\"{{parentLabel}} / {{label}} is needed\", \"ddui\"),\n                { escape: /\\{\\{(.+?)\\}\\}/g }\n              );\n              errorMessage.push(\n                templateMessage({\n                  parentLabel: parentAttribute.get(\"label\"),\n                  label: currentAttribute.get(\"label\")\n                })\n              );\n              currentAttribute.setErrorMessage(\n                i18n.___(\"The field must not be empty\", \"ddui\")\n              );\n              success = false;\n            }\n          }\n\n          if (!currentAttribute.checkConstraint({ clearError: false })) {\n            success = false;\n            if (_.isArray(currentAttribute.get(\"errorMessage\"))) {\n              templateMessage = _.template(\n                \"<%= parentLabel %> / <%= label %> \" +\n                  \"<% for(var msg in errorMessage) { %>\" +\n                  \"\\n<%- rowText %> <%= errorMessage[msg].index + 1 %> : <%= errorMessage[msg].message %>\\n <% } %> \"\n              );\n            } else {\n              templateMessage = _.template(\n                \"<%= parentLabel %> / <%= label %> <%= errorMessage %>\"\n              );\n            }\n            errorMessage.push(\n              templateMessage({\n                parentLabel: parentAttribute.get(\"label\"),\n                label: currentAttribute.get(\"label\"),\n                rowText: i18n.___(\"Row #\", \"ddui\"),\n                errorMessage: currentAttribute.get(\"errorMessage\")\n              })\n            );\n          }\n        });\n        if (!success) {\n          error = {\n            title: i18n.___(\"Unable to save\", \"ddui\"),\n            message: errorMessage.join(\", \" + \"\\n\"),\n            errorCode: \"attributeNeeded\"\n          };\n          if (options && options.error) {\n            options.error(_.extend({ eventPrevented: true }, error));\n          }\n          return error;\n        }\n      } catch (e) {\n        console.error(\"Unable to validate\");\n        console.error(e);\n      }\n\n      return undefined;\n    },\n\n    /**\n     * Propagate to attributes a clear message for the error displayed\n     */\n    cleanErrorMessages: function mDocumentCleanErrorMessages() {\n      var attrModels = this.get(\"attributes\") || [];\n      _.each(attrModels.models, function mDocumentCleanErrorMessagesEach(\n        attrModel\n      ) {\n        attrModel.setErrorMessage(null);\n      });\n    },\n    /**\n     * Parse the return of the REST API\n     * @param response\n     * @returns {{properties: (*|properties|exports.defaults.properties|exports.parse.properties|.createObjectExpression.properties), menus: (app.views.shared.menu|*), locale: *, renderMode: string, attributes: Array, templates: *, renderOptions: *}}\n     */\n    parse: function mDocumentParse(response) {\n      var values,\n        renderMode = \"view\",\n        view = response.data.view;\n\n      if (response.success === false) {\n        throw new Error(\"Unable to get the data from documents\");\n      }\n      this.trigger(\"beforeParse\");\n      if (view.renderOptions.mode) {\n        if (view.renderOptions.mode === \"edit\") {\n          renderMode = \"edit\";\n        } else if (view.renderOptions.mode === \"view\") {\n          renderMode = \"view\";\n        } else {\n          throw new Error(\"Unkown render mode \" + view.renderOptions.mode);\n        }\n      }\n\n      this.initialProperties = _.defaults(\n        {\n          renderMode: renderMode || \"view\",\n          viewId: response.data.properties.requestIdentifier\n        },\n        view.documentData.document.properties\n      );\n\n      //Clean attributes\n      if (this.get(\"attributes\") instanceof CollectionAttributes) {\n        this.get(\"attributes\").destroy();\n      }\n\n      values = {\n        initid:\n          response.data.properties.creationView === true\n            ? null\n            : view.documentData.document.properties.initid,\n        properties: view.documentData.document.properties,\n        menus: view.menu,\n        viewId: response.data.properties.requestIdentifier,\n        revision: view.documentData.document.properties.revision,\n        locale: view.locale.culture,\n        renderMode: renderMode || \"view\",\n        attributes: undefined,\n        templates: view.templates,\n        renderOptions: view.renderOptions,\n        customCSS: view.style.css,\n        customJS: view.script.js,\n        customServerData: view.customServerData,\n        messages: response.messages,\n        originalValues: view.documentData.document.attributes\n      };\n      this._customClientData = {};\n      this._customRequestData = null;\n      if (response.data.properties.creationView === true) {\n        values.creationFamid =\n          view.documentData.document.properties.family.name;\n      } else {\n        values.creationFamid = false;\n      }\n      return values;\n    },\n\n    /**\n     * Generate the collection of the current model and bind events on the new collection\n     *\n     * @param keyOrValues string|object of properties or key of the current property\n     * @param value\n     * @returns {*}\n     */\n    set: function mDocumentsetValues(keyOrValues, value) {\n      var currentModel = this;\n      if (keyOrValues.properties !== undefined) {\n        if (currentModel.get(\"properties\") instanceof DocumentProperties) {\n          currentModel.get(\"properties\").trigger(\"destroy\");\n        }\n        keyOrValues.properties = new DocumentProperties(keyOrValues.properties);\n      }\n\n      if (keyOrValues.menus !== undefined) {\n        if (currentModel.get(\"menus\") instanceof CollectionMenus) {\n          currentModel.get(\"menus\").destroy();\n        }\n        keyOrValues.menus = new CollectionMenus(keyOrValues.menus);\n      }\n      if (keyOrValues === \"attributes\") {\n        value = new CollectionAttributes(value, {\n          documentModel: currentModel,\n          renderOptions: currentModel.get(\"renderOptions\"),\n          renderMode: currentModel.get(\"renderMode\")\n        });\n        //Set the internal content collection (for structure attributes)\n        value.each(function mDocumentsetValuesEachAttributes(\n          currentAttributeModel\n        ) {\n          if (currentAttributeModel.get(\"isValueAttribute\")) {\n            return;\n          }\n          var childAttributes = value.filter(\n            function mDocumentsetValuesEachAttributesFilter(\n              candidateChildModel\n            ) {\n              return (\n                candidateChildModel.get(\"parent\") === currentAttributeModel.id\n              );\n            }\n          );\n          if (childAttributes.length > 0) {\n            currentAttributeModel.setContentCollection(childAttributes);\n          }\n        });\n        //Propagate the change event to the model\n        currentModel.listenTo(\n          value,\n          \"change:attributeValue\",\n          function mDocumentsetValuesListenChange(model) {\n            _.defer(function mDocumentAttributeChangerTrigger() {\n              currentModel.trigger(\"changeValue\", {\n                attributeId: model.id\n              });\n            });\n          }\n        );\n        //Propagate the validate event to the model\n        currentModel.listenTo(\n          value,\n          \"constraint\",\n          function mDocumentsetValuesListenConstraint(options) {\n            currentModel.trigger(\n              \"constraint\",\n              options.model.id,\n              options.response\n            );\n          }\n        );\n        //Propagate the renderDone event of the attributes to the model\n        currentModel.listenTo(\n          value,\n          \"renderDone\",\n          function mDocumentsetValuesListenRenderDone(options) {\n            currentModel.trigger(\n              \"attributeRender\",\n              options.model.id,\n              options.$el,\n              options.index\n            );\n          }\n        );\n        //Propagate the beforeRender event of the attributes to the model\n        currentModel.listenTo(\n          value,\n          \"beforeRender\",\n          function mDocumentsetValuesListenBeforeRender(event, options) {\n            currentModel.trigger(\n              \"beforeAttributeRender\",\n              event,\n              options.model.id,\n              options.$el,\n              options.index\n            );\n          }\n        );\n        //Propagate the array event modified to the model\n        currentModel.listenTo(\n          value,\n          \"array\",\n          function mDocumentsetValuesListenArray(type, model, options) {\n            currentModel.trigger(\"arrayModified\", {\n              attributeId: model.id,\n              type: type,\n              options: options\n            });\n          }\n        );\n        //Propagate the event externalLinkSelected to the model\n        currentModel.listenTo(\n          value,\n          \"internalLinkSelected\",\n          function mDocumentsetValuesListenLinkSelected(event, options) {\n            currentModel.trigger(\"internalLinkSelected\", event, options);\n          }\n        );\n        //Propagate the event downloadFile to the model\n        currentModel.listenTo(\n          value,\n          \"downloadFile\",\n          function mDocumentsetValuesListenDownloadfile(\n            event,\n            attrid,\n            options\n          ) {\n            currentModel.trigger(\"downloadFile\", event, attrid, options);\n          }\n        );\n\n        //Propagate the event uploadFile to the model\n        currentModel.listenTo(\n          value,\n          \"uploadFile\",\n          function mDocumentListenUploadfileStart(event, attrid, options) {\n            var attr, attrValue;\n            currentModel.trigger(\"uploadFile\", event, attrid, options);\n\n            if (!event.prevent) {\n              attr = currentModel.get(\"attributes\").get(attrid);\n\n              currentModel._uploadingFile++;\n\n              if (attr) {\n                attrValue = attr.get(\"attributeValue\");\n                if (options.index >= 0) {\n                  attrValue = _.clone(attrValue);\n                  attrValue[options.index] = {\n                    value: \"-^-\",\n                    displayValue: \"Uploading\"\n                  };\n                } else {\n                  attrValue = { value: \"--\", displayValue: \"Uploading\" };\n                }\n                // Use Silent to not redraw widget - it will be redraw at the end of uploading\n                attr.set(\"attributeValue\", attrValue, { silent: true });\n                currentModel.trigger(\"changeValue\", {\n                  attributeId: attrid\n                });\n              }\n            }\n          }\n        );\n\n        //Propagate the event uploadFile to the model\n        currentModel.listenTo(\n          value,\n          \"uploadFileDone\",\n          function mDocumentListenuploadFileDone(event, attrid, options) {\n            currentModel._uploadingFile--;\n            currentModel.trigger(\"uploadFileDone\", event, attrid, options);\n\n            if (currentModel._uploadingFile <= 0) {\n              currentModel.trigger(\"uploadFileFinished\");\n            }\n          }\n        );\n\n        //Propagate the event helperSearch to the model\n        currentModel.listenTo(\n          value,\n          \"helperSearch\",\n          function mDocumentsetValuesListenHelperSearch(\n            event,\n            attrid,\n            options,\n            index\n          ) {\n            currentModel.trigger(\"helperSearch\", event, attrid, options, index);\n          }\n        );\n        //Propagate the event helperResponse to the model\n        currentModel.listenTo(\n          value,\n          \"helperResponse\",\n          function mDocumentsetValuesListenHelperResponse(\n            event,\n            attrid,\n            options,\n            index\n          ) {\n            currentModel.trigger(\n              \"helperResponse\",\n              event,\n              attrid,\n              options,\n              index\n            );\n          }\n        );\n        //Propagate the event helperResponse to the model\n        currentModel.listenTo(\n          value,\n          \"helperSelect\",\n          function mDocumentsetValuesListenHelperSelect(\n            event,\n            attrid,\n            options,\n            index\n          ) {\n            currentModel.trigger(\"helperSelect\", event, attrid, options, index);\n          }\n        );\n        //Propagate the click on an anchor to the model\n        currentModel.listenTo(\n          value,\n          \"anchorClick\",\n          function mDocumentsetValuesListenAnchorClicked(\n            event,\n            attrid,\n            options\n          ) {\n            currentModel.trigger(\"anchorClick\", event, attrid, options);\n          }\n        );\n        //Propagate attributeBeforeTabSelect\n        currentModel.listenTo(\n          value,\n          \"attributeBeforeTabSelect\",\n          function mDocumentattributeBeforeTabSelect(event, attrid) {\n            currentModel.trigger(\"attributeBeforeTabSelect\", event, attrid);\n          }\n        );\n        //Propagate attributeAfterTabSelect\n        currentModel.listenTo(\n          value,\n          \"attributeAfterTabSelect\",\n          function mDocumentattributeAfterTabSelect(event, attrid) {\n            currentModel.trigger(\"attributeAfterTabSelect\", event, attrid);\n          }\n        );\n        currentModel.listenTo(\n          value,\n          \"attributeTabChange\",\n          function mDocumentattributeTabChange(event, attrid, $el, data) {\n            currentModel.trigger(\n              \"attributeTabChange\",\n              event,\n              attrid,\n              $el,\n              data\n            );\n          }\n        );\n      }\n      return Backbone.Model.prototype.set.call(this, keyOrValues, value);\n    },\n\n    unbindLoadEvent: function mDocumentUnbindLoadEvent() {\n      $(window).off(\".\" + this.cid);\n    },\n\n    /**\n     * Destroy the collection associated to the document (used in the destroy part of the view)\n     *\n     */\n    destroySubcollection: function mDocumentdestroySubcollection() {\n      if (this.get(\"menus\") instanceof CollectionMenus) {\n        this.get(\"menus\").destroy();\n      }\n      if (this.get(\"properties\") instanceof DocumentProperties) {\n        this.get(\"properties\").trigger(\"destroy\");\n      }\n      if (this.get(\"attributes\") instanceof CollectionAttributes) {\n        this.get(\"attributes\").destroy();\n      }\n    },\n\n    /**\n     * Inject JS in the main page before render view\n     * To launch beforeRender and beforeRenderAttribute\n     */\n    injectCurrentDocJS: function mDocumentInjectCurrentDocJS() {\n      var allInjectPromises = [],\n        injectPromise = this._promiseCallback(),\n        customJS = _.pluck(this.get(\"customJS\"), \"path\");\n\n      _.each(customJS, function injectElement(currentPath) {\n        if ($('script[src=\"' + currentPath + '\"]').length === 0) {\n          allInjectPromises.push(\n            new Promise(function addJs(resolve, reject) {\n              load(currentPath, function addJsDone(err) {\n                if (err) {\n                  reject(err);\n                } else {\n                  resolve();\n                }\n              });\n            })\n          );\n        }\n      });\n\n      Promise.all(allInjectPromises)\n        .then(injectPromise.success)\n        .catch(injectPromise.error);\n\n      return injectPromise.promise;\n    },\n\n    /**\n     * Inject an array of js in the current page\n     *\n     * @param jsToInject Array of string to inject\n     * @return Promise\n     */\n    injectJS: function mDocumentInjectJs(jsToInject) {\n      var allInjectPromises = [];\n      if (!_.isArray(jsToInject)) {\n        throw new Error(\"The js to inject must be an array of string path\");\n      }\n      _.each(jsToInject, function injectElement(currentPath) {\n        if ($('script[src=\"' + currentPath + '\"]').length === 0) {\n          allInjectPromises.push(\n            new Promise(function addJs(resolve, reject) {\n              load(currentPath, function addJsDone(err) {\n                if (err) {\n                  reject(err);\n                } else {\n                  resolve();\n                }\n              });\n            })\n          );\n        }\n      });\n      return Promise.all(allInjectPromises);\n    },\n\n    /**\n     * Inject an array of css path in the current page\n     *\n     * @param customCss\n     */\n    injectCSS: function mDocumentInjectCSS(customCss) {\n      // add custom css style\n      var $head = $(\"head\"),\n        cssLinkTemplate = _.template(\n          '<link rel=\"stylesheet\" type=\"text/css\" ' +\n            'href=\"<%= path %>\" data-injected=\"true\">'\n        );\n\n      if (!_.isArray(customCss)) {\n        throw new Error(\"The css to inject must be an array of string path\");\n      }\n\n      // Inject new CSS\n      _.each(customCss, function vDocumentInjectNewCSS(cssItem) {\n        if (document.createStyleSheet) {\n          document.createStyleSheet(cssItem);\n        }\n        $head.append(cssLinkTemplate({ path: cssItem }));\n      });\n    },\n\n    /**\n     * Used by backbone for the save part\n     * @var getAllAttributes  ((false by default) : if true return also unmodified values\n     * @returns {{document: {attributes: *, properties : *}}}\n     */\n    toJSON: function mDocumenttoJSON(getAllAttributes) {\n      return {\n        document: {\n          properties: this.getModelProperties(),\n          attributes: this.getValues(getAllAttributes !== true)\n        },\n        customClientData: this._customClientData\n      };\n    },\n\n    /**\n     * Get render option for document widget\n     * @param optId\n     * @returns {*}\n     */\n    getOption: function mDocumentGetOption(optId) {\n      var renderOptions = this.get(\"renderOptions\");\n      if (renderOptions && renderOptions.document) {\n        return renderOptions.document[optId];\n      }\n      return undefined;\n    },\n\n    _promiseCallback: function mDocument_promiseCallback() {\n      var promise,\n        success,\n        error,\n        properties = this.getServerProperties();\n\n      promise = new Promise(function mDocument_promiseInternObject(\n        resolve,\n        reject\n      ) {\n        success = function onSuccess(values) {\n          var successArguments = values;\n          if (values && successArguments[\"promiseArguments\"]) {\n            successArguments = values[\"promiseArguments\"];\n          } else {\n            successArguments = arguments;\n          }\n          if (values && successArguments.documentProperties) {\n            properties = successArguments.documentProperties;\n          }\n          resolve({\n            documentProperties: properties,\n            promiseArguments: successArguments\n          });\n        };\n        error = function onError(values) {\n          var errorArguments = values;\n          if (values && errorArguments[\"promiseArguments\"]) {\n            errorArguments = values[\"promiseArguments\"];\n          } else {\n            errorArguments = arguments;\n          }\n          if (values && errorArguments.documentProperties) {\n            properties = errorArguments.documentProperties;\n          }\n          reject({\n            documentProperties: properties,\n            promiseArguments: errorArguments\n          });\n        };\n      });\n\n      //noinspection JSUnusedAssignment\n      return {\n        promise: promise,\n        success: success,\n        error: error\n      };\n    },\n\n    /**\n     * Complete the loading of the document\n     * Fetch the structure and external js deps\n     *\n     * @private\n     */\n    _loadDocument: function mDocumentLoadDocument(currentModel) {\n      var properties = this.getServerProperties();\n\n      return new Promise(function mDocument_promiseLoadDocument(\n        resolve,\n        reject\n      ) {\n        //Complete the structure after\n        currentModel._completeStructure().then(\n          function onGetStructureDone() {\n            currentModel.injectCurrentDocJS().then(\n              function mDocument_injectJSDone(/*values*/) {\n                resolve({\n                  documentProperties: properties,\n                  successpromiseArguments: arguments\n                });\n              },\n              function mDocument_injectJSFail(values) {\n                reject({\n                  documentProperties: properties,\n                  promiseArguments: arguments\n                });\n                currentModel.trigger.apply(\n                  currentModel,\n                  _.union([\"dduiDocumentFail\"], values.promiseArguments)\n                );\n              }\n            );\n          },\n          function mDocument_onGetStructureFail(values) {\n            reject({\n              documentProperties: properties,\n              promiseArguments: arguments\n            });\n            currentModel.trigger.apply(\n              currentModel,\n              _.union([\"dduiDocumentFail\"], values.promiseArguments)\n            );\n          }\n        );\n      });\n    },\n\n    fetchDocument: function mDocumentFetchDocument(values, options) {\n      var globalCallback = this._promiseCallback(),\n        documentCallback = this._promiseCallback(),\n        serverProperties = this.getServerProperties(),\n        currentModel = this,\n        needToUnlock = {},\n        beforeCloseReturn = { prevent: false },\n        lockModel = null,\n        nextView = false,\n        security,\n        previousMode,\n        lockCallback = this._promiseCallback();\n\n      options = options || {};\n      values = values || {};\n\n      if (_.isEmpty(this._customClientData)) {\n        this.trigger(\"getCustomClientData\");\n      }\n\n      //Register promise events\n      documentCallback.promise.then(\n        function onFetchDocumentDone(currentModelProperties) {\n          currentModel._loadDocument(currentModel).then(\n            function mDocument_loadDocumentDone(values) {\n              globalCallback.success.apply(currentModelProperties, values);\n            },\n            function mDocument_loadDocumentFail(values) {\n              globalCallback.error.apply(\n                currentModelProperties,\n                values && values.promiseArguments\n                  ? values.promiseArguments\n                  : values\n              );\n            }\n          );\n        },\n        function mDocument_onFetchDocumentFail(values) {\n          globalCallback.error.call(\n            serverProperties,\n            values && values.promiseArguments ? values.promiseArguments : values\n          );\n        }\n      );\n\n      globalCallback.promise.then(\n        function onPrepareDocumentDone(values) {\n          if (_.isFunction(options.success)) {\n            options.success(values);\n          }\n          currentModel.trigger(\"close\", serverProperties);\n          currentModel.trigger.apply(\n            currentModel,\n            _.union([\"dduiDocumentReady\"], values.promiseArguments)\n          );\n        },\n        function onPrepareDocumentFail(values) {\n          if (_.isFunction(options.error)) {\n            options.error(values);\n          }\n          if (\n            !(\n              values.promiseArguments &&\n              values.promiseArguments[0] &&\n              values.promiseArguments[0].eventPrevented\n            )\n          ) {\n            currentModel.trigger.apply(\n              currentModel,\n              _.union([\"dduiDocumentFail\"], values.promiseArguments[0])\n            );\n          }\n        }\n      );\n\n      //Init default values\n      _.defaults(values, {\n        revision: -1,\n        viewId: \"!defaultConsultation\",\n        initid: this.get(\"initid\")\n      });\n\n      //Trigger (synchronous) before close event\n      this.trigger(\n        \"beforeClose\",\n        beforeCloseReturn,\n        values,\n        this._customClientData\n      );\n\n      if (beforeCloseReturn.prevent === false) {\n        this.trigger(\"displayLoading\");\n\n        //***********Lock Part*********************************************************************************\n\n        // Verify if current document need to be unlocked before fetch another\n        security = this.get(\"properties\")\n          ? this.get(\"properties\").get(\"security\")\n          : null;\n        previousMode = this.get(\"renderMode\");\n\n        if (\n          previousMode === \"edit\" &&\n          security &&\n          security.lock &&\n          security.lock.temporary\n        ) {\n          needToUnlock = {\n            initid: serverProperties.initid\n          };\n        }\n        //Compute the next view\n        nextView = values.viewId;\n\n        if (!nextView) {\n          nextView =\n            this.get(\"renderMode\") === \"edit\"\n              ? \"!defaultEdition\"\n              : \"!defaultConsultation\";\n        }\n\n        if (\n          nextView !== \"!defaultConsultation\" &&\n          nextView !== \"!coreCreation\" &&\n          nextView !== \"!defaultCreation\" &&\n          this.get(\"renderMode\") !== \"create\"\n        ) {\n          //if the document is locked and the next view doesn't need the same lock delete it\n          if (needToUnlock.initid && needToUnlock.initid !== values.initid) {\n            lockModel = new DocumentLock({\n              initid: needToUnlock.initid,\n              type: \"temporary\"\n            });\n            lockModel.destroy();\n          }\n          // The next view needs a lock, ask for it and fetch the document after\n          lockModel = new DocumentLock({\n            initid: values.initid,\n            viewId: nextView,\n            type: \"temporary\"\n          });\n          lockModel.save({}, lockCallback);\n        } else {\n          if (needToUnlock) {\n            if (needToUnlock.initid === values.initid) {\n              // If same document \"get\" must be perform after unlock\n              lockModel = new DocumentLock({\n                initid: needToUnlock.initid,\n                type: \"temporary\"\n              });\n              lockModel.destroy({\n                success: function() {\n                  lockCallback.success();\n                },\n                error: function() {\n                  currentModel.trigger(\"showMessage\", {\n                    title: i18n.___(\n                      \"Document has been locked by someone else.\",\n                      \"ddui\"\n                    ),\n                    type: \"info\"\n                  });\n                  lockCallback.success();\n                }\n              });\n\n              lockCallback.success();\n            } else {\n              lockModel = new DocumentLock({\n                initid: needToUnlock.initid,\n                type: \"temporary\"\n              });\n              lockModel.destroy();\n              lockCallback.success();\n            }\n          } else {\n            lockCallback.success();\n          }\n        }\n\n        lockCallback.promise.then(\n          function mdocument_lockSucess() {\n            //save the new options in the currentDocument for the fetch\n            _.each(\n              _.pick(values, \"initid\", \"revision\", \"viewId\"),\n              function mDocument_SetNewOptions(value, key) {\n                currentModel.set(key, value);\n              }\n            );\n            currentModel.fetch(documentCallback);\n          },\n          function mDocument_lockFail() {\n            globalCallback.error.apply(currentModel, arguments);\n          }\n        );\n      } else {\n        //Reinit properties\n        currentModel.set(serverProperties);\n        //Indicate success to the promise object\n        globalCallback.error({ eventPrevented: true });\n      }\n\n      return globalCallback.promise;\n    },\n\n    saveDocument: function mDocumentSaveDocument(attributes, options) {\n      var globalCallback = this._promiseCallback(),\n        saveCallback = this._promiseCallback(),\n        beforeSaveEvent = { prevent: false },\n        currentModel = this,\n        serverProperties = this.getServerProperties();\n\n      options = options || {};\n\n      if (_.isEmpty(this._customClientData)) {\n        this.trigger(\"getCustomClientData\");\n      }\n      this.trigger(\"beforeSave\", beforeSaveEvent, this._customClientData);\n\n      if (beforeSaveEvent.prevent !== false) {\n        globalCallback.error({ eventPrevented: true });\n      } else {\n        saveCallback.promise.then(\n          function mDocument_saveDone() {\n            currentModel._loadDocument(currentModel).then(\n              function mDocument_loadDocumentDone() {\n                globalCallback.success();\n              },\n              function mDocument_loadDocumentFail() {\n                globalCallback.error.apply(currentModel, arguments);\n              }\n            );\n          },\n          function mDocument_saveFail() {\n            globalCallback.error.apply(currentModel, arguments);\n          }\n        );\n\n        if (currentModel.hasUploadingFile()) {\n          this.trigger(\"displayLoading\", {\n            isSaving: true,\n            text: i18n.___(\"Recording files in progress\", \"ddui\")\n          });\n          currentModel.trigger(\"showMessage\", {\n            title: i18n.___(\"Waiting uploads in progress\", \"ddui\"),\n            type: \"info\"\n          });\n          currentModel.once(\n            \"uploadFileFinished\",\n            function mDocumentsetValuesListenUploadUntilTheEnd(/*event*/) {\n              currentModel.trigger(\"displayLoading\", { isSaving: true });\n              currentModel.save(attributes, saveCallback);\n            }\n          );\n        } else {\n          this.trigger(\"displayLoading\", { isSaving: true });\n          currentModel.save(attributes, saveCallback);\n        }\n      }\n\n      globalCallback.promise.then(\n        function onSaveSuccess(values) {\n          currentModel.trigger(\"afterSave\", serverProperties);\n          currentModel.trigger(\"close\", serverProperties);\n          if (_.isFunction(options.success)) {\n            options.success();\n          }\n          currentModel.trigger.apply(\n            currentModel,\n            _.union([\"dduiDocumentReady\"], values.promiseArguments)\n          );\n        },\n        function onSaveFail(values) {\n          if (_.isFunction(options.error)) {\n            options.error();\n          }\n          if (\n            !(\n              values.promiseArguments &&\n              values.promiseArguments[0] &&\n              values.promiseArguments[0].eventPrevented\n            )\n          ) {\n            currentModel.trigger.apply(\n              currentModel,\n              _.union([\"dduiDocumentFail\"], values.promiseArguments)\n            );\n          }\n        }\n      );\n\n      return globalCallback.promise;\n    },\n\n    deleteDocument: function mDocumentDelete(options) {\n      var globalCallback = this._promiseCallback(),\n        deleteCallback = this._promiseCallback(),\n        beforeDeleteEvent = { prevent: false },\n        currentModel = this,\n        serverProperties = this.getServerProperties();\n\n      options = options || {};\n\n      if (_.isEmpty(this._customClientData)) {\n        this.trigger(\"getCustomClientData\");\n      }\n      this.trigger(\"beforeDelete\", beforeDeleteEvent, this._customClientData);\n\n      if (beforeDeleteEvent.prevent !== false) {\n        globalCallback.error({ eventPrevented: true });\n      } else {\n        this.trigger(\"displayLoading\");\n        deleteCallback.promise.then(\n          function mDocument_deleteDone() {\n            currentModel\n              .fetchDocument({ initid: currentModel.get(\"initid\") })\n              .then(\n                function mDocument_afterDeleteLoadDone() {\n                  globalCallback.success();\n                },\n                function mDocument_afterDeleteLoadFail() {\n                  globalCallback.error.apply(currentModel, arguments);\n                }\n              );\n          },\n          function mDocument_deleteFail() {\n            globalCallback.error.apply(currentModel, arguments);\n          }\n        );\n\n        this.sync(\"delete\", this, deleteCallback);\n      }\n\n      globalCallback.promise.then(\n        function onDeleteSuccess(values) {\n          currentModel.trigger(\"afterDelete\", serverProperties);\n          currentModel.trigger(\"close\", serverProperties);\n          if (_.isFunction(options.success)) {\n            options.success();\n          }\n          currentModel.trigger.apply(\n            currentModel,\n            _.union([\"dduiDocumentReady\"], values.promiseArguments)\n          );\n        },\n        function onDeleteFail(values) {\n          if (_.isFunction(options.error)) {\n            options.error();\n          }\n          if (\n            !(\n              values.promiseArguments &&\n              values.promiseArguments[0] &&\n              values.promiseArguments[0].eventPrevented\n            )\n          ) {\n            currentModel.trigger.apply(\n              currentModel,\n              _.union(\n                [\"dduiDocumentFail\", currentModel],\n                values.promiseArguments\n              )\n            );\n          }\n        }\n      );\n\n      return globalCallback.promise;\n    },\n\n    restoreDocument: function mDocumentRestoreDocument(options) {\n      var globalCallback = this._promiseCallback(),\n        restoreCallback = this._promiseCallback(),\n        beforeRestoreEvent = { prevent: false },\n        currentModel = this,\n        serverProperties = this.getServerProperties();\n\n      options = options || {};\n\n      if (\"deleted\" === this.get(\"properties\").get(\"status\")) {\n        if (_.isEmpty(this._customClientData)) {\n          this.trigger(\"getCustomClientData\");\n        }\n        this.trigger(\n          \"beforeRestore\",\n          beforeRestoreEvent,\n          this._customClientData\n        );\n\n        if (beforeRestoreEvent.prevent !== false) {\n          globalCallback.error({ eventPrevented: true });\n        } else {\n          this.trigger(\"displayLoading\", { isSaving: true });\n\n          restoreCallback.promise.then(\n            function mDocument_restoreDocument_Success() {\n              currentModel._loadDocument(currentModel).then(\n                function mDocument_restoreDocument_loadSuccess() {\n                  globalCallback.success();\n                },\n                function mDocument_restoreDocument_loadFail() {\n                  globalCallback.error.apply(currentModel, arguments);\n                }\n              );\n            },\n            function mDocument_restoreDocument_Fail() {\n              globalCallback.error.apply(currentModel, arguments);\n            }\n          );\n\n          this.get(\"properties\").set(\"status\", \"alive\");\n          currentModel.save({}, restoreCallback);\n        }\n      } else {\n        globalCallback.error({\n          systemError: true,\n          errorMessage: \"Unable to restore alive doc\"\n        });\n      }\n\n      globalCallback.promise.then(\n        function mDocument_restoreDocument_onSuccess(values) {\n          currentModel.trigger(\"afterRestore\", serverProperties);\n          currentModel.trigger(\"close\", serverProperties);\n          if (_.isFunction(options.success)) {\n            options.success();\n          }\n          currentModel.trigger.apply(\n            currentModel,\n            _.union([\"dduiDocumentReady\"], values.promiseArguments)\n          );\n        },\n        function mDocument_restoreDocument_onFail(values) {\n          if (_.isFunction(options.error)) {\n            options.error();\n          }\n          if (\n            !(\n              values.promiseArguments &&\n              values.promiseArguments[0] &&\n              (values.promiseArguments[0].eventPrevented ||\n                values.promiseArguments[0].systemError)\n            )\n          ) {\n            currentModel.trigger.apply(\n              currentModel,\n              _.union([\"dduiDocumentFail\"], values.promiseArguments)\n            );\n          }\n        }\n      );\n\n      return globalCallback.promise;\n    },\n\n    /**\n     * Get complementary data : family structure\n     */\n    _completeStructure: function mDocumentCompleteStructure() {\n      var mStructure,\n        documentModel = this,\n        structurePromise = this._promiseCallback();\n\n      var neededAttributes = this.get(\"renderOptions\").needed;\n      var visibilityAttributes = this.get(\"renderOptions\").visibilities;\n      var valueAttributes = this.get(\"originalValues\");\n\n      if (this.get(\"properties\").get(\"type\") === \"family\") {\n        // Family has no attributes\n        this.set(\"attributes\", []);\n        structurePromise.success();\n        return structurePromise.promise;\n      }\n\n      if (!_.isUndefined(this.get(\"attributes\"))) {\n        this.set(\"attributes\", this.get(\"attributes\")); // to convert attributes to models\n        structurePromise.success();\n        return structurePromise.promise;\n      }\n\n      mStructure = new FamilyStructure({\n        familyId: this.get(\"properties\").get(\"family\").name,\n        referencedocument: {\n          initid: this.get(\"initid\"),\n          viewId: this.get(\"viewId\"),\n          revision: this.get(\"revision\")\n        }\n      });\n\n      mStructure.fetch({\n        success: function mDocumentCompleteStructureSuccess(\n          structureModel,\n          response\n        ) {\n          if (\n            _.isEqual(structureModel.get(\"referencedocument\"), {\n              initid: documentModel.get(\"initid\"),\n              viewId: documentModel.get(\"viewId\"),\n              revision: documentModel.get(\"revision\")\n            })\n          ) {\n            var attributes = flattenAttributes(\n              attributes,\n              response.data.family.structure\n            );\n            _.each(attributes, function mDocumentCompleteStructureSuccessEach(\n              currentAttributeStructure\n            ) {\n              if (\n                currentAttributeStructure.id &&\n                valueAttributes[currentAttributeStructure.id]\n              ) {\n                currentAttributeStructure.attributeValue =\n                  valueAttributes[currentAttributeStructure.id];\n                currentAttributeStructure.needed =\n                  neededAttributes[currentAttributeStructure.id] === true;\n              }\n              if (\n                currentAttributeStructure.id &&\n                visibilityAttributes[currentAttributeStructure.id]\n              ) {\n                currentAttributeStructure.visibility =\n                  visibilityAttributes[currentAttributeStructure.id];\n              }\n            });\n            documentModel.set(\"attributes\", attributes);\n            structurePromise.success();\n          }\n        },\n\n        error: structurePromise.error\n      });\n      return structurePromise.promise;\n    }\n  });\n}).apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWI0Y2U0ZjkxNzA2ZjZjMjcxMmUuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvQXBwcy9ET0NVTUVOVC9JSE0vbW9kZWxzL21Eb2N1bWVudC5qcz8yMTYxIl0sInNvdXJjZXNDb250ZW50IjpbIi8qZ2xvYmFsIGRlZmluZSwgY29uc29sZSwgcmVxdWlyZSovXG5kZWZpbmUoW1xuICBcImpxdWVyeVwiLFxuICBcInVuZGVyc2NvcmVcIixcbiAgXCJiYWNrYm9uZVwiLFxuICBcImxpdHRsZS1sb2FkZXJcIixcbiAgXCJkY3BEb2N1bWVudC9tb2RlbHMvbURvY3VtZW50UHJvcGVydGllc1wiLFxuICBcImRjcERvY3VtZW50L21vZGVscy9tRG9jdW1lbnRMb2NrXCIsXG4gIFwiZGNwRG9jdW1lbnQvbW9kZWxzL21GYW1pbHlTdHJ1Y3R1cmVcIixcbiAgXCJkY3BEb2N1bWVudC9jb2xsZWN0aW9ucy9hdHRyaWJ1dGVzXCIsXG4gIFwiZGNwRG9jdW1lbnQvY29sbGVjdGlvbnMvbWVudXNcIixcbiAgXCJkY3BEb2N1bWVudC9pMThuL2RvY3VtZW50Q2F0YWxvZ1wiXG5dLCBmdW5jdGlvbiBtRG9jdW1lbnQoXG4gICQsXG4gIF8sXG4gIEJhY2tib25lLFxuICBsb2FkLFxuICBEb2N1bWVudFByb3BlcnRpZXMsXG4gIERvY3VtZW50TG9jayxcbiAgRmFtaWx5U3RydWN0dXJlLFxuICBDb2xsZWN0aW9uQXR0cmlidXRlcyxcbiAgQ29sbGVjdGlvbk1lbnVzLFxuICBpMThuXG4pIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgdmFyIGZsYXR0ZW5BdHRyaWJ1dGVzID0gZnVuY3Rpb24gbURvY3VtZW50ZmxhdHRlbkF0dHJpYnV0ZXMoXG4gICAgY3VycmVudEF0dHJpYnV0ZXMsXG4gICAgYXR0cmlidXRlcyxcbiAgICBwYXJlbnRcbiAgKSB7XG4gICAgaWYgKCFfLmlzQXJyYXkoYXR0cmlidXRlcykpIHtcbiAgICAgIGF0dHJpYnV0ZXMgPSBfLnZhbHVlcyhhdHRyaWJ1dGVzKTtcbiAgICB9XG4gICAgaWYgKHBhcmVudCkge1xuICAgICAgXy5lYWNoKGF0dHJpYnV0ZXMsIGZ1bmN0aW9uIG1Eb2N1bWVudEVhY2hmbGF0dGVuUGFyZW50QXR0cmlidXRlcyh2YWx1ZSkge1xuICAgICAgICB2YWx1ZS5wYXJlbnQgPSBwYXJlbnQ7XG4gICAgICB9KTtcbiAgICB9XG4gICAgY3VycmVudEF0dHJpYnV0ZXMgPSBfLnVuaW9uKGN1cnJlbnRBdHRyaWJ1dGVzLCBhdHRyaWJ1dGVzKTtcbiAgICBfLmVhY2goYXR0cmlidXRlcywgZnVuY3Rpb24gbURvY3VtZW50RWFjaGZsYXR0ZW5BdHRyaWJ1dGVzKGN1cnJlbnRBdHRyKSB7XG4gICAgICBpZiAoY3VycmVudEF0dHIuY29udGVudCkge1xuICAgICAgICBjdXJyZW50QXR0cmlidXRlcyA9IF8udW5pb24oXG4gICAgICAgICAgY3VycmVudEF0dHJpYnV0ZXMsXG4gICAgICAgICAgZmxhdHRlbkF0dHJpYnV0ZXMoXG4gICAgICAgICAgICBjdXJyZW50QXR0cmlidXRlcyxcbiAgICAgICAgICAgIGN1cnJlbnRBdHRyLmNvbnRlbnQsXG4gICAgICAgICAgICBjdXJyZW50QXR0ci5pZFxuICAgICAgICAgIClcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gY3VycmVudEF0dHJpYnV0ZXM7XG4gIH07XG5cbiAgLy9ub2luc3BlY3Rpb24gSlNWYWxpZGF0ZUpTRG9jXG4gIHJldHVybiBCYWNrYm9uZS5Nb2RlbC5leHRlbmQoe1xuICAgIHR5cGVNb2RlbDogXCJkZHVpOmRvY3VtZW50XCIsXG4gICAgaWRBdHRyaWJ1dGU6IFwiaW5pdGlkXCIsXG5cbiAgICBkZWZhdWx0czoge1xuICAgICAgcmV2aXNpb246IC0xLFxuICAgICAgdmlld0lkOiB1bmRlZmluZWQsXG4gICAgICByZW5kZXJNb2RlOiBcInZpZXdcIixcbiAgICAgIHByb3BlcnRpZXM6IHVuZGVmaW5lZCxcbiAgICAgIG1lbnVzOiB1bmRlZmluZWQsXG4gICAgICBhdHRyaWJ1dGVzOiB1bmRlZmluZWRcbiAgICB9LFxuICAgIC8vIFJlY29yZCBjdXN0b20gZGF0YSBpbiBtb2RlbCBkaXJlY3RseSAtIG5vdCBpbiBtb2RlbCBwcm9wZXJ0eSBiZWNhdXNlIG11c3Qgbm90IGJlIHJlc2V0IGJ5IGNsZWFyIG1ldGhvZFxuICAgIF9jdXN0b21DbGllbnREYXRhOiB7fSxcbiAgICBfdXBsb2FkaW5nRmlsZTogMCxcbiAgICAvKipcbiAgICAgKiBDb21wdXRlIHRoZSBSRVNUIFVSTCBmb3IgdGhlIGN1cnJlbnQgZG9jdW1lbnRcbiAgICAgKlxuICAgICAqIFVzZWQgaW50ZXJuYWx5IGJ5IGJhY2tib25lIGluIGZldGNoLCBzYXZlLCBkZXN0cm95XG4gICAgICpcbiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfVxuICAgICAqL1xuICAgIHVybDogZnVuY3Rpb24gbURvY3VtZW50dXJsKCkge1xuICAgICAgdmFyIHVybERhdGEgPSBcImFwaS92Mi9cIixcbiAgICAgICAgdmlld0lkID0gdGhpcy5nZXQoXCJ2aWV3SWRcIik7XG4gICAgICB2YXIgY3VzdG9tQ2xpZW50RGF0YSA9IHRoaXMuX2N1c3RvbUNsaWVudERhdGE7XG4gICAgICB2YXIgY3VycmVudE1ldGhvZCA9IHRoaXMuZ2V0KFwiY3VycmVudEh0dHBNZXRob2RcIik7XG4gICAgICB2YXIgcmV2aXNpb24gPSB0aGlzLmdldChcInJldmlzaW9uXCIpO1xuXG4gICAgICBpZiAodGhpcy5nZXQoXCJjcmVhdGlvbkZhbWlkXCIpICYmIHRoaXMuaWQgPT09IG51bGwpIHtcbiAgICAgICAgdXJsRGF0YSArPVxuICAgICAgICAgIFwiZmFtaWxpZXMvXCIgK1xuICAgICAgICAgIGVuY29kZVVSSUNvbXBvbmVudCh0aGlzLmdldChcImNyZWF0aW9uRmFtaWRcIikpICtcbiAgICAgICAgICBcIi9kb2N1bWVudHNWaWV3cy9cIjtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHVybERhdGEgKz0gXCJkb2N1bWVudHMvXCIgKyBlbmNvZGVVUklDb21wb25lbnQodGhpcy5pZCk7XG4gICAgICAgIC8vRG9uJ3QgYWRkIHJldmlzaW9uIGZvciB0aGUgZGVsZXRpb24gb2YgYSBhbGl2ZSBkb2N1bWVudFxuICAgICAgICBpZiAocmV2aXNpb24gIT09IG51bGwgJiYgY3VycmVudE1ldGhvZCAhPT0gXCJkZWxldGVcIikge1xuICAgICAgICAgIGlmIChfLmlzT2JqZWN0KHJldmlzaW9uKSAmJiByZXZpc2lvbi5zdGF0ZSkge1xuICAgICAgICAgICAgdXJsRGF0YSArPVxuICAgICAgICAgICAgICBcIi9yZXZpc2lvbnMvXCIgKyBlbmNvZGVVUklDb21wb25lbnQoXCJzdGF0ZTpcIiArIHJldmlzaW9uLnN0YXRlKTtcbiAgICAgICAgICB9IGVsc2UgaWYgKHJldmlzaW9uID49IDApIHtcbiAgICAgICAgICAgIHVybERhdGEgKz0gXCIvcmV2aXNpb25zL1wiICsgZW5jb2RlVVJJQ29tcG9uZW50KHJldmlzaW9uKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHZpZXdJZCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgaWYgKHRoaXMuZ2V0KFwicmVuZGVyTW9kZVwiKSA9PT0gXCJ2aWV3XCIgfHwgY3VycmVudE1ldGhvZCA9PT0gXCJkZWxldGVcIikge1xuICAgICAgICAgICAgdmlld0lkID0gXCIhZGVmYXVsdENvbnN1bHRhdGlvblwiO1xuICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5nZXQoXCJyZW5kZXJNb2RlXCIpID09PSBcImVkaXRcIikge1xuICAgICAgICAgICAgdmlld0lkID0gXCIhZGVmYXVsdEVkaXRpb25cIjtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdmlld0lkID0gXCIhZGVmYXVsdENvbnN1bHRhdGlvblwiO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoY3VycmVudE1ldGhvZCA9PT0gXCJkZWxldGVcIiAmJiB0aGlzLmdldChcInJlbmRlck1vZGVcIikgPT09IFwiZWRpdFwiKSB7XG4gICAgICAgICAgdmlld0lkID0gXCIhZGVmYXVsdENvbnN1bHRhdGlvblwiO1xuICAgICAgICB9XG4gICAgICAgIHVybERhdGEgKz0gXCIvdmlld3MvXCIgKyBlbmNvZGVVUklDb21wb25lbnQodmlld0lkKTtcbiAgICAgIH1cblxuICAgICAgaWYgKFxuICAgICAgICAhXy5pc0VtcHR5KGN1c3RvbUNsaWVudERhdGEpICYmXG4gICAgICAgIChjdXJyZW50TWV0aG9kID09PSBcInJlYWRcIiB8fCBjdXJyZW50TWV0aG9kID09PSBcImRlbGV0ZVwiKVxuICAgICAgKSB7XG4gICAgICAgIHVybERhdGEgKz1cbiAgICAgICAgICBcIj9jdXN0b21DbGllbnREYXRhPVwiICtcbiAgICAgICAgICBlbmNvZGVVUklDb21wb25lbnQoSlNPTi5zdHJpbmdpZnkoY3VzdG9tQ2xpZW50RGF0YSkpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHVybERhdGE7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIG92ZXJyaWRlIEJhY2tib25lIHN5bmMgdG8gcmVjb3JkIG1ldGhvZFxuICAgICAqIEBwYXJhbSBtZXRob2RcbiAgICAgKiBAcGFyYW0gbW9kZWxcbiAgICAgKiBAcGFyYW0gb3B0aW9uc1xuICAgICAqIEByZXR1cm5zIHsqfVxuICAgICAqL1xuICAgIHN5bmM6IGZ1bmN0aW9uIG1Eb2N1bWVudFN5bmMobWV0aG9kLCBtb2RlbCwgb3B0aW9ucykge1xuICAgICAgdGhpcy5zZXQoXCJjdXJyZW50SHR0cE1ldGhvZFwiLCBtZXRob2QpOyAvLyByZWNvcmQgZm9yIHVybCBtZXRob2RcbiAgICAgIG9wdGlvbnMuYXR0cnMgPSB0aGlzLl9jdXN0b21SZXF1ZXN0RGF0YTtcbiAgICAgIHJldHVybiBCYWNrYm9uZS5Nb2RlbC5wcm90b3R5cGUuc3luYy5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgIH0sXG4gICAgLyoqXG4gICAgICogSW5pdGlhbGl6ZSBldmVudCBoYW5kbGluZ1xuICAgICAqXG4gICAgICovXG4gICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gbURvY3VtZW50aW5pdGlhbGl6ZSgpIHtcbiAgICAgIHZhciB0aGVNb2RlbCA9IHRoaXM7XG5cbiAgICAgIHRoaXMubGlzdGVuVG8odGhpcywgXCJkZHVpRG9jdW1lbnRGYWlsXCIsIHRoaXMucHJvcGFnYXRlU3luY2hyb0Vycm9yKTtcbiAgICAgIHRoaXMubGlzdGVuVG8odGhpcywgXCJkZXN0cm95XCIsIHRoaXMuZGVzdHJveVN1YmNvbGxlY3Rpb24pO1xuICAgICAgdGhpcy5saXN0ZW5Ubyh0aGlzLCBcImRlc3Ryb3lcIiwgdGhpcy51bmJpbmRMb2FkRXZlbnQpO1xuXG4gICAgICAkKHdpbmRvdykub24oXG4gICAgICAgIFwiYmVmb3JldW5sb2FkLlwiICsgdGhpcy5jaWQsXG4gICAgICAgIGZ1bmN0aW9uIG1Eb2N1bWVudEJlZm9yZVVubG9hZCgpIHtcbiAgICAgICAgICB2YXIgc2VjdXJpdHkgPSB0aGVNb2RlbC5nZXQoXCJwcm9wZXJ0aWVzXCIpXG4gICAgICAgICAgICAgID8gdGhlTW9kZWwuZ2V0KFwicHJvcGVydGllc1wiKS5nZXQoXCJzZWN1cml0eVwiKVxuICAgICAgICAgICAgICA6IG51bGwsXG4gICAgICAgICAgICBldmVudCA9IHsgcHJldmVudDogZmFsc2UgfTtcbiAgICAgICAgICBpZiAodGhlTW9kZWwuaGFzQXR0cmlidXRlc0NoYW5nZWQoKSkge1xuICAgICAgICAgICAgcmV0dXJuIGkxOG4uX19fKFxuICAgICAgICAgICAgICBcIlRoZSBmb3JtIGhhcyBiZWVuIG1vZGlmaWVkIGFuZCBpcyBpcyBub3Qgc2F2ZWRcIixcbiAgICAgICAgICAgICAgXCJkZHVpXCJcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgdGhlTW9kZWwudHJpZ2dlcihcbiAgICAgICAgICAgIFwiYmVmb3JlQ2xvc2VcIixcbiAgICAgICAgICAgIGV2ZW50LFxuICAgICAgICAgICAgdGhlTW9kZWwuZ2V0U2VydmVyUHJvcGVydGllcygpLFxuICAgICAgICAgICAgdGhpcy5fY3VzdG9tQ2xpZW50RGF0YVxuICAgICAgICAgICk7XG5cbiAgICAgICAgICBpZiAoZXZlbnQucHJldmVudCkge1xuICAgICAgICAgICAgcmV0dXJuIGkxOG4uX19fKFwiVW5hYmxlIHRvIGNsb3NlIHRoZSBkb2N1bWVudFwiLCBcImRkdWlcIik7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYgKFxuICAgICAgICAgICAgdGhlTW9kZWwuZ2V0KFwicmVuZGVyTW9kZVwiKSA9PT0gXCJlZGl0XCIgJiZcbiAgICAgICAgICAgIHNlY3VyaXR5ICYmXG4gICAgICAgICAgICBzZWN1cml0eS5sb2NrICYmXG4gICAgICAgICAgICBzZWN1cml0eS5sb2NrLnRlbXBvcmFyeVxuICAgICAgICAgICkge1xuICAgICAgICAgICAgLy8gTm8gdXNlIG1vZGVsIGRlc3Ryb3kgOiBwYWdlIGlzIGRlc3Ryb3llZCBiZWZvcmUgcmVxdWVzdCBpcyBzb21lIGNhc2VcbiAgICAgICAgICAgICQuYWpheCh7XG4gICAgICAgICAgICAgIHVybDpcbiAgICAgICAgICAgICAgICBcImFwaS92Mi9kb2N1bWVudHMvXCIgK1xuICAgICAgICAgICAgICAgIHRoZU1vZGVsLmdldChcImluaXRpZFwiKSArXG4gICAgICAgICAgICAgICAgXCIvbG9ja3MvdGVtcG9yYXJ5XCIsXG4gICAgICAgICAgICAgIHR5cGU6IFwiREVMRVRFXCIsXG4gICAgICAgICAgICAgIGFzeW5jOiBmYWxzZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aGVNb2RlbC5zZXQoXCJ1bmxvY2tpbmdcIiwgdHJ1ZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICApO1xuXG4gICAgICAkKHdpbmRvdykub24oXCJwYWdlaGlkZS5cIiArIHRoaXMuY2lkLCBmdW5jdGlvbiBtRG9jdW1lbnRQYWdlSGlkZShldmVudCkge1xuICAgICAgICB2YXIgc2VjdXJpdHkgPSB0aGVNb2RlbC5nZXQoXCJwcm9wZXJ0aWVzXCIpXG4gICAgICAgICAgPyB0aGVNb2RlbC5nZXQoXCJwcm9wZXJ0aWVzXCIpLmdldChcInNlY3VyaXR5XCIpXG4gICAgICAgICAgOiBudWxsO1xuICAgICAgICB2YXIgdW5sb2NraW5nID0gdGhlTW9kZWwuZ2V0KFwidW5sb2NraW5nXCIpO1xuXG4gICAgICAgIHRoZU1vZGVsLnRyaWdnZXIoXG4gICAgICAgICAgXCJjbG9zZVwiLFxuICAgICAgICAgIGV2ZW50LFxuICAgICAgICAgIHRoZU1vZGVsLmdldFNlcnZlclByb3BlcnRpZXMoKSxcbiAgICAgICAgICB0aGlzLl9jdXN0b21DbGllbnREYXRhXG4gICAgICAgICk7XG5cbiAgICAgICAgaWYgKFxuICAgICAgICAgICF1bmxvY2tpbmcgJiZcbiAgICAgICAgICB0aGVNb2RlbC5nZXQoXCJyZW5kZXJNb2RlXCIpID09PSBcImVkaXRcIiAmJlxuICAgICAgICAgIHNlY3VyaXR5ICYmXG4gICAgICAgICAgc2VjdXJpdHkubG9jayAmJlxuICAgICAgICAgIHNlY3VyaXR5LmxvY2sudGVtcG9yYXJ5XG4gICAgICAgICkge1xuICAgICAgICAgICQuYWpheCh7XG4gICAgICAgICAgICB1cmw6XG4gICAgICAgICAgICAgIFwiYXBpL3YyL2RvY3VtZW50cy9cIiArIHRoZU1vZGVsLmdldChcImluaXRpZFwiKSArIFwiL2xvY2tzL3RlbXBvcmFyeVwiLFxuICAgICAgICAgICAgdHlwZTogXCJERUxFVEVcIixcbiAgICAgICAgICAgIGFzeW5jOiBmYWxzZVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogUmV0dXJuIGEgcGxhaW4gb2JqZWN0IG9mIHRoZSBjdXJyZW50IGRvY3VtZW50IGZvciBhbiB1c2FnZSBpbiB0aGUgdmlld1xuICAgICAqXG4gICAgICogQHJldHVybnMge3tkb2N1bWVudDoge319fVxuICAgICAqL1xuICAgIHRvRGF0YTogZnVuY3Rpb24gbURvY3VtZW50dG9EYXRhKCkge1xuICAgICAgdmFyIHJldHVybk9iamVjdCA9IHtcbiAgICAgICAgZG9jdW1lbnQ6IHt9XG4gICAgICB9O1xuICAgICAgcmV0dXJuT2JqZWN0LmRvY3VtZW50LnByb3BlcnRpZXMgPSB0aGlzLmdldFNlcnZlclByb3BlcnRpZXMoKTtcbiAgICAgIHJldHVybk9iamVjdC5tZW51cyA9IHRoaXMuZ2V0KFwibWVudXNcIikudG9KU09OKCk7XG4gICAgICByZXR1cm5PYmplY3QudGVtcGxhdGVzID0gdGhpcy5nZXQoXCJ0ZW1wbGF0ZXNcIik7XG4gICAgICByZXR1cm4gcmV0dXJuT2JqZWN0O1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm4gYWxsIHRoZSB2YWx1ZXMgb2YgdGhlIGN1cnJlbnQgZG9jdW1lbnRcbiAgICAgKiBAdmFyIG9ubHlNb2RpZmllZFxuICAgICAqIEByZXR1cm5zIHt7fX1cbiAgICAgKi9cbiAgICBnZXRWYWx1ZXM6IGZ1bmN0aW9uIG1Eb2N1bWVudGRvY3VtZW50R2V0VmFsdWVzKG9ubHlNb2RpZmllZCkge1xuICAgICAgdmFyIHZhbHVlcyA9IHt9O1xuICAgICAgaWYgKCF0aGlzLmdldChcImF0dHJpYnV0ZXNcIikpIHtcbiAgICAgICAgcmV0dXJuIHZhbHVlcztcbiAgICAgIH1cbiAgICAgIHRoaXMuZ2V0KFwiYXR0cmlidXRlc1wiKS5lYWNoKGZ1bmN0aW9uIG1Eb2N1bWVudEdldFZhbHVlKGN1cnJlbnRBdHRyaWJ1dGUpIHtcbiAgICAgICAgdmFyIGN1cnJlbnRWYWx1ZSA9IGN1cnJlbnRBdHRyaWJ1dGUuZ2V0KFwiYXR0cmlidXRlVmFsdWVcIiksXG4gICAgICAgICAgaSxcbiAgICAgICAgICBhcnJheVZhbHVlcyA9IFtdO1xuICAgICAgICBpZiAoXG4gICAgICAgICAgY3VycmVudFZhbHVlID09PSBudWxsIHx8XG4gICAgICAgICAgIWN1cnJlbnRBdHRyaWJ1dGUuZ2V0KFwiaXNWYWx1ZUF0dHJpYnV0ZVwiKVxuICAgICAgICApIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKFxuICAgICAgICAgIG9ubHlNb2RpZmllZCA9PT0gdHJ1ZSAmJlxuICAgICAgICAgIGN1cnJlbnRBdHRyaWJ1dGUuaGFzVmFsdWVDaGFuZ2VkKCkgPT09IGZhbHNlXG4gICAgICAgICkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY3VycmVudEF0dHJpYnV0ZS5nZXQoXCJtdWx0aXBsZVwiKSkge1xuICAgICAgICAgIGN1cnJlbnRWYWx1ZSA9IF8udG9BcnJheShjdXJyZW50VmFsdWUpO1xuICAgICAgICAgIGlmIChjdXJyZW50VmFsdWUubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGN1cnJlbnRWYWx1ZS5sZW5ndGg7IGkgKz0gMSkge1xuICAgICAgICAgICAgICBhcnJheVZhbHVlcy5wdXNoKGN1cnJlbnRWYWx1ZVtpXSB8fCB7IHZhbHVlOiBudWxsIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBhcnJheVZhbHVlcyA9IFtdOyAvL3t2YWx1ZTogbnVsbH07XG4gICAgICAgICAgfVxuICAgICAgICAgIHZhbHVlc1tjdXJyZW50QXR0cmlidXRlLmlkXSA9IGFycmF5VmFsdWVzO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHZhbHVlc1tjdXJyZW50QXR0cmlidXRlLmlkXSA9IGN1cnJlbnRWYWx1ZTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICByZXR1cm4gdmFsdWVzO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiByZXNldCBhbGwgdmFsdWVzIHdpdGggYSBuZXcgc2V0IG9mIHZhbHVlc1xuICAgICAqL1xuICAgIHNldFZhbHVlczogZnVuY3Rpb24gbURvY3VtZW50ZG9jdW1lbnRTZXRWYWx1ZXModmFsdWVzKSB7XG4gICAgICB0aGlzLmdldChcImF0dHJpYnV0ZXNcIikuZWFjaChmdW5jdGlvbiBtRG9jdW1lbnRTZXRWYWx1ZShjdXJyZW50QXR0cmlidXRlKSB7XG4gICAgICAgIHZhciBuZXdWYWx1ZSA9IHZhbHVlc1tjdXJyZW50QXR0cmlidXRlLmlkXTtcbiAgICAgICAgaWYgKCFjdXJyZW50QXR0cmlidXRlLmdldChcImlzVmFsdWVBdHRyaWJ1dGVcIikpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY3VycmVudEF0dHJpYnV0ZS5zZXQoXCJhdHRyaWJ1dGVWYWx1ZVwiLCBuZXdWYWx1ZSk7XG4gICAgICAgIC8vIHJlc2V0IGNoYW5nZSBhbHNvXG4gICAgICAgIGN1cnJlbnRBdHRyaWJ1dGUuY2hhbmdlZCA9IHt9O1xuICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIHJlc2V0IGFsbCBwcm9wZXJ0aWVzIHdpdGggYSBuZXcgc2V0IG9mIHByb3BlcnRpZXNcbiAgICAgKi9cbiAgICBzZXRQcm9wZXJ0aWVzOiBmdW5jdGlvbiBtRG9jdW1lbnRkb2N1bWVudFNldFByb3BlcnRpZXModmFsdWVzKSB7XG4gICAgICB2YXIgbW9kZWwgPSB0aGlzO1xuICAgICAgXy5lYWNoKHZhbHVlcywgZnVuY3Rpb24gbURvY3VtZW50U2V0UHJvcGVydGllcyh2YWx1ZSwga2V5KSB7XG4gICAgICAgIG1vZGVsLmdldChcInByb3BlcnRpZXNcIikuc2V0KGtleSwgdmFsdWUpO1xuICAgICAgfSk7XG4gICAgfSxcblxuICAgIGxvY2tEb2N1bWVudDogZnVuY3Rpb24gbURvY3VtZW50TG9ja0RvY3VtZW50KCkge1xuICAgICAgdmFyIGRvY01vZGVsID0gdGhpcztcbiAgICAgIHZhciBsb2NrTW9kZWwgPSBuZXcgRG9jdW1lbnRMb2NrKHtcbiAgICAgICAgaW5pdGlkOiB0aGlzLmdldChcImluaXRpZFwiKSxcbiAgICAgICAgdHlwZTogXCJwZXJtYW5lbnRcIlxuICAgICAgfSk7XG4gICAgICB2YXIgc2VjdXJpdHkgPSB0aGlzLmdldChcInByb3BlcnRpZXNcIikuZ2V0KFwic2VjdXJpdHlcIik7XG4gICAgICBsb2NrTW9kZWwuc2F2ZShcbiAgICAgICAge30sXG4gICAgICAgIHtcbiAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiBtRG9jdW1lbnRMb2NrRG9jdW1lbnRTdWNjZXNzKHRoZU1vZGVsLCBkYXRhKSB7XG4gICAgICAgICAgICB2YXIgbWVudSA9IGRvY01vZGVsLmdldChcIm1lbnVzXCIpO1xuICAgICAgICAgICAgc2VjdXJpdHkubG9jayA9IGRhdGEuZGF0YS5sb2NrO1xuICAgICAgICAgICAgZG9jTW9kZWwuZ2V0KFwicHJvcGVydGllc1wiKS5zZXQoXCJzZWN1cml0eSxcIiwgc2VjdXJpdHkpO1xuXG4gICAgICAgICAgICBtZW51LnNldE1lbnUoXCJsb2NrXCIsIFwidmlzaWJpbGl0eVwiLCBcImhpZGRlblwiKTtcbiAgICAgICAgICAgIG1lbnUuc2V0TWVudShcInVubG9ja1wiLCBcInZpc2liaWxpdHlcIiwgXCJ2aXNpYmxlXCIpO1xuXG4gICAgICAgICAgICBkb2NNb2RlbC5nZXQoXCJwcm9wZXJ0aWVzXCIpLnRyaWdnZXIoXCJjaGFuZ2VcIik7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gbURvY3VtZW50TG9ja0RvY3VtZW50RXJyb3IodGhlTW9kZWwsIEh0dHBSZXNwb25zZSkge1xuICAgICAgICAgICAgdmFyIHJlc3BvbnNlID0gSlNPTi5wYXJzZShIdHRwUmVzcG9uc2UucmVzcG9uc2VUZXh0KTtcblxuICAgICAgICAgICAgZG9jTW9kZWwudHJpZ2dlcihcInNob3dFcnJvclwiLCB7XG4gICAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5leGNlcHRpb25NZXNzYWdlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgfSxcblxuICAgIHVubG9ja0RvY3VtZW50OiBmdW5jdGlvbiBtRG9jdW1lbnRVbkxvY2tEb2N1bWVudCgpIHtcbiAgICAgIHZhciBkb2NNb2RlbCA9IHRoaXM7XG4gICAgICAvLyAgdHlwZSA9IGVtcHR5IG1lYW5zIERlbGV0ZSBhbGwgbG9ja3NcbiAgICAgIHZhciBsb2NrTW9kZWwgPSBuZXcgRG9jdW1lbnRMb2NrKHtcbiAgICAgICAgaW5pdGlkOiB0aGlzLmdldChcImluaXRpZFwiKSxcbiAgICAgICAgdHlwZTogXCJcIlxuICAgICAgfSk7XG4gICAgICB2YXIgc2VjdXJpdHkgPSB0aGlzLmdldChcInByb3BlcnRpZXNcIikuZ2V0KFwic2VjdXJpdHlcIik7XG4gICAgICBsb2NrTW9kZWwuZGVzdHJveSh7XG4gICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIG1Eb2N1bWVudFVuTG9ja0RvY3VtZW50U3VjY2VzcygpIHtcbiAgICAgICAgICB2YXIgbWVudSA9IGRvY01vZGVsLmdldChcIm1lbnVzXCIpO1xuICAgICAgICAgIHNlY3VyaXR5LmxvY2sgPSB7XG4gICAgICAgICAgICBsb2NrZWRCeToge1xuICAgICAgICAgICAgICBpZDogMFxuICAgICAgICAgICAgfVxuICAgICAgICAgIH07XG4gICAgICAgICAgZG9jTW9kZWwuZ2V0KFwicHJvcGVydGllc1wiKS5zZXQoXCJzZWN1cml0eSxcIiwgc2VjdXJpdHkpO1xuXG4gICAgICAgICAgbWVudS5zZXRNZW51KFwibG9ja1wiLCBcInZpc2liaWxpdHlcIiwgXCJ2aXNpYmxlXCIpO1xuICAgICAgICAgIG1lbnUuc2V0TWVudShcInVubG9ja1wiLCBcInZpc2liaWxpdHlcIiwgXCJoaWRkZW5cIik7XG4gICAgICAgICAgZG9jTW9kZWwuZ2V0KFwicHJvcGVydGllc1wiKS50cmlnZ2VyKFwiY2hhbmdlXCIpO1xuICAgICAgICB9LFxuICAgICAgICBlcnJvcjogZnVuY3Rpb24gbURvY3VtZW50VW5Mb2NrRG9jdW1lbnRFcnJvcih0aGVNb2RlbCwgSHR0cFJlc3BvbnNlKSB7XG4gICAgICAgICAgdmFyIHJlc3BvbnNlID0gSlNPTi5wYXJzZShIdHRwUmVzcG9uc2UucmVzcG9uc2VUZXh0KTtcblxuICAgICAgICAgIGRvY01vZGVsLnRyaWdnZXIoXCJzaG93RXJyb3JcIiwge1xuICAgICAgICAgICAgdGl0bGU6IHJlc3BvbnNlLmV4Y2VwdGlvbk1lc3NhZ2VcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSxcbiAgICAvKipcbiAgICAgKiBHZXQgYSBwbGFpbiBvYmplY3Qgd2l0aCBwcm9wZXJ0aWVzIG9mIHRoZSBkb2N1bWVudFxuICAgICAqXG4gICAgICogQHJldHVybnMgeyp9XG4gICAgICovXG4gICAgZ2V0TW9kZWxQcm9wZXJ0aWVzOiBmdW5jdGlvbiBtRG9jdW1lbnRkb2N1bWVudEdldFByb3BlcnRpZXMoKSB7XG4gICAgICB2YXIgcHJvcGVydGllcyA9IHt9O1xuICAgICAgaWYgKHRoaXMuZ2V0KFwicHJvcGVydGllc1wiKSkge1xuICAgICAgICBwcm9wZXJ0aWVzID0gdGhpcy5nZXQoXCJwcm9wZXJ0aWVzXCIpLnRvSlNPTigpO1xuICAgICAgfVxuICAgICAgcHJvcGVydGllcy5pbml0aWQgPSB0aGlzLmdldChcImluaXRpZFwiKTtcbiAgICAgIHByb3BlcnRpZXMucmV2aXNpb24gPSB0aGlzLmdldChcInJldmlzaW9uXCIpO1xuICAgICAgcHJvcGVydGllcy52aWV3SWQgPSB0aGlzLmdldChcInZpZXdJZFwiKTtcbiAgICAgIHByb3BlcnRpZXMucmVuZGVyTW9kZSA9IHRoaXMuZ2V0KFwicmVuZGVyTW9kZVwiKTtcblxuICAgICAgcmV0dXJuIHByb3BlcnRpZXM7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEdldCB0aGUgaW5pdGlhbCBwcm9wZXJ0aWVzIGFzIHRyYW5zZmVyZWQgYnkgdGhlIHNlcnZlclxuICAgICAqIEByZXR1cm5zIHsqfHtyZXZpc2lvbiwgdmlld0lkLCByZW5kZXJNb2RlLCBwcm9wZXJ0aWVzLCBtZW51cywgYXR0cmlidXRlc318e3Jlc2l6ZU1hcmdpbkhlaWdodCwgcmVzaXplTWFyZ2luV2lkdGgsIHJlc2l6ZURlYm91bmNlVGltZSwgd2l0aG91dFJlc2l6ZSwgZXZlbnRQcmVmaXh9fHtjb250ZW50fXx7dGl0bGUsIGlzVmFsdWVBdHRyaWJ1dGUsIHBhcmVudCwgbW9kZSwgZXJyb3JNZXNzYWdlfXx7ZG9jdW1lbnRJZCwgZG9jdW1lbnRNb2RlbCwgc3RhdGUsIGF0dHJpYnV0ZXN9fVxuICAgICAqL1xuICAgIGdldFNlcnZlclByb3BlcnRpZXM6IGZ1bmN0aW9uIG1Eb2N1bWVudF9nZXRDdXJyZW50UHJvcGVydGllcygpIHtcbiAgICAgIHZhciBwcm9wZXJ0aWVzO1xuICAgICAgcHJvcGVydGllcyA9IHRoaXMuaW5pdGlhbFByb3BlcnRpZXM7XG4gICAgICBpZiAocHJvcGVydGllcykge1xuICAgICAgICBwcm9wZXJ0aWVzLmhhc1VwbG9hZGluZ0ZpbGVzID0gdGhpcy5oYXNVcGxvYWRpbmdGaWxlKCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gcHJvcGVydGllcztcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogSW5kaWNhdGUgaWYgb25lIGF0dHJpYnV0ZSBvZiB0aGUgZG9jdW1lbnQgaXMgbW9kaWZpZWRcbiAgICAgKlxuICAgICAqIEByZXR1cm5zIHsqfGJvb2xlYW59XG4gICAgICovXG4gICAgaXNNb2RpZmllZDogZnVuY3Rpb24gbURvY3VtZW50X2lzTW9kaWZpZWQoKSB7XG4gICAgICByZXR1cm4gdGhpcy5oYXNBdHRyaWJ1dGVzQ2hhbmdlZCgpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBHZXQgZG9jdW1lbnQgcHJvcGVydGllcywgdmFsdWVzIGFuZCBsYWJlbHMgb2YgYXR0cmlidXRlc1xuICAgICAqL1xuICAgIGdldERvY3VtZW50RGF0YTogZnVuY3Rpb24gbURvY3VtZW50R2V0RG9jdW1lbnREYXRhKCkge1xuICAgICAgdmFyIGRvY3VtZW50RGF0YSA9IHtcbiAgICAgICAgcHJvcGVydGllczogdGhpcy5nZXRNb2RlbFByb3BlcnRpZXMoKSxcbiAgICAgICAgYXR0cmlidXRlVmFsdWVzOiB0aGlzLmdldFZhbHVlcyhmYWxzZSksXG4gICAgICAgIGF0dHJpYnV0ZUxhYmVsczoge30sXG4gICAgICAgIGNyZWF0ZUF0dHJpYnV0ZVZpZXc6IGZ1bmN0aW9uIG1Eb2N1bWVudEdldERvY3VtZW50RGF0YUNyZWF0ZSgpIHtcbiAgICAgICAgICByZXR1cm4gdGhpcy5pZDtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIHRoaXMuZ2V0KFwiYXR0cmlidXRlc1wiKS5lYWNoKGZ1bmN0aW9uIG1Eb2N1bWVudEdldERvY3VtZW50RGF0YUVhY2goXG4gICAgICAgIGN1cnJlbnRBdHRyaWJ1dGVcbiAgICAgICkge1xuICAgICAgICBkb2N1bWVudERhdGEuYXR0cmlidXRlTGFiZWxzW1xuICAgICAgICAgIGN1cnJlbnRBdHRyaWJ1dGUuaWRcbiAgICAgICAgXSA9IGN1cnJlbnRBdHRyaWJ1dGUuZ2V0KFwibGFiZWxcIik7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBkb2N1bWVudERhdGE7XG4gICAgfSxcbiAgICAvKipcbiAgICAgKiBSZXR1cm4gdHJ1ZSBpZiBvbmUgdGhlIGF0dHJpYnV0ZSBvZiB0aGUgZG9jdW1lbnQgaGFzQ2hhbmdlZFxuICAgICAqXG4gICAgICogQHJldHVybnMge2Jvb2xlYW58Kn1cbiAgICAgKi9cbiAgICBoYXNBdHRyaWJ1dGVzQ2hhbmdlZDogZnVuY3Rpb24gbURvY3VtZW50aGFzQXR0cmlidXRlc0NoYW5nZWQoKSB7XG4gICAgICBpZiAoIXRoaXMuZ2V0KFwiYXR0cmlidXRlc1wiKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICByZXR1cm4gdGhpcy5nZXQoXCJhdHRyaWJ1dGVzXCIpLnNvbWUoXG4gICAgICAgIGZ1bmN0aW9uIG1Eb2N1bWVudGhhc0F0dHJpYnV0ZXNDaGFuZ2VkU29tZShjdXJyZW50QXR0cikge1xuICAgICAgICAgIHJldHVybiBjdXJyZW50QXR0ci5oYXNWYWx1ZUNoYW5nZWQoKTtcbiAgICAgICAgfVxuICAgICAgKTtcbiAgICB9LFxuXG4gICAgaGFzVXBsb2FkaW5nRmlsZTogZnVuY3Rpb24gbWRvY3VtZW50aGFzVXBsb2FkaW5nRmlsZSgpIHtcbiAgICAgIHJldHVybiB0aGlzLl91cGxvYWRpbmdGaWxlID4gMDtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQW5hbHl6ZSByZXR1cm4gaW4gY2FzZSBvZiBzeW5jIHVuY29tcGxldGUgYW5kIHRyaWdnZXIgZXZlbnQgZXJyb3JcbiAgICAgKlxuICAgICAqIEBwYXJhbSBtb2RlbFxuICAgICAqIEBwYXJhbSB4aHJcbiAgICAgKi9cbiAgICBwcm9wYWdhdGVTeW5jaHJvRXJyb3I6IGZ1bmN0aW9uIG1Eb2N1bWVudHByb3BhZ2F0ZVN5bmNocm9FcnJvcihtb2RlbCwgeGhyKSB7XG4gICAgICB2YXIgYXR0ck1vZGVsLFxuICAgICAgICBjdXJyZW50TW9kZWwgPSB0aGlzLFxuICAgICAgICBwYXJzZWRSZXR1cm4sXG4gICAgICAgIGVycm9yQ29kZSA9IG51bGwsXG4gICAgICAgIHRpdGxlID0gXCJcIixcbiAgICAgICAgcHJvcGVydGllcztcbiAgICAgIC8vQW5hbHl6ZSBYSFJcbiAgICAgIHZhciBtZXNzYWdlcyA9IFtdO1xuICAgICAgdmFyIHJlc3VsdDtcbiAgICAgIHRyeSB7XG4gICAgICAgIGlmICgheGhyKSB7XG4gICAgICAgICAgaWYgKG1vZGVsICYmIG1vZGVsLm1lc3NhZ2UpIHtcbiAgICAgICAgICAgIG1lc3NhZ2VzLnB1c2goeyB0eXBlOiBcImVycm9yXCIsIGNvbnRlbnRUZXh0OiBtb2RlbC5tZXNzYWdlIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICB4aHIgPSB7IHN0YXR1czogNTAwLCBzdGF0dXNUZXh0OiBcIkludGVybmFsIC0gTm8gSFRUUCByZXNwb25zZVwiIH07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmVzdWx0ID0gSlNPTi5wYXJzZSh4aHIucmVzcG9uc2VUZXh0KTtcbiAgICAgICAgICBpZiAocmVzdWx0Lm1lc3NhZ2UpIHtcbiAgICAgICAgICAgIG1lc3NhZ2VzLnB1c2gocmVzdWx0KTtcbiAgICAgICAgICB9IGVsc2UgaWYgKHJlc3VsdC5tZXNzYWdlcykge1xuICAgICAgICAgICAgbWVzc2FnZXMgPSByZXN1bHQubWVzc2FnZXM7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIC8vVW5hYmxlIHRvIHBhcnNlIHJlc3BvbnNlVGV4dCAoZXJyb3IgaXMgbm90IGluIEpTT04pXG4gICAgICAgIHRoaXMuY2xlYW5FcnJvck1lc3NhZ2VzKCk7XG4gICAgICAgIGlmICh3aW5kb3cuZGNwLmxvZ2dlcikge1xuICAgICAgICAgIHdpbmRvdy5kY3AubG9nZ2VyKGUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7XG4gICAgICAgIH1cbiAgICAgICAgcHJvcGVydGllcyA9IGN1cnJlbnRNb2RlbC5nZXRTZXJ2ZXJQcm9wZXJ0aWVzKCk7XG4gICAgICAgIGlmICghcHJvcGVydGllcyB8fCAhcHJvcGVydGllcy5pbml0aWQpIHtcbiAgICAgICAgICAvL0ZpcnN0IGxvYWRpbmcsIHVuYWJsZSB0byBsb2FkIGRpc3BsYXkgcmVsb2FkIGlmcmFtZSBwYW5lbFxuICAgICAgICAgIGN1cnJlbnRNb2RlbC50cmlnZ2VyKFwiZGlzcGxheU5ldHdvcmtFcnJvclwiKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgLy9UaGVyZSBpcyBhbiBpbml0ZCwgc28gdGhlcmUgaXMgYSBkb2N1bWVudFxuICAgICAgICAvL1dlIGRpc3BsYXkgYSBtZXNzYWdlIGFuZCBsZXQgdGhlIHVzZXIgdHJ5IGFnYWluXG4gICAgICAgIC8vU3RhdHVzIDAgaW5kaWNhdGUgb2ZmbGluZSBicm93c2VyXG4gICAgICAgIGlmICh4aHIgJiYgeGhyLnN0YXR1cyA9PT0gMCkge1xuICAgICAgICAgIGN1cnJlbnRNb2RlbC50cmlnZ2VyKFwic2hvd0Vycm9yXCIsIHtcbiAgICAgICAgICAgIGVycm9yQ29kZTogXCJvZmZsaW5lXCIsXG4gICAgICAgICAgICB0aXRsZTogaTE4bi5fX18oXCJZb3VyIG5hdmlnYXRvciBzZWVtcyBvZmZsaW5lLCB0cnkgbGF0ZXJcIiwgXCJkZHVpXCIpXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY3VycmVudE1vZGVsLnRyaWdnZXIoXCJzaG93RXJyb3JcIiwge1xuICAgICAgICAgICAgZXJyb3JDb2RlOiBcInVuYWJsZVRvUGFyc2VKc29uXCIsXG4gICAgICAgICAgICB0aXRsZTogaTE4bi5fX18oXCJTZXJ2ZXIgcmV0dXJuIHVucmVhZGFibGVcIiwgXCJkZHVpXCIpXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgY3VycmVudE1vZGVsLnNldFByb3BlcnRpZXMocHJvcGVydGllcyk7XG4gICAgICAgIHRoaXMudHJpZ2dlcihcImRkdWlEb2N1bWVudERpc3BsYXlWaWV3XCIpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHBhcnNlZFJldHVybiA9IHtcbiAgICAgICAgbWVzc2FnZXM6IG1lc3NhZ2VzIHx8IFtdLFxuICAgICAgICByZXNwb25zZVRleHQ6IFwiVW5leHBlY3RlZCBlcnJvcjogXCIgKyB4aHIuc3RhdHVzICsgXCIgXCIgKyB4aHIuc3RhdHVzVGV4dFxuICAgICAgfTtcblxuICAgICAgdGhpcy5jbGVhbkVycm9yTWVzc2FnZXMoKTtcbiAgICAgIGlmIChwYXJzZWRSZXR1cm4ubWVzc2FnZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIGlmIChyZXN1bHQgJiYgcmVzdWx0LmV4Y2VwdGlvbk1lc3NhZ2UpIHtcbiAgICAgICAgICBwYXJzZWRSZXR1cm4ucmVzcG9uc2VUZXh0ID0gcmVzdWx0LmV4Y2VwdGlvbk1lc3NhZ2U7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoY3VycmVudE1vZGVsLmdldChcInByb3BlcnRpZXNcIikpIHtcbiAgICAgICAgICB0aXRsZSA9IGN1cnJlbnRNb2RlbC5nZXQoXCJwcm9wZXJ0aWVzXCIpLmdldChcInRpdGxlXCIpO1xuICAgICAgICB9XG4gICAgICAgIGN1cnJlbnRNb2RlbC50cmlnZ2VyKFwic2hvd0Vycm9yXCIsIHtcbiAgICAgICAgICBlcnJvckNvZGU6IGVycm9yQ29kZSxcbiAgICAgICAgICB0aXRsZTogaTE4bi5fX18oXCJVbmV4cGVjdGVkIGVycm9yIFwiLCBcImRkdWlcIikgKyBcIiA6IFwiICsgdGl0bGUsXG4gICAgICAgICAgbWVzc2FnZTogcGFyc2VkUmV0dXJuLnJlc3BvbnNlVGV4dFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIF8uZWFjaChcbiAgICAgICAgcGFyc2VkUmV0dXJuLm1lc3NhZ2VzLFxuICAgICAgICBmdW5jdGlvbiBtRG9jdW1lbnRwcm9wYWdhdGVTeW5jaHJvRXJyb3JNZXNzYWdlcyhtZXNzYWdlKSB7XG4gICAgICAgICAgc3dpdGNoIChtZXNzYWdlLmNvZGUpIHtcbiAgICAgICAgICAgIGNhc2UgXCJST1VURVMwMTA3XCI6IC8vIFN5bnRheCBFcnJvclxuICAgICAgICAgICAgICBpZiAobWVzc2FnZS5kYXRhICYmIG1lc3NhZ2UuZGF0YS5pZCkge1xuICAgICAgICAgICAgICAgIGF0dHJNb2RlbCA9IGN1cnJlbnRNb2RlbC5nZXQoXCJhdHRyaWJ1dGVzXCIpLmdldChtZXNzYWdlLmRhdGEuaWQpO1xuICAgICAgICAgICAgICAgIGlmIChhdHRyTW9kZWwpIHtcbiAgICAgICAgICAgICAgICAgIGF0dHJNb2RlbC5zZXRFcnJvck1lc3NhZ2UoXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UuZGF0YS5lcnIsXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UuZGF0YS5pbmRleFxuICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgIGN1cnJlbnRNb2RlbC50cmlnZ2VyKFwic2hvd0Vycm9yXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IG1lc3NhZ2UuY29udGVudFRleHQsXG4gICAgICAgICAgICAgICAgICAgIGh0bWxNZXNzYWdlOiBtZXNzYWdlLmNvbnRlbnRIdG1sLFxuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOlxuICAgICAgICAgICAgICAgICAgICAgIGF0dHJNb2RlbC5hdHRyaWJ1dGVzLmxhYmVsICsgXCIgOiBcIiArIG1lc3NhZ2UuZGF0YS5lcnIsXG4gICAgICAgICAgICAgICAgICAgIGVycm9yQ29kZTogbWVzc2FnZS5jb2RlXG4gICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgY3VycmVudE1vZGVsLnRyaWdnZXIoXCJzaG93RXJyb3JcIiwge1xuICAgICAgICAgICAgICAgICAgICB0aXRsZTogbWVzc2FnZS5jb250ZW50VGV4dCxcbiAgICAgICAgICAgICAgICAgICAgaHRtbE1lc3NhZ2U6IG1lc3NhZ2UuY29udGVudEh0bWwsXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IG1lc3NhZ2UuZGF0YS5lcnIsXG4gICAgICAgICAgICAgICAgICAgIGVycm9yQ29kZTogbWVzc2FnZS5jb2RlXG4gICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiUk9VVEVTMDEwOVwiOiAvLyBDb25zdHJhaW50IEVycm9yXG4gICAgICAgICAgICAgIGlmIChtZXNzYWdlLmRhdGEgJiYgbWVzc2FnZS5kYXRhLmNvbnN0cmFpbnQpIHtcbiAgICAgICAgICAgICAgICBfLmVhY2goXG4gICAgICAgICAgICAgICAgICBtZXNzYWdlLmRhdGEuY29uc3RyYWludCxcbiAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIG1Eb2N1bWVudHByb3BhZ2F0ZVN5bmNocm9FcnJvcjAyMTIoY29uc3RyYWludCkge1xuICAgICAgICAgICAgICAgICAgICBhdHRyTW9kZWwgPSBjdXJyZW50TW9kZWxcbiAgICAgICAgICAgICAgICAgICAgICAuZ2V0KFwiYXR0cmlidXRlc1wiKVxuICAgICAgICAgICAgICAgICAgICAgIC5nZXQoY29uc3RyYWludC5pZCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChhdHRyTW9kZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgICBhdHRyTW9kZWwuc2V0RXJyb3JNZXNzYWdlKFxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3RyYWludC5lcnIsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdHJhaW50LmluZGV4XG4gICAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50TW9kZWwudHJpZ2dlcihcInNob3dFcnJvclwiLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogbWVzc2FnZS5jb250ZW50VGV4dCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGh0bWxNZXNzYWdlOiBtZXNzYWdlLmNvbnRlbnRIdG1sLFxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgYXR0ck1vZGVsLmF0dHJpYnV0ZXMubGFiZWwgKyBcIiA6IFwiICsgY29uc3RyYWludC5lcnIsXG4gICAgICAgICAgICAgICAgICAgICAgICBlcnJvckNvZGU6IG1lc3NhZ2UuY29kZVxuICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRNb2RlbC50cmlnZ2VyKFwic2hvd0Vycm9yXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiBtZXNzYWdlLmNvbnRlbnRUZXh0LFxuICAgICAgICAgICAgICAgICAgICAgICAgaHRtbE1lc3NhZ2U6IG1lc3NhZ2UuY29udGVudEh0bWwsXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBjb25zdHJhaW50LmVycixcbiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yQ29kZTogbWVzc2FnZS5jb2RlXG4gICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGlmIChtZXNzYWdlLmRhdGEgJiYgbWVzc2FnZS5kYXRhLnByZVN0b3JlKSB7XG4gICAgICAgICAgICAgICAgY3VycmVudE1vZGVsLnRyaWdnZXIoXCJzaG93RXJyb3JcIiwge1xuICAgICAgICAgICAgICAgICAgdGl0bGU6IG1lc3NhZ2UuY29udGVudFRleHQsXG4gICAgICAgICAgICAgICAgICBodG1sTWVzc2FnZTogbWVzc2FnZS5jb250ZW50SHRtbCxcbiAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IG1lc3NhZ2UuZGF0YS5wcmVTdG9yZSxcbiAgICAgICAgICAgICAgICAgIGVycm9yQ29kZTogbWVzc2FnZS5jb2RlXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgIGlmIChtZXNzYWdlLmV4Y2VwdGlvbk1lc3NhZ2UpIHtcbiAgICAgICAgICAgICAgICBjdXJyZW50TW9kZWwudHJpZ2dlcihcInNob3dFcnJvclwiLCB7XG4gICAgICAgICAgICAgICAgICB0aXRsZTpcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5tZXNzYWdlICsgXCIgXCIgKyAobWVzc2FnZS5jb2RlID8gbWVzc2FnZS5jb2RlIDogXCJcIiksXG4gICAgICAgICAgICAgICAgICBlcnJvckNvZGU6IG1lc3NhZ2UuY29kZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLnR5cGUgPT09IFwiZXJyb3JcIiAmJiBtZXNzYWdlLmNvbnRlbnRUZXh0KSB7XG4gICAgICAgICAgICAgICAgICBjdXJyZW50TW9kZWwudHJpZ2dlcihcInNob3dFcnJvclwiLCB7XG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOlxuICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UuY29udGVudFRleHQgK1xuICAgICAgICAgICAgICAgICAgICAgIFwiIFwiICtcbiAgICAgICAgICAgICAgICAgICAgICAobWVzc2FnZS5jb2RlID8gbWVzc2FnZS5jb2RlIDogXCJcIiksXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IG1lc3NhZ2UudHlwZSxcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogbWVzc2FnZS5jb250ZW50VGV4dCxcbiAgICAgICAgICAgICAgICAgICAgaHRtbE1lc3NhZ2U6IG1lc3NhZ2UuY29udGVudEh0bWwsXG4gICAgICAgICAgICAgICAgICAgIGVycm9yQ29kZTogbWVzc2FnZS5jb2RlXG4gICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UudHlwZSAmJiBtZXNzYWdlLmNvbnRlbnRUZXh0KSB7XG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnRNb2RlbC50cmlnZ2VyKFwic2hvd01lc3NhZ2VcIiwge1xuICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOlxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5jb250ZW50VGV4dCArXG4gICAgICAgICAgICAgICAgICAgICAgICBcIiBcIiArXG4gICAgICAgICAgICAgICAgICAgICAgICAobWVzc2FnZS5jb2RlID8gbWVzc2FnZS5jb2RlIDogXCJcIiksXG4gICAgICAgICAgICAgICAgICAgICAgdHlwZTogbWVzc2FnZS50eXBlLFxuICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IG1lc3NhZ2UuY29udGVudFRleHQsXG4gICAgICAgICAgICAgICAgICAgICAgaHRtbE1lc3NhZ2U6IG1lc3NhZ2UuY29udGVudEh0bWwsXG4gICAgICAgICAgICAgICAgICAgICAgZXJyb3JDb2RlOiBtZXNzYWdlLmNvZGVcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3JcIiwgbWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICApO1xuICAgICAgdGhpcy50cmlnZ2VyKFwiZGR1aURvY3VtZW50RGlzcGxheVZpZXdcIik7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIFZhbGlkYXRlIHRoZSBjb250ZW50IG9mIHRoZSBtb2RlbCBiZWZvcmUgc3luY2hyb1xuICAgICAqL1xuICAgIHZhbGlkYXRlOiBmdW5jdGlvbiBtRG9jdW1lbnR2YWxpZGF0ZShkb2N1bWVudEVsZW1lbnRzLCBvcHRpb25zKSB7XG4gICAgICB2YXIgc3VjY2VzcyA9IHRydWUsXG4gICAgICAgIGN1cnJlbnREb2N1bWVudCA9IHRoaXMsXG4gICAgICAgIGVycm9yTWVzc2FnZSA9IFtdLFxuICAgICAgICBldmVudCA9IHsgcHJldmVudDogZmFsc2UgfSxcbiAgICAgICAgdGVtcGxhdGVNZXNzYWdlLFxuICAgICAgICBlcnJvcjtcbiAgICAgIHRyeSB7XG4gICAgICAgIHRoaXMudHJpZ2dlcihcInZhbGlkYXRlXCIsIGV2ZW50KTtcbiAgICAgICAgaWYgKGV2ZW50LnByZXZlbnQpIHtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdGl0bGU6IFwiVW5hYmxlIHRvIHNhdmVcIlxuICAgICAgICAgIH07XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmdldChcImF0dHJpYnV0ZXNcIikuZWFjaChmdW5jdGlvbiBtRG9jdW1lbnR2YWxpZGF0ZUNsZWFyRXJyb3JFYWNoKFxuICAgICAgICAgIGN1cnJlbnRBdHRyaWJ1dGVcbiAgICAgICAgKSB7XG4gICAgICAgICAgY3VycmVudEF0dHJpYnV0ZS5zZXRFcnJvck1lc3NhZ2UobnVsbCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuZ2V0KFwiYXR0cmlidXRlc1wiKS5lYWNoKGZ1bmN0aW9uIG1Eb2N1bWVudHZhbGlkYXRlRWFjaChcbiAgICAgICAgICBjdXJyZW50QXR0cmlidXRlXG4gICAgICAgICkge1xuICAgICAgICAgIHZhciBwYXJlbnRBdHRyaWJ1dGUgPSBjdXJyZW50RG9jdW1lbnRcbiAgICAgICAgICAgIC5nZXQoXCJhdHRyaWJ1dGVzXCIpXG4gICAgICAgICAgICAuZ2V0KGN1cnJlbnRBdHRyaWJ1dGUuZ2V0KFwicGFyZW50XCIpKTtcblxuICAgICAgICAgIGlmIChjdXJyZW50QXR0cmlidXRlLmdldChcIm5lZWRlZFwiKSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgdmFyIGN1cnJlbnRWYWx1ZSA9IGN1cnJlbnRBdHRyaWJ1dGUuZ2V0KFwiYXR0cmlidXRlVmFsdWVcIiksXG4gICAgICAgICAgICAgIG9uZVN1Y2Nlc3MgPSB0cnVlO1xuXG4gICAgICAgICAgICBpZiAoY3VycmVudEF0dHJpYnV0ZS5nZXQoXCJtdWx0aXBsZVwiKSkge1xuICAgICAgICAgICAgICBpZiAocGFyZW50QXR0cmlidXRlLmdldChcInR5cGVcIikgPT09IFwiYXJyYXlcIikge1xuICAgICAgICAgICAgICAgIC8vIFZlcmlmeSBlYWNoIGluZGV4XG4gICAgICAgICAgICAgICAgXy5lYWNoKGN1cnJlbnRWYWx1ZSwgZnVuY3Rpb24gbURvY3VtZW50dmFsaWRhdGVBcnJheShcbiAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZVZhbHVlLFxuICAgICAgICAgICAgICAgICAgaW5kZXhcbiAgICAgICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICAgIC8vSWYgdGhlIGF0dHJpYnV0ZSBpcyBtdWx0aXBsZSB3ZSBjaGVjayBpZiB0aGUgYXJyYXkgaGFzIGEgc2l6ZSBzdXBlcmlvciB0byAwXG4gICAgICAgICAgICAgICAgICBpZiAoXy5pc0FycmF5KGF0dHJpYnV0ZVZhbHVlKSAmJiBhdHRyaWJ1dGVWYWx1ZS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgICAgICAgKCFhdHRyaWJ1dGVWYWx1ZSB8fCAhYXR0cmlidXRlVmFsdWUudmFsdWUpICYmXG4gICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZVZhbHVlLnZhbHVlICE9PSAwXG4gICAgICAgICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudEF0dHJpYnV0ZS5zZXRFcnJvck1lc3NhZ2UoXG4gICAgICAgICAgICAgICAgICAgICAgaTE4bi5fX18oXCJFbXB0eSB2YWx1ZSBub3QgYWxsb3dlZFwiLCBcImRkdWlcIiksXG4gICAgICAgICAgICAgICAgICAgICAgaW5kZXhcbiAgICAgICAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZU1lc3NhZ2UgPSBfLnRlbXBsYXRlKFxuICAgICAgICAgICAgICAgICAgICAgIGkxOG4uX19fKFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ7e3BhcmVudExhYmVsfX0gLyB7e2xhYmVsfX0gKHJvdyAjIHt7aW5kZXh9fSkgaXMgbmVlZGVkXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBcImRkdWlcIlxuICAgICAgICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgICAgICAgeyBlc2NhcGU6IC9cXHtcXHsoLis/KVxcfVxcfS9nIH1cbiAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgICAgZXJyb3JNZXNzYWdlLnB1c2goXG4gICAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVNZXNzYWdlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudExhYmVsOiBwYXJlbnRBdHRyaWJ1dGUuZ2V0KFwibGFiZWxcIiksXG4gICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogY3VycmVudEF0dHJpYnV0ZS5nZXQoXCJsYWJlbFwiKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4OiBpbmRleCArIDFcbiAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgICAgICBzdWNjZXNzID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKCFjdXJyZW50VmFsdWUgfHwgY3VycmVudFZhbHVlLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgb25lU3VjY2VzcyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICAgICghY3VycmVudFZhbHVlIHx8ICFjdXJyZW50VmFsdWUudmFsdWUpICYmXG4gICAgICAgICAgICAgICAgY3VycmVudFZhbHVlLnZhbHVlICE9PSAwXG4gICAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgIG9uZVN1Y2Nlc3MgPSBmYWxzZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCFvbmVTdWNjZXNzKSB7XG4gICAgICAgICAgICAgIHRlbXBsYXRlTWVzc2FnZSA9IF8udGVtcGxhdGUoXG4gICAgICAgICAgICAgICAgaTE4bi5fX18oXCJ7e3BhcmVudExhYmVsfX0gLyB7e2xhYmVsfX0gaXMgbmVlZGVkXCIsIFwiZGR1aVwiKSxcbiAgICAgICAgICAgICAgICB7IGVzY2FwZTogL1xce1xceyguKz8pXFx9XFx9L2cgfVxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICBlcnJvck1lc3NhZ2UucHVzaChcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZU1lc3NhZ2Uoe1xuICAgICAgICAgICAgICAgICAgcGFyZW50TGFiZWw6IHBhcmVudEF0dHJpYnV0ZS5nZXQoXCJsYWJlbFwiKSxcbiAgICAgICAgICAgICAgICAgIGxhYmVsOiBjdXJyZW50QXR0cmlidXRlLmdldChcImxhYmVsXCIpXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgY3VycmVudEF0dHJpYnV0ZS5zZXRFcnJvck1lc3NhZ2UoXG4gICAgICAgICAgICAgICAgaTE4bi5fX18oXCJUaGUgZmllbGQgbXVzdCBub3QgYmUgZW1wdHlcIiwgXCJkZHVpXCIpXG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgIHN1Y2Nlc3MgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpZiAoIWN1cnJlbnRBdHRyaWJ1dGUuY2hlY2tDb25zdHJhaW50KHsgY2xlYXJFcnJvcjogZmFsc2UgfSkpIHtcbiAgICAgICAgICAgIHN1Y2Nlc3MgPSBmYWxzZTtcbiAgICAgICAgICAgIGlmIChfLmlzQXJyYXkoY3VycmVudEF0dHJpYnV0ZS5nZXQoXCJlcnJvck1lc3NhZ2VcIikpKSB7XG4gICAgICAgICAgICAgIHRlbXBsYXRlTWVzc2FnZSA9IF8udGVtcGxhdGUoXG4gICAgICAgICAgICAgICAgXCI8JT0gcGFyZW50TGFiZWwgJT4gLyA8JT0gbGFiZWwgJT4gXCIgK1xuICAgICAgICAgICAgICAgICAgXCI8JSBmb3IodmFyIG1zZyBpbiBlcnJvck1lc3NhZ2UpIHsgJT5cIiArXG4gICAgICAgICAgICAgICAgICBcIlxcbjwlLSByb3dUZXh0ICU+IDwlPSBlcnJvck1lc3NhZ2VbbXNnXS5pbmRleCArIDEgJT4gOiA8JT0gZXJyb3JNZXNzYWdlW21zZ10ubWVzc2FnZSAlPlxcbiA8JSB9ICU+IFwiXG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICB0ZW1wbGF0ZU1lc3NhZ2UgPSBfLnRlbXBsYXRlKFxuICAgICAgICAgICAgICAgIFwiPCU9IHBhcmVudExhYmVsICU+IC8gPCU9IGxhYmVsICU+IDwlPSBlcnJvck1lc3NhZ2UgJT5cIlxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZXJyb3JNZXNzYWdlLnB1c2goXG4gICAgICAgICAgICAgIHRlbXBsYXRlTWVzc2FnZSh7XG4gICAgICAgICAgICAgICAgcGFyZW50TGFiZWw6IHBhcmVudEF0dHJpYnV0ZS5nZXQoXCJsYWJlbFwiKSxcbiAgICAgICAgICAgICAgICBsYWJlbDogY3VycmVudEF0dHJpYnV0ZS5nZXQoXCJsYWJlbFwiKSxcbiAgICAgICAgICAgICAgICByb3dUZXh0OiBpMThuLl9fXyhcIlJvdyAjXCIsIFwiZGR1aVwiKSxcbiAgICAgICAgICAgICAgICBlcnJvck1lc3NhZ2U6IGN1cnJlbnRBdHRyaWJ1dGUuZ2V0KFwiZXJyb3JNZXNzYWdlXCIpXG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGlmICghc3VjY2Vzcykge1xuICAgICAgICAgIGVycm9yID0ge1xuICAgICAgICAgICAgdGl0bGU6IGkxOG4uX19fKFwiVW5hYmxlIHRvIHNhdmVcIiwgXCJkZHVpXCIpLFxuICAgICAgICAgICAgbWVzc2FnZTogZXJyb3JNZXNzYWdlLmpvaW4oXCIsIFwiICsgXCJcXG5cIiksXG4gICAgICAgICAgICBlcnJvckNvZGU6IFwiYXR0cmlidXRlTmVlZGVkXCJcbiAgICAgICAgICB9O1xuICAgICAgICAgIGlmIChvcHRpb25zICYmIG9wdGlvbnMuZXJyb3IpIHtcbiAgICAgICAgICAgIG9wdGlvbnMuZXJyb3IoXy5leHRlbmQoeyBldmVudFByZXZlbnRlZDogdHJ1ZSB9LCBlcnJvcikpO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gZXJyb3I7XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIlVuYWJsZSB0byB2YWxpZGF0ZVwiKTtcbiAgICAgICAgY29uc29sZS5lcnJvcihlKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogUHJvcGFnYXRlIHRvIGF0dHJpYnV0ZXMgYSBjbGVhciBtZXNzYWdlIGZvciB0aGUgZXJyb3IgZGlzcGxheWVkXG4gICAgICovXG4gICAgY2xlYW5FcnJvck1lc3NhZ2VzOiBmdW5jdGlvbiBtRG9jdW1lbnRDbGVhbkVycm9yTWVzc2FnZXMoKSB7XG4gICAgICB2YXIgYXR0ck1vZGVscyA9IHRoaXMuZ2V0KFwiYXR0cmlidXRlc1wiKSB8fCBbXTtcbiAgICAgIF8uZWFjaChhdHRyTW9kZWxzLm1vZGVscywgZnVuY3Rpb24gbURvY3VtZW50Q2xlYW5FcnJvck1lc3NhZ2VzRWFjaChcbiAgICAgICAgYXR0ck1vZGVsXG4gICAgICApIHtcbiAgICAgICAgYXR0ck1vZGVsLnNldEVycm9yTWVzc2FnZShudWxsKTtcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgLyoqXG4gICAgICogUGFyc2UgdGhlIHJldHVybiBvZiB0aGUgUkVTVCBBUElcbiAgICAgKiBAcGFyYW0gcmVzcG9uc2VcbiAgICAgKiBAcmV0dXJucyB7e3Byb3BlcnRpZXM6ICgqfHByb3BlcnRpZXN8ZXhwb3J0cy5kZWZhdWx0cy5wcm9wZXJ0aWVzfGV4cG9ydHMucGFyc2UucHJvcGVydGllc3wuY3JlYXRlT2JqZWN0RXhwcmVzc2lvbi5wcm9wZXJ0aWVzKSwgbWVudXM6IChhcHAudmlld3Muc2hhcmVkLm1lbnV8KiksIGxvY2FsZTogKiwgcmVuZGVyTW9kZTogc3RyaW5nLCBhdHRyaWJ1dGVzOiBBcnJheSwgdGVtcGxhdGVzOiAqLCByZW5kZXJPcHRpb25zOiAqfX1cbiAgICAgKi9cbiAgICBwYXJzZTogZnVuY3Rpb24gbURvY3VtZW50UGFyc2UocmVzcG9uc2UpIHtcbiAgICAgIHZhciB2YWx1ZXMsXG4gICAgICAgIHJlbmRlck1vZGUgPSBcInZpZXdcIixcbiAgICAgICAgdmlldyA9IHJlc3BvbnNlLmRhdGEudmlldztcblxuICAgICAgaWYgKHJlc3BvbnNlLnN1Y2Nlc3MgPT09IGZhbHNlKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIlVuYWJsZSB0byBnZXQgdGhlIGRhdGEgZnJvbSBkb2N1bWVudHNcIik7XG4gICAgICB9XG4gICAgICB0aGlzLnRyaWdnZXIoXCJiZWZvcmVQYXJzZVwiKTtcbiAgICAgIGlmICh2aWV3LnJlbmRlck9wdGlvbnMubW9kZSkge1xuICAgICAgICBpZiAodmlldy5yZW5kZXJPcHRpb25zLm1vZGUgPT09IFwiZWRpdFwiKSB7XG4gICAgICAgICAgcmVuZGVyTW9kZSA9IFwiZWRpdFwiO1xuICAgICAgICB9IGVsc2UgaWYgKHZpZXcucmVuZGVyT3B0aW9ucy5tb2RlID09PSBcInZpZXdcIikge1xuICAgICAgICAgIHJlbmRlck1vZGUgPSBcInZpZXdcIjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJVbmtvd24gcmVuZGVyIG1vZGUgXCIgKyB2aWV3LnJlbmRlck9wdGlvbnMubW9kZSk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgdGhpcy5pbml0aWFsUHJvcGVydGllcyA9IF8uZGVmYXVsdHMoXG4gICAgICAgIHtcbiAgICAgICAgICByZW5kZXJNb2RlOiByZW5kZXJNb2RlIHx8IFwidmlld1wiLFxuICAgICAgICAgIHZpZXdJZDogcmVzcG9uc2UuZGF0YS5wcm9wZXJ0aWVzLnJlcXVlc3RJZGVudGlmaWVyXG4gICAgICAgIH0sXG4gICAgICAgIHZpZXcuZG9jdW1lbnREYXRhLmRvY3VtZW50LnByb3BlcnRpZXNcbiAgICAgICk7XG5cbiAgICAgIC8vQ2xlYW4gYXR0cmlidXRlc1xuICAgICAgaWYgKHRoaXMuZ2V0KFwiYXR0cmlidXRlc1wiKSBpbnN0YW5jZW9mIENvbGxlY3Rpb25BdHRyaWJ1dGVzKSB7XG4gICAgICAgIHRoaXMuZ2V0KFwiYXR0cmlidXRlc1wiKS5kZXN0cm95KCk7XG4gICAgICB9XG5cbiAgICAgIHZhbHVlcyA9IHtcbiAgICAgICAgaW5pdGlkOlxuICAgICAgICAgIHJlc3BvbnNlLmRhdGEucHJvcGVydGllcy5jcmVhdGlvblZpZXcgPT09IHRydWVcbiAgICAgICAgICAgID8gbnVsbFxuICAgICAgICAgICAgOiB2aWV3LmRvY3VtZW50RGF0YS5kb2N1bWVudC5wcm9wZXJ0aWVzLmluaXRpZCxcbiAgICAgICAgcHJvcGVydGllczogdmlldy5kb2N1bWVudERhdGEuZG9jdW1lbnQucHJvcGVydGllcyxcbiAgICAgICAgbWVudXM6IHZpZXcubWVudSxcbiAgICAgICAgdmlld0lkOiByZXNwb25zZS5kYXRhLnByb3BlcnRpZXMucmVxdWVzdElkZW50aWZpZXIsXG4gICAgICAgIHJldmlzaW9uOiB2aWV3LmRvY3VtZW50RGF0YS5kb2N1bWVudC5wcm9wZXJ0aWVzLnJldmlzaW9uLFxuICAgICAgICBsb2NhbGU6IHZpZXcubG9jYWxlLmN1bHR1cmUsXG4gICAgICAgIHJlbmRlck1vZGU6IHJlbmRlck1vZGUgfHwgXCJ2aWV3XCIsXG4gICAgICAgIGF0dHJpYnV0ZXM6IHVuZGVmaW5lZCxcbiAgICAgICAgdGVtcGxhdGVzOiB2aWV3LnRlbXBsYXRlcyxcbiAgICAgICAgcmVuZGVyT3B0aW9uczogdmlldy5yZW5kZXJPcHRpb25zLFxuICAgICAgICBjdXN0b21DU1M6IHZpZXcuc3R5bGUuY3NzLFxuICAgICAgICBjdXN0b21KUzogdmlldy5zY3JpcHQuanMsXG4gICAgICAgIGN1c3RvbVNlcnZlckRhdGE6IHZpZXcuY3VzdG9tU2VydmVyRGF0YSxcbiAgICAgICAgbWVzc2FnZXM6IHJlc3BvbnNlLm1lc3NhZ2VzLFxuICAgICAgICBvcmlnaW5hbFZhbHVlczogdmlldy5kb2N1bWVudERhdGEuZG9jdW1lbnQuYXR0cmlidXRlc1xuICAgICAgfTtcbiAgICAgIHRoaXMuX2N1c3RvbUNsaWVudERhdGEgPSB7fTtcbiAgICAgIHRoaXMuX2N1c3RvbVJlcXVlc3REYXRhID0gbnVsbDtcbiAgICAgIGlmIChyZXNwb25zZS5kYXRhLnByb3BlcnRpZXMuY3JlYXRpb25WaWV3ID09PSB0cnVlKSB7XG4gICAgICAgIHZhbHVlcy5jcmVhdGlvbkZhbWlkID1cbiAgICAgICAgICB2aWV3LmRvY3VtZW50RGF0YS5kb2N1bWVudC5wcm9wZXJ0aWVzLmZhbWlseS5uYW1lO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFsdWVzLmNyZWF0aW9uRmFtaWQgPSBmYWxzZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB2YWx1ZXM7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEdlbmVyYXRlIHRoZSBjb2xsZWN0aW9uIG9mIHRoZSBjdXJyZW50IG1vZGVsIGFuZCBiaW5kIGV2ZW50cyBvbiB0aGUgbmV3IGNvbGxlY3Rpb25cbiAgICAgKlxuICAgICAqIEBwYXJhbSBrZXlPclZhbHVlcyBzdHJpbmd8b2JqZWN0IG9mIHByb3BlcnRpZXMgb3Iga2V5IG9mIHRoZSBjdXJyZW50IHByb3BlcnR5XG4gICAgICogQHBhcmFtIHZhbHVlXG4gICAgICogQHJldHVybnMgeyp9XG4gICAgICovXG4gICAgc2V0OiBmdW5jdGlvbiBtRG9jdW1lbnRzZXRWYWx1ZXMoa2V5T3JWYWx1ZXMsIHZhbHVlKSB7XG4gICAgICB2YXIgY3VycmVudE1vZGVsID0gdGhpcztcbiAgICAgIGlmIChrZXlPclZhbHVlcy5wcm9wZXJ0aWVzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgaWYgKGN1cnJlbnRNb2RlbC5nZXQoXCJwcm9wZXJ0aWVzXCIpIGluc3RhbmNlb2YgRG9jdW1lbnRQcm9wZXJ0aWVzKSB7XG4gICAgICAgICAgY3VycmVudE1vZGVsLmdldChcInByb3BlcnRpZXNcIikudHJpZ2dlcihcImRlc3Ryb3lcIik7XG4gICAgICAgIH1cbiAgICAgICAga2V5T3JWYWx1ZXMucHJvcGVydGllcyA9IG5ldyBEb2N1bWVudFByb3BlcnRpZXMoa2V5T3JWYWx1ZXMucHJvcGVydGllcyk7XG4gICAgICB9XG5cbiAgICAgIGlmIChrZXlPclZhbHVlcy5tZW51cyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGlmIChjdXJyZW50TW9kZWwuZ2V0KFwibWVudXNcIikgaW5zdGFuY2VvZiBDb2xsZWN0aW9uTWVudXMpIHtcbiAgICAgICAgICBjdXJyZW50TW9kZWwuZ2V0KFwibWVudXNcIikuZGVzdHJveSgpO1xuICAgICAgICB9XG4gICAgICAgIGtleU9yVmFsdWVzLm1lbnVzID0gbmV3IENvbGxlY3Rpb25NZW51cyhrZXlPclZhbHVlcy5tZW51cyk7XG4gICAgICB9XG4gICAgICBpZiAoa2V5T3JWYWx1ZXMgPT09IFwiYXR0cmlidXRlc1wiKSB7XG4gICAgICAgIHZhbHVlID0gbmV3IENvbGxlY3Rpb25BdHRyaWJ1dGVzKHZhbHVlLCB7XG4gICAgICAgICAgZG9jdW1lbnRNb2RlbDogY3VycmVudE1vZGVsLFxuICAgICAgICAgIHJlbmRlck9wdGlvbnM6IGN1cnJlbnRNb2RlbC5nZXQoXCJyZW5kZXJPcHRpb25zXCIpLFxuICAgICAgICAgIHJlbmRlck1vZGU6IGN1cnJlbnRNb2RlbC5nZXQoXCJyZW5kZXJNb2RlXCIpXG4gICAgICAgIH0pO1xuICAgICAgICAvL1NldCB0aGUgaW50ZXJuYWwgY29udGVudCBjb2xsZWN0aW9uIChmb3Igc3RydWN0dXJlIGF0dHJpYnV0ZXMpXG4gICAgICAgIHZhbHVlLmVhY2goZnVuY3Rpb24gbURvY3VtZW50c2V0VmFsdWVzRWFjaEF0dHJpYnV0ZXMoXG4gICAgICAgICAgY3VycmVudEF0dHJpYnV0ZU1vZGVsXG4gICAgICAgICkge1xuICAgICAgICAgIGlmIChjdXJyZW50QXR0cmlidXRlTW9kZWwuZ2V0KFwiaXNWYWx1ZUF0dHJpYnV0ZVwiKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICB2YXIgY2hpbGRBdHRyaWJ1dGVzID0gdmFsdWUuZmlsdGVyKFxuICAgICAgICAgICAgZnVuY3Rpb24gbURvY3VtZW50c2V0VmFsdWVzRWFjaEF0dHJpYnV0ZXNGaWx0ZXIoXG4gICAgICAgICAgICAgIGNhbmRpZGF0ZUNoaWxkTW9kZWxcbiAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgICAgIGNhbmRpZGF0ZUNoaWxkTW9kZWwuZ2V0KFwicGFyZW50XCIpID09PSBjdXJyZW50QXR0cmlidXRlTW9kZWwuaWRcbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICApO1xuICAgICAgICAgIGlmIChjaGlsZEF0dHJpYnV0ZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgY3VycmVudEF0dHJpYnV0ZU1vZGVsLnNldENvbnRlbnRDb2xsZWN0aW9uKGNoaWxkQXR0cmlidXRlcyk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgLy9Qcm9wYWdhdGUgdGhlIGNoYW5nZSBldmVudCB0byB0aGUgbW9kZWxcbiAgICAgICAgY3VycmVudE1vZGVsLmxpc3RlblRvKFxuICAgICAgICAgIHZhbHVlLFxuICAgICAgICAgIFwiY2hhbmdlOmF0dHJpYnV0ZVZhbHVlXCIsXG4gICAgICAgICAgZnVuY3Rpb24gbURvY3VtZW50c2V0VmFsdWVzTGlzdGVuQ2hhbmdlKG1vZGVsKSB7XG4gICAgICAgICAgICBfLmRlZmVyKGZ1bmN0aW9uIG1Eb2N1bWVudEF0dHJpYnV0ZUNoYW5nZXJUcmlnZ2VyKCkge1xuICAgICAgICAgICAgICBjdXJyZW50TW9kZWwudHJpZ2dlcihcImNoYW5nZVZhbHVlXCIsIHtcbiAgICAgICAgICAgICAgICBhdHRyaWJ1dGVJZDogbW9kZWwuaWRcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgICAgIC8vUHJvcGFnYXRlIHRoZSB2YWxpZGF0ZSBldmVudCB0byB0aGUgbW9kZWxcbiAgICAgICAgY3VycmVudE1vZGVsLmxpc3RlblRvKFxuICAgICAgICAgIHZhbHVlLFxuICAgICAgICAgIFwiY29uc3RyYWludFwiLFxuICAgICAgICAgIGZ1bmN0aW9uIG1Eb2N1bWVudHNldFZhbHVlc0xpc3RlbkNvbnN0cmFpbnQob3B0aW9ucykge1xuICAgICAgICAgICAgY3VycmVudE1vZGVsLnRyaWdnZXIoXG4gICAgICAgICAgICAgIFwiY29uc3RyYWludFwiLFxuICAgICAgICAgICAgICBvcHRpb25zLm1vZGVsLmlkLFxuICAgICAgICAgICAgICBvcHRpb25zLnJlc3BvbnNlXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICAgICAgLy9Qcm9wYWdhdGUgdGhlIHJlbmRlckRvbmUgZXZlbnQgb2YgdGhlIGF0dHJpYnV0ZXMgdG8gdGhlIG1vZGVsXG4gICAgICAgIGN1cnJlbnRNb2RlbC5saXN0ZW5UbyhcbiAgICAgICAgICB2YWx1ZSxcbiAgICAgICAgICBcInJlbmRlckRvbmVcIixcbiAgICAgICAgICBmdW5jdGlvbiBtRG9jdW1lbnRzZXRWYWx1ZXNMaXN0ZW5SZW5kZXJEb25lKG9wdGlvbnMpIHtcbiAgICAgICAgICAgIGN1cnJlbnRNb2RlbC50cmlnZ2VyKFxuICAgICAgICAgICAgICBcImF0dHJpYnV0ZVJlbmRlclwiLFxuICAgICAgICAgICAgICBvcHRpb25zLm1vZGVsLmlkLFxuICAgICAgICAgICAgICBvcHRpb25zLiRlbCxcbiAgICAgICAgICAgICAgb3B0aW9ucy5pbmRleFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgICAgIC8vUHJvcGFnYXRlIHRoZSBiZWZvcmVSZW5kZXIgZXZlbnQgb2YgdGhlIGF0dHJpYnV0ZXMgdG8gdGhlIG1vZGVsXG4gICAgICAgIGN1cnJlbnRNb2RlbC5saXN0ZW5UbyhcbiAgICAgICAgICB2YWx1ZSxcbiAgICAgICAgICBcImJlZm9yZVJlbmRlclwiLFxuICAgICAgICAgIGZ1bmN0aW9uIG1Eb2N1bWVudHNldFZhbHVlc0xpc3RlbkJlZm9yZVJlbmRlcihldmVudCwgb3B0aW9ucykge1xuICAgICAgICAgICAgY3VycmVudE1vZGVsLnRyaWdnZXIoXG4gICAgICAgICAgICAgIFwiYmVmb3JlQXR0cmlidXRlUmVuZGVyXCIsXG4gICAgICAgICAgICAgIGV2ZW50LFxuICAgICAgICAgICAgICBvcHRpb25zLm1vZGVsLmlkLFxuICAgICAgICAgICAgICBvcHRpb25zLiRlbCxcbiAgICAgICAgICAgICAgb3B0aW9ucy5pbmRleFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgICAgIC8vUHJvcGFnYXRlIHRoZSBhcnJheSBldmVudCBtb2RpZmllZCB0byB0aGUgbW9kZWxcbiAgICAgICAgY3VycmVudE1vZGVsLmxpc3RlblRvKFxuICAgICAgICAgIHZhbHVlLFxuICAgICAgICAgIFwiYXJyYXlcIixcbiAgICAgICAgICBmdW5jdGlvbiBtRG9jdW1lbnRzZXRWYWx1ZXNMaXN0ZW5BcnJheSh0eXBlLCBtb2RlbCwgb3B0aW9ucykge1xuICAgICAgICAgICAgY3VycmVudE1vZGVsLnRyaWdnZXIoXCJhcnJheU1vZGlmaWVkXCIsIHtcbiAgICAgICAgICAgICAgYXR0cmlidXRlSWQ6IG1vZGVsLmlkLFxuICAgICAgICAgICAgICB0eXBlOiB0eXBlLFxuICAgICAgICAgICAgICBvcHRpb25zOiBvcHRpb25zXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgICAgIC8vUHJvcGFnYXRlIHRoZSBldmVudCBleHRlcm5hbExpbmtTZWxlY3RlZCB0byB0aGUgbW9kZWxcbiAgICAgICAgY3VycmVudE1vZGVsLmxpc3RlblRvKFxuICAgICAgICAgIHZhbHVlLFxuICAgICAgICAgIFwiaW50ZXJuYWxMaW5rU2VsZWN0ZWRcIixcbiAgICAgICAgICBmdW5jdGlvbiBtRG9jdW1lbnRzZXRWYWx1ZXNMaXN0ZW5MaW5rU2VsZWN0ZWQoZXZlbnQsIG9wdGlvbnMpIHtcbiAgICAgICAgICAgIGN1cnJlbnRNb2RlbC50cmlnZ2VyKFwiaW50ZXJuYWxMaW5rU2VsZWN0ZWRcIiwgZXZlbnQsIG9wdGlvbnMpO1xuICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICAgICAgLy9Qcm9wYWdhdGUgdGhlIGV2ZW50IGRvd25sb2FkRmlsZSB0byB0aGUgbW9kZWxcbiAgICAgICAgY3VycmVudE1vZGVsLmxpc3RlblRvKFxuICAgICAgICAgIHZhbHVlLFxuICAgICAgICAgIFwiZG93bmxvYWRGaWxlXCIsXG4gICAgICAgICAgZnVuY3Rpb24gbURvY3VtZW50c2V0VmFsdWVzTGlzdGVuRG93bmxvYWRmaWxlKFxuICAgICAgICAgICAgZXZlbnQsXG4gICAgICAgICAgICBhdHRyaWQsXG4gICAgICAgICAgICBvcHRpb25zXG4gICAgICAgICAgKSB7XG4gICAgICAgICAgICBjdXJyZW50TW9kZWwudHJpZ2dlcihcImRvd25sb2FkRmlsZVwiLCBldmVudCwgYXR0cmlkLCBvcHRpb25zKTtcbiAgICAgICAgICB9XG4gICAgICAgICk7XG5cbiAgICAgICAgLy9Qcm9wYWdhdGUgdGhlIGV2ZW50IHVwbG9hZEZpbGUgdG8gdGhlIG1vZGVsXG4gICAgICAgIGN1cnJlbnRNb2RlbC5saXN0ZW5UbyhcbiAgICAgICAgICB2YWx1ZSxcbiAgICAgICAgICBcInVwbG9hZEZpbGVcIixcbiAgICAgICAgICBmdW5jdGlvbiBtRG9jdW1lbnRMaXN0ZW5VcGxvYWRmaWxlU3RhcnQoZXZlbnQsIGF0dHJpZCwgb3B0aW9ucykge1xuICAgICAgICAgICAgdmFyIGF0dHIsIGF0dHJWYWx1ZTtcbiAgICAgICAgICAgIGN1cnJlbnRNb2RlbC50cmlnZ2VyKFwidXBsb2FkRmlsZVwiLCBldmVudCwgYXR0cmlkLCBvcHRpb25zKTtcblxuICAgICAgICAgICAgaWYgKCFldmVudC5wcmV2ZW50KSB7XG4gICAgICAgICAgICAgIGF0dHIgPSBjdXJyZW50TW9kZWwuZ2V0KFwiYXR0cmlidXRlc1wiKS5nZXQoYXR0cmlkKTtcblxuICAgICAgICAgICAgICBjdXJyZW50TW9kZWwuX3VwbG9hZGluZ0ZpbGUrKztcblxuICAgICAgICAgICAgICBpZiAoYXR0cikge1xuICAgICAgICAgICAgICAgIGF0dHJWYWx1ZSA9IGF0dHIuZ2V0KFwiYXR0cmlidXRlVmFsdWVcIik7XG4gICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMuaW5kZXggPj0gMCkge1xuICAgICAgICAgICAgICAgICAgYXR0clZhbHVlID0gXy5jbG9uZShhdHRyVmFsdWUpO1xuICAgICAgICAgICAgICAgICAgYXR0clZhbHVlW29wdGlvbnMuaW5kZXhdID0ge1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogXCItXi1cIixcbiAgICAgICAgICAgICAgICAgICAgZGlzcGxheVZhbHVlOiBcIlVwbG9hZGluZ1wiXG4gICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICBhdHRyVmFsdWUgPSB7IHZhbHVlOiBcIi0tXCIsIGRpc3BsYXlWYWx1ZTogXCJVcGxvYWRpbmdcIiB9O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyBVc2UgU2lsZW50IHRvIG5vdCByZWRyYXcgd2lkZ2V0IC0gaXQgd2lsbCBiZSByZWRyYXcgYXQgdGhlIGVuZCBvZiB1cGxvYWRpbmdcbiAgICAgICAgICAgICAgICBhdHRyLnNldChcImF0dHJpYnV0ZVZhbHVlXCIsIGF0dHJWYWx1ZSwgeyBzaWxlbnQ6IHRydWUgfSk7XG4gICAgICAgICAgICAgICAgY3VycmVudE1vZGVsLnRyaWdnZXIoXCJjaGFuZ2VWYWx1ZVwiLCB7XG4gICAgICAgICAgICAgICAgICBhdHRyaWJ1dGVJZDogYXR0cmlkXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICk7XG5cbiAgICAgICAgLy9Qcm9wYWdhdGUgdGhlIGV2ZW50IHVwbG9hZEZpbGUgdG8gdGhlIG1vZGVsXG4gICAgICAgIGN1cnJlbnRNb2RlbC5saXN0ZW5UbyhcbiAgICAgICAgICB2YWx1ZSxcbiAgICAgICAgICBcInVwbG9hZEZpbGVEb25lXCIsXG4gICAgICAgICAgZnVuY3Rpb24gbURvY3VtZW50TGlzdGVudXBsb2FkRmlsZURvbmUoZXZlbnQsIGF0dHJpZCwgb3B0aW9ucykge1xuICAgICAgICAgICAgY3VycmVudE1vZGVsLl91cGxvYWRpbmdGaWxlLS07XG4gICAgICAgICAgICBjdXJyZW50TW9kZWwudHJpZ2dlcihcInVwbG9hZEZpbGVEb25lXCIsIGV2ZW50LCBhdHRyaWQsIG9wdGlvbnMpO1xuXG4gICAgICAgICAgICBpZiAoY3VycmVudE1vZGVsLl91cGxvYWRpbmdGaWxlIDw9IDApIHtcbiAgICAgICAgICAgICAgY3VycmVudE1vZGVsLnRyaWdnZXIoXCJ1cGxvYWRGaWxlRmluaXNoZWRcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICApO1xuXG4gICAgICAgIC8vUHJvcGFnYXRlIHRoZSBldmVudCBoZWxwZXJTZWFyY2ggdG8gdGhlIG1vZGVsXG4gICAgICAgIGN1cnJlbnRNb2RlbC5saXN0ZW5UbyhcbiAgICAgICAgICB2YWx1ZSxcbiAgICAgICAgICBcImhlbHBlclNlYXJjaFwiLFxuICAgICAgICAgIGZ1bmN0aW9uIG1Eb2N1bWVudHNldFZhbHVlc0xpc3RlbkhlbHBlclNlYXJjaChcbiAgICAgICAgICAgIGV2ZW50LFxuICAgICAgICAgICAgYXR0cmlkLFxuICAgICAgICAgICAgb3B0aW9ucyxcbiAgICAgICAgICAgIGluZGV4XG4gICAgICAgICAgKSB7XG4gICAgICAgICAgICBjdXJyZW50TW9kZWwudHJpZ2dlcihcImhlbHBlclNlYXJjaFwiLCBldmVudCwgYXR0cmlkLCBvcHRpb25zLCBpbmRleCk7XG4gICAgICAgICAgfVxuICAgICAgICApO1xuICAgICAgICAvL1Byb3BhZ2F0ZSB0aGUgZXZlbnQgaGVscGVyUmVzcG9uc2UgdG8gdGhlIG1vZGVsXG4gICAgICAgIGN1cnJlbnRNb2RlbC5saXN0ZW5UbyhcbiAgICAgICAgICB2YWx1ZSxcbiAgICAgICAgICBcImhlbHBlclJlc3BvbnNlXCIsXG4gICAgICAgICAgZnVuY3Rpb24gbURvY3VtZW50c2V0VmFsdWVzTGlzdGVuSGVscGVyUmVzcG9uc2UoXG4gICAgICAgICAgICBldmVudCxcbiAgICAgICAgICAgIGF0dHJpZCxcbiAgICAgICAgICAgIG9wdGlvbnMsXG4gICAgICAgICAgICBpbmRleFxuICAgICAgICAgICkge1xuICAgICAgICAgICAgY3VycmVudE1vZGVsLnRyaWdnZXIoXG4gICAgICAgICAgICAgIFwiaGVscGVyUmVzcG9uc2VcIixcbiAgICAgICAgICAgICAgZXZlbnQsXG4gICAgICAgICAgICAgIGF0dHJpZCxcbiAgICAgICAgICAgICAgb3B0aW9ucyxcbiAgICAgICAgICAgICAgaW5kZXhcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICApO1xuICAgICAgICAvL1Byb3BhZ2F0ZSB0aGUgZXZlbnQgaGVscGVyUmVzcG9uc2UgdG8gdGhlIG1vZGVsXG4gICAgICAgIGN1cnJlbnRNb2RlbC5saXN0ZW5UbyhcbiAgICAgICAgICB2YWx1ZSxcbiAgICAgICAgICBcImhlbHBlclNlbGVjdFwiLFxuICAgICAgICAgIGZ1bmN0aW9uIG1Eb2N1bWVudHNldFZhbHVlc0xpc3RlbkhlbHBlclNlbGVjdChcbiAgICAgICAgICAgIGV2ZW50LFxuICAgICAgICAgICAgYXR0cmlkLFxuICAgICAgICAgICAgb3B0aW9ucyxcbiAgICAgICAgICAgIGluZGV4XG4gICAgICAgICAgKSB7XG4gICAgICAgICAgICBjdXJyZW50TW9kZWwudHJpZ2dlcihcImhlbHBlclNlbGVjdFwiLCBldmVudCwgYXR0cmlkLCBvcHRpb25zLCBpbmRleCk7XG4gICAgICAgICAgfVxuICAgICAgICApO1xuICAgICAgICAvL1Byb3BhZ2F0ZSB0aGUgY2xpY2sgb24gYW4gYW5jaG9yIHRvIHRoZSBtb2RlbFxuICAgICAgICBjdXJyZW50TW9kZWwubGlzdGVuVG8oXG4gICAgICAgICAgdmFsdWUsXG4gICAgICAgICAgXCJhbmNob3JDbGlja1wiLFxuICAgICAgICAgIGZ1bmN0aW9uIG1Eb2N1bWVudHNldFZhbHVlc0xpc3RlbkFuY2hvckNsaWNrZWQoXG4gICAgICAgICAgICBldmVudCxcbiAgICAgICAgICAgIGF0dHJpZCxcbiAgICAgICAgICAgIG9wdGlvbnNcbiAgICAgICAgICApIHtcbiAgICAgICAgICAgIGN1cnJlbnRNb2RlbC50cmlnZ2VyKFwiYW5jaG9yQ2xpY2tcIiwgZXZlbnQsIGF0dHJpZCwgb3B0aW9ucyk7XG4gICAgICAgICAgfVxuICAgICAgICApO1xuICAgICAgICAvL1Byb3BhZ2F0ZSBhdHRyaWJ1dGVCZWZvcmVUYWJTZWxlY3RcbiAgICAgICAgY3VycmVudE1vZGVsLmxpc3RlblRvKFxuICAgICAgICAgIHZhbHVlLFxuICAgICAgICAgIFwiYXR0cmlidXRlQmVmb3JlVGFiU2VsZWN0XCIsXG4gICAgICAgICAgZnVuY3Rpb24gbURvY3VtZW50YXR0cmlidXRlQmVmb3JlVGFiU2VsZWN0KGV2ZW50LCBhdHRyaWQpIHtcbiAgICAgICAgICAgIGN1cnJlbnRNb2RlbC50cmlnZ2VyKFwiYXR0cmlidXRlQmVmb3JlVGFiU2VsZWN0XCIsIGV2ZW50LCBhdHRyaWQpO1xuICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICAgICAgLy9Qcm9wYWdhdGUgYXR0cmlidXRlQWZ0ZXJUYWJTZWxlY3RcbiAgICAgICAgY3VycmVudE1vZGVsLmxpc3RlblRvKFxuICAgICAgICAgIHZhbHVlLFxuICAgICAgICAgIFwiYXR0cmlidXRlQWZ0ZXJUYWJTZWxlY3RcIixcbiAgICAgICAgICBmdW5jdGlvbiBtRG9jdW1lbnRhdHRyaWJ1dGVBZnRlclRhYlNlbGVjdChldmVudCwgYXR0cmlkKSB7XG4gICAgICAgICAgICBjdXJyZW50TW9kZWwudHJpZ2dlcihcImF0dHJpYnV0ZUFmdGVyVGFiU2VsZWN0XCIsIGV2ZW50LCBhdHRyaWQpO1xuICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICAgICAgY3VycmVudE1vZGVsLmxpc3RlblRvKFxuICAgICAgICAgIHZhbHVlLFxuICAgICAgICAgIFwiYXR0cmlidXRlVGFiQ2hhbmdlXCIsXG4gICAgICAgICAgZnVuY3Rpb24gbURvY3VtZW50YXR0cmlidXRlVGFiQ2hhbmdlKGV2ZW50LCBhdHRyaWQsICRlbCwgZGF0YSkge1xuICAgICAgICAgICAgY3VycmVudE1vZGVsLnRyaWdnZXIoXG4gICAgICAgICAgICAgIFwiYXR0cmlidXRlVGFiQ2hhbmdlXCIsXG4gICAgICAgICAgICAgIGV2ZW50LFxuICAgICAgICAgICAgICBhdHRyaWQsXG4gICAgICAgICAgICAgICRlbCxcbiAgICAgICAgICAgICAgZGF0YVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICByZXR1cm4gQmFja2JvbmUuTW9kZWwucHJvdG90eXBlLnNldC5jYWxsKHRoaXMsIGtleU9yVmFsdWVzLCB2YWx1ZSk7XG4gICAgfSxcblxuICAgIHVuYmluZExvYWRFdmVudDogZnVuY3Rpb24gbURvY3VtZW50VW5iaW5kTG9hZEV2ZW50KCkge1xuICAgICAgJCh3aW5kb3cpLm9mZihcIi5cIiArIHRoaXMuY2lkKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogRGVzdHJveSB0aGUgY29sbGVjdGlvbiBhc3NvY2lhdGVkIHRvIHRoZSBkb2N1bWVudCAodXNlZCBpbiB0aGUgZGVzdHJveSBwYXJ0IG9mIHRoZSB2aWV3KVxuICAgICAqXG4gICAgICovXG4gICAgZGVzdHJveVN1YmNvbGxlY3Rpb246IGZ1bmN0aW9uIG1Eb2N1bWVudGRlc3Ryb3lTdWJjb2xsZWN0aW9uKCkge1xuICAgICAgaWYgKHRoaXMuZ2V0KFwibWVudXNcIikgaW5zdGFuY2VvZiBDb2xsZWN0aW9uTWVudXMpIHtcbiAgICAgICAgdGhpcy5nZXQoXCJtZW51c1wiKS5kZXN0cm95KCk7XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5nZXQoXCJwcm9wZXJ0aWVzXCIpIGluc3RhbmNlb2YgRG9jdW1lbnRQcm9wZXJ0aWVzKSB7XG4gICAgICAgIHRoaXMuZ2V0KFwicHJvcGVydGllc1wiKS50cmlnZ2VyKFwiZGVzdHJveVwiKTtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLmdldChcImF0dHJpYnV0ZXNcIikgaW5zdGFuY2VvZiBDb2xsZWN0aW9uQXR0cmlidXRlcykge1xuICAgICAgICB0aGlzLmdldChcImF0dHJpYnV0ZXNcIikuZGVzdHJveSgpO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBJbmplY3QgSlMgaW4gdGhlIG1haW4gcGFnZSBiZWZvcmUgcmVuZGVyIHZpZXdcbiAgICAgKiBUbyBsYXVuY2ggYmVmb3JlUmVuZGVyIGFuZCBiZWZvcmVSZW5kZXJBdHRyaWJ1dGVcbiAgICAgKi9cbiAgICBpbmplY3RDdXJyZW50RG9jSlM6IGZ1bmN0aW9uIG1Eb2N1bWVudEluamVjdEN1cnJlbnREb2NKUygpIHtcbiAgICAgIHZhciBhbGxJbmplY3RQcm9taXNlcyA9IFtdLFxuICAgICAgICBpbmplY3RQcm9taXNlID0gdGhpcy5fcHJvbWlzZUNhbGxiYWNrKCksXG4gICAgICAgIGN1c3RvbUpTID0gXy5wbHVjayh0aGlzLmdldChcImN1c3RvbUpTXCIpLCBcInBhdGhcIik7XG5cbiAgICAgIF8uZWFjaChjdXN0b21KUywgZnVuY3Rpb24gaW5qZWN0RWxlbWVudChjdXJyZW50UGF0aCkge1xuICAgICAgICBpZiAoJCgnc2NyaXB0W3NyYz1cIicgKyBjdXJyZW50UGF0aCArICdcIl0nKS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICBhbGxJbmplY3RQcm9taXNlcy5wdXNoKFxuICAgICAgICAgICAgbmV3IFByb21pc2UoZnVuY3Rpb24gYWRkSnMocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgICAgICAgIGxvYWQoY3VycmVudFBhdGgsIGZ1bmN0aW9uIGFkZEpzRG9uZShlcnIpIHtcbiAgICAgICAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICBQcm9taXNlLmFsbChhbGxJbmplY3RQcm9taXNlcylcbiAgICAgICAgLnRoZW4oaW5qZWN0UHJvbWlzZS5zdWNjZXNzKVxuICAgICAgICAuY2F0Y2goaW5qZWN0UHJvbWlzZS5lcnJvcik7XG5cbiAgICAgIHJldHVybiBpbmplY3RQcm9taXNlLnByb21pc2U7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEluamVjdCBhbiBhcnJheSBvZiBqcyBpbiB0aGUgY3VycmVudCBwYWdlXG4gICAgICpcbiAgICAgKiBAcGFyYW0ganNUb0luamVjdCBBcnJheSBvZiBzdHJpbmcgdG8gaW5qZWN0XG4gICAgICogQHJldHVybiBQcm9taXNlXG4gICAgICovXG4gICAgaW5qZWN0SlM6IGZ1bmN0aW9uIG1Eb2N1bWVudEluamVjdEpzKGpzVG9JbmplY3QpIHtcbiAgICAgIHZhciBhbGxJbmplY3RQcm9taXNlcyA9IFtdO1xuICAgICAgaWYgKCFfLmlzQXJyYXkoanNUb0luamVjdCkpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVGhlIGpzIHRvIGluamVjdCBtdXN0IGJlIGFuIGFycmF5IG9mIHN0cmluZyBwYXRoXCIpO1xuICAgICAgfVxuICAgICAgXy5lYWNoKGpzVG9JbmplY3QsIGZ1bmN0aW9uIGluamVjdEVsZW1lbnQoY3VycmVudFBhdGgpIHtcbiAgICAgICAgaWYgKCQoJ3NjcmlwdFtzcmM9XCInICsgY3VycmVudFBhdGggKyAnXCJdJykubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgYWxsSW5qZWN0UHJvbWlzZXMucHVzaChcbiAgICAgICAgICAgIG5ldyBQcm9taXNlKGZ1bmN0aW9uIGFkZEpzKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICAgICAgICBsb2FkKGN1cnJlbnRQYXRoLCBmdW5jdGlvbiBhZGRKc0RvbmUoZXJyKSB7XG4gICAgICAgICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBQcm9taXNlLmFsbChhbGxJbmplY3RQcm9taXNlcyk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEluamVjdCBhbiBhcnJheSBvZiBjc3MgcGF0aCBpbiB0aGUgY3VycmVudCBwYWdlXG4gICAgICpcbiAgICAgKiBAcGFyYW0gY3VzdG9tQ3NzXG4gICAgICovXG4gICAgaW5qZWN0Q1NTOiBmdW5jdGlvbiBtRG9jdW1lbnRJbmplY3RDU1MoY3VzdG9tQ3NzKSB7XG4gICAgICAvLyBhZGQgY3VzdG9tIGNzcyBzdHlsZVxuICAgICAgdmFyICRoZWFkID0gJChcImhlYWRcIiksXG4gICAgICAgIGNzc0xpbmtUZW1wbGF0ZSA9IF8udGVtcGxhdGUoXG4gICAgICAgICAgJzxsaW5rIHJlbD1cInN0eWxlc2hlZXRcIiB0eXBlPVwidGV4dC9jc3NcIiAnICtcbiAgICAgICAgICAgICdocmVmPVwiPCU9IHBhdGggJT5cIiBkYXRhLWluamVjdGVkPVwidHJ1ZVwiPidcbiAgICAgICAgKTtcblxuICAgICAgaWYgKCFfLmlzQXJyYXkoY3VzdG9tQ3NzKSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJUaGUgY3NzIHRvIGluamVjdCBtdXN0IGJlIGFuIGFycmF5IG9mIHN0cmluZyBwYXRoXCIpO1xuICAgICAgfVxuXG4gICAgICAvLyBJbmplY3QgbmV3IENTU1xuICAgICAgXy5lYWNoKGN1c3RvbUNzcywgZnVuY3Rpb24gdkRvY3VtZW50SW5qZWN0TmV3Q1NTKGNzc0l0ZW0pIHtcbiAgICAgICAgaWYgKGRvY3VtZW50LmNyZWF0ZVN0eWxlU2hlZXQpIHtcbiAgICAgICAgICBkb2N1bWVudC5jcmVhdGVTdHlsZVNoZWV0KGNzc0l0ZW0pO1xuICAgICAgICB9XG4gICAgICAgICRoZWFkLmFwcGVuZChjc3NMaW5rVGVtcGxhdGUoeyBwYXRoOiBjc3NJdGVtIH0pKTtcbiAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBVc2VkIGJ5IGJhY2tib25lIGZvciB0aGUgc2F2ZSBwYXJ0XG4gICAgICogQHZhciBnZXRBbGxBdHRyaWJ1dGVzICAoKGZhbHNlIGJ5IGRlZmF1bHQpIDogaWYgdHJ1ZSByZXR1cm4gYWxzbyB1bm1vZGlmaWVkIHZhbHVlc1xuICAgICAqIEByZXR1cm5zIHt7ZG9jdW1lbnQ6IHthdHRyaWJ1dGVzOiAqLCBwcm9wZXJ0aWVzIDogKn19fVxuICAgICAqL1xuICAgIHRvSlNPTjogZnVuY3Rpb24gbURvY3VtZW50dG9KU09OKGdldEFsbEF0dHJpYnV0ZXMpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGRvY3VtZW50OiB7XG4gICAgICAgICAgcHJvcGVydGllczogdGhpcy5nZXRNb2RlbFByb3BlcnRpZXMoKSxcbiAgICAgICAgICBhdHRyaWJ1dGVzOiB0aGlzLmdldFZhbHVlcyhnZXRBbGxBdHRyaWJ1dGVzICE9PSB0cnVlKVxuICAgICAgICB9LFxuICAgICAgICBjdXN0b21DbGllbnREYXRhOiB0aGlzLl9jdXN0b21DbGllbnREYXRhXG4gICAgICB9O1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBHZXQgcmVuZGVyIG9wdGlvbiBmb3IgZG9jdW1lbnQgd2lkZ2V0XG4gICAgICogQHBhcmFtIG9wdElkXG4gICAgICogQHJldHVybnMgeyp9XG4gICAgICovXG4gICAgZ2V0T3B0aW9uOiBmdW5jdGlvbiBtRG9jdW1lbnRHZXRPcHRpb24ob3B0SWQpIHtcbiAgICAgIHZhciByZW5kZXJPcHRpb25zID0gdGhpcy5nZXQoXCJyZW5kZXJPcHRpb25zXCIpO1xuICAgICAgaWYgKHJlbmRlck9wdGlvbnMgJiYgcmVuZGVyT3B0aW9ucy5kb2N1bWVudCkge1xuICAgICAgICByZXR1cm4gcmVuZGVyT3B0aW9ucy5kb2N1bWVudFtvcHRJZF07XG4gICAgICB9XG4gICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH0sXG5cbiAgICBfcHJvbWlzZUNhbGxiYWNrOiBmdW5jdGlvbiBtRG9jdW1lbnRfcHJvbWlzZUNhbGxiYWNrKCkge1xuICAgICAgdmFyIHByb21pc2UsXG4gICAgICAgIHN1Y2Nlc3MsXG4gICAgICAgIGVycm9yLFxuICAgICAgICBwcm9wZXJ0aWVzID0gdGhpcy5nZXRTZXJ2ZXJQcm9wZXJ0aWVzKCk7XG5cbiAgICAgIHByb21pc2UgPSBuZXcgUHJvbWlzZShmdW5jdGlvbiBtRG9jdW1lbnRfcHJvbWlzZUludGVybk9iamVjdChcbiAgICAgICAgcmVzb2x2ZSxcbiAgICAgICAgcmVqZWN0XG4gICAgICApIHtcbiAgICAgICAgc3VjY2VzcyA9IGZ1bmN0aW9uIG9uU3VjY2Vzcyh2YWx1ZXMpIHtcbiAgICAgICAgICB2YXIgc3VjY2Vzc0FyZ3VtZW50cyA9IHZhbHVlcztcbiAgICAgICAgICBpZiAodmFsdWVzICYmIHN1Y2Nlc3NBcmd1bWVudHNbXCJwcm9taXNlQXJndW1lbnRzXCJdKSB7XG4gICAgICAgICAgICBzdWNjZXNzQXJndW1lbnRzID0gdmFsdWVzW1wicHJvbWlzZUFyZ3VtZW50c1wiXTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc3VjY2Vzc0FyZ3VtZW50cyA9IGFyZ3VtZW50cztcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKHZhbHVlcyAmJiBzdWNjZXNzQXJndW1lbnRzLmRvY3VtZW50UHJvcGVydGllcykge1xuICAgICAgICAgICAgcHJvcGVydGllcyA9IHN1Y2Nlc3NBcmd1bWVudHMuZG9jdW1lbnRQcm9wZXJ0aWVzO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXNvbHZlKHtcbiAgICAgICAgICAgIGRvY3VtZW50UHJvcGVydGllczogcHJvcGVydGllcyxcbiAgICAgICAgICAgIHByb21pc2VBcmd1bWVudHM6IHN1Y2Nlc3NBcmd1bWVudHNcbiAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICAgICAgZXJyb3IgPSBmdW5jdGlvbiBvbkVycm9yKHZhbHVlcykge1xuICAgICAgICAgIHZhciBlcnJvckFyZ3VtZW50cyA9IHZhbHVlcztcbiAgICAgICAgICBpZiAodmFsdWVzICYmIGVycm9yQXJndW1lbnRzW1wicHJvbWlzZUFyZ3VtZW50c1wiXSkge1xuICAgICAgICAgICAgZXJyb3JBcmd1bWVudHMgPSB2YWx1ZXNbXCJwcm9taXNlQXJndW1lbnRzXCJdO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBlcnJvckFyZ3VtZW50cyA9IGFyZ3VtZW50cztcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKHZhbHVlcyAmJiBlcnJvckFyZ3VtZW50cy5kb2N1bWVudFByb3BlcnRpZXMpIHtcbiAgICAgICAgICAgIHByb3BlcnRpZXMgPSBlcnJvckFyZ3VtZW50cy5kb2N1bWVudFByb3BlcnRpZXM7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJlamVjdCh7XG4gICAgICAgICAgICBkb2N1bWVudFByb3BlcnRpZXM6IHByb3BlcnRpZXMsXG4gICAgICAgICAgICBwcm9taXNlQXJndW1lbnRzOiBlcnJvckFyZ3VtZW50c1xuICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgfSk7XG5cbiAgICAgIC8vbm9pbnNwZWN0aW9uIEpTVW51c2VkQXNzaWdubWVudFxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgcHJvbWlzZTogcHJvbWlzZSxcbiAgICAgICAgc3VjY2Vzczogc3VjY2VzcyxcbiAgICAgICAgZXJyb3I6IGVycm9yXG4gICAgICB9O1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBDb21wbGV0ZSB0aGUgbG9hZGluZyBvZiB0aGUgZG9jdW1lbnRcbiAgICAgKiBGZXRjaCB0aGUgc3RydWN0dXJlIGFuZCBleHRlcm5hbCBqcyBkZXBzXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9sb2FkRG9jdW1lbnQ6IGZ1bmN0aW9uIG1Eb2N1bWVudExvYWREb2N1bWVudChjdXJyZW50TW9kZWwpIHtcbiAgICAgIHZhciBwcm9wZXJ0aWVzID0gdGhpcy5nZXRTZXJ2ZXJQcm9wZXJ0aWVzKCk7XG5cbiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiBtRG9jdW1lbnRfcHJvbWlzZUxvYWREb2N1bWVudChcbiAgICAgICAgcmVzb2x2ZSxcbiAgICAgICAgcmVqZWN0XG4gICAgICApIHtcbiAgICAgICAgLy9Db21wbGV0ZSB0aGUgc3RydWN0dXJlIGFmdGVyXG4gICAgICAgIGN1cnJlbnRNb2RlbC5fY29tcGxldGVTdHJ1Y3R1cmUoKS50aGVuKFxuICAgICAgICAgIGZ1bmN0aW9uIG9uR2V0U3RydWN0dXJlRG9uZSgpIHtcbiAgICAgICAgICAgIGN1cnJlbnRNb2RlbC5pbmplY3RDdXJyZW50RG9jSlMoKS50aGVuKFxuICAgICAgICAgICAgICBmdW5jdGlvbiBtRG9jdW1lbnRfaW5qZWN0SlNEb25lKC8qdmFsdWVzKi8pIHtcbiAgICAgICAgICAgICAgICByZXNvbHZlKHtcbiAgICAgICAgICAgICAgICAgIGRvY3VtZW50UHJvcGVydGllczogcHJvcGVydGllcyxcbiAgICAgICAgICAgICAgICAgIHN1Y2Nlc3Nwcm9taXNlQXJndW1lbnRzOiBhcmd1bWVudHNcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgZnVuY3Rpb24gbURvY3VtZW50X2luamVjdEpTRmFpbCh2YWx1ZXMpIHtcbiAgICAgICAgICAgICAgICByZWplY3Qoe1xuICAgICAgICAgICAgICAgICAgZG9jdW1lbnRQcm9wZXJ0aWVzOiBwcm9wZXJ0aWVzLFxuICAgICAgICAgICAgICAgICAgcHJvbWlzZUFyZ3VtZW50czogYXJndW1lbnRzXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgY3VycmVudE1vZGVsLnRyaWdnZXIuYXBwbHkoXG4gICAgICAgICAgICAgICAgICBjdXJyZW50TW9kZWwsXG4gICAgICAgICAgICAgICAgICBfLnVuaW9uKFtcImRkdWlEb2N1bWVudEZhaWxcIl0sIHZhbHVlcy5wcm9taXNlQXJndW1lbnRzKVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBmdW5jdGlvbiBtRG9jdW1lbnRfb25HZXRTdHJ1Y3R1cmVGYWlsKHZhbHVlcykge1xuICAgICAgICAgICAgcmVqZWN0KHtcbiAgICAgICAgICAgICAgZG9jdW1lbnRQcm9wZXJ0aWVzOiBwcm9wZXJ0aWVzLFxuICAgICAgICAgICAgICBwcm9taXNlQXJndW1lbnRzOiBhcmd1bWVudHNcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgY3VycmVudE1vZGVsLnRyaWdnZXIuYXBwbHkoXG4gICAgICAgICAgICAgIGN1cnJlbnRNb2RlbCxcbiAgICAgICAgICAgICAgXy51bmlvbihbXCJkZHVpRG9jdW1lbnRGYWlsXCJdLCB2YWx1ZXMucHJvbWlzZUFyZ3VtZW50cylcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICApO1xuICAgICAgfSk7XG4gICAgfSxcblxuICAgIGZldGNoRG9jdW1lbnQ6IGZ1bmN0aW9uIG1Eb2N1bWVudEZldGNoRG9jdW1lbnQodmFsdWVzLCBvcHRpb25zKSB7XG4gICAgICB2YXIgZ2xvYmFsQ2FsbGJhY2sgPSB0aGlzLl9wcm9taXNlQ2FsbGJhY2soKSxcbiAgICAgICAgZG9jdW1lbnRDYWxsYmFjayA9IHRoaXMuX3Byb21pc2VDYWxsYmFjaygpLFxuICAgICAgICBzZXJ2ZXJQcm9wZXJ0aWVzID0gdGhpcy5nZXRTZXJ2ZXJQcm9wZXJ0aWVzKCksXG4gICAgICAgIGN1cnJlbnRNb2RlbCA9IHRoaXMsXG4gICAgICAgIG5lZWRUb1VubG9jayA9IHt9LFxuICAgICAgICBiZWZvcmVDbG9zZVJldHVybiA9IHsgcHJldmVudDogZmFsc2UgfSxcbiAgICAgICAgbG9ja01vZGVsID0gbnVsbCxcbiAgICAgICAgbmV4dFZpZXcgPSBmYWxzZSxcbiAgICAgICAgc2VjdXJpdHksXG4gICAgICAgIHByZXZpb3VzTW9kZSxcbiAgICAgICAgbG9ja0NhbGxiYWNrID0gdGhpcy5fcHJvbWlzZUNhbGxiYWNrKCk7XG5cbiAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuICAgICAgdmFsdWVzID0gdmFsdWVzIHx8IHt9O1xuXG4gICAgICBpZiAoXy5pc0VtcHR5KHRoaXMuX2N1c3RvbUNsaWVudERhdGEpKSB7XG4gICAgICAgIHRoaXMudHJpZ2dlcihcImdldEN1c3RvbUNsaWVudERhdGFcIik7XG4gICAgICB9XG5cbiAgICAgIC8vUmVnaXN0ZXIgcHJvbWlzZSBldmVudHNcbiAgICAgIGRvY3VtZW50Q2FsbGJhY2sucHJvbWlzZS50aGVuKFxuICAgICAgICBmdW5jdGlvbiBvbkZldGNoRG9jdW1lbnREb25lKGN1cnJlbnRNb2RlbFByb3BlcnRpZXMpIHtcbiAgICAgICAgICBjdXJyZW50TW9kZWwuX2xvYWREb2N1bWVudChjdXJyZW50TW9kZWwpLnRoZW4oXG4gICAgICAgICAgICBmdW5jdGlvbiBtRG9jdW1lbnRfbG9hZERvY3VtZW50RG9uZSh2YWx1ZXMpIHtcbiAgICAgICAgICAgICAgZ2xvYmFsQ2FsbGJhY2suc3VjY2Vzcy5hcHBseShjdXJyZW50TW9kZWxQcm9wZXJ0aWVzLCB2YWx1ZXMpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGZ1bmN0aW9uIG1Eb2N1bWVudF9sb2FkRG9jdW1lbnRGYWlsKHZhbHVlcykge1xuICAgICAgICAgICAgICBnbG9iYWxDYWxsYmFjay5lcnJvci5hcHBseShcbiAgICAgICAgICAgICAgICBjdXJyZW50TW9kZWxQcm9wZXJ0aWVzLFxuICAgICAgICAgICAgICAgIHZhbHVlcyAmJiB2YWx1ZXMucHJvbWlzZUFyZ3VtZW50c1xuICAgICAgICAgICAgICAgICAgPyB2YWx1ZXMucHJvbWlzZUFyZ3VtZW50c1xuICAgICAgICAgICAgICAgICAgOiB2YWx1ZXNcbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICApO1xuICAgICAgICB9LFxuICAgICAgICBmdW5jdGlvbiBtRG9jdW1lbnRfb25GZXRjaERvY3VtZW50RmFpbCh2YWx1ZXMpIHtcbiAgICAgICAgICBnbG9iYWxDYWxsYmFjay5lcnJvci5jYWxsKFxuICAgICAgICAgICAgc2VydmVyUHJvcGVydGllcyxcbiAgICAgICAgICAgIHZhbHVlcyAmJiB2YWx1ZXMucHJvbWlzZUFyZ3VtZW50cyA/IHZhbHVlcy5wcm9taXNlQXJndW1lbnRzIDogdmFsdWVzXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgKTtcblxuICAgICAgZ2xvYmFsQ2FsbGJhY2sucHJvbWlzZS50aGVuKFxuICAgICAgICBmdW5jdGlvbiBvblByZXBhcmVEb2N1bWVudERvbmUodmFsdWVzKSB7XG4gICAgICAgICAgaWYgKF8uaXNGdW5jdGlvbihvcHRpb25zLnN1Y2Nlc3MpKSB7XG4gICAgICAgICAgICBvcHRpb25zLnN1Y2Nlc3ModmFsdWVzKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgY3VycmVudE1vZGVsLnRyaWdnZXIoXCJjbG9zZVwiLCBzZXJ2ZXJQcm9wZXJ0aWVzKTtcbiAgICAgICAgICBjdXJyZW50TW9kZWwudHJpZ2dlci5hcHBseShcbiAgICAgICAgICAgIGN1cnJlbnRNb2RlbCxcbiAgICAgICAgICAgIF8udW5pb24oW1wiZGR1aURvY3VtZW50UmVhZHlcIl0sIHZhbHVlcy5wcm9taXNlQXJndW1lbnRzKVxuICAgICAgICAgICk7XG4gICAgICAgIH0sXG4gICAgICAgIGZ1bmN0aW9uIG9uUHJlcGFyZURvY3VtZW50RmFpbCh2YWx1ZXMpIHtcbiAgICAgICAgICBpZiAoXy5pc0Z1bmN0aW9uKG9wdGlvbnMuZXJyb3IpKSB7XG4gICAgICAgICAgICBvcHRpb25zLmVycm9yKHZhbHVlcyk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICEoXG4gICAgICAgICAgICAgIHZhbHVlcy5wcm9taXNlQXJndW1lbnRzICYmXG4gICAgICAgICAgICAgIHZhbHVlcy5wcm9taXNlQXJndW1lbnRzWzBdICYmXG4gICAgICAgICAgICAgIHZhbHVlcy5wcm9taXNlQXJndW1lbnRzWzBdLmV2ZW50UHJldmVudGVkXG4gICAgICAgICAgICApXG4gICAgICAgICAgKSB7XG4gICAgICAgICAgICBjdXJyZW50TW9kZWwudHJpZ2dlci5hcHBseShcbiAgICAgICAgICAgICAgY3VycmVudE1vZGVsLFxuICAgICAgICAgICAgICBfLnVuaW9uKFtcImRkdWlEb2N1bWVudEZhaWxcIl0sIHZhbHVlcy5wcm9taXNlQXJndW1lbnRzWzBdKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICk7XG5cbiAgICAgIC8vSW5pdCBkZWZhdWx0IHZhbHVlc1xuICAgICAgXy5kZWZhdWx0cyh2YWx1ZXMsIHtcbiAgICAgICAgcmV2aXNpb246IC0xLFxuICAgICAgICB2aWV3SWQ6IFwiIWRlZmF1bHRDb25zdWx0YXRpb25cIixcbiAgICAgICAgaW5pdGlkOiB0aGlzLmdldChcImluaXRpZFwiKVxuICAgICAgfSk7XG5cbiAgICAgIC8vVHJpZ2dlciAoc3luY2hyb25vdXMpIGJlZm9yZSBjbG9zZSBldmVudFxuICAgICAgdGhpcy50cmlnZ2VyKFxuICAgICAgICBcImJlZm9yZUNsb3NlXCIsXG4gICAgICAgIGJlZm9yZUNsb3NlUmV0dXJuLFxuICAgICAgICB2YWx1ZXMsXG4gICAgICAgIHRoaXMuX2N1c3RvbUNsaWVudERhdGFcbiAgICAgICk7XG5cbiAgICAgIGlmIChiZWZvcmVDbG9zZVJldHVybi5wcmV2ZW50ID09PSBmYWxzZSkge1xuICAgICAgICB0aGlzLnRyaWdnZXIoXCJkaXNwbGF5TG9hZGluZ1wiKTtcblxuICAgICAgICAvLyoqKioqKioqKioqTG9jayBQYXJ0KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXG5cbiAgICAgICAgLy8gVmVyaWZ5IGlmIGN1cnJlbnQgZG9jdW1lbnQgbmVlZCB0byBiZSB1bmxvY2tlZCBiZWZvcmUgZmV0Y2ggYW5vdGhlclxuICAgICAgICBzZWN1cml0eSA9IHRoaXMuZ2V0KFwicHJvcGVydGllc1wiKVxuICAgICAgICAgID8gdGhpcy5nZXQoXCJwcm9wZXJ0aWVzXCIpLmdldChcInNlY3VyaXR5XCIpXG4gICAgICAgICAgOiBudWxsO1xuICAgICAgICBwcmV2aW91c01vZGUgPSB0aGlzLmdldChcInJlbmRlck1vZGVcIik7XG5cbiAgICAgICAgaWYgKFxuICAgICAgICAgIHByZXZpb3VzTW9kZSA9PT0gXCJlZGl0XCIgJiZcbiAgICAgICAgICBzZWN1cml0eSAmJlxuICAgICAgICAgIHNlY3VyaXR5LmxvY2sgJiZcbiAgICAgICAgICBzZWN1cml0eS5sb2NrLnRlbXBvcmFyeVxuICAgICAgICApIHtcbiAgICAgICAgICBuZWVkVG9VbmxvY2sgPSB7XG4gICAgICAgICAgICBpbml0aWQ6IHNlcnZlclByb3BlcnRpZXMuaW5pdGlkXG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICAvL0NvbXB1dGUgdGhlIG5leHQgdmlld1xuICAgICAgICBuZXh0VmlldyA9IHZhbHVlcy52aWV3SWQ7XG5cbiAgICAgICAgaWYgKCFuZXh0Vmlldykge1xuICAgICAgICAgIG5leHRWaWV3ID1cbiAgICAgICAgICAgIHRoaXMuZ2V0KFwicmVuZGVyTW9kZVwiKSA9PT0gXCJlZGl0XCJcbiAgICAgICAgICAgICAgPyBcIiFkZWZhdWx0RWRpdGlvblwiXG4gICAgICAgICAgICAgIDogXCIhZGVmYXVsdENvbnN1bHRhdGlvblwiO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKFxuICAgICAgICAgIG5leHRWaWV3ICE9PSBcIiFkZWZhdWx0Q29uc3VsdGF0aW9uXCIgJiZcbiAgICAgICAgICBuZXh0VmlldyAhPT0gXCIhY29yZUNyZWF0aW9uXCIgJiZcbiAgICAgICAgICBuZXh0VmlldyAhPT0gXCIhZGVmYXVsdENyZWF0aW9uXCIgJiZcbiAgICAgICAgICB0aGlzLmdldChcInJlbmRlck1vZGVcIikgIT09IFwiY3JlYXRlXCJcbiAgICAgICAgKSB7XG4gICAgICAgICAgLy9pZiB0aGUgZG9jdW1lbnQgaXMgbG9ja2VkIGFuZCB0aGUgbmV4dCB2aWV3IGRvZXNuJ3QgbmVlZCB0aGUgc2FtZSBsb2NrIGRlbGV0ZSBpdFxuICAgICAgICAgIGlmIChuZWVkVG9VbmxvY2suaW5pdGlkICYmIG5lZWRUb1VubG9jay5pbml0aWQgIT09IHZhbHVlcy5pbml0aWQpIHtcbiAgICAgICAgICAgIGxvY2tNb2RlbCA9IG5ldyBEb2N1bWVudExvY2soe1xuICAgICAgICAgICAgICBpbml0aWQ6IG5lZWRUb1VubG9jay5pbml0aWQsXG4gICAgICAgICAgICAgIHR5cGU6IFwidGVtcG9yYXJ5XCJcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgbG9ja01vZGVsLmRlc3Ryb3koKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgLy8gVGhlIG5leHQgdmlldyBuZWVkcyBhIGxvY2ssIGFzayBmb3IgaXQgYW5kIGZldGNoIHRoZSBkb2N1bWVudCBhZnRlclxuICAgICAgICAgIGxvY2tNb2RlbCA9IG5ldyBEb2N1bWVudExvY2soe1xuICAgICAgICAgICAgaW5pdGlkOiB2YWx1ZXMuaW5pdGlkLFxuICAgICAgICAgICAgdmlld0lkOiBuZXh0VmlldyxcbiAgICAgICAgICAgIHR5cGU6IFwidGVtcG9yYXJ5XCJcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBsb2NrTW9kZWwuc2F2ZSh7fSwgbG9ja0NhbGxiYWNrKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpZiAobmVlZFRvVW5sb2NrKSB7XG4gICAgICAgICAgICBpZiAobmVlZFRvVW5sb2NrLmluaXRpZCA9PT0gdmFsdWVzLmluaXRpZCkge1xuICAgICAgICAgICAgICAvLyBJZiBzYW1lIGRvY3VtZW50IFwiZ2V0XCIgbXVzdCBiZSBwZXJmb3JtIGFmdGVyIHVubG9ja1xuICAgICAgICAgICAgICBsb2NrTW9kZWwgPSBuZXcgRG9jdW1lbnRMb2NrKHtcbiAgICAgICAgICAgICAgICBpbml0aWQ6IG5lZWRUb1VubG9jay5pbml0aWQsXG4gICAgICAgICAgICAgICAgdHlwZTogXCJ0ZW1wb3JhcnlcIlxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgbG9ja01vZGVsLmRlc3Ryb3koe1xuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgbG9ja0NhbGxiYWNrLnN1Y2Nlc3MoKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgIGN1cnJlbnRNb2RlbC50cmlnZ2VyKFwic2hvd01lc3NhZ2VcIiwge1xuICAgICAgICAgICAgICAgICAgICB0aXRsZTogaTE4bi5fX18oXG4gICAgICAgICAgICAgICAgICAgICAgXCJEb2N1bWVudCBoYXMgYmVlbiBsb2NrZWQgYnkgc29tZW9uZSBlbHNlLlwiLFxuICAgICAgICAgICAgICAgICAgICAgIFwiZGR1aVwiXG4gICAgICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiaW5mb1wiXG4gICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgIGxvY2tDYWxsYmFjay5zdWNjZXNzKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICBsb2NrQ2FsbGJhY2suc3VjY2VzcygpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgbG9ja01vZGVsID0gbmV3IERvY3VtZW50TG9jayh7XG4gICAgICAgICAgICAgICAgaW5pdGlkOiBuZWVkVG9VbmxvY2suaW5pdGlkLFxuICAgICAgICAgICAgICAgIHR5cGU6IFwidGVtcG9yYXJ5XCJcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIGxvY2tNb2RlbC5kZXN0cm95KCk7XG4gICAgICAgICAgICAgIGxvY2tDYWxsYmFjay5zdWNjZXNzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGxvY2tDYWxsYmFjay5zdWNjZXNzKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgbG9ja0NhbGxiYWNrLnByb21pc2UudGhlbihcbiAgICAgICAgICBmdW5jdGlvbiBtZG9jdW1lbnRfbG9ja1N1Y2VzcygpIHtcbiAgICAgICAgICAgIC8vc2F2ZSB0aGUgbmV3IG9wdGlvbnMgaW4gdGhlIGN1cnJlbnREb2N1bWVudCBmb3IgdGhlIGZldGNoXG4gICAgICAgICAgICBfLmVhY2goXG4gICAgICAgICAgICAgIF8ucGljayh2YWx1ZXMsIFwiaW5pdGlkXCIsIFwicmV2aXNpb25cIiwgXCJ2aWV3SWRcIiksXG4gICAgICAgICAgICAgIGZ1bmN0aW9uIG1Eb2N1bWVudF9TZXROZXdPcHRpb25zKHZhbHVlLCBrZXkpIHtcbiAgICAgICAgICAgICAgICBjdXJyZW50TW9kZWwuc2V0KGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgY3VycmVudE1vZGVsLmZldGNoKGRvY3VtZW50Q2FsbGJhY2spO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZnVuY3Rpb24gbURvY3VtZW50X2xvY2tGYWlsKCkge1xuICAgICAgICAgICAgZ2xvYmFsQ2FsbGJhY2suZXJyb3IuYXBwbHkoY3VycmVudE1vZGVsLCBhcmd1bWVudHMpO1xuICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vUmVpbml0IHByb3BlcnRpZXNcbiAgICAgICAgY3VycmVudE1vZGVsLnNldChzZXJ2ZXJQcm9wZXJ0aWVzKTtcbiAgICAgICAgLy9JbmRpY2F0ZSBzdWNjZXNzIHRvIHRoZSBwcm9taXNlIG9iamVjdFxuICAgICAgICBnbG9iYWxDYWxsYmFjay5lcnJvcih7IGV2ZW50UHJldmVudGVkOiB0cnVlIH0pO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gZ2xvYmFsQ2FsbGJhY2sucHJvbWlzZTtcbiAgICB9LFxuXG4gICAgc2F2ZURvY3VtZW50OiBmdW5jdGlvbiBtRG9jdW1lbnRTYXZlRG9jdW1lbnQoYXR0cmlidXRlcywgb3B0aW9ucykge1xuICAgICAgdmFyIGdsb2JhbENhbGxiYWNrID0gdGhpcy5fcHJvbWlzZUNhbGxiYWNrKCksXG4gICAgICAgIHNhdmVDYWxsYmFjayA9IHRoaXMuX3Byb21pc2VDYWxsYmFjaygpLFxuICAgICAgICBiZWZvcmVTYXZlRXZlbnQgPSB7IHByZXZlbnQ6IGZhbHNlIH0sXG4gICAgICAgIGN1cnJlbnRNb2RlbCA9IHRoaXMsXG4gICAgICAgIHNlcnZlclByb3BlcnRpZXMgPSB0aGlzLmdldFNlcnZlclByb3BlcnRpZXMoKTtcblxuICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG5cbiAgICAgIGlmIChfLmlzRW1wdHkodGhpcy5fY3VzdG9tQ2xpZW50RGF0YSkpIHtcbiAgICAgICAgdGhpcy50cmlnZ2VyKFwiZ2V0Q3VzdG9tQ2xpZW50RGF0YVwiKTtcbiAgICAgIH1cbiAgICAgIHRoaXMudHJpZ2dlcihcImJlZm9yZVNhdmVcIiwgYmVmb3JlU2F2ZUV2ZW50LCB0aGlzLl9jdXN0b21DbGllbnREYXRhKTtcblxuICAgICAgaWYgKGJlZm9yZVNhdmVFdmVudC5wcmV2ZW50ICE9PSBmYWxzZSkge1xuICAgICAgICBnbG9iYWxDYWxsYmFjay5lcnJvcih7IGV2ZW50UHJldmVudGVkOiB0cnVlIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgc2F2ZUNhbGxiYWNrLnByb21pc2UudGhlbihcbiAgICAgICAgICBmdW5jdGlvbiBtRG9jdW1lbnRfc2F2ZURvbmUoKSB7XG4gICAgICAgICAgICBjdXJyZW50TW9kZWwuX2xvYWREb2N1bWVudChjdXJyZW50TW9kZWwpLnRoZW4oXG4gICAgICAgICAgICAgIGZ1bmN0aW9uIG1Eb2N1bWVudF9sb2FkRG9jdW1lbnREb25lKCkge1xuICAgICAgICAgICAgICAgIGdsb2JhbENhbGxiYWNrLnN1Y2Nlc3MoKTtcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgZnVuY3Rpb24gbURvY3VtZW50X2xvYWREb2N1bWVudEZhaWwoKSB7XG4gICAgICAgICAgICAgICAgZ2xvYmFsQ2FsbGJhY2suZXJyb3IuYXBwbHkoY3VycmVudE1vZGVsLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZnVuY3Rpb24gbURvY3VtZW50X3NhdmVGYWlsKCkge1xuICAgICAgICAgICAgZ2xvYmFsQ2FsbGJhY2suZXJyb3IuYXBwbHkoY3VycmVudE1vZGVsLCBhcmd1bWVudHMpO1xuICAgICAgICAgIH1cbiAgICAgICAgKTtcblxuICAgICAgICBpZiAoY3VycmVudE1vZGVsLmhhc1VwbG9hZGluZ0ZpbGUoKSkge1xuICAgICAgICAgIHRoaXMudHJpZ2dlcihcImRpc3BsYXlMb2FkaW5nXCIsIHtcbiAgICAgICAgICAgIGlzU2F2aW5nOiB0cnVlLFxuICAgICAgICAgICAgdGV4dDogaTE4bi5fX18oXCJSZWNvcmRpbmcgZmlsZXMgaW4gcHJvZ3Jlc3NcIiwgXCJkZHVpXCIpXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgY3VycmVudE1vZGVsLnRyaWdnZXIoXCJzaG93TWVzc2FnZVwiLCB7XG4gICAgICAgICAgICB0aXRsZTogaTE4bi5fX18oXCJXYWl0aW5nIHVwbG9hZHMgaW4gcHJvZ3Jlc3NcIiwgXCJkZHVpXCIpLFxuICAgICAgICAgICAgdHlwZTogXCJpbmZvXCJcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBjdXJyZW50TW9kZWwub25jZShcbiAgICAgICAgICAgIFwidXBsb2FkRmlsZUZpbmlzaGVkXCIsXG4gICAgICAgICAgICBmdW5jdGlvbiBtRG9jdW1lbnRzZXRWYWx1ZXNMaXN0ZW5VcGxvYWRVbnRpbFRoZUVuZCgvKmV2ZW50Ki8pIHtcbiAgICAgICAgICAgICAgY3VycmVudE1vZGVsLnRyaWdnZXIoXCJkaXNwbGF5TG9hZGluZ1wiLCB7IGlzU2F2aW5nOiB0cnVlIH0pO1xuICAgICAgICAgICAgICBjdXJyZW50TW9kZWwuc2F2ZShhdHRyaWJ1dGVzLCBzYXZlQ2FsbGJhY2spO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy50cmlnZ2VyKFwiZGlzcGxheUxvYWRpbmdcIiwgeyBpc1NhdmluZzogdHJ1ZSB9KTtcbiAgICAgICAgICBjdXJyZW50TW9kZWwuc2F2ZShhdHRyaWJ1dGVzLCBzYXZlQ2FsbGJhY2spO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGdsb2JhbENhbGxiYWNrLnByb21pc2UudGhlbihcbiAgICAgICAgZnVuY3Rpb24gb25TYXZlU3VjY2Vzcyh2YWx1ZXMpIHtcbiAgICAgICAgICBjdXJyZW50TW9kZWwudHJpZ2dlcihcImFmdGVyU2F2ZVwiLCBzZXJ2ZXJQcm9wZXJ0aWVzKTtcbiAgICAgICAgICBjdXJyZW50TW9kZWwudHJpZ2dlcihcImNsb3NlXCIsIHNlcnZlclByb3BlcnRpZXMpO1xuICAgICAgICAgIGlmIChfLmlzRnVuY3Rpb24ob3B0aW9ucy5zdWNjZXNzKSkge1xuICAgICAgICAgICAgb3B0aW9ucy5zdWNjZXNzKCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGN1cnJlbnRNb2RlbC50cmlnZ2VyLmFwcGx5KFxuICAgICAgICAgICAgY3VycmVudE1vZGVsLFxuICAgICAgICAgICAgXy51bmlvbihbXCJkZHVpRG9jdW1lbnRSZWFkeVwiXSwgdmFsdWVzLnByb21pc2VBcmd1bWVudHMpXG4gICAgICAgICAgKTtcbiAgICAgICAgfSxcbiAgICAgICAgZnVuY3Rpb24gb25TYXZlRmFpbCh2YWx1ZXMpIHtcbiAgICAgICAgICBpZiAoXy5pc0Z1bmN0aW9uKG9wdGlvbnMuZXJyb3IpKSB7XG4gICAgICAgICAgICBvcHRpb25zLmVycm9yKCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICEoXG4gICAgICAgICAgICAgIHZhbHVlcy5wcm9taXNlQXJndW1lbnRzICYmXG4gICAgICAgICAgICAgIHZhbHVlcy5wcm9taXNlQXJndW1lbnRzWzBdICYmXG4gICAgICAgICAgICAgIHZhbHVlcy5wcm9taXNlQXJndW1lbnRzWzBdLmV2ZW50UHJldmVudGVkXG4gICAgICAgICAgICApXG4gICAgICAgICAgKSB7XG4gICAgICAgICAgICBjdXJyZW50TW9kZWwudHJpZ2dlci5hcHBseShcbiAgICAgICAgICAgICAgY3VycmVudE1vZGVsLFxuICAgICAgICAgICAgICBfLnVuaW9uKFtcImRkdWlEb2N1bWVudEZhaWxcIl0sIHZhbHVlcy5wcm9taXNlQXJndW1lbnRzKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICk7XG5cbiAgICAgIHJldHVybiBnbG9iYWxDYWxsYmFjay5wcm9taXNlO1xuICAgIH0sXG5cbiAgICBkZWxldGVEb2N1bWVudDogZnVuY3Rpb24gbURvY3VtZW50RGVsZXRlKG9wdGlvbnMpIHtcbiAgICAgIHZhciBnbG9iYWxDYWxsYmFjayA9IHRoaXMuX3Byb21pc2VDYWxsYmFjaygpLFxuICAgICAgICBkZWxldGVDYWxsYmFjayA9IHRoaXMuX3Byb21pc2VDYWxsYmFjaygpLFxuICAgICAgICBiZWZvcmVEZWxldGVFdmVudCA9IHsgcHJldmVudDogZmFsc2UgfSxcbiAgICAgICAgY3VycmVudE1vZGVsID0gdGhpcyxcbiAgICAgICAgc2VydmVyUHJvcGVydGllcyA9IHRoaXMuZ2V0U2VydmVyUHJvcGVydGllcygpO1xuXG4gICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcblxuICAgICAgaWYgKF8uaXNFbXB0eSh0aGlzLl9jdXN0b21DbGllbnREYXRhKSkge1xuICAgICAgICB0aGlzLnRyaWdnZXIoXCJnZXRDdXN0b21DbGllbnREYXRhXCIpO1xuICAgICAgfVxuICAgICAgdGhpcy50cmlnZ2VyKFwiYmVmb3JlRGVsZXRlXCIsIGJlZm9yZURlbGV0ZUV2ZW50LCB0aGlzLl9jdXN0b21DbGllbnREYXRhKTtcblxuICAgICAgaWYgKGJlZm9yZURlbGV0ZUV2ZW50LnByZXZlbnQgIT09IGZhbHNlKSB7XG4gICAgICAgIGdsb2JhbENhbGxiYWNrLmVycm9yKHsgZXZlbnRQcmV2ZW50ZWQ6IHRydWUgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnRyaWdnZXIoXCJkaXNwbGF5TG9hZGluZ1wiKTtcbiAgICAgICAgZGVsZXRlQ2FsbGJhY2sucHJvbWlzZS50aGVuKFxuICAgICAgICAgIGZ1bmN0aW9uIG1Eb2N1bWVudF9kZWxldGVEb25lKCkge1xuICAgICAgICAgICAgY3VycmVudE1vZGVsXG4gICAgICAgICAgICAgIC5mZXRjaERvY3VtZW50KHsgaW5pdGlkOiBjdXJyZW50TW9kZWwuZ2V0KFwiaW5pdGlkXCIpIH0pXG4gICAgICAgICAgICAgIC50aGVuKFxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIG1Eb2N1bWVudF9hZnRlckRlbGV0ZUxvYWREb25lKCkge1xuICAgICAgICAgICAgICAgICAgZ2xvYmFsQ2FsbGJhY2suc3VjY2VzcygpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gbURvY3VtZW50X2FmdGVyRGVsZXRlTG9hZEZhaWwoKSB7XG4gICAgICAgICAgICAgICAgICBnbG9iYWxDYWxsYmFjay5lcnJvci5hcHBseShjdXJyZW50TW9kZWwsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICApO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZnVuY3Rpb24gbURvY3VtZW50X2RlbGV0ZUZhaWwoKSB7XG4gICAgICAgICAgICBnbG9iYWxDYWxsYmFjay5lcnJvci5hcHBseShjdXJyZW50TW9kZWwsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgfVxuICAgICAgICApO1xuXG4gICAgICAgIHRoaXMuc3luYyhcImRlbGV0ZVwiLCB0aGlzLCBkZWxldGVDYWxsYmFjayk7XG4gICAgICB9XG5cbiAgICAgIGdsb2JhbENhbGxiYWNrLnByb21pc2UudGhlbihcbiAgICAgICAgZnVuY3Rpb24gb25EZWxldGVTdWNjZXNzKHZhbHVlcykge1xuICAgICAgICAgIGN1cnJlbnRNb2RlbC50cmlnZ2VyKFwiYWZ0ZXJEZWxldGVcIiwgc2VydmVyUHJvcGVydGllcyk7XG4gICAgICAgICAgY3VycmVudE1vZGVsLnRyaWdnZXIoXCJjbG9zZVwiLCBzZXJ2ZXJQcm9wZXJ0aWVzKTtcbiAgICAgICAgICBpZiAoXy5pc0Z1bmN0aW9uKG9wdGlvbnMuc3VjY2VzcykpIHtcbiAgICAgICAgICAgIG9wdGlvbnMuc3VjY2VzcygpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjdXJyZW50TW9kZWwudHJpZ2dlci5hcHBseShcbiAgICAgICAgICAgIGN1cnJlbnRNb2RlbCxcbiAgICAgICAgICAgIF8udW5pb24oW1wiZGR1aURvY3VtZW50UmVhZHlcIl0sIHZhbHVlcy5wcm9taXNlQXJndW1lbnRzKVxuICAgICAgICAgICk7XG4gICAgICAgIH0sXG4gICAgICAgIGZ1bmN0aW9uIG9uRGVsZXRlRmFpbCh2YWx1ZXMpIHtcbiAgICAgICAgICBpZiAoXy5pc0Z1bmN0aW9uKG9wdGlvbnMuZXJyb3IpKSB7XG4gICAgICAgICAgICBvcHRpb25zLmVycm9yKCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICEoXG4gICAgICAgICAgICAgIHZhbHVlcy5wcm9taXNlQXJndW1lbnRzICYmXG4gICAgICAgICAgICAgIHZhbHVlcy5wcm9taXNlQXJndW1lbnRzWzBdICYmXG4gICAgICAgICAgICAgIHZhbHVlcy5wcm9taXNlQXJndW1lbnRzWzBdLmV2ZW50UHJldmVudGVkXG4gICAgICAgICAgICApXG4gICAgICAgICAgKSB7XG4gICAgICAgICAgICBjdXJyZW50TW9kZWwudHJpZ2dlci5hcHBseShcbiAgICAgICAgICAgICAgY3VycmVudE1vZGVsLFxuICAgICAgICAgICAgICBfLnVuaW9uKFxuICAgICAgICAgICAgICAgIFtcImRkdWlEb2N1bWVudEZhaWxcIiwgY3VycmVudE1vZGVsXSxcbiAgICAgICAgICAgICAgICB2YWx1ZXMucHJvbWlzZUFyZ3VtZW50c1xuICAgICAgICAgICAgICApXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgKTtcblxuICAgICAgcmV0dXJuIGdsb2JhbENhbGxiYWNrLnByb21pc2U7XG4gICAgfSxcblxuICAgIHJlc3RvcmVEb2N1bWVudDogZnVuY3Rpb24gbURvY3VtZW50UmVzdG9yZURvY3VtZW50KG9wdGlvbnMpIHtcbiAgICAgIHZhciBnbG9iYWxDYWxsYmFjayA9IHRoaXMuX3Byb21pc2VDYWxsYmFjaygpLFxuICAgICAgICByZXN0b3JlQ2FsbGJhY2sgPSB0aGlzLl9wcm9taXNlQ2FsbGJhY2soKSxcbiAgICAgICAgYmVmb3JlUmVzdG9yZUV2ZW50ID0geyBwcmV2ZW50OiBmYWxzZSB9LFxuICAgICAgICBjdXJyZW50TW9kZWwgPSB0aGlzLFxuICAgICAgICBzZXJ2ZXJQcm9wZXJ0aWVzID0gdGhpcy5nZXRTZXJ2ZXJQcm9wZXJ0aWVzKCk7XG5cbiAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuXG4gICAgICBpZiAoXCJkZWxldGVkXCIgPT09IHRoaXMuZ2V0KFwicHJvcGVydGllc1wiKS5nZXQoXCJzdGF0dXNcIikpIHtcbiAgICAgICAgaWYgKF8uaXNFbXB0eSh0aGlzLl9jdXN0b21DbGllbnREYXRhKSkge1xuICAgICAgICAgIHRoaXMudHJpZ2dlcihcImdldEN1c3RvbUNsaWVudERhdGFcIik7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy50cmlnZ2VyKFxuICAgICAgICAgIFwiYmVmb3JlUmVzdG9yZVwiLFxuICAgICAgICAgIGJlZm9yZVJlc3RvcmVFdmVudCxcbiAgICAgICAgICB0aGlzLl9jdXN0b21DbGllbnREYXRhXG4gICAgICAgICk7XG5cbiAgICAgICAgaWYgKGJlZm9yZVJlc3RvcmVFdmVudC5wcmV2ZW50ICE9PSBmYWxzZSkge1xuICAgICAgICAgIGdsb2JhbENhbGxiYWNrLmVycm9yKHsgZXZlbnRQcmV2ZW50ZWQ6IHRydWUgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy50cmlnZ2VyKFwiZGlzcGxheUxvYWRpbmdcIiwgeyBpc1NhdmluZzogdHJ1ZSB9KTtcblxuICAgICAgICAgIHJlc3RvcmVDYWxsYmFjay5wcm9taXNlLnRoZW4oXG4gICAgICAgICAgICBmdW5jdGlvbiBtRG9jdW1lbnRfcmVzdG9yZURvY3VtZW50X1N1Y2Nlc3MoKSB7XG4gICAgICAgICAgICAgIGN1cnJlbnRNb2RlbC5fbG9hZERvY3VtZW50KGN1cnJlbnRNb2RlbCkudGhlbihcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiBtRG9jdW1lbnRfcmVzdG9yZURvY3VtZW50X2xvYWRTdWNjZXNzKCkge1xuICAgICAgICAgICAgICAgICAgZ2xvYmFsQ2FsbGJhY2suc3VjY2VzcygpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gbURvY3VtZW50X3Jlc3RvcmVEb2N1bWVudF9sb2FkRmFpbCgpIHtcbiAgICAgICAgICAgICAgICAgIGdsb2JhbENhbGxiYWNrLmVycm9yLmFwcGx5KGN1cnJlbnRNb2RlbCwgYXJndW1lbnRzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZnVuY3Rpb24gbURvY3VtZW50X3Jlc3RvcmVEb2N1bWVudF9GYWlsKCkge1xuICAgICAgICAgICAgICBnbG9iYWxDYWxsYmFjay5lcnJvci5hcHBseShjdXJyZW50TW9kZWwsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgKTtcblxuICAgICAgICAgIHRoaXMuZ2V0KFwicHJvcGVydGllc1wiKS5zZXQoXCJzdGF0dXNcIiwgXCJhbGl2ZVwiKTtcbiAgICAgICAgICBjdXJyZW50TW9kZWwuc2F2ZSh7fSwgcmVzdG9yZUNhbGxiYWNrKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZ2xvYmFsQ2FsbGJhY2suZXJyb3Ioe1xuICAgICAgICAgIHN5c3RlbUVycm9yOiB0cnVlLFxuICAgICAgICAgIGVycm9yTWVzc2FnZTogXCJVbmFibGUgdG8gcmVzdG9yZSBhbGl2ZSBkb2NcIlxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgZ2xvYmFsQ2FsbGJhY2sucHJvbWlzZS50aGVuKFxuICAgICAgICBmdW5jdGlvbiBtRG9jdW1lbnRfcmVzdG9yZURvY3VtZW50X29uU3VjY2Vzcyh2YWx1ZXMpIHtcbiAgICAgICAgICBjdXJyZW50TW9kZWwudHJpZ2dlcihcImFmdGVyUmVzdG9yZVwiLCBzZXJ2ZXJQcm9wZXJ0aWVzKTtcbiAgICAgICAgICBjdXJyZW50TW9kZWwudHJpZ2dlcihcImNsb3NlXCIsIHNlcnZlclByb3BlcnRpZXMpO1xuICAgICAgICAgIGlmIChfLmlzRnVuY3Rpb24ob3B0aW9ucy5zdWNjZXNzKSkge1xuICAgICAgICAgICAgb3B0aW9ucy5zdWNjZXNzKCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGN1cnJlbnRNb2RlbC50cmlnZ2VyLmFwcGx5KFxuICAgICAgICAgICAgY3VycmVudE1vZGVsLFxuICAgICAgICAgICAgXy51bmlvbihbXCJkZHVpRG9jdW1lbnRSZWFkeVwiXSwgdmFsdWVzLnByb21pc2VBcmd1bWVudHMpXG4gICAgICAgICAgKTtcbiAgICAgICAgfSxcbiAgICAgICAgZnVuY3Rpb24gbURvY3VtZW50X3Jlc3RvcmVEb2N1bWVudF9vbkZhaWwodmFsdWVzKSB7XG4gICAgICAgICAgaWYgKF8uaXNGdW5jdGlvbihvcHRpb25zLmVycm9yKSkge1xuICAgICAgICAgICAgb3B0aW9ucy5lcnJvcigpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAhKFxuICAgICAgICAgICAgICB2YWx1ZXMucHJvbWlzZUFyZ3VtZW50cyAmJlxuICAgICAgICAgICAgICB2YWx1ZXMucHJvbWlzZUFyZ3VtZW50c1swXSAmJlxuICAgICAgICAgICAgICAodmFsdWVzLnByb21pc2VBcmd1bWVudHNbMF0uZXZlbnRQcmV2ZW50ZWQgfHxcbiAgICAgICAgICAgICAgICB2YWx1ZXMucHJvbWlzZUFyZ3VtZW50c1swXS5zeXN0ZW1FcnJvcilcbiAgICAgICAgICAgIClcbiAgICAgICAgICApIHtcbiAgICAgICAgICAgIGN1cnJlbnRNb2RlbC50cmlnZ2VyLmFwcGx5KFxuICAgICAgICAgICAgICBjdXJyZW50TW9kZWwsXG4gICAgICAgICAgICAgIF8udW5pb24oW1wiZGR1aURvY3VtZW50RmFpbFwiXSwgdmFsdWVzLnByb21pc2VBcmd1bWVudHMpXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgKTtcblxuICAgICAgcmV0dXJuIGdsb2JhbENhbGxiYWNrLnByb21pc2U7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEdldCBjb21wbGVtZW50YXJ5IGRhdGEgOiBmYW1pbHkgc3RydWN0dXJlXG4gICAgICovXG4gICAgX2NvbXBsZXRlU3RydWN0dXJlOiBmdW5jdGlvbiBtRG9jdW1lbnRDb21wbGV0ZVN0cnVjdHVyZSgpIHtcbiAgICAgIHZhciBtU3RydWN0dXJlLFxuICAgICAgICBkb2N1bWVudE1vZGVsID0gdGhpcyxcbiAgICAgICAgc3RydWN0dXJlUHJvbWlzZSA9IHRoaXMuX3Byb21pc2VDYWxsYmFjaygpO1xuXG4gICAgICB2YXIgbmVlZGVkQXR0cmlidXRlcyA9IHRoaXMuZ2V0KFwicmVuZGVyT3B0aW9uc1wiKS5uZWVkZWQ7XG4gICAgICB2YXIgdmlzaWJpbGl0eUF0dHJpYnV0ZXMgPSB0aGlzLmdldChcInJlbmRlck9wdGlvbnNcIikudmlzaWJpbGl0aWVzO1xuICAgICAgdmFyIHZhbHVlQXR0cmlidXRlcyA9IHRoaXMuZ2V0KFwib3JpZ2luYWxWYWx1ZXNcIik7XG5cbiAgICAgIGlmICh0aGlzLmdldChcInByb3BlcnRpZXNcIikuZ2V0KFwidHlwZVwiKSA9PT0gXCJmYW1pbHlcIikge1xuICAgICAgICAvLyBGYW1pbHkgaGFzIG5vIGF0dHJpYnV0ZXNcbiAgICAgICAgdGhpcy5zZXQoXCJhdHRyaWJ1dGVzXCIsIFtdKTtcbiAgICAgICAgc3RydWN0dXJlUHJvbWlzZS5zdWNjZXNzKCk7XG4gICAgICAgIHJldHVybiBzdHJ1Y3R1cmVQcm9taXNlLnByb21pc2U7XG4gICAgICB9XG5cbiAgICAgIGlmICghXy5pc1VuZGVmaW5lZCh0aGlzLmdldChcImF0dHJpYnV0ZXNcIikpKSB7XG4gICAgICAgIHRoaXMuc2V0KFwiYXR0cmlidXRlc1wiLCB0aGlzLmdldChcImF0dHJpYnV0ZXNcIikpOyAvLyB0byBjb252ZXJ0IGF0dHJpYnV0ZXMgdG8gbW9kZWxzXG4gICAgICAgIHN0cnVjdHVyZVByb21pc2Uuc3VjY2VzcygpO1xuICAgICAgICByZXR1cm4gc3RydWN0dXJlUHJvbWlzZS5wcm9taXNlO1xuICAgICAgfVxuXG4gICAgICBtU3RydWN0dXJlID0gbmV3IEZhbWlseVN0cnVjdHVyZSh7XG4gICAgICAgIGZhbWlseUlkOiB0aGlzLmdldChcInByb3BlcnRpZXNcIikuZ2V0KFwiZmFtaWx5XCIpLm5hbWUsXG4gICAgICAgIHJlZmVyZW5jZWRvY3VtZW50OiB7XG4gICAgICAgICAgaW5pdGlkOiB0aGlzLmdldChcImluaXRpZFwiKSxcbiAgICAgICAgICB2aWV3SWQ6IHRoaXMuZ2V0KFwidmlld0lkXCIpLFxuICAgICAgICAgIHJldmlzaW9uOiB0aGlzLmdldChcInJldmlzaW9uXCIpXG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICBtU3RydWN0dXJlLmZldGNoKHtcbiAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gbURvY3VtZW50Q29tcGxldGVTdHJ1Y3R1cmVTdWNjZXNzKFxuICAgICAgICAgIHN0cnVjdHVyZU1vZGVsLFxuICAgICAgICAgIHJlc3BvbnNlXG4gICAgICAgICkge1xuICAgICAgICAgIGlmIChcbiAgICAgICAgICAgIF8uaXNFcXVhbChzdHJ1Y3R1cmVNb2RlbC5nZXQoXCJyZWZlcmVuY2Vkb2N1bWVudFwiKSwge1xuICAgICAgICAgICAgICBpbml0aWQ6IGRvY3VtZW50TW9kZWwuZ2V0KFwiaW5pdGlkXCIpLFxuICAgICAgICAgICAgICB2aWV3SWQ6IGRvY3VtZW50TW9kZWwuZ2V0KFwidmlld0lkXCIpLFxuICAgICAgICAgICAgICByZXZpc2lvbjogZG9jdW1lbnRNb2RlbC5nZXQoXCJyZXZpc2lvblwiKVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICApIHtcbiAgICAgICAgICAgIHZhciBhdHRyaWJ1dGVzID0gZmxhdHRlbkF0dHJpYnV0ZXMoXG4gICAgICAgICAgICAgIGF0dHJpYnV0ZXMsXG4gICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEuZmFtaWx5LnN0cnVjdHVyZVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIF8uZWFjaChhdHRyaWJ1dGVzLCBmdW5jdGlvbiBtRG9jdW1lbnRDb21wbGV0ZVN0cnVjdHVyZVN1Y2Nlc3NFYWNoKFxuICAgICAgICAgICAgICBjdXJyZW50QXR0cmlidXRlU3RydWN0dXJlXG4gICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICAgIGN1cnJlbnRBdHRyaWJ1dGVTdHJ1Y3R1cmUuaWQgJiZcbiAgICAgICAgICAgICAgICB2YWx1ZUF0dHJpYnV0ZXNbY3VycmVudEF0dHJpYnV0ZVN0cnVjdHVyZS5pZF1cbiAgICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgY3VycmVudEF0dHJpYnV0ZVN0cnVjdHVyZS5hdHRyaWJ1dGVWYWx1ZSA9XG4gICAgICAgICAgICAgICAgICB2YWx1ZUF0dHJpYnV0ZXNbY3VycmVudEF0dHJpYnV0ZVN0cnVjdHVyZS5pZF07XG4gICAgICAgICAgICAgICAgY3VycmVudEF0dHJpYnV0ZVN0cnVjdHVyZS5uZWVkZWQgPVxuICAgICAgICAgICAgICAgICAgbmVlZGVkQXR0cmlidXRlc1tjdXJyZW50QXR0cmlidXRlU3RydWN0dXJlLmlkXSA9PT0gdHJ1ZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgY3VycmVudEF0dHJpYnV0ZVN0cnVjdHVyZS5pZCAmJlxuICAgICAgICAgICAgICAgIHZpc2liaWxpdHlBdHRyaWJ1dGVzW2N1cnJlbnRBdHRyaWJ1dGVTdHJ1Y3R1cmUuaWRdXG4gICAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgIGN1cnJlbnRBdHRyaWJ1dGVTdHJ1Y3R1cmUudmlzaWJpbGl0eSA9XG4gICAgICAgICAgICAgICAgICB2aXNpYmlsaXR5QXR0cmlidXRlc1tjdXJyZW50QXR0cmlidXRlU3RydWN0dXJlLmlkXTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBkb2N1bWVudE1vZGVsLnNldChcImF0dHJpYnV0ZXNcIiwgYXR0cmlidXRlcyk7XG4gICAgICAgICAgICBzdHJ1Y3R1cmVQcm9taXNlLnN1Y2Nlc3MoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgZXJyb3I6IHN0cnVjdHVyZVByb21pc2UuZXJyb3JcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHN0cnVjdHVyZVByb21pc2UucHJvbWlzZTtcbiAgICB9XG4gIH0pO1xufSk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///ab4ce4f91706f6c2712e\n");

/***/ }),

/***/ "ae9a1dffcb7d80ee2f61":
/*!******************************************************************!*\
  !*** ./src/Apps/DOCUMENT/IHM/controllerObjects/menuInterface.js ***!
  \******************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/*global define*/\n!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(/*! underscore */ \"8e08e542008e4aef1f58\")], __WEBPACK_AMD_DEFINE_RESULT__ = (function menuInterface(_) {\n  \"use strict\";\n\n  var MenuError = function MenuError(message) {\n    this.name = \"MenuError\";\n    this.message = message || \"Default Message\";\n    this.stack = new Error().stack;\n  };\n  MenuError.prototype = Object.create(Error.prototype);\n  MenuError.prototype.constructor = MenuError;\n\n  var MenuPrototope = function AttributePrototype() {\n    if (this._menuModel) {\n      this.id = this._menuModel.id;\n    } else {\n      this.id = null;\n    }\n  };\n  MenuPrototope.prototype._menuModel = null;\n  MenuPrototope.prototype._set = function MenuPrototope_set(\n    key,\n    value,\n    options\n  ) {\n    if (options && options.strict === true && !this.id) {\n      throw new MenuError(\"This menu doesn't exist\");\n    }\n    if (this.id || (options && options.strict === true)) {\n      this._menuModel.set(key, value, options);\n    }\n  };\n  /**\n   * Get the property of the current attribute\n   *\n   * @returns {*}\n   */\n  MenuPrototope.prototype.getProperties = function menuInterfaceGetProperties(\n    options\n  ) {\n    if (options && options.strict === true && !this.id) {\n      throw new MenuError(\"This menu doesn't exist\");\n    }\n    if (this.id || (options && options.strict === true)) {\n      return _.clone(this._menuModel.attributes);\n    }\n    return {};\n  };\n\n  /**\n   * Disable an item menu\n   *\n   * @returns {*}\n   */\n  MenuPrototope.prototype.disable = function menuInterfaceDisable(options) {\n    this._set(\"visibility\", \"disabled\", options);\n  };\n  /**\n   * Enable and show an item menu\n   *\n   * @returns {*}\n   */\n  MenuPrototope.prototype.enable = function menuInterfaceEnable(options) {\n    this._set(\"visibility\", \"visible\", options);\n  };\n\n  /**\n   * Hide an item menu\n   *\n   * @returns {*}\n   */\n  MenuPrototope.prototype.hide = function menuInterfaceHide(options) {\n    this._set(\"visibility\", \"hidden\", options);\n  };\n\n  /**\n   * Change text label\n   * @param label raw text\n   *\n   * @returns {*}\n   * @param options\n   */\n  MenuPrototope.prototype.setLabel = function menuInterfaceSetLabel(\n    label,\n    options\n  ) {\n    this._set(\"label\", label, options);\n  };\n\n  /**\n   * Change html label\n   * @param label html fragment\n   *\n   * @returns {*}\n   * @param options\n   */\n  MenuPrototope.prototype.setHtmlLabel = function menuInterfaceSetHtmlLabel(\n    label,\n    options\n  ) {\n    this._set(\"htmlLabel\", label, options);\n  };\n\n  /**\n   * Change icon url\n   * @param url image url\n   *\n   * @returns {*}\n   * @param options\n   */\n  MenuPrototope.prototype.setIconUrl = function menuInterfaceSetIconUrl(\n    url,\n    options\n  ) {\n    this._set(\"iconUrl\", url, options);\n  };\n  /**\n   * Change custom css class\n   * @param cssClass css class\n   *\n   * @returns {*}\n   * @param options\n   */\n  MenuPrototope.prototype.setCssClass = function menuInterfaceSetCssClass(\n    cssClass,\n    options\n  ) {\n    this._set(\"cssClass\", cssClass, options);\n  };\n\n  /**\n   * Change url\n   * @param url\n   *\n   * @returns {*}\n   * @param options\n   */\n  MenuPrototope.prototype.setUrl = function menuInterfaceSetUrl(url, options) {\n    this._set(\"url\", url, options);\n  };\n\n  MenuPrototope.prototype.redraw = function menuInterfaceRedraw() {\n    this._menuModel.trigger(\"reload\");\n  };\n\n  var MenuInterface = function menuInterface(attributeModel) {\n    this._menuModel = attributeModel;\n    MenuPrototope.call(this);\n  };\n\n  MenuInterface.prototype = Object.create(MenuPrototope.prototype);\n  MenuInterface.prototype.constructor = MenuPrototope;\n\n  return MenuInterface;\n}).apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWU5YTFkZmZjYjdkODBlZTJmNjEuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvQXBwcy9ET0NVTUVOVC9JSE0vY29udHJvbGxlck9iamVjdHMvbWVudUludGVyZmFjZS5qcz83OTM2Il0sInNvdXJjZXNDb250ZW50IjpbIi8qZ2xvYmFsIGRlZmluZSovXG5kZWZpbmUoW1widW5kZXJzY29yZVwiXSwgZnVuY3Rpb24gbWVudUludGVyZmFjZShfKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIHZhciBNZW51RXJyb3IgPSBmdW5jdGlvbiBNZW51RXJyb3IobWVzc2FnZSkge1xuICAgIHRoaXMubmFtZSA9IFwiTWVudUVycm9yXCI7XG4gICAgdGhpcy5tZXNzYWdlID0gbWVzc2FnZSB8fCBcIkRlZmF1bHQgTWVzc2FnZVwiO1xuICAgIHRoaXMuc3RhY2sgPSBuZXcgRXJyb3IoKS5zdGFjaztcbiAgfTtcbiAgTWVudUVycm9yLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoRXJyb3IucHJvdG90eXBlKTtcbiAgTWVudUVycm9yLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IE1lbnVFcnJvcjtcblxuICB2YXIgTWVudVByb3RvdG9wZSA9IGZ1bmN0aW9uIEF0dHJpYnV0ZVByb3RvdHlwZSgpIHtcbiAgICBpZiAodGhpcy5fbWVudU1vZGVsKSB7XG4gICAgICB0aGlzLmlkID0gdGhpcy5fbWVudU1vZGVsLmlkO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmlkID0gbnVsbDtcbiAgICB9XG4gIH07XG4gIE1lbnVQcm90b3RvcGUucHJvdG90eXBlLl9tZW51TW9kZWwgPSBudWxsO1xuICBNZW51UHJvdG90b3BlLnByb3RvdHlwZS5fc2V0ID0gZnVuY3Rpb24gTWVudVByb3RvdG9wZV9zZXQoXG4gICAga2V5LFxuICAgIHZhbHVlLFxuICAgIG9wdGlvbnNcbiAgKSB7XG4gICAgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5zdHJpY3QgPT09IHRydWUgJiYgIXRoaXMuaWQpIHtcbiAgICAgIHRocm93IG5ldyBNZW51RXJyb3IoXCJUaGlzIG1lbnUgZG9lc24ndCBleGlzdFwiKTtcbiAgICB9XG4gICAgaWYgKHRoaXMuaWQgfHwgKG9wdGlvbnMgJiYgb3B0aW9ucy5zdHJpY3QgPT09IHRydWUpKSB7XG4gICAgICB0aGlzLl9tZW51TW9kZWwuc2V0KGtleSwgdmFsdWUsIG9wdGlvbnMpO1xuICAgIH1cbiAgfTtcbiAgLyoqXG4gICAqIEdldCB0aGUgcHJvcGVydHkgb2YgdGhlIGN1cnJlbnQgYXR0cmlidXRlXG4gICAqXG4gICAqIEByZXR1cm5zIHsqfVxuICAgKi9cbiAgTWVudVByb3RvdG9wZS5wcm90b3R5cGUuZ2V0UHJvcGVydGllcyA9IGZ1bmN0aW9uIG1lbnVJbnRlcmZhY2VHZXRQcm9wZXJ0aWVzKFxuICAgIG9wdGlvbnNcbiAgKSB7XG4gICAgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5zdHJpY3QgPT09IHRydWUgJiYgIXRoaXMuaWQpIHtcbiAgICAgIHRocm93IG5ldyBNZW51RXJyb3IoXCJUaGlzIG1lbnUgZG9lc24ndCBleGlzdFwiKTtcbiAgICB9XG4gICAgaWYgKHRoaXMuaWQgfHwgKG9wdGlvbnMgJiYgb3B0aW9ucy5zdHJpY3QgPT09IHRydWUpKSB7XG4gICAgICByZXR1cm4gXy5jbG9uZSh0aGlzLl9tZW51TW9kZWwuYXR0cmlidXRlcyk7XG4gICAgfVxuICAgIHJldHVybiB7fTtcbiAgfTtcblxuICAvKipcbiAgICogRGlzYWJsZSBhbiBpdGVtIG1lbnVcbiAgICpcbiAgICogQHJldHVybnMgeyp9XG4gICAqL1xuICBNZW51UHJvdG90b3BlLnByb3RvdHlwZS5kaXNhYmxlID0gZnVuY3Rpb24gbWVudUludGVyZmFjZURpc2FibGUob3B0aW9ucykge1xuICAgIHRoaXMuX3NldChcInZpc2liaWxpdHlcIiwgXCJkaXNhYmxlZFwiLCBvcHRpb25zKTtcbiAgfTtcbiAgLyoqXG4gICAqIEVuYWJsZSBhbmQgc2hvdyBhbiBpdGVtIG1lbnVcbiAgICpcbiAgICogQHJldHVybnMgeyp9XG4gICAqL1xuICBNZW51UHJvdG90b3BlLnByb3RvdHlwZS5lbmFibGUgPSBmdW5jdGlvbiBtZW51SW50ZXJmYWNlRW5hYmxlKG9wdGlvbnMpIHtcbiAgICB0aGlzLl9zZXQoXCJ2aXNpYmlsaXR5XCIsIFwidmlzaWJsZVwiLCBvcHRpb25zKTtcbiAgfTtcblxuICAvKipcbiAgICogSGlkZSBhbiBpdGVtIG1lbnVcbiAgICpcbiAgICogQHJldHVybnMgeyp9XG4gICAqL1xuICBNZW51UHJvdG90b3BlLnByb3RvdHlwZS5oaWRlID0gZnVuY3Rpb24gbWVudUludGVyZmFjZUhpZGUob3B0aW9ucykge1xuICAgIHRoaXMuX3NldChcInZpc2liaWxpdHlcIiwgXCJoaWRkZW5cIiwgb3B0aW9ucyk7XG4gIH07XG5cbiAgLyoqXG4gICAqIENoYW5nZSB0ZXh0IGxhYmVsXG4gICAqIEBwYXJhbSBsYWJlbCByYXcgdGV4dFxuICAgKlxuICAgKiBAcmV0dXJucyB7Kn1cbiAgICogQHBhcmFtIG9wdGlvbnNcbiAgICovXG4gIE1lbnVQcm90b3RvcGUucHJvdG90eXBlLnNldExhYmVsID0gZnVuY3Rpb24gbWVudUludGVyZmFjZVNldExhYmVsKFxuICAgIGxhYmVsLFxuICAgIG9wdGlvbnNcbiAgKSB7XG4gICAgdGhpcy5fc2V0KFwibGFiZWxcIiwgbGFiZWwsIG9wdGlvbnMpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBDaGFuZ2UgaHRtbCBsYWJlbFxuICAgKiBAcGFyYW0gbGFiZWwgaHRtbCBmcmFnbWVudFxuICAgKlxuICAgKiBAcmV0dXJucyB7Kn1cbiAgICogQHBhcmFtIG9wdGlvbnNcbiAgICovXG4gIE1lbnVQcm90b3RvcGUucHJvdG90eXBlLnNldEh0bWxMYWJlbCA9IGZ1bmN0aW9uIG1lbnVJbnRlcmZhY2VTZXRIdG1sTGFiZWwoXG4gICAgbGFiZWwsXG4gICAgb3B0aW9uc1xuICApIHtcbiAgICB0aGlzLl9zZXQoXCJodG1sTGFiZWxcIiwgbGFiZWwsIG9wdGlvbnMpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBDaGFuZ2UgaWNvbiB1cmxcbiAgICogQHBhcmFtIHVybCBpbWFnZSB1cmxcbiAgICpcbiAgICogQHJldHVybnMgeyp9XG4gICAqIEBwYXJhbSBvcHRpb25zXG4gICAqL1xuICBNZW51UHJvdG90b3BlLnByb3RvdHlwZS5zZXRJY29uVXJsID0gZnVuY3Rpb24gbWVudUludGVyZmFjZVNldEljb25VcmwoXG4gICAgdXJsLFxuICAgIG9wdGlvbnNcbiAgKSB7XG4gICAgdGhpcy5fc2V0KFwiaWNvblVybFwiLCB1cmwsIG9wdGlvbnMpO1xuICB9O1xuICAvKipcbiAgICogQ2hhbmdlIGN1c3RvbSBjc3MgY2xhc3NcbiAgICogQHBhcmFtIGNzc0NsYXNzIGNzcyBjbGFzc1xuICAgKlxuICAgKiBAcmV0dXJucyB7Kn1cbiAgICogQHBhcmFtIG9wdGlvbnNcbiAgICovXG4gIE1lbnVQcm90b3RvcGUucHJvdG90eXBlLnNldENzc0NsYXNzID0gZnVuY3Rpb24gbWVudUludGVyZmFjZVNldENzc0NsYXNzKFxuICAgIGNzc0NsYXNzLFxuICAgIG9wdGlvbnNcbiAgKSB7XG4gICAgdGhpcy5fc2V0KFwiY3NzQ2xhc3NcIiwgY3NzQ2xhc3MsIG9wdGlvbnMpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBDaGFuZ2UgdXJsXG4gICAqIEBwYXJhbSB1cmxcbiAgICpcbiAgICogQHJldHVybnMgeyp9XG4gICAqIEBwYXJhbSBvcHRpb25zXG4gICAqL1xuICBNZW51UHJvdG90b3BlLnByb3RvdHlwZS5zZXRVcmwgPSBmdW5jdGlvbiBtZW51SW50ZXJmYWNlU2V0VXJsKHVybCwgb3B0aW9ucykge1xuICAgIHRoaXMuX3NldChcInVybFwiLCB1cmwsIG9wdGlvbnMpO1xuICB9O1xuXG4gIE1lbnVQcm90b3RvcGUucHJvdG90eXBlLnJlZHJhdyA9IGZ1bmN0aW9uIG1lbnVJbnRlcmZhY2VSZWRyYXcoKSB7XG4gICAgdGhpcy5fbWVudU1vZGVsLnRyaWdnZXIoXCJyZWxvYWRcIik7XG4gIH07XG5cbiAgdmFyIE1lbnVJbnRlcmZhY2UgPSBmdW5jdGlvbiBtZW51SW50ZXJmYWNlKGF0dHJpYnV0ZU1vZGVsKSB7XG4gICAgdGhpcy5fbWVudU1vZGVsID0gYXR0cmlidXRlTW9kZWw7XG4gICAgTWVudVByb3RvdG9wZS5jYWxsKHRoaXMpO1xuICB9O1xuXG4gIE1lbnVJbnRlcmZhY2UucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShNZW51UHJvdG90b3BlLnByb3RvdHlwZSk7XG4gIE1lbnVJbnRlcmZhY2UucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gTWVudVByb3RvdG9wZTtcblxuICByZXR1cm4gTWVudUludGVyZmFjZTtcbn0pO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///ae9a1dffcb7d80ee2f61\n");

/***/ }),

/***/ "af25306fd60189c120f8":
/*!****************************************************************!*\
  !*** ./src/Apps/DOCUMENT/IHM/widgets/attributes/file/wFile.js ***!
  \****************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/*global define*/\n(function umdRequire(root, factory) {\n  \"use strict\";\n\n  if (true) {\n    !(__WEBPACK_AMD_DEFINE_ARRAY__ = [\n      __webpack_require__(/*! jquery */ \"127c8cf59f228bb01a21\"),\n      __webpack_require__(/*! underscore */ \"8e08e542008e4aef1f58\"),\n      __webpack_require__(/*! dcpDocument/widgets/attributes/text/wText */ \"61b480911316cdda77a4\")\n    ], __WEBPACK_AMD_DEFINE_FACTORY__ = (factory),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?\n\t\t\t\t(__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n  } else {}\n})(window, function wFileWidget($, _) {\n  \"use strict\";\n\n  //noinspection JSUnusedLocalSymbols\n  $.widget(\"dcp.dcpFile\", $.dcp.dcpText, {\n    uploadingFiles: 0, // file upload in progress\n    options: {\n      type: \"file\",\n      renderOptions: {\n        contentDisposition: false,\n        htmlLink: {},\n        placeHolder: \"Click to upload file\"\n      },\n      labels: {\n        dropFileHere: \"Drop file here\",\n        tooltipLabel: \"Choose file\",\n        downloadLabel: \"Download file\",\n        recording: \"Recording\",\n        transferring: \"Transferring\",\n        kiloByte: \"kB\",\n        byte: \"B\"\n      }\n    },\n\n    _initDom: function wFileInitDom() {\n      var visibleInput;\n      if (this.getMode() === \"read\") {\n        var urlSep = \"?\";\n        if (this.options.attributeValue.url) {\n          if (!this.options.renderOptions.htmlLink.url) {\n            if (this.options.attributeValue.url) {\n              urlSep =\n                this.options.attributeValue.url.indexOf(\"?\") >= 0 ? \"&\" : \"?\";\n              if (this.options.renderOptions.contentDisposition === \"inline\") {\n                this.options.attributeValue.url = this.options.attributeValue.url.replace(\n                  \"&inline=no\",\n                  \"\"\n                );\n                this.options.attributeValue.url += urlSep + \"inline=yes\";\n              } else {\n                this.options.attributeValue.url = this.options.attributeValue.url.replace(\n                  \"&inline=yes\",\n                  \"\"\n                );\n                this.options.attributeValue.url += urlSep + \"inline=no\";\n              }\n            }\n            this.options.renderOptions.htmlLink.url = this.options.attributeValue.url;\n\n            if (!this.options.renderOptions.htmlLink.title) {\n              this.options.renderOptions.htmlLink.title = this.options.attributeValue.displayValue;\n              if (this.options.attributeValue.size >= 1024) {\n                this.options.renderOptions.htmlLink.title +=\n                  \"<br/>(\" +\n                  Math.round(this.options.attributeValue.size / 1024) +\n                  \" \" +\n                  this.options.labels.kiloByte +\n                  \")\";\n              } else {\n                this.options.renderOptions.htmlLink.title +=\n                  \"<br/>(\" +\n                  this.options.attributeValue.size +\n                  \" \" +\n                  this.options.labels.byte +\n                  \")\";\n              }\n            }\n          }\n        }\n      }\n      if (this.options.renderOptions.mimeIconSize) {\n        if (\n          [\"0\", \"0x0\", \"x0\"].indexOf(\n            this.options.renderOptions.mimeIconSize\n          ) !== -1\n        ) {\n          this.options.attributeValue.icon = null;\n        } else {\n          var reSize = /sizes\\/([^/]+)/;\n          this.options.attributeValue.icon = this.options.attributeValue.icon.replace(\n            reSize,\n            \"sizes/\" + this.options.renderOptions.mimeIconSize\n          );\n        }\n      }\n      this._super();\n      if (this.getMode() === \"write\") {\n        visibleInput = this.element.find(\"input[type=text]\");\n        visibleInput.attr(\"title\", this.options.labels.tooltipLabel);\n        visibleInput.attr(\n          \"placeholder\",\n          this.options.renderOptions.placeHolder\n        );\n        this.element\n          .find(\".dcpAttribute__content__button--file\")\n          .attr(\"title\", this.options.labels.downloadLabel);\n\n        visibleInput.tooltip({\n          trigger: \"hover\",\n          placement: \"bottom\",\n          container: \".dcpDocument\"\n        });\n        this.element\n          .find(\"input[type=file]\")\n          .attr(\"fileValue\", this.options.attributeValue.value || null);\n      }\n    },\n\n    _initEvent: function wFileInitEvent() {\n      var currentWidget = this;\n      if (this.getMode() === \"write\") {\n        this._initUploadEvent();\n      }\n\n      // Add trigger when try to download file\n      this.element.on(\n        \"click.\" + this.eventNamespace,\n        \".dcpAttribute__content__link\",\n        function wFileClickDownload(event) {\n          currentWidget._trigger(\"downloadFile\", event, {\n            $el: currentWidget.element,\n            index: currentWidget._getIndex()\n          });\n        }\n      );\n\n      this._super();\n    },\n\n    _initChangeEvent: function wFileInitChangeEvent() {\n      // set by widget if no autocomplete\n      if (this.options.hasAutocomplete) {\n        this._super();\n      }\n    },\n\n    _initUploadEvent: function wFileInitUploadEvent() {\n      var currentWidget = this;\n      var inputFile = this.element.find(\"input[type=file]\");\n      var inputText = this.element.find(\".dcpAttribute__value\");\n      var fileUrl = this.options.attributeValue.url;\n\n      if (fileUrl) {\n        this.element.on(\n          \"click\" + this.eventNamespace,\n          \".dcpAttribute__content__button--file\",\n          function wFileOnButtonClickr(event) {\n            var isNotPrevented = currentWidget._trigger(\"downloadFile\", event, {\n              $el: currentWidget.element,\n              index: currentWidget._getIndex()\n            });\n            if (isNotPrevented) {\n              var url = fileUrl,\n                $base = $(\"base\");\n\n              if (isNotPrevented) {\n                if ($base.length > 0) {\n                  // For IE : Not honor base href in this case\n                  url = $base.attr(\"href\") + url;\n                }\n                window.open(url);\n              }\n            }\n          }\n        );\n      } else {\n        this.element\n          .find(\".dcpAttribute__content__button--file\")\n          .attr(\"disabled\", \"disabled\");\n      }\n\n      if (!_.isUndefined(window.FormData)) {\n        this.element.on(\n          \"dragenter\" + this.eventNamespace,\n          \".dcpAttribute__dragTarget\",\n          function wFileOnDragEnter(event) {\n            inputText.val(currentWidget.options.attributeValue.displayValue);\n            event.stopPropagation();\n            event.preventDefault();\n          }\n        );\n        this.element.on(\n          \"dragover\" + this.eventNamespace,\n          \".dcpAttribute__dragTarget\",\n          function wFileOnDragOver(event) {\n            inputText.val(currentWidget.options.labels.dropFileHere);\n            event.stopPropagation();\n            event.preventDefault();\n            currentWidget.element.addClass(\"dcpAttribute__value--dropzone\");\n          }\n        );\n        this.element.on(\n          \"dragleave\" + this.eventNamespace,\n          \".dcpAttribute__dragTarget\",\n          function wFileOnLeave(event) {\n            inputText.val(currentWidget.options.attributeValue.displayValue);\n            event.stopPropagation();\n            event.preventDefault();\n            currentWidget.element.removeClass(\"dcpAttribute__value--dropzone\");\n          }\n        );\n\n        this.element.on(\n          \"drop\" + this.eventNamespace,\n          \".dcpAttribute__dragTarget\",\n          function wFileOnDrop(event) {\n            inputText.val(currentWidget.options.attributeValue.displayValue);\n            currentWidget.element.removeClass(\"dcpAttribute__value--dropzone\");\n            event.stopPropagation();\n            event.preventDefault();\n\n            var dt = event.originalEvent.dataTransfer;\n            var files = dt.files;\n            if (files.length > 0) {\n              currentWidget.uploadFile(files[0]);\n            }\n          }\n        );\n\n        this.element.on(\n          \"click\" + this.eventNamespace,\n          \".dcpAttribute__value\",\n          function wFileOnClick() {\n            inputFile.trigger(\"click\");\n          }\n        );\n\n        this.element.on(\n          \"keydown\" + this.eventNamespace,\n          \".dcpAttribute__value\",\n          function wFileFilterKeys(event) {\n            if (\n              event.keyCode !== 9 &&\n              event.keyCode !== 32 &&\n              event.keyCode !== 13\n            ) {\n              event.preventDefault();\n            }\n          }\n        );\n        this.element.on(\n          \"keyup\" + this.eventNamespace,\n          \".dcpAttribute__value\",\n          function wFileSelectKeys(event) {\n            if (event.keyCode !== 9) {\n              event.preventDefault();\n              if (event.keyCode === 32 || event.keyCode === 13) {\n                inputFile.trigger(\"click\");\n              }\n            }\n          }\n        );\n\n        this.element.on(\n          \"change\" + this.eventNamespace,\n          \"input[type=file]\",\n          function wFileChange(/*event*/) {\n            if (this.files && this.files.length > 0) {\n              currentWidget.uploadFile(this.files[0]);\n            }\n          }\n        );\n      } else {\n        alert(\"Your browser not support FormData\");\n      }\n    },\n\n    getWidgetValue: function wFilegetWidgetValue() {\n      var $inputFile = this.element.find(\"input[type=file]\");\n      return $inputFile.attr(\"fileValue\") || null;\n    },\n\n    /**\n     * Condition before upload file\n     * @returns {boolean}\n     */\n    uploadCondition: function wFileUploadCondition() {\n      return true;\n    },\n\n    uploadFileForm: function wFileUploadFileForm() {\n      var inputText = this.element.find(\".dcpAttribute__value\");\n\n      var inputFile = this.element.find(\"input[type=file]\");\n      this._setVisibilitySavingMenu(\"disabled\");\n\n      inputText.addClass(\"dcpAttribute__value--transferring\");\n      inputText.val(\n        this.options.labels.transferring +\n          \" \" +\n          inputFile\n            .val()\n            .split(/[\\\\/]/)\n            .pop()\n      );\n      this.element.find(\"form\").submit();\n    },\n\n    uploadFile: function wFileUploadFile(firstFile) {\n      var inputText = this.element.find(\".dcpAttribute__value\");\n      var formData = new FormData();\n      var newFileName = firstFile.name;\n      var originalText = inputText.val();\n      var originalBgColor = inputText.css(\"background-color\");\n      var currentWidget = this;\n      var event = { prevent: false };\n      var $inputFile = this.element.find(\"input[type=file]\");\n\n      if (!this.uploadCondition(firstFile)) {\n        return;\n      }\n\n      var isNotPrevented = currentWidget._trigger(\"uploadfile\", event, {\n        $el: currentWidget.element,\n        index: currentWidget._getIndex(),\n        file: firstFile\n      });\n      if (!isNotPrevented) {\n        return;\n      }\n      //currentWidget.setValue(currentFileValue);\n      currentWidget.uploadingFiles++;\n      formData.append(\"dcpFile\", firstFile);\n      $inputFile.prop(\"disabled\", true);\n\n      inputText.addClass(\"dcpAttribute__value--transferring\");\n      var infoBgColor = inputText.css(\"background-color\");\n      $.ajax({\n        type: \"POST\",\n        url: \"api/v2/temporaryFiles/\",\n        processData: false,\n        contentType: false,\n        cache: false,\n        data: formData,\n\n        xhr: function wFileXhrAddProgress() {\n          var xhrObject = $.ajaxSettings.xhr();\n          if (xhrObject.upload) {\n            xhrObject.upload.addEventListener(\n              \"progress\",\n              function wFileProgress(event) {\n                var percent = 0;\n                var position = event.loaded || event.position;\n                var total = event.total;\n                if (event.lengthComputable) {\n                  percent = Math.ceil((position / total) * 100);\n                }\n                if (percent >= 100) {\n                  inputText.val(\n                    currentWidget.options.labels.recording + \" \" + newFileName\n                  );\n                  inputText.removeClass(\"dcpAttribute__value--transferring\");\n                  inputText.addClass(\n                    \"dcpAttribute__value--recording progress-bar active progress-bar-striped\"\n                  );\n                  inputText.css(\"background\", \"\");\n                  inputText.css(\"background-image\", \"\");\n                } else {\n                  inputText.addClass(\"dcpAttribute__value--transferring\");\n                  inputText.val(\n                    currentWidget.options.labels.transferring +\n                      \" \" +\n                      newFileName\n                  );\n                  inputText.css(\"background-color\", \"red\");\n                  inputText.css(\n                    \"background\",\n                    \"linear-gradient(to right,\" +\n                      infoBgColor +\n                      \" 0%,\" +\n                      infoBgColor +\n                      \" \" +\n                      percent +\n                      \"%,\" +\n                      originalBgColor +\n                      (percent + 1) +\n                      \"%,\" +\n                      originalBgColor +\n                      \" 100%) \"\n                  );\n                }\n              },\n              false\n            );\n          }\n          return xhrObject;\n        }\n      })\n        .done(function wFileUploadDone(data) {\n          var dataFile = data.data.file;\n          var event = { prevent: false };\n          var fileValue = {\n            value: dataFile.reference,\n            size: dataFile.size,\n            fileName: dataFile.fileName,\n            displayValue: dataFile.fileName,\n            creationDate: dataFile.cdate,\n            thumbnail: dataFile.thumbnailUrl,\n            url: dataFile.downloadUrl,\n            icon: dataFile.iconUrl\n          };\n\n          currentWidget.uploadingFiles--;\n\n          currentWidget.setValue(fileValue);\n          currentWidget._trigger(\"uploadfiledone\", event, {\n            $el: currentWidget.element,\n            index: currentWidget._getIndex(),\n            file: fileValue\n          });\n        })\n        .fail(function wFileUploadFail(data) {\n          currentWidget.uploadingFiles--;\n          currentWidget._trigger(\"uploadfiledone\", event, {\n            $el: currentWidget.element,\n            index: currentWidget._getIndex(),\n            file: null\n          });\n          inputText.css(\n            \"background-image\",\n            \"url(\" + currentWidget.options.attributeValue.icon + \")\"\n          );\n          var result = JSON.parse(data.responseText);\n          if (result) {\n            _.each(result.messages, function wFileErrorMessages(errorMessage) {\n              $(\"body\").trigger(\"notification\", {\n                htmlMessage: errorMessage.contentHtml,\n                message: errorMessage.contentText,\n\n                type: errorMessage.type\n              });\n            });\n          } else {\n            inputText.css(\"background\", \"\");\n            $(\"body\").trigger(\"notification\", {\n              htmlMessage:\n                \"File <b>\" + firstFile.name + \"</b> cannot be uploaded\",\n              message: event.statusText,\n              type: \"error\"\n            });\n          }\n        })\n        .always(function wFileUploadEnd() {\n          $inputFile.prop(\"disabled\", false);\n          inputText.val(originalText);\n          inputText.css(\"background\", \"\");\n          inputText.removeClass(\n            \"progress-bar active progress-bar-striped dcpAttribute__value--transferring dcpAttribute__value--recording\"\n          );\n        });\n    },\n\n    /**\n     * Modify value to widget and send notification to the view\n     * @param value\n     */\n    setValue: function wFileSetValue(value) {\n      var $inputFile = this.element.find(\"input[type=file]\");\n      // call wAttribute:::setValue() :send notification\n      this._super(value);\n\n      if (this.getMode() === \"write\" && this.uploadingFiles === 0) {\n        this.redraw();\n      }\n\n      $inputFile.attr(\"fileValue\", value ? value.value : null);\n    },\n\n    /**\n     * Return the url of common link\n     * @returns {*}\n     */\n    getLink: function wFileGetLink() {\n      var link = this._super();\n      if (this.options.attributeValue.url && (!link || !link.url)) {\n        link.url = this.options.attributeValue.url;\n      }\n\n      return link;\n    },\n\n    getType: function wFileGetType() {\n      return \"file\";\n    }\n  });\n\n  return $.fn.dcpFile;\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWYyNTMwNmZkNjAxODljMTIwZjguanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvQXBwcy9ET0NVTUVOVC9JSE0vd2lkZ2V0cy9hdHRyaWJ1dGVzL2ZpbGUvd0ZpbGUuanM/ZDZjZCJdLCJzb3VyY2VzQ29udGVudCI6WyIvKmdsb2JhbCBkZWZpbmUqL1xuKGZ1bmN0aW9uIHVtZFJlcXVpcmUocm9vdCwgZmFjdG9yeSkge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICBpZiAodHlwZW9mIGRlZmluZSA9PT0gXCJmdW5jdGlvblwiICYmIGRlZmluZS5hbWQpIHtcbiAgICBkZWZpbmUoW1xuICAgICAgXCJqcXVlcnlcIixcbiAgICAgIFwidW5kZXJzY29yZVwiLFxuICAgICAgXCJkY3BEb2N1bWVudC93aWRnZXRzL2F0dHJpYnV0ZXMvdGV4dC93VGV4dFwiXG4gICAgXSwgZmFjdG9yeSk7XG4gIH0gZWxzZSB7XG4gICAgLy9ub2luc3BlY3Rpb24gSlNVbnJlc29sdmVkVmFyaWFibGVcbiAgICBmYWN0b3J5KHdpbmRvdy5qUXVlcnksIHdpbmRvdy5fKTtcbiAgfVxufSkod2luZG93LCBmdW5jdGlvbiB3RmlsZVdpZGdldCgkLCBfKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIC8vbm9pbnNwZWN0aW9uIEpTVW51c2VkTG9jYWxTeW1ib2xzXG4gICQud2lkZ2V0KFwiZGNwLmRjcEZpbGVcIiwgJC5kY3AuZGNwVGV4dCwge1xuICAgIHVwbG9hZGluZ0ZpbGVzOiAwLCAvLyBmaWxlIHVwbG9hZCBpbiBwcm9ncmVzc1xuICAgIG9wdGlvbnM6IHtcbiAgICAgIHR5cGU6IFwiZmlsZVwiLFxuICAgICAgcmVuZGVyT3B0aW9uczoge1xuICAgICAgICBjb250ZW50RGlzcG9zaXRpb246IGZhbHNlLFxuICAgICAgICBodG1sTGluazoge30sXG4gICAgICAgIHBsYWNlSG9sZGVyOiBcIkNsaWNrIHRvIHVwbG9hZCBmaWxlXCJcbiAgICAgIH0sXG4gICAgICBsYWJlbHM6IHtcbiAgICAgICAgZHJvcEZpbGVIZXJlOiBcIkRyb3AgZmlsZSBoZXJlXCIsXG4gICAgICAgIHRvb2x0aXBMYWJlbDogXCJDaG9vc2UgZmlsZVwiLFxuICAgICAgICBkb3dubG9hZExhYmVsOiBcIkRvd25sb2FkIGZpbGVcIixcbiAgICAgICAgcmVjb3JkaW5nOiBcIlJlY29yZGluZ1wiLFxuICAgICAgICB0cmFuc2ZlcnJpbmc6IFwiVHJhbnNmZXJyaW5nXCIsXG4gICAgICAgIGtpbG9CeXRlOiBcImtCXCIsXG4gICAgICAgIGJ5dGU6IFwiQlwiXG4gICAgICB9XG4gICAgfSxcblxuICAgIF9pbml0RG9tOiBmdW5jdGlvbiB3RmlsZUluaXREb20oKSB7XG4gICAgICB2YXIgdmlzaWJsZUlucHV0O1xuICAgICAgaWYgKHRoaXMuZ2V0TW9kZSgpID09PSBcInJlYWRcIikge1xuICAgICAgICB2YXIgdXJsU2VwID0gXCI/XCI7XG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMuYXR0cmlidXRlVmFsdWUudXJsKSB7XG4gICAgICAgICAgaWYgKCF0aGlzLm9wdGlvbnMucmVuZGVyT3B0aW9ucy5odG1sTGluay51cmwpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMuYXR0cmlidXRlVmFsdWUudXJsKSB7XG4gICAgICAgICAgICAgIHVybFNlcCA9XG4gICAgICAgICAgICAgICAgdGhpcy5vcHRpb25zLmF0dHJpYnV0ZVZhbHVlLnVybC5pbmRleE9mKFwiP1wiKSA+PSAwID8gXCImXCIgOiBcIj9cIjtcbiAgICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5yZW5kZXJPcHRpb25zLmNvbnRlbnREaXNwb3NpdGlvbiA9PT0gXCJpbmxpbmVcIikge1xuICAgICAgICAgICAgICAgIHRoaXMub3B0aW9ucy5hdHRyaWJ1dGVWYWx1ZS51cmwgPSB0aGlzLm9wdGlvbnMuYXR0cmlidXRlVmFsdWUudXJsLnJlcGxhY2UoXG4gICAgICAgICAgICAgICAgICBcIiZpbmxpbmU9bm9cIixcbiAgICAgICAgICAgICAgICAgIFwiXCJcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIHRoaXMub3B0aW9ucy5hdHRyaWJ1dGVWYWx1ZS51cmwgKz0gdXJsU2VwICsgXCJpbmxpbmU9eWVzXCI7XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5vcHRpb25zLmF0dHJpYnV0ZVZhbHVlLnVybCA9IHRoaXMub3B0aW9ucy5hdHRyaWJ1dGVWYWx1ZS51cmwucmVwbGFjZShcbiAgICAgICAgICAgICAgICAgIFwiJmlubGluZT15ZXNcIixcbiAgICAgICAgICAgICAgICAgIFwiXCJcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIHRoaXMub3B0aW9ucy5hdHRyaWJ1dGVWYWx1ZS51cmwgKz0gdXJsU2VwICsgXCJpbmxpbmU9bm9cIjtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5vcHRpb25zLnJlbmRlck9wdGlvbnMuaHRtbExpbmsudXJsID0gdGhpcy5vcHRpb25zLmF0dHJpYnV0ZVZhbHVlLnVybDtcblxuICAgICAgICAgICAgaWYgKCF0aGlzLm9wdGlvbnMucmVuZGVyT3B0aW9ucy5odG1sTGluay50aXRsZSkge1xuICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMucmVuZGVyT3B0aW9ucy5odG1sTGluay50aXRsZSA9IHRoaXMub3B0aW9ucy5hdHRyaWJ1dGVWYWx1ZS5kaXNwbGF5VmFsdWU7XG4gICAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMuYXR0cmlidXRlVmFsdWUuc2l6ZSA+PSAxMDI0KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5vcHRpb25zLnJlbmRlck9wdGlvbnMuaHRtbExpbmsudGl0bGUgKz1cbiAgICAgICAgICAgICAgICAgIFwiPGJyLz4oXCIgK1xuICAgICAgICAgICAgICAgICAgTWF0aC5yb3VuZCh0aGlzLm9wdGlvbnMuYXR0cmlidXRlVmFsdWUuc2l6ZSAvIDEwMjQpICtcbiAgICAgICAgICAgICAgICAgIFwiIFwiICtcbiAgICAgICAgICAgICAgICAgIHRoaXMub3B0aW9ucy5sYWJlbHMua2lsb0J5dGUgK1xuICAgICAgICAgICAgICAgICAgXCIpXCI7XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5vcHRpb25zLnJlbmRlck9wdGlvbnMuaHRtbExpbmsudGl0bGUgKz1cbiAgICAgICAgICAgICAgICAgIFwiPGJyLz4oXCIgK1xuICAgICAgICAgICAgICAgICAgdGhpcy5vcHRpb25zLmF0dHJpYnV0ZVZhbHVlLnNpemUgK1xuICAgICAgICAgICAgICAgICAgXCIgXCIgK1xuICAgICAgICAgICAgICAgICAgdGhpcy5vcHRpb25zLmxhYmVscy5ieXRlICtcbiAgICAgICAgICAgICAgICAgIFwiKVwiO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5vcHRpb25zLnJlbmRlck9wdGlvbnMubWltZUljb25TaXplKSB7XG4gICAgICAgIGlmIChcbiAgICAgICAgICBbXCIwXCIsIFwiMHgwXCIsIFwieDBcIl0uaW5kZXhPZihcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucy5yZW5kZXJPcHRpb25zLm1pbWVJY29uU2l6ZVxuICAgICAgICAgICkgIT09IC0xXG4gICAgICAgICkge1xuICAgICAgICAgIHRoaXMub3B0aW9ucy5hdHRyaWJ1dGVWYWx1ZS5pY29uID0gbnVsbDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB2YXIgcmVTaXplID0gL3NpemVzXFwvKFteL10rKS87XG4gICAgICAgICAgdGhpcy5vcHRpb25zLmF0dHJpYnV0ZVZhbHVlLmljb24gPSB0aGlzLm9wdGlvbnMuYXR0cmlidXRlVmFsdWUuaWNvbi5yZXBsYWNlKFxuICAgICAgICAgICAgcmVTaXplLFxuICAgICAgICAgICAgXCJzaXplcy9cIiArIHRoaXMub3B0aW9ucy5yZW5kZXJPcHRpb25zLm1pbWVJY29uU2l6ZVxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHRoaXMuX3N1cGVyKCk7XG4gICAgICBpZiAodGhpcy5nZXRNb2RlKCkgPT09IFwid3JpdGVcIikge1xuICAgICAgICB2aXNpYmxlSW5wdXQgPSB0aGlzLmVsZW1lbnQuZmluZChcImlucHV0W3R5cGU9dGV4dF1cIik7XG4gICAgICAgIHZpc2libGVJbnB1dC5hdHRyKFwidGl0bGVcIiwgdGhpcy5vcHRpb25zLmxhYmVscy50b29sdGlwTGFiZWwpO1xuICAgICAgICB2aXNpYmxlSW5wdXQuYXR0cihcbiAgICAgICAgICBcInBsYWNlaG9sZGVyXCIsXG4gICAgICAgICAgdGhpcy5vcHRpb25zLnJlbmRlck9wdGlvbnMucGxhY2VIb2xkZXJcbiAgICAgICAgKTtcbiAgICAgICAgdGhpcy5lbGVtZW50XG4gICAgICAgICAgLmZpbmQoXCIuZGNwQXR0cmlidXRlX19jb250ZW50X19idXR0b24tLWZpbGVcIilcbiAgICAgICAgICAuYXR0cihcInRpdGxlXCIsIHRoaXMub3B0aW9ucy5sYWJlbHMuZG93bmxvYWRMYWJlbCk7XG5cbiAgICAgICAgdmlzaWJsZUlucHV0LnRvb2x0aXAoe1xuICAgICAgICAgIHRyaWdnZXI6IFwiaG92ZXJcIixcbiAgICAgICAgICBwbGFjZW1lbnQ6IFwiYm90dG9tXCIsXG4gICAgICAgICAgY29udGFpbmVyOiBcIi5kY3BEb2N1bWVudFwiXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmVsZW1lbnRcbiAgICAgICAgICAuZmluZChcImlucHV0W3R5cGU9ZmlsZV1cIilcbiAgICAgICAgICAuYXR0cihcImZpbGVWYWx1ZVwiLCB0aGlzLm9wdGlvbnMuYXR0cmlidXRlVmFsdWUudmFsdWUgfHwgbnVsbCk7XG4gICAgICB9XG4gICAgfSxcblxuICAgIF9pbml0RXZlbnQ6IGZ1bmN0aW9uIHdGaWxlSW5pdEV2ZW50KCkge1xuICAgICAgdmFyIGN1cnJlbnRXaWRnZXQgPSB0aGlzO1xuICAgICAgaWYgKHRoaXMuZ2V0TW9kZSgpID09PSBcIndyaXRlXCIpIHtcbiAgICAgICAgdGhpcy5faW5pdFVwbG9hZEV2ZW50KCk7XG4gICAgICB9XG5cbiAgICAgIC8vIEFkZCB0cmlnZ2VyIHdoZW4gdHJ5IHRvIGRvd25sb2FkIGZpbGVcbiAgICAgIHRoaXMuZWxlbWVudC5vbihcbiAgICAgICAgXCJjbGljay5cIiArIHRoaXMuZXZlbnROYW1lc3BhY2UsXG4gICAgICAgIFwiLmRjcEF0dHJpYnV0ZV9fY29udGVudF9fbGlua1wiLFxuICAgICAgICBmdW5jdGlvbiB3RmlsZUNsaWNrRG93bmxvYWQoZXZlbnQpIHtcbiAgICAgICAgICBjdXJyZW50V2lkZ2V0Ll90cmlnZ2VyKFwiZG93bmxvYWRGaWxlXCIsIGV2ZW50LCB7XG4gICAgICAgICAgICAkZWw6IGN1cnJlbnRXaWRnZXQuZWxlbWVudCxcbiAgICAgICAgICAgIGluZGV4OiBjdXJyZW50V2lkZ2V0Ll9nZXRJbmRleCgpXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICk7XG5cbiAgICAgIHRoaXMuX3N1cGVyKCk7XG4gICAgfSxcblxuICAgIF9pbml0Q2hhbmdlRXZlbnQ6IGZ1bmN0aW9uIHdGaWxlSW5pdENoYW5nZUV2ZW50KCkge1xuICAgICAgLy8gc2V0IGJ5IHdpZGdldCBpZiBubyBhdXRvY29tcGxldGVcbiAgICAgIGlmICh0aGlzLm9wdGlvbnMuaGFzQXV0b2NvbXBsZXRlKSB7XG4gICAgICAgIHRoaXMuX3N1cGVyKCk7XG4gICAgICB9XG4gICAgfSxcblxuICAgIF9pbml0VXBsb2FkRXZlbnQ6IGZ1bmN0aW9uIHdGaWxlSW5pdFVwbG9hZEV2ZW50KCkge1xuICAgICAgdmFyIGN1cnJlbnRXaWRnZXQgPSB0aGlzO1xuICAgICAgdmFyIGlucHV0RmlsZSA9IHRoaXMuZWxlbWVudC5maW5kKFwiaW5wdXRbdHlwZT1maWxlXVwiKTtcbiAgICAgIHZhciBpbnB1dFRleHQgPSB0aGlzLmVsZW1lbnQuZmluZChcIi5kY3BBdHRyaWJ1dGVfX3ZhbHVlXCIpO1xuICAgICAgdmFyIGZpbGVVcmwgPSB0aGlzLm9wdGlvbnMuYXR0cmlidXRlVmFsdWUudXJsO1xuXG4gICAgICBpZiAoZmlsZVVybCkge1xuICAgICAgICB0aGlzLmVsZW1lbnQub24oXG4gICAgICAgICAgXCJjbGlja1wiICsgdGhpcy5ldmVudE5hbWVzcGFjZSxcbiAgICAgICAgICBcIi5kY3BBdHRyaWJ1dGVfX2NvbnRlbnRfX2J1dHRvbi0tZmlsZVwiLFxuICAgICAgICAgIGZ1bmN0aW9uIHdGaWxlT25CdXR0b25DbGlja3IoZXZlbnQpIHtcbiAgICAgICAgICAgIHZhciBpc05vdFByZXZlbnRlZCA9IGN1cnJlbnRXaWRnZXQuX3RyaWdnZXIoXCJkb3dubG9hZEZpbGVcIiwgZXZlbnQsIHtcbiAgICAgICAgICAgICAgJGVsOiBjdXJyZW50V2lkZ2V0LmVsZW1lbnQsXG4gICAgICAgICAgICAgIGluZGV4OiBjdXJyZW50V2lkZ2V0Ll9nZXRJbmRleCgpXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGlmIChpc05vdFByZXZlbnRlZCkge1xuICAgICAgICAgICAgICB2YXIgdXJsID0gZmlsZVVybCxcbiAgICAgICAgICAgICAgICAkYmFzZSA9ICQoXCJiYXNlXCIpO1xuXG4gICAgICAgICAgICAgIGlmIChpc05vdFByZXZlbnRlZCkge1xuICAgICAgICAgICAgICAgIGlmICgkYmFzZS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAvLyBGb3IgSUUgOiBOb3QgaG9ub3IgYmFzZSBocmVmIGluIHRoaXMgY2FzZVxuICAgICAgICAgICAgICAgICAgdXJsID0gJGJhc2UuYXR0cihcImhyZWZcIikgKyB1cmw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHdpbmRvdy5vcGVuKHVybCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmVsZW1lbnRcbiAgICAgICAgICAuZmluZChcIi5kY3BBdHRyaWJ1dGVfX2NvbnRlbnRfX2J1dHRvbi0tZmlsZVwiKVxuICAgICAgICAgIC5hdHRyKFwiZGlzYWJsZWRcIiwgXCJkaXNhYmxlZFwiKTtcbiAgICAgIH1cblxuICAgICAgaWYgKCFfLmlzVW5kZWZpbmVkKHdpbmRvdy5Gb3JtRGF0YSkpIHtcbiAgICAgICAgdGhpcy5lbGVtZW50Lm9uKFxuICAgICAgICAgIFwiZHJhZ2VudGVyXCIgKyB0aGlzLmV2ZW50TmFtZXNwYWNlLFxuICAgICAgICAgIFwiLmRjcEF0dHJpYnV0ZV9fZHJhZ1RhcmdldFwiLFxuICAgICAgICAgIGZ1bmN0aW9uIHdGaWxlT25EcmFnRW50ZXIoZXZlbnQpIHtcbiAgICAgICAgICAgIGlucHV0VGV4dC52YWwoY3VycmVudFdpZGdldC5vcHRpb25zLmF0dHJpYnV0ZVZhbHVlLmRpc3BsYXlWYWx1ZSk7XG4gICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgfVxuICAgICAgICApO1xuICAgICAgICB0aGlzLmVsZW1lbnQub24oXG4gICAgICAgICAgXCJkcmFnb3ZlclwiICsgdGhpcy5ldmVudE5hbWVzcGFjZSxcbiAgICAgICAgICBcIi5kY3BBdHRyaWJ1dGVfX2RyYWdUYXJnZXRcIixcbiAgICAgICAgICBmdW5jdGlvbiB3RmlsZU9uRHJhZ092ZXIoZXZlbnQpIHtcbiAgICAgICAgICAgIGlucHV0VGV4dC52YWwoY3VycmVudFdpZGdldC5vcHRpb25zLmxhYmVscy5kcm9wRmlsZUhlcmUpO1xuICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgY3VycmVudFdpZGdldC5lbGVtZW50LmFkZENsYXNzKFwiZGNwQXR0cmlidXRlX192YWx1ZS0tZHJvcHpvbmVcIik7XG4gICAgICAgICAgfVxuICAgICAgICApO1xuICAgICAgICB0aGlzLmVsZW1lbnQub24oXG4gICAgICAgICAgXCJkcmFnbGVhdmVcIiArIHRoaXMuZXZlbnROYW1lc3BhY2UsXG4gICAgICAgICAgXCIuZGNwQXR0cmlidXRlX19kcmFnVGFyZ2V0XCIsXG4gICAgICAgICAgZnVuY3Rpb24gd0ZpbGVPbkxlYXZlKGV2ZW50KSB7XG4gICAgICAgICAgICBpbnB1dFRleHQudmFsKGN1cnJlbnRXaWRnZXQub3B0aW9ucy5hdHRyaWJ1dGVWYWx1ZS5kaXNwbGF5VmFsdWUpO1xuICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgY3VycmVudFdpZGdldC5lbGVtZW50LnJlbW92ZUNsYXNzKFwiZGNwQXR0cmlidXRlX192YWx1ZS0tZHJvcHpvbmVcIik7XG4gICAgICAgICAgfVxuICAgICAgICApO1xuXG4gICAgICAgIHRoaXMuZWxlbWVudC5vbihcbiAgICAgICAgICBcImRyb3BcIiArIHRoaXMuZXZlbnROYW1lc3BhY2UsXG4gICAgICAgICAgXCIuZGNwQXR0cmlidXRlX19kcmFnVGFyZ2V0XCIsXG4gICAgICAgICAgZnVuY3Rpb24gd0ZpbGVPbkRyb3AoZXZlbnQpIHtcbiAgICAgICAgICAgIGlucHV0VGV4dC52YWwoY3VycmVudFdpZGdldC5vcHRpb25zLmF0dHJpYnV0ZVZhbHVlLmRpc3BsYXlWYWx1ZSk7XG4gICAgICAgICAgICBjdXJyZW50V2lkZ2V0LmVsZW1lbnQucmVtb3ZlQ2xhc3MoXCJkY3BBdHRyaWJ1dGVfX3ZhbHVlLS1kcm9wem9uZVwiKTtcbiAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICAgICAgdmFyIGR0ID0gZXZlbnQub3JpZ2luYWxFdmVudC5kYXRhVHJhbnNmZXI7XG4gICAgICAgICAgICB2YXIgZmlsZXMgPSBkdC5maWxlcztcbiAgICAgICAgICAgIGlmIChmaWxlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgIGN1cnJlbnRXaWRnZXQudXBsb2FkRmlsZShmaWxlc1swXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICApO1xuXG4gICAgICAgIHRoaXMuZWxlbWVudC5vbihcbiAgICAgICAgICBcImNsaWNrXCIgKyB0aGlzLmV2ZW50TmFtZXNwYWNlLFxuICAgICAgICAgIFwiLmRjcEF0dHJpYnV0ZV9fdmFsdWVcIixcbiAgICAgICAgICBmdW5jdGlvbiB3RmlsZU9uQ2xpY2soKSB7XG4gICAgICAgICAgICBpbnB1dEZpbGUudHJpZ2dlcihcImNsaWNrXCIpO1xuICAgICAgICAgIH1cbiAgICAgICAgKTtcblxuICAgICAgICB0aGlzLmVsZW1lbnQub24oXG4gICAgICAgICAgXCJrZXlkb3duXCIgKyB0aGlzLmV2ZW50TmFtZXNwYWNlLFxuICAgICAgICAgIFwiLmRjcEF0dHJpYnV0ZV9fdmFsdWVcIixcbiAgICAgICAgICBmdW5jdGlvbiB3RmlsZUZpbHRlcktleXMoZXZlbnQpIHtcbiAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgZXZlbnQua2V5Q29kZSAhPT0gOSAmJlxuICAgICAgICAgICAgICBldmVudC5rZXlDb2RlICE9PSAzMiAmJlxuICAgICAgICAgICAgICBldmVudC5rZXlDb2RlICE9PSAxM1xuICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICApO1xuICAgICAgICB0aGlzLmVsZW1lbnQub24oXG4gICAgICAgICAgXCJrZXl1cFwiICsgdGhpcy5ldmVudE5hbWVzcGFjZSxcbiAgICAgICAgICBcIi5kY3BBdHRyaWJ1dGVfX3ZhbHVlXCIsXG4gICAgICAgICAgZnVuY3Rpb24gd0ZpbGVTZWxlY3RLZXlzKGV2ZW50KSB7XG4gICAgICAgICAgICBpZiAoZXZlbnQua2V5Q29kZSAhPT0gOSkge1xuICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICBpZiAoZXZlbnQua2V5Q29kZSA9PT0gMzIgfHwgZXZlbnQua2V5Q29kZSA9PT0gMTMpIHtcbiAgICAgICAgICAgICAgICBpbnB1dEZpbGUudHJpZ2dlcihcImNsaWNrXCIpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICApO1xuXG4gICAgICAgIHRoaXMuZWxlbWVudC5vbihcbiAgICAgICAgICBcImNoYW5nZVwiICsgdGhpcy5ldmVudE5hbWVzcGFjZSxcbiAgICAgICAgICBcImlucHV0W3R5cGU9ZmlsZV1cIixcbiAgICAgICAgICBmdW5jdGlvbiB3RmlsZUNoYW5nZSgvKmV2ZW50Ki8pIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmZpbGVzICYmIHRoaXMuZmlsZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICBjdXJyZW50V2lkZ2V0LnVwbG9hZEZpbGUodGhpcy5maWxlc1swXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgYWxlcnQoXCJZb3VyIGJyb3dzZXIgbm90IHN1cHBvcnQgRm9ybURhdGFcIik7XG4gICAgICB9XG4gICAgfSxcblxuICAgIGdldFdpZGdldFZhbHVlOiBmdW5jdGlvbiB3RmlsZWdldFdpZGdldFZhbHVlKCkge1xuICAgICAgdmFyICRpbnB1dEZpbGUgPSB0aGlzLmVsZW1lbnQuZmluZChcImlucHV0W3R5cGU9ZmlsZV1cIik7XG4gICAgICByZXR1cm4gJGlucHV0RmlsZS5hdHRyKFwiZmlsZVZhbHVlXCIpIHx8IG51bGw7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIENvbmRpdGlvbiBiZWZvcmUgdXBsb2FkIGZpbGVcbiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn1cbiAgICAgKi9cbiAgICB1cGxvYWRDb25kaXRpb246IGZ1bmN0aW9uIHdGaWxlVXBsb2FkQ29uZGl0aW9uKCkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSxcblxuICAgIHVwbG9hZEZpbGVGb3JtOiBmdW5jdGlvbiB3RmlsZVVwbG9hZEZpbGVGb3JtKCkge1xuICAgICAgdmFyIGlucHV0VGV4dCA9IHRoaXMuZWxlbWVudC5maW5kKFwiLmRjcEF0dHJpYnV0ZV9fdmFsdWVcIik7XG5cbiAgICAgIHZhciBpbnB1dEZpbGUgPSB0aGlzLmVsZW1lbnQuZmluZChcImlucHV0W3R5cGU9ZmlsZV1cIik7XG4gICAgICB0aGlzLl9zZXRWaXNpYmlsaXR5U2F2aW5nTWVudShcImRpc2FibGVkXCIpO1xuXG4gICAgICBpbnB1dFRleHQuYWRkQ2xhc3MoXCJkY3BBdHRyaWJ1dGVfX3ZhbHVlLS10cmFuc2ZlcnJpbmdcIik7XG4gICAgICBpbnB1dFRleHQudmFsKFxuICAgICAgICB0aGlzLm9wdGlvbnMubGFiZWxzLnRyYW5zZmVycmluZyArXG4gICAgICAgICAgXCIgXCIgK1xuICAgICAgICAgIGlucHV0RmlsZVxuICAgICAgICAgICAgLnZhbCgpXG4gICAgICAgICAgICAuc3BsaXQoL1tcXFxcL10vKVxuICAgICAgICAgICAgLnBvcCgpXG4gICAgICApO1xuICAgICAgdGhpcy5lbGVtZW50LmZpbmQoXCJmb3JtXCIpLnN1Ym1pdCgpO1xuICAgIH0sXG5cbiAgICB1cGxvYWRGaWxlOiBmdW5jdGlvbiB3RmlsZVVwbG9hZEZpbGUoZmlyc3RGaWxlKSB7XG4gICAgICB2YXIgaW5wdXRUZXh0ID0gdGhpcy5lbGVtZW50LmZpbmQoXCIuZGNwQXR0cmlidXRlX192YWx1ZVwiKTtcbiAgICAgIHZhciBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpO1xuICAgICAgdmFyIG5ld0ZpbGVOYW1lID0gZmlyc3RGaWxlLm5hbWU7XG4gICAgICB2YXIgb3JpZ2luYWxUZXh0ID0gaW5wdXRUZXh0LnZhbCgpO1xuICAgICAgdmFyIG9yaWdpbmFsQmdDb2xvciA9IGlucHV0VGV4dC5jc3MoXCJiYWNrZ3JvdW5kLWNvbG9yXCIpO1xuICAgICAgdmFyIGN1cnJlbnRXaWRnZXQgPSB0aGlzO1xuICAgICAgdmFyIGV2ZW50ID0geyBwcmV2ZW50OiBmYWxzZSB9O1xuICAgICAgdmFyICRpbnB1dEZpbGUgPSB0aGlzLmVsZW1lbnQuZmluZChcImlucHV0W3R5cGU9ZmlsZV1cIik7XG5cbiAgICAgIGlmICghdGhpcy51cGxvYWRDb25kaXRpb24oZmlyc3RGaWxlKSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHZhciBpc05vdFByZXZlbnRlZCA9IGN1cnJlbnRXaWRnZXQuX3RyaWdnZXIoXCJ1cGxvYWRmaWxlXCIsIGV2ZW50LCB7XG4gICAgICAgICRlbDogY3VycmVudFdpZGdldC5lbGVtZW50LFxuICAgICAgICBpbmRleDogY3VycmVudFdpZGdldC5fZ2V0SW5kZXgoKSxcbiAgICAgICAgZmlsZTogZmlyc3RGaWxlXG4gICAgICB9KTtcbiAgICAgIGlmICghaXNOb3RQcmV2ZW50ZWQpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgLy9jdXJyZW50V2lkZ2V0LnNldFZhbHVlKGN1cnJlbnRGaWxlVmFsdWUpO1xuICAgICAgY3VycmVudFdpZGdldC51cGxvYWRpbmdGaWxlcysrO1xuICAgICAgZm9ybURhdGEuYXBwZW5kKFwiZGNwRmlsZVwiLCBmaXJzdEZpbGUpO1xuICAgICAgJGlucHV0RmlsZS5wcm9wKFwiZGlzYWJsZWRcIiwgdHJ1ZSk7XG5cbiAgICAgIGlucHV0VGV4dC5hZGRDbGFzcyhcImRjcEF0dHJpYnV0ZV9fdmFsdWUtLXRyYW5zZmVycmluZ1wiKTtcbiAgICAgIHZhciBpbmZvQmdDb2xvciA9IGlucHV0VGV4dC5jc3MoXCJiYWNrZ3JvdW5kLWNvbG9yXCIpO1xuICAgICAgJC5hamF4KHtcbiAgICAgICAgdHlwZTogXCJQT1NUXCIsXG4gICAgICAgIHVybDogXCJhcGkvdjIvdGVtcG9yYXJ5RmlsZXMvXCIsXG4gICAgICAgIHByb2Nlc3NEYXRhOiBmYWxzZSxcbiAgICAgICAgY29udGVudFR5cGU6IGZhbHNlLFxuICAgICAgICBjYWNoZTogZmFsc2UsXG4gICAgICAgIGRhdGE6IGZvcm1EYXRhLFxuXG4gICAgICAgIHhocjogZnVuY3Rpb24gd0ZpbGVYaHJBZGRQcm9ncmVzcygpIHtcbiAgICAgICAgICB2YXIgeGhyT2JqZWN0ID0gJC5hamF4U2V0dGluZ3MueGhyKCk7XG4gICAgICAgICAgaWYgKHhock9iamVjdC51cGxvYWQpIHtcbiAgICAgICAgICAgIHhock9iamVjdC51cGxvYWQuYWRkRXZlbnRMaXN0ZW5lcihcbiAgICAgICAgICAgICAgXCJwcm9ncmVzc1wiLFxuICAgICAgICAgICAgICBmdW5jdGlvbiB3RmlsZVByb2dyZXNzKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgdmFyIHBlcmNlbnQgPSAwO1xuICAgICAgICAgICAgICAgIHZhciBwb3NpdGlvbiA9IGV2ZW50LmxvYWRlZCB8fCBldmVudC5wb3NpdGlvbjtcbiAgICAgICAgICAgICAgICB2YXIgdG90YWwgPSBldmVudC50b3RhbDtcbiAgICAgICAgICAgICAgICBpZiAoZXZlbnQubGVuZ3RoQ29tcHV0YWJsZSkge1xuICAgICAgICAgICAgICAgICAgcGVyY2VudCA9IE1hdGguY2VpbCgocG9zaXRpb24gLyB0b3RhbCkgKiAxMDApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAocGVyY2VudCA+PSAxMDApIHtcbiAgICAgICAgICAgICAgICAgIGlucHV0VGV4dC52YWwoXG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnRXaWRnZXQub3B0aW9ucy5sYWJlbHMucmVjb3JkaW5nICsgXCIgXCIgKyBuZXdGaWxlTmFtZVxuICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgIGlucHV0VGV4dC5yZW1vdmVDbGFzcyhcImRjcEF0dHJpYnV0ZV9fdmFsdWUtLXRyYW5zZmVycmluZ1wiKTtcbiAgICAgICAgICAgICAgICAgIGlucHV0VGV4dC5hZGRDbGFzcyhcbiAgICAgICAgICAgICAgICAgICAgXCJkY3BBdHRyaWJ1dGVfX3ZhbHVlLS1yZWNvcmRpbmcgcHJvZ3Jlc3MtYmFyIGFjdGl2ZSBwcm9ncmVzcy1iYXItc3RyaXBlZFwiXG4gICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgICAgaW5wdXRUZXh0LmNzcyhcImJhY2tncm91bmRcIiwgXCJcIik7XG4gICAgICAgICAgICAgICAgICBpbnB1dFRleHQuY3NzKFwiYmFja2dyb3VuZC1pbWFnZVwiLCBcIlwiKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgaW5wdXRUZXh0LmFkZENsYXNzKFwiZGNwQXR0cmlidXRlX192YWx1ZS0tdHJhbnNmZXJyaW5nXCIpO1xuICAgICAgICAgICAgICAgICAgaW5wdXRUZXh0LnZhbChcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudFdpZGdldC5vcHRpb25zLmxhYmVscy50cmFuc2ZlcnJpbmcgK1xuICAgICAgICAgICAgICAgICAgICAgIFwiIFwiICtcbiAgICAgICAgICAgICAgICAgICAgICBuZXdGaWxlTmFtZVxuICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgIGlucHV0VGV4dC5jc3MoXCJiYWNrZ3JvdW5kLWNvbG9yXCIsIFwicmVkXCIpO1xuICAgICAgICAgICAgICAgICAgaW5wdXRUZXh0LmNzcyhcbiAgICAgICAgICAgICAgICAgICAgXCJiYWNrZ3JvdW5kXCIsXG4gICAgICAgICAgICAgICAgICAgIFwibGluZWFyLWdyYWRpZW50KHRvIHJpZ2h0LFwiICtcbiAgICAgICAgICAgICAgICAgICAgICBpbmZvQmdDb2xvciArXG4gICAgICAgICAgICAgICAgICAgICAgXCIgMCUsXCIgK1xuICAgICAgICAgICAgICAgICAgICAgIGluZm9CZ0NvbG9yICtcbiAgICAgICAgICAgICAgICAgICAgICBcIiBcIiArXG4gICAgICAgICAgICAgICAgICAgICAgcGVyY2VudCArXG4gICAgICAgICAgICAgICAgICAgICAgXCIlLFwiICtcbiAgICAgICAgICAgICAgICAgICAgICBvcmlnaW5hbEJnQ29sb3IgK1xuICAgICAgICAgICAgICAgICAgICAgIChwZXJjZW50ICsgMSkgK1xuICAgICAgICAgICAgICAgICAgICAgIFwiJSxcIiArXG4gICAgICAgICAgICAgICAgICAgICAgb3JpZ2luYWxCZ0NvbG9yICtcbiAgICAgICAgICAgICAgICAgICAgICBcIiAxMDAlKSBcIlxuICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIGZhbHNlXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4geGhyT2JqZWN0O1xuICAgICAgICB9XG4gICAgICB9KVxuICAgICAgICAuZG9uZShmdW5jdGlvbiB3RmlsZVVwbG9hZERvbmUoZGF0YSkge1xuICAgICAgICAgIHZhciBkYXRhRmlsZSA9IGRhdGEuZGF0YS5maWxlO1xuICAgICAgICAgIHZhciBldmVudCA9IHsgcHJldmVudDogZmFsc2UgfTtcbiAgICAgICAgICB2YXIgZmlsZVZhbHVlID0ge1xuICAgICAgICAgICAgdmFsdWU6IGRhdGFGaWxlLnJlZmVyZW5jZSxcbiAgICAgICAgICAgIHNpemU6IGRhdGFGaWxlLnNpemUsXG4gICAgICAgICAgICBmaWxlTmFtZTogZGF0YUZpbGUuZmlsZU5hbWUsXG4gICAgICAgICAgICBkaXNwbGF5VmFsdWU6IGRhdGFGaWxlLmZpbGVOYW1lLFxuICAgICAgICAgICAgY3JlYXRpb25EYXRlOiBkYXRhRmlsZS5jZGF0ZSxcbiAgICAgICAgICAgIHRodW1ibmFpbDogZGF0YUZpbGUudGh1bWJuYWlsVXJsLFxuICAgICAgICAgICAgdXJsOiBkYXRhRmlsZS5kb3dubG9hZFVybCxcbiAgICAgICAgICAgIGljb246IGRhdGFGaWxlLmljb25VcmxcbiAgICAgICAgICB9O1xuXG4gICAgICAgICAgY3VycmVudFdpZGdldC51cGxvYWRpbmdGaWxlcy0tO1xuXG4gICAgICAgICAgY3VycmVudFdpZGdldC5zZXRWYWx1ZShmaWxlVmFsdWUpO1xuICAgICAgICAgIGN1cnJlbnRXaWRnZXQuX3RyaWdnZXIoXCJ1cGxvYWRmaWxlZG9uZVwiLCBldmVudCwge1xuICAgICAgICAgICAgJGVsOiBjdXJyZW50V2lkZ2V0LmVsZW1lbnQsXG4gICAgICAgICAgICBpbmRleDogY3VycmVudFdpZGdldC5fZ2V0SW5kZXgoKSxcbiAgICAgICAgICAgIGZpbGU6IGZpbGVWYWx1ZVxuICAgICAgICAgIH0pO1xuICAgICAgICB9KVxuICAgICAgICAuZmFpbChmdW5jdGlvbiB3RmlsZVVwbG9hZEZhaWwoZGF0YSkge1xuICAgICAgICAgIGN1cnJlbnRXaWRnZXQudXBsb2FkaW5nRmlsZXMtLTtcbiAgICAgICAgICBjdXJyZW50V2lkZ2V0Ll90cmlnZ2VyKFwidXBsb2FkZmlsZWRvbmVcIiwgZXZlbnQsIHtcbiAgICAgICAgICAgICRlbDogY3VycmVudFdpZGdldC5lbGVtZW50LFxuICAgICAgICAgICAgaW5kZXg6IGN1cnJlbnRXaWRnZXQuX2dldEluZGV4KCksXG4gICAgICAgICAgICBmaWxlOiBudWxsXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgaW5wdXRUZXh0LmNzcyhcbiAgICAgICAgICAgIFwiYmFja2dyb3VuZC1pbWFnZVwiLFxuICAgICAgICAgICAgXCJ1cmwoXCIgKyBjdXJyZW50V2lkZ2V0Lm9wdGlvbnMuYXR0cmlidXRlVmFsdWUuaWNvbiArIFwiKVwiXG4gICAgICAgICAgKTtcbiAgICAgICAgICB2YXIgcmVzdWx0ID0gSlNPTi5wYXJzZShkYXRhLnJlc3BvbnNlVGV4dCk7XG4gICAgICAgICAgaWYgKHJlc3VsdCkge1xuICAgICAgICAgICAgXy5lYWNoKHJlc3VsdC5tZXNzYWdlcywgZnVuY3Rpb24gd0ZpbGVFcnJvck1lc3NhZ2VzKGVycm9yTWVzc2FnZSkge1xuICAgICAgICAgICAgICAkKFwiYm9keVwiKS50cmlnZ2VyKFwibm90aWZpY2F0aW9uXCIsIHtcbiAgICAgICAgICAgICAgICBodG1sTWVzc2FnZTogZXJyb3JNZXNzYWdlLmNvbnRlbnRIdG1sLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6IGVycm9yTWVzc2FnZS5jb250ZW50VGV4dCxcblxuICAgICAgICAgICAgICAgIHR5cGU6IGVycm9yTWVzc2FnZS50eXBlXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlucHV0VGV4dC5jc3MoXCJiYWNrZ3JvdW5kXCIsIFwiXCIpO1xuICAgICAgICAgICAgJChcImJvZHlcIikudHJpZ2dlcihcIm5vdGlmaWNhdGlvblwiLCB7XG4gICAgICAgICAgICAgIGh0bWxNZXNzYWdlOlxuICAgICAgICAgICAgICAgIFwiRmlsZSA8Yj5cIiArIGZpcnN0RmlsZS5uYW1lICsgXCI8L2I+IGNhbm5vdCBiZSB1cGxvYWRlZFwiLFxuICAgICAgICAgICAgICBtZXNzYWdlOiBldmVudC5zdGF0dXNUZXh0LFxuICAgICAgICAgICAgICB0eXBlOiBcImVycm9yXCJcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgICAgLmFsd2F5cyhmdW5jdGlvbiB3RmlsZVVwbG9hZEVuZCgpIHtcbiAgICAgICAgICAkaW5wdXRGaWxlLnByb3AoXCJkaXNhYmxlZFwiLCBmYWxzZSk7XG4gICAgICAgICAgaW5wdXRUZXh0LnZhbChvcmlnaW5hbFRleHQpO1xuICAgICAgICAgIGlucHV0VGV4dC5jc3MoXCJiYWNrZ3JvdW5kXCIsIFwiXCIpO1xuICAgICAgICAgIGlucHV0VGV4dC5yZW1vdmVDbGFzcyhcbiAgICAgICAgICAgIFwicHJvZ3Jlc3MtYmFyIGFjdGl2ZSBwcm9ncmVzcy1iYXItc3RyaXBlZCBkY3BBdHRyaWJ1dGVfX3ZhbHVlLS10cmFuc2ZlcnJpbmcgZGNwQXR0cmlidXRlX192YWx1ZS0tcmVjb3JkaW5nXCJcbiAgICAgICAgICApO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogTW9kaWZ5IHZhbHVlIHRvIHdpZGdldCBhbmQgc2VuZCBub3RpZmljYXRpb24gdG8gdGhlIHZpZXdcbiAgICAgKiBAcGFyYW0gdmFsdWVcbiAgICAgKi9cbiAgICBzZXRWYWx1ZTogZnVuY3Rpb24gd0ZpbGVTZXRWYWx1ZSh2YWx1ZSkge1xuICAgICAgdmFyICRpbnB1dEZpbGUgPSB0aGlzLmVsZW1lbnQuZmluZChcImlucHV0W3R5cGU9ZmlsZV1cIik7XG4gICAgICAvLyBjYWxsIHdBdHRyaWJ1dGU6OjpzZXRWYWx1ZSgpIDpzZW5kIG5vdGlmaWNhdGlvblxuICAgICAgdGhpcy5fc3VwZXIodmFsdWUpO1xuXG4gICAgICBpZiAodGhpcy5nZXRNb2RlKCkgPT09IFwid3JpdGVcIiAmJiB0aGlzLnVwbG9hZGluZ0ZpbGVzID09PSAwKSB7XG4gICAgICAgIHRoaXMucmVkcmF3KCk7XG4gICAgICB9XG5cbiAgICAgICRpbnB1dEZpbGUuYXR0cihcImZpbGVWYWx1ZVwiLCB2YWx1ZSA/IHZhbHVlLnZhbHVlIDogbnVsbCk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIFJldHVybiB0aGUgdXJsIG9mIGNvbW1vbiBsaW5rXG4gICAgICogQHJldHVybnMgeyp9XG4gICAgICovXG4gICAgZ2V0TGluazogZnVuY3Rpb24gd0ZpbGVHZXRMaW5rKCkge1xuICAgICAgdmFyIGxpbmsgPSB0aGlzLl9zdXBlcigpO1xuICAgICAgaWYgKHRoaXMub3B0aW9ucy5hdHRyaWJ1dGVWYWx1ZS51cmwgJiYgKCFsaW5rIHx8ICFsaW5rLnVybCkpIHtcbiAgICAgICAgbGluay51cmwgPSB0aGlzLm9wdGlvbnMuYXR0cmlidXRlVmFsdWUudXJsO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gbGluaztcbiAgICB9LFxuXG4gICAgZ2V0VHlwZTogZnVuY3Rpb24gd0ZpbGVHZXRUeXBlKCkge1xuICAgICAgcmV0dXJuIFwiZmlsZVwiO1xuICAgIH1cbiAgfSk7XG5cbiAgcmV0dXJuICQuZm4uZGNwRmlsZTtcbn0pO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUNBLFdBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///af25306fd60189c120f8\n");

/***/ }),

/***/ "b25f06ae111b578af6b0":
/*!***********************************************!*\
  !*** ./node_modules/bootstrap/js/src/util.js ***!
  \***********************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ \"127c8cf59f228bb01a21\");\n/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);\n\n\n/**\n * --------------------------------------------------------------------------\n * Bootstrap (v4.1.3): util.js\n * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)\n * --------------------------------------------------------------------------\n */\n\nconst Util = (($) => {\n  /**\n   * ------------------------------------------------------------------------\n   * Private TransitionEnd Helpers\n   * ------------------------------------------------------------------------\n   */\n\n  const TRANSITION_END = 'transitionend'\n  const MAX_UID = 1000000\n  const MILLISECONDS_MULTIPLIER = 1000\n\n  // Shoutout AngusCroll (https://goo.gl/pxwQGp)\n  function toType(obj) {\n    return {}.toString.call(obj).match(/\\s([a-z]+)/i)[1].toLowerCase()\n  }\n\n  function getSpecialTransitionEndEvent() {\n    return {\n      bindType: TRANSITION_END,\n      delegateType: TRANSITION_END,\n      handle(event) {\n        if ($(event.target).is(this)) {\n          return event.handleObj.handler.apply(this, arguments) // eslint-disable-line prefer-rest-params\n        }\n        return undefined // eslint-disable-line no-undefined\n      }\n    }\n  }\n\n  function transitionEndEmulator(duration) {\n    let called = false\n\n    $(this).one(Util.TRANSITION_END, () => {\n      called = true\n    })\n\n    setTimeout(() => {\n      if (!called) {\n        Util.triggerTransitionEnd(this)\n      }\n    }, duration)\n\n    return this\n  }\n\n  function setTransitionEndSupport() {\n    $.fn.emulateTransitionEnd = transitionEndEmulator\n    $.event.special[Util.TRANSITION_END] = getSpecialTransitionEndEvent()\n  }\n\n  /**\n   * --------------------------------------------------------------------------\n   * Public Util Api\n   * --------------------------------------------------------------------------\n   */\n\n  const Util = {\n\n    TRANSITION_END: 'bsTransitionEnd',\n\n    getUID(prefix) {\n      do {\n        // eslint-disable-next-line no-bitwise\n        prefix += ~~(Math.random() * MAX_UID) // \"~~\" acts like a faster Math.floor() here\n      } while (document.getElementById(prefix))\n      return prefix\n    },\n\n    getSelectorFromElement(element) {\n      let selector = element.getAttribute('data-target')\n      if (!selector || selector === '#') {\n        selector = element.getAttribute('href') || ''\n      }\n\n      try {\n        return document.querySelector(selector) ? selector : null\n      } catch (err) {\n        return null\n      }\n    },\n\n    getTransitionDurationFromElement(element) {\n      if (!element) {\n        return 0\n      }\n\n      // Get transition-duration of the element\n      let transitionDuration = $(element).css('transition-duration')\n      const floatTransitionDuration = parseFloat(transitionDuration)\n\n      // Return 0 if element or transition duration is not found\n      if (!floatTransitionDuration) {\n        return 0\n      }\n\n      // If multiple durations are defined, take the first\n      transitionDuration = transitionDuration.split(',')[0]\n\n      return parseFloat(transitionDuration) * MILLISECONDS_MULTIPLIER\n    },\n\n    reflow(element) {\n      return element.offsetHeight\n    },\n\n    triggerTransitionEnd(element) {\n      $(element).trigger(TRANSITION_END)\n    },\n\n    // TODO: Remove in v5\n    supportsTransitionEnd() {\n      return Boolean(TRANSITION_END)\n    },\n\n    isElement(obj) {\n      return (obj[0] || obj).nodeType\n    },\n\n    typeCheckConfig(componentName, config, configTypes) {\n      for (const property in configTypes) {\n        if (Object.prototype.hasOwnProperty.call(configTypes, property)) {\n          const expectedTypes = configTypes[property]\n          const value         = config[property]\n          const valueType     = value && Util.isElement(value)\n            ? 'element' : toType(value)\n\n          if (!new RegExp(expectedTypes).test(valueType)) {\n            throw new Error(\n              `${componentName.toUpperCase()}: ` +\n              `Option \"${property}\" provided type \"${valueType}\" ` +\n              `but expected type \"${expectedTypes}\".`)\n          }\n        }\n      }\n    }\n  }\n\n  setTransitionEndSupport()\n\n  return Util\n})(jquery__WEBPACK_IMPORTED_MODULE_0___default.a)\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (Util);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYjI1ZjA2YWUxMTFiNTc4YWY2YjAuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvYm9vdHN0cmFwL2pzL3NyYy91dGlsLmpzPzNlYzUiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICQgZnJvbSAnanF1ZXJ5J1xuXG4vKipcbiAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gKiBCb290c3RyYXAgKHY0LjEuMyk6IHV0aWwuanNcbiAqIExpY2Vuc2VkIHVuZGVyIE1JVCAoaHR0cHM6Ly9naXRodWIuY29tL3R3YnMvYm9vdHN0cmFwL2Jsb2IvbWFzdGVyL0xJQ0VOU0UpXG4gKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICovXG5cbmNvbnN0IFV0aWwgPSAoKCQpID0+IHtcbiAgLyoqXG4gICAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgKiBQcml2YXRlIFRyYW5zaXRpb25FbmQgSGVscGVyc1xuICAgKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICovXG5cbiAgY29uc3QgVFJBTlNJVElPTl9FTkQgPSAndHJhbnNpdGlvbmVuZCdcbiAgY29uc3QgTUFYX1VJRCA9IDEwMDAwMDBcbiAgY29uc3QgTUlMTElTRUNPTkRTX01VTFRJUExJRVIgPSAxMDAwXG5cbiAgLy8gU2hvdXRvdXQgQW5ndXNDcm9sbCAoaHR0cHM6Ly9nb28uZ2wvcHh3UUdwKVxuICBmdW5jdGlvbiB0b1R5cGUob2JqKSB7XG4gICAgcmV0dXJuIHt9LnRvU3RyaW5nLmNhbGwob2JqKS5tYXRjaCgvXFxzKFthLXpdKykvaSlbMV0udG9Mb3dlckNhc2UoKVxuICB9XG5cbiAgZnVuY3Rpb24gZ2V0U3BlY2lhbFRyYW5zaXRpb25FbmRFdmVudCgpIHtcbiAgICByZXR1cm4ge1xuICAgICAgYmluZFR5cGU6IFRSQU5TSVRJT05fRU5ELFxuICAgICAgZGVsZWdhdGVUeXBlOiBUUkFOU0lUSU9OX0VORCxcbiAgICAgIGhhbmRsZShldmVudCkge1xuICAgICAgICBpZiAoJChldmVudC50YXJnZXQpLmlzKHRoaXMpKSB7XG4gICAgICAgICAgcmV0dXJuIGV2ZW50LmhhbmRsZU9iai5oYW5kbGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgLy8gZXNsaW50LWRpc2FibGUtbGluZSBwcmVmZXItcmVzdC1wYXJhbXNcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdW5kZWZpbmVkIC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tdW5kZWZpbmVkXG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gdHJhbnNpdGlvbkVuZEVtdWxhdG9yKGR1cmF0aW9uKSB7XG4gICAgbGV0IGNhbGxlZCA9IGZhbHNlXG5cbiAgICAkKHRoaXMpLm9uZShVdGlsLlRSQU5TSVRJT05fRU5ELCAoKSA9PiB7XG4gICAgICBjYWxsZWQgPSB0cnVlXG4gICAgfSlcblxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgaWYgKCFjYWxsZWQpIHtcbiAgICAgICAgVXRpbC50cmlnZ2VyVHJhbnNpdGlvbkVuZCh0aGlzKVxuICAgICAgfVxuICAgIH0sIGR1cmF0aW9uKVxuXG4gICAgcmV0dXJuIHRoaXNcbiAgfVxuXG4gIGZ1bmN0aW9uIHNldFRyYW5zaXRpb25FbmRTdXBwb3J0KCkge1xuICAgICQuZm4uZW11bGF0ZVRyYW5zaXRpb25FbmQgPSB0cmFuc2l0aW9uRW5kRW11bGF0b3JcbiAgICAkLmV2ZW50LnNwZWNpYWxbVXRpbC5UUkFOU0lUSU9OX0VORF0gPSBnZXRTcGVjaWFsVHJhbnNpdGlvbkVuZEV2ZW50KClcbiAgfVxuXG4gIC8qKlxuICAgKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgKiBQdWJsaWMgVXRpbCBBcGlcbiAgICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICovXG5cbiAgY29uc3QgVXRpbCA9IHtcblxuICAgIFRSQU5TSVRJT05fRU5EOiAnYnNUcmFuc2l0aW9uRW5kJyxcblxuICAgIGdldFVJRChwcmVmaXgpIHtcbiAgICAgIGRvIHtcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWJpdHdpc2VcbiAgICAgICAgcHJlZml4ICs9IH5+KE1hdGgucmFuZG9tKCkgKiBNQVhfVUlEKSAvLyBcIn5+XCIgYWN0cyBsaWtlIGEgZmFzdGVyIE1hdGguZmxvb3IoKSBoZXJlXG4gICAgICB9IHdoaWxlIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChwcmVmaXgpKVxuICAgICAgcmV0dXJuIHByZWZpeFxuICAgIH0sXG5cbiAgICBnZXRTZWxlY3RvckZyb21FbGVtZW50KGVsZW1lbnQpIHtcbiAgICAgIGxldCBzZWxlY3RvciA9IGVsZW1lbnQuZ2V0QXR0cmlidXRlKCdkYXRhLXRhcmdldCcpXG4gICAgICBpZiAoIXNlbGVjdG9yIHx8IHNlbGVjdG9yID09PSAnIycpIHtcbiAgICAgICAgc2VsZWN0b3IgPSBlbGVtZW50LmdldEF0dHJpYnV0ZSgnaHJlZicpIHx8ICcnXG4gICAgICB9XG5cbiAgICAgIHRyeSB7XG4gICAgICAgIHJldHVybiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHNlbGVjdG9yKSA/IHNlbGVjdG9yIDogbnVsbFxuICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIHJldHVybiBudWxsXG4gICAgICB9XG4gICAgfSxcblxuICAgIGdldFRyYW5zaXRpb25EdXJhdGlvbkZyb21FbGVtZW50KGVsZW1lbnQpIHtcbiAgICAgIGlmICghZWxlbWVudCkge1xuICAgICAgICByZXR1cm4gMFxuICAgICAgfVxuXG4gICAgICAvLyBHZXQgdHJhbnNpdGlvbi1kdXJhdGlvbiBvZiB0aGUgZWxlbWVudFxuICAgICAgbGV0IHRyYW5zaXRpb25EdXJhdGlvbiA9ICQoZWxlbWVudCkuY3NzKCd0cmFuc2l0aW9uLWR1cmF0aW9uJylcbiAgICAgIGNvbnN0IGZsb2F0VHJhbnNpdGlvbkR1cmF0aW9uID0gcGFyc2VGbG9hdCh0cmFuc2l0aW9uRHVyYXRpb24pXG5cbiAgICAgIC8vIFJldHVybiAwIGlmIGVsZW1lbnQgb3IgdHJhbnNpdGlvbiBkdXJhdGlvbiBpcyBub3QgZm91bmRcbiAgICAgIGlmICghZmxvYXRUcmFuc2l0aW9uRHVyYXRpb24pIHtcbiAgICAgICAgcmV0dXJuIDBcbiAgICAgIH1cblxuICAgICAgLy8gSWYgbXVsdGlwbGUgZHVyYXRpb25zIGFyZSBkZWZpbmVkLCB0YWtlIHRoZSBmaXJzdFxuICAgICAgdHJhbnNpdGlvbkR1cmF0aW9uID0gdHJhbnNpdGlvbkR1cmF0aW9uLnNwbGl0KCcsJylbMF1cblxuICAgICAgcmV0dXJuIHBhcnNlRmxvYXQodHJhbnNpdGlvbkR1cmF0aW9uKSAqIE1JTExJU0VDT05EU19NVUxUSVBMSUVSXG4gICAgfSxcblxuICAgIHJlZmxvdyhlbGVtZW50KSB7XG4gICAgICByZXR1cm4gZWxlbWVudC5vZmZzZXRIZWlnaHRcbiAgICB9LFxuXG4gICAgdHJpZ2dlclRyYW5zaXRpb25FbmQoZWxlbWVudCkge1xuICAgICAgJChlbGVtZW50KS50cmlnZ2VyKFRSQU5TSVRJT05fRU5EKVxuICAgIH0sXG5cbiAgICAvLyBUT0RPOiBSZW1vdmUgaW4gdjVcbiAgICBzdXBwb3J0c1RyYW5zaXRpb25FbmQoKSB7XG4gICAgICByZXR1cm4gQm9vbGVhbihUUkFOU0lUSU9OX0VORClcbiAgICB9LFxuXG4gICAgaXNFbGVtZW50KG9iaikge1xuICAgICAgcmV0dXJuIChvYmpbMF0gfHwgb2JqKS5ub2RlVHlwZVxuICAgIH0sXG5cbiAgICB0eXBlQ2hlY2tDb25maWcoY29tcG9uZW50TmFtZSwgY29uZmlnLCBjb25maWdUeXBlcykge1xuICAgICAgZm9yIChjb25zdCBwcm9wZXJ0eSBpbiBjb25maWdUeXBlcykge1xuICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGNvbmZpZ1R5cGVzLCBwcm9wZXJ0eSkpIHtcbiAgICAgICAgICBjb25zdCBleHBlY3RlZFR5cGVzID0gY29uZmlnVHlwZXNbcHJvcGVydHldXG4gICAgICAgICAgY29uc3QgdmFsdWUgICAgICAgICA9IGNvbmZpZ1twcm9wZXJ0eV1cbiAgICAgICAgICBjb25zdCB2YWx1ZVR5cGUgICAgID0gdmFsdWUgJiYgVXRpbC5pc0VsZW1lbnQodmFsdWUpXG4gICAgICAgICAgICA/ICdlbGVtZW50JyA6IHRvVHlwZSh2YWx1ZSlcblxuICAgICAgICAgIGlmICghbmV3IFJlZ0V4cChleHBlY3RlZFR5cGVzKS50ZXN0KHZhbHVlVHlwZSkpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAgICAgYCR7Y29tcG9uZW50TmFtZS50b1VwcGVyQ2FzZSgpfTogYCArXG4gICAgICAgICAgICAgIGBPcHRpb24gXCIke3Byb3BlcnR5fVwiIHByb3ZpZGVkIHR5cGUgXCIke3ZhbHVlVHlwZX1cIiBgICtcbiAgICAgICAgICAgICAgYGJ1dCBleHBlY3RlZCB0eXBlIFwiJHtleHBlY3RlZFR5cGVzfVwiLmApXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgc2V0VHJhbnNpdGlvbkVuZFN1cHBvcnQoKVxuXG4gIHJldHVybiBVdGlsXG59KSgkKVxuXG5leHBvcnQgZGVmYXVsdCBVdGlsXG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///b25f06ae111b578af6b0\n");

/***/ }),

/***/ "b3a839c4520ca8b4b597":
/*!*******************************************************************!*\
  !*** ./src/Apps/DOCUMENT/IHM/views/attributes/tab/vTabContent.js ***!
  \*******************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/*global define, console*/\n!(__WEBPACK_AMD_DEFINE_ARRAY__ = [\n  __webpack_require__(/*! jquery */ \"127c8cf59f228bb01a21\"),\n  __webpack_require__(/*! underscore */ \"8e08e542008e4aef1f58\"),\n  __webpack_require__(/*! backbone */ \"1858b45bf48591489d06\"),\n  __webpack_require__(/*! mustache */ \"bcd31d01884fc294fd69\"),\n  __webpack_require__(/*! dcpDocument/views/attributes/frame/vFrame */ \"7a4c946b6dd0337fa34b\"),\n  __webpack_require__(/*! dcpDocument/views/document/attributeTemplate */ \"593c8c94ba4399020f79\"),\n  __webpack_require__(/*! dcpDocument/i18n/documentCatalog */ \"278ba7757aa1904087c6\")\n], __WEBPACK_AMD_DEFINE_RESULT__ = (function vTabContent(\n  $,\n  _,\n  Backbone,\n  Mustache,\n  ViewAttributeFrame,\n  attributeTemplate,\n  i18n\n) {\n  \"use strict\";\n\n  return Backbone.View.extend({\n    tagName: \"div\",\n\n    className: \"dcpTab__content\",\n    customView: false,\n\n    initialize: function vTabContentInitialize(options) {\n      this.listenTo(this.model, \"change:label\", this.updateLabel);\n      this.listenTo(this.model.get(\"content\"), \"add\", this.render);\n      this.listenTo(this.model.get(\"content\"), \"remove\", this.render);\n      this.listenTo(this.model.get(\"content\"), \"reset\", this.render);\n      this.listenTo(this.model, \"cleanView\", this.remove);\n      this.listenTo(this.model, \"destroy\", this.remove);\n      this.listenTo(this.model, \"showTab\", this.renderContent);\n      this.listenTo(this.model, \"hide\", this.hide);\n      this.listenTo(this.model, \"show\", this.show);\n      this.listenTo(this.model, \"haveView\", this._identifyView);\n      this.initializeContent = options.initializeContent;\n      this.initializing = false;\n      this.options = options;\n    },\n\n    render: function vTabContentRender() {\n      var currentView = this;\n      return new Promise(\n        _.bind(function vTabContentRender_Promise(resolve, reject) {\n          try {\n            var hasOneContent;\n            currentView.$el\n              .empty()\n              .append(\n                $(\n                  '<div class=\"dcpTab__content--loading\"><span class=\"fa fa-spinner fa-spin\"></span>' +\n                    i18n.___(\"Displaying\", \"ddui\") +\n                    \"</div>\"\n                )\n              );\n            currentView.$el.attr(\"id\", currentView.model.id);\n            currentView.$el.attr(\"data-attrid\", currentView.model.id);\n\n            hasOneContent = currentView.model\n              .get(\"content\")\n              .some(function vTabContentIsDisplayable(value) {\n                return value.isDisplayable();\n              });\n\n            if (!hasOneContent) {\n              currentView.$el.append(\n                currentView.model.getOption(\"showEmptyContent\")\n              );\n              currentView.$el.removeClass(\"dcpTab__content--loading\");\n              currentView.model.trigger(\"renderDone\", {\n                model: currentView.model,\n                $el: currentView.$el\n              });\n              currentView.propageShowTab();\n              resolve(currentView);\n            } else {\n              if (currentView.initializeContent === true) {\n                currentView\n                  .renderContent()\n                  .then(function vTabContentRender_renderContent() {\n                    resolve(currentView);\n                  })\n                  .catch(reject);\n              } else {\n                resolve(currentView);\n              }\n            }\n          } catch (e) {\n            reject(e);\n          }\n        }, this)\n      );\n    },\n\n    renderContent: function vTabContentRenderContent(event) {\n      var currentView = this;\n      var pTabRenderPromise = new Promise(\n        _.bind(function vTabContentRenderContent_Promise(resolve, reject) {\n          var customRender,\n            $content = currentView.$el,\n            model = currentView.model,\n            promisesFrame = [];\n          if (currentView.initializing === false) {\n            currentView.initializing = true;\n            currentView.$el.empty();\n            if (currentView.originalView !== true) {\n              if (currentView.model.getOption(\"template\")) {\n                customRender = attributeTemplate.renderCustomView(\n                  currentView.model\n                );\n                currentView.customView = customRender.$el;\n                promisesFrame.push(customRender.promise);\n              }\n            }\n            if (currentView.customView) {\n              $content.append(currentView.customView);\n            } else {\n              currentView.model\n                .get(\"content\")\n                .each(function vTabContentRenderContent(currentAttr) {\n                  var view;\n                  try {\n                    if (!currentAttr.isDisplayable()) {\n                      return;\n                    }\n                    if (currentAttr.get(\"type\") === \"frame\") {\n                      view = new ViewAttributeFrame({ model: currentAttr });\n                      promisesFrame.push(view.render());\n                      $content.append(view.$el);\n                    } else {\n                      //noinspection ExceptionCaughtLocallyJS\n                      throw new Error(\n                        \"unkown type \" +\n                          currentAttr.get(\"type\") +\n                          \" for id \" +\n                          currentAttr.id +\n                          \" for tab \" +\n                          model.id\n                      );\n                    }\n                  } catch (e) {\n                    if (window.dcp.logger) {\n                      window.dcp.logger(e);\n                    } else {\n                      console.error(e);\n                    }\n                  }\n                });\n              attributeTemplate.insertDescription(this);\n              if (currentView.model.getOption(\"responsiveColumns\")) {\n                currentView.responsiveColumns();\n              }\n            }\n\n            Promise.all(promisesFrame)\n              .then(function tabAllFramesRenderDone() {\n                currentView.$el.removeClass(\"dcpTab__content--loading\");\n                currentView.model.trigger(\"renderDone\", {\n                  model: currentView.model,\n                  $el: currentView.$el\n                });\n\n                resolve();\n              })\n              .catch(reject);\n          } else {\n            resolve();\n          }\n          currentView.model.getDocumentModel().trigger(\"redrawErrorMessages\");\n          currentView.model.get(\"content\").propageEvent(\"resize\");\n        }, this)\n      );\n\n      pTabRenderPromise.then(function() {\n        if (currentView.model.isRealSelected) {\n          currentView.model.trigger(\n            \"attributeAfterTabSelect\",\n            event,\n            currentView.model.id\n          );\n          currentView.model.isRealSelected = false;\n        }\n      });\n\n      return pTabRenderPromise;\n    },\n\n    /**\n     * Add responsive column classes according to responsiveColumns render option\n     */\n    responsiveColumns: function vTab_responsiveColumns() {\n      var responseColumnsDefs = this.model.getOption(\"responsiveColumns\") || [];\n      var _this = this;\n      var $fake = $(\"<div/>\").css({\n        position: \"absolute\",\n        top: 0,\n        overflow: \"hidden\"\n      });\n      var $fakeWidth = $(\"<div/>\");\n      var setResponsiveClasse = function vTab_setResponsiveClasses() {\n        var fWidth = $(_this.$el).width();\n        var matchesResponsive = 0;\n\n        _.each(responseColumnsDefs, function vTab_setResponsiveClasses(\n          responseColumnsInfo\n        ) {\n          if (\n            fWidth >= responseColumnsInfo.minAbsWidth &&\n            fWidth < responseColumnsInfo.maxAbsWidth\n          ) {\n            _this.$el.addClass(\"dcp-column--\" + responseColumnsInfo.number);\n            matchesResponsive = responseColumnsInfo.number;\n            if (responseColumnsInfo.grow === true) {\n              _this.$el.addClass(\"dcp-column--grow\");\n            } else {\n              _this.$el.removeClass(\"dcp-column--grow\");\n            }\n          } else {\n            _this.$el.removeClass(\"dcp-column--\" + responseColumnsInfo.number);\n          }\n        });\n\n        if (matchesResponsive > 1) {\n          _this.$el.addClass(\"dcp-column\");\n        } else {\n          _this.$el.removeClass(\"dcp-column\");\n        }\n        if (matchesResponsive !== _this.frameIsResized) {\n          _this.frameIsResized = matchesResponsive;\n          // Send resize to frame in case they have also responsive.\n          _this.model.get(\"content\").propageEvent(\"resize\");\n        }\n      };\n\n      $(\"body\").append($fake.append($fakeWidth));\n\n      // Compute absolute width\n      _.each(responseColumnsDefs, function vTab_computeResponsiveWidth(\n        responseColumnsInfo\n      ) {\n        if (!responseColumnsInfo.minWidth) {\n          responseColumnsInfo.minAbsWidth = 0;\n        } else {\n          $fakeWidth.width(responseColumnsInfo.minWidth);\n          responseColumnsInfo.minAbsWidth = $fakeWidth.width();\n        }\n\n        if (!responseColumnsInfo.maxWidth) {\n          responseColumnsInfo.maxAbsWidth = Infinity;\n        } else {\n          $fakeWidth.width(responseColumnsInfo.maxWidth);\n          responseColumnsInfo.maxAbsWidth = $fakeWidth.width();\n        }\n      });\n\n      $fake.remove();\n      $(window).on(\"resize.v\" + this.model.cid, setResponsiveClasse);\n      _.defer(setResponsiveClasse);\n    },\n    propageShowTab: function vTabContentPropageShowTab() {\n      this.model.get(\"content\").propageEvent(\"showTab\");\n    },\n\n    updateLabel: function vTabContentUpdateLabel() {\n      this.$el.find(\".dcpFrame__label\").text(this.model.get(\"label\"));\n    },\n\n    hide: function vTabContentHide() {\n      this.$el.hide();\n    },\n\n    show: function vTabContentShow() {\n      this.$el.show();\n    },\n\n    _identifyView: function vAttribute_identifyView(event) {\n      event.haveView = true;\n      //Add the pointer to the current jquery element to a list passed by the event\n      event.elements = event.elements.add(this.$el);\n    },\n    remove: function vFrame_Remove() {\n      $(window).off(\".v\" + this.model.cid);\n\n      return Backbone.View.prototype.remove.call(this);\n    }\n  });\n}).apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYjNhODM5YzQ1MjBjYThiNGI1OTcuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvQXBwcy9ET0NVTUVOVC9JSE0vdmlld3MvYXR0cmlidXRlcy90YWIvdlRhYkNvbnRlbnQuanM/MGM2ZCJdLCJzb3VyY2VzQ29udGVudCI6WyIvKmdsb2JhbCBkZWZpbmUsIGNvbnNvbGUqL1xuZGVmaW5lKFtcbiAgXCJqcXVlcnlcIixcbiAgXCJ1bmRlcnNjb3JlXCIsXG4gIFwiYmFja2JvbmVcIixcbiAgXCJtdXN0YWNoZVwiLFxuICBcImRjcERvY3VtZW50L3ZpZXdzL2F0dHJpYnV0ZXMvZnJhbWUvdkZyYW1lXCIsXG4gIFwiZGNwRG9jdW1lbnQvdmlld3MvZG9jdW1lbnQvYXR0cmlidXRlVGVtcGxhdGVcIixcbiAgXCJkY3BEb2N1bWVudC9pMThuL2RvY3VtZW50Q2F0YWxvZ1wiXG5dLCBmdW5jdGlvbiB2VGFiQ29udGVudChcbiAgJCxcbiAgXyxcbiAgQmFja2JvbmUsXG4gIE11c3RhY2hlLFxuICBWaWV3QXR0cmlidXRlRnJhbWUsXG4gIGF0dHJpYnV0ZVRlbXBsYXRlLFxuICBpMThuXG4pIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgcmV0dXJuIEJhY2tib25lLlZpZXcuZXh0ZW5kKHtcbiAgICB0YWdOYW1lOiBcImRpdlwiLFxuXG4gICAgY2xhc3NOYW1lOiBcImRjcFRhYl9fY29udGVudFwiLFxuICAgIGN1c3RvbVZpZXc6IGZhbHNlLFxuXG4gICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gdlRhYkNvbnRlbnRJbml0aWFsaXplKG9wdGlvbnMpIHtcbiAgICAgIHRoaXMubGlzdGVuVG8odGhpcy5tb2RlbCwgXCJjaGFuZ2U6bGFiZWxcIiwgdGhpcy51cGRhdGVMYWJlbCk7XG4gICAgICB0aGlzLmxpc3RlblRvKHRoaXMubW9kZWwuZ2V0KFwiY29udGVudFwiKSwgXCJhZGRcIiwgdGhpcy5yZW5kZXIpO1xuICAgICAgdGhpcy5saXN0ZW5Ubyh0aGlzLm1vZGVsLmdldChcImNvbnRlbnRcIiksIFwicmVtb3ZlXCIsIHRoaXMucmVuZGVyKTtcbiAgICAgIHRoaXMubGlzdGVuVG8odGhpcy5tb2RlbC5nZXQoXCJjb250ZW50XCIpLCBcInJlc2V0XCIsIHRoaXMucmVuZGVyKTtcbiAgICAgIHRoaXMubGlzdGVuVG8odGhpcy5tb2RlbCwgXCJjbGVhblZpZXdcIiwgdGhpcy5yZW1vdmUpO1xuICAgICAgdGhpcy5saXN0ZW5Ubyh0aGlzLm1vZGVsLCBcImRlc3Ryb3lcIiwgdGhpcy5yZW1vdmUpO1xuICAgICAgdGhpcy5saXN0ZW5Ubyh0aGlzLm1vZGVsLCBcInNob3dUYWJcIiwgdGhpcy5yZW5kZXJDb250ZW50KTtcbiAgICAgIHRoaXMubGlzdGVuVG8odGhpcy5tb2RlbCwgXCJoaWRlXCIsIHRoaXMuaGlkZSk7XG4gICAgICB0aGlzLmxpc3RlblRvKHRoaXMubW9kZWwsIFwic2hvd1wiLCB0aGlzLnNob3cpO1xuICAgICAgdGhpcy5saXN0ZW5Ubyh0aGlzLm1vZGVsLCBcImhhdmVWaWV3XCIsIHRoaXMuX2lkZW50aWZ5Vmlldyk7XG4gICAgICB0aGlzLmluaXRpYWxpemVDb250ZW50ID0gb3B0aW9ucy5pbml0aWFsaXplQ29udGVudDtcbiAgICAgIHRoaXMuaW5pdGlhbGl6aW5nID0gZmFsc2U7XG4gICAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zO1xuICAgIH0sXG5cbiAgICByZW5kZXI6IGZ1bmN0aW9uIHZUYWJDb250ZW50UmVuZGVyKCkge1xuICAgICAgdmFyIGN1cnJlbnRWaWV3ID0gdGhpcztcbiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShcbiAgICAgICAgXy5iaW5kKGZ1bmN0aW9uIHZUYWJDb250ZW50UmVuZGVyX1Byb21pc2UocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHZhciBoYXNPbmVDb250ZW50O1xuICAgICAgICAgICAgY3VycmVudFZpZXcuJGVsXG4gICAgICAgICAgICAgIC5lbXB0eSgpXG4gICAgICAgICAgICAgIC5hcHBlbmQoXG4gICAgICAgICAgICAgICAgJChcbiAgICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwiZGNwVGFiX19jb250ZW50LS1sb2FkaW5nXCI+PHNwYW4gY2xhc3M9XCJmYSBmYS1zcGlubmVyIGZhLXNwaW5cIj48L3NwYW4+JyArXG4gICAgICAgICAgICAgICAgICAgIGkxOG4uX19fKFwiRGlzcGxheWluZ1wiLCBcImRkdWlcIikgK1xuICAgICAgICAgICAgICAgICAgICBcIjwvZGl2PlwiXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgY3VycmVudFZpZXcuJGVsLmF0dHIoXCJpZFwiLCBjdXJyZW50Vmlldy5tb2RlbC5pZCk7XG4gICAgICAgICAgICBjdXJyZW50Vmlldy4kZWwuYXR0cihcImRhdGEtYXR0cmlkXCIsIGN1cnJlbnRWaWV3Lm1vZGVsLmlkKTtcblxuICAgICAgICAgICAgaGFzT25lQ29udGVudCA9IGN1cnJlbnRWaWV3Lm1vZGVsXG4gICAgICAgICAgICAgIC5nZXQoXCJjb250ZW50XCIpXG4gICAgICAgICAgICAgIC5zb21lKGZ1bmN0aW9uIHZUYWJDb250ZW50SXNEaXNwbGF5YWJsZSh2YWx1ZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZS5pc0Rpc3BsYXlhYmxlKCk7XG4gICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpZiAoIWhhc09uZUNvbnRlbnQpIHtcbiAgICAgICAgICAgICAgY3VycmVudFZpZXcuJGVsLmFwcGVuZChcbiAgICAgICAgICAgICAgICBjdXJyZW50Vmlldy5tb2RlbC5nZXRPcHRpb24oXCJzaG93RW1wdHlDb250ZW50XCIpXG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgIGN1cnJlbnRWaWV3LiRlbC5yZW1vdmVDbGFzcyhcImRjcFRhYl9fY29udGVudC0tbG9hZGluZ1wiKTtcbiAgICAgICAgICAgICAgY3VycmVudFZpZXcubW9kZWwudHJpZ2dlcihcInJlbmRlckRvbmVcIiwge1xuICAgICAgICAgICAgICAgIG1vZGVsOiBjdXJyZW50Vmlldy5tb2RlbCxcbiAgICAgICAgICAgICAgICAkZWw6IGN1cnJlbnRWaWV3LiRlbFxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgY3VycmVudFZpZXcucHJvcGFnZVNob3dUYWIoKTtcbiAgICAgICAgICAgICAgcmVzb2x2ZShjdXJyZW50Vmlldyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBpZiAoY3VycmVudFZpZXcuaW5pdGlhbGl6ZUNvbnRlbnQgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICBjdXJyZW50Vmlld1xuICAgICAgICAgICAgICAgICAgLnJlbmRlckNvbnRlbnQoKVxuICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gdlRhYkNvbnRlbnRSZW5kZXJfcmVuZGVyQ29udGVudCgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShjdXJyZW50Vmlldyk7XG4gICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgLmNhdGNoKHJlamVjdCk7XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmVzb2x2ZShjdXJyZW50Vmlldyk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICByZWplY3QoZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9LCB0aGlzKVxuICAgICAgKTtcbiAgICB9LFxuXG4gICAgcmVuZGVyQ29udGVudDogZnVuY3Rpb24gdlRhYkNvbnRlbnRSZW5kZXJDb250ZW50KGV2ZW50KSB7XG4gICAgICB2YXIgY3VycmVudFZpZXcgPSB0aGlzO1xuICAgICAgdmFyIHBUYWJSZW5kZXJQcm9taXNlID0gbmV3IFByb21pc2UoXG4gICAgICAgIF8uYmluZChmdW5jdGlvbiB2VGFiQ29udGVudFJlbmRlckNvbnRlbnRfUHJvbWlzZShyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgICB2YXIgY3VzdG9tUmVuZGVyLFxuICAgICAgICAgICAgJGNvbnRlbnQgPSBjdXJyZW50Vmlldy4kZWwsXG4gICAgICAgICAgICBtb2RlbCA9IGN1cnJlbnRWaWV3Lm1vZGVsLFxuICAgICAgICAgICAgcHJvbWlzZXNGcmFtZSA9IFtdO1xuICAgICAgICAgIGlmIChjdXJyZW50Vmlldy5pbml0aWFsaXppbmcgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICBjdXJyZW50Vmlldy5pbml0aWFsaXppbmcgPSB0cnVlO1xuICAgICAgICAgICAgY3VycmVudFZpZXcuJGVsLmVtcHR5KCk7XG4gICAgICAgICAgICBpZiAoY3VycmVudFZpZXcub3JpZ2luYWxWaWV3ICE9PSB0cnVlKSB7XG4gICAgICAgICAgICAgIGlmIChjdXJyZW50Vmlldy5tb2RlbC5nZXRPcHRpb24oXCJ0ZW1wbGF0ZVwiKSkge1xuICAgICAgICAgICAgICAgIGN1c3RvbVJlbmRlciA9IGF0dHJpYnV0ZVRlbXBsYXRlLnJlbmRlckN1c3RvbVZpZXcoXG4gICAgICAgICAgICAgICAgICBjdXJyZW50Vmlldy5tb2RlbFxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgY3VycmVudFZpZXcuY3VzdG9tVmlldyA9IGN1c3RvbVJlbmRlci4kZWw7XG4gICAgICAgICAgICAgICAgcHJvbWlzZXNGcmFtZS5wdXNoKGN1c3RvbVJlbmRlci5wcm9taXNlKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGN1cnJlbnRWaWV3LmN1c3RvbVZpZXcpIHtcbiAgICAgICAgICAgICAgJGNvbnRlbnQuYXBwZW5kKGN1cnJlbnRWaWV3LmN1c3RvbVZpZXcpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgY3VycmVudFZpZXcubW9kZWxcbiAgICAgICAgICAgICAgICAuZ2V0KFwiY29udGVudFwiKVxuICAgICAgICAgICAgICAgIC5lYWNoKGZ1bmN0aW9uIHZUYWJDb250ZW50UmVuZGVyQ29udGVudChjdXJyZW50QXR0cikge1xuICAgICAgICAgICAgICAgICAgdmFyIHZpZXc7XG4gICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWN1cnJlbnRBdHRyLmlzRGlzcGxheWFibGUoKSkge1xuICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudEF0dHIuZ2V0KFwidHlwZVwiKSA9PT0gXCJmcmFtZVwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgdmlldyA9IG5ldyBWaWV3QXR0cmlidXRlRnJhbWUoeyBtb2RlbDogY3VycmVudEF0dHIgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgcHJvbWlzZXNGcmFtZS5wdXNoKHZpZXcucmVuZGVyKCkpO1xuICAgICAgICAgICAgICAgICAgICAgICRjb250ZW50LmFwcGVuZCh2aWV3LiRlbCk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgLy9ub2luc3BlY3Rpb24gRXhjZXB0aW9uQ2F1Z2h0TG9jYWxseUpTXG4gICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ1bmtvd24gdHlwZSBcIiArXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRBdHRyLmdldChcInR5cGVcIikgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICBcIiBmb3IgaWQgXCIgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50QXR0ci5pZCArXG4gICAgICAgICAgICAgICAgICAgICAgICAgIFwiIGZvciB0YWIgXCIgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RlbC5pZFxuICAgICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5kY3AubG9nZ2VyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgd2luZG93LmRjcC5sb2dnZXIoZSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICBhdHRyaWJ1dGVUZW1wbGF0ZS5pbnNlcnREZXNjcmlwdGlvbih0aGlzKTtcbiAgICAgICAgICAgICAgaWYgKGN1cnJlbnRWaWV3Lm1vZGVsLmdldE9wdGlvbihcInJlc3BvbnNpdmVDb2x1bW5zXCIpKSB7XG4gICAgICAgICAgICAgICAgY3VycmVudFZpZXcucmVzcG9uc2l2ZUNvbHVtbnMoKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBQcm9taXNlLmFsbChwcm9taXNlc0ZyYW1lKVxuICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiB0YWJBbGxGcmFtZXNSZW5kZXJEb25lKCkge1xuICAgICAgICAgICAgICAgIGN1cnJlbnRWaWV3LiRlbC5yZW1vdmVDbGFzcyhcImRjcFRhYl9fY29udGVudC0tbG9hZGluZ1wiKTtcbiAgICAgICAgICAgICAgICBjdXJyZW50Vmlldy5tb2RlbC50cmlnZ2VyKFwicmVuZGVyRG9uZVwiLCB7XG4gICAgICAgICAgICAgICAgICBtb2RlbDogY3VycmVudFZpZXcubW9kZWwsXG4gICAgICAgICAgICAgICAgICAkZWw6IGN1cnJlbnRWaWV3LiRlbFxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAuY2F0Y2gocmVqZWN0KTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjdXJyZW50Vmlldy5tb2RlbC5nZXREb2N1bWVudE1vZGVsKCkudHJpZ2dlcihcInJlZHJhd0Vycm9yTWVzc2FnZXNcIik7XG4gICAgICAgICAgY3VycmVudFZpZXcubW9kZWwuZ2V0KFwiY29udGVudFwiKS5wcm9wYWdlRXZlbnQoXCJyZXNpemVcIik7XG4gICAgICAgIH0sIHRoaXMpXG4gICAgICApO1xuXG4gICAgICBwVGFiUmVuZGVyUHJvbWlzZS50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAoY3VycmVudFZpZXcubW9kZWwuaXNSZWFsU2VsZWN0ZWQpIHtcbiAgICAgICAgICBjdXJyZW50Vmlldy5tb2RlbC50cmlnZ2VyKFxuICAgICAgICAgICAgXCJhdHRyaWJ1dGVBZnRlclRhYlNlbGVjdFwiLFxuICAgICAgICAgICAgZXZlbnQsXG4gICAgICAgICAgICBjdXJyZW50Vmlldy5tb2RlbC5pZFxuICAgICAgICAgICk7XG4gICAgICAgICAgY3VycmVudFZpZXcubW9kZWwuaXNSZWFsU2VsZWN0ZWQgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiBwVGFiUmVuZGVyUHJvbWlzZTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQWRkIHJlc3BvbnNpdmUgY29sdW1uIGNsYXNzZXMgYWNjb3JkaW5nIHRvIHJlc3BvbnNpdmVDb2x1bW5zIHJlbmRlciBvcHRpb25cbiAgICAgKi9cbiAgICByZXNwb25zaXZlQ29sdW1uczogZnVuY3Rpb24gdlRhYl9yZXNwb25zaXZlQ29sdW1ucygpIHtcbiAgICAgIHZhciByZXNwb25zZUNvbHVtbnNEZWZzID0gdGhpcy5tb2RlbC5nZXRPcHRpb24oXCJyZXNwb25zaXZlQ29sdW1uc1wiKSB8fCBbXTtcbiAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICB2YXIgJGZha2UgPSAkKFwiPGRpdi8+XCIpLmNzcyh7XG4gICAgICAgIHBvc2l0aW9uOiBcImFic29sdXRlXCIsXG4gICAgICAgIHRvcDogMCxcbiAgICAgICAgb3ZlcmZsb3c6IFwiaGlkZGVuXCJcbiAgICAgIH0pO1xuICAgICAgdmFyICRmYWtlV2lkdGggPSAkKFwiPGRpdi8+XCIpO1xuICAgICAgdmFyIHNldFJlc3BvbnNpdmVDbGFzc2UgPSBmdW5jdGlvbiB2VGFiX3NldFJlc3BvbnNpdmVDbGFzc2VzKCkge1xuICAgICAgICB2YXIgZldpZHRoID0gJChfdGhpcy4kZWwpLndpZHRoKCk7XG4gICAgICAgIHZhciBtYXRjaGVzUmVzcG9uc2l2ZSA9IDA7XG5cbiAgICAgICAgXy5lYWNoKHJlc3BvbnNlQ29sdW1uc0RlZnMsIGZ1bmN0aW9uIHZUYWJfc2V0UmVzcG9uc2l2ZUNsYXNzZXMoXG4gICAgICAgICAgcmVzcG9uc2VDb2x1bW5zSW5mb1xuICAgICAgICApIHtcbiAgICAgICAgICBpZiAoXG4gICAgICAgICAgICBmV2lkdGggPj0gcmVzcG9uc2VDb2x1bW5zSW5mby5taW5BYnNXaWR0aCAmJlxuICAgICAgICAgICAgZldpZHRoIDwgcmVzcG9uc2VDb2x1bW5zSW5mby5tYXhBYnNXaWR0aFxuICAgICAgICAgICkge1xuICAgICAgICAgICAgX3RoaXMuJGVsLmFkZENsYXNzKFwiZGNwLWNvbHVtbi0tXCIgKyByZXNwb25zZUNvbHVtbnNJbmZvLm51bWJlcik7XG4gICAgICAgICAgICBtYXRjaGVzUmVzcG9uc2l2ZSA9IHJlc3BvbnNlQ29sdW1uc0luZm8ubnVtYmVyO1xuICAgICAgICAgICAgaWYgKHJlc3BvbnNlQ29sdW1uc0luZm8uZ3JvdyA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICBfdGhpcy4kZWwuYWRkQ2xhc3MoXCJkY3AtY29sdW1uLS1ncm93XCIpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgX3RoaXMuJGVsLnJlbW92ZUNsYXNzKFwiZGNwLWNvbHVtbi0tZ3Jvd1wiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgX3RoaXMuJGVsLnJlbW92ZUNsYXNzKFwiZGNwLWNvbHVtbi0tXCIgKyByZXNwb25zZUNvbHVtbnNJbmZvLm51bWJlcik7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBpZiAobWF0Y2hlc1Jlc3BvbnNpdmUgPiAxKSB7XG4gICAgICAgICAgX3RoaXMuJGVsLmFkZENsYXNzKFwiZGNwLWNvbHVtblwiKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBfdGhpcy4kZWwucmVtb3ZlQ2xhc3MoXCJkY3AtY29sdW1uXCIpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChtYXRjaGVzUmVzcG9uc2l2ZSAhPT0gX3RoaXMuZnJhbWVJc1Jlc2l6ZWQpIHtcbiAgICAgICAgICBfdGhpcy5mcmFtZUlzUmVzaXplZCA9IG1hdGNoZXNSZXNwb25zaXZlO1xuICAgICAgICAgIC8vIFNlbmQgcmVzaXplIHRvIGZyYW1lIGluIGNhc2UgdGhleSBoYXZlIGFsc28gcmVzcG9uc2l2ZS5cbiAgICAgICAgICBfdGhpcy5tb2RlbC5nZXQoXCJjb250ZW50XCIpLnByb3BhZ2VFdmVudChcInJlc2l6ZVwiKTtcbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgJChcImJvZHlcIikuYXBwZW5kKCRmYWtlLmFwcGVuZCgkZmFrZVdpZHRoKSk7XG5cbiAgICAgIC8vIENvbXB1dGUgYWJzb2x1dGUgd2lkdGhcbiAgICAgIF8uZWFjaChyZXNwb25zZUNvbHVtbnNEZWZzLCBmdW5jdGlvbiB2VGFiX2NvbXB1dGVSZXNwb25zaXZlV2lkdGgoXG4gICAgICAgIHJlc3BvbnNlQ29sdW1uc0luZm9cbiAgICAgICkge1xuICAgICAgICBpZiAoIXJlc3BvbnNlQ29sdW1uc0luZm8ubWluV2lkdGgpIHtcbiAgICAgICAgICByZXNwb25zZUNvbHVtbnNJbmZvLm1pbkFic1dpZHRoID0gMDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAkZmFrZVdpZHRoLndpZHRoKHJlc3BvbnNlQ29sdW1uc0luZm8ubWluV2lkdGgpO1xuICAgICAgICAgIHJlc3BvbnNlQ29sdW1uc0luZm8ubWluQWJzV2lkdGggPSAkZmFrZVdpZHRoLndpZHRoKCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIXJlc3BvbnNlQ29sdW1uc0luZm8ubWF4V2lkdGgpIHtcbiAgICAgICAgICByZXNwb25zZUNvbHVtbnNJbmZvLm1heEFic1dpZHRoID0gSW5maW5pdHk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgJGZha2VXaWR0aC53aWR0aChyZXNwb25zZUNvbHVtbnNJbmZvLm1heFdpZHRoKTtcbiAgICAgICAgICByZXNwb25zZUNvbHVtbnNJbmZvLm1heEFic1dpZHRoID0gJGZha2VXaWR0aC53aWR0aCgpO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgJGZha2UucmVtb3ZlKCk7XG4gICAgICAkKHdpbmRvdykub24oXCJyZXNpemUudlwiICsgdGhpcy5tb2RlbC5jaWQsIHNldFJlc3BvbnNpdmVDbGFzc2UpO1xuICAgICAgXy5kZWZlcihzZXRSZXNwb25zaXZlQ2xhc3NlKTtcbiAgICB9LFxuICAgIHByb3BhZ2VTaG93VGFiOiBmdW5jdGlvbiB2VGFiQ29udGVudFByb3BhZ2VTaG93VGFiKCkge1xuICAgICAgdGhpcy5tb2RlbC5nZXQoXCJjb250ZW50XCIpLnByb3BhZ2VFdmVudChcInNob3dUYWJcIik7XG4gICAgfSxcblxuICAgIHVwZGF0ZUxhYmVsOiBmdW5jdGlvbiB2VGFiQ29udGVudFVwZGF0ZUxhYmVsKCkge1xuICAgICAgdGhpcy4kZWwuZmluZChcIi5kY3BGcmFtZV9fbGFiZWxcIikudGV4dCh0aGlzLm1vZGVsLmdldChcImxhYmVsXCIpKTtcbiAgICB9LFxuXG4gICAgaGlkZTogZnVuY3Rpb24gdlRhYkNvbnRlbnRIaWRlKCkge1xuICAgICAgdGhpcy4kZWwuaGlkZSgpO1xuICAgIH0sXG5cbiAgICBzaG93OiBmdW5jdGlvbiB2VGFiQ29udGVudFNob3coKSB7XG4gICAgICB0aGlzLiRlbC5zaG93KCk7XG4gICAgfSxcblxuICAgIF9pZGVudGlmeVZpZXc6IGZ1bmN0aW9uIHZBdHRyaWJ1dGVfaWRlbnRpZnlWaWV3KGV2ZW50KSB7XG4gICAgICBldmVudC5oYXZlVmlldyA9IHRydWU7XG4gICAgICAvL0FkZCB0aGUgcG9pbnRlciB0byB0aGUgY3VycmVudCBqcXVlcnkgZWxlbWVudCB0byBhIGxpc3QgcGFzc2VkIGJ5IHRoZSBldmVudFxuICAgICAgZXZlbnQuZWxlbWVudHMgPSBldmVudC5lbGVtZW50cy5hZGQodGhpcy4kZWwpO1xuICAgIH0sXG4gICAgcmVtb3ZlOiBmdW5jdGlvbiB2RnJhbWVfUmVtb3ZlKCkge1xuICAgICAgJCh3aW5kb3cpLm9mZihcIi52XCIgKyB0aGlzLm1vZGVsLmNpZCk7XG5cbiAgICAgIHJldHVybiBCYWNrYm9uZS5WaWV3LnByb3RvdHlwZS5yZW1vdmUuY2FsbCh0aGlzKTtcbiAgICB9XG4gIH0pO1xufSk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///b3a839c4520ca8b4b597\n");

/***/ }),

/***/ "b625c3d07db8baf045ff":
/*!**************************************************!*\
  !*** ./node_modules/bootstrap/js/src/tooltip.js ***!
  \**************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ \"127c8cf59f228bb01a21\");\n/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var popper_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! popper.js */ \"05951c2f2bda4691bed3\");\n/* harmony import */ var _util__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./util */ \"b25f06ae111b578af6b0\");\n\n\n\n\n/**\n * --------------------------------------------------------------------------\n * Bootstrap (v4.1.3): tooltip.js\n * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)\n * --------------------------------------------------------------------------\n */\n\nconst Tooltip = (($) => {\n  /**\n   * ------------------------------------------------------------------------\n   * Constants\n   * ------------------------------------------------------------------------\n   */\n\n  const NAME               = 'tooltip'\n  const VERSION            = '4.1.3'\n  const DATA_KEY           = 'bs.tooltip'\n  const EVENT_KEY          = `.${DATA_KEY}`\n  const JQUERY_NO_CONFLICT = $.fn[NAME]\n  const CLASS_PREFIX       = 'bs-tooltip'\n  const BSCLS_PREFIX_REGEX = new RegExp(`(^|\\\\s)${CLASS_PREFIX}\\\\S+`, 'g')\n\n  const DefaultType = {\n    animation           : 'boolean',\n    template            : 'string',\n    title               : '(string|element|function)',\n    trigger             : 'string',\n    delay               : '(number|object)',\n    html                : 'boolean',\n    selector            : '(string|boolean)',\n    placement           : '(string|function)',\n    offset              : '(number|string)',\n    container           : '(string|element|boolean)',\n    fallbackPlacement   : '(string|array)',\n    boundary            : '(string|element)'\n  }\n\n  const AttachmentMap = {\n    AUTO   : 'auto',\n    TOP    : 'top',\n    RIGHT  : 'right',\n    BOTTOM : 'bottom',\n    LEFT   : 'left'\n  }\n\n  const Default = {\n    animation           : true,\n    template            : '<div class=\"tooltip\" role=\"tooltip\">' +\n                        '<div class=\"arrow\"></div>' +\n                        '<div class=\"tooltip-inner\"></div></div>',\n    trigger             : 'hover focus',\n    title               : '',\n    delay               : 0,\n    html                : false,\n    selector            : false,\n    placement           : 'top',\n    offset              : 0,\n    container           : false,\n    fallbackPlacement   : 'flip',\n    boundary            : 'scrollParent'\n  }\n\n  const HoverState = {\n    SHOW : 'show',\n    OUT  : 'out'\n  }\n\n  const Event = {\n    HIDE       : `hide${EVENT_KEY}`,\n    HIDDEN     : `hidden${EVENT_KEY}`,\n    SHOW       : `show${EVENT_KEY}`,\n    SHOWN      : `shown${EVENT_KEY}`,\n    INSERTED   : `inserted${EVENT_KEY}`,\n    CLICK      : `click${EVENT_KEY}`,\n    FOCUSIN    : `focusin${EVENT_KEY}`,\n    FOCUSOUT   : `focusout${EVENT_KEY}`,\n    MOUSEENTER : `mouseenter${EVENT_KEY}`,\n    MOUSELEAVE : `mouseleave${EVENT_KEY}`\n  }\n\n  const ClassName = {\n    FADE : 'fade',\n    SHOW : 'show'\n  }\n\n  const Selector = {\n    TOOLTIP       : '.tooltip',\n    TOOLTIP_INNER : '.tooltip-inner',\n    ARROW         : '.arrow'\n  }\n\n  const Trigger = {\n    HOVER  : 'hover',\n    FOCUS  : 'focus',\n    CLICK  : 'click',\n    MANUAL : 'manual'\n  }\n\n\n  /**\n   * ------------------------------------------------------------------------\n   * Class Definition\n   * ------------------------------------------------------------------------\n   */\n\n  class Tooltip {\n    constructor(element, config) {\n      /**\n       * Check for Popper dependency\n       * Popper - https://popper.js.org\n       */\n      if (typeof popper_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"] === 'undefined') {\n        throw new TypeError('Bootstrap tooltips require Popper.js (https://popper.js.org)')\n      }\n\n      // private\n      this._isEnabled     = true\n      this._timeout       = 0\n      this._hoverState    = ''\n      this._activeTrigger = {}\n      this._popper        = null\n\n      // Protected\n      this.element = element\n      this.config  = this._getConfig(config)\n      this.tip     = null\n\n      this._setListeners()\n    }\n\n    // Getters\n\n    static get VERSION() {\n      return VERSION\n    }\n\n    static get Default() {\n      return Default\n    }\n\n    static get NAME() {\n      return NAME\n    }\n\n    static get DATA_KEY() {\n      return DATA_KEY\n    }\n\n    static get Event() {\n      return Event\n    }\n\n    static get EVENT_KEY() {\n      return EVENT_KEY\n    }\n\n    static get DefaultType() {\n      return DefaultType\n    }\n\n    // Public\n\n    enable() {\n      this._isEnabled = true\n    }\n\n    disable() {\n      this._isEnabled = false\n    }\n\n    toggleEnabled() {\n      this._isEnabled = !this._isEnabled\n    }\n\n    toggle(event) {\n      if (!this._isEnabled) {\n        return\n      }\n\n      if (event) {\n        const dataKey = this.constructor.DATA_KEY\n        let context = $(event.currentTarget).data(dataKey)\n\n        if (!context) {\n          context = new this.constructor(\n            event.currentTarget,\n            this._getDelegateConfig()\n          )\n          $(event.currentTarget).data(dataKey, context)\n        }\n\n        context._activeTrigger.click = !context._activeTrigger.click\n\n        if (context._isWithActiveTrigger()) {\n          context._enter(null, context)\n        } else {\n          context._leave(null, context)\n        }\n      } else {\n        if ($(this.getTipElement()).hasClass(ClassName.SHOW)) {\n          this._leave(null, this)\n          return\n        }\n\n        this._enter(null, this)\n      }\n    }\n\n    dispose() {\n      clearTimeout(this._timeout)\n\n      $.removeData(this.element, this.constructor.DATA_KEY)\n\n      $(this.element).off(this.constructor.EVENT_KEY)\n      $(this.element).closest('.modal').off('hide.bs.modal')\n\n      if (this.tip) {\n        $(this.tip).remove()\n      }\n\n      this._isEnabled     = null\n      this._timeout       = null\n      this._hoverState    = null\n      this._activeTrigger = null\n      if (this._popper !== null) {\n        this._popper.destroy()\n      }\n\n      this._popper = null\n      this.element = null\n      this.config  = null\n      this.tip     = null\n    }\n\n    show() {\n      if ($(this.element).css('display') === 'none') {\n        throw new Error('Please use show on visible elements')\n      }\n\n      const showEvent = $.Event(this.constructor.Event.SHOW)\n      if (this.isWithContent() && this._isEnabled) {\n        $(this.element).trigger(showEvent)\n\n        const isInTheDom = $.contains(\n          this.element.ownerDocument.documentElement,\n          this.element\n        )\n\n        if (showEvent.isDefaultPrevented() || !isInTheDom) {\n          return\n        }\n\n        const tip   = this.getTipElement()\n        const tipId = _util__WEBPACK_IMPORTED_MODULE_2__[\"default\"].getUID(this.constructor.NAME)\n\n        tip.setAttribute('id', tipId)\n        this.element.setAttribute('aria-describedby', tipId)\n\n        this.setContent()\n\n        if (this.config.animation) {\n          $(tip).addClass(ClassName.FADE)\n        }\n\n        const placement  = typeof this.config.placement === 'function'\n          ? this.config.placement.call(this, tip, this.element)\n          : this.config.placement\n\n        const attachment = this._getAttachment(placement)\n        this.addAttachmentClass(attachment)\n\n        const container = this.config.container === false ? document.body : $(document).find(this.config.container)\n\n        $(tip).data(this.constructor.DATA_KEY, this)\n\n        if (!$.contains(this.element.ownerDocument.documentElement, this.tip)) {\n          $(tip).appendTo(container)\n        }\n\n        $(this.element).trigger(this.constructor.Event.INSERTED)\n\n        this._popper = new popper_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"](this.element, tip, {\n          placement: attachment,\n          modifiers: {\n            offset: {\n              offset: this.config.offset\n            },\n            flip: {\n              behavior: this.config.fallbackPlacement\n            },\n            arrow: {\n              element: Selector.ARROW\n            },\n            preventOverflow: {\n              boundariesElement: this.config.boundary\n            }\n          },\n          onCreate: (data) => {\n            if (data.originalPlacement !== data.placement) {\n              this._handlePopperPlacementChange(data)\n            }\n          },\n          onUpdate: (data) => {\n            this._handlePopperPlacementChange(data)\n          }\n        })\n\n        $(tip).addClass(ClassName.SHOW)\n\n        // If this is a touch-enabled device we add extra\n        // empty mouseover listeners to the body's immediate children;\n        // only needed because of broken event delegation on iOS\n        // https://www.quirksmode.org/blog/archives/2014/02/mouse_event_bub.html\n        if ('ontouchstart' in document.documentElement) {\n          $(document.body).children().on('mouseover', null, $.noop)\n        }\n\n        const complete = () => {\n          if (this.config.animation) {\n            this._fixTransition()\n          }\n          const prevHoverState = this._hoverState\n          this._hoverState     = null\n\n          $(this.element).trigger(this.constructor.Event.SHOWN)\n\n          if (prevHoverState === HoverState.OUT) {\n            this._leave(null, this)\n          }\n        }\n\n        if ($(this.tip).hasClass(ClassName.FADE)) {\n          const transitionDuration = _util__WEBPACK_IMPORTED_MODULE_2__[\"default\"].getTransitionDurationFromElement(this.tip)\n\n          $(this.tip)\n            .one(_util__WEBPACK_IMPORTED_MODULE_2__[\"default\"].TRANSITION_END, complete)\n            .emulateTransitionEnd(transitionDuration)\n        } else {\n          complete()\n        }\n      }\n    }\n\n    hide(callback) {\n      const tip       = this.getTipElement()\n      const hideEvent = $.Event(this.constructor.Event.HIDE)\n      const complete = () => {\n        if (this._hoverState !== HoverState.SHOW && tip.parentNode) {\n          tip.parentNode.removeChild(tip)\n        }\n\n        this._cleanTipClass()\n        this.element.removeAttribute('aria-describedby')\n        $(this.element).trigger(this.constructor.Event.HIDDEN)\n        if (this._popper !== null) {\n          this._popper.destroy()\n        }\n\n        if (callback) {\n          callback()\n        }\n      }\n\n      $(this.element).trigger(hideEvent)\n\n      if (hideEvent.isDefaultPrevented()) {\n        return\n      }\n\n      $(tip).removeClass(ClassName.SHOW)\n\n      // If this is a touch-enabled device we remove the extra\n      // empty mouseover listeners we added for iOS support\n      if ('ontouchstart' in document.documentElement) {\n        $(document.body).children().off('mouseover', null, $.noop)\n      }\n\n      this._activeTrigger[Trigger.CLICK] = false\n      this._activeTrigger[Trigger.FOCUS] = false\n      this._activeTrigger[Trigger.HOVER] = false\n\n      if ($(this.tip).hasClass(ClassName.FADE)) {\n        const transitionDuration = _util__WEBPACK_IMPORTED_MODULE_2__[\"default\"].getTransitionDurationFromElement(tip)\n\n        $(tip)\n          .one(_util__WEBPACK_IMPORTED_MODULE_2__[\"default\"].TRANSITION_END, complete)\n          .emulateTransitionEnd(transitionDuration)\n      } else {\n        complete()\n      }\n\n      this._hoverState = ''\n    }\n\n    update() {\n      if (this._popper !== null) {\n        this._popper.scheduleUpdate()\n      }\n    }\n\n    // Protected\n\n    isWithContent() {\n      return Boolean(this.getTitle())\n    }\n\n    addAttachmentClass(attachment) {\n      $(this.getTipElement()).addClass(`${CLASS_PREFIX}-${attachment}`)\n    }\n\n    getTipElement() {\n      this.tip = this.tip || $(this.config.template)[0]\n      return this.tip\n    }\n\n    setContent() {\n      const tip = this.getTipElement()\n      this.setElementContent($(tip.querySelectorAll(Selector.TOOLTIP_INNER)), this.getTitle())\n      $(tip).removeClass(`${ClassName.FADE} ${ClassName.SHOW}`)\n    }\n\n    setElementContent($element, content) {\n      const html = this.config.html\n      if (typeof content === 'object' && (content.nodeType || content.jquery)) {\n        // Content is a DOM node or a jQuery\n        if (html) {\n          if (!$(content).parent().is($element)) {\n            $element.empty().append(content)\n          }\n        } else {\n          $element.text($(content).text())\n        }\n      } else {\n        $element[html ? 'html' : 'text'](content)\n      }\n    }\n\n    getTitle() {\n      let title = this.element.getAttribute('data-original-title')\n\n      if (!title) {\n        title = typeof this.config.title === 'function'\n          ? this.config.title.call(this.element)\n          : this.config.title\n      }\n\n      return title\n    }\n\n    // Private\n\n    _getAttachment(placement) {\n      return AttachmentMap[placement.toUpperCase()]\n    }\n\n    _setListeners() {\n      const triggers = this.config.trigger.split(' ')\n\n      triggers.forEach((trigger) => {\n        if (trigger === 'click') {\n          $(this.element).on(\n            this.constructor.Event.CLICK,\n            this.config.selector,\n            (event) => this.toggle(event)\n          )\n        } else if (trigger !== Trigger.MANUAL) {\n          const eventIn = trigger === Trigger.HOVER\n            ? this.constructor.Event.MOUSEENTER\n            : this.constructor.Event.FOCUSIN\n          const eventOut = trigger === Trigger.HOVER\n            ? this.constructor.Event.MOUSELEAVE\n            : this.constructor.Event.FOCUSOUT\n\n          $(this.element)\n            .on(\n              eventIn,\n              this.config.selector,\n              (event) => this._enter(event)\n            )\n            .on(\n              eventOut,\n              this.config.selector,\n              (event) => this._leave(event)\n            )\n        }\n\n        $(this.element).closest('.modal').on(\n          'hide.bs.modal',\n          () => this.hide()\n        )\n      })\n\n      if (this.config.selector) {\n        this.config = {\n          ...this.config,\n          trigger: 'manual',\n          selector: ''\n        }\n      } else {\n        this._fixTitle()\n      }\n    }\n\n    _fixTitle() {\n      const titleType = typeof this.element.getAttribute('data-original-title')\n      if (this.element.getAttribute('title') ||\n         titleType !== 'string') {\n        this.element.setAttribute(\n          'data-original-title',\n          this.element.getAttribute('title') || ''\n        )\n        this.element.setAttribute('title', '')\n      }\n    }\n\n    _enter(event, context) {\n      const dataKey = this.constructor.DATA_KEY\n\n      context = context || $(event.currentTarget).data(dataKey)\n\n      if (!context) {\n        context = new this.constructor(\n          event.currentTarget,\n          this._getDelegateConfig()\n        )\n        $(event.currentTarget).data(dataKey, context)\n      }\n\n      if (event) {\n        context._activeTrigger[\n          event.type === 'focusin' ? Trigger.FOCUS : Trigger.HOVER\n        ] = true\n      }\n\n      if ($(context.getTipElement()).hasClass(ClassName.SHOW) ||\n         context._hoverState === HoverState.SHOW) {\n        context._hoverState = HoverState.SHOW\n        return\n      }\n\n      clearTimeout(context._timeout)\n\n      context._hoverState = HoverState.SHOW\n\n      if (!context.config.delay || !context.config.delay.show) {\n        context.show()\n        return\n      }\n\n      context._timeout = setTimeout(() => {\n        if (context._hoverState === HoverState.SHOW) {\n          context.show()\n        }\n      }, context.config.delay.show)\n    }\n\n    _leave(event, context) {\n      const dataKey = this.constructor.DATA_KEY\n\n      context = context || $(event.currentTarget).data(dataKey)\n\n      if (!context) {\n        context = new this.constructor(\n          event.currentTarget,\n          this._getDelegateConfig()\n        )\n        $(event.currentTarget).data(dataKey, context)\n      }\n\n      if (event) {\n        context._activeTrigger[\n          event.type === 'focusout' ? Trigger.FOCUS : Trigger.HOVER\n        ] = false\n      }\n\n      if (context._isWithActiveTrigger()) {\n        return\n      }\n\n      clearTimeout(context._timeout)\n\n      context._hoverState = HoverState.OUT\n\n      if (!context.config.delay || !context.config.delay.hide) {\n        context.hide()\n        return\n      }\n\n      context._timeout = setTimeout(() => {\n        if (context._hoverState === HoverState.OUT) {\n          context.hide()\n        }\n      }, context.config.delay.hide)\n    }\n\n    _isWithActiveTrigger() {\n      for (const trigger in this._activeTrigger) {\n        if (this._activeTrigger[trigger]) {\n          return true\n        }\n      }\n\n      return false\n    }\n\n    _getConfig(config) {\n      config = {\n        ...this.constructor.Default,\n        ...$(this.element).data(),\n        ...typeof config === 'object' && config ? config : {}\n      }\n\n      if (typeof config.delay === 'number') {\n        config.delay = {\n          show: config.delay,\n          hide: config.delay\n        }\n      }\n\n      if (typeof config.title === 'number') {\n        config.title = config.title.toString()\n      }\n\n      if (typeof config.content === 'number') {\n        config.content = config.content.toString()\n      }\n\n      _util__WEBPACK_IMPORTED_MODULE_2__[\"default\"].typeCheckConfig(\n        NAME,\n        config,\n        this.constructor.DefaultType\n      )\n\n      return config\n    }\n\n    _getDelegateConfig() {\n      const config = {}\n\n      if (this.config) {\n        for (const key in this.config) {\n          if (this.constructor.Default[key] !== this.config[key]) {\n            config[key] = this.config[key]\n          }\n        }\n      }\n\n      return config\n    }\n\n    _cleanTipClass() {\n      const $tip = $(this.getTipElement())\n      const tabClass = $tip.attr('class').match(BSCLS_PREFIX_REGEX)\n      if (tabClass !== null && tabClass.length) {\n        $tip.removeClass(tabClass.join(''))\n      }\n    }\n\n    _handlePopperPlacementChange(popperData) {\n      const popperInstance = popperData.instance\n      this.tip = popperInstance.popper\n      this._cleanTipClass()\n      this.addAttachmentClass(this._getAttachment(popperData.placement))\n    }\n\n    _fixTransition() {\n      const tip = this.getTipElement()\n      const initConfigAnimation = this.config.animation\n      if (tip.getAttribute('x-placement') !== null) {\n        return\n      }\n      $(tip).removeClass(ClassName.FADE)\n      this.config.animation = false\n      this.hide()\n      this.show()\n      this.config.animation = initConfigAnimation\n    }\n\n    // Static\n\n    static _jQueryInterface(config) {\n      return this.each(function () {\n        let data = $(this).data(DATA_KEY)\n        const _config = typeof config === 'object' && config\n\n        if (!data && /dispose|hide/.test(config)) {\n          return\n        }\n\n        if (!data) {\n          data = new Tooltip(this, _config)\n          $(this).data(DATA_KEY, data)\n        }\n\n        if (typeof config === 'string') {\n          if (typeof data[config] === 'undefined') {\n            throw new TypeError(`No method named \"${config}\"`)\n          }\n          data[config]()\n        }\n      })\n    }\n  }\n\n  /**\n   * ------------------------------------------------------------------------\n   * jQuery\n   * ------------------------------------------------------------------------\n   */\n\n  $.fn[NAME] = Tooltip._jQueryInterface\n  $.fn[NAME].Constructor = Tooltip\n  $.fn[NAME].noConflict = function () {\n    $.fn[NAME] = JQUERY_NO_CONFLICT\n    return Tooltip._jQueryInterface\n  }\n\n  return Tooltip\n})(jquery__WEBPACK_IMPORTED_MODULE_0___default.a, popper_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"])\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (Tooltip);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYjYyNWMzZDA3ZGI4YmFmMDQ1ZmYuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvYm9vdHN0cmFwL2pzL3NyYy90b29sdGlwLmpzP2Y1ZWYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICQgZnJvbSAnanF1ZXJ5J1xuaW1wb3J0IFBvcHBlciBmcm9tICdwb3BwZXIuanMnXG5pbXBvcnQgVXRpbCBmcm9tICcuL3V0aWwnXG5cbi8qKlxuICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAqIEJvb3RzdHJhcCAodjQuMS4zKTogdG9vbHRpcC5qc1xuICogTGljZW5zZWQgdW5kZXIgTUlUIChodHRwczovL2dpdGh1Yi5jb20vdHdicy9ib290c3RyYXAvYmxvYi9tYXN0ZXIvTElDRU5TRSlcbiAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gKi9cblxuY29uc3QgVG9vbHRpcCA9ICgoJCkgPT4ge1xuICAvKipcbiAgICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAqIENvbnN0YW50c1xuICAgKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICovXG5cbiAgY29uc3QgTkFNRSAgICAgICAgICAgICAgID0gJ3Rvb2x0aXAnXG4gIGNvbnN0IFZFUlNJT04gICAgICAgICAgICA9ICc0LjEuMydcbiAgY29uc3QgREFUQV9LRVkgICAgICAgICAgID0gJ2JzLnRvb2x0aXAnXG4gIGNvbnN0IEVWRU5UX0tFWSAgICAgICAgICA9IGAuJHtEQVRBX0tFWX1gXG4gIGNvbnN0IEpRVUVSWV9OT19DT05GTElDVCA9ICQuZm5bTkFNRV1cbiAgY29uc3QgQ0xBU1NfUFJFRklYICAgICAgID0gJ2JzLXRvb2x0aXAnXG4gIGNvbnN0IEJTQ0xTX1BSRUZJWF9SRUdFWCA9IG5ldyBSZWdFeHAoYChefFxcXFxzKSR7Q0xBU1NfUFJFRklYfVxcXFxTK2AsICdnJylcblxuICBjb25zdCBEZWZhdWx0VHlwZSA9IHtcbiAgICBhbmltYXRpb24gICAgICAgICAgIDogJ2Jvb2xlYW4nLFxuICAgIHRlbXBsYXRlICAgICAgICAgICAgOiAnc3RyaW5nJyxcbiAgICB0aXRsZSAgICAgICAgICAgICAgIDogJyhzdHJpbmd8ZWxlbWVudHxmdW5jdGlvbiknLFxuICAgIHRyaWdnZXIgICAgICAgICAgICAgOiAnc3RyaW5nJyxcbiAgICBkZWxheSAgICAgICAgICAgICAgIDogJyhudW1iZXJ8b2JqZWN0KScsXG4gICAgaHRtbCAgICAgICAgICAgICAgICA6ICdib29sZWFuJyxcbiAgICBzZWxlY3RvciAgICAgICAgICAgIDogJyhzdHJpbmd8Ym9vbGVhbiknLFxuICAgIHBsYWNlbWVudCAgICAgICAgICAgOiAnKHN0cmluZ3xmdW5jdGlvbiknLFxuICAgIG9mZnNldCAgICAgICAgICAgICAgOiAnKG51bWJlcnxzdHJpbmcpJyxcbiAgICBjb250YWluZXIgICAgICAgICAgIDogJyhzdHJpbmd8ZWxlbWVudHxib29sZWFuKScsXG4gICAgZmFsbGJhY2tQbGFjZW1lbnQgICA6ICcoc3RyaW5nfGFycmF5KScsXG4gICAgYm91bmRhcnkgICAgICAgICAgICA6ICcoc3RyaW5nfGVsZW1lbnQpJ1xuICB9XG5cbiAgY29uc3QgQXR0YWNobWVudE1hcCA9IHtcbiAgICBBVVRPICAgOiAnYXV0bycsXG4gICAgVE9QICAgIDogJ3RvcCcsXG4gICAgUklHSFQgIDogJ3JpZ2h0JyxcbiAgICBCT1RUT00gOiAnYm90dG9tJyxcbiAgICBMRUZUICAgOiAnbGVmdCdcbiAgfVxuXG4gIGNvbnN0IERlZmF1bHQgPSB7XG4gICAgYW5pbWF0aW9uICAgICAgICAgICA6IHRydWUsXG4gICAgdGVtcGxhdGUgICAgICAgICAgICA6ICc8ZGl2IGNsYXNzPVwidG9vbHRpcFwiIHJvbGU9XCJ0b29sdGlwXCI+JyArXG4gICAgICAgICAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz1cImFycm93XCI+PC9kaXY+JyArXG4gICAgICAgICAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz1cInRvb2x0aXAtaW5uZXJcIj48L2Rpdj48L2Rpdj4nLFxuICAgIHRyaWdnZXIgICAgICAgICAgICAgOiAnaG92ZXIgZm9jdXMnLFxuICAgIHRpdGxlICAgICAgICAgICAgICAgOiAnJyxcbiAgICBkZWxheSAgICAgICAgICAgICAgIDogMCxcbiAgICBodG1sICAgICAgICAgICAgICAgIDogZmFsc2UsXG4gICAgc2VsZWN0b3IgICAgICAgICAgICA6IGZhbHNlLFxuICAgIHBsYWNlbWVudCAgICAgICAgICAgOiAndG9wJyxcbiAgICBvZmZzZXQgICAgICAgICAgICAgIDogMCxcbiAgICBjb250YWluZXIgICAgICAgICAgIDogZmFsc2UsXG4gICAgZmFsbGJhY2tQbGFjZW1lbnQgICA6ICdmbGlwJyxcbiAgICBib3VuZGFyeSAgICAgICAgICAgIDogJ3Njcm9sbFBhcmVudCdcbiAgfVxuXG4gIGNvbnN0IEhvdmVyU3RhdGUgPSB7XG4gICAgU0hPVyA6ICdzaG93JyxcbiAgICBPVVQgIDogJ291dCdcbiAgfVxuXG4gIGNvbnN0IEV2ZW50ID0ge1xuICAgIEhJREUgICAgICAgOiBgaGlkZSR7RVZFTlRfS0VZfWAsXG4gICAgSElEREVOICAgICA6IGBoaWRkZW4ke0VWRU5UX0tFWX1gLFxuICAgIFNIT1cgICAgICAgOiBgc2hvdyR7RVZFTlRfS0VZfWAsXG4gICAgU0hPV04gICAgICA6IGBzaG93biR7RVZFTlRfS0VZfWAsXG4gICAgSU5TRVJURUQgICA6IGBpbnNlcnRlZCR7RVZFTlRfS0VZfWAsXG4gICAgQ0xJQ0sgICAgICA6IGBjbGljayR7RVZFTlRfS0VZfWAsXG4gICAgRk9DVVNJTiAgICA6IGBmb2N1c2luJHtFVkVOVF9LRVl9YCxcbiAgICBGT0NVU09VVCAgIDogYGZvY3Vzb3V0JHtFVkVOVF9LRVl9YCxcbiAgICBNT1VTRUVOVEVSIDogYG1vdXNlZW50ZXIke0VWRU5UX0tFWX1gLFxuICAgIE1PVVNFTEVBVkUgOiBgbW91c2VsZWF2ZSR7RVZFTlRfS0VZfWBcbiAgfVxuXG4gIGNvbnN0IENsYXNzTmFtZSA9IHtcbiAgICBGQURFIDogJ2ZhZGUnLFxuICAgIFNIT1cgOiAnc2hvdydcbiAgfVxuXG4gIGNvbnN0IFNlbGVjdG9yID0ge1xuICAgIFRPT0xUSVAgICAgICAgOiAnLnRvb2x0aXAnLFxuICAgIFRPT0xUSVBfSU5ORVIgOiAnLnRvb2x0aXAtaW5uZXInLFxuICAgIEFSUk9XICAgICAgICAgOiAnLmFycm93J1xuICB9XG5cbiAgY29uc3QgVHJpZ2dlciA9IHtcbiAgICBIT1ZFUiAgOiAnaG92ZXInLFxuICAgIEZPQ1VTICA6ICdmb2N1cycsXG4gICAgQ0xJQ0sgIDogJ2NsaWNrJyxcbiAgICBNQU5VQUwgOiAnbWFudWFsJ1xuICB9XG5cblxuICAvKipcbiAgICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAqIENsYXNzIERlZmluaXRpb25cbiAgICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAqL1xuXG4gIGNsYXNzIFRvb2x0aXAge1xuICAgIGNvbnN0cnVjdG9yKGVsZW1lbnQsIGNvbmZpZykge1xuICAgICAgLyoqXG4gICAgICAgKiBDaGVjayBmb3IgUG9wcGVyIGRlcGVuZGVuY3lcbiAgICAgICAqIFBvcHBlciAtIGh0dHBzOi8vcG9wcGVyLmpzLm9yZ1xuICAgICAgICovXG4gICAgICBpZiAodHlwZW9mIFBvcHBlciA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignQm9vdHN0cmFwIHRvb2x0aXBzIHJlcXVpcmUgUG9wcGVyLmpzIChodHRwczovL3BvcHBlci5qcy5vcmcpJylcbiAgICAgIH1cblxuICAgICAgLy8gcHJpdmF0ZVxuICAgICAgdGhpcy5faXNFbmFibGVkICAgICA9IHRydWVcbiAgICAgIHRoaXMuX3RpbWVvdXQgICAgICAgPSAwXG4gICAgICB0aGlzLl9ob3ZlclN0YXRlICAgID0gJydcbiAgICAgIHRoaXMuX2FjdGl2ZVRyaWdnZXIgPSB7fVxuICAgICAgdGhpcy5fcG9wcGVyICAgICAgICA9IG51bGxcblxuICAgICAgLy8gUHJvdGVjdGVkXG4gICAgICB0aGlzLmVsZW1lbnQgPSBlbGVtZW50XG4gICAgICB0aGlzLmNvbmZpZyAgPSB0aGlzLl9nZXRDb25maWcoY29uZmlnKVxuICAgICAgdGhpcy50aXAgICAgID0gbnVsbFxuXG4gICAgICB0aGlzLl9zZXRMaXN0ZW5lcnMoKVxuICAgIH1cblxuICAgIC8vIEdldHRlcnNcblxuICAgIHN0YXRpYyBnZXQgVkVSU0lPTigpIHtcbiAgICAgIHJldHVybiBWRVJTSU9OXG4gICAgfVxuXG4gICAgc3RhdGljIGdldCBEZWZhdWx0KCkge1xuICAgICAgcmV0dXJuIERlZmF1bHRcbiAgICB9XG5cbiAgICBzdGF0aWMgZ2V0IE5BTUUoKSB7XG4gICAgICByZXR1cm4gTkFNRVxuICAgIH1cblxuICAgIHN0YXRpYyBnZXQgREFUQV9LRVkoKSB7XG4gICAgICByZXR1cm4gREFUQV9LRVlcbiAgICB9XG5cbiAgICBzdGF0aWMgZ2V0IEV2ZW50KCkge1xuICAgICAgcmV0dXJuIEV2ZW50XG4gICAgfVxuXG4gICAgc3RhdGljIGdldCBFVkVOVF9LRVkoKSB7XG4gICAgICByZXR1cm4gRVZFTlRfS0VZXG4gICAgfVxuXG4gICAgc3RhdGljIGdldCBEZWZhdWx0VHlwZSgpIHtcbiAgICAgIHJldHVybiBEZWZhdWx0VHlwZVxuICAgIH1cblxuICAgIC8vIFB1YmxpY1xuXG4gICAgZW5hYmxlKCkge1xuICAgICAgdGhpcy5faXNFbmFibGVkID0gdHJ1ZVxuICAgIH1cblxuICAgIGRpc2FibGUoKSB7XG4gICAgICB0aGlzLl9pc0VuYWJsZWQgPSBmYWxzZVxuICAgIH1cblxuICAgIHRvZ2dsZUVuYWJsZWQoKSB7XG4gICAgICB0aGlzLl9pc0VuYWJsZWQgPSAhdGhpcy5faXNFbmFibGVkXG4gICAgfVxuXG4gICAgdG9nZ2xlKGV2ZW50KSB7XG4gICAgICBpZiAoIXRoaXMuX2lzRW5hYmxlZCkge1xuICAgICAgICByZXR1cm5cbiAgICAgIH1cblxuICAgICAgaWYgKGV2ZW50KSB7XG4gICAgICAgIGNvbnN0IGRhdGFLZXkgPSB0aGlzLmNvbnN0cnVjdG9yLkRBVEFfS0VZXG4gICAgICAgIGxldCBjb250ZXh0ID0gJChldmVudC5jdXJyZW50VGFyZ2V0KS5kYXRhKGRhdGFLZXkpXG5cbiAgICAgICAgaWYgKCFjb250ZXh0KSB7XG4gICAgICAgICAgY29udGV4dCA9IG5ldyB0aGlzLmNvbnN0cnVjdG9yKFxuICAgICAgICAgICAgZXZlbnQuY3VycmVudFRhcmdldCxcbiAgICAgICAgICAgIHRoaXMuX2dldERlbGVnYXRlQ29uZmlnKClcbiAgICAgICAgICApXG4gICAgICAgICAgJChldmVudC5jdXJyZW50VGFyZ2V0KS5kYXRhKGRhdGFLZXksIGNvbnRleHQpXG4gICAgICAgIH1cblxuICAgICAgICBjb250ZXh0Ll9hY3RpdmVUcmlnZ2VyLmNsaWNrID0gIWNvbnRleHQuX2FjdGl2ZVRyaWdnZXIuY2xpY2tcblxuICAgICAgICBpZiAoY29udGV4dC5faXNXaXRoQWN0aXZlVHJpZ2dlcigpKSB7XG4gICAgICAgICAgY29udGV4dC5fZW50ZXIobnVsbCwgY29udGV4dClcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb250ZXh0Ll9sZWF2ZShudWxsLCBjb250ZXh0KVxuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoJCh0aGlzLmdldFRpcEVsZW1lbnQoKSkuaGFzQ2xhc3MoQ2xhc3NOYW1lLlNIT1cpKSB7XG4gICAgICAgICAgdGhpcy5fbGVhdmUobnVsbCwgdGhpcylcbiAgICAgICAgICByZXR1cm5cbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuX2VudGVyKG51bGwsIHRoaXMpXG4gICAgICB9XG4gICAgfVxuXG4gICAgZGlzcG9zZSgpIHtcbiAgICAgIGNsZWFyVGltZW91dCh0aGlzLl90aW1lb3V0KVxuXG4gICAgICAkLnJlbW92ZURhdGEodGhpcy5lbGVtZW50LCB0aGlzLmNvbnN0cnVjdG9yLkRBVEFfS0VZKVxuXG4gICAgICAkKHRoaXMuZWxlbWVudCkub2ZmKHRoaXMuY29uc3RydWN0b3IuRVZFTlRfS0VZKVxuICAgICAgJCh0aGlzLmVsZW1lbnQpLmNsb3Nlc3QoJy5tb2RhbCcpLm9mZignaGlkZS5icy5tb2RhbCcpXG5cbiAgICAgIGlmICh0aGlzLnRpcCkge1xuICAgICAgICAkKHRoaXMudGlwKS5yZW1vdmUoKVxuICAgICAgfVxuXG4gICAgICB0aGlzLl9pc0VuYWJsZWQgICAgID0gbnVsbFxuICAgICAgdGhpcy5fdGltZW91dCAgICAgICA9IG51bGxcbiAgICAgIHRoaXMuX2hvdmVyU3RhdGUgICAgPSBudWxsXG4gICAgICB0aGlzLl9hY3RpdmVUcmlnZ2VyID0gbnVsbFxuICAgICAgaWYgKHRoaXMuX3BvcHBlciAhPT0gbnVsbCkge1xuICAgICAgICB0aGlzLl9wb3BwZXIuZGVzdHJveSgpXG4gICAgICB9XG5cbiAgICAgIHRoaXMuX3BvcHBlciA9IG51bGxcbiAgICAgIHRoaXMuZWxlbWVudCA9IG51bGxcbiAgICAgIHRoaXMuY29uZmlnICA9IG51bGxcbiAgICAgIHRoaXMudGlwICAgICA9IG51bGxcbiAgICB9XG5cbiAgICBzaG93KCkge1xuICAgICAgaWYgKCQodGhpcy5lbGVtZW50KS5jc3MoJ2Rpc3BsYXknKSA9PT0gJ25vbmUnKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignUGxlYXNlIHVzZSBzaG93IG9uIHZpc2libGUgZWxlbWVudHMnKVxuICAgICAgfVxuXG4gICAgICBjb25zdCBzaG93RXZlbnQgPSAkLkV2ZW50KHRoaXMuY29uc3RydWN0b3IuRXZlbnQuU0hPVylcbiAgICAgIGlmICh0aGlzLmlzV2l0aENvbnRlbnQoKSAmJiB0aGlzLl9pc0VuYWJsZWQpIHtcbiAgICAgICAgJCh0aGlzLmVsZW1lbnQpLnRyaWdnZXIoc2hvd0V2ZW50KVxuXG4gICAgICAgIGNvbnN0IGlzSW5UaGVEb20gPSAkLmNvbnRhaW5zKFxuICAgICAgICAgIHRoaXMuZWxlbWVudC5vd25lckRvY3VtZW50LmRvY3VtZW50RWxlbWVudCxcbiAgICAgICAgICB0aGlzLmVsZW1lbnRcbiAgICAgICAgKVxuXG4gICAgICAgIGlmIChzaG93RXZlbnQuaXNEZWZhdWx0UHJldmVudGVkKCkgfHwgIWlzSW5UaGVEb20pIHtcbiAgICAgICAgICByZXR1cm5cbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHRpcCAgID0gdGhpcy5nZXRUaXBFbGVtZW50KClcbiAgICAgICAgY29uc3QgdGlwSWQgPSBVdGlsLmdldFVJRCh0aGlzLmNvbnN0cnVjdG9yLk5BTUUpXG5cbiAgICAgICAgdGlwLnNldEF0dHJpYnV0ZSgnaWQnLCB0aXBJZClcbiAgICAgICAgdGhpcy5lbGVtZW50LnNldEF0dHJpYnV0ZSgnYXJpYS1kZXNjcmliZWRieScsIHRpcElkKVxuXG4gICAgICAgIHRoaXMuc2V0Q29udGVudCgpXG5cbiAgICAgICAgaWYgKHRoaXMuY29uZmlnLmFuaW1hdGlvbikge1xuICAgICAgICAgICQodGlwKS5hZGRDbGFzcyhDbGFzc05hbWUuRkFERSlcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHBsYWNlbWVudCAgPSB0eXBlb2YgdGhpcy5jb25maWcucGxhY2VtZW50ID09PSAnZnVuY3Rpb24nXG4gICAgICAgICAgPyB0aGlzLmNvbmZpZy5wbGFjZW1lbnQuY2FsbCh0aGlzLCB0aXAsIHRoaXMuZWxlbWVudClcbiAgICAgICAgICA6IHRoaXMuY29uZmlnLnBsYWNlbWVudFxuXG4gICAgICAgIGNvbnN0IGF0dGFjaG1lbnQgPSB0aGlzLl9nZXRBdHRhY2htZW50KHBsYWNlbWVudClcbiAgICAgICAgdGhpcy5hZGRBdHRhY2htZW50Q2xhc3MoYXR0YWNobWVudClcblxuICAgICAgICBjb25zdCBjb250YWluZXIgPSB0aGlzLmNvbmZpZy5jb250YWluZXIgPT09IGZhbHNlID8gZG9jdW1lbnQuYm9keSA6ICQoZG9jdW1lbnQpLmZpbmQodGhpcy5jb25maWcuY29udGFpbmVyKVxuXG4gICAgICAgICQodGlwKS5kYXRhKHRoaXMuY29uc3RydWN0b3IuREFUQV9LRVksIHRoaXMpXG5cbiAgICAgICAgaWYgKCEkLmNvbnRhaW5zKHRoaXMuZWxlbWVudC5vd25lckRvY3VtZW50LmRvY3VtZW50RWxlbWVudCwgdGhpcy50aXApKSB7XG4gICAgICAgICAgJCh0aXApLmFwcGVuZFRvKGNvbnRhaW5lcilcbiAgICAgICAgfVxuXG4gICAgICAgICQodGhpcy5lbGVtZW50KS50cmlnZ2VyKHRoaXMuY29uc3RydWN0b3IuRXZlbnQuSU5TRVJURUQpXG5cbiAgICAgICAgdGhpcy5fcG9wcGVyID0gbmV3IFBvcHBlcih0aGlzLmVsZW1lbnQsIHRpcCwge1xuICAgICAgICAgIHBsYWNlbWVudDogYXR0YWNobWVudCxcbiAgICAgICAgICBtb2RpZmllcnM6IHtcbiAgICAgICAgICAgIG9mZnNldDoge1xuICAgICAgICAgICAgICBvZmZzZXQ6IHRoaXMuY29uZmlnLm9mZnNldFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGZsaXA6IHtcbiAgICAgICAgICAgICAgYmVoYXZpb3I6IHRoaXMuY29uZmlnLmZhbGxiYWNrUGxhY2VtZW50XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgYXJyb3c6IHtcbiAgICAgICAgICAgICAgZWxlbWVudDogU2VsZWN0b3IuQVJST1dcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBwcmV2ZW50T3ZlcmZsb3c6IHtcbiAgICAgICAgICAgICAgYm91bmRhcmllc0VsZW1lbnQ6IHRoaXMuY29uZmlnLmJvdW5kYXJ5XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICBvbkNyZWF0ZTogKGRhdGEpID0+IHtcbiAgICAgICAgICAgIGlmIChkYXRhLm9yaWdpbmFsUGxhY2VtZW50ICE9PSBkYXRhLnBsYWNlbWVudCkge1xuICAgICAgICAgICAgICB0aGlzLl9oYW5kbGVQb3BwZXJQbGFjZW1lbnRDaGFuZ2UoZGF0YSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIG9uVXBkYXRlOiAoZGF0YSkgPT4ge1xuICAgICAgICAgICAgdGhpcy5faGFuZGxlUG9wcGVyUGxhY2VtZW50Q2hhbmdlKGRhdGEpXG4gICAgICAgICAgfVxuICAgICAgICB9KVxuXG4gICAgICAgICQodGlwKS5hZGRDbGFzcyhDbGFzc05hbWUuU0hPVylcblxuICAgICAgICAvLyBJZiB0aGlzIGlzIGEgdG91Y2gtZW5hYmxlZCBkZXZpY2Ugd2UgYWRkIGV4dHJhXG4gICAgICAgIC8vIGVtcHR5IG1vdXNlb3ZlciBsaXN0ZW5lcnMgdG8gdGhlIGJvZHkncyBpbW1lZGlhdGUgY2hpbGRyZW47XG4gICAgICAgIC8vIG9ubHkgbmVlZGVkIGJlY2F1c2Ugb2YgYnJva2VuIGV2ZW50IGRlbGVnYXRpb24gb24gaU9TXG4gICAgICAgIC8vIGh0dHBzOi8vd3d3LnF1aXJrc21vZGUub3JnL2Jsb2cvYXJjaGl2ZXMvMjAxNC8wMi9tb3VzZV9ldmVudF9idWIuaHRtbFxuICAgICAgICBpZiAoJ29udG91Y2hzdGFydCcgaW4gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50KSB7XG4gICAgICAgICAgJChkb2N1bWVudC5ib2R5KS5jaGlsZHJlbigpLm9uKCdtb3VzZW92ZXInLCBudWxsLCAkLm5vb3ApXG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBjb21wbGV0ZSA9ICgpID0+IHtcbiAgICAgICAgICBpZiAodGhpcy5jb25maWcuYW5pbWF0aW9uKSB7XG4gICAgICAgICAgICB0aGlzLl9maXhUcmFuc2l0aW9uKClcbiAgICAgICAgICB9XG4gICAgICAgICAgY29uc3QgcHJldkhvdmVyU3RhdGUgPSB0aGlzLl9ob3ZlclN0YXRlXG4gICAgICAgICAgdGhpcy5faG92ZXJTdGF0ZSAgICAgPSBudWxsXG5cbiAgICAgICAgICAkKHRoaXMuZWxlbWVudCkudHJpZ2dlcih0aGlzLmNvbnN0cnVjdG9yLkV2ZW50LlNIT1dOKVxuXG4gICAgICAgICAgaWYgKHByZXZIb3ZlclN0YXRlID09PSBIb3ZlclN0YXRlLk9VVCkge1xuICAgICAgICAgICAgdGhpcy5fbGVhdmUobnVsbCwgdGhpcylcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoJCh0aGlzLnRpcCkuaGFzQ2xhc3MoQ2xhc3NOYW1lLkZBREUpKSB7XG4gICAgICAgICAgY29uc3QgdHJhbnNpdGlvbkR1cmF0aW9uID0gVXRpbC5nZXRUcmFuc2l0aW9uRHVyYXRpb25Gcm9tRWxlbWVudCh0aGlzLnRpcClcblxuICAgICAgICAgICQodGhpcy50aXApXG4gICAgICAgICAgICAub25lKFV0aWwuVFJBTlNJVElPTl9FTkQsIGNvbXBsZXRlKVxuICAgICAgICAgICAgLmVtdWxhdGVUcmFuc2l0aW9uRW5kKHRyYW5zaXRpb25EdXJhdGlvbilcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb21wbGV0ZSgpXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBoaWRlKGNhbGxiYWNrKSB7XG4gICAgICBjb25zdCB0aXAgICAgICAgPSB0aGlzLmdldFRpcEVsZW1lbnQoKVxuICAgICAgY29uc3QgaGlkZUV2ZW50ID0gJC5FdmVudCh0aGlzLmNvbnN0cnVjdG9yLkV2ZW50LkhJREUpXG4gICAgICBjb25zdCBjb21wbGV0ZSA9ICgpID0+IHtcbiAgICAgICAgaWYgKHRoaXMuX2hvdmVyU3RhdGUgIT09IEhvdmVyU3RhdGUuU0hPVyAmJiB0aXAucGFyZW50Tm9kZSkge1xuICAgICAgICAgIHRpcC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRpcClcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuX2NsZWFuVGlwQ2xhc3MoKVxuICAgICAgICB0aGlzLmVsZW1lbnQucmVtb3ZlQXR0cmlidXRlKCdhcmlhLWRlc2NyaWJlZGJ5JylcbiAgICAgICAgJCh0aGlzLmVsZW1lbnQpLnRyaWdnZXIodGhpcy5jb25zdHJ1Y3Rvci5FdmVudC5ISURERU4pXG4gICAgICAgIGlmICh0aGlzLl9wb3BwZXIgIT09IG51bGwpIHtcbiAgICAgICAgICB0aGlzLl9wb3BwZXIuZGVzdHJveSgpXG4gICAgICAgIH1cblxuICAgICAgICBpZiAoY2FsbGJhY2spIHtcbiAgICAgICAgICBjYWxsYmFjaygpXG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgJCh0aGlzLmVsZW1lbnQpLnRyaWdnZXIoaGlkZUV2ZW50KVxuXG4gICAgICBpZiAoaGlkZUV2ZW50LmlzRGVmYXVsdFByZXZlbnRlZCgpKSB7XG4gICAgICAgIHJldHVyblxuICAgICAgfVxuXG4gICAgICAkKHRpcCkucmVtb3ZlQ2xhc3MoQ2xhc3NOYW1lLlNIT1cpXG5cbiAgICAgIC8vIElmIHRoaXMgaXMgYSB0b3VjaC1lbmFibGVkIGRldmljZSB3ZSByZW1vdmUgdGhlIGV4dHJhXG4gICAgICAvLyBlbXB0eSBtb3VzZW92ZXIgbGlzdGVuZXJzIHdlIGFkZGVkIGZvciBpT1Mgc3VwcG9ydFxuICAgICAgaWYgKCdvbnRvdWNoc3RhcnQnIGluIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCkge1xuICAgICAgICAkKGRvY3VtZW50LmJvZHkpLmNoaWxkcmVuKCkub2ZmKCdtb3VzZW92ZXInLCBudWxsLCAkLm5vb3ApXG4gICAgICB9XG5cbiAgICAgIHRoaXMuX2FjdGl2ZVRyaWdnZXJbVHJpZ2dlci5DTElDS10gPSBmYWxzZVxuICAgICAgdGhpcy5fYWN0aXZlVHJpZ2dlcltUcmlnZ2VyLkZPQ1VTXSA9IGZhbHNlXG4gICAgICB0aGlzLl9hY3RpdmVUcmlnZ2VyW1RyaWdnZXIuSE9WRVJdID0gZmFsc2VcblxuICAgICAgaWYgKCQodGhpcy50aXApLmhhc0NsYXNzKENsYXNzTmFtZS5GQURFKSkge1xuICAgICAgICBjb25zdCB0cmFuc2l0aW9uRHVyYXRpb24gPSBVdGlsLmdldFRyYW5zaXRpb25EdXJhdGlvbkZyb21FbGVtZW50KHRpcClcblxuICAgICAgICAkKHRpcClcbiAgICAgICAgICAub25lKFV0aWwuVFJBTlNJVElPTl9FTkQsIGNvbXBsZXRlKVxuICAgICAgICAgIC5lbXVsYXRlVHJhbnNpdGlvbkVuZCh0cmFuc2l0aW9uRHVyYXRpb24pXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb21wbGV0ZSgpXG4gICAgICB9XG5cbiAgICAgIHRoaXMuX2hvdmVyU3RhdGUgPSAnJ1xuICAgIH1cblxuICAgIHVwZGF0ZSgpIHtcbiAgICAgIGlmICh0aGlzLl9wb3BwZXIgIT09IG51bGwpIHtcbiAgICAgICAgdGhpcy5fcG9wcGVyLnNjaGVkdWxlVXBkYXRlKClcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBQcm90ZWN0ZWRcblxuICAgIGlzV2l0aENvbnRlbnQoKSB7XG4gICAgICByZXR1cm4gQm9vbGVhbih0aGlzLmdldFRpdGxlKCkpXG4gICAgfVxuXG4gICAgYWRkQXR0YWNobWVudENsYXNzKGF0dGFjaG1lbnQpIHtcbiAgICAgICQodGhpcy5nZXRUaXBFbGVtZW50KCkpLmFkZENsYXNzKGAke0NMQVNTX1BSRUZJWH0tJHthdHRhY2htZW50fWApXG4gICAgfVxuXG4gICAgZ2V0VGlwRWxlbWVudCgpIHtcbiAgICAgIHRoaXMudGlwID0gdGhpcy50aXAgfHwgJCh0aGlzLmNvbmZpZy50ZW1wbGF0ZSlbMF1cbiAgICAgIHJldHVybiB0aGlzLnRpcFxuICAgIH1cblxuICAgIHNldENvbnRlbnQoKSB7XG4gICAgICBjb25zdCB0aXAgPSB0aGlzLmdldFRpcEVsZW1lbnQoKVxuICAgICAgdGhpcy5zZXRFbGVtZW50Q29udGVudCgkKHRpcC5xdWVyeVNlbGVjdG9yQWxsKFNlbGVjdG9yLlRPT0xUSVBfSU5ORVIpKSwgdGhpcy5nZXRUaXRsZSgpKVxuICAgICAgJCh0aXApLnJlbW92ZUNsYXNzKGAke0NsYXNzTmFtZS5GQURFfSAke0NsYXNzTmFtZS5TSE9XfWApXG4gICAgfVxuXG4gICAgc2V0RWxlbWVudENvbnRlbnQoJGVsZW1lbnQsIGNvbnRlbnQpIHtcbiAgICAgIGNvbnN0IGh0bWwgPSB0aGlzLmNvbmZpZy5odG1sXG4gICAgICBpZiAodHlwZW9mIGNvbnRlbnQgPT09ICdvYmplY3QnICYmIChjb250ZW50Lm5vZGVUeXBlIHx8IGNvbnRlbnQuanF1ZXJ5KSkge1xuICAgICAgICAvLyBDb250ZW50IGlzIGEgRE9NIG5vZGUgb3IgYSBqUXVlcnlcbiAgICAgICAgaWYgKGh0bWwpIHtcbiAgICAgICAgICBpZiAoISQoY29udGVudCkucGFyZW50KCkuaXMoJGVsZW1lbnQpKSB7XG4gICAgICAgICAgICAkZWxlbWVudC5lbXB0eSgpLmFwcGVuZChjb250ZW50KVxuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAkZWxlbWVudC50ZXh0KCQoY29udGVudCkudGV4dCgpKVxuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAkZWxlbWVudFtodG1sID8gJ2h0bWwnIDogJ3RleHQnXShjb250ZW50KVxuICAgICAgfVxuICAgIH1cblxuICAgIGdldFRpdGxlKCkge1xuICAgICAgbGV0IHRpdGxlID0gdGhpcy5lbGVtZW50LmdldEF0dHJpYnV0ZSgnZGF0YS1vcmlnaW5hbC10aXRsZScpXG5cbiAgICAgIGlmICghdGl0bGUpIHtcbiAgICAgICAgdGl0bGUgPSB0eXBlb2YgdGhpcy5jb25maWcudGl0bGUgPT09ICdmdW5jdGlvbidcbiAgICAgICAgICA/IHRoaXMuY29uZmlnLnRpdGxlLmNhbGwodGhpcy5lbGVtZW50KVxuICAgICAgICAgIDogdGhpcy5jb25maWcudGl0bGVcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHRpdGxlXG4gICAgfVxuXG4gICAgLy8gUHJpdmF0ZVxuXG4gICAgX2dldEF0dGFjaG1lbnQocGxhY2VtZW50KSB7XG4gICAgICByZXR1cm4gQXR0YWNobWVudE1hcFtwbGFjZW1lbnQudG9VcHBlckNhc2UoKV1cbiAgICB9XG5cbiAgICBfc2V0TGlzdGVuZXJzKCkge1xuICAgICAgY29uc3QgdHJpZ2dlcnMgPSB0aGlzLmNvbmZpZy50cmlnZ2VyLnNwbGl0KCcgJylcblxuICAgICAgdHJpZ2dlcnMuZm9yRWFjaCgodHJpZ2dlcikgPT4ge1xuICAgICAgICBpZiAodHJpZ2dlciA9PT0gJ2NsaWNrJykge1xuICAgICAgICAgICQodGhpcy5lbGVtZW50KS5vbihcbiAgICAgICAgICAgIHRoaXMuY29uc3RydWN0b3IuRXZlbnQuQ0xJQ0ssXG4gICAgICAgICAgICB0aGlzLmNvbmZpZy5zZWxlY3RvcixcbiAgICAgICAgICAgIChldmVudCkgPT4gdGhpcy50b2dnbGUoZXZlbnQpXG4gICAgICAgICAgKVxuICAgICAgICB9IGVsc2UgaWYgKHRyaWdnZXIgIT09IFRyaWdnZXIuTUFOVUFMKSB7XG4gICAgICAgICAgY29uc3QgZXZlbnRJbiA9IHRyaWdnZXIgPT09IFRyaWdnZXIuSE9WRVJcbiAgICAgICAgICAgID8gdGhpcy5jb25zdHJ1Y3Rvci5FdmVudC5NT1VTRUVOVEVSXG4gICAgICAgICAgICA6IHRoaXMuY29uc3RydWN0b3IuRXZlbnQuRk9DVVNJTlxuICAgICAgICAgIGNvbnN0IGV2ZW50T3V0ID0gdHJpZ2dlciA9PT0gVHJpZ2dlci5IT1ZFUlxuICAgICAgICAgICAgPyB0aGlzLmNvbnN0cnVjdG9yLkV2ZW50Lk1PVVNFTEVBVkVcbiAgICAgICAgICAgIDogdGhpcy5jb25zdHJ1Y3Rvci5FdmVudC5GT0NVU09VVFxuXG4gICAgICAgICAgJCh0aGlzLmVsZW1lbnQpXG4gICAgICAgICAgICAub24oXG4gICAgICAgICAgICAgIGV2ZW50SW4sXG4gICAgICAgICAgICAgIHRoaXMuY29uZmlnLnNlbGVjdG9yLFxuICAgICAgICAgICAgICAoZXZlbnQpID0+IHRoaXMuX2VudGVyKGV2ZW50KVxuICAgICAgICAgICAgKVxuICAgICAgICAgICAgLm9uKFxuICAgICAgICAgICAgICBldmVudE91dCxcbiAgICAgICAgICAgICAgdGhpcy5jb25maWcuc2VsZWN0b3IsXG4gICAgICAgICAgICAgIChldmVudCkgPT4gdGhpcy5fbGVhdmUoZXZlbnQpXG4gICAgICAgICAgICApXG4gICAgICAgIH1cblxuICAgICAgICAkKHRoaXMuZWxlbWVudCkuY2xvc2VzdCgnLm1vZGFsJykub24oXG4gICAgICAgICAgJ2hpZGUuYnMubW9kYWwnLFxuICAgICAgICAgICgpID0+IHRoaXMuaGlkZSgpXG4gICAgICAgIClcbiAgICAgIH0pXG5cbiAgICAgIGlmICh0aGlzLmNvbmZpZy5zZWxlY3Rvcikge1xuICAgICAgICB0aGlzLmNvbmZpZyA9IHtcbiAgICAgICAgICAuLi50aGlzLmNvbmZpZyxcbiAgICAgICAgICB0cmlnZ2VyOiAnbWFudWFsJyxcbiAgICAgICAgICBzZWxlY3RvcjogJydcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5fZml4VGl0bGUoKVxuICAgICAgfVxuICAgIH1cblxuICAgIF9maXhUaXRsZSgpIHtcbiAgICAgIGNvbnN0IHRpdGxlVHlwZSA9IHR5cGVvZiB0aGlzLmVsZW1lbnQuZ2V0QXR0cmlidXRlKCdkYXRhLW9yaWdpbmFsLXRpdGxlJylcbiAgICAgIGlmICh0aGlzLmVsZW1lbnQuZ2V0QXR0cmlidXRlKCd0aXRsZScpIHx8XG4gICAgICAgICB0aXRsZVR5cGUgIT09ICdzdHJpbmcnKSB7XG4gICAgICAgIHRoaXMuZWxlbWVudC5zZXRBdHRyaWJ1dGUoXG4gICAgICAgICAgJ2RhdGEtb3JpZ2luYWwtdGl0bGUnLFxuICAgICAgICAgIHRoaXMuZWxlbWVudC5nZXRBdHRyaWJ1dGUoJ3RpdGxlJykgfHwgJydcbiAgICAgICAgKVxuICAgICAgICB0aGlzLmVsZW1lbnQuc2V0QXR0cmlidXRlKCd0aXRsZScsICcnKVxuICAgICAgfVxuICAgIH1cblxuICAgIF9lbnRlcihldmVudCwgY29udGV4dCkge1xuICAgICAgY29uc3QgZGF0YUtleSA9IHRoaXMuY29uc3RydWN0b3IuREFUQV9LRVlcblxuICAgICAgY29udGV4dCA9IGNvbnRleHQgfHwgJChldmVudC5jdXJyZW50VGFyZ2V0KS5kYXRhKGRhdGFLZXkpXG5cbiAgICAgIGlmICghY29udGV4dCkge1xuICAgICAgICBjb250ZXh0ID0gbmV3IHRoaXMuY29uc3RydWN0b3IoXG4gICAgICAgICAgZXZlbnQuY3VycmVudFRhcmdldCxcbiAgICAgICAgICB0aGlzLl9nZXREZWxlZ2F0ZUNvbmZpZygpXG4gICAgICAgIClcbiAgICAgICAgJChldmVudC5jdXJyZW50VGFyZ2V0KS5kYXRhKGRhdGFLZXksIGNvbnRleHQpXG4gICAgICB9XG5cbiAgICAgIGlmIChldmVudCkge1xuICAgICAgICBjb250ZXh0Ll9hY3RpdmVUcmlnZ2VyW1xuICAgICAgICAgIGV2ZW50LnR5cGUgPT09ICdmb2N1c2luJyA/IFRyaWdnZXIuRk9DVVMgOiBUcmlnZ2VyLkhPVkVSXG4gICAgICAgIF0gPSB0cnVlXG4gICAgICB9XG5cbiAgICAgIGlmICgkKGNvbnRleHQuZ2V0VGlwRWxlbWVudCgpKS5oYXNDbGFzcyhDbGFzc05hbWUuU0hPVykgfHxcbiAgICAgICAgIGNvbnRleHQuX2hvdmVyU3RhdGUgPT09IEhvdmVyU3RhdGUuU0hPVykge1xuICAgICAgICBjb250ZXh0Ll9ob3ZlclN0YXRlID0gSG92ZXJTdGF0ZS5TSE9XXG4gICAgICAgIHJldHVyblxuICAgICAgfVxuXG4gICAgICBjbGVhclRpbWVvdXQoY29udGV4dC5fdGltZW91dClcblxuICAgICAgY29udGV4dC5faG92ZXJTdGF0ZSA9IEhvdmVyU3RhdGUuU0hPV1xuXG4gICAgICBpZiAoIWNvbnRleHQuY29uZmlnLmRlbGF5IHx8ICFjb250ZXh0LmNvbmZpZy5kZWxheS5zaG93KSB7XG4gICAgICAgIGNvbnRleHQuc2hvdygpXG4gICAgICAgIHJldHVyblxuICAgICAgfVxuXG4gICAgICBjb250ZXh0Ll90aW1lb3V0ID0gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIGlmIChjb250ZXh0Ll9ob3ZlclN0YXRlID09PSBIb3ZlclN0YXRlLlNIT1cpIHtcbiAgICAgICAgICBjb250ZXh0LnNob3coKVxuICAgICAgICB9XG4gICAgICB9LCBjb250ZXh0LmNvbmZpZy5kZWxheS5zaG93KVxuICAgIH1cblxuICAgIF9sZWF2ZShldmVudCwgY29udGV4dCkge1xuICAgICAgY29uc3QgZGF0YUtleSA9IHRoaXMuY29uc3RydWN0b3IuREFUQV9LRVlcblxuICAgICAgY29udGV4dCA9IGNvbnRleHQgfHwgJChldmVudC5jdXJyZW50VGFyZ2V0KS5kYXRhKGRhdGFLZXkpXG5cbiAgICAgIGlmICghY29udGV4dCkge1xuICAgICAgICBjb250ZXh0ID0gbmV3IHRoaXMuY29uc3RydWN0b3IoXG4gICAgICAgICAgZXZlbnQuY3VycmVudFRhcmdldCxcbiAgICAgICAgICB0aGlzLl9nZXREZWxlZ2F0ZUNvbmZpZygpXG4gICAgICAgIClcbiAgICAgICAgJChldmVudC5jdXJyZW50VGFyZ2V0KS5kYXRhKGRhdGFLZXksIGNvbnRleHQpXG4gICAgICB9XG5cbiAgICAgIGlmIChldmVudCkge1xuICAgICAgICBjb250ZXh0Ll9hY3RpdmVUcmlnZ2VyW1xuICAgICAgICAgIGV2ZW50LnR5cGUgPT09ICdmb2N1c291dCcgPyBUcmlnZ2VyLkZPQ1VTIDogVHJpZ2dlci5IT1ZFUlxuICAgICAgICBdID0gZmFsc2VcbiAgICAgIH1cblxuICAgICAgaWYgKGNvbnRleHQuX2lzV2l0aEFjdGl2ZVRyaWdnZXIoKSkge1xuICAgICAgICByZXR1cm5cbiAgICAgIH1cblxuICAgICAgY2xlYXJUaW1lb3V0KGNvbnRleHQuX3RpbWVvdXQpXG5cbiAgICAgIGNvbnRleHQuX2hvdmVyU3RhdGUgPSBIb3ZlclN0YXRlLk9VVFxuXG4gICAgICBpZiAoIWNvbnRleHQuY29uZmlnLmRlbGF5IHx8ICFjb250ZXh0LmNvbmZpZy5kZWxheS5oaWRlKSB7XG4gICAgICAgIGNvbnRleHQuaGlkZSgpXG4gICAgICAgIHJldHVyblxuICAgICAgfVxuXG4gICAgICBjb250ZXh0Ll90aW1lb3V0ID0gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIGlmIChjb250ZXh0Ll9ob3ZlclN0YXRlID09PSBIb3ZlclN0YXRlLk9VVCkge1xuICAgICAgICAgIGNvbnRleHQuaGlkZSgpXG4gICAgICAgIH1cbiAgICAgIH0sIGNvbnRleHQuY29uZmlnLmRlbGF5LmhpZGUpXG4gICAgfVxuXG4gICAgX2lzV2l0aEFjdGl2ZVRyaWdnZXIoKSB7XG4gICAgICBmb3IgKGNvbnN0IHRyaWdnZXIgaW4gdGhpcy5fYWN0aXZlVHJpZ2dlcikge1xuICAgICAgICBpZiAodGhpcy5fYWN0aXZlVHJpZ2dlclt0cmlnZ2VyXSkge1xuICAgICAgICAgIHJldHVybiB0cnVlXG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGZhbHNlXG4gICAgfVxuXG4gICAgX2dldENvbmZpZyhjb25maWcpIHtcbiAgICAgIGNvbmZpZyA9IHtcbiAgICAgICAgLi4udGhpcy5jb25zdHJ1Y3Rvci5EZWZhdWx0LFxuICAgICAgICAuLi4kKHRoaXMuZWxlbWVudCkuZGF0YSgpLFxuICAgICAgICAuLi50eXBlb2YgY29uZmlnID09PSAnb2JqZWN0JyAmJiBjb25maWcgPyBjb25maWcgOiB7fVxuICAgICAgfVxuXG4gICAgICBpZiAodHlwZW9mIGNvbmZpZy5kZWxheSA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgY29uZmlnLmRlbGF5ID0ge1xuICAgICAgICAgIHNob3c6IGNvbmZpZy5kZWxheSxcbiAgICAgICAgICBoaWRlOiBjb25maWcuZGVsYXlcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAodHlwZW9mIGNvbmZpZy50aXRsZSA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgY29uZmlnLnRpdGxlID0gY29uZmlnLnRpdGxlLnRvU3RyaW5nKClcbiAgICAgIH1cblxuICAgICAgaWYgKHR5cGVvZiBjb25maWcuY29udGVudCA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgY29uZmlnLmNvbnRlbnQgPSBjb25maWcuY29udGVudC50b1N0cmluZygpXG4gICAgICB9XG5cbiAgICAgIFV0aWwudHlwZUNoZWNrQ29uZmlnKFxuICAgICAgICBOQU1FLFxuICAgICAgICBjb25maWcsXG4gICAgICAgIHRoaXMuY29uc3RydWN0b3IuRGVmYXVsdFR5cGVcbiAgICAgIClcblxuICAgICAgcmV0dXJuIGNvbmZpZ1xuICAgIH1cblxuICAgIF9nZXREZWxlZ2F0ZUNvbmZpZygpIHtcbiAgICAgIGNvbnN0IGNvbmZpZyA9IHt9XG5cbiAgICAgIGlmICh0aGlzLmNvbmZpZykge1xuICAgICAgICBmb3IgKGNvbnN0IGtleSBpbiB0aGlzLmNvbmZpZykge1xuICAgICAgICAgIGlmICh0aGlzLmNvbnN0cnVjdG9yLkRlZmF1bHRba2V5XSAhPT0gdGhpcy5jb25maWdba2V5XSkge1xuICAgICAgICAgICAgY29uZmlnW2tleV0gPSB0aGlzLmNvbmZpZ1trZXldXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBjb25maWdcbiAgICB9XG5cbiAgICBfY2xlYW5UaXBDbGFzcygpIHtcbiAgICAgIGNvbnN0ICR0aXAgPSAkKHRoaXMuZ2V0VGlwRWxlbWVudCgpKVxuICAgICAgY29uc3QgdGFiQ2xhc3MgPSAkdGlwLmF0dHIoJ2NsYXNzJykubWF0Y2goQlNDTFNfUFJFRklYX1JFR0VYKVxuICAgICAgaWYgKHRhYkNsYXNzICE9PSBudWxsICYmIHRhYkNsYXNzLmxlbmd0aCkge1xuICAgICAgICAkdGlwLnJlbW92ZUNsYXNzKHRhYkNsYXNzLmpvaW4oJycpKVxuICAgICAgfVxuICAgIH1cblxuICAgIF9oYW5kbGVQb3BwZXJQbGFjZW1lbnRDaGFuZ2UocG9wcGVyRGF0YSkge1xuICAgICAgY29uc3QgcG9wcGVySW5zdGFuY2UgPSBwb3BwZXJEYXRhLmluc3RhbmNlXG4gICAgICB0aGlzLnRpcCA9IHBvcHBlckluc3RhbmNlLnBvcHBlclxuICAgICAgdGhpcy5fY2xlYW5UaXBDbGFzcygpXG4gICAgICB0aGlzLmFkZEF0dGFjaG1lbnRDbGFzcyh0aGlzLl9nZXRBdHRhY2htZW50KHBvcHBlckRhdGEucGxhY2VtZW50KSlcbiAgICB9XG5cbiAgICBfZml4VHJhbnNpdGlvbigpIHtcbiAgICAgIGNvbnN0IHRpcCA9IHRoaXMuZ2V0VGlwRWxlbWVudCgpXG4gICAgICBjb25zdCBpbml0Q29uZmlnQW5pbWF0aW9uID0gdGhpcy5jb25maWcuYW5pbWF0aW9uXG4gICAgICBpZiAodGlwLmdldEF0dHJpYnV0ZSgneC1wbGFjZW1lbnQnKSAhPT0gbnVsbCkge1xuICAgICAgICByZXR1cm5cbiAgICAgIH1cbiAgICAgICQodGlwKS5yZW1vdmVDbGFzcyhDbGFzc05hbWUuRkFERSlcbiAgICAgIHRoaXMuY29uZmlnLmFuaW1hdGlvbiA9IGZhbHNlXG4gICAgICB0aGlzLmhpZGUoKVxuICAgICAgdGhpcy5zaG93KClcbiAgICAgIHRoaXMuY29uZmlnLmFuaW1hdGlvbiA9IGluaXRDb25maWdBbmltYXRpb25cbiAgICB9XG5cbiAgICAvLyBTdGF0aWNcblxuICAgIHN0YXRpYyBfalF1ZXJ5SW50ZXJmYWNlKGNvbmZpZykge1xuICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgIGxldCBkYXRhID0gJCh0aGlzKS5kYXRhKERBVEFfS0VZKVxuICAgICAgICBjb25zdCBfY29uZmlnID0gdHlwZW9mIGNvbmZpZyA9PT0gJ29iamVjdCcgJiYgY29uZmlnXG5cbiAgICAgICAgaWYgKCFkYXRhICYmIC9kaXNwb3NlfGhpZGUvLnRlc3QoY29uZmlnKSkge1xuICAgICAgICAgIHJldHVyblxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCFkYXRhKSB7XG4gICAgICAgICAgZGF0YSA9IG5ldyBUb29sdGlwKHRoaXMsIF9jb25maWcpXG4gICAgICAgICAgJCh0aGlzKS5kYXRhKERBVEFfS0VZLCBkYXRhKVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHR5cGVvZiBjb25maWcgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgaWYgKHR5cGVvZiBkYXRhW2NvbmZpZ10gPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKGBObyBtZXRob2QgbmFtZWQgXCIke2NvbmZpZ31cImApXG4gICAgICAgICAgfVxuICAgICAgICAgIGRhdGFbY29uZmlnXSgpXG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgKiBqUXVlcnlcbiAgICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAqL1xuXG4gICQuZm5bTkFNRV0gPSBUb29sdGlwLl9qUXVlcnlJbnRlcmZhY2VcbiAgJC5mbltOQU1FXS5Db25zdHJ1Y3RvciA9IFRvb2x0aXBcbiAgJC5mbltOQU1FXS5ub0NvbmZsaWN0ID0gZnVuY3Rpb24gKCkge1xuICAgICQuZm5bTkFNRV0gPSBKUVVFUllfTk9fQ09ORkxJQ1RcbiAgICByZXR1cm4gVG9vbHRpcC5falF1ZXJ5SW50ZXJmYWNlXG4gIH1cblxuICByZXR1cm4gVG9vbHRpcFxufSkoJCwgUG9wcGVyKVxuXG5leHBvcnQgZGVmYXVsdCBUb29sdGlwXG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///b625c3d07db8baf045ff\n");

/***/ }),

/***/ "bcb63a5837345ee29aa0":
/*!*********************************************************!*\
  !*** ./node_modules/little-loader/lib/little-loader.js ***!
  \*********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("/**\n * Script loading is difficult thanks to IE. We need callbacks to fire\n * immediately following the script's execution, with no other scripts\n * running in between. If other scripts on the page are able to run\n * between our script and its callback, bad things can happen, such as\n * `jQuery.noConflict` not being called in time, resulting in plugins\n * latching onto our version of jQuery, etc.\n *\n * For IE<10 we use a relatively well-documented \"preloading\" strategy,\n * which ensures that the script is ready to execute *before* appending\n * it to the DOM. That way when it is finally appended, it is\n * executed immediately.\n *\n * References:\n * - http://www.html5rocks.com/en/tutorials/speed/script-loading/\n * - http://blog.getify.com/ie11-please-bring-real-script-preloading-back/\n * - https://github.com/jrburke/requirejs/issues/526\n * - https://connect.microsoft.com/IE/feedback/details/729164/\n *           ie10-dynamic-script-element-fires-loaded-readystate-prematurely\n */\n(function () {\n\n  // Global state.\n  var pendingScripts = {};\n  var scriptCounter = 0;\n\n  /**\n   * Insert script into the DOM\n   *\n   * @param {Object} script Script DOM object\n   * @returns {void}\n   */\n  var _addScript = function (script) {\n    // Get the first script element, we're just going to use it\n    // as a reference for where to insert ours. Do NOT try to do\n    // this just once at the top and then re-use the same script\n    // as a reference later. Some weird loaders *remove* script\n    // elements after the browser has executed their contents,\n    // so the same reference might not have a parentNode later.\n    var firstScript = document.getElementsByTagName(\"script\")[0];\n\n    // Append the script to the DOM, triggering execution.\n    firstScript.parentNode.insertBefore(script, firstScript);\n  };\n\n  /**\n   * Load Script.\n   *\n   * @param {String}            src       URI of script\n   * @param {Function|Object}   callback  (Optional) Called on script load completion,\n   *                                      or options object\n   * @param {Object}            context   (Optional) Callback context (`this`)\n   * @returns {void}\n   */\n  var _lload = function (src, callback, context) {\n    /*eslint max-statements: [2, 32]*/\n    var setup;\n\n    if (callback && typeof callback !== \"function\") {\n      context = callback.context || context;\n      setup = callback.setup;\n      callback = callback.callback;\n    }\n\n    var script = document.createElement(\"script\");\n    var done = false;\n    var err;\n    var _cleanup; // _must_ be set below.\n\n    /**\n     * Final handler for error or completion.\n     *\n     * **Note**: Will only be called _once_.\n     *\n     * @returns {void}\n     */\n    var _finish = function () {\n      // Only call once.\n      if (done) { return; }\n      done = true;\n\n      // Internal cleanup.\n      _cleanup();\n\n      // Callback.\n      if (callback) {\n        callback.call(context, err);\n      }\n    };\n\n    /**\n     * Error handler\n     *\n     * @returns {void}\n     */\n    var _error = function () {\n      err = new Error(src || \"EMPTY\");\n      _finish();\n    };\n\n    if (script.readyState && !(\"async\" in script)) {\n      /*eslint-disable consistent-return*/\n\n      // This section is only for IE<10. Some other old browsers may\n      // satisfy the above condition and enter this branch, but we don't\n      // support those browsers anyway.\n\n      var id = scriptCounter++;\n      var isReady = { loaded: true, complete: true };\n      var inserted = false;\n\n      // Clear out listeners, state.\n      _cleanup = function () {\n        script.onreadystatechange = script.onerror = null;\n        pendingScripts[id] = void 0;\n      };\n\n      // Attach the handler before setting src, otherwise we might\n      // miss events (consider that IE could fire them synchronously\n      // upon setting src, for example).\n      script.onreadystatechange = function () {\n        var firstState = script.readyState;\n\n        // Protect against any errors from state change randomness.\n        if (err) { return; }\n\n        if (!inserted && isReady[firstState]) {\n          inserted = true;\n\n          // Append to DOM.\n          _addScript(script);\n        }\n\n        // --------------------------------------------------------------------\n        //                       GLORIOUS IE8 HACKAGE!!!\n        // --------------------------------------------------------------------\n        //\n        // Oh IE8, how you disappoint. IE8 won't call `script.onerror`, so\n        // we have to resort to drastic measures.\n        // See, e.g. http://www.quirksmode.org/dom/events/error.html#t02\n        //\n        // As with all things development, there's a Stack Overflow comment that\n        // asserts the following combinations of state changes in IE8 indicate a\n        // script load error. And crazily, it seems to work!\n        //\n        // http://stackoverflow.com/a/18840568/741892\n        //\n        // The `script.readyState` transitions we're interested are:\n        //\n        // * If state starts as `loaded`\n        // * Call `script.children`, which _should_ change state to `complete`\n        // * If state is now `loading`, then **we have a load error**\n        //\n        // For the reader's amusement, here is HeadJS's catalog of various\n        // `readyState` transitions in normal operation for IE:\n        // https://github.com/headjs/headjs/blob/master/src/2.0.0/load.js#L379-L419\n        if (firstState === \"loaded\") {\n          // The act of accessing the property should change the script's\n          // `readyState`.\n          //\n          // And, oh yeah, this hack is so hacky-ish we need the following\n          // eslint disable...\n          /*eslint-disable no-unused-expressions*/\n          script.children;\n          /*eslint-enable no-unused-expressions*/\n\n          if (script.readyState === \"loading\") {\n            // State transitions indicate we've hit the load error.\n            //\n            // **Note**: We are not intending to _return_ a value, just have\n            // a shorter short-circuit code path here.\n            return _error();\n          }\n        }\n\n        // It's possible for readyState to be \"complete\" immediately\n        // after we insert (and execute) the script in the branch\n        // above. So check readyState again here and react without\n        // waiting for another onreadystatechange.\n        if (script.readyState === \"complete\") {\n          _finish();\n        }\n      };\n\n      // Onerror handler _may_ work here.\n      script.onerror = _error;\n\n      // Since we're not appending the script to the DOM yet, the\n      // reference to our script element might get garbage collected\n      // when this function ends, without onreadystatechange ever being\n      // fired. This has been witnessed to happen. Adding it to\n      // `pendingScripts` ensures this can't happen.\n      pendingScripts[id] = script;\n\n      // call the setup callback to mutate the script tag\n      if (setup) {\n        setup.call(context, script);\n      }\n\n      // This triggers a request for the script, but its contents won't\n      // be executed until we append it to the DOM.\n      script.src = src;\n\n      // In some cases, the readyState is already \"loaded\" immediately\n      // after setting src. It's a lie! Don't append to the DOM until\n      // the onreadystatechange event says so.\n\n    } else {\n      // This section is for modern browsers, including IE10+.\n\n      // Clear out listeners.\n      _cleanup = function () {\n        script.onload = script.onerror = null;\n      };\n\n      script.onerror = _error;\n      script.onload = _finish;\n      script.async = true;\n      script.charset = \"utf-8\";\n\n      // call the setup callback to mutate the script tag\n      if (setup) {\n        setup.call(context, script);\n      }\n\n      script.src = src;\n\n      // Append to DOM.\n      _addScript(script);\n    }\n  };\n\n  // UMD wrapper.\n  /*global define:false*/\n  if (true) {\n    // CommonJS\n    module.exports = _lload;\n\n  } else {}\n}());\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmNiNjNhNTgzNzM0NWVlMjlhYTAuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvbGl0dGxlLWxvYWRlci9saWIvbGl0dGxlLWxvYWRlci5qcz85OGQ2Il0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogU2NyaXB0IGxvYWRpbmcgaXMgZGlmZmljdWx0IHRoYW5rcyB0byBJRS4gV2UgbmVlZCBjYWxsYmFja3MgdG8gZmlyZVxuICogaW1tZWRpYXRlbHkgZm9sbG93aW5nIHRoZSBzY3JpcHQncyBleGVjdXRpb24sIHdpdGggbm8gb3RoZXIgc2NyaXB0c1xuICogcnVubmluZyBpbiBiZXR3ZWVuLiBJZiBvdGhlciBzY3JpcHRzIG9uIHRoZSBwYWdlIGFyZSBhYmxlIHRvIHJ1blxuICogYmV0d2VlbiBvdXIgc2NyaXB0IGFuZCBpdHMgY2FsbGJhY2ssIGJhZCB0aGluZ3MgY2FuIGhhcHBlbiwgc3VjaCBhc1xuICogYGpRdWVyeS5ub0NvbmZsaWN0YCBub3QgYmVpbmcgY2FsbGVkIGluIHRpbWUsIHJlc3VsdGluZyBpbiBwbHVnaW5zXG4gKiBsYXRjaGluZyBvbnRvIG91ciB2ZXJzaW9uIG9mIGpRdWVyeSwgZXRjLlxuICpcbiAqIEZvciBJRTwxMCB3ZSB1c2UgYSByZWxhdGl2ZWx5IHdlbGwtZG9jdW1lbnRlZCBcInByZWxvYWRpbmdcIiBzdHJhdGVneSxcbiAqIHdoaWNoIGVuc3VyZXMgdGhhdCB0aGUgc2NyaXB0IGlzIHJlYWR5IHRvIGV4ZWN1dGUgKmJlZm9yZSogYXBwZW5kaW5nXG4gKiBpdCB0byB0aGUgRE9NLiBUaGF0IHdheSB3aGVuIGl0IGlzIGZpbmFsbHkgYXBwZW5kZWQsIGl0IGlzXG4gKiBleGVjdXRlZCBpbW1lZGlhdGVseS5cbiAqXG4gKiBSZWZlcmVuY2VzOlxuICogLSBodHRwOi8vd3d3Lmh0bWw1cm9ja3MuY29tL2VuL3R1dG9yaWFscy9zcGVlZC9zY3JpcHQtbG9hZGluZy9cbiAqIC0gaHR0cDovL2Jsb2cuZ2V0aWZ5LmNvbS9pZTExLXBsZWFzZS1icmluZy1yZWFsLXNjcmlwdC1wcmVsb2FkaW5nLWJhY2svXG4gKiAtIGh0dHBzOi8vZ2l0aHViLmNvbS9qcmJ1cmtlL3JlcXVpcmVqcy9pc3N1ZXMvNTI2XG4gKiAtIGh0dHBzOi8vY29ubmVjdC5taWNyb3NvZnQuY29tL0lFL2ZlZWRiYWNrL2RldGFpbHMvNzI5MTY0L1xuICogICAgICAgICAgIGllMTAtZHluYW1pYy1zY3JpcHQtZWxlbWVudC1maXJlcy1sb2FkZWQtcmVhZHlzdGF0ZS1wcmVtYXR1cmVseVxuICovXG4oZnVuY3Rpb24gKCkge1xuXG4gIC8vIEdsb2JhbCBzdGF0ZS5cbiAgdmFyIHBlbmRpbmdTY3JpcHRzID0ge307XG4gIHZhciBzY3JpcHRDb3VudGVyID0gMDtcblxuICAvKipcbiAgICogSW5zZXJ0IHNjcmlwdCBpbnRvIHRoZSBET01cbiAgICpcbiAgICogQHBhcmFtIHtPYmplY3R9IHNjcmlwdCBTY3JpcHQgRE9NIG9iamVjdFxuICAgKiBAcmV0dXJucyB7dm9pZH1cbiAgICovXG4gIHZhciBfYWRkU2NyaXB0ID0gZnVuY3Rpb24gKHNjcmlwdCkge1xuICAgIC8vIEdldCB0aGUgZmlyc3Qgc2NyaXB0IGVsZW1lbnQsIHdlJ3JlIGp1c3QgZ29pbmcgdG8gdXNlIGl0XG4gICAgLy8gYXMgYSByZWZlcmVuY2UgZm9yIHdoZXJlIHRvIGluc2VydCBvdXJzLiBEbyBOT1QgdHJ5IHRvIGRvXG4gICAgLy8gdGhpcyBqdXN0IG9uY2UgYXQgdGhlIHRvcCBhbmQgdGhlbiByZS11c2UgdGhlIHNhbWUgc2NyaXB0XG4gICAgLy8gYXMgYSByZWZlcmVuY2UgbGF0ZXIuIFNvbWUgd2VpcmQgbG9hZGVycyAqcmVtb3ZlKiBzY3JpcHRcbiAgICAvLyBlbGVtZW50cyBhZnRlciB0aGUgYnJvd3NlciBoYXMgZXhlY3V0ZWQgdGhlaXIgY29udGVudHMsXG4gICAgLy8gc28gdGhlIHNhbWUgcmVmZXJlbmNlIG1pZ2h0IG5vdCBoYXZlIGEgcGFyZW50Tm9kZSBsYXRlci5cbiAgICB2YXIgZmlyc3RTY3JpcHQgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZShcInNjcmlwdFwiKVswXTtcblxuICAgIC8vIEFwcGVuZCB0aGUgc2NyaXB0IHRvIHRoZSBET00sIHRyaWdnZXJpbmcgZXhlY3V0aW9uLlxuICAgIGZpcnN0U2NyaXB0LnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKHNjcmlwdCwgZmlyc3RTY3JpcHQpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBMb2FkIFNjcmlwdC5cbiAgICpcbiAgICogQHBhcmFtIHtTdHJpbmd9ICAgICAgICAgICAgc3JjICAgICAgIFVSSSBvZiBzY3JpcHRcbiAgICogQHBhcmFtIHtGdW5jdGlvbnxPYmplY3R9ICAgY2FsbGJhY2sgIChPcHRpb25hbCkgQ2FsbGVkIG9uIHNjcmlwdCBsb2FkIGNvbXBsZXRpb24sXG4gICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvciBvcHRpb25zIG9iamVjdFxuICAgKiBAcGFyYW0ge09iamVjdH0gICAgICAgICAgICBjb250ZXh0ICAgKE9wdGlvbmFsKSBDYWxsYmFjayBjb250ZXh0IChgdGhpc2ApXG4gICAqIEByZXR1cm5zIHt2b2lkfVxuICAgKi9cbiAgdmFyIF9sbG9hZCA9IGZ1bmN0aW9uIChzcmMsIGNhbGxiYWNrLCBjb250ZXh0KSB7XG4gICAgLyplc2xpbnQgbWF4LXN0YXRlbWVudHM6IFsyLCAzMl0qL1xuICAgIHZhciBzZXR1cDtcblxuICAgIGlmIChjYWxsYmFjayAmJiB0eXBlb2YgY2FsbGJhY2sgIT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgY29udGV4dCA9IGNhbGxiYWNrLmNvbnRleHQgfHwgY29udGV4dDtcbiAgICAgIHNldHVwID0gY2FsbGJhY2suc2V0dXA7XG4gICAgICBjYWxsYmFjayA9IGNhbGxiYWNrLmNhbGxiYWNrO1xuICAgIH1cblxuICAgIHZhciBzY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic2NyaXB0XCIpO1xuICAgIHZhciBkb25lID0gZmFsc2U7XG4gICAgdmFyIGVycjtcbiAgICB2YXIgX2NsZWFudXA7IC8vIF9tdXN0XyBiZSBzZXQgYmVsb3cuXG5cbiAgICAvKipcbiAgICAgKiBGaW5hbCBoYW5kbGVyIGZvciBlcnJvciBvciBjb21wbGV0aW9uLlxuICAgICAqXG4gICAgICogKipOb3RlKio6IFdpbGwgb25seSBiZSBjYWxsZWQgX29uY2VfLlxuICAgICAqXG4gICAgICogQHJldHVybnMge3ZvaWR9XG4gICAgICovXG4gICAgdmFyIF9maW5pc2ggPSBmdW5jdGlvbiAoKSB7XG4gICAgICAvLyBPbmx5IGNhbGwgb25jZS5cbiAgICAgIGlmIChkb25lKSB7IHJldHVybjsgfVxuICAgICAgZG9uZSA9IHRydWU7XG5cbiAgICAgIC8vIEludGVybmFsIGNsZWFudXAuXG4gICAgICBfY2xlYW51cCgpO1xuXG4gICAgICAvLyBDYWxsYmFjay5cbiAgICAgIGlmIChjYWxsYmFjaykge1xuICAgICAgICBjYWxsYmFjay5jYWxsKGNvbnRleHQsIGVycik7XG4gICAgICB9XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEVycm9yIGhhbmRsZXJcbiAgICAgKlxuICAgICAqIEByZXR1cm5zIHt2b2lkfVxuICAgICAqL1xuICAgIHZhciBfZXJyb3IgPSBmdW5jdGlvbiAoKSB7XG4gICAgICBlcnIgPSBuZXcgRXJyb3Ioc3JjIHx8IFwiRU1QVFlcIik7XG4gICAgICBfZmluaXNoKCk7XG4gICAgfTtcblxuICAgIGlmIChzY3JpcHQucmVhZHlTdGF0ZSAmJiAhKFwiYXN5bmNcIiBpbiBzY3JpcHQpKSB7XG4gICAgICAvKmVzbGludC1kaXNhYmxlIGNvbnNpc3RlbnQtcmV0dXJuKi9cblxuICAgICAgLy8gVGhpcyBzZWN0aW9uIGlzIG9ubHkgZm9yIElFPDEwLiBTb21lIG90aGVyIG9sZCBicm93c2VycyBtYXlcbiAgICAgIC8vIHNhdGlzZnkgdGhlIGFib3ZlIGNvbmRpdGlvbiBhbmQgZW50ZXIgdGhpcyBicmFuY2gsIGJ1dCB3ZSBkb24ndFxuICAgICAgLy8gc3VwcG9ydCB0aG9zZSBicm93c2VycyBhbnl3YXkuXG5cbiAgICAgIHZhciBpZCA9IHNjcmlwdENvdW50ZXIrKztcbiAgICAgIHZhciBpc1JlYWR5ID0geyBsb2FkZWQ6IHRydWUsIGNvbXBsZXRlOiB0cnVlIH07XG4gICAgICB2YXIgaW5zZXJ0ZWQgPSBmYWxzZTtcblxuICAgICAgLy8gQ2xlYXIgb3V0IGxpc3RlbmVycywgc3RhdGUuXG4gICAgICBfY2xlYW51cCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgc2NyaXB0Lm9ucmVhZHlzdGF0ZWNoYW5nZSA9IHNjcmlwdC5vbmVycm9yID0gbnVsbDtcbiAgICAgICAgcGVuZGluZ1NjcmlwdHNbaWRdID0gdm9pZCAwO1xuICAgICAgfTtcblxuICAgICAgLy8gQXR0YWNoIHRoZSBoYW5kbGVyIGJlZm9yZSBzZXR0aW5nIHNyYywgb3RoZXJ3aXNlIHdlIG1pZ2h0XG4gICAgICAvLyBtaXNzIGV2ZW50cyAoY29uc2lkZXIgdGhhdCBJRSBjb3VsZCBmaXJlIHRoZW0gc3luY2hyb25vdXNseVxuICAgICAgLy8gdXBvbiBzZXR0aW5nIHNyYywgZm9yIGV4YW1wbGUpLlxuICAgICAgc2NyaXB0Lm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGZpcnN0U3RhdGUgPSBzY3JpcHQucmVhZHlTdGF0ZTtcblxuICAgICAgICAvLyBQcm90ZWN0IGFnYWluc3QgYW55IGVycm9ycyBmcm9tIHN0YXRlIGNoYW5nZSByYW5kb21uZXNzLlxuICAgICAgICBpZiAoZXJyKSB7IHJldHVybjsgfVxuXG4gICAgICAgIGlmICghaW5zZXJ0ZWQgJiYgaXNSZWFkeVtmaXJzdFN0YXRlXSkge1xuICAgICAgICAgIGluc2VydGVkID0gdHJ1ZTtcblxuICAgICAgICAgIC8vIEFwcGVuZCB0byBET00uXG4gICAgICAgICAgX2FkZFNjcmlwdChzY3JpcHQpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgICAgIEdMT1JJT1VTIElFOCBIQUNLQUdFISEhXG4gICAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgIC8vXG4gICAgICAgIC8vIE9oIElFOCwgaG93IHlvdSBkaXNhcHBvaW50LiBJRTggd29uJ3QgY2FsbCBgc2NyaXB0Lm9uZXJyb3JgLCBzb1xuICAgICAgICAvLyB3ZSBoYXZlIHRvIHJlc29ydCB0byBkcmFzdGljIG1lYXN1cmVzLlxuICAgICAgICAvLyBTZWUsIGUuZy4gaHR0cDovL3d3dy5xdWlya3Ntb2RlLm9yZy9kb20vZXZlbnRzL2Vycm9yLmh0bWwjdDAyXG4gICAgICAgIC8vXG4gICAgICAgIC8vIEFzIHdpdGggYWxsIHRoaW5ncyBkZXZlbG9wbWVudCwgdGhlcmUncyBhIFN0YWNrIE92ZXJmbG93IGNvbW1lbnQgdGhhdFxuICAgICAgICAvLyBhc3NlcnRzIHRoZSBmb2xsb3dpbmcgY29tYmluYXRpb25zIG9mIHN0YXRlIGNoYW5nZXMgaW4gSUU4IGluZGljYXRlIGFcbiAgICAgICAgLy8gc2NyaXB0IGxvYWQgZXJyb3IuIEFuZCBjcmF6aWx5LCBpdCBzZWVtcyB0byB3b3JrIVxuICAgICAgICAvL1xuICAgICAgICAvLyBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vYS8xODg0MDU2OC83NDE4OTJcbiAgICAgICAgLy9cbiAgICAgICAgLy8gVGhlIGBzY3JpcHQucmVhZHlTdGF0ZWAgdHJhbnNpdGlvbnMgd2UncmUgaW50ZXJlc3RlZCBhcmU6XG4gICAgICAgIC8vXG4gICAgICAgIC8vICogSWYgc3RhdGUgc3RhcnRzIGFzIGBsb2FkZWRgXG4gICAgICAgIC8vICogQ2FsbCBgc2NyaXB0LmNoaWxkcmVuYCwgd2hpY2ggX3Nob3VsZF8gY2hhbmdlIHN0YXRlIHRvIGBjb21wbGV0ZWBcbiAgICAgICAgLy8gKiBJZiBzdGF0ZSBpcyBub3cgYGxvYWRpbmdgLCB0aGVuICoqd2UgaGF2ZSBhIGxvYWQgZXJyb3IqKlxuICAgICAgICAvL1xuICAgICAgICAvLyBGb3IgdGhlIHJlYWRlcidzIGFtdXNlbWVudCwgaGVyZSBpcyBIZWFkSlMncyBjYXRhbG9nIG9mIHZhcmlvdXNcbiAgICAgICAgLy8gYHJlYWR5U3RhdGVgIHRyYW5zaXRpb25zIGluIG5vcm1hbCBvcGVyYXRpb24gZm9yIElFOlxuICAgICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vaGVhZGpzL2hlYWRqcy9ibG9iL21hc3Rlci9zcmMvMi4wLjAvbG9hZC5qcyNMMzc5LUw0MTlcbiAgICAgICAgaWYgKGZpcnN0U3RhdGUgPT09IFwibG9hZGVkXCIpIHtcbiAgICAgICAgICAvLyBUaGUgYWN0IG9mIGFjY2Vzc2luZyB0aGUgcHJvcGVydHkgc2hvdWxkIGNoYW5nZSB0aGUgc2NyaXB0J3NcbiAgICAgICAgICAvLyBgcmVhZHlTdGF0ZWAuXG4gICAgICAgICAgLy9cbiAgICAgICAgICAvLyBBbmQsIG9oIHllYWgsIHRoaXMgaGFjayBpcyBzbyBoYWNreS1pc2ggd2UgbmVlZCB0aGUgZm9sbG93aW5nXG4gICAgICAgICAgLy8gZXNsaW50IGRpc2FibGUuLi5cbiAgICAgICAgICAvKmVzbGludC1kaXNhYmxlIG5vLXVudXNlZC1leHByZXNzaW9ucyovXG4gICAgICAgICAgc2NyaXB0LmNoaWxkcmVuO1xuICAgICAgICAgIC8qZXNsaW50LWVuYWJsZSBuby11bnVzZWQtZXhwcmVzc2lvbnMqL1xuXG4gICAgICAgICAgaWYgKHNjcmlwdC5yZWFkeVN0YXRlID09PSBcImxvYWRpbmdcIikge1xuICAgICAgICAgICAgLy8gU3RhdGUgdHJhbnNpdGlvbnMgaW5kaWNhdGUgd2UndmUgaGl0IHRoZSBsb2FkIGVycm9yLlxuICAgICAgICAgICAgLy9cbiAgICAgICAgICAgIC8vICoqTm90ZSoqOiBXZSBhcmUgbm90IGludGVuZGluZyB0byBfcmV0dXJuXyBhIHZhbHVlLCBqdXN0IGhhdmVcbiAgICAgICAgICAgIC8vIGEgc2hvcnRlciBzaG9ydC1jaXJjdWl0IGNvZGUgcGF0aCBoZXJlLlxuICAgICAgICAgICAgcmV0dXJuIF9lcnJvcigpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEl0J3MgcG9zc2libGUgZm9yIHJlYWR5U3RhdGUgdG8gYmUgXCJjb21wbGV0ZVwiIGltbWVkaWF0ZWx5XG4gICAgICAgIC8vIGFmdGVyIHdlIGluc2VydCAoYW5kIGV4ZWN1dGUpIHRoZSBzY3JpcHQgaW4gdGhlIGJyYW5jaFxuICAgICAgICAvLyBhYm92ZS4gU28gY2hlY2sgcmVhZHlTdGF0ZSBhZ2FpbiBoZXJlIGFuZCByZWFjdCB3aXRob3V0XG4gICAgICAgIC8vIHdhaXRpbmcgZm9yIGFub3RoZXIgb25yZWFkeXN0YXRlY2hhbmdlLlxuICAgICAgICBpZiAoc2NyaXB0LnJlYWR5U3RhdGUgPT09IFwiY29tcGxldGVcIikge1xuICAgICAgICAgIF9maW5pc2goKTtcbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgLy8gT25lcnJvciBoYW5kbGVyIF9tYXlfIHdvcmsgaGVyZS5cbiAgICAgIHNjcmlwdC5vbmVycm9yID0gX2Vycm9yO1xuXG4gICAgICAvLyBTaW5jZSB3ZSdyZSBub3QgYXBwZW5kaW5nIHRoZSBzY3JpcHQgdG8gdGhlIERPTSB5ZXQsIHRoZVxuICAgICAgLy8gcmVmZXJlbmNlIHRvIG91ciBzY3JpcHQgZWxlbWVudCBtaWdodCBnZXQgZ2FyYmFnZSBjb2xsZWN0ZWRcbiAgICAgIC8vIHdoZW4gdGhpcyBmdW5jdGlvbiBlbmRzLCB3aXRob3V0IG9ucmVhZHlzdGF0ZWNoYW5nZSBldmVyIGJlaW5nXG4gICAgICAvLyBmaXJlZC4gVGhpcyBoYXMgYmVlbiB3aXRuZXNzZWQgdG8gaGFwcGVuLiBBZGRpbmcgaXQgdG9cbiAgICAgIC8vIGBwZW5kaW5nU2NyaXB0c2AgZW5zdXJlcyB0aGlzIGNhbid0IGhhcHBlbi5cbiAgICAgIHBlbmRpbmdTY3JpcHRzW2lkXSA9IHNjcmlwdDtcblxuICAgICAgLy8gY2FsbCB0aGUgc2V0dXAgY2FsbGJhY2sgdG8gbXV0YXRlIHRoZSBzY3JpcHQgdGFnXG4gICAgICBpZiAoc2V0dXApIHtcbiAgICAgICAgc2V0dXAuY2FsbChjb250ZXh0LCBzY3JpcHQpO1xuICAgICAgfVxuXG4gICAgICAvLyBUaGlzIHRyaWdnZXJzIGEgcmVxdWVzdCBmb3IgdGhlIHNjcmlwdCwgYnV0IGl0cyBjb250ZW50cyB3b24ndFxuICAgICAgLy8gYmUgZXhlY3V0ZWQgdW50aWwgd2UgYXBwZW5kIGl0IHRvIHRoZSBET00uXG4gICAgICBzY3JpcHQuc3JjID0gc3JjO1xuXG4gICAgICAvLyBJbiBzb21lIGNhc2VzLCB0aGUgcmVhZHlTdGF0ZSBpcyBhbHJlYWR5IFwibG9hZGVkXCIgaW1tZWRpYXRlbHlcbiAgICAgIC8vIGFmdGVyIHNldHRpbmcgc3JjLiBJdCdzIGEgbGllISBEb24ndCBhcHBlbmQgdG8gdGhlIERPTSB1bnRpbFxuICAgICAgLy8gdGhlIG9ucmVhZHlzdGF0ZWNoYW5nZSBldmVudCBzYXlzIHNvLlxuXG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIFRoaXMgc2VjdGlvbiBpcyBmb3IgbW9kZXJuIGJyb3dzZXJzLCBpbmNsdWRpbmcgSUUxMCsuXG5cbiAgICAgIC8vIENsZWFyIG91dCBsaXN0ZW5lcnMuXG4gICAgICBfY2xlYW51cCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgc2NyaXB0Lm9ubG9hZCA9IHNjcmlwdC5vbmVycm9yID0gbnVsbDtcbiAgICAgIH07XG5cbiAgICAgIHNjcmlwdC5vbmVycm9yID0gX2Vycm9yO1xuICAgICAgc2NyaXB0Lm9ubG9hZCA9IF9maW5pc2g7XG4gICAgICBzY3JpcHQuYXN5bmMgPSB0cnVlO1xuICAgICAgc2NyaXB0LmNoYXJzZXQgPSBcInV0Zi04XCI7XG5cbiAgICAgIC8vIGNhbGwgdGhlIHNldHVwIGNhbGxiYWNrIHRvIG11dGF0ZSB0aGUgc2NyaXB0IHRhZ1xuICAgICAgaWYgKHNldHVwKSB7XG4gICAgICAgIHNldHVwLmNhbGwoY29udGV4dCwgc2NyaXB0KTtcbiAgICAgIH1cblxuICAgICAgc2NyaXB0LnNyYyA9IHNyYztcblxuICAgICAgLy8gQXBwZW5kIHRvIERPTS5cbiAgICAgIF9hZGRTY3JpcHQoc2NyaXB0KTtcbiAgICB9XG4gIH07XG5cbiAgLy8gVU1EIHdyYXBwZXIuXG4gIC8qZ2xvYmFsIGRlZmluZTpmYWxzZSovXG4gIGlmICh0eXBlb2YgZXhwb3J0cyA9PT0gXCJvYmplY3RcIiAmJiB0eXBlb2YgbW9kdWxlID09PSBcIm9iamVjdFwiKSB7XG4gICAgLy8gQ29tbW9uSlNcbiAgICBtb2R1bGUuZXhwb3J0cyA9IF9sbG9hZDtcblxuICB9IGVsc2UgaWYgKHR5cGVvZiBkZWZpbmUgPT09IFwiZnVuY3Rpb25cIiAmJiBkZWZpbmUuYW1kKSB7XG4gICAgLy8gQU1EXG4gICAgZGVmaW5lKFtdLCBmdW5jdGlvbiAoKSB7IHJldHVybiBfbGxvYWQ7IH0pO1xuXG4gIH0gZWxzZSB7XG4gICAgLy8gVmFuaWxsYUpTXG4gICAgd2luZG93Ll9sbG9hZCA9IF9sbG9hZDtcbiAgfVxufSgpKTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQU9BO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///bcb63a5837345ee29aa0\n");

/***/ }),

/***/ "bcd31d01884fc294fd69":
/*!*******************************************!*\
  !*** ./node_modules/mustache/mustache.js ***!
  \*******************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/*!\n * mustache.js - Logic-less {{mustache}} templates with JavaScript\n * http://github.com/janl/mustache.js\n */\n\n/*global define: false Mustache: true*/\n\n(function defineMustache (global, factory) {\n  if ( true && exports && typeof exports.nodeName !== 'string') {\n    factory(exports); // CommonJS\n  } else if (true) {\n    !(__WEBPACK_AMD_DEFINE_ARRAY__ = [exports], __WEBPACK_AMD_DEFINE_FACTORY__ = (factory),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?\n\t\t\t\t(__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__)); // AMD\n  } else {}\n}(this, function mustacheFactory (mustache) {\n\n  var objectToString = Object.prototype.toString;\n  var isArray = Array.isArray || function isArrayPolyfill (object) {\n    return objectToString.call(object) === '[object Array]';\n  };\n\n  function isFunction (object) {\n    return typeof object === 'function';\n  }\n\n  /**\n   * More correct typeof string handling array\n   * which normally returns typeof 'object'\n   */\n  function typeStr (obj) {\n    return isArray(obj) ? 'array' : typeof obj;\n  }\n\n  function escapeRegExp (string) {\n    return string.replace(/[\\-\\[\\]{}()*+?.,\\\\\\^$|#\\s]/g, '\\\\$&');\n  }\n\n  /**\n   * Null safe way of checking whether or not an object,\n   * including its prototype, has a given property\n   */\n  function hasProperty (obj, propName) {\n    return obj != null && typeof obj === 'object' && (propName in obj);\n  }\n\n  /**\n   * Safe way of detecting whether or not the given thing is a primitive and\n   * whether it has the given property\n   */\n  function primitiveHasOwnProperty (primitive, propName) {  \n    return (\n      primitive != null\n      && typeof primitive !== 'object'\n      && primitive.hasOwnProperty\n      && primitive.hasOwnProperty(propName)\n    );\n  }\n\n  // Workaround for https://issues.apache.org/jira/browse/COUCHDB-577\n  // See https://github.com/janl/mustache.js/issues/189\n  var regExpTest = RegExp.prototype.test;\n  function testRegExp (re, string) {\n    return regExpTest.call(re, string);\n  }\n\n  var nonSpaceRe = /\\S/;\n  function isWhitespace (string) {\n    return !testRegExp(nonSpaceRe, string);\n  }\n\n  var entityMap = {\n    '&': '&amp;',\n    '<': '&lt;',\n    '>': '&gt;',\n    '\"': '&quot;',\n    \"'\": '&#39;',\n    '/': '&#x2F;',\n    '`': '&#x60;',\n    '=': '&#x3D;'\n  };\n\n  function escapeHtml (string) {\n    return String(string).replace(/[&<>\"'`=\\/]/g, function fromEntityMap (s) {\n      return entityMap[s];\n    });\n  }\n\n  var whiteRe = /\\s*/;\n  var spaceRe = /\\s+/;\n  var equalsRe = /\\s*=/;\n  var curlyRe = /\\s*\\}/;\n  var tagRe = /#|\\^|\\/|>|\\{|&|=|!/;\n\n  /**\n   * Breaks up the given `template` string into a tree of tokens. If the `tags`\n   * argument is given here it must be an array with two string values: the\n   * opening and closing tags used in the template (e.g. [ \"<%\", \"%>\" ]). Of\n   * course, the default is to use mustaches (i.e. mustache.tags).\n   *\n   * A token is an array with at least 4 elements. The first element is the\n   * mustache symbol that was used inside the tag, e.g. \"#\" or \"&\". If the tag\n   * did not contain a symbol (i.e. {{myValue}}) this element is \"name\". For\n   * all text that appears outside a symbol this element is \"text\".\n   *\n   * The second element of a token is its \"value\". For mustache tags this is\n   * whatever else was inside the tag besides the opening symbol. For text tokens\n   * this is the text itself.\n   *\n   * The third and fourth elements of the token are the start and end indices,\n   * respectively, of the token in the original template.\n   *\n   * Tokens that are the root node of a subtree contain two more elements: 1) an\n   * array of tokens in the subtree and 2) the index in the original template at\n   * which the closing tag for that section begins.\n   */\n  function parseTemplate (template, tags) {\n    if (!template)\n      return [];\n\n    var sections = [];     // Stack to hold section tokens\n    var tokens = [];       // Buffer to hold the tokens\n    var spaces = [];       // Indices of whitespace tokens on the current line\n    var hasTag = false;    // Is there a {{tag}} on the current line?\n    var nonSpace = false;  // Is there a non-space char on the current line?\n\n    // Strips all whitespace tokens array for the current line\n    // if there was a {{#tag}} on it and otherwise only space.\n    function stripSpace () {\n      if (hasTag && !nonSpace) {\n        while (spaces.length)\n          delete tokens[spaces.pop()];\n      } else {\n        spaces = [];\n      }\n\n      hasTag = false;\n      nonSpace = false;\n    }\n\n    var openingTagRe, closingTagRe, closingCurlyRe;\n    function compileTags (tagsToCompile) {\n      if (typeof tagsToCompile === 'string')\n        tagsToCompile = tagsToCompile.split(spaceRe, 2);\n\n      if (!isArray(tagsToCompile) || tagsToCompile.length !== 2)\n        throw new Error('Invalid tags: ' + tagsToCompile);\n\n      openingTagRe = new RegExp(escapeRegExp(tagsToCompile[0]) + '\\\\s*');\n      closingTagRe = new RegExp('\\\\s*' + escapeRegExp(tagsToCompile[1]));\n      closingCurlyRe = new RegExp('\\\\s*' + escapeRegExp('}' + tagsToCompile[1]));\n    }\n\n    compileTags(tags || mustache.tags);\n\n    var scanner = new Scanner(template);\n\n    var start, type, value, chr, token, openSection;\n    while (!scanner.eos()) {\n      start = scanner.pos;\n\n      // Match any text between tags.\n      value = scanner.scanUntil(openingTagRe);\n\n      if (value) {\n        for (var i = 0, valueLength = value.length; i < valueLength; ++i) {\n          chr = value.charAt(i);\n\n          if (isWhitespace(chr)) {\n            spaces.push(tokens.length);\n          } else {\n            nonSpace = true;\n          }\n\n          tokens.push([ 'text', chr, start, start + 1 ]);\n          start += 1;\n\n          // Check for whitespace on the current line.\n          if (chr === '\\n')\n            stripSpace();\n        }\n      }\n\n      // Match the opening tag.\n      if (!scanner.scan(openingTagRe))\n        break;\n\n      hasTag = true;\n\n      // Get the tag type.\n      type = scanner.scan(tagRe) || 'name';\n      scanner.scan(whiteRe);\n\n      // Get the tag value.\n      if (type === '=') {\n        value = scanner.scanUntil(equalsRe);\n        scanner.scan(equalsRe);\n        scanner.scanUntil(closingTagRe);\n      } else if (type === '{') {\n        value = scanner.scanUntil(closingCurlyRe);\n        scanner.scan(curlyRe);\n        scanner.scanUntil(closingTagRe);\n        type = '&';\n      } else {\n        value = scanner.scanUntil(closingTagRe);\n      }\n\n      // Match the closing tag.\n      if (!scanner.scan(closingTagRe))\n        throw new Error('Unclosed tag at ' + scanner.pos);\n\n      token = [ type, value, start, scanner.pos ];\n      tokens.push(token);\n\n      if (type === '#' || type === '^') {\n        sections.push(token);\n      } else if (type === '/') {\n        // Check section nesting.\n        openSection = sections.pop();\n\n        if (!openSection)\n          throw new Error('Unopened section \"' + value + '\" at ' + start);\n\n        if (openSection[1] !== value)\n          throw new Error('Unclosed section \"' + openSection[1] + '\" at ' + start);\n      } else if (type === 'name' || type === '{' || type === '&') {\n        nonSpace = true;\n      } else if (type === '=') {\n        // Set the tags for the next time around.\n        compileTags(value);\n      }\n    }\n\n    // Make sure there are no open sections when we're done.\n    openSection = sections.pop();\n\n    if (openSection)\n      throw new Error('Unclosed section \"' + openSection[1] + '\" at ' + scanner.pos);\n\n    return nestTokens(squashTokens(tokens));\n  }\n\n  /**\n   * Combines the values of consecutive text tokens in the given `tokens` array\n   * to a single token.\n   */\n  function squashTokens (tokens) {\n    var squashedTokens = [];\n\n    var token, lastToken;\n    for (var i = 0, numTokens = tokens.length; i < numTokens; ++i) {\n      token = tokens[i];\n\n      if (token) {\n        if (token[0] === 'text' && lastToken && lastToken[0] === 'text') {\n          lastToken[1] += token[1];\n          lastToken[3] = token[3];\n        } else {\n          squashedTokens.push(token);\n          lastToken = token;\n        }\n      }\n    }\n\n    return squashedTokens;\n  }\n\n  /**\n   * Forms the given array of `tokens` into a nested tree structure where\n   * tokens that represent a section have two additional items: 1) an array of\n   * all tokens that appear in that section and 2) the index in the original\n   * template that represents the end of that section.\n   */\n  function nestTokens (tokens) {\n    var nestedTokens = [];\n    var collector = nestedTokens;\n    var sections = [];\n\n    var token, section;\n    for (var i = 0, numTokens = tokens.length; i < numTokens; ++i) {\n      token = tokens[i];\n\n      switch (token[0]) {\n        case '#':\n        case '^':\n          collector.push(token);\n          sections.push(token);\n          collector = token[4] = [];\n          break;\n        case '/':\n          section = sections.pop();\n          section[5] = token[2];\n          collector = sections.length > 0 ? sections[sections.length - 1][4] : nestedTokens;\n          break;\n        default:\n          collector.push(token);\n      }\n    }\n\n    return nestedTokens;\n  }\n\n  /**\n   * A simple string scanner that is used by the template parser to find\n   * tokens in template strings.\n   */\n  function Scanner (string) {\n    this.string = string;\n    this.tail = string;\n    this.pos = 0;\n  }\n\n  /**\n   * Returns `true` if the tail is empty (end of string).\n   */\n  Scanner.prototype.eos = function eos () {\n    return this.tail === '';\n  };\n\n  /**\n   * Tries to match the given regular expression at the current position.\n   * Returns the matched text if it can match, the empty string otherwise.\n   */\n  Scanner.prototype.scan = function scan (re) {\n    var match = this.tail.match(re);\n\n    if (!match || match.index !== 0)\n      return '';\n\n    var string = match[0];\n\n    this.tail = this.tail.substring(string.length);\n    this.pos += string.length;\n\n    return string;\n  };\n\n  /**\n   * Skips all text until the given regular expression can be matched. Returns\n   * the skipped string, which is the entire tail if no match can be made.\n   */\n  Scanner.prototype.scanUntil = function scanUntil (re) {\n    var index = this.tail.search(re), match;\n\n    switch (index) {\n      case -1:\n        match = this.tail;\n        this.tail = '';\n        break;\n      case 0:\n        match = '';\n        break;\n      default:\n        match = this.tail.substring(0, index);\n        this.tail = this.tail.substring(index);\n    }\n\n    this.pos += match.length;\n\n    return match;\n  };\n\n  /**\n   * Represents a rendering context by wrapping a view object and\n   * maintaining a reference to the parent context.\n   */\n  function Context (view, parentContext) {\n    this.view = view;\n    this.cache = { '.': this.view };\n    this.parent = parentContext;\n  }\n\n  /**\n   * Creates a new context using the given view with this context\n   * as the parent.\n   */\n  Context.prototype.push = function push (view) {\n    return new Context(view, this);\n  };\n\n  /**\n   * Returns the value of the given name in this context, traversing\n   * up the context hierarchy if the value is absent in this context's view.\n   */\n  Context.prototype.lookup = function lookup (name) {\n    var cache = this.cache;\n\n    var value;\n    if (cache.hasOwnProperty(name)) {\n      value = cache[name];\n    } else {\n      var context = this, intermediateValue, names, index, lookupHit = false;\n\n      while (context) {\n        if (name.indexOf('.') > 0) {\n          intermediateValue = context.view;\n          names = name.split('.');\n          index = 0;\n\n          /**\n           * Using the dot notion path in `name`, we descend through the\n           * nested objects.\n           *\n           * To be certain that the lookup has been successful, we have to\n           * check if the last object in the path actually has the property\n           * we are looking for. We store the result in `lookupHit`.\n           *\n           * This is specially necessary for when the value has been set to\n           * `undefined` and we want to avoid looking up parent contexts.\n           *\n           * In the case where dot notation is used, we consider the lookup\n           * to be successful even if the last \"object\" in the path is\n           * not actually an object but a primitive (e.g., a string, or an\n           * integer), because it is sometimes useful to access a property\n           * of an autoboxed primitive, such as the length of a string.\n           **/\n          while (intermediateValue != null && index < names.length) {\n            if (index === names.length - 1)\n              lookupHit = (\n                hasProperty(intermediateValue, names[index]) \n                || primitiveHasOwnProperty(intermediateValue, names[index])\n              );\n\n            intermediateValue = intermediateValue[names[index++]];\n          }\n        } else {\n          intermediateValue = context.view[name];\n\n          /**\n           * Only checking against `hasProperty`, which always returns `false` if\n           * `context.view` is not an object. Deliberately omitting the check\n           * against `primitiveHasOwnProperty` if dot notation is not used.\n           *\n           * Consider this example:\n           * ```\n           * Mustache.render(\"The length of a football field is {{#length}}{{length}}{{/length}}.\", {length: \"100 yards\"})\n           * ```\n           *\n           * If we were to check also against `primitiveHasOwnProperty`, as we do\n           * in the dot notation case, then render call would return:\n           *\n           * \"The length of a football field is 9.\"\n           *\n           * rather than the expected:\n           *\n           * \"The length of a football field is 100 yards.\"\n           **/\n          lookupHit = hasProperty(context.view, name);\n        }\n\n        if (lookupHit) {\n          value = intermediateValue;\n          break;\n        }\n\n        context = context.parent;\n      }\n\n      cache[name] = value;\n    }\n\n    if (isFunction(value))\n      value = value.call(this.view);\n\n    return value;\n  };\n\n  /**\n   * A Writer knows how to take a stream of tokens and render them to a\n   * string, given a context. It also maintains a cache of templates to\n   * avoid the need to parse the same template twice.\n   */\n  function Writer () {\n    this.cache = {};\n  }\n\n  /**\n   * Clears all cached templates in this writer.\n   */\n  Writer.prototype.clearCache = function clearCache () {\n    this.cache = {};\n  };\n\n  /**\n   * Parses and caches the given `template` according to the given `tags` or\n   * `mustache.tags` if `tags` is omitted,  and returns the array of tokens\n   * that is generated from the parse.\n   */\n  Writer.prototype.parse = function parse (template, tags) {\n    var cache = this.cache;\n    var cacheKey = template + ':' + (tags || mustache.tags).join(':');\n    var tokens = cache[cacheKey];\n\n    if (tokens == null)\n      tokens = cache[cacheKey] = parseTemplate(template, tags);\n\n    return tokens;\n  };\n\n  /**\n   * High-level method that is used to render the given `template` with\n   * the given `view`.\n   *\n   * The optional `partials` argument may be an object that contains the\n   * names and templates of partials that are used in the template. It may\n   * also be a function that is used to load partial templates on the fly\n   * that takes a single argument: the name of the partial.\n   *\n   * If the optional `tags` argument is given here it must be an array with two\n   * string values: the opening and closing tags used in the template (e.g.\n   * [ \"<%\", \"%>\" ]). The default is to mustache.tags.\n   */\n  Writer.prototype.render = function render (template, view, partials, tags) {\n    var tokens = this.parse(template, tags);\n    var context = (view instanceof Context) ? view : new Context(view);\n    return this.renderTokens(tokens, context, partials, template, tags);\n  };\n\n  /**\n   * Low-level method that renders the given array of `tokens` using\n   * the given `context` and `partials`.\n   *\n   * Note: The `originalTemplate` is only ever used to extract the portion\n   * of the original template that was contained in a higher-order section.\n   * If the template doesn't use higher-order sections, this argument may\n   * be omitted.\n   */\n  Writer.prototype.renderTokens = function renderTokens (tokens, context, partials, originalTemplate, tags) {\n    var buffer = '';\n\n    var token, symbol, value;\n    for (var i = 0, numTokens = tokens.length; i < numTokens; ++i) {\n      value = undefined;\n      token = tokens[i];\n      symbol = token[0];\n\n      if (symbol === '#') value = this.renderSection(token, context, partials, originalTemplate);\n      else if (symbol === '^') value = this.renderInverted(token, context, partials, originalTemplate);\n      else if (symbol === '>') value = this.renderPartial(token, context, partials, tags);\n      else if (symbol === '&') value = this.unescapedValue(token, context);\n      else if (symbol === 'name') value = this.escapedValue(token, context);\n      else if (symbol === 'text') value = this.rawValue(token);\n\n      if (value !== undefined)\n        buffer += value;\n    }\n\n    return buffer;\n  };\n\n  Writer.prototype.renderSection = function renderSection (token, context, partials, originalTemplate) {\n    var self = this;\n    var buffer = '';\n    var value = context.lookup(token[1]);\n\n    // This function is used to render an arbitrary template\n    // in the current context by higher-order sections.\n    function subRender (template) {\n      return self.render(template, context, partials);\n    }\n\n    if (!value) return;\n\n    if (isArray(value)) {\n      for (var j = 0, valueLength = value.length; j < valueLength; ++j) {\n        buffer += this.renderTokens(token[4], context.push(value[j]), partials, originalTemplate);\n      }\n    } else if (typeof value === 'object' || typeof value === 'string' || typeof value === 'number') {\n      buffer += this.renderTokens(token[4], context.push(value), partials, originalTemplate);\n    } else if (isFunction(value)) {\n      if (typeof originalTemplate !== 'string')\n        throw new Error('Cannot use higher-order sections without the original template');\n\n      // Extract the portion of the original template that the section contains.\n      value = value.call(context.view, originalTemplate.slice(token[3], token[5]), subRender);\n\n      if (value != null)\n        buffer += value;\n    } else {\n      buffer += this.renderTokens(token[4], context, partials, originalTemplate);\n    }\n    return buffer;\n  };\n\n  Writer.prototype.renderInverted = function renderInverted (token, context, partials, originalTemplate) {\n    var value = context.lookup(token[1]);\n\n    // Use JavaScript's definition of falsy. Include empty arrays.\n    // See https://github.com/janl/mustache.js/issues/186\n    if (!value || (isArray(value) && value.length === 0))\n      return this.renderTokens(token[4], context, partials, originalTemplate);\n  };\n\n  Writer.prototype.renderPartial = function renderPartial (token, context, partials, tags) {\n    if (!partials) return;\n\n    var value = isFunction(partials) ? partials(token[1]) : partials[token[1]];\n    if (value != null)\n      return this.renderTokens(this.parse(value, tags), context, partials, value);\n  };\n\n  Writer.prototype.unescapedValue = function unescapedValue (token, context) {\n    var value = context.lookup(token[1]);\n    if (value != null)\n      return value;\n  };\n\n  Writer.prototype.escapedValue = function escapedValue (token, context) {\n    var value = context.lookup(token[1]);\n    if (value != null)\n      return mustache.escape(value);\n  };\n\n  Writer.prototype.rawValue = function rawValue (token) {\n    return token[1];\n  };\n\n  mustache.name = 'mustache.js';\n  mustache.version = '3.0.1';\n  mustache.tags = [ '{{', '}}' ];\n\n  // All high-level mustache.* functions use this writer.\n  var defaultWriter = new Writer();\n\n  /**\n   * Clears all cached templates in the default writer.\n   */\n  mustache.clearCache = function clearCache () {\n    return defaultWriter.clearCache();\n  };\n\n  /**\n   * Parses and caches the given template in the default writer and returns the\n   * array of tokens it contains. Doing this ahead of time avoids the need to\n   * parse templates on the fly as they are rendered.\n   */\n  mustache.parse = function parse (template, tags) {\n    return defaultWriter.parse(template, tags);\n  };\n\n  /**\n   * Renders the `template` with the given `view` and `partials` using the\n   * default writer. If the optional `tags` argument is given here it must be an\n   * array with two string values: the opening and closing tags used in the\n   * template (e.g. [ \"<%\", \"%>\" ]). The default is to mustache.tags.\n   */\n  mustache.render = function render (template, view, partials, tags) {\n    if (typeof template !== 'string') {\n      throw new TypeError('Invalid template! Template should be a \"string\" ' +\n                          'but \"' + typeStr(template) + '\" was given as the first ' +\n                          'argument for mustache#render(template, view, partials)');\n    }\n\n    return defaultWriter.render(template, view, partials, tags);\n  };\n\n  // This is here for backwards compatibility with 0.4.x.,\n  /*eslint-disable */ // eslint wants camel cased function name\n  mustache.to_html = function to_html (template, view, partials, send) {\n    /*eslint-enable*/\n\n    var result = mustache.render(template, view, partials);\n\n    if (isFunction(send)) {\n      send(result);\n    } else {\n      return result;\n    }\n  };\n\n  // Export the escaping function so that the user may override it.\n  // See https://github.com/janl/mustache.js/issues/244\n  mustache.escape = escapeHtml;\n\n  // Export these mainly for testing, but also for advanced usage.\n  mustache.Scanner = Scanner;\n  mustache.Context = Context;\n  mustache.Writer = Writer;\n\n  return mustache;\n}));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmNkMzFkMDE4ODRmYzI5NGZkNjkuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvbXVzdGFjaGUvbXVzdGFjaGUuanM/OWRiYiJdLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIG11c3RhY2hlLmpzIC0gTG9naWMtbGVzcyB7e211c3RhY2hlfX0gdGVtcGxhdGVzIHdpdGggSmF2YVNjcmlwdFxuICogaHR0cDovL2dpdGh1Yi5jb20vamFubC9tdXN0YWNoZS5qc1xuICovXG5cbi8qZ2xvYmFsIGRlZmluZTogZmFsc2UgTXVzdGFjaGU6IHRydWUqL1xuXG4oZnVuY3Rpb24gZGVmaW5lTXVzdGFjaGUgKGdsb2JhbCwgZmFjdG9yeSkge1xuICBpZiAodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnICYmIGV4cG9ydHMgJiYgdHlwZW9mIGV4cG9ydHMubm9kZU5hbWUgIT09ICdzdHJpbmcnKSB7XG4gICAgZmFjdG9yeShleHBvcnRzKTsgLy8gQ29tbW9uSlNcbiAgfSBlbHNlIGlmICh0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpIHtcbiAgICBkZWZpbmUoWydleHBvcnRzJ10sIGZhY3RvcnkpOyAvLyBBTURcbiAgfSBlbHNlIHtcbiAgICBnbG9iYWwuTXVzdGFjaGUgPSB7fTtcbiAgICBmYWN0b3J5KGdsb2JhbC5NdXN0YWNoZSk7IC8vIHNjcmlwdCwgd3NoLCBhc3BcbiAgfVxufSh0aGlzLCBmdW5jdGlvbiBtdXN0YWNoZUZhY3RvcnkgKG11c3RhY2hlKSB7XG5cbiAgdmFyIG9iamVjdFRvU3RyaW5nID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZztcbiAgdmFyIGlzQXJyYXkgPSBBcnJheS5pc0FycmF5IHx8IGZ1bmN0aW9uIGlzQXJyYXlQb2x5ZmlsbCAob2JqZWN0KSB7XG4gICAgcmV0dXJuIG9iamVjdFRvU3RyaW5nLmNhbGwob2JqZWN0KSA9PT0gJ1tvYmplY3QgQXJyYXldJztcbiAgfTtcblxuICBmdW5jdGlvbiBpc0Z1bmN0aW9uIChvYmplY3QpIHtcbiAgICByZXR1cm4gdHlwZW9mIG9iamVjdCA9PT0gJ2Z1bmN0aW9uJztcbiAgfVxuXG4gIC8qKlxuICAgKiBNb3JlIGNvcnJlY3QgdHlwZW9mIHN0cmluZyBoYW5kbGluZyBhcnJheVxuICAgKiB3aGljaCBub3JtYWxseSByZXR1cm5zIHR5cGVvZiAnb2JqZWN0J1xuICAgKi9cbiAgZnVuY3Rpb24gdHlwZVN0ciAob2JqKSB7XG4gICAgcmV0dXJuIGlzQXJyYXkob2JqKSA/ICdhcnJheScgOiB0eXBlb2Ygb2JqO1xuICB9XG5cbiAgZnVuY3Rpb24gZXNjYXBlUmVnRXhwIChzdHJpbmcpIHtcbiAgICByZXR1cm4gc3RyaW5nLnJlcGxhY2UoL1tcXC1cXFtcXF17fSgpKis/LixcXFxcXFxeJHwjXFxzXS9nLCAnXFxcXCQmJyk7XG4gIH1cblxuICAvKipcbiAgICogTnVsbCBzYWZlIHdheSBvZiBjaGVja2luZyB3aGV0aGVyIG9yIG5vdCBhbiBvYmplY3QsXG4gICAqIGluY2x1ZGluZyBpdHMgcHJvdG90eXBlLCBoYXMgYSBnaXZlbiBwcm9wZXJ0eVxuICAgKi9cbiAgZnVuY3Rpb24gaGFzUHJvcGVydHkgKG9iaiwgcHJvcE5hbWUpIHtcbiAgICByZXR1cm4gb2JqICE9IG51bGwgJiYgdHlwZW9mIG9iaiA9PT0gJ29iamVjdCcgJiYgKHByb3BOYW1lIGluIG9iaik7XG4gIH1cblxuICAvKipcbiAgICogU2FmZSB3YXkgb2YgZGV0ZWN0aW5nIHdoZXRoZXIgb3Igbm90IHRoZSBnaXZlbiB0aGluZyBpcyBhIHByaW1pdGl2ZSBhbmRcbiAgICogd2hldGhlciBpdCBoYXMgdGhlIGdpdmVuIHByb3BlcnR5XG4gICAqL1xuICBmdW5jdGlvbiBwcmltaXRpdmVIYXNPd25Qcm9wZXJ0eSAocHJpbWl0aXZlLCBwcm9wTmFtZSkgeyAgXG4gICAgcmV0dXJuIChcbiAgICAgIHByaW1pdGl2ZSAhPSBudWxsXG4gICAgICAmJiB0eXBlb2YgcHJpbWl0aXZlICE9PSAnb2JqZWN0J1xuICAgICAgJiYgcHJpbWl0aXZlLmhhc093blByb3BlcnR5XG4gICAgICAmJiBwcmltaXRpdmUuaGFzT3duUHJvcGVydHkocHJvcE5hbWUpXG4gICAgKTtcbiAgfVxuXG4gIC8vIFdvcmthcm91bmQgZm9yIGh0dHBzOi8vaXNzdWVzLmFwYWNoZS5vcmcvamlyYS9icm93c2UvQ09VQ0hEQi01NzdcbiAgLy8gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9qYW5sL211c3RhY2hlLmpzL2lzc3Vlcy8xODlcbiAgdmFyIHJlZ0V4cFRlc3QgPSBSZWdFeHAucHJvdG90eXBlLnRlc3Q7XG4gIGZ1bmN0aW9uIHRlc3RSZWdFeHAgKHJlLCBzdHJpbmcpIHtcbiAgICByZXR1cm4gcmVnRXhwVGVzdC5jYWxsKHJlLCBzdHJpbmcpO1xuICB9XG5cbiAgdmFyIG5vblNwYWNlUmUgPSAvXFxTLztcbiAgZnVuY3Rpb24gaXNXaGl0ZXNwYWNlIChzdHJpbmcpIHtcbiAgICByZXR1cm4gIXRlc3RSZWdFeHAobm9uU3BhY2VSZSwgc3RyaW5nKTtcbiAgfVxuXG4gIHZhciBlbnRpdHlNYXAgPSB7XG4gICAgJyYnOiAnJmFtcDsnLFxuICAgICc8JzogJyZsdDsnLFxuICAgICc+JzogJyZndDsnLFxuICAgICdcIic6ICcmcXVvdDsnLFxuICAgIFwiJ1wiOiAnJiMzOTsnLFxuICAgICcvJzogJyYjeDJGOycsXG4gICAgJ2AnOiAnJiN4NjA7JyxcbiAgICAnPSc6ICcmI3gzRDsnXG4gIH07XG5cbiAgZnVuY3Rpb24gZXNjYXBlSHRtbCAoc3RyaW5nKSB7XG4gICAgcmV0dXJuIFN0cmluZyhzdHJpbmcpLnJlcGxhY2UoL1smPD5cIidgPVxcL10vZywgZnVuY3Rpb24gZnJvbUVudGl0eU1hcCAocykge1xuICAgICAgcmV0dXJuIGVudGl0eU1hcFtzXTtcbiAgICB9KTtcbiAgfVxuXG4gIHZhciB3aGl0ZVJlID0gL1xccyovO1xuICB2YXIgc3BhY2VSZSA9IC9cXHMrLztcbiAgdmFyIGVxdWFsc1JlID0gL1xccyo9LztcbiAgdmFyIGN1cmx5UmUgPSAvXFxzKlxcfS87XG4gIHZhciB0YWdSZSA9IC8jfFxcXnxcXC98PnxcXHt8Jnw9fCEvO1xuXG4gIC8qKlxuICAgKiBCcmVha3MgdXAgdGhlIGdpdmVuIGB0ZW1wbGF0ZWAgc3RyaW5nIGludG8gYSB0cmVlIG9mIHRva2Vucy4gSWYgdGhlIGB0YWdzYFxuICAgKiBhcmd1bWVudCBpcyBnaXZlbiBoZXJlIGl0IG11c3QgYmUgYW4gYXJyYXkgd2l0aCB0d28gc3RyaW5nIHZhbHVlczogdGhlXG4gICAqIG9wZW5pbmcgYW5kIGNsb3NpbmcgdGFncyB1c2VkIGluIHRoZSB0ZW1wbGF0ZSAoZS5nLiBbIFwiPCVcIiwgXCIlPlwiIF0pLiBPZlxuICAgKiBjb3Vyc2UsIHRoZSBkZWZhdWx0IGlzIHRvIHVzZSBtdXN0YWNoZXMgKGkuZS4gbXVzdGFjaGUudGFncykuXG4gICAqXG4gICAqIEEgdG9rZW4gaXMgYW4gYXJyYXkgd2l0aCBhdCBsZWFzdCA0IGVsZW1lbnRzLiBUaGUgZmlyc3QgZWxlbWVudCBpcyB0aGVcbiAgICogbXVzdGFjaGUgc3ltYm9sIHRoYXQgd2FzIHVzZWQgaW5zaWRlIHRoZSB0YWcsIGUuZy4gXCIjXCIgb3IgXCImXCIuIElmIHRoZSB0YWdcbiAgICogZGlkIG5vdCBjb250YWluIGEgc3ltYm9sIChpLmUuIHt7bXlWYWx1ZX19KSB0aGlzIGVsZW1lbnQgaXMgXCJuYW1lXCIuIEZvclxuICAgKiBhbGwgdGV4dCB0aGF0IGFwcGVhcnMgb3V0c2lkZSBhIHN5bWJvbCB0aGlzIGVsZW1lbnQgaXMgXCJ0ZXh0XCIuXG4gICAqXG4gICAqIFRoZSBzZWNvbmQgZWxlbWVudCBvZiBhIHRva2VuIGlzIGl0cyBcInZhbHVlXCIuIEZvciBtdXN0YWNoZSB0YWdzIHRoaXMgaXNcbiAgICogd2hhdGV2ZXIgZWxzZSB3YXMgaW5zaWRlIHRoZSB0YWcgYmVzaWRlcyB0aGUgb3BlbmluZyBzeW1ib2wuIEZvciB0ZXh0IHRva2Vuc1xuICAgKiB0aGlzIGlzIHRoZSB0ZXh0IGl0c2VsZi5cbiAgICpcbiAgICogVGhlIHRoaXJkIGFuZCBmb3VydGggZWxlbWVudHMgb2YgdGhlIHRva2VuIGFyZSB0aGUgc3RhcnQgYW5kIGVuZCBpbmRpY2VzLFxuICAgKiByZXNwZWN0aXZlbHksIG9mIHRoZSB0b2tlbiBpbiB0aGUgb3JpZ2luYWwgdGVtcGxhdGUuXG4gICAqXG4gICAqIFRva2VucyB0aGF0IGFyZSB0aGUgcm9vdCBub2RlIG9mIGEgc3VidHJlZSBjb250YWluIHR3byBtb3JlIGVsZW1lbnRzOiAxKSBhblxuICAgKiBhcnJheSBvZiB0b2tlbnMgaW4gdGhlIHN1YnRyZWUgYW5kIDIpIHRoZSBpbmRleCBpbiB0aGUgb3JpZ2luYWwgdGVtcGxhdGUgYXRcbiAgICogd2hpY2ggdGhlIGNsb3NpbmcgdGFnIGZvciB0aGF0IHNlY3Rpb24gYmVnaW5zLlxuICAgKi9cbiAgZnVuY3Rpb24gcGFyc2VUZW1wbGF0ZSAodGVtcGxhdGUsIHRhZ3MpIHtcbiAgICBpZiAoIXRlbXBsYXRlKVxuICAgICAgcmV0dXJuIFtdO1xuXG4gICAgdmFyIHNlY3Rpb25zID0gW107ICAgICAvLyBTdGFjayB0byBob2xkIHNlY3Rpb24gdG9rZW5zXG4gICAgdmFyIHRva2VucyA9IFtdOyAgICAgICAvLyBCdWZmZXIgdG8gaG9sZCB0aGUgdG9rZW5zXG4gICAgdmFyIHNwYWNlcyA9IFtdOyAgICAgICAvLyBJbmRpY2VzIG9mIHdoaXRlc3BhY2UgdG9rZW5zIG9uIHRoZSBjdXJyZW50IGxpbmVcbiAgICB2YXIgaGFzVGFnID0gZmFsc2U7ICAgIC8vIElzIHRoZXJlIGEge3t0YWd9fSBvbiB0aGUgY3VycmVudCBsaW5lP1xuICAgIHZhciBub25TcGFjZSA9IGZhbHNlOyAgLy8gSXMgdGhlcmUgYSBub24tc3BhY2UgY2hhciBvbiB0aGUgY3VycmVudCBsaW5lP1xuXG4gICAgLy8gU3RyaXBzIGFsbCB3aGl0ZXNwYWNlIHRva2VucyBhcnJheSBmb3IgdGhlIGN1cnJlbnQgbGluZVxuICAgIC8vIGlmIHRoZXJlIHdhcyBhIHt7I3RhZ319IG9uIGl0IGFuZCBvdGhlcndpc2Ugb25seSBzcGFjZS5cbiAgICBmdW5jdGlvbiBzdHJpcFNwYWNlICgpIHtcbiAgICAgIGlmIChoYXNUYWcgJiYgIW5vblNwYWNlKSB7XG4gICAgICAgIHdoaWxlIChzcGFjZXMubGVuZ3RoKVxuICAgICAgICAgIGRlbGV0ZSB0b2tlbnNbc3BhY2VzLnBvcCgpXTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHNwYWNlcyA9IFtdO1xuICAgICAgfVxuXG4gICAgICBoYXNUYWcgPSBmYWxzZTtcbiAgICAgIG5vblNwYWNlID0gZmFsc2U7XG4gICAgfVxuXG4gICAgdmFyIG9wZW5pbmdUYWdSZSwgY2xvc2luZ1RhZ1JlLCBjbG9zaW5nQ3VybHlSZTtcbiAgICBmdW5jdGlvbiBjb21waWxlVGFncyAodGFnc1RvQ29tcGlsZSkge1xuICAgICAgaWYgKHR5cGVvZiB0YWdzVG9Db21waWxlID09PSAnc3RyaW5nJylcbiAgICAgICAgdGFnc1RvQ29tcGlsZSA9IHRhZ3NUb0NvbXBpbGUuc3BsaXQoc3BhY2VSZSwgMik7XG5cbiAgICAgIGlmICghaXNBcnJheSh0YWdzVG9Db21waWxlKSB8fCB0YWdzVG9Db21waWxlLmxlbmd0aCAhPT0gMilcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIHRhZ3M6ICcgKyB0YWdzVG9Db21waWxlKTtcblxuICAgICAgb3BlbmluZ1RhZ1JlID0gbmV3IFJlZ0V4cChlc2NhcGVSZWdFeHAodGFnc1RvQ29tcGlsZVswXSkgKyAnXFxcXHMqJyk7XG4gICAgICBjbG9zaW5nVGFnUmUgPSBuZXcgUmVnRXhwKCdcXFxccyonICsgZXNjYXBlUmVnRXhwKHRhZ3NUb0NvbXBpbGVbMV0pKTtcbiAgICAgIGNsb3NpbmdDdXJseVJlID0gbmV3IFJlZ0V4cCgnXFxcXHMqJyArIGVzY2FwZVJlZ0V4cCgnfScgKyB0YWdzVG9Db21waWxlWzFdKSk7XG4gICAgfVxuXG4gICAgY29tcGlsZVRhZ3ModGFncyB8fCBtdXN0YWNoZS50YWdzKTtcblxuICAgIHZhciBzY2FubmVyID0gbmV3IFNjYW5uZXIodGVtcGxhdGUpO1xuXG4gICAgdmFyIHN0YXJ0LCB0eXBlLCB2YWx1ZSwgY2hyLCB0b2tlbiwgb3BlblNlY3Rpb247XG4gICAgd2hpbGUgKCFzY2FubmVyLmVvcygpKSB7XG4gICAgICBzdGFydCA9IHNjYW5uZXIucG9zO1xuXG4gICAgICAvLyBNYXRjaCBhbnkgdGV4dCBiZXR3ZWVuIHRhZ3MuXG4gICAgICB2YWx1ZSA9IHNjYW5uZXIuc2NhblVudGlsKG9wZW5pbmdUYWdSZSk7XG5cbiAgICAgIGlmICh2YWx1ZSkge1xuICAgICAgICBmb3IgKHZhciBpID0gMCwgdmFsdWVMZW5ndGggPSB2YWx1ZS5sZW5ndGg7IGkgPCB2YWx1ZUxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgY2hyID0gdmFsdWUuY2hhckF0KGkpO1xuXG4gICAgICAgICAgaWYgKGlzV2hpdGVzcGFjZShjaHIpKSB7XG4gICAgICAgICAgICBzcGFjZXMucHVzaCh0b2tlbnMubGVuZ3RoKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbm9uU3BhY2UgPSB0cnVlO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHRva2Vucy5wdXNoKFsgJ3RleHQnLCBjaHIsIHN0YXJ0LCBzdGFydCArIDEgXSk7XG4gICAgICAgICAgc3RhcnQgKz0gMTtcblxuICAgICAgICAgIC8vIENoZWNrIGZvciB3aGl0ZXNwYWNlIG9uIHRoZSBjdXJyZW50IGxpbmUuXG4gICAgICAgICAgaWYgKGNociA9PT0gJ1xcbicpXG4gICAgICAgICAgICBzdHJpcFNwYWNlKCk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gTWF0Y2ggdGhlIG9wZW5pbmcgdGFnLlxuICAgICAgaWYgKCFzY2FubmVyLnNjYW4ob3BlbmluZ1RhZ1JlKSlcbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGhhc1RhZyA9IHRydWU7XG5cbiAgICAgIC8vIEdldCB0aGUgdGFnIHR5cGUuXG4gICAgICB0eXBlID0gc2Nhbm5lci5zY2FuKHRhZ1JlKSB8fCAnbmFtZSc7XG4gICAgICBzY2FubmVyLnNjYW4od2hpdGVSZSk7XG5cbiAgICAgIC8vIEdldCB0aGUgdGFnIHZhbHVlLlxuICAgICAgaWYgKHR5cGUgPT09ICc9Jykge1xuICAgICAgICB2YWx1ZSA9IHNjYW5uZXIuc2NhblVudGlsKGVxdWFsc1JlKTtcbiAgICAgICAgc2Nhbm5lci5zY2FuKGVxdWFsc1JlKTtcbiAgICAgICAgc2Nhbm5lci5zY2FuVW50aWwoY2xvc2luZ1RhZ1JlKTtcbiAgICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ3snKSB7XG4gICAgICAgIHZhbHVlID0gc2Nhbm5lci5zY2FuVW50aWwoY2xvc2luZ0N1cmx5UmUpO1xuICAgICAgICBzY2FubmVyLnNjYW4oY3VybHlSZSk7XG4gICAgICAgIHNjYW5uZXIuc2NhblVudGlsKGNsb3NpbmdUYWdSZSk7XG4gICAgICAgIHR5cGUgPSAnJic7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YWx1ZSA9IHNjYW5uZXIuc2NhblVudGlsKGNsb3NpbmdUYWdSZSk7XG4gICAgICB9XG5cbiAgICAgIC8vIE1hdGNoIHRoZSBjbG9zaW5nIHRhZy5cbiAgICAgIGlmICghc2Nhbm5lci5zY2FuKGNsb3NpbmdUYWdSZSkpXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignVW5jbG9zZWQgdGFnIGF0ICcgKyBzY2FubmVyLnBvcyk7XG5cbiAgICAgIHRva2VuID0gWyB0eXBlLCB2YWx1ZSwgc3RhcnQsIHNjYW5uZXIucG9zIF07XG4gICAgICB0b2tlbnMucHVzaCh0b2tlbik7XG5cbiAgICAgIGlmICh0eXBlID09PSAnIycgfHwgdHlwZSA9PT0gJ14nKSB7XG4gICAgICAgIHNlY3Rpb25zLnB1c2godG9rZW4pO1xuICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAnLycpIHtcbiAgICAgICAgLy8gQ2hlY2sgc2VjdGlvbiBuZXN0aW5nLlxuICAgICAgICBvcGVuU2VjdGlvbiA9IHNlY3Rpb25zLnBvcCgpO1xuXG4gICAgICAgIGlmICghb3BlblNlY3Rpb24pXG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdVbm9wZW5lZCBzZWN0aW9uIFwiJyArIHZhbHVlICsgJ1wiIGF0ICcgKyBzdGFydCk7XG5cbiAgICAgICAgaWYgKG9wZW5TZWN0aW9uWzFdICE9PSB2YWx1ZSlcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1VuY2xvc2VkIHNlY3Rpb24gXCInICsgb3BlblNlY3Rpb25bMV0gKyAnXCIgYXQgJyArIHN0YXJ0KTtcbiAgICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ25hbWUnIHx8IHR5cGUgPT09ICd7JyB8fCB0eXBlID09PSAnJicpIHtcbiAgICAgICAgbm9uU3BhY2UgPSB0cnVlO1xuICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAnPScpIHtcbiAgICAgICAgLy8gU2V0IHRoZSB0YWdzIGZvciB0aGUgbmV4dCB0aW1lIGFyb3VuZC5cbiAgICAgICAgY29tcGlsZVRhZ3ModmFsdWUpO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIE1ha2Ugc3VyZSB0aGVyZSBhcmUgbm8gb3BlbiBzZWN0aW9ucyB3aGVuIHdlJ3JlIGRvbmUuXG4gICAgb3BlblNlY3Rpb24gPSBzZWN0aW9ucy5wb3AoKTtcblxuICAgIGlmIChvcGVuU2VjdGlvbilcbiAgICAgIHRocm93IG5ldyBFcnJvcignVW5jbG9zZWQgc2VjdGlvbiBcIicgKyBvcGVuU2VjdGlvblsxXSArICdcIiBhdCAnICsgc2Nhbm5lci5wb3MpO1xuXG4gICAgcmV0dXJuIG5lc3RUb2tlbnMoc3F1YXNoVG9rZW5zKHRva2VucykpO1xuICB9XG5cbiAgLyoqXG4gICAqIENvbWJpbmVzIHRoZSB2YWx1ZXMgb2YgY29uc2VjdXRpdmUgdGV4dCB0b2tlbnMgaW4gdGhlIGdpdmVuIGB0b2tlbnNgIGFycmF5XG4gICAqIHRvIGEgc2luZ2xlIHRva2VuLlxuICAgKi9cbiAgZnVuY3Rpb24gc3F1YXNoVG9rZW5zICh0b2tlbnMpIHtcbiAgICB2YXIgc3F1YXNoZWRUb2tlbnMgPSBbXTtcblxuICAgIHZhciB0b2tlbiwgbGFzdFRva2VuO1xuICAgIGZvciAodmFyIGkgPSAwLCBudW1Ub2tlbnMgPSB0b2tlbnMubGVuZ3RoOyBpIDwgbnVtVG9rZW5zOyArK2kpIHtcbiAgICAgIHRva2VuID0gdG9rZW5zW2ldO1xuXG4gICAgICBpZiAodG9rZW4pIHtcbiAgICAgICAgaWYgKHRva2VuWzBdID09PSAndGV4dCcgJiYgbGFzdFRva2VuICYmIGxhc3RUb2tlblswXSA9PT0gJ3RleHQnKSB7XG4gICAgICAgICAgbGFzdFRva2VuWzFdICs9IHRva2VuWzFdO1xuICAgICAgICAgIGxhc3RUb2tlblszXSA9IHRva2VuWzNdO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHNxdWFzaGVkVG9rZW5zLnB1c2godG9rZW4pO1xuICAgICAgICAgIGxhc3RUb2tlbiA9IHRva2VuO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHNxdWFzaGVkVG9rZW5zO1xuICB9XG5cbiAgLyoqXG4gICAqIEZvcm1zIHRoZSBnaXZlbiBhcnJheSBvZiBgdG9rZW5zYCBpbnRvIGEgbmVzdGVkIHRyZWUgc3RydWN0dXJlIHdoZXJlXG4gICAqIHRva2VucyB0aGF0IHJlcHJlc2VudCBhIHNlY3Rpb24gaGF2ZSB0d28gYWRkaXRpb25hbCBpdGVtczogMSkgYW4gYXJyYXkgb2ZcbiAgICogYWxsIHRva2VucyB0aGF0IGFwcGVhciBpbiB0aGF0IHNlY3Rpb24gYW5kIDIpIHRoZSBpbmRleCBpbiB0aGUgb3JpZ2luYWxcbiAgICogdGVtcGxhdGUgdGhhdCByZXByZXNlbnRzIHRoZSBlbmQgb2YgdGhhdCBzZWN0aW9uLlxuICAgKi9cbiAgZnVuY3Rpb24gbmVzdFRva2VucyAodG9rZW5zKSB7XG4gICAgdmFyIG5lc3RlZFRva2VucyA9IFtdO1xuICAgIHZhciBjb2xsZWN0b3IgPSBuZXN0ZWRUb2tlbnM7XG4gICAgdmFyIHNlY3Rpb25zID0gW107XG5cbiAgICB2YXIgdG9rZW4sIHNlY3Rpb247XG4gICAgZm9yICh2YXIgaSA9IDAsIG51bVRva2VucyA9IHRva2Vucy5sZW5ndGg7IGkgPCBudW1Ub2tlbnM7ICsraSkge1xuICAgICAgdG9rZW4gPSB0b2tlbnNbaV07XG5cbiAgICAgIHN3aXRjaCAodG9rZW5bMF0pIHtcbiAgICAgICAgY2FzZSAnIyc6XG4gICAgICAgIGNhc2UgJ14nOlxuICAgICAgICAgIGNvbGxlY3Rvci5wdXNoKHRva2VuKTtcbiAgICAgICAgICBzZWN0aW9ucy5wdXNoKHRva2VuKTtcbiAgICAgICAgICBjb2xsZWN0b3IgPSB0b2tlbls0XSA9IFtdO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICcvJzpcbiAgICAgICAgICBzZWN0aW9uID0gc2VjdGlvbnMucG9wKCk7XG4gICAgICAgICAgc2VjdGlvbls1XSA9IHRva2VuWzJdO1xuICAgICAgICAgIGNvbGxlY3RvciA9IHNlY3Rpb25zLmxlbmd0aCA+IDAgPyBzZWN0aW9uc1tzZWN0aW9ucy5sZW5ndGggLSAxXVs0XSA6IG5lc3RlZFRva2VucztcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICBjb2xsZWN0b3IucHVzaCh0b2tlbik7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIG5lc3RlZFRva2VucztcbiAgfVxuXG4gIC8qKlxuICAgKiBBIHNpbXBsZSBzdHJpbmcgc2Nhbm5lciB0aGF0IGlzIHVzZWQgYnkgdGhlIHRlbXBsYXRlIHBhcnNlciB0byBmaW5kXG4gICAqIHRva2VucyBpbiB0ZW1wbGF0ZSBzdHJpbmdzLlxuICAgKi9cbiAgZnVuY3Rpb24gU2Nhbm5lciAoc3RyaW5nKSB7XG4gICAgdGhpcy5zdHJpbmcgPSBzdHJpbmc7XG4gICAgdGhpcy50YWlsID0gc3RyaW5nO1xuICAgIHRoaXMucG9zID0gMDtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgdGFpbCBpcyBlbXB0eSAoZW5kIG9mIHN0cmluZykuXG4gICAqL1xuICBTY2FubmVyLnByb3RvdHlwZS5lb3MgPSBmdW5jdGlvbiBlb3MgKCkge1xuICAgIHJldHVybiB0aGlzLnRhaWwgPT09ICcnO1xuICB9O1xuXG4gIC8qKlxuICAgKiBUcmllcyB0byBtYXRjaCB0aGUgZ2l2ZW4gcmVndWxhciBleHByZXNzaW9uIGF0IHRoZSBjdXJyZW50IHBvc2l0aW9uLlxuICAgKiBSZXR1cm5zIHRoZSBtYXRjaGVkIHRleHQgaWYgaXQgY2FuIG1hdGNoLCB0aGUgZW1wdHkgc3RyaW5nIG90aGVyd2lzZS5cbiAgICovXG4gIFNjYW5uZXIucHJvdG90eXBlLnNjYW4gPSBmdW5jdGlvbiBzY2FuIChyZSkge1xuICAgIHZhciBtYXRjaCA9IHRoaXMudGFpbC5tYXRjaChyZSk7XG5cbiAgICBpZiAoIW1hdGNoIHx8IG1hdGNoLmluZGV4ICE9PSAwKVxuICAgICAgcmV0dXJuICcnO1xuXG4gICAgdmFyIHN0cmluZyA9IG1hdGNoWzBdO1xuXG4gICAgdGhpcy50YWlsID0gdGhpcy50YWlsLnN1YnN0cmluZyhzdHJpbmcubGVuZ3RoKTtcbiAgICB0aGlzLnBvcyArPSBzdHJpbmcubGVuZ3RoO1xuXG4gICAgcmV0dXJuIHN0cmluZztcbiAgfTtcblxuICAvKipcbiAgICogU2tpcHMgYWxsIHRleHQgdW50aWwgdGhlIGdpdmVuIHJlZ3VsYXIgZXhwcmVzc2lvbiBjYW4gYmUgbWF0Y2hlZC4gUmV0dXJuc1xuICAgKiB0aGUgc2tpcHBlZCBzdHJpbmcsIHdoaWNoIGlzIHRoZSBlbnRpcmUgdGFpbCBpZiBubyBtYXRjaCBjYW4gYmUgbWFkZS5cbiAgICovXG4gIFNjYW5uZXIucHJvdG90eXBlLnNjYW5VbnRpbCA9IGZ1bmN0aW9uIHNjYW5VbnRpbCAocmUpIHtcbiAgICB2YXIgaW5kZXggPSB0aGlzLnRhaWwuc2VhcmNoKHJlKSwgbWF0Y2g7XG5cbiAgICBzd2l0Y2ggKGluZGV4KSB7XG4gICAgICBjYXNlIC0xOlxuICAgICAgICBtYXRjaCA9IHRoaXMudGFpbDtcbiAgICAgICAgdGhpcy50YWlsID0gJyc7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAwOlxuICAgICAgICBtYXRjaCA9ICcnO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIG1hdGNoID0gdGhpcy50YWlsLnN1YnN0cmluZygwLCBpbmRleCk7XG4gICAgICAgIHRoaXMudGFpbCA9IHRoaXMudGFpbC5zdWJzdHJpbmcoaW5kZXgpO1xuICAgIH1cblxuICAgIHRoaXMucG9zICs9IG1hdGNoLmxlbmd0aDtcblxuICAgIHJldHVybiBtYXRjaDtcbiAgfTtcblxuICAvKipcbiAgICogUmVwcmVzZW50cyBhIHJlbmRlcmluZyBjb250ZXh0IGJ5IHdyYXBwaW5nIGEgdmlldyBvYmplY3QgYW5kXG4gICAqIG1haW50YWluaW5nIGEgcmVmZXJlbmNlIHRvIHRoZSBwYXJlbnQgY29udGV4dC5cbiAgICovXG4gIGZ1bmN0aW9uIENvbnRleHQgKHZpZXcsIHBhcmVudENvbnRleHQpIHtcbiAgICB0aGlzLnZpZXcgPSB2aWV3O1xuICAgIHRoaXMuY2FjaGUgPSB7ICcuJzogdGhpcy52aWV3IH07XG4gICAgdGhpcy5wYXJlbnQgPSBwYXJlbnRDb250ZXh0O1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgYSBuZXcgY29udGV4dCB1c2luZyB0aGUgZ2l2ZW4gdmlldyB3aXRoIHRoaXMgY29udGV4dFxuICAgKiBhcyB0aGUgcGFyZW50LlxuICAgKi9cbiAgQ29udGV4dC5wcm90b3R5cGUucHVzaCA9IGZ1bmN0aW9uIHB1c2ggKHZpZXcpIHtcbiAgICByZXR1cm4gbmV3IENvbnRleHQodmlldywgdGhpcyk7XG4gIH07XG5cbiAgLyoqXG4gICAqIFJldHVybnMgdGhlIHZhbHVlIG9mIHRoZSBnaXZlbiBuYW1lIGluIHRoaXMgY29udGV4dCwgdHJhdmVyc2luZ1xuICAgKiB1cCB0aGUgY29udGV4dCBoaWVyYXJjaHkgaWYgdGhlIHZhbHVlIGlzIGFic2VudCBpbiB0aGlzIGNvbnRleHQncyB2aWV3LlxuICAgKi9cbiAgQ29udGV4dC5wcm90b3R5cGUubG9va3VwID0gZnVuY3Rpb24gbG9va3VwIChuYW1lKSB7XG4gICAgdmFyIGNhY2hlID0gdGhpcy5jYWNoZTtcblxuICAgIHZhciB2YWx1ZTtcbiAgICBpZiAoY2FjaGUuaGFzT3duUHJvcGVydHkobmFtZSkpIHtcbiAgICAgIHZhbHVlID0gY2FjaGVbbmFtZV07XG4gICAgfSBlbHNlIHtcbiAgICAgIHZhciBjb250ZXh0ID0gdGhpcywgaW50ZXJtZWRpYXRlVmFsdWUsIG5hbWVzLCBpbmRleCwgbG9va3VwSGl0ID0gZmFsc2U7XG5cbiAgICAgIHdoaWxlIChjb250ZXh0KSB7XG4gICAgICAgIGlmIChuYW1lLmluZGV4T2YoJy4nKSA+IDApIHtcbiAgICAgICAgICBpbnRlcm1lZGlhdGVWYWx1ZSA9IGNvbnRleHQudmlldztcbiAgICAgICAgICBuYW1lcyA9IG5hbWUuc3BsaXQoJy4nKTtcbiAgICAgICAgICBpbmRleCA9IDA7XG5cbiAgICAgICAgICAvKipcbiAgICAgICAgICAgKiBVc2luZyB0aGUgZG90IG5vdGlvbiBwYXRoIGluIGBuYW1lYCwgd2UgZGVzY2VuZCB0aHJvdWdoIHRoZVxuICAgICAgICAgICAqIG5lc3RlZCBvYmplY3RzLlxuICAgICAgICAgICAqXG4gICAgICAgICAgICogVG8gYmUgY2VydGFpbiB0aGF0IHRoZSBsb29rdXAgaGFzIGJlZW4gc3VjY2Vzc2Z1bCwgd2UgaGF2ZSB0b1xuICAgICAgICAgICAqIGNoZWNrIGlmIHRoZSBsYXN0IG9iamVjdCBpbiB0aGUgcGF0aCBhY3R1YWxseSBoYXMgdGhlIHByb3BlcnR5XG4gICAgICAgICAgICogd2UgYXJlIGxvb2tpbmcgZm9yLiBXZSBzdG9yZSB0aGUgcmVzdWx0IGluIGBsb29rdXBIaXRgLlxuICAgICAgICAgICAqXG4gICAgICAgICAgICogVGhpcyBpcyBzcGVjaWFsbHkgbmVjZXNzYXJ5IGZvciB3aGVuIHRoZSB2YWx1ZSBoYXMgYmVlbiBzZXQgdG9cbiAgICAgICAgICAgKiBgdW5kZWZpbmVkYCBhbmQgd2Ugd2FudCB0byBhdm9pZCBsb29raW5nIHVwIHBhcmVudCBjb250ZXh0cy5cbiAgICAgICAgICAgKlxuICAgICAgICAgICAqIEluIHRoZSBjYXNlIHdoZXJlIGRvdCBub3RhdGlvbiBpcyB1c2VkLCB3ZSBjb25zaWRlciB0aGUgbG9va3VwXG4gICAgICAgICAgICogdG8gYmUgc3VjY2Vzc2Z1bCBldmVuIGlmIHRoZSBsYXN0IFwib2JqZWN0XCIgaW4gdGhlIHBhdGggaXNcbiAgICAgICAgICAgKiBub3QgYWN0dWFsbHkgYW4gb2JqZWN0IGJ1dCBhIHByaW1pdGl2ZSAoZS5nLiwgYSBzdHJpbmcsIG9yIGFuXG4gICAgICAgICAgICogaW50ZWdlciksIGJlY2F1c2UgaXQgaXMgc29tZXRpbWVzIHVzZWZ1bCB0byBhY2Nlc3MgYSBwcm9wZXJ0eVxuICAgICAgICAgICAqIG9mIGFuIGF1dG9ib3hlZCBwcmltaXRpdmUsIHN1Y2ggYXMgdGhlIGxlbmd0aCBvZiBhIHN0cmluZy5cbiAgICAgICAgICAgKiovXG4gICAgICAgICAgd2hpbGUgKGludGVybWVkaWF0ZVZhbHVlICE9IG51bGwgJiYgaW5kZXggPCBuYW1lcy5sZW5ndGgpIHtcbiAgICAgICAgICAgIGlmIChpbmRleCA9PT0gbmFtZXMubGVuZ3RoIC0gMSlcbiAgICAgICAgICAgICAgbG9va3VwSGl0ID0gKFxuICAgICAgICAgICAgICAgIGhhc1Byb3BlcnR5KGludGVybWVkaWF0ZVZhbHVlLCBuYW1lc1tpbmRleF0pIFxuICAgICAgICAgICAgICAgIHx8IHByaW1pdGl2ZUhhc093blByb3BlcnR5KGludGVybWVkaWF0ZVZhbHVlLCBuYW1lc1tpbmRleF0pXG4gICAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIGludGVybWVkaWF0ZVZhbHVlID0gaW50ZXJtZWRpYXRlVmFsdWVbbmFtZXNbaW5kZXgrK11dO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpbnRlcm1lZGlhdGVWYWx1ZSA9IGNvbnRleHQudmlld1tuYW1lXTtcblxuICAgICAgICAgIC8qKlxuICAgICAgICAgICAqIE9ubHkgY2hlY2tpbmcgYWdhaW5zdCBgaGFzUHJvcGVydHlgLCB3aGljaCBhbHdheXMgcmV0dXJucyBgZmFsc2VgIGlmXG4gICAgICAgICAgICogYGNvbnRleHQudmlld2AgaXMgbm90IGFuIG9iamVjdC4gRGVsaWJlcmF0ZWx5IG9taXR0aW5nIHRoZSBjaGVja1xuICAgICAgICAgICAqIGFnYWluc3QgYHByaW1pdGl2ZUhhc093blByb3BlcnR5YCBpZiBkb3Qgbm90YXRpb24gaXMgbm90IHVzZWQuXG4gICAgICAgICAgICpcbiAgICAgICAgICAgKiBDb25zaWRlciB0aGlzIGV4YW1wbGU6XG4gICAgICAgICAgICogYGBgXG4gICAgICAgICAgICogTXVzdGFjaGUucmVuZGVyKFwiVGhlIGxlbmd0aCBvZiBhIGZvb3RiYWxsIGZpZWxkIGlzIHt7I2xlbmd0aH19e3tsZW5ndGh9fXt7L2xlbmd0aH19LlwiLCB7bGVuZ3RoOiBcIjEwMCB5YXJkc1wifSlcbiAgICAgICAgICAgKiBgYGBcbiAgICAgICAgICAgKlxuICAgICAgICAgICAqIElmIHdlIHdlcmUgdG8gY2hlY2sgYWxzbyBhZ2FpbnN0IGBwcmltaXRpdmVIYXNPd25Qcm9wZXJ0eWAsIGFzIHdlIGRvXG4gICAgICAgICAgICogaW4gdGhlIGRvdCBub3RhdGlvbiBjYXNlLCB0aGVuIHJlbmRlciBjYWxsIHdvdWxkIHJldHVybjpcbiAgICAgICAgICAgKlxuICAgICAgICAgICAqIFwiVGhlIGxlbmd0aCBvZiBhIGZvb3RiYWxsIGZpZWxkIGlzIDkuXCJcbiAgICAgICAgICAgKlxuICAgICAgICAgICAqIHJhdGhlciB0aGFuIHRoZSBleHBlY3RlZDpcbiAgICAgICAgICAgKlxuICAgICAgICAgICAqIFwiVGhlIGxlbmd0aCBvZiBhIGZvb3RiYWxsIGZpZWxkIGlzIDEwMCB5YXJkcy5cIlxuICAgICAgICAgICAqKi9cbiAgICAgICAgICBsb29rdXBIaXQgPSBoYXNQcm9wZXJ0eShjb250ZXh0LnZpZXcsIG5hbWUpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGxvb2t1cEhpdCkge1xuICAgICAgICAgIHZhbHVlID0gaW50ZXJtZWRpYXRlVmFsdWU7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cblxuICAgICAgICBjb250ZXh0ID0gY29udGV4dC5wYXJlbnQ7XG4gICAgICB9XG5cbiAgICAgIGNhY2hlW25hbWVdID0gdmFsdWU7XG4gICAgfVxuXG4gICAgaWYgKGlzRnVuY3Rpb24odmFsdWUpKVxuICAgICAgdmFsdWUgPSB2YWx1ZS5jYWxsKHRoaXMudmlldyk7XG5cbiAgICByZXR1cm4gdmFsdWU7XG4gIH07XG5cbiAgLyoqXG4gICAqIEEgV3JpdGVyIGtub3dzIGhvdyB0byB0YWtlIGEgc3RyZWFtIG9mIHRva2VucyBhbmQgcmVuZGVyIHRoZW0gdG8gYVxuICAgKiBzdHJpbmcsIGdpdmVuIGEgY29udGV4dC4gSXQgYWxzbyBtYWludGFpbnMgYSBjYWNoZSBvZiB0ZW1wbGF0ZXMgdG9cbiAgICogYXZvaWQgdGhlIG5lZWQgdG8gcGFyc2UgdGhlIHNhbWUgdGVtcGxhdGUgdHdpY2UuXG4gICAqL1xuICBmdW5jdGlvbiBXcml0ZXIgKCkge1xuICAgIHRoaXMuY2FjaGUgPSB7fTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDbGVhcnMgYWxsIGNhY2hlZCB0ZW1wbGF0ZXMgaW4gdGhpcyB3cml0ZXIuXG4gICAqL1xuICBXcml0ZXIucHJvdG90eXBlLmNsZWFyQ2FjaGUgPSBmdW5jdGlvbiBjbGVhckNhY2hlICgpIHtcbiAgICB0aGlzLmNhY2hlID0ge307XG4gIH07XG5cbiAgLyoqXG4gICAqIFBhcnNlcyBhbmQgY2FjaGVzIHRoZSBnaXZlbiBgdGVtcGxhdGVgIGFjY29yZGluZyB0byB0aGUgZ2l2ZW4gYHRhZ3NgIG9yXG4gICAqIGBtdXN0YWNoZS50YWdzYCBpZiBgdGFnc2AgaXMgb21pdHRlZCwgIGFuZCByZXR1cm5zIHRoZSBhcnJheSBvZiB0b2tlbnNcbiAgICogdGhhdCBpcyBnZW5lcmF0ZWQgZnJvbSB0aGUgcGFyc2UuXG4gICAqL1xuICBXcml0ZXIucHJvdG90eXBlLnBhcnNlID0gZnVuY3Rpb24gcGFyc2UgKHRlbXBsYXRlLCB0YWdzKSB7XG4gICAgdmFyIGNhY2hlID0gdGhpcy5jYWNoZTtcbiAgICB2YXIgY2FjaGVLZXkgPSB0ZW1wbGF0ZSArICc6JyArICh0YWdzIHx8IG11c3RhY2hlLnRhZ3MpLmpvaW4oJzonKTtcbiAgICB2YXIgdG9rZW5zID0gY2FjaGVbY2FjaGVLZXldO1xuXG4gICAgaWYgKHRva2VucyA9PSBudWxsKVxuICAgICAgdG9rZW5zID0gY2FjaGVbY2FjaGVLZXldID0gcGFyc2VUZW1wbGF0ZSh0ZW1wbGF0ZSwgdGFncyk7XG5cbiAgICByZXR1cm4gdG9rZW5zO1xuICB9O1xuXG4gIC8qKlxuICAgKiBIaWdoLWxldmVsIG1ldGhvZCB0aGF0IGlzIHVzZWQgdG8gcmVuZGVyIHRoZSBnaXZlbiBgdGVtcGxhdGVgIHdpdGhcbiAgICogdGhlIGdpdmVuIGB2aWV3YC5cbiAgICpcbiAgICogVGhlIG9wdGlvbmFsIGBwYXJ0aWFsc2AgYXJndW1lbnQgbWF5IGJlIGFuIG9iamVjdCB0aGF0IGNvbnRhaW5zIHRoZVxuICAgKiBuYW1lcyBhbmQgdGVtcGxhdGVzIG9mIHBhcnRpYWxzIHRoYXQgYXJlIHVzZWQgaW4gdGhlIHRlbXBsYXRlLiBJdCBtYXlcbiAgICogYWxzbyBiZSBhIGZ1bmN0aW9uIHRoYXQgaXMgdXNlZCB0byBsb2FkIHBhcnRpYWwgdGVtcGxhdGVzIG9uIHRoZSBmbHlcbiAgICogdGhhdCB0YWtlcyBhIHNpbmdsZSBhcmd1bWVudDogdGhlIG5hbWUgb2YgdGhlIHBhcnRpYWwuXG4gICAqXG4gICAqIElmIHRoZSBvcHRpb25hbCBgdGFnc2AgYXJndW1lbnQgaXMgZ2l2ZW4gaGVyZSBpdCBtdXN0IGJlIGFuIGFycmF5IHdpdGggdHdvXG4gICAqIHN0cmluZyB2YWx1ZXM6IHRoZSBvcGVuaW5nIGFuZCBjbG9zaW5nIHRhZ3MgdXNlZCBpbiB0aGUgdGVtcGxhdGUgKGUuZy5cbiAgICogWyBcIjwlXCIsIFwiJT5cIiBdKS4gVGhlIGRlZmF1bHQgaXMgdG8gbXVzdGFjaGUudGFncy5cbiAgICovXG4gIFdyaXRlci5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gcmVuZGVyICh0ZW1wbGF0ZSwgdmlldywgcGFydGlhbHMsIHRhZ3MpIHtcbiAgICB2YXIgdG9rZW5zID0gdGhpcy5wYXJzZSh0ZW1wbGF0ZSwgdGFncyk7XG4gICAgdmFyIGNvbnRleHQgPSAodmlldyBpbnN0YW5jZW9mIENvbnRleHQpID8gdmlldyA6IG5ldyBDb250ZXh0KHZpZXcpO1xuICAgIHJldHVybiB0aGlzLnJlbmRlclRva2Vucyh0b2tlbnMsIGNvbnRleHQsIHBhcnRpYWxzLCB0ZW1wbGF0ZSwgdGFncyk7XG4gIH07XG5cbiAgLyoqXG4gICAqIExvdy1sZXZlbCBtZXRob2QgdGhhdCByZW5kZXJzIHRoZSBnaXZlbiBhcnJheSBvZiBgdG9rZW5zYCB1c2luZ1xuICAgKiB0aGUgZ2l2ZW4gYGNvbnRleHRgIGFuZCBgcGFydGlhbHNgLlxuICAgKlxuICAgKiBOb3RlOiBUaGUgYG9yaWdpbmFsVGVtcGxhdGVgIGlzIG9ubHkgZXZlciB1c2VkIHRvIGV4dHJhY3QgdGhlIHBvcnRpb25cbiAgICogb2YgdGhlIG9yaWdpbmFsIHRlbXBsYXRlIHRoYXQgd2FzIGNvbnRhaW5lZCBpbiBhIGhpZ2hlci1vcmRlciBzZWN0aW9uLlxuICAgKiBJZiB0aGUgdGVtcGxhdGUgZG9lc24ndCB1c2UgaGlnaGVyLW9yZGVyIHNlY3Rpb25zLCB0aGlzIGFyZ3VtZW50IG1heVxuICAgKiBiZSBvbWl0dGVkLlxuICAgKi9cbiAgV3JpdGVyLnByb3RvdHlwZS5yZW5kZXJUb2tlbnMgPSBmdW5jdGlvbiByZW5kZXJUb2tlbnMgKHRva2VucywgY29udGV4dCwgcGFydGlhbHMsIG9yaWdpbmFsVGVtcGxhdGUsIHRhZ3MpIHtcbiAgICB2YXIgYnVmZmVyID0gJyc7XG5cbiAgICB2YXIgdG9rZW4sIHN5bWJvbCwgdmFsdWU7XG4gICAgZm9yICh2YXIgaSA9IDAsIG51bVRva2VucyA9IHRva2Vucy5sZW5ndGg7IGkgPCBudW1Ub2tlbnM7ICsraSkge1xuICAgICAgdmFsdWUgPSB1bmRlZmluZWQ7XG4gICAgICB0b2tlbiA9IHRva2Vuc1tpXTtcbiAgICAgIHN5bWJvbCA9IHRva2VuWzBdO1xuXG4gICAgICBpZiAoc3ltYm9sID09PSAnIycpIHZhbHVlID0gdGhpcy5yZW5kZXJTZWN0aW9uKHRva2VuLCBjb250ZXh0LCBwYXJ0aWFscywgb3JpZ2luYWxUZW1wbGF0ZSk7XG4gICAgICBlbHNlIGlmIChzeW1ib2wgPT09ICdeJykgdmFsdWUgPSB0aGlzLnJlbmRlckludmVydGVkKHRva2VuLCBjb250ZXh0LCBwYXJ0aWFscywgb3JpZ2luYWxUZW1wbGF0ZSk7XG4gICAgICBlbHNlIGlmIChzeW1ib2wgPT09ICc+JykgdmFsdWUgPSB0aGlzLnJlbmRlclBhcnRpYWwodG9rZW4sIGNvbnRleHQsIHBhcnRpYWxzLCB0YWdzKTtcbiAgICAgIGVsc2UgaWYgKHN5bWJvbCA9PT0gJyYnKSB2YWx1ZSA9IHRoaXMudW5lc2NhcGVkVmFsdWUodG9rZW4sIGNvbnRleHQpO1xuICAgICAgZWxzZSBpZiAoc3ltYm9sID09PSAnbmFtZScpIHZhbHVlID0gdGhpcy5lc2NhcGVkVmFsdWUodG9rZW4sIGNvbnRleHQpO1xuICAgICAgZWxzZSBpZiAoc3ltYm9sID09PSAndGV4dCcpIHZhbHVlID0gdGhpcy5yYXdWYWx1ZSh0b2tlbik7XG5cbiAgICAgIGlmICh2YWx1ZSAhPT0gdW5kZWZpbmVkKVxuICAgICAgICBidWZmZXIgKz0gdmFsdWU7XG4gICAgfVxuXG4gICAgcmV0dXJuIGJ1ZmZlcjtcbiAgfTtcblxuICBXcml0ZXIucHJvdG90eXBlLnJlbmRlclNlY3Rpb24gPSBmdW5jdGlvbiByZW5kZXJTZWN0aW9uICh0b2tlbiwgY29udGV4dCwgcGFydGlhbHMsIG9yaWdpbmFsVGVtcGxhdGUpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgdmFyIGJ1ZmZlciA9ICcnO1xuICAgIHZhciB2YWx1ZSA9IGNvbnRleHQubG9va3VwKHRva2VuWzFdKTtcblxuICAgIC8vIFRoaXMgZnVuY3Rpb24gaXMgdXNlZCB0byByZW5kZXIgYW4gYXJiaXRyYXJ5IHRlbXBsYXRlXG4gICAgLy8gaW4gdGhlIGN1cnJlbnQgY29udGV4dCBieSBoaWdoZXItb3JkZXIgc2VjdGlvbnMuXG4gICAgZnVuY3Rpb24gc3ViUmVuZGVyICh0ZW1wbGF0ZSkge1xuICAgICAgcmV0dXJuIHNlbGYucmVuZGVyKHRlbXBsYXRlLCBjb250ZXh0LCBwYXJ0aWFscyk7XG4gICAgfVxuXG4gICAgaWYgKCF2YWx1ZSkgcmV0dXJuO1xuXG4gICAgaWYgKGlzQXJyYXkodmFsdWUpKSB7XG4gICAgICBmb3IgKHZhciBqID0gMCwgdmFsdWVMZW5ndGggPSB2YWx1ZS5sZW5ndGg7IGogPCB2YWx1ZUxlbmd0aDsgKytqKSB7XG4gICAgICAgIGJ1ZmZlciArPSB0aGlzLnJlbmRlclRva2Vucyh0b2tlbls0XSwgY29udGV4dC5wdXNoKHZhbHVlW2pdKSwgcGFydGlhbHMsIG9yaWdpbmFsVGVtcGxhdGUpO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyB8fCB0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnIHx8IHR5cGVvZiB2YWx1ZSA9PT0gJ251bWJlcicpIHtcbiAgICAgIGJ1ZmZlciArPSB0aGlzLnJlbmRlclRva2Vucyh0b2tlbls0XSwgY29udGV4dC5wdXNoKHZhbHVlKSwgcGFydGlhbHMsIG9yaWdpbmFsVGVtcGxhdGUpO1xuICAgIH0gZWxzZSBpZiAoaXNGdW5jdGlvbih2YWx1ZSkpIHtcbiAgICAgIGlmICh0eXBlb2Ygb3JpZ2luYWxUZW1wbGF0ZSAhPT0gJ3N0cmluZycpXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignQ2Fubm90IHVzZSBoaWdoZXItb3JkZXIgc2VjdGlvbnMgd2l0aG91dCB0aGUgb3JpZ2luYWwgdGVtcGxhdGUnKTtcblxuICAgICAgLy8gRXh0cmFjdCB0aGUgcG9ydGlvbiBvZiB0aGUgb3JpZ2luYWwgdGVtcGxhdGUgdGhhdCB0aGUgc2VjdGlvbiBjb250YWlucy5cbiAgICAgIHZhbHVlID0gdmFsdWUuY2FsbChjb250ZXh0LnZpZXcsIG9yaWdpbmFsVGVtcGxhdGUuc2xpY2UodG9rZW5bM10sIHRva2VuWzVdKSwgc3ViUmVuZGVyKTtcblxuICAgICAgaWYgKHZhbHVlICE9IG51bGwpXG4gICAgICAgIGJ1ZmZlciArPSB2YWx1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgYnVmZmVyICs9IHRoaXMucmVuZGVyVG9rZW5zKHRva2VuWzRdLCBjb250ZXh0LCBwYXJ0aWFscywgb3JpZ2luYWxUZW1wbGF0ZSk7XG4gICAgfVxuICAgIHJldHVybiBidWZmZXI7XG4gIH07XG5cbiAgV3JpdGVyLnByb3RvdHlwZS5yZW5kZXJJbnZlcnRlZCA9IGZ1bmN0aW9uIHJlbmRlckludmVydGVkICh0b2tlbiwgY29udGV4dCwgcGFydGlhbHMsIG9yaWdpbmFsVGVtcGxhdGUpIHtcbiAgICB2YXIgdmFsdWUgPSBjb250ZXh0Lmxvb2t1cCh0b2tlblsxXSk7XG5cbiAgICAvLyBVc2UgSmF2YVNjcmlwdCdzIGRlZmluaXRpb24gb2YgZmFsc3kuIEluY2x1ZGUgZW1wdHkgYXJyYXlzLlxuICAgIC8vIFNlZSBodHRwczovL2dpdGh1Yi5jb20vamFubC9tdXN0YWNoZS5qcy9pc3N1ZXMvMTg2XG4gICAgaWYgKCF2YWx1ZSB8fCAoaXNBcnJheSh2YWx1ZSkgJiYgdmFsdWUubGVuZ3RoID09PSAwKSlcbiAgICAgIHJldHVybiB0aGlzLnJlbmRlclRva2Vucyh0b2tlbls0XSwgY29udGV4dCwgcGFydGlhbHMsIG9yaWdpbmFsVGVtcGxhdGUpO1xuICB9O1xuXG4gIFdyaXRlci5wcm90b3R5cGUucmVuZGVyUGFydGlhbCA9IGZ1bmN0aW9uIHJlbmRlclBhcnRpYWwgKHRva2VuLCBjb250ZXh0LCBwYXJ0aWFscywgdGFncykge1xuICAgIGlmICghcGFydGlhbHMpIHJldHVybjtcblxuICAgIHZhciB2YWx1ZSA9IGlzRnVuY3Rpb24ocGFydGlhbHMpID8gcGFydGlhbHModG9rZW5bMV0pIDogcGFydGlhbHNbdG9rZW5bMV1dO1xuICAgIGlmICh2YWx1ZSAhPSBudWxsKVxuICAgICAgcmV0dXJuIHRoaXMucmVuZGVyVG9rZW5zKHRoaXMucGFyc2UodmFsdWUsIHRhZ3MpLCBjb250ZXh0LCBwYXJ0aWFscywgdmFsdWUpO1xuICB9O1xuXG4gIFdyaXRlci5wcm90b3R5cGUudW5lc2NhcGVkVmFsdWUgPSBmdW5jdGlvbiB1bmVzY2FwZWRWYWx1ZSAodG9rZW4sIGNvbnRleHQpIHtcbiAgICB2YXIgdmFsdWUgPSBjb250ZXh0Lmxvb2t1cCh0b2tlblsxXSk7XG4gICAgaWYgKHZhbHVlICE9IG51bGwpXG4gICAgICByZXR1cm4gdmFsdWU7XG4gIH07XG5cbiAgV3JpdGVyLnByb3RvdHlwZS5lc2NhcGVkVmFsdWUgPSBmdW5jdGlvbiBlc2NhcGVkVmFsdWUgKHRva2VuLCBjb250ZXh0KSB7XG4gICAgdmFyIHZhbHVlID0gY29udGV4dC5sb29rdXAodG9rZW5bMV0pO1xuICAgIGlmICh2YWx1ZSAhPSBudWxsKVxuICAgICAgcmV0dXJuIG11c3RhY2hlLmVzY2FwZSh2YWx1ZSk7XG4gIH07XG5cbiAgV3JpdGVyLnByb3RvdHlwZS5yYXdWYWx1ZSA9IGZ1bmN0aW9uIHJhd1ZhbHVlICh0b2tlbikge1xuICAgIHJldHVybiB0b2tlblsxXTtcbiAgfTtcblxuICBtdXN0YWNoZS5uYW1lID0gJ211c3RhY2hlLmpzJztcbiAgbXVzdGFjaGUudmVyc2lvbiA9ICczLjAuMSc7XG4gIG11c3RhY2hlLnRhZ3MgPSBbICd7eycsICd9fScgXTtcblxuICAvLyBBbGwgaGlnaC1sZXZlbCBtdXN0YWNoZS4qIGZ1bmN0aW9ucyB1c2UgdGhpcyB3cml0ZXIuXG4gIHZhciBkZWZhdWx0V3JpdGVyID0gbmV3IFdyaXRlcigpO1xuXG4gIC8qKlxuICAgKiBDbGVhcnMgYWxsIGNhY2hlZCB0ZW1wbGF0ZXMgaW4gdGhlIGRlZmF1bHQgd3JpdGVyLlxuICAgKi9cbiAgbXVzdGFjaGUuY2xlYXJDYWNoZSA9IGZ1bmN0aW9uIGNsZWFyQ2FjaGUgKCkge1xuICAgIHJldHVybiBkZWZhdWx0V3JpdGVyLmNsZWFyQ2FjaGUoKTtcbiAgfTtcblxuICAvKipcbiAgICogUGFyc2VzIGFuZCBjYWNoZXMgdGhlIGdpdmVuIHRlbXBsYXRlIGluIHRoZSBkZWZhdWx0IHdyaXRlciBhbmQgcmV0dXJucyB0aGVcbiAgICogYXJyYXkgb2YgdG9rZW5zIGl0IGNvbnRhaW5zLiBEb2luZyB0aGlzIGFoZWFkIG9mIHRpbWUgYXZvaWRzIHRoZSBuZWVkIHRvXG4gICAqIHBhcnNlIHRlbXBsYXRlcyBvbiB0aGUgZmx5IGFzIHRoZXkgYXJlIHJlbmRlcmVkLlxuICAgKi9cbiAgbXVzdGFjaGUucGFyc2UgPSBmdW5jdGlvbiBwYXJzZSAodGVtcGxhdGUsIHRhZ3MpIHtcbiAgICByZXR1cm4gZGVmYXVsdFdyaXRlci5wYXJzZSh0ZW1wbGF0ZSwgdGFncyk7XG4gIH07XG5cbiAgLyoqXG4gICAqIFJlbmRlcnMgdGhlIGB0ZW1wbGF0ZWAgd2l0aCB0aGUgZ2l2ZW4gYHZpZXdgIGFuZCBgcGFydGlhbHNgIHVzaW5nIHRoZVxuICAgKiBkZWZhdWx0IHdyaXRlci4gSWYgdGhlIG9wdGlvbmFsIGB0YWdzYCBhcmd1bWVudCBpcyBnaXZlbiBoZXJlIGl0IG11c3QgYmUgYW5cbiAgICogYXJyYXkgd2l0aCB0d28gc3RyaW5nIHZhbHVlczogdGhlIG9wZW5pbmcgYW5kIGNsb3NpbmcgdGFncyB1c2VkIGluIHRoZVxuICAgKiB0ZW1wbGF0ZSAoZS5nLiBbIFwiPCVcIiwgXCIlPlwiIF0pLiBUaGUgZGVmYXVsdCBpcyB0byBtdXN0YWNoZS50YWdzLlxuICAgKi9cbiAgbXVzdGFjaGUucmVuZGVyID0gZnVuY3Rpb24gcmVuZGVyICh0ZW1wbGF0ZSwgdmlldywgcGFydGlhbHMsIHRhZ3MpIHtcbiAgICBpZiAodHlwZW9mIHRlbXBsYXRlICE9PSAnc3RyaW5nJykge1xuICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignSW52YWxpZCB0ZW1wbGF0ZSEgVGVtcGxhdGUgc2hvdWxkIGJlIGEgXCJzdHJpbmdcIiAnICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgJ2J1dCBcIicgKyB0eXBlU3RyKHRlbXBsYXRlKSArICdcIiB3YXMgZ2l2ZW4gYXMgdGhlIGZpcnN0ICcgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAnYXJndW1lbnQgZm9yIG11c3RhY2hlI3JlbmRlcih0ZW1wbGF0ZSwgdmlldywgcGFydGlhbHMpJyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGRlZmF1bHRXcml0ZXIucmVuZGVyKHRlbXBsYXRlLCB2aWV3LCBwYXJ0aWFscywgdGFncyk7XG4gIH07XG5cbiAgLy8gVGhpcyBpcyBoZXJlIGZvciBiYWNrd2FyZHMgY29tcGF0aWJpbGl0eSB3aXRoIDAuNC54LixcbiAgLyplc2xpbnQtZGlzYWJsZSAqLyAvLyBlc2xpbnQgd2FudHMgY2FtZWwgY2FzZWQgZnVuY3Rpb24gbmFtZVxuICBtdXN0YWNoZS50b19odG1sID0gZnVuY3Rpb24gdG9faHRtbCAodGVtcGxhdGUsIHZpZXcsIHBhcnRpYWxzLCBzZW5kKSB7XG4gICAgLyplc2xpbnQtZW5hYmxlKi9cblxuICAgIHZhciByZXN1bHQgPSBtdXN0YWNoZS5yZW5kZXIodGVtcGxhdGUsIHZpZXcsIHBhcnRpYWxzKTtcblxuICAgIGlmIChpc0Z1bmN0aW9uKHNlbmQpKSB7XG4gICAgICBzZW5kKHJlc3VsdCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuICB9O1xuXG4gIC8vIEV4cG9ydCB0aGUgZXNjYXBpbmcgZnVuY3Rpb24gc28gdGhhdCB0aGUgdXNlciBtYXkgb3ZlcnJpZGUgaXQuXG4gIC8vIFNlZSBodHRwczovL2dpdGh1Yi5jb20vamFubC9tdXN0YWNoZS5qcy9pc3N1ZXMvMjQ0XG4gIG11c3RhY2hlLmVzY2FwZSA9IGVzY2FwZUh0bWw7XG5cbiAgLy8gRXhwb3J0IHRoZXNlIG1haW5seSBmb3IgdGVzdGluZywgYnV0IGFsc28gZm9yIGFkdmFuY2VkIHVzYWdlLlxuICBtdXN0YWNoZS5TY2FubmVyID0gU2Nhbm5lcjtcbiAgbXVzdGFjaGUuQ29udGV4dCA9IENvbnRleHQ7XG4gIG11c3RhY2hlLldyaXRlciA9IFdyaXRlcjtcblxuICByZXR1cm4gbXVzdGFjaGU7XG59KSk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUNBLFdBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///bcd31d01884fc294fd69\n");

/***/ }),

/***/ "bd13ec831aaf61fba460":
/*!****************************************************************!*\
  !*** ./src/Apps/DOCUMENT/IHM/widgets/attributes/date/wDate.js ***!
  \****************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/*global define */\n\n(function umdRequire(root, factory) {\n  \"use strict\";\n\n  if (true) {\n    !(__WEBPACK_AMD_DEFINE_ARRAY__ = [\n      __webpack_require__(/*! jquery */ \"127c8cf59f228bb01a21\"),\n      __webpack_require__(/*! underscore */ \"8e08e542008e4aef1f58\"),\n      __webpack_require__(/*! mustache */ \"bcd31d01884fc294fd69\"),\n      __webpack_require__(/*! dcpDocument/widgets/attributes/text/wText */ \"61b480911316cdda77a4\"),\n      __webpack_require__(/*! kendo-culture-fr */ \"3d2e52a160dc74b891c1\")\n    ], __WEBPACK_AMD_DEFINE_FACTORY__ = (factory),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?\n\t\t\t\t(__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n  } else {}\n})(window, function wDate($, _, Mustache) {\n  \"use strict\";\n\n  $.widget(\"dcp.dcpDate\", $.dcp.dcpText, {\n    options: {\n      type: \"date\",\n      minDate: new Date(1700, 0, 1),\n      renderOptions: {\n        kendoDateConfiguration: {\n          parseFormats: [\"yyyy-MM-dd\"],\n          format: null\n        }\n      },\n      labels: {\n        invalidDate: \"Invalid Date\"\n      }\n    },\n\n    kendoWidgetClass: \"kendoDatePicker\",\n\n    _initDom: function wDateInitDom() {\n      if (this.options.renderOptions.kendoDateConfiguration.format) {\n        this.options.attributeValue.displayValue = this.formatDate(\n          this.parseDate(this.options.attributeValue.value)\n        );\n      }\n      if (this.getMode() === \"read\") {\n        if (this.options.renderOptions.format) {\n          this.options.attributeValue.formatValue = Mustache.render(\n            this.options.renderOptions.format || \"\",\n            this.options.attributeValue\n          );\n        }\n      }\n      this.element.addClass(\"dcpAttribute__content\");\n      this.element.attr(\"data-type\", this.getType());\n      this.element.attr(\"data-attrid\", this.options.id);\n      //noinspection JSPotentiallyInvalidConstructorUsage,JSAccessibilityCheck\n      $.dcp.dcpAttribute.prototype._initDom.apply(this, []);\n\n      this.kendoWidget = this.element.find(\".dcpAttribute__value--edit\");\n\n      if (this.kendoWidget.length) {\n        if (this.options.hasAutocomplete) {\n          this.activateAutocomplete(this.kendoWidget);\n        } else {\n          this._activateDate(this.kendoWidget);\n        }\n      }\n\n      if (\n        this.element.find(\".dcpAttribute__content__buttons button\").length === 0\n      ) {\n        this.element\n          .find(\".k-picker-wrap\")\n          .addClass(\"dcpAttribute__content__nobutton\");\n      }\n    },\n\n    _initChangeEvent: function wDate_initChangeEvent() {\n      // set by widget if no autocomplete\n      if (this.options.hasAutocomplete) {\n        this._super();\n      }\n    },\n\n    setValue: function wDateSetValue(value) {\n      // this._super.(value);\n      // Don't call dcpText::setValue()\n\n      var originalValue, originalDate;\n      value = _.clone(value);\n      if (_.has(value, \"value\") && !_.has(value, \"displayValue\")) {\n        value.displayValue = this.formatDate(this.parseDate(value.value));\n      } else {\n        if (this.options.renderOptions.kendoDateConfiguration.format) {\n          value.displayValue = this.formatDate(this.parseDate(value.value));\n        }\n      }\n\n      //noinspection JSPotentiallyInvalidConstructorUsage\n      $.dcp.dcpAttribute.prototype.setValue.call(this, value);\n\n      if (this.getMode() === \"write\") {\n        originalValue = this.convertDateToPseudoIsoString(\n          this.kendoWidget.data(this.kendoWidgetClass).value()\n        );\n        // : explicit lazy equal\n        //noinspection JSHint, EqualityComparisonWithCoercionJS\n        if (originalValue != value.value) {\n          if (value.value) {\n            originalDate = new Date(value.value);\n            if (!isNaN(originalDate.getTime())) {\n              this.kendoWidget.data(this.kendoWidgetClass).value(originalDate);\n            }\n          } else {\n            this.getContentElements().val(\"\");\n          }\n          // Modify value only if different\n          if (originalValue || value.value) {\n            this.flashElement();\n          }\n        }\n      } else if (this.getMode() === \"read\") {\n        this.getContentElements().text(value.displayValue);\n      } else {\n        throw new Error(\n          \"Attribute \" + this.options.id + \" unkown mode \" + this.getMode()\n        );\n      }\n    },\n\n    _activateDate: function wDateSetValueActivateDate(inputValue) {\n      var currentWidget = this;\n      var kOptions = this.getKendoOptions();\n\n      kOptions.change = function wDateChange() {\n        if (this.value() !== null) {\n          // only valid date are setted\n          // wrong date are set by blur event\n          var isoDate = currentWidget.convertDateToPseudoIsoString(\n            this.value()\n          );\n          // Need to set by widget to use raw date\n          currentWidget.setValue({\n            value: isoDate,\n            displayValue: inputValue.val()\n          });\n        }\n      };\n\n      inputValue.kendoDatePicker(kOptions);\n\n      // Workaround for date paste : change event is not trigger in this case\n      inputValue.on(\"paste\" + this.eventNamespace, function wDatePaste() {\n        var $input = $(this);\n        _.defer(function wDatePasteAfter() {\n          // set Value after\n          inputValue.data(\"kendoDatePicker\").value($input.val().trim());\n          inputValue.data(\"kendoDatePicker\").trigger(\"change\");\n        });\n      });\n\n      this._controlDate(inputValue);\n    },\n\n    _controlDate: function wDateControlDate(inputValue) {\n      var currentWidget = this;\n      inputValue.on(\n        \"blur\" + this.eventNamespace,\n        function validateDate(/*event*/) {\n          var dateValue = $(this)\n            .val()\n            .trim();\n\n          if (currentWidget.invalidDate) {\n            currentWidget.setError(null); // clear Error before\n            currentWidget.invalidDate = false;\n          }\n\n          currentWidget._setVisibilitySavingMenu(\"visible\");\n\n          if (dateValue) {\n            if (!currentWidget.parseDate(dateValue)) {\n              currentWidget._setVisibilitySavingMenu(\"disabled\");\n              _.defer(function wDateFocus() {\n                currentWidget._getFocusInput().focus();\n              });\n              currentWidget.invalidDate = true;\n              currentWidget.setError(currentWidget.options.labels.invalidDate);\n            }\n          }\n        }\n      );\n    },\n\n    formatDate: function wDateFormatDate(value) {\n      if (this.options.renderOptions.kendoDateConfiguration.format) {\n        return kendo.toString(\n          value,\n          this.options.renderOptions.kendoDateConfiguration.format\n        );\n      }\n      return kendo.toString(value, \"d\");\n    },\n\n    parseDate: function wDateParseDate(value) {\n      var parseFormat = this.options.renderOptions.kendoDateConfiguration\n        .parseFormats;\n      var goodDate = kendo.parseDate(value);\n      if (goodDate) {\n        return goodDate;\n      }\n      if (this.options.renderOptions.kendoDateConfiguration.format) {\n        parseFormat.push(\n          this.options.renderOptions.kendoDateConfiguration.format\n        );\n      }\n      return kendo.parseDate(value, parseFormat);\n    },\n\n    convertDateToPseudoIsoString: function wDateconvertDateToPseudoIsoString(\n      dateObject\n    ) {\n      if (dateObject && _.isDate(dateObject)) {\n        return (\n          dateObject.getFullYear() +\n          \"-\" +\n          this.padNumber(dateObject.getMonth() + 1) +\n          \"-\" +\n          this.padNumber(dateObject.getDate())\n        );\n      }\n      return \"\";\n    },\n\n    padNumber: function wDatePadNumber(number) {\n      if (number < 10) {\n        return \"0\" + number;\n      }\n      return number;\n    },\n\n    /**\n     * Get kendo option from normal options and from renderOptions.kendoNumeric\n     * @returns {*}\n     */\n    getKendoOptions: function wDategetKendoOptions() {\n      var currentWidget = this,\n        kendoOptions = {},\n        defaultOptions = {\n          min: this.options.minDate\n        };\n\n      if (\n        _.isObject(currentWidget.options.renderOptions.kendoDateConfiguration)\n      ) {\n        kendoOptions =\n          currentWidget.options.renderOptions.kendoDateConfiguration;\n      }\n\n      return _.extend(defaultOptions, kendoOptions);\n    },\n\n    close: function wDate_close() {\n      if (this.kendoWidget.data(this.kendoWidgetClass)) {\n        this.kendoWidget.data(this.kendoWidgetClass).close();\n      }\n      return this._super();\n    },\n\n    _destroy: function wDateDestroy() {\n      if (this.kendoWidget.data(this.kendoWidgetClass)) {\n        this.kendoWidget.data(this.kendoWidgetClass).destroy();\n      }\n      this._super();\n    }\n  });\n\n  return $.fn.dcpDate;\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmQxM2VjODMxYWFmNjFmYmE0NjAuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvQXBwcy9ET0NVTUVOVC9JSE0vd2lkZ2V0cy9hdHRyaWJ1dGVzL2RhdGUvd0RhdGUuanM/NGM4ZiJdLCJzb3VyY2VzQ29udGVudCI6WyIvKmdsb2JhbCBkZWZpbmUgKi9cblxuKGZ1bmN0aW9uIHVtZFJlcXVpcmUocm9vdCwgZmFjdG9yeSkge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICBpZiAodHlwZW9mIGRlZmluZSA9PT0gXCJmdW5jdGlvblwiICYmIGRlZmluZS5hbWQpIHtcbiAgICBkZWZpbmUoW1xuICAgICAgXCJqcXVlcnlcIixcbiAgICAgIFwidW5kZXJzY29yZVwiLFxuICAgICAgXCJtdXN0YWNoZVwiLFxuICAgICAgXCJkY3BEb2N1bWVudC93aWRnZXRzL2F0dHJpYnV0ZXMvdGV4dC93VGV4dFwiLFxuICAgICAgXCJrZW5kby1jdWx0dXJlLWZyXCJcbiAgICBdLCBmYWN0b3J5KTtcbiAgfSBlbHNlIHtcbiAgICAvL25vaW5zcGVjdGlvbiBKU1VucmVzb2x2ZWRWYXJpYWJsZVxuICAgIGZhY3Rvcnkod2luZG93LmpRdWVyeSwgd2luZG93Ll8sIHdpbmRvdy5NdXN0YWNoZSk7XG4gIH1cbn0pKHdpbmRvdywgZnVuY3Rpb24gd0RhdGUoJCwgXywgTXVzdGFjaGUpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgJC53aWRnZXQoXCJkY3AuZGNwRGF0ZVwiLCAkLmRjcC5kY3BUZXh0LCB7XG4gICAgb3B0aW9uczoge1xuICAgICAgdHlwZTogXCJkYXRlXCIsXG4gICAgICBtaW5EYXRlOiBuZXcgRGF0ZSgxNzAwLCAwLCAxKSxcbiAgICAgIHJlbmRlck9wdGlvbnM6IHtcbiAgICAgICAga2VuZG9EYXRlQ29uZmlndXJhdGlvbjoge1xuICAgICAgICAgIHBhcnNlRm9ybWF0czogW1wieXl5eS1NTS1kZFwiXSxcbiAgICAgICAgICBmb3JtYXQ6IG51bGxcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGxhYmVsczoge1xuICAgICAgICBpbnZhbGlkRGF0ZTogXCJJbnZhbGlkIERhdGVcIlxuICAgICAgfVxuICAgIH0sXG5cbiAgICBrZW5kb1dpZGdldENsYXNzOiBcImtlbmRvRGF0ZVBpY2tlclwiLFxuXG4gICAgX2luaXREb206IGZ1bmN0aW9uIHdEYXRlSW5pdERvbSgpIHtcbiAgICAgIGlmICh0aGlzLm9wdGlvbnMucmVuZGVyT3B0aW9ucy5rZW5kb0RhdGVDb25maWd1cmF0aW9uLmZvcm1hdCkge1xuICAgICAgICB0aGlzLm9wdGlvbnMuYXR0cmlidXRlVmFsdWUuZGlzcGxheVZhbHVlID0gdGhpcy5mb3JtYXREYXRlKFxuICAgICAgICAgIHRoaXMucGFyc2VEYXRlKHRoaXMub3B0aW9ucy5hdHRyaWJ1dGVWYWx1ZS52YWx1ZSlcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLmdldE1vZGUoKSA9PT0gXCJyZWFkXCIpIHtcbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5yZW5kZXJPcHRpb25zLmZvcm1hdCkge1xuICAgICAgICAgIHRoaXMub3B0aW9ucy5hdHRyaWJ1dGVWYWx1ZS5mb3JtYXRWYWx1ZSA9IE11c3RhY2hlLnJlbmRlcihcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucy5yZW5kZXJPcHRpb25zLmZvcm1hdCB8fCBcIlwiLFxuICAgICAgICAgICAgdGhpcy5vcHRpb25zLmF0dHJpYnV0ZVZhbHVlXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgdGhpcy5lbGVtZW50LmFkZENsYXNzKFwiZGNwQXR0cmlidXRlX19jb250ZW50XCIpO1xuICAgICAgdGhpcy5lbGVtZW50LmF0dHIoXCJkYXRhLXR5cGVcIiwgdGhpcy5nZXRUeXBlKCkpO1xuICAgICAgdGhpcy5lbGVtZW50LmF0dHIoXCJkYXRhLWF0dHJpZFwiLCB0aGlzLm9wdGlvbnMuaWQpO1xuICAgICAgLy9ub2luc3BlY3Rpb24gSlNQb3RlbnRpYWxseUludmFsaWRDb25zdHJ1Y3RvclVzYWdlLEpTQWNjZXNzaWJpbGl0eUNoZWNrXG4gICAgICAkLmRjcC5kY3BBdHRyaWJ1dGUucHJvdG90eXBlLl9pbml0RG9tLmFwcGx5KHRoaXMsIFtdKTtcblxuICAgICAgdGhpcy5rZW5kb1dpZGdldCA9IHRoaXMuZWxlbWVudC5maW5kKFwiLmRjcEF0dHJpYnV0ZV9fdmFsdWUtLWVkaXRcIik7XG5cbiAgICAgIGlmICh0aGlzLmtlbmRvV2lkZ2V0Lmxlbmd0aCkge1xuICAgICAgICBpZiAodGhpcy5vcHRpb25zLmhhc0F1dG9jb21wbGV0ZSkge1xuICAgICAgICAgIHRoaXMuYWN0aXZhdGVBdXRvY29tcGxldGUodGhpcy5rZW5kb1dpZGdldCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5fYWN0aXZhdGVEYXRlKHRoaXMua2VuZG9XaWRnZXQpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmIChcbiAgICAgICAgdGhpcy5lbGVtZW50LmZpbmQoXCIuZGNwQXR0cmlidXRlX19jb250ZW50X19idXR0b25zIGJ1dHRvblwiKS5sZW5ndGggPT09IDBcbiAgICAgICkge1xuICAgICAgICB0aGlzLmVsZW1lbnRcbiAgICAgICAgICAuZmluZChcIi5rLXBpY2tlci13cmFwXCIpXG4gICAgICAgICAgLmFkZENsYXNzKFwiZGNwQXR0cmlidXRlX19jb250ZW50X19ub2J1dHRvblwiKTtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgX2luaXRDaGFuZ2VFdmVudDogZnVuY3Rpb24gd0RhdGVfaW5pdENoYW5nZUV2ZW50KCkge1xuICAgICAgLy8gc2V0IGJ5IHdpZGdldCBpZiBubyBhdXRvY29tcGxldGVcbiAgICAgIGlmICh0aGlzLm9wdGlvbnMuaGFzQXV0b2NvbXBsZXRlKSB7XG4gICAgICAgIHRoaXMuX3N1cGVyKCk7XG4gICAgICB9XG4gICAgfSxcblxuICAgIHNldFZhbHVlOiBmdW5jdGlvbiB3RGF0ZVNldFZhbHVlKHZhbHVlKSB7XG4gICAgICAvLyB0aGlzLl9zdXBlci4odmFsdWUpO1xuICAgICAgLy8gRG9uJ3QgY2FsbCBkY3BUZXh0OjpzZXRWYWx1ZSgpXG5cbiAgICAgIHZhciBvcmlnaW5hbFZhbHVlLCBvcmlnaW5hbERhdGU7XG4gICAgICB2YWx1ZSA9IF8uY2xvbmUodmFsdWUpO1xuICAgICAgaWYgKF8uaGFzKHZhbHVlLCBcInZhbHVlXCIpICYmICFfLmhhcyh2YWx1ZSwgXCJkaXNwbGF5VmFsdWVcIikpIHtcbiAgICAgICAgdmFsdWUuZGlzcGxheVZhbHVlID0gdGhpcy5mb3JtYXREYXRlKHRoaXMucGFyc2VEYXRlKHZhbHVlLnZhbHVlKSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAodGhpcy5vcHRpb25zLnJlbmRlck9wdGlvbnMua2VuZG9EYXRlQ29uZmlndXJhdGlvbi5mb3JtYXQpIHtcbiAgICAgICAgICB2YWx1ZS5kaXNwbGF5VmFsdWUgPSB0aGlzLmZvcm1hdERhdGUodGhpcy5wYXJzZURhdGUodmFsdWUudmFsdWUpKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvL25vaW5zcGVjdGlvbiBKU1BvdGVudGlhbGx5SW52YWxpZENvbnN0cnVjdG9yVXNhZ2VcbiAgICAgICQuZGNwLmRjcEF0dHJpYnV0ZS5wcm90b3R5cGUuc2V0VmFsdWUuY2FsbCh0aGlzLCB2YWx1ZSk7XG5cbiAgICAgIGlmICh0aGlzLmdldE1vZGUoKSA9PT0gXCJ3cml0ZVwiKSB7XG4gICAgICAgIG9yaWdpbmFsVmFsdWUgPSB0aGlzLmNvbnZlcnREYXRlVG9Qc2V1ZG9Jc29TdHJpbmcoXG4gICAgICAgICAgdGhpcy5rZW5kb1dpZGdldC5kYXRhKHRoaXMua2VuZG9XaWRnZXRDbGFzcykudmFsdWUoKVxuICAgICAgICApO1xuICAgICAgICAvLyA6IGV4cGxpY2l0IGxhenkgZXF1YWxcbiAgICAgICAgLy9ub2luc3BlY3Rpb24gSlNIaW50LCBFcXVhbGl0eUNvbXBhcmlzb25XaXRoQ29lcmNpb25KU1xuICAgICAgICBpZiAob3JpZ2luYWxWYWx1ZSAhPSB2YWx1ZS52YWx1ZSkge1xuICAgICAgICAgIGlmICh2YWx1ZS52YWx1ZSkge1xuICAgICAgICAgICAgb3JpZ2luYWxEYXRlID0gbmV3IERhdGUodmFsdWUudmFsdWUpO1xuICAgICAgICAgICAgaWYgKCFpc05hTihvcmlnaW5hbERhdGUuZ2V0VGltZSgpKSkge1xuICAgICAgICAgICAgICB0aGlzLmtlbmRvV2lkZ2V0LmRhdGEodGhpcy5rZW5kb1dpZGdldENsYXNzKS52YWx1ZShvcmlnaW5hbERhdGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmdldENvbnRlbnRFbGVtZW50cygpLnZhbChcIlwiKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgLy8gTW9kaWZ5IHZhbHVlIG9ubHkgaWYgZGlmZmVyZW50XG4gICAgICAgICAgaWYgKG9yaWdpbmFsVmFsdWUgfHwgdmFsdWUudmFsdWUpIHtcbiAgICAgICAgICAgIHRoaXMuZmxhc2hFbGVtZW50KCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKHRoaXMuZ2V0TW9kZSgpID09PSBcInJlYWRcIikge1xuICAgICAgICB0aGlzLmdldENvbnRlbnRFbGVtZW50cygpLnRleHQodmFsdWUuZGlzcGxheVZhbHVlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICBcIkF0dHJpYnV0ZSBcIiArIHRoaXMub3B0aW9ucy5pZCArIFwiIHVua293biBtb2RlIFwiICsgdGhpcy5nZXRNb2RlKClcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgX2FjdGl2YXRlRGF0ZTogZnVuY3Rpb24gd0RhdGVTZXRWYWx1ZUFjdGl2YXRlRGF0ZShpbnB1dFZhbHVlKSB7XG4gICAgICB2YXIgY3VycmVudFdpZGdldCA9IHRoaXM7XG4gICAgICB2YXIga09wdGlvbnMgPSB0aGlzLmdldEtlbmRvT3B0aW9ucygpO1xuXG4gICAgICBrT3B0aW9ucy5jaGFuZ2UgPSBmdW5jdGlvbiB3RGF0ZUNoYW5nZSgpIHtcbiAgICAgICAgaWYgKHRoaXMudmFsdWUoKSAhPT0gbnVsbCkge1xuICAgICAgICAgIC8vIG9ubHkgdmFsaWQgZGF0ZSBhcmUgc2V0dGVkXG4gICAgICAgICAgLy8gd3JvbmcgZGF0ZSBhcmUgc2V0IGJ5IGJsdXIgZXZlbnRcbiAgICAgICAgICB2YXIgaXNvRGF0ZSA9IGN1cnJlbnRXaWRnZXQuY29udmVydERhdGVUb1BzZXVkb0lzb1N0cmluZyhcbiAgICAgICAgICAgIHRoaXMudmFsdWUoKVxuICAgICAgICAgICk7XG4gICAgICAgICAgLy8gTmVlZCB0byBzZXQgYnkgd2lkZ2V0IHRvIHVzZSByYXcgZGF0ZVxuICAgICAgICAgIGN1cnJlbnRXaWRnZXQuc2V0VmFsdWUoe1xuICAgICAgICAgICAgdmFsdWU6IGlzb0RhdGUsXG4gICAgICAgICAgICBkaXNwbGF5VmFsdWU6IGlucHV0VmFsdWUudmFsKClcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgaW5wdXRWYWx1ZS5rZW5kb0RhdGVQaWNrZXIoa09wdGlvbnMpO1xuXG4gICAgICAvLyBXb3JrYXJvdW5kIGZvciBkYXRlIHBhc3RlIDogY2hhbmdlIGV2ZW50IGlzIG5vdCB0cmlnZ2VyIGluIHRoaXMgY2FzZVxuICAgICAgaW5wdXRWYWx1ZS5vbihcInBhc3RlXCIgKyB0aGlzLmV2ZW50TmFtZXNwYWNlLCBmdW5jdGlvbiB3RGF0ZVBhc3RlKCkge1xuICAgICAgICB2YXIgJGlucHV0ID0gJCh0aGlzKTtcbiAgICAgICAgXy5kZWZlcihmdW5jdGlvbiB3RGF0ZVBhc3RlQWZ0ZXIoKSB7XG4gICAgICAgICAgLy8gc2V0IFZhbHVlIGFmdGVyXG4gICAgICAgICAgaW5wdXRWYWx1ZS5kYXRhKFwia2VuZG9EYXRlUGlja2VyXCIpLnZhbHVlKCRpbnB1dC52YWwoKS50cmltKCkpO1xuICAgICAgICAgIGlucHV0VmFsdWUuZGF0YShcImtlbmRvRGF0ZVBpY2tlclwiKS50cmlnZ2VyKFwiY2hhbmdlXCIpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLl9jb250cm9sRGF0ZShpbnB1dFZhbHVlKTtcbiAgICB9LFxuXG4gICAgX2NvbnRyb2xEYXRlOiBmdW5jdGlvbiB3RGF0ZUNvbnRyb2xEYXRlKGlucHV0VmFsdWUpIHtcbiAgICAgIHZhciBjdXJyZW50V2lkZ2V0ID0gdGhpcztcbiAgICAgIGlucHV0VmFsdWUub24oXG4gICAgICAgIFwiYmx1clwiICsgdGhpcy5ldmVudE5hbWVzcGFjZSxcbiAgICAgICAgZnVuY3Rpb24gdmFsaWRhdGVEYXRlKC8qZXZlbnQqLykge1xuICAgICAgICAgIHZhciBkYXRlVmFsdWUgPSAkKHRoaXMpXG4gICAgICAgICAgICAudmFsKClcbiAgICAgICAgICAgIC50cmltKCk7XG5cbiAgICAgICAgICBpZiAoY3VycmVudFdpZGdldC5pbnZhbGlkRGF0ZSkge1xuICAgICAgICAgICAgY3VycmVudFdpZGdldC5zZXRFcnJvcihudWxsKTsgLy8gY2xlYXIgRXJyb3IgYmVmb3JlXG4gICAgICAgICAgICBjdXJyZW50V2lkZ2V0LmludmFsaWREYXRlID0gZmFsc2U7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgY3VycmVudFdpZGdldC5fc2V0VmlzaWJpbGl0eVNhdmluZ01lbnUoXCJ2aXNpYmxlXCIpO1xuXG4gICAgICAgICAgaWYgKGRhdGVWYWx1ZSkge1xuICAgICAgICAgICAgaWYgKCFjdXJyZW50V2lkZ2V0LnBhcnNlRGF0ZShkYXRlVmFsdWUpKSB7XG4gICAgICAgICAgICAgIGN1cnJlbnRXaWRnZXQuX3NldFZpc2liaWxpdHlTYXZpbmdNZW51KFwiZGlzYWJsZWRcIik7XG4gICAgICAgICAgICAgIF8uZGVmZXIoZnVuY3Rpb24gd0RhdGVGb2N1cygpIHtcbiAgICAgICAgICAgICAgICBjdXJyZW50V2lkZ2V0Ll9nZXRGb2N1c0lucHV0KCkuZm9jdXMoKTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIGN1cnJlbnRXaWRnZXQuaW52YWxpZERhdGUgPSB0cnVlO1xuICAgICAgICAgICAgICBjdXJyZW50V2lkZ2V0LnNldEVycm9yKGN1cnJlbnRXaWRnZXQub3B0aW9ucy5sYWJlbHMuaW52YWxpZERhdGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgKTtcbiAgICB9LFxuXG4gICAgZm9ybWF0RGF0ZTogZnVuY3Rpb24gd0RhdGVGb3JtYXREYXRlKHZhbHVlKSB7XG4gICAgICBpZiAodGhpcy5vcHRpb25zLnJlbmRlck9wdGlvbnMua2VuZG9EYXRlQ29uZmlndXJhdGlvbi5mb3JtYXQpIHtcbiAgICAgICAgcmV0dXJuIGtlbmRvLnRvU3RyaW5nKFxuICAgICAgICAgIHZhbHVlLFxuICAgICAgICAgIHRoaXMub3B0aW9ucy5yZW5kZXJPcHRpb25zLmtlbmRvRGF0ZUNvbmZpZ3VyYXRpb24uZm9ybWF0XG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICByZXR1cm4ga2VuZG8udG9TdHJpbmcodmFsdWUsIFwiZFwiKTtcbiAgICB9LFxuXG4gICAgcGFyc2VEYXRlOiBmdW5jdGlvbiB3RGF0ZVBhcnNlRGF0ZSh2YWx1ZSkge1xuICAgICAgdmFyIHBhcnNlRm9ybWF0ID0gdGhpcy5vcHRpb25zLnJlbmRlck9wdGlvbnMua2VuZG9EYXRlQ29uZmlndXJhdGlvblxuICAgICAgICAucGFyc2VGb3JtYXRzO1xuICAgICAgdmFyIGdvb2REYXRlID0ga2VuZG8ucGFyc2VEYXRlKHZhbHVlKTtcbiAgICAgIGlmIChnb29kRGF0ZSkge1xuICAgICAgICByZXR1cm4gZ29vZERhdGU7XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5vcHRpb25zLnJlbmRlck9wdGlvbnMua2VuZG9EYXRlQ29uZmlndXJhdGlvbi5mb3JtYXQpIHtcbiAgICAgICAgcGFyc2VGb3JtYXQucHVzaChcbiAgICAgICAgICB0aGlzLm9wdGlvbnMucmVuZGVyT3B0aW9ucy5rZW5kb0RhdGVDb25maWd1cmF0aW9uLmZvcm1hdFxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGtlbmRvLnBhcnNlRGF0ZSh2YWx1ZSwgcGFyc2VGb3JtYXQpO1xuICAgIH0sXG5cbiAgICBjb252ZXJ0RGF0ZVRvUHNldWRvSXNvU3RyaW5nOiBmdW5jdGlvbiB3RGF0ZWNvbnZlcnREYXRlVG9Qc2V1ZG9Jc29TdHJpbmcoXG4gICAgICBkYXRlT2JqZWN0XG4gICAgKSB7XG4gICAgICBpZiAoZGF0ZU9iamVjdCAmJiBfLmlzRGF0ZShkYXRlT2JqZWN0KSkge1xuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgIGRhdGVPYmplY3QuZ2V0RnVsbFllYXIoKSArXG4gICAgICAgICAgXCItXCIgK1xuICAgICAgICAgIHRoaXMucGFkTnVtYmVyKGRhdGVPYmplY3QuZ2V0TW9udGgoKSArIDEpICtcbiAgICAgICAgICBcIi1cIiArXG4gICAgICAgICAgdGhpcy5wYWROdW1iZXIoZGF0ZU9iamVjdC5nZXREYXRlKCkpXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICByZXR1cm4gXCJcIjtcbiAgICB9LFxuXG4gICAgcGFkTnVtYmVyOiBmdW5jdGlvbiB3RGF0ZVBhZE51bWJlcihudW1iZXIpIHtcbiAgICAgIGlmIChudW1iZXIgPCAxMCkge1xuICAgICAgICByZXR1cm4gXCIwXCIgKyBudW1iZXI7XG4gICAgICB9XG4gICAgICByZXR1cm4gbnVtYmVyO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBHZXQga2VuZG8gb3B0aW9uIGZyb20gbm9ybWFsIG9wdGlvbnMgYW5kIGZyb20gcmVuZGVyT3B0aW9ucy5rZW5kb051bWVyaWNcbiAgICAgKiBAcmV0dXJucyB7Kn1cbiAgICAgKi9cbiAgICBnZXRLZW5kb09wdGlvbnM6IGZ1bmN0aW9uIHdEYXRlZ2V0S2VuZG9PcHRpb25zKCkge1xuICAgICAgdmFyIGN1cnJlbnRXaWRnZXQgPSB0aGlzLFxuICAgICAgICBrZW5kb09wdGlvbnMgPSB7fSxcbiAgICAgICAgZGVmYXVsdE9wdGlvbnMgPSB7XG4gICAgICAgICAgbWluOiB0aGlzLm9wdGlvbnMubWluRGF0ZVxuICAgICAgICB9O1xuXG4gICAgICBpZiAoXG4gICAgICAgIF8uaXNPYmplY3QoY3VycmVudFdpZGdldC5vcHRpb25zLnJlbmRlck9wdGlvbnMua2VuZG9EYXRlQ29uZmlndXJhdGlvbilcbiAgICAgICkge1xuICAgICAgICBrZW5kb09wdGlvbnMgPVxuICAgICAgICAgIGN1cnJlbnRXaWRnZXQub3B0aW9ucy5yZW5kZXJPcHRpb25zLmtlbmRvRGF0ZUNvbmZpZ3VyYXRpb247XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBfLmV4dGVuZChkZWZhdWx0T3B0aW9ucywga2VuZG9PcHRpb25zKTtcbiAgICB9LFxuXG4gICAgY2xvc2U6IGZ1bmN0aW9uIHdEYXRlX2Nsb3NlKCkge1xuICAgICAgaWYgKHRoaXMua2VuZG9XaWRnZXQuZGF0YSh0aGlzLmtlbmRvV2lkZ2V0Q2xhc3MpKSB7XG4gICAgICAgIHRoaXMua2VuZG9XaWRnZXQuZGF0YSh0aGlzLmtlbmRvV2lkZ2V0Q2xhc3MpLmNsb3NlKCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gdGhpcy5fc3VwZXIoKTtcbiAgICB9LFxuXG4gICAgX2Rlc3Ryb3k6IGZ1bmN0aW9uIHdEYXRlRGVzdHJveSgpIHtcbiAgICAgIGlmICh0aGlzLmtlbmRvV2lkZ2V0LmRhdGEodGhpcy5rZW5kb1dpZGdldENsYXNzKSkge1xuICAgICAgICB0aGlzLmtlbmRvV2lkZ2V0LmRhdGEodGhpcy5rZW5kb1dpZGdldENsYXNzKS5kZXN0cm95KCk7XG4gICAgICB9XG4gICAgICB0aGlzLl9zdXBlcigpO1xuICAgIH1cbiAgfSk7XG5cbiAgcmV0dXJuICQuZm4uZGNwRGF0ZTtcbn0pO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUNBLFdBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///bd13ec831aaf61fba460\n");

/***/ }),

/***/ "d1cffa31e143773735c0":
/*!****************************************************************!*\
  !*** ./src/Apps/DOCUMENT/IHM/widgets/attributes/wAttribute.js ***!
  \****************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/*global define*/\n\n(function umdRequire(root, factory) {\n  \"use strict\";\n\n  if (true) {\n    !(__WEBPACK_AMD_DEFINE_ARRAY__ = [\n      __webpack_require__(/*! jquery */ \"127c8cf59f228bb01a21\"),\n      __webpack_require__(/*! underscore */ \"8e08e542008e4aef1f58\"),\n      __webpack_require__(/*! mustache */ \"bcd31d01884fc294fd69\"),\n      __webpack_require__(/*! dcpDocument/widgets/widget */ \"f562ab9f022eef93542c\"),\n      __webpack_require__(/*! tooltip */ \"b625c3d07db8baf045ff\")\n    ], __WEBPACK_AMD_DEFINE_FACTORY__ = (factory),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?\n\t\t\t\t(__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n  } else {}\n})(window, function wAttributeWidget($, _, Mustache) {\n  \"use strict\";\n\n  $.widget(\"dcp.dcpAttribute\", {\n    options: {\n      eventPrefix: \"dcpAttribute\",\n      id: null,\n      type: \"abstract\",\n      mode: \"read\",\n      index: -1,\n      labels: {\n        deleteAttributeNames: \"\",\n        deleteLabel: \"\",\n        closeErrorMessage: \"Close message\"\n      },\n      template: null,\n      deleteButton: false,\n      renderOptions: {\n        displayDeleteButton: true\n      },\n      locale: \"fr_FR\"\n    },\n\n    /**\n     * Redraw element with updated values\n     */\n    redraw: function wAttributeRedraw() {\n      this.element.find(\"[aria-describedby*='tooltip']\").tooltip(\"hide\");\n      this.element.empty();\n      this._initDom();\n      this.element.off(this.eventNamespace);\n      this._initEvent();\n      return this;\n    },\n\n    /**\n     * Verify if a common link option is set\n     *\n     * @returns boolean\n     */\n    hasLink: function hasLink() {\n      return Boolean(\n        this.options.renderOptions &&\n          this.options.renderOptions.htmlLink &&\n          this.options.renderOptions.htmlLink.url\n      );\n    },\n    /**\n     * Return the url of link\n     * @returns string\n     */\n    getLink: function wAttributeGetLink() {\n      if (this.options.renderOptions && this.options.renderOptions.htmlLink) {\n        return this.options.renderOptions.htmlLink;\n      }\n      return null;\n    },\n\n    /**\n     * Flash the element to attract user attention\n     *\n     * @param currentElement\n     */\n    flashElement: function wAttributeFlashElement(currentElement) {\n      if (!currentElement) {\n        currentElement = this.element;\n      }\n      currentElement.addClass(\"dcpAttribute__value--flash\");\n      _.delay(function wAttributeFlashDelay() {\n        currentElement\n          .removeClass(\"dcpAttribute__value--flash\")\n          .addClass(\"dcpAttribute__value--endflash\");\n        _.delay(function wAttributeFlashSecondDelay() {\n          currentElement.removeClass(\"dcpAttribute__value--endflash\");\n        }, 600);\n      }, 10);\n    },\n\n    /**\n     * Display tooltip an error message\n     *\n     * @param message string or array of [{message:, index:}, ...]\n     */\n    setError: function wAttributeSetError(message) {\n      var kt;\n      var scope = this;\n      if (message) {\n        var messages;\n        if (!_.isArray(message)) {\n          messages = [{ message: message, index: -1 }];\n        } else {\n          messages = _.toArray(message);\n        }\n        _.each(messages, function wAttributeSetErrorMsg(indexMessage) {\n          if (\n            indexMessage.index === -1 ||\n            scope.element.closest(\"tr\").data(\"line\") === indexMessage.index\n          ) {\n            scope.element.addClass(\"has-error\");\n            // need to use sub element because tooltip add a div after element\n            scope.element\n              .find(\".input-group\")\n              .tooltip({\n                placement: \"bottom\",\n                html: true,\n                animation: false,\n                container: scope.element.parent().get(0), //\".dcpDocument\",// no use scope.element because when item is in the bottom of the page a scrollbar can appear\n                title: function wAttributeSetErrorTitle() {\n                  var rawMessage = $(\"<div/>\")\n                    .text(indexMessage.message)\n                    .html();\n                  return (\n                    \"<div>\" +\n                    '<span title=\"' +\n                    scope.options.labels.closeErrorMessage +\n                    '\" class=\"btn fa fa-times button-close-error\">&nbsp;</span>' +\n                    rawMessage +\n                    \"</div>\"\n                  );\n                },\n                trigger: \"manual\"\n              })\n              .one(\"shown.bs.tooltip\", function wErrorTooltip() {\n                var tipElement = $(this).data(\"bs.tooltip\").tip;\n                if (tipElement) {\n                  $(tipElement).addClass(\"has-error\");\n                }\n              });\n            scope.element.data(\"hasErrorTooltip\", true);\n            scope.element.find(\".input-group\").tooltip(\"show\");\n          }\n        });\n      } else {\n        this.element.removeClass(\"has-error\");\n        if (this.element.data(\"hasErrorTooltip\")) {\n          // No use destroy because the destruction is deferred\n          kt = this.element.find(\".input-group\");\n          kt.tooltip(\"hide\").data(\"bs.tooltip\", null);\n          this.element.data(\"hasErrorTooltip\", false);\n        }\n      }\n    },\n\n    /**\n     * Get the type of the widget\n     *\n     * @returns {string}\n     */\n    getType: function getType() {\n      return this.options.type;\n    },\n\n    /**\n     * Get the mode of the widget\n     *\n     * @returns {string} Read|Write\n     */\n    getMode: function getMode() {\n      if (\n        this.options.mode !== \"read\" &&\n        this.options.mode !== \"write\" &&\n        this.options.mode !== \"hidden\"\n      ) {\n        throw new Error(\n          \"Attribute \" +\n            this.option.id +\n            \" have unknown mode \" +\n            this.options.mode\n        );\n      }\n      return this.options.mode;\n    },\n\n    /**\n     * Return the value stored in the wiget\n     *\n     * @returns {*|number|.options.attributeValue}\n     */\n    getValue: function wAttributegetValue() {\n      return this.options.attributeValue;\n    },\n\n    /**\n     * Identify the input where is the raw value\n     * @returns {*}\n     */\n    getContentElements: function wAttributeGetContentElements() {\n      if (this.getMode() === \"read\") {\n        return this.element.find(\n          '.dcpAttribute__value[data-attrid=\"' +\n            this.options.id +\n            '\"] .dcpAttribute__content__value'\n        );\n      } else {\n        return this.element.find(\n          '.dcpAttribute__value[name=\"' + this.options.id + '\"]'\n        );\n      }\n    },\n\n    /**\n     * Return the value of something\n     *\n     *\n     * @returns {*}\n     */\n    getWidgetValue: function getWidgetValue() {\n      return this.getContentElements().val();\n    },\n    /**\n     * Set options.attributeValue element and trigger the view\n     *\n     * @param value\n     * @param event\n     */\n    setValue: function wAttributeSetValue(value, event) {\n      this._checkValue(value);\n\n      var isEqual = false;\n\n      if (this._isMultiple()) {\n        isEqual =\n          _.toArray(this.options.attributeValue).length === value.length;\n        if (isEqual) {\n          isEqual = _.isEqual(this.options.attributeValue, value);\n        }\n      } else {\n        isEqual = _.isEqual(this.options.attributeValue.value, value.value);\n      }\n      if (!isEqual) {\n        this.options.attributeValue = value;\n\n        this._trigger(\"change\", event, {\n          id: this.options.id,\n          value: this.getValue(),\n          index: this._getIndex()\n        });\n      }\n    },\n\n    /**\n     * Show the input tooltip\n     * @param  ktTarget DOMElement\n     *\n     * @return dcp.dcpAttribute\n     */\n    hideInputTooltip: function wAttributeHideInputTooltip(ktTarget) {\n      var $ktTarger = $(ktTarget).closest(\".input-group\");\n      if ($ktTarger.data(\"hasTooltip\")) {\n        $ktTarger.tooltip(\"hide\");\n      }\n      return this;\n    },\n\n    /**\n     * Show the input tooltip\n     * @param  ktTarget DOMElement\n     *\n     * @return dcp.dcpAttribute\n     */\n    showInputTooltip: function showInputTooltip(ktTarget) {\n      var scope = this;\n\n      if (scope.options.renderOptions.inputHtmlTooltip) {\n        var $ktTarger = $(ktTarget).closest(\".input-group\");\n        var kt = $ktTarger.data(\"hasTooltip\");\n\n        if (!kt) {\n          $ktTarger\n            .tooltip({\n              trigger: \"manual\",\n              html: true,\n              title: scope.options.renderOptions.inputHtmlTooltip,\n              placement: \"bottom\"\n            })\n            .on(\"shown.bs.tooltip\", function wErrorTooltip() {\n              var tipElement = $(this).data(\"bs.tooltip\").tip;\n              if (tipElement) {\n                $(tipElement).addClass(\"dcpAttribute__editlabel\");\n              }\n            });\n          $ktTarger.data(\"hasTooltip\", true);\n        }\n        $ktTarger.tooltip(\"show\");\n      }\n      return this;\n    },\n\n    /**\n     * Close the attribute if open\n     *\n     * @returns {dcp.dcpAttribute}\n     */\n    close: function wAttribute_close() {\n      return this;\n    },\n\n    /**\n     * Create the widget\n     * @private\n     */\n    _create: function _create() {\n      var scope = this;\n      //If no id is provided one id generated\n      if (this.options.id === null) {\n        this.options.id = _.uniqueId(\"widget_\" + this.getType());\n      }\n\n      if (\n        _.isUndefined(this.options.attributeValue) ||\n        this.options.attributeValue === null\n      ) {\n        if (this._isMultiple()) {\n          this.options.attributeValue = [];\n        } else {\n          this.options.attributeValue = {\n            value: null,\n            displayValue: \"\"\n          };\n        }\n      }\n      if (this.options.helpOutputs) {\n        this.options.hasAutocomplete = true;\n      }\n\n      if (this.options.renderOptions && this.options.renderOptions.buttons) {\n        // Add index for template to identify buttons\n        this.options.renderOptions.buttons = _.map(\n          this.options.renderOptions.buttons,\n          function wAttributeOptionMap(val, index) {\n            val.renderHtmlContent = Mustache.render(\n              val.htmlContent || \"\",\n              scope.options.attributeValue\n            );\n            val.index = index;\n            return val;\n          }\n        );\n      }\n      this.options.emptyValue = _.bind(this._getEmptyValue, this);\n      this.options.hadButtons = this._hasButtons();\n      if (this.options.renderOptions && this.options.renderOptions.labels) {\n        this.options.labels = _.extend(\n          this.options.labels,\n          this.options.renderOptions.labels\n        );\n      }\n\n      if (\n        this.options.renderOptions &&\n        this.options.renderOptions.displayDeleteButton === false\n      ) {\n        this.options.deleteButton = false;\n      }\n      if (this.getMode() !== \"hidden\") {\n        this._initDom();\n        this._initEvent();\n      }\n\n      this._triggerReady();\n    },\n\n    /**\n     * Destroy the widget\n     *\n     * Suppress widget defined events and delete added dom\n     *\n     * @private\n     */\n    _destroy: function _destroy() {\n      this.element.removeClass(\"dcpAttribute__content\");\n      this.element.removeAttr(\"data-type\");\n      this.element.removeAttr(\"data-attrid\");\n      this.element.empty();\n      this._trigger(\"destroy\");\n      this._super();\n    },\n\n    /**\n     * Init the DOM of the template\n     *\n     * @protected\n     */\n    _initDom: function wAttributeInitDom() {\n      var htmlLink = this.getLink();\n      var scopeWidget = this;\n      this._initMainElementClass();\n      if (htmlLink) {\n        // Add render Url and title on links\n        var originalEscape = Mustache.escape;\n\n        if (this._isMultiple()) {\n          this.options.attributeValues = _.map(\n            this.options.attributeValue,\n            function wAttributeLinkMultiple(val, index) {\n              var urlIndex = index;\n              Mustache.escape = encodeURIComponent;\n              scopeWidget._completeRevisionData(val);\n              if (scopeWidget.options.index >= 0) {\n                // Use index of row prior to index of multiple value\n                urlIndex = scopeWidget.options.index;\n              }\n\n              if (htmlLink.urls && htmlLink.urls[urlIndex]) {\n                val.renderUrl = Mustache.render(htmlLink.urls[urlIndex], val);\n              } else {\n                val.renderUrl = Mustache.render(htmlLink.url || \"\", val);\n              }\n              Mustache.escape = originalEscape;\n              val.renderTitle = Mustache.render(htmlLink.title || \"\", val);\n              val.index = index;\n              return val;\n            }\n          );\n        } else {\n          Mustache.escape = encodeURIComponent;\n          this._completeRevisionData(this.options.attributeValue);\n          if (htmlLink.urls && htmlLink.urls[this.options.index]) {\n            this.options.renderOptions.htmlLink.renderUrl = Mustache.render(\n              htmlLink.urls[this.options.index],\n              this.options.attributeValue\n            );\n          } else {\n            this.options.renderOptions.htmlLink.renderUrl = Mustache.render(\n              htmlLink.url || \"\",\n              this.options.attributeValue\n            );\n          }\n          Mustache.escape = originalEscape;\n          this.options.renderOptions.htmlLink.renderTitle = Mustache.render(\n            htmlLink.title || \"\",\n            this.options.attributeValue\n          );\n        }\n      }\n      this.element.append(\n        Mustache.render(\n          this._getTemplate(this.options.mode) || \"\",\n          this.options\n        )\n      );\n\n      if (\n        this.element.find(\".dcpAttribute__content__buttons button\").length === 0\n      ) {\n        this.element.find(\".dcpAttribute__content__buttons\").hide();\n        this.element\n          .find(\".dcpAttribute__value\")\n          .addClass(\"dcpAttribute__content__nobutton\");\n      }\n    },\n\n    /**\n     * Add revision extra data to render link\n     * @param data\n     * @private\n     */\n    _completeRevisionData: function wAttribute_completeRevisionData(data) {\n      var isRevision =\n        data.revision !== -1 &&\n        data.revision !== null &&\n        !_.isUndefined(data.revision);\n\n      if (isRevision) {\n        data.isRevision = isRevision;\n        if (data.revision.state) {\n          data.revisionTarget = \"state:\" + data.revision.state;\n        } else {\n          data.revisionTarget = data.revision;\n        }\n      }\n    },\n\n    /**\n     * Init the DOM of the template\n     *\n     * @public\n     */\n    _initMainElementClass: function wAttributeInitMainElementClass() {\n      this.element.addClass(\"dcpAttribute__content\");\n      this.element.attr(\"data-type\", this.getType());\n      this.element.attr(\"data-attrid\", this.options.id);\n    },\n    /**\n     * Init the events\n     *\n     * @protected\n     */\n    _initEvent: function _initEvent() {\n      if (this.getMode() === \"write\") {\n        this._initDeleteEvent();\n        this._initButtonsEvent();\n        this._initFocusEvent();\n        this._initMoveEvent();\n      }\n      if (this.getMode() === \"read\") {\n        this._initButtonsEvent();\n        this._initActionClickEvent();\n        this._initLinkEvent();\n      }\n      this._initErrorEvent();\n      return this;\n    },\n\n    /**\n     * Init the focus event for tooltips (only for write attr)\n     *\n     * @protected\n     */\n    _initFocusEvent: function wAttributeInitFocusEvent() {\n      if (\n        this.options.renderOptions &&\n        this.options.renderOptions.inputHtmlTooltip\n      ) {\n        var scope = this;\n\n        var inputTargetFilter = \".dcpAttribute__value\";\n        this._getFocusInput().on(\n          \"focus\" + this.eventNamespace,\n          function wAttributeFocus(event) {\n            var ktTarget = $(event.currentTarget).closest(inputTargetFilter);\n            scope.showInputTooltip(ktTarget);\n          }\n        );\n        this._getFocusInput().on(\n          \"blur.\" + this.eventNamespace,\n          function wAttributeBlur(event) {\n            var ktTarget = $(event.currentTarget).closest(inputTargetFilter);\n            scope.hideInputTooltip(ktTarget);\n          }\n        );\n      }\n      this._getFocusInput().on(\n        \"focus\" + this.eventNamespace,\n        function wAttributeFocus(event) {\n          var $content = $(event.currentTarget).closest(\n            \".dcpAttribute__content\"\n          );\n          $content.addClass(\"dcpAttribute--focus\");\n        }\n      );\n      this._getFocusInput().on(\n        \"blur\" + this.eventNamespace,\n        function wAttributeFocus(event) {\n          var $content = $(event.currentTarget).closest(\n            \".dcpAttribute__content\"\n          );\n          $content.removeClass(\"dcpAttribute--focus\");\n        }\n      );\n\n      return this;\n    },\n    /**\n     * Reindex widget when a move is performed in an array\n     *\n     * @protected\n     */\n    _initMoveEvent: function wAttributeInitFocusEvent() {\n      var scope = this;\n      if (this.options.index !== -1) {\n        this.element.on(\n          \"postMoved\" + this.eventNamespace,\n          function wAttributeinitMoveEvent() {\n            var domLine = scope.element.closest(\"tr\").data(\"line\");\n            if (!_.isUndefined(domLine)) {\n              scope.options.index = domLine;\n            }\n          }\n        );\n      }\n      return this;\n    },\n    /**\n     * Init the events associated to buttons (only for write attributes)\n     *\n     * @protected\n     */\n    _initButtonsEvent: function _initButtonsEvent() {\n      var currentWidget = this;\n      this.element.on(\n        \"click\" + this.eventNamespace,\n        \".dcpAttribute__content__button--extra\",\n        function wAttributeButtonClick(event) {\n          var buttonsConfig = currentWidget.options.renderOptions.buttons;\n          var $button = $(this);\n          var buttonIndex = $button.data(\"index\");\n          var buttonConfig = buttonsConfig[buttonIndex];\n          var wFeature = \"\";\n\n          if (buttonConfig && buttonConfig.url) {\n            var originalEscape = Mustache.escape;\n            Mustache.escape = encodeURIComponent;\n            var url = Mustache.render(\n              buttonConfig.url || \"\",\n              currentWidget.options.attributeValue\n            );\n            Mustache.escape = originalEscape;\n\n            if (buttonConfig.target !== \"_dialog\") {\n              var $base = $(\"base\");\n              var isAbsUrl = new RegExp(\"^(?:[a-z]+:)?//\", \"i\");\n\n              if (\n                buttonConfig &&\n                (buttonConfig.windowWidth || buttonConfig.windowHeight)\n              ) {\n                if (buttonConfig.windowWidth) {\n                  wFeature +=\n                    \"width=\" + parseInt(buttonConfig.windowWidth, 10) + \",\";\n                }\n                if (buttonConfig.windowHeight) {\n                  wFeature +=\n                    \"height=\" + parseInt(buttonConfig.windowHeight, 10) + \",\";\n                }\n                wFeature += \"resizable=yes,scrollbars=yes\";\n              }\n              if (!isAbsUrl.test(url)) {\n                // For IE : Not honor base href in this case\n                url = $base.attr(\"href\") + url;\n              }\n              window.open(url, buttonConfig.target, wFeature);\n            } else {\n              var $bdw = $(\"<div/>\");\n              $(\"body\").append($bdw);\n              var renderTitle = Mustache.render(\n                buttonConfig.windowTitle || \"\",\n                currentWidget.options.attributeValue\n              );\n              var dw = $bdw\n                .dcpWindow({\n                  title: renderTitle,\n                  width: buttonConfig.windowWidth,\n                  height: buttonConfig.windowHeight,\n                  content: url,\n                  iframe: true\n                })\n                .data(\"dcpWindow\");\n              dw.kendoWindow().center();\n              dw.open();\n            }\n          }\n\n          currentWidget._trigger(\"click\", event, {\n            id: currentWidget.option.id,\n            value: currentWidget.options.attributeValue,\n            index: currentWidget._getIndex()\n          });\n        }\n      );\n      this.element.tooltip({\n        selector: \".dcpAttribute__content__buttons button\",\n        placement: \"top\",\n        trigger: \"hover\",\n        html: true,\n        title: function wAttributeGetButtonTitle() {\n          var title = $(this).data(\"title\");\n          var attrValue = currentWidget.getValue();\n          return Mustache.render(title || \"\", attrValue);\n        },\n        container: this.element.closest(\".row\").get(0) || this.element\n      });\n\n      return this;\n    },\n\n    /**\n     * Init events for delete button on error tooltip\n     *\n     * @protected\n     */\n    _initErrorEvent: function wAttributeInitErrotEvent() {\n      var scope = this;\n      // tooltip is created in same parent\n      this.element\n        .parent()\n        .on(\n          \"click\" + this.eventNamespace,\n          \".button-close-error\",\n          function closeError(/*event*/) {\n            if (scope.element.data(\"hasErrorTooltip\")) {\n              scope.element.find(\".input-group\").tooltip(\"hide\");\n              scope.element.data(\"hasErrorTooltip\", false);\n            }\n          }\n        );\n    },\n    /**\n     * Init events for delete button (only for write attributes)\n     *\n     * @protected\n     */\n    _initDeleteEvent: function wAttributeInitDeleteEvent() {\n      var currentWidget = this;\n\n      // Compose delete button title\n      var $deleteButton = this.element.find(\n        \".dcpAttribute__content__button--delete\"\n      );\n      var titleDelete;\n      if (this.options.labels.deleteLabel) {\n        titleDelete = this.options.labels.deleteLabel;\n      } else {\n        titleDelete = $deleteButton.attr(\"title\");\n        titleDelete += this.options.labels.deleteAttributeNames;\n      }\n      $deleteButton.attr(\"title\", titleDelete);\n\n      this.element.on(\n        \"click\" + this.eventNamespace,\n        \".dcpAttribute__content__button--delete\",\n        function destroyTable(event) {\n          currentWidget._trigger(\"delete\", event, {\n            index: currentWidget._getIndex(),\n            id: currentWidget.options.id\n          });\n          // main input is focuses after deletion\n          _.defer(function wAttributeDeferDelete() {\n            currentWidget.element.find(\"input\").focus();\n          });\n        }\n      );\n      return this;\n    },\n    /**\n     * Init event for #action/ links\n     *\n     * @protected\n     */\n    _initActionClickEvent: function wAttributeInitActionClickEvent() {\n      var scopeWidget = this;\n\n      this.element.on(\n        \"click.\" + this.eventNamespace,\n        'a[href^=\"#action/\"], a[data-action], button[data-action]',\n        function wAttributeActionClick(event) {\n          var $this = $(this),\n            action,\n            options,\n            eventOptions;\n\n          event.preventDefault();\n          if (event.stopPropagation) {\n            event.stopPropagation();\n          }\n\n          action = $this.data(\"action\") || $this.attr(\"href\");\n          options = action.substring(8).split(\":\");\n          eventOptions = {\n            target: event.target,\n            index: scopeWidget._getIndex(),\n            eventId: options.shift(),\n            options: options\n          };\n\n          scopeWidget._trigger(\"externalLinkSelected\", event, eventOptions);\n          return this;\n        }\n      );\n    },\n    /**\n     * Init event when a hyperlink is associated to the attribute\n     *\n     * @protected\n     */\n    _initLinkEvent: function wAttributeInitLinkEvent() {\n      var htmlLink = this.getLink();\n      var scopeWidget = this;\n\n      if (htmlLink) {\n        this.element.on(\n          \"click.\" + this.eventNamespace,\n          \".dcpAttribute__content__link\",\n          function wAttributeAttributeClick(event) {\n            var $this = $(this),\n              renderTitle,\n              index,\n              $dialogDiv,\n              dpcWindow,\n              href = $this.attr(\"href\");\n\n            if (href.substring(0, 8) !== \"#action/\" && !$this.data(\"action\")) {\n              if (htmlLink.target === \"_dialog\") {\n                event.preventDefault();\n\n                index = $(this).data(\"index\");\n                if (typeof index !== \"undefined\" && index !== null) {\n                  renderTitle = Mustache.render(\n                    htmlLink.windowTitle || \"\",\n                    scopeWidget.options.attributeValue[index]\n                  );\n                } else {\n                  renderTitle = Mustache.render(\n                    htmlLink.windowTitle || \"\",\n                    scopeWidget.options.attributeValue\n                  );\n                }\n\n                $dialogDiv = $(\"<div/>\");\n                $(\"body\").append($dialogDiv);\n\n                dpcWindow = $dialogDiv.dcpWindow({\n                  title: renderTitle,\n                  width: htmlLink.windowWidth,\n                  height: htmlLink.windowHeight,\n                  content: href,\n                  iframe: true\n                });\n\n                dpcWindow\n                  .data(\"dcpWindow\")\n                  .kendoWindow()\n                  .center();\n                dpcWindow.data(\"dcpWindow\").open();\n              }\n            }\n          }\n        );\n\n        this.element\n          .find(\".dcpAttribute__content__link[title]\")\n          .tooltip({\n            placement: \"top\",\n            container: \".dcpDocument\",\n            html: true,\n            trigger: \"hover\"\n          })\n          .each(function wAttributeInitLinkTooltip() {\n            if ($(this).data(\"bs.tooltip\").tip) {\n              $(this)\n                .data(\"bs.tooltip\")\n                .tip()\n                .addClass(\"dcpAttribute__linkvalue\");\n            }\n          });\n      }\n      return this;\n    },\n\n    /**\n     * Get input that can handle focus class\n     *\n     * For the display of the focus class (in helpers)\n     *\n     * @return jquery elements\n     *\n     * @protected\n     */\n    _getFocusInput: function wAttributeFocusInput() {\n      return this.element.find('input[name=\"' + this.options.id + '\"]');\n    },\n\n    /**\n     * Return the index of the attributes (for attribute in a widget array)\n     *\n     * @returns int\n     * @protected\n     */\n    _getIndex: function _getIndex() {\n      if (this.options.index !== -1) {\n        this.options.index = this.element\n          .closest(\".dcpArray__content__line\")\n          .data(\"line\");\n      }\n      return this.options.index;\n    },\n\n    /**\n     * Return the empty value (default value if the attribute is empty)\n     *\n     * @returns {*}\n     * @private\n     */\n    _getEmptyValue: function _getEmptyValue() {\n      if (\n        _.isEmpty(this.options.attributeValue) ||\n        this.options.attributeValue.value === null\n      ) {\n        if (\n          this.options.renderOptions &&\n          this.options.renderOptions.showEmptyContent\n        ) {\n          return this.options.renderOptions.showEmptyContent === true\n            ? \" \"\n            : this.options.renderOptions.showEmptyContent;\n        }\n        return \"\";\n      }\n      return \"\";\n    },\n\n    /**\n     * Get the template of the current attribute\n     *\n     * The template can be in the options or in a global var of dcp namespace (initiated by require for widget)\n     *\n     * @param key\n     * @returns string\n     * @private\n     */\n    _getTemplate: function _getTemplate(key) {\n      if (this.options.templates && this.options.templates[key]) {\n        return this.options.templates[key];\n      }\n      if (\n        window.dcp &&\n        window.dcp.templates &&\n        window.dcp.templates[this.getType()] &&\n        window.dcp.templates[this.getType()][key]\n      ) {\n        return window.dcp.templates[this.getType()][key];\n      }\n      if (\n        window.dcp &&\n        window.dcp.templates &&\n        window.dcp.templates[\"default\"] &&\n        window.dcp.templates[\"default\"][key]\n      ) {\n        return window.dcp.templates[\"default\"][key];\n      }\n      throw new Error(\n        \"Unknown template  \" +\n          key +\n          \"/\" +\n          this.options.type +\n          \" for \" +\n          this.options.id\n      );\n    },\n\n    /**\n     * Test if the value of the setValue is correct\n     *\n     * @param value\n     * @returns {boolean}\n     */\n    _checkValue: function wAttributeTestValue(value) {\n      //noinspection JSHint\n      if (this._isMultiple()) {\n        // jshint ignore:line\n        // TODO : Verify each array entry\n        // jscs:disable disallowEmptyBlocks\n      } else {\n        // jscs:enable disallowEmptyBlocks\n        if (\n          !_.isObject(value) ||\n          !_.has(value, \"value\") ||\n          !_.has(value, \"displayValue\")\n        ) {\n          throw new Error(\n            \"The value must be an object with value and displayValue properties (attrid id :\" +\n              this.options.id +\n              \")\"\n          );\n        }\n      }\n      return true;\n    },\n    /**\n     * Check if the attribute is multiple\n     *\n     * @returns boolean\n     * @public\n     */\n    _isMultiple: function _isMultiple() {\n      return this.options.options && this.options.options.multiple === \"yes\";\n    },\n\n    /**\n     * Check if the widget has buttons\n     *\n     * Used by template for rendering options\n     *\n     * @returns boolean\n     */\n    _hasButtons: function wAttributeHasButtons() {\n      if (this.getMode() === \"write\") {\n        return (\n          this.options.hasAutocomplete ||\n          this.options.deleteButton ||\n          (this.options.renderOptions &&\n            this.options.renderOptions.buttons &&\n            true)\n        );\n      } else {\n        return (\n          this.options.renderOptions &&\n          this.options.renderOptions.buttons &&\n          true\n        );\n      }\n    },\n    /**\n     * Trigger a ready event when widget is render\n     */\n    _triggerReady: function wAttributeReady() {\n      this._trigger(\"widgetReady\");\n    },\n\n    /**\n     * Trigger an event that should disable save menu on document\n     *\n     * @param visibility\n     * @private\n     */\n    _setVisibilitySavingMenu: function wAttribute_DisableSavingMenu(\n      visibility\n    ) {\n      var event = { prevent: false };\n      this._trigger(\"changeattrmenuvisibility\", event, {\n        id: \"save\",\n        onlyIfVisible: true,\n        visibility: visibility\n      });\n      this._trigger(\"changeattrmenuvisibility\", event, {\n        id: \"saveAndClose\",\n        onlyIfVisible: true,\n        visibility: visibility\n      });\n      this._trigger(\"changeattrmenuvisibility\", event, {\n        id: \"createAndClose\",\n        onlyIfVisible: true,\n        visibility: visibility\n      });\n      this._trigger(\"changeattrmenuvisibility\", event, {\n        id: \"create\",\n        onlyIfVisible: true,\n        visibility: visibility\n      });\n    }\n  });\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZDFjZmZhMzFlMTQzNzczNzM1YzAuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvQXBwcy9ET0NVTUVOVC9JSE0vd2lkZ2V0cy9hdHRyaWJ1dGVzL3dBdHRyaWJ1dGUuanM/OTEzYSJdLCJzb3VyY2VzQ29udGVudCI6WyIvKmdsb2JhbCBkZWZpbmUqL1xuXG4oZnVuY3Rpb24gdW1kUmVxdWlyZShyb290LCBmYWN0b3J5KSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIGlmICh0eXBlb2YgZGVmaW5lID09PSBcImZ1bmN0aW9uXCIgJiYgZGVmaW5lLmFtZCkge1xuICAgIGRlZmluZShbXG4gICAgICBcImpxdWVyeVwiLFxuICAgICAgXCJ1bmRlcnNjb3JlXCIsXG4gICAgICBcIm11c3RhY2hlXCIsXG4gICAgICBcImRjcERvY3VtZW50L3dpZGdldHMvd2lkZ2V0XCIsXG4gICAgICBcInRvb2x0aXBcIlxuICAgIF0sIGZhY3RvcnkpO1xuICB9IGVsc2Uge1xuICAgIC8vbm9pbnNwZWN0aW9uIEpTVW5yZXNvbHZlZFZhcmlhYmxlXG4gICAgZmFjdG9yeSh3aW5kb3cualF1ZXJ5LCB3aW5kb3cuXywgd2luZG93Lk11c3RhY2hlKTtcbiAgfVxufSkod2luZG93LCBmdW5jdGlvbiB3QXR0cmlidXRlV2lkZ2V0KCQsIF8sIE11c3RhY2hlKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gICQud2lkZ2V0KFwiZGNwLmRjcEF0dHJpYnV0ZVwiLCB7XG4gICAgb3B0aW9uczoge1xuICAgICAgZXZlbnRQcmVmaXg6IFwiZGNwQXR0cmlidXRlXCIsXG4gICAgICBpZDogbnVsbCxcbiAgICAgIHR5cGU6IFwiYWJzdHJhY3RcIixcbiAgICAgIG1vZGU6IFwicmVhZFwiLFxuICAgICAgaW5kZXg6IC0xLFxuICAgICAgbGFiZWxzOiB7XG4gICAgICAgIGRlbGV0ZUF0dHJpYnV0ZU5hbWVzOiBcIlwiLFxuICAgICAgICBkZWxldGVMYWJlbDogXCJcIixcbiAgICAgICAgY2xvc2VFcnJvck1lc3NhZ2U6IFwiQ2xvc2UgbWVzc2FnZVwiXG4gICAgICB9LFxuICAgICAgdGVtcGxhdGU6IG51bGwsXG4gICAgICBkZWxldGVCdXR0b246IGZhbHNlLFxuICAgICAgcmVuZGVyT3B0aW9uczoge1xuICAgICAgICBkaXNwbGF5RGVsZXRlQnV0dG9uOiB0cnVlXG4gICAgICB9LFxuICAgICAgbG9jYWxlOiBcImZyX0ZSXCJcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogUmVkcmF3IGVsZW1lbnQgd2l0aCB1cGRhdGVkIHZhbHVlc1xuICAgICAqL1xuICAgIHJlZHJhdzogZnVuY3Rpb24gd0F0dHJpYnV0ZVJlZHJhdygpIHtcbiAgICAgIHRoaXMuZWxlbWVudC5maW5kKFwiW2FyaWEtZGVzY3JpYmVkYnkqPSd0b29sdGlwJ11cIikudG9vbHRpcChcImhpZGVcIik7XG4gICAgICB0aGlzLmVsZW1lbnQuZW1wdHkoKTtcbiAgICAgIHRoaXMuX2luaXREb20oKTtcbiAgICAgIHRoaXMuZWxlbWVudC5vZmYodGhpcy5ldmVudE5hbWVzcGFjZSk7XG4gICAgICB0aGlzLl9pbml0RXZlbnQoKTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBWZXJpZnkgaWYgYSBjb21tb24gbGluayBvcHRpb24gaXMgc2V0XG4gICAgICpcbiAgICAgKiBAcmV0dXJucyBib29sZWFuXG4gICAgICovXG4gICAgaGFzTGluazogZnVuY3Rpb24gaGFzTGluaygpIHtcbiAgICAgIHJldHVybiBCb29sZWFuKFxuICAgICAgICB0aGlzLm9wdGlvbnMucmVuZGVyT3B0aW9ucyAmJlxuICAgICAgICAgIHRoaXMub3B0aW9ucy5yZW5kZXJPcHRpb25zLmh0bWxMaW5rICYmXG4gICAgICAgICAgdGhpcy5vcHRpb25zLnJlbmRlck9wdGlvbnMuaHRtbExpbmsudXJsXG4gICAgICApO1xuICAgIH0sXG4gICAgLyoqXG4gICAgICogUmV0dXJuIHRoZSB1cmwgb2YgbGlua1xuICAgICAqIEByZXR1cm5zIHN0cmluZ1xuICAgICAqL1xuICAgIGdldExpbms6IGZ1bmN0aW9uIHdBdHRyaWJ1dGVHZXRMaW5rKCkge1xuICAgICAgaWYgKHRoaXMub3B0aW9ucy5yZW5kZXJPcHRpb25zICYmIHRoaXMub3B0aW9ucy5yZW5kZXJPcHRpb25zLmh0bWxMaW5rKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm9wdGlvbnMucmVuZGVyT3B0aW9ucy5odG1sTGluaztcbiAgICAgIH1cbiAgICAgIHJldHVybiBudWxsO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBGbGFzaCB0aGUgZWxlbWVudCB0byBhdHRyYWN0IHVzZXIgYXR0ZW50aW9uXG4gICAgICpcbiAgICAgKiBAcGFyYW0gY3VycmVudEVsZW1lbnRcbiAgICAgKi9cbiAgICBmbGFzaEVsZW1lbnQ6IGZ1bmN0aW9uIHdBdHRyaWJ1dGVGbGFzaEVsZW1lbnQoY3VycmVudEVsZW1lbnQpIHtcbiAgICAgIGlmICghY3VycmVudEVsZW1lbnQpIHtcbiAgICAgICAgY3VycmVudEVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG4gICAgICB9XG4gICAgICBjdXJyZW50RWxlbWVudC5hZGRDbGFzcyhcImRjcEF0dHJpYnV0ZV9fdmFsdWUtLWZsYXNoXCIpO1xuICAgICAgXy5kZWxheShmdW5jdGlvbiB3QXR0cmlidXRlRmxhc2hEZWxheSgpIHtcbiAgICAgICAgY3VycmVudEVsZW1lbnRcbiAgICAgICAgICAucmVtb3ZlQ2xhc3MoXCJkY3BBdHRyaWJ1dGVfX3ZhbHVlLS1mbGFzaFwiKVxuICAgICAgICAgIC5hZGRDbGFzcyhcImRjcEF0dHJpYnV0ZV9fdmFsdWUtLWVuZGZsYXNoXCIpO1xuICAgICAgICBfLmRlbGF5KGZ1bmN0aW9uIHdBdHRyaWJ1dGVGbGFzaFNlY29uZERlbGF5KCkge1xuICAgICAgICAgIGN1cnJlbnRFbGVtZW50LnJlbW92ZUNsYXNzKFwiZGNwQXR0cmlidXRlX192YWx1ZS0tZW5kZmxhc2hcIik7XG4gICAgICAgIH0sIDYwMCk7XG4gICAgICB9LCAxMCk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIERpc3BsYXkgdG9vbHRpcCBhbiBlcnJvciBtZXNzYWdlXG4gICAgICpcbiAgICAgKiBAcGFyYW0gbWVzc2FnZSBzdHJpbmcgb3IgYXJyYXkgb2YgW3ttZXNzYWdlOiwgaW5kZXg6fSwgLi4uXVxuICAgICAqL1xuICAgIHNldEVycm9yOiBmdW5jdGlvbiB3QXR0cmlidXRlU2V0RXJyb3IobWVzc2FnZSkge1xuICAgICAgdmFyIGt0O1xuICAgICAgdmFyIHNjb3BlID0gdGhpcztcbiAgICAgIGlmIChtZXNzYWdlKSB7XG4gICAgICAgIHZhciBtZXNzYWdlcztcbiAgICAgICAgaWYgKCFfLmlzQXJyYXkobWVzc2FnZSkpIHtcbiAgICAgICAgICBtZXNzYWdlcyA9IFt7IG1lc3NhZ2U6IG1lc3NhZ2UsIGluZGV4OiAtMSB9XTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBtZXNzYWdlcyA9IF8udG9BcnJheShtZXNzYWdlKTtcbiAgICAgICAgfVxuICAgICAgICBfLmVhY2gobWVzc2FnZXMsIGZ1bmN0aW9uIHdBdHRyaWJ1dGVTZXRFcnJvck1zZyhpbmRleE1lc3NhZ2UpIHtcbiAgICAgICAgICBpZiAoXG4gICAgICAgICAgICBpbmRleE1lc3NhZ2UuaW5kZXggPT09IC0xIHx8XG4gICAgICAgICAgICBzY29wZS5lbGVtZW50LmNsb3Nlc3QoXCJ0clwiKS5kYXRhKFwibGluZVwiKSA9PT0gaW5kZXhNZXNzYWdlLmluZGV4XG4gICAgICAgICAgKSB7XG4gICAgICAgICAgICBzY29wZS5lbGVtZW50LmFkZENsYXNzKFwiaGFzLWVycm9yXCIpO1xuICAgICAgICAgICAgLy8gbmVlZCB0byB1c2Ugc3ViIGVsZW1lbnQgYmVjYXVzZSB0b29sdGlwIGFkZCBhIGRpdiBhZnRlciBlbGVtZW50XG4gICAgICAgICAgICBzY29wZS5lbGVtZW50XG4gICAgICAgICAgICAgIC5maW5kKFwiLmlucHV0LWdyb3VwXCIpXG4gICAgICAgICAgICAgIC50b29sdGlwKHtcbiAgICAgICAgICAgICAgICBwbGFjZW1lbnQ6IFwiYm90dG9tXCIsXG4gICAgICAgICAgICAgICAgaHRtbDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBhbmltYXRpb246IGZhbHNlLFxuICAgICAgICAgICAgICAgIGNvbnRhaW5lcjogc2NvcGUuZWxlbWVudC5wYXJlbnQoKS5nZXQoMCksIC8vXCIuZGNwRG9jdW1lbnRcIiwvLyBubyB1c2Ugc2NvcGUuZWxlbWVudCBiZWNhdXNlIHdoZW4gaXRlbSBpcyBpbiB0aGUgYm90dG9tIG9mIHRoZSBwYWdlIGEgc2Nyb2xsYmFyIGNhbiBhcHBlYXJcbiAgICAgICAgICAgICAgICB0aXRsZTogZnVuY3Rpb24gd0F0dHJpYnV0ZVNldEVycm9yVGl0bGUoKSB7XG4gICAgICAgICAgICAgICAgICB2YXIgcmF3TWVzc2FnZSA9ICQoXCI8ZGl2Lz5cIilcbiAgICAgICAgICAgICAgICAgICAgLnRleHQoaW5kZXhNZXNzYWdlLm1lc3NhZ2UpXG4gICAgICAgICAgICAgICAgICAgIC5odG1sKCk7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgICAgICAgICBcIjxkaXY+XCIgK1xuICAgICAgICAgICAgICAgICAgICAnPHNwYW4gdGl0bGU9XCInICtcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUub3B0aW9ucy5sYWJlbHMuY2xvc2VFcnJvck1lc3NhZ2UgK1xuICAgICAgICAgICAgICAgICAgICAnXCIgY2xhc3M9XCJidG4gZmEgZmEtdGltZXMgYnV0dG9uLWNsb3NlLWVycm9yXCI+Jm5ic3A7PC9zcGFuPicgK1xuICAgICAgICAgICAgICAgICAgICByYXdNZXNzYWdlICtcbiAgICAgICAgICAgICAgICAgICAgXCI8L2Rpdj5cIlxuICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHRyaWdnZXI6IFwibWFudWFsXCJcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgLm9uZShcInNob3duLmJzLnRvb2x0aXBcIiwgZnVuY3Rpb24gd0Vycm9yVG9vbHRpcCgpIHtcbiAgICAgICAgICAgICAgICB2YXIgdGlwRWxlbWVudCA9ICQodGhpcykuZGF0YShcImJzLnRvb2x0aXBcIikudGlwO1xuICAgICAgICAgICAgICAgIGlmICh0aXBFbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAkKHRpcEVsZW1lbnQpLmFkZENsYXNzKFwiaGFzLWVycm9yXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBzY29wZS5lbGVtZW50LmRhdGEoXCJoYXNFcnJvclRvb2x0aXBcIiwgdHJ1ZSk7XG4gICAgICAgICAgICBzY29wZS5lbGVtZW50LmZpbmQoXCIuaW5wdXQtZ3JvdXBcIikudG9vbHRpcChcInNob3dcIik7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuZWxlbWVudC5yZW1vdmVDbGFzcyhcImhhcy1lcnJvclwiKTtcbiAgICAgICAgaWYgKHRoaXMuZWxlbWVudC5kYXRhKFwiaGFzRXJyb3JUb29sdGlwXCIpKSB7XG4gICAgICAgICAgLy8gTm8gdXNlIGRlc3Ryb3kgYmVjYXVzZSB0aGUgZGVzdHJ1Y3Rpb24gaXMgZGVmZXJyZWRcbiAgICAgICAgICBrdCA9IHRoaXMuZWxlbWVudC5maW5kKFwiLmlucHV0LWdyb3VwXCIpO1xuICAgICAgICAgIGt0LnRvb2x0aXAoXCJoaWRlXCIpLmRhdGEoXCJicy50b29sdGlwXCIsIG51bGwpO1xuICAgICAgICAgIHRoaXMuZWxlbWVudC5kYXRhKFwiaGFzRXJyb3JUb29sdGlwXCIsIGZhbHNlKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBHZXQgdGhlIHR5cGUgb2YgdGhlIHdpZGdldFxuICAgICAqXG4gICAgICogQHJldHVybnMge3N0cmluZ31cbiAgICAgKi9cbiAgICBnZXRUeXBlOiBmdW5jdGlvbiBnZXRUeXBlKCkge1xuICAgICAgcmV0dXJuIHRoaXMub3B0aW9ucy50eXBlO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBHZXQgdGhlIG1vZGUgb2YgdGhlIHdpZGdldFxuICAgICAqXG4gICAgICogQHJldHVybnMge3N0cmluZ30gUmVhZHxXcml0ZVxuICAgICAqL1xuICAgIGdldE1vZGU6IGZ1bmN0aW9uIGdldE1vZGUoKSB7XG4gICAgICBpZiAoXG4gICAgICAgIHRoaXMub3B0aW9ucy5tb2RlICE9PSBcInJlYWRcIiAmJlxuICAgICAgICB0aGlzLm9wdGlvbnMubW9kZSAhPT0gXCJ3cml0ZVwiICYmXG4gICAgICAgIHRoaXMub3B0aW9ucy5tb2RlICE9PSBcImhpZGRlblwiXG4gICAgICApIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgIFwiQXR0cmlidXRlIFwiICtcbiAgICAgICAgICAgIHRoaXMub3B0aW9uLmlkICtcbiAgICAgICAgICAgIFwiIGhhdmUgdW5rbm93biBtb2RlIFwiICtcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucy5tb2RlXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICByZXR1cm4gdGhpcy5vcHRpb25zLm1vZGU7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIFJldHVybiB0aGUgdmFsdWUgc3RvcmVkIGluIHRoZSB3aWdldFxuICAgICAqXG4gICAgICogQHJldHVybnMgeyp8bnVtYmVyfC5vcHRpb25zLmF0dHJpYnV0ZVZhbHVlfVxuICAgICAqL1xuICAgIGdldFZhbHVlOiBmdW5jdGlvbiB3QXR0cmlidXRlZ2V0VmFsdWUoKSB7XG4gICAgICByZXR1cm4gdGhpcy5vcHRpb25zLmF0dHJpYnV0ZVZhbHVlO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBJZGVudGlmeSB0aGUgaW5wdXQgd2hlcmUgaXMgdGhlIHJhdyB2YWx1ZVxuICAgICAqIEByZXR1cm5zIHsqfVxuICAgICAqL1xuICAgIGdldENvbnRlbnRFbGVtZW50czogZnVuY3Rpb24gd0F0dHJpYnV0ZUdldENvbnRlbnRFbGVtZW50cygpIHtcbiAgICAgIGlmICh0aGlzLmdldE1vZGUoKSA9PT0gXCJyZWFkXCIpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZWxlbWVudC5maW5kKFxuICAgICAgICAgICcuZGNwQXR0cmlidXRlX192YWx1ZVtkYXRhLWF0dHJpZD1cIicgK1xuICAgICAgICAgICAgdGhpcy5vcHRpb25zLmlkICtcbiAgICAgICAgICAgICdcIl0gLmRjcEF0dHJpYnV0ZV9fY29udGVudF9fdmFsdWUnXG4gICAgICAgICk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gdGhpcy5lbGVtZW50LmZpbmQoXG4gICAgICAgICAgJy5kY3BBdHRyaWJ1dGVfX3ZhbHVlW25hbWU9XCInICsgdGhpcy5vcHRpb25zLmlkICsgJ1wiXSdcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogUmV0dXJuIHRoZSB2YWx1ZSBvZiBzb21ldGhpbmdcbiAgICAgKlxuICAgICAqXG4gICAgICogQHJldHVybnMgeyp9XG4gICAgICovXG4gICAgZ2V0V2lkZ2V0VmFsdWU6IGZ1bmN0aW9uIGdldFdpZGdldFZhbHVlKCkge1xuICAgICAgcmV0dXJuIHRoaXMuZ2V0Q29udGVudEVsZW1lbnRzKCkudmFsKCk7XG4gICAgfSxcbiAgICAvKipcbiAgICAgKiBTZXQgb3B0aW9ucy5hdHRyaWJ1dGVWYWx1ZSBlbGVtZW50IGFuZCB0cmlnZ2VyIHRoZSB2aWV3XG4gICAgICpcbiAgICAgKiBAcGFyYW0gdmFsdWVcbiAgICAgKiBAcGFyYW0gZXZlbnRcbiAgICAgKi9cbiAgICBzZXRWYWx1ZTogZnVuY3Rpb24gd0F0dHJpYnV0ZVNldFZhbHVlKHZhbHVlLCBldmVudCkge1xuICAgICAgdGhpcy5fY2hlY2tWYWx1ZSh2YWx1ZSk7XG5cbiAgICAgIHZhciBpc0VxdWFsID0gZmFsc2U7XG5cbiAgICAgIGlmICh0aGlzLl9pc011bHRpcGxlKCkpIHtcbiAgICAgICAgaXNFcXVhbCA9XG4gICAgICAgICAgXy50b0FycmF5KHRoaXMub3B0aW9ucy5hdHRyaWJ1dGVWYWx1ZSkubGVuZ3RoID09PSB2YWx1ZS5sZW5ndGg7XG4gICAgICAgIGlmIChpc0VxdWFsKSB7XG4gICAgICAgICAgaXNFcXVhbCA9IF8uaXNFcXVhbCh0aGlzLm9wdGlvbnMuYXR0cmlidXRlVmFsdWUsIHZhbHVlKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaXNFcXVhbCA9IF8uaXNFcXVhbCh0aGlzLm9wdGlvbnMuYXR0cmlidXRlVmFsdWUudmFsdWUsIHZhbHVlLnZhbHVlKTtcbiAgICAgIH1cbiAgICAgIGlmICghaXNFcXVhbCkge1xuICAgICAgICB0aGlzLm9wdGlvbnMuYXR0cmlidXRlVmFsdWUgPSB2YWx1ZTtcblxuICAgICAgICB0aGlzLl90cmlnZ2VyKFwiY2hhbmdlXCIsIGV2ZW50LCB7XG4gICAgICAgICAgaWQ6IHRoaXMub3B0aW9ucy5pZCxcbiAgICAgICAgICB2YWx1ZTogdGhpcy5nZXRWYWx1ZSgpLFxuICAgICAgICAgIGluZGV4OiB0aGlzLl9nZXRJbmRleCgpXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBTaG93IHRoZSBpbnB1dCB0b29sdGlwXG4gICAgICogQHBhcmFtICBrdFRhcmdldCBET01FbGVtZW50XG4gICAgICpcbiAgICAgKiBAcmV0dXJuIGRjcC5kY3BBdHRyaWJ1dGVcbiAgICAgKi9cbiAgICBoaWRlSW5wdXRUb29sdGlwOiBmdW5jdGlvbiB3QXR0cmlidXRlSGlkZUlucHV0VG9vbHRpcChrdFRhcmdldCkge1xuICAgICAgdmFyICRrdFRhcmdlciA9ICQoa3RUYXJnZXQpLmNsb3Nlc3QoXCIuaW5wdXQtZ3JvdXBcIik7XG4gICAgICBpZiAoJGt0VGFyZ2VyLmRhdGEoXCJoYXNUb29sdGlwXCIpKSB7XG4gICAgICAgICRrdFRhcmdlci50b29sdGlwKFwiaGlkZVwiKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBTaG93IHRoZSBpbnB1dCB0b29sdGlwXG4gICAgICogQHBhcmFtICBrdFRhcmdldCBET01FbGVtZW50XG4gICAgICpcbiAgICAgKiBAcmV0dXJuIGRjcC5kY3BBdHRyaWJ1dGVcbiAgICAgKi9cbiAgICBzaG93SW5wdXRUb29sdGlwOiBmdW5jdGlvbiBzaG93SW5wdXRUb29sdGlwKGt0VGFyZ2V0KSB7XG4gICAgICB2YXIgc2NvcGUgPSB0aGlzO1xuXG4gICAgICBpZiAoc2NvcGUub3B0aW9ucy5yZW5kZXJPcHRpb25zLmlucHV0SHRtbFRvb2x0aXApIHtcbiAgICAgICAgdmFyICRrdFRhcmdlciA9ICQoa3RUYXJnZXQpLmNsb3Nlc3QoXCIuaW5wdXQtZ3JvdXBcIik7XG4gICAgICAgIHZhciBrdCA9ICRrdFRhcmdlci5kYXRhKFwiaGFzVG9vbHRpcFwiKTtcblxuICAgICAgICBpZiAoIWt0KSB7XG4gICAgICAgICAgJGt0VGFyZ2VyXG4gICAgICAgICAgICAudG9vbHRpcCh7XG4gICAgICAgICAgICAgIHRyaWdnZXI6IFwibWFudWFsXCIsXG4gICAgICAgICAgICAgIGh0bWw6IHRydWUsXG4gICAgICAgICAgICAgIHRpdGxlOiBzY29wZS5vcHRpb25zLnJlbmRlck9wdGlvbnMuaW5wdXRIdG1sVG9vbHRpcCxcbiAgICAgICAgICAgICAgcGxhY2VtZW50OiBcImJvdHRvbVwiXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLm9uKFwic2hvd24uYnMudG9vbHRpcFwiLCBmdW5jdGlvbiB3RXJyb3JUb29sdGlwKCkge1xuICAgICAgICAgICAgICB2YXIgdGlwRWxlbWVudCA9ICQodGhpcykuZGF0YShcImJzLnRvb2x0aXBcIikudGlwO1xuICAgICAgICAgICAgICBpZiAodGlwRWxlbWVudCkge1xuICAgICAgICAgICAgICAgICQodGlwRWxlbWVudCkuYWRkQ2xhc3MoXCJkY3BBdHRyaWJ1dGVfX2VkaXRsYWJlbFwiKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgJGt0VGFyZ2VyLmRhdGEoXCJoYXNUb29sdGlwXCIsIHRydWUpO1xuICAgICAgICB9XG4gICAgICAgICRrdFRhcmdlci50b29sdGlwKFwic2hvd1wiKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBDbG9zZSB0aGUgYXR0cmlidXRlIGlmIG9wZW5cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIHtkY3AuZGNwQXR0cmlidXRlfVxuICAgICAqL1xuICAgIGNsb3NlOiBmdW5jdGlvbiB3QXR0cmlidXRlX2Nsb3NlKCkge1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIENyZWF0ZSB0aGUgd2lkZ2V0XG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfY3JlYXRlOiBmdW5jdGlvbiBfY3JlYXRlKCkge1xuICAgICAgdmFyIHNjb3BlID0gdGhpcztcbiAgICAgIC8vSWYgbm8gaWQgaXMgcHJvdmlkZWQgb25lIGlkIGdlbmVyYXRlZFxuICAgICAgaWYgKHRoaXMub3B0aW9ucy5pZCA9PT0gbnVsbCkge1xuICAgICAgICB0aGlzLm9wdGlvbnMuaWQgPSBfLnVuaXF1ZUlkKFwid2lkZ2V0X1wiICsgdGhpcy5nZXRUeXBlKCkpO1xuICAgICAgfVxuXG4gICAgICBpZiAoXG4gICAgICAgIF8uaXNVbmRlZmluZWQodGhpcy5vcHRpb25zLmF0dHJpYnV0ZVZhbHVlKSB8fFxuICAgICAgICB0aGlzLm9wdGlvbnMuYXR0cmlidXRlVmFsdWUgPT09IG51bGxcbiAgICAgICkge1xuICAgICAgICBpZiAodGhpcy5faXNNdWx0aXBsZSgpKSB7XG4gICAgICAgICAgdGhpcy5vcHRpb25zLmF0dHJpYnV0ZVZhbHVlID0gW107XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5vcHRpb25zLmF0dHJpYnV0ZVZhbHVlID0ge1xuICAgICAgICAgICAgdmFsdWU6IG51bGwsXG4gICAgICAgICAgICBkaXNwbGF5VmFsdWU6IFwiXCJcbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5vcHRpb25zLmhlbHBPdXRwdXRzKSB7XG4gICAgICAgIHRoaXMub3B0aW9ucy5oYXNBdXRvY29tcGxldGUgPSB0cnVlO1xuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy5vcHRpb25zLnJlbmRlck9wdGlvbnMgJiYgdGhpcy5vcHRpb25zLnJlbmRlck9wdGlvbnMuYnV0dG9ucykge1xuICAgICAgICAvLyBBZGQgaW5kZXggZm9yIHRlbXBsYXRlIHRvIGlkZW50aWZ5IGJ1dHRvbnNcbiAgICAgICAgdGhpcy5vcHRpb25zLnJlbmRlck9wdGlvbnMuYnV0dG9ucyA9IF8ubWFwKFxuICAgICAgICAgIHRoaXMub3B0aW9ucy5yZW5kZXJPcHRpb25zLmJ1dHRvbnMsXG4gICAgICAgICAgZnVuY3Rpb24gd0F0dHJpYnV0ZU9wdGlvbk1hcCh2YWwsIGluZGV4KSB7XG4gICAgICAgICAgICB2YWwucmVuZGVySHRtbENvbnRlbnQgPSBNdXN0YWNoZS5yZW5kZXIoXG4gICAgICAgICAgICAgIHZhbC5odG1sQ29udGVudCB8fCBcIlwiLFxuICAgICAgICAgICAgICBzY29wZS5vcHRpb25zLmF0dHJpYnV0ZVZhbHVlXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgdmFsLmluZGV4ID0gaW5kZXg7XG4gICAgICAgICAgICByZXR1cm4gdmFsO1xuICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIHRoaXMub3B0aW9ucy5lbXB0eVZhbHVlID0gXy5iaW5kKHRoaXMuX2dldEVtcHR5VmFsdWUsIHRoaXMpO1xuICAgICAgdGhpcy5vcHRpb25zLmhhZEJ1dHRvbnMgPSB0aGlzLl9oYXNCdXR0b25zKCk7XG4gICAgICBpZiAodGhpcy5vcHRpb25zLnJlbmRlck9wdGlvbnMgJiYgdGhpcy5vcHRpb25zLnJlbmRlck9wdGlvbnMubGFiZWxzKSB7XG4gICAgICAgIHRoaXMub3B0aW9ucy5sYWJlbHMgPSBfLmV4dGVuZChcbiAgICAgICAgICB0aGlzLm9wdGlvbnMubGFiZWxzLFxuICAgICAgICAgIHRoaXMub3B0aW9ucy5yZW5kZXJPcHRpb25zLmxhYmVsc1xuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICBpZiAoXG4gICAgICAgIHRoaXMub3B0aW9ucy5yZW5kZXJPcHRpb25zICYmXG4gICAgICAgIHRoaXMub3B0aW9ucy5yZW5kZXJPcHRpb25zLmRpc3BsYXlEZWxldGVCdXR0b24gPT09IGZhbHNlXG4gICAgICApIHtcbiAgICAgICAgdGhpcy5vcHRpb25zLmRlbGV0ZUJ1dHRvbiA9IGZhbHNlO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMuZ2V0TW9kZSgpICE9PSBcImhpZGRlblwiKSB7XG4gICAgICAgIHRoaXMuX2luaXREb20oKTtcbiAgICAgICAgdGhpcy5faW5pdEV2ZW50KCk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuX3RyaWdnZXJSZWFkeSgpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBEZXN0cm95IHRoZSB3aWRnZXRcbiAgICAgKlxuICAgICAqIFN1cHByZXNzIHdpZGdldCBkZWZpbmVkIGV2ZW50cyBhbmQgZGVsZXRlIGFkZGVkIGRvbVxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfZGVzdHJveTogZnVuY3Rpb24gX2Rlc3Ryb3koKSB7XG4gICAgICB0aGlzLmVsZW1lbnQucmVtb3ZlQ2xhc3MoXCJkY3BBdHRyaWJ1dGVfX2NvbnRlbnRcIik7XG4gICAgICB0aGlzLmVsZW1lbnQucmVtb3ZlQXR0cihcImRhdGEtdHlwZVwiKTtcbiAgICAgIHRoaXMuZWxlbWVudC5yZW1vdmVBdHRyKFwiZGF0YS1hdHRyaWRcIik7XG4gICAgICB0aGlzLmVsZW1lbnQuZW1wdHkoKTtcbiAgICAgIHRoaXMuX3RyaWdnZXIoXCJkZXN0cm95XCIpO1xuICAgICAgdGhpcy5fc3VwZXIoKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogSW5pdCB0aGUgRE9NIG9mIHRoZSB0ZW1wbGF0ZVxuICAgICAqXG4gICAgICogQHByb3RlY3RlZFxuICAgICAqL1xuICAgIF9pbml0RG9tOiBmdW5jdGlvbiB3QXR0cmlidXRlSW5pdERvbSgpIHtcbiAgICAgIHZhciBodG1sTGluayA9IHRoaXMuZ2V0TGluaygpO1xuICAgICAgdmFyIHNjb3BlV2lkZ2V0ID0gdGhpcztcbiAgICAgIHRoaXMuX2luaXRNYWluRWxlbWVudENsYXNzKCk7XG4gICAgICBpZiAoaHRtbExpbmspIHtcbiAgICAgICAgLy8gQWRkIHJlbmRlciBVcmwgYW5kIHRpdGxlIG9uIGxpbmtzXG4gICAgICAgIHZhciBvcmlnaW5hbEVzY2FwZSA9IE11c3RhY2hlLmVzY2FwZTtcblxuICAgICAgICBpZiAodGhpcy5faXNNdWx0aXBsZSgpKSB7XG4gICAgICAgICAgdGhpcy5vcHRpb25zLmF0dHJpYnV0ZVZhbHVlcyA9IF8ubWFwKFxuICAgICAgICAgICAgdGhpcy5vcHRpb25zLmF0dHJpYnV0ZVZhbHVlLFxuICAgICAgICAgICAgZnVuY3Rpb24gd0F0dHJpYnV0ZUxpbmtNdWx0aXBsZSh2YWwsIGluZGV4KSB7XG4gICAgICAgICAgICAgIHZhciB1cmxJbmRleCA9IGluZGV4O1xuICAgICAgICAgICAgICBNdXN0YWNoZS5lc2NhcGUgPSBlbmNvZGVVUklDb21wb25lbnQ7XG4gICAgICAgICAgICAgIHNjb3BlV2lkZ2V0Ll9jb21wbGV0ZVJldmlzaW9uRGF0YSh2YWwpO1xuICAgICAgICAgICAgICBpZiAoc2NvcGVXaWRnZXQub3B0aW9ucy5pbmRleCA+PSAwKSB7XG4gICAgICAgICAgICAgICAgLy8gVXNlIGluZGV4IG9mIHJvdyBwcmlvciB0byBpbmRleCBvZiBtdWx0aXBsZSB2YWx1ZVxuICAgICAgICAgICAgICAgIHVybEluZGV4ID0gc2NvcGVXaWRnZXQub3B0aW9ucy5pbmRleDtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIGlmIChodG1sTGluay51cmxzICYmIGh0bWxMaW5rLnVybHNbdXJsSW5kZXhdKSB7XG4gICAgICAgICAgICAgICAgdmFsLnJlbmRlclVybCA9IE11c3RhY2hlLnJlbmRlcihodG1sTGluay51cmxzW3VybEluZGV4XSwgdmFsKTtcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB2YWwucmVuZGVyVXJsID0gTXVzdGFjaGUucmVuZGVyKGh0bWxMaW5rLnVybCB8fCBcIlwiLCB2YWwpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIE11c3RhY2hlLmVzY2FwZSA9IG9yaWdpbmFsRXNjYXBlO1xuICAgICAgICAgICAgICB2YWwucmVuZGVyVGl0bGUgPSBNdXN0YWNoZS5yZW5kZXIoaHRtbExpbmsudGl0bGUgfHwgXCJcIiwgdmFsKTtcbiAgICAgICAgICAgICAgdmFsLmluZGV4ID0gaW5kZXg7XG4gICAgICAgICAgICAgIHJldHVybiB2YWw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBNdXN0YWNoZS5lc2NhcGUgPSBlbmNvZGVVUklDb21wb25lbnQ7XG4gICAgICAgICAgdGhpcy5fY29tcGxldGVSZXZpc2lvbkRhdGEodGhpcy5vcHRpb25zLmF0dHJpYnV0ZVZhbHVlKTtcbiAgICAgICAgICBpZiAoaHRtbExpbmsudXJscyAmJiBodG1sTGluay51cmxzW3RoaXMub3B0aW9ucy5pbmRleF0pIHtcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucy5yZW5kZXJPcHRpb25zLmh0bWxMaW5rLnJlbmRlclVybCA9IE11c3RhY2hlLnJlbmRlcihcbiAgICAgICAgICAgICAgaHRtbExpbmsudXJsc1t0aGlzLm9wdGlvbnMuaW5kZXhdLFxuICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMuYXR0cmlidXRlVmFsdWVcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucy5yZW5kZXJPcHRpb25zLmh0bWxMaW5rLnJlbmRlclVybCA9IE11c3RhY2hlLnJlbmRlcihcbiAgICAgICAgICAgICAgaHRtbExpbmsudXJsIHx8IFwiXCIsXG4gICAgICAgICAgICAgIHRoaXMub3B0aW9ucy5hdHRyaWJ1dGVWYWx1ZVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgTXVzdGFjaGUuZXNjYXBlID0gb3JpZ2luYWxFc2NhcGU7XG4gICAgICAgICAgdGhpcy5vcHRpb25zLnJlbmRlck9wdGlvbnMuaHRtbExpbmsucmVuZGVyVGl0bGUgPSBNdXN0YWNoZS5yZW5kZXIoXG4gICAgICAgICAgICBodG1sTGluay50aXRsZSB8fCBcIlwiLFxuICAgICAgICAgICAgdGhpcy5vcHRpb25zLmF0dHJpYnV0ZVZhbHVlXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgdGhpcy5lbGVtZW50LmFwcGVuZChcbiAgICAgICAgTXVzdGFjaGUucmVuZGVyKFxuICAgICAgICAgIHRoaXMuX2dldFRlbXBsYXRlKHRoaXMub3B0aW9ucy5tb2RlKSB8fCBcIlwiLFxuICAgICAgICAgIHRoaXMub3B0aW9uc1xuICAgICAgICApXG4gICAgICApO1xuXG4gICAgICBpZiAoXG4gICAgICAgIHRoaXMuZWxlbWVudC5maW5kKFwiLmRjcEF0dHJpYnV0ZV9fY29udGVudF9fYnV0dG9ucyBidXR0b25cIikubGVuZ3RoID09PSAwXG4gICAgICApIHtcbiAgICAgICAgdGhpcy5lbGVtZW50LmZpbmQoXCIuZGNwQXR0cmlidXRlX19jb250ZW50X19idXR0b25zXCIpLmhpZGUoKTtcbiAgICAgICAgdGhpcy5lbGVtZW50XG4gICAgICAgICAgLmZpbmQoXCIuZGNwQXR0cmlidXRlX192YWx1ZVwiKVxuICAgICAgICAgIC5hZGRDbGFzcyhcImRjcEF0dHJpYnV0ZV9fY29udGVudF9fbm9idXR0b25cIik7XG4gICAgICB9XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEFkZCByZXZpc2lvbiBleHRyYSBkYXRhIHRvIHJlbmRlciBsaW5rXG4gICAgICogQHBhcmFtIGRhdGFcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9jb21wbGV0ZVJldmlzaW9uRGF0YTogZnVuY3Rpb24gd0F0dHJpYnV0ZV9jb21wbGV0ZVJldmlzaW9uRGF0YShkYXRhKSB7XG4gICAgICB2YXIgaXNSZXZpc2lvbiA9XG4gICAgICAgIGRhdGEucmV2aXNpb24gIT09IC0xICYmXG4gICAgICAgIGRhdGEucmV2aXNpb24gIT09IG51bGwgJiZcbiAgICAgICAgIV8uaXNVbmRlZmluZWQoZGF0YS5yZXZpc2lvbik7XG5cbiAgICAgIGlmIChpc1JldmlzaW9uKSB7XG4gICAgICAgIGRhdGEuaXNSZXZpc2lvbiA9IGlzUmV2aXNpb247XG4gICAgICAgIGlmIChkYXRhLnJldmlzaW9uLnN0YXRlKSB7XG4gICAgICAgICAgZGF0YS5yZXZpc2lvblRhcmdldCA9IFwic3RhdGU6XCIgKyBkYXRhLnJldmlzaW9uLnN0YXRlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGRhdGEucmV2aXNpb25UYXJnZXQgPSBkYXRhLnJldmlzaW9uO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEluaXQgdGhlIERPTSBvZiB0aGUgdGVtcGxhdGVcbiAgICAgKlxuICAgICAqIEBwdWJsaWNcbiAgICAgKi9cbiAgICBfaW5pdE1haW5FbGVtZW50Q2xhc3M6IGZ1bmN0aW9uIHdBdHRyaWJ1dGVJbml0TWFpbkVsZW1lbnRDbGFzcygpIHtcbiAgICAgIHRoaXMuZWxlbWVudC5hZGRDbGFzcyhcImRjcEF0dHJpYnV0ZV9fY29udGVudFwiKTtcbiAgICAgIHRoaXMuZWxlbWVudC5hdHRyKFwiZGF0YS10eXBlXCIsIHRoaXMuZ2V0VHlwZSgpKTtcbiAgICAgIHRoaXMuZWxlbWVudC5hdHRyKFwiZGF0YS1hdHRyaWRcIiwgdGhpcy5vcHRpb25zLmlkKTtcbiAgICB9LFxuICAgIC8qKlxuICAgICAqIEluaXQgdGhlIGV2ZW50c1xuICAgICAqXG4gICAgICogQHByb3RlY3RlZFxuICAgICAqL1xuICAgIF9pbml0RXZlbnQ6IGZ1bmN0aW9uIF9pbml0RXZlbnQoKSB7XG4gICAgICBpZiAodGhpcy5nZXRNb2RlKCkgPT09IFwid3JpdGVcIikge1xuICAgICAgICB0aGlzLl9pbml0RGVsZXRlRXZlbnQoKTtcbiAgICAgICAgdGhpcy5faW5pdEJ1dHRvbnNFdmVudCgpO1xuICAgICAgICB0aGlzLl9pbml0Rm9jdXNFdmVudCgpO1xuICAgICAgICB0aGlzLl9pbml0TW92ZUV2ZW50KCk7XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5nZXRNb2RlKCkgPT09IFwicmVhZFwiKSB7XG4gICAgICAgIHRoaXMuX2luaXRCdXR0b25zRXZlbnQoKTtcbiAgICAgICAgdGhpcy5faW5pdEFjdGlvbkNsaWNrRXZlbnQoKTtcbiAgICAgICAgdGhpcy5faW5pdExpbmtFdmVudCgpO1xuICAgICAgfVxuICAgICAgdGhpcy5faW5pdEVycm9yRXZlbnQoKTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBJbml0IHRoZSBmb2N1cyBldmVudCBmb3IgdG9vbHRpcHMgKG9ubHkgZm9yIHdyaXRlIGF0dHIpXG4gICAgICpcbiAgICAgKiBAcHJvdGVjdGVkXG4gICAgICovXG4gICAgX2luaXRGb2N1c0V2ZW50OiBmdW5jdGlvbiB3QXR0cmlidXRlSW5pdEZvY3VzRXZlbnQoKSB7XG4gICAgICBpZiAoXG4gICAgICAgIHRoaXMub3B0aW9ucy5yZW5kZXJPcHRpb25zICYmXG4gICAgICAgIHRoaXMub3B0aW9ucy5yZW5kZXJPcHRpb25zLmlucHV0SHRtbFRvb2x0aXBcbiAgICAgICkge1xuICAgICAgICB2YXIgc2NvcGUgPSB0aGlzO1xuXG4gICAgICAgIHZhciBpbnB1dFRhcmdldEZpbHRlciA9IFwiLmRjcEF0dHJpYnV0ZV9fdmFsdWVcIjtcbiAgICAgICAgdGhpcy5fZ2V0Rm9jdXNJbnB1dCgpLm9uKFxuICAgICAgICAgIFwiZm9jdXNcIiArIHRoaXMuZXZlbnROYW1lc3BhY2UsXG4gICAgICAgICAgZnVuY3Rpb24gd0F0dHJpYnV0ZUZvY3VzKGV2ZW50KSB7XG4gICAgICAgICAgICB2YXIga3RUYXJnZXQgPSAkKGV2ZW50LmN1cnJlbnRUYXJnZXQpLmNsb3Nlc3QoaW5wdXRUYXJnZXRGaWx0ZXIpO1xuICAgICAgICAgICAgc2NvcGUuc2hvd0lucHV0VG9vbHRpcChrdFRhcmdldCk7XG4gICAgICAgICAgfVxuICAgICAgICApO1xuICAgICAgICB0aGlzLl9nZXRGb2N1c0lucHV0KCkub24oXG4gICAgICAgICAgXCJibHVyLlwiICsgdGhpcy5ldmVudE5hbWVzcGFjZSxcbiAgICAgICAgICBmdW5jdGlvbiB3QXR0cmlidXRlQmx1cihldmVudCkge1xuICAgICAgICAgICAgdmFyIGt0VGFyZ2V0ID0gJChldmVudC5jdXJyZW50VGFyZ2V0KS5jbG9zZXN0KGlucHV0VGFyZ2V0RmlsdGVyKTtcbiAgICAgICAgICAgIHNjb3BlLmhpZGVJbnB1dFRvb2x0aXAoa3RUYXJnZXQpO1xuICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuX2dldEZvY3VzSW5wdXQoKS5vbihcbiAgICAgICAgXCJmb2N1c1wiICsgdGhpcy5ldmVudE5hbWVzcGFjZSxcbiAgICAgICAgZnVuY3Rpb24gd0F0dHJpYnV0ZUZvY3VzKGV2ZW50KSB7XG4gICAgICAgICAgdmFyICRjb250ZW50ID0gJChldmVudC5jdXJyZW50VGFyZ2V0KS5jbG9zZXN0KFxuICAgICAgICAgICAgXCIuZGNwQXR0cmlidXRlX19jb250ZW50XCJcbiAgICAgICAgICApO1xuICAgICAgICAgICRjb250ZW50LmFkZENsYXNzKFwiZGNwQXR0cmlidXRlLS1mb2N1c1wiKTtcbiAgICAgICAgfVxuICAgICAgKTtcbiAgICAgIHRoaXMuX2dldEZvY3VzSW5wdXQoKS5vbihcbiAgICAgICAgXCJibHVyXCIgKyB0aGlzLmV2ZW50TmFtZXNwYWNlLFxuICAgICAgICBmdW5jdGlvbiB3QXR0cmlidXRlRm9jdXMoZXZlbnQpIHtcbiAgICAgICAgICB2YXIgJGNvbnRlbnQgPSAkKGV2ZW50LmN1cnJlbnRUYXJnZXQpLmNsb3Nlc3QoXG4gICAgICAgICAgICBcIi5kY3BBdHRyaWJ1dGVfX2NvbnRlbnRcIlxuICAgICAgICAgICk7XG4gICAgICAgICAgJGNvbnRlbnQucmVtb3ZlQ2xhc3MoXCJkY3BBdHRyaWJ1dGUtLWZvY3VzXCIpO1xuICAgICAgICB9XG4gICAgICApO1xuXG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuICAgIC8qKlxuICAgICAqIFJlaW5kZXggd2lkZ2V0IHdoZW4gYSBtb3ZlIGlzIHBlcmZvcm1lZCBpbiBhbiBhcnJheVxuICAgICAqXG4gICAgICogQHByb3RlY3RlZFxuICAgICAqL1xuICAgIF9pbml0TW92ZUV2ZW50OiBmdW5jdGlvbiB3QXR0cmlidXRlSW5pdEZvY3VzRXZlbnQoKSB7XG4gICAgICB2YXIgc2NvcGUgPSB0aGlzO1xuICAgICAgaWYgKHRoaXMub3B0aW9ucy5pbmRleCAhPT0gLTEpIHtcbiAgICAgICAgdGhpcy5lbGVtZW50Lm9uKFxuICAgICAgICAgIFwicG9zdE1vdmVkXCIgKyB0aGlzLmV2ZW50TmFtZXNwYWNlLFxuICAgICAgICAgIGZ1bmN0aW9uIHdBdHRyaWJ1dGVpbml0TW92ZUV2ZW50KCkge1xuICAgICAgICAgICAgdmFyIGRvbUxpbmUgPSBzY29wZS5lbGVtZW50LmNsb3Nlc3QoXCJ0clwiKS5kYXRhKFwibGluZVwiKTtcbiAgICAgICAgICAgIGlmICghXy5pc1VuZGVmaW5lZChkb21MaW5lKSkge1xuICAgICAgICAgICAgICBzY29wZS5vcHRpb25zLmluZGV4ID0gZG9tTGluZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuICAgIC8qKlxuICAgICAqIEluaXQgdGhlIGV2ZW50cyBhc3NvY2lhdGVkIHRvIGJ1dHRvbnMgKG9ubHkgZm9yIHdyaXRlIGF0dHJpYnV0ZXMpXG4gICAgICpcbiAgICAgKiBAcHJvdGVjdGVkXG4gICAgICovXG4gICAgX2luaXRCdXR0b25zRXZlbnQ6IGZ1bmN0aW9uIF9pbml0QnV0dG9uc0V2ZW50KCkge1xuICAgICAgdmFyIGN1cnJlbnRXaWRnZXQgPSB0aGlzO1xuICAgICAgdGhpcy5lbGVtZW50Lm9uKFxuICAgICAgICBcImNsaWNrXCIgKyB0aGlzLmV2ZW50TmFtZXNwYWNlLFxuICAgICAgICBcIi5kY3BBdHRyaWJ1dGVfX2NvbnRlbnRfX2J1dHRvbi0tZXh0cmFcIixcbiAgICAgICAgZnVuY3Rpb24gd0F0dHJpYnV0ZUJ1dHRvbkNsaWNrKGV2ZW50KSB7XG4gICAgICAgICAgdmFyIGJ1dHRvbnNDb25maWcgPSBjdXJyZW50V2lkZ2V0Lm9wdGlvbnMucmVuZGVyT3B0aW9ucy5idXR0b25zO1xuICAgICAgICAgIHZhciAkYnV0dG9uID0gJCh0aGlzKTtcbiAgICAgICAgICB2YXIgYnV0dG9uSW5kZXggPSAkYnV0dG9uLmRhdGEoXCJpbmRleFwiKTtcbiAgICAgICAgICB2YXIgYnV0dG9uQ29uZmlnID0gYnV0dG9uc0NvbmZpZ1tidXR0b25JbmRleF07XG4gICAgICAgICAgdmFyIHdGZWF0dXJlID0gXCJcIjtcblxuICAgICAgICAgIGlmIChidXR0b25Db25maWcgJiYgYnV0dG9uQ29uZmlnLnVybCkge1xuICAgICAgICAgICAgdmFyIG9yaWdpbmFsRXNjYXBlID0gTXVzdGFjaGUuZXNjYXBlO1xuICAgICAgICAgICAgTXVzdGFjaGUuZXNjYXBlID0gZW5jb2RlVVJJQ29tcG9uZW50O1xuICAgICAgICAgICAgdmFyIHVybCA9IE11c3RhY2hlLnJlbmRlcihcbiAgICAgICAgICAgICAgYnV0dG9uQ29uZmlnLnVybCB8fCBcIlwiLFxuICAgICAgICAgICAgICBjdXJyZW50V2lkZ2V0Lm9wdGlvbnMuYXR0cmlidXRlVmFsdWVcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBNdXN0YWNoZS5lc2NhcGUgPSBvcmlnaW5hbEVzY2FwZTtcblxuICAgICAgICAgICAgaWYgKGJ1dHRvbkNvbmZpZy50YXJnZXQgIT09IFwiX2RpYWxvZ1wiKSB7XG4gICAgICAgICAgICAgIHZhciAkYmFzZSA9ICQoXCJiYXNlXCIpO1xuICAgICAgICAgICAgICB2YXIgaXNBYnNVcmwgPSBuZXcgUmVnRXhwKFwiXig/OlthLXpdKzopPy8vXCIsIFwiaVwiKTtcblxuICAgICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgYnV0dG9uQ29uZmlnICYmXG4gICAgICAgICAgICAgICAgKGJ1dHRvbkNvbmZpZy53aW5kb3dXaWR0aCB8fCBidXR0b25Db25maWcud2luZG93SGVpZ2h0KVxuICAgICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICBpZiAoYnV0dG9uQ29uZmlnLndpbmRvd1dpZHRoKSB7XG4gICAgICAgICAgICAgICAgICB3RmVhdHVyZSArPVxuICAgICAgICAgICAgICAgICAgICBcIndpZHRoPVwiICsgcGFyc2VJbnQoYnV0dG9uQ29uZmlnLndpbmRvd1dpZHRoLCAxMCkgKyBcIixcIjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGJ1dHRvbkNvbmZpZy53aW5kb3dIZWlnaHQpIHtcbiAgICAgICAgICAgICAgICAgIHdGZWF0dXJlICs9XG4gICAgICAgICAgICAgICAgICAgIFwiaGVpZ2h0PVwiICsgcGFyc2VJbnQoYnV0dG9uQ29uZmlnLndpbmRvd0hlaWdodCwgMTApICsgXCIsXCI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHdGZWF0dXJlICs9IFwicmVzaXphYmxlPXllcyxzY3JvbGxiYXJzPXllc1wiO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGlmICghaXNBYnNVcmwudGVzdCh1cmwpKSB7XG4gICAgICAgICAgICAgICAgLy8gRm9yIElFIDogTm90IGhvbm9yIGJhc2UgaHJlZiBpbiB0aGlzIGNhc2VcbiAgICAgICAgICAgICAgICB1cmwgPSAkYmFzZS5hdHRyKFwiaHJlZlwiKSArIHVybDtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB3aW5kb3cub3Blbih1cmwsIGJ1dHRvbkNvbmZpZy50YXJnZXQsIHdGZWF0dXJlKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHZhciAkYmR3ID0gJChcIjxkaXYvPlwiKTtcbiAgICAgICAgICAgICAgJChcImJvZHlcIikuYXBwZW5kKCRiZHcpO1xuICAgICAgICAgICAgICB2YXIgcmVuZGVyVGl0bGUgPSBNdXN0YWNoZS5yZW5kZXIoXG4gICAgICAgICAgICAgICAgYnV0dG9uQ29uZmlnLndpbmRvd1RpdGxlIHx8IFwiXCIsXG4gICAgICAgICAgICAgICAgY3VycmVudFdpZGdldC5vcHRpb25zLmF0dHJpYnV0ZVZhbHVlXG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgIHZhciBkdyA9ICRiZHdcbiAgICAgICAgICAgICAgICAuZGNwV2luZG93KHtcbiAgICAgICAgICAgICAgICAgIHRpdGxlOiByZW5kZXJUaXRsZSxcbiAgICAgICAgICAgICAgICAgIHdpZHRoOiBidXR0b25Db25maWcud2luZG93V2lkdGgsXG4gICAgICAgICAgICAgICAgICBoZWlnaHQ6IGJ1dHRvbkNvbmZpZy53aW5kb3dIZWlnaHQsXG4gICAgICAgICAgICAgICAgICBjb250ZW50OiB1cmwsXG4gICAgICAgICAgICAgICAgICBpZnJhbWU6IHRydWVcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5kYXRhKFwiZGNwV2luZG93XCIpO1xuICAgICAgICAgICAgICBkdy5rZW5kb1dpbmRvdygpLmNlbnRlcigpO1xuICAgICAgICAgICAgICBkdy5vcGVuKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgY3VycmVudFdpZGdldC5fdHJpZ2dlcihcImNsaWNrXCIsIGV2ZW50LCB7XG4gICAgICAgICAgICBpZDogY3VycmVudFdpZGdldC5vcHRpb24uaWQsXG4gICAgICAgICAgICB2YWx1ZTogY3VycmVudFdpZGdldC5vcHRpb25zLmF0dHJpYnV0ZVZhbHVlLFxuICAgICAgICAgICAgaW5kZXg6IGN1cnJlbnRXaWRnZXQuX2dldEluZGV4KClcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgKTtcbiAgICAgIHRoaXMuZWxlbWVudC50b29sdGlwKHtcbiAgICAgICAgc2VsZWN0b3I6IFwiLmRjcEF0dHJpYnV0ZV9fY29udGVudF9fYnV0dG9ucyBidXR0b25cIixcbiAgICAgICAgcGxhY2VtZW50OiBcInRvcFwiLFxuICAgICAgICB0cmlnZ2VyOiBcImhvdmVyXCIsXG4gICAgICAgIGh0bWw6IHRydWUsXG4gICAgICAgIHRpdGxlOiBmdW5jdGlvbiB3QXR0cmlidXRlR2V0QnV0dG9uVGl0bGUoKSB7XG4gICAgICAgICAgdmFyIHRpdGxlID0gJCh0aGlzKS5kYXRhKFwidGl0bGVcIik7XG4gICAgICAgICAgdmFyIGF0dHJWYWx1ZSA9IGN1cnJlbnRXaWRnZXQuZ2V0VmFsdWUoKTtcbiAgICAgICAgICByZXR1cm4gTXVzdGFjaGUucmVuZGVyKHRpdGxlIHx8IFwiXCIsIGF0dHJWYWx1ZSk7XG4gICAgICAgIH0sXG4gICAgICAgIGNvbnRhaW5lcjogdGhpcy5lbGVtZW50LmNsb3Nlc3QoXCIucm93XCIpLmdldCgwKSB8fCB0aGlzLmVsZW1lbnRcbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogSW5pdCBldmVudHMgZm9yIGRlbGV0ZSBidXR0b24gb24gZXJyb3IgdG9vbHRpcFxuICAgICAqXG4gICAgICogQHByb3RlY3RlZFxuICAgICAqL1xuICAgIF9pbml0RXJyb3JFdmVudDogZnVuY3Rpb24gd0F0dHJpYnV0ZUluaXRFcnJvdEV2ZW50KCkge1xuICAgICAgdmFyIHNjb3BlID0gdGhpcztcbiAgICAgIC8vIHRvb2x0aXAgaXMgY3JlYXRlZCBpbiBzYW1lIHBhcmVudFxuICAgICAgdGhpcy5lbGVtZW50XG4gICAgICAgIC5wYXJlbnQoKVxuICAgICAgICAub24oXG4gICAgICAgICAgXCJjbGlja1wiICsgdGhpcy5ldmVudE5hbWVzcGFjZSxcbiAgICAgICAgICBcIi5idXR0b24tY2xvc2UtZXJyb3JcIixcbiAgICAgICAgICBmdW5jdGlvbiBjbG9zZUVycm9yKC8qZXZlbnQqLykge1xuICAgICAgICAgICAgaWYgKHNjb3BlLmVsZW1lbnQuZGF0YShcImhhc0Vycm9yVG9vbHRpcFwiKSkge1xuICAgICAgICAgICAgICBzY29wZS5lbGVtZW50LmZpbmQoXCIuaW5wdXQtZ3JvdXBcIikudG9vbHRpcChcImhpZGVcIik7XG4gICAgICAgICAgICAgIHNjb3BlLmVsZW1lbnQuZGF0YShcImhhc0Vycm9yVG9vbHRpcFwiLCBmYWxzZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICApO1xuICAgIH0sXG4gICAgLyoqXG4gICAgICogSW5pdCBldmVudHMgZm9yIGRlbGV0ZSBidXR0b24gKG9ubHkgZm9yIHdyaXRlIGF0dHJpYnV0ZXMpXG4gICAgICpcbiAgICAgKiBAcHJvdGVjdGVkXG4gICAgICovXG4gICAgX2luaXREZWxldGVFdmVudDogZnVuY3Rpb24gd0F0dHJpYnV0ZUluaXREZWxldGVFdmVudCgpIHtcbiAgICAgIHZhciBjdXJyZW50V2lkZ2V0ID0gdGhpcztcblxuICAgICAgLy8gQ29tcG9zZSBkZWxldGUgYnV0dG9uIHRpdGxlXG4gICAgICB2YXIgJGRlbGV0ZUJ1dHRvbiA9IHRoaXMuZWxlbWVudC5maW5kKFxuICAgICAgICBcIi5kY3BBdHRyaWJ1dGVfX2NvbnRlbnRfX2J1dHRvbi0tZGVsZXRlXCJcbiAgICAgICk7XG4gICAgICB2YXIgdGl0bGVEZWxldGU7XG4gICAgICBpZiAodGhpcy5vcHRpb25zLmxhYmVscy5kZWxldGVMYWJlbCkge1xuICAgICAgICB0aXRsZURlbGV0ZSA9IHRoaXMub3B0aW9ucy5sYWJlbHMuZGVsZXRlTGFiZWw7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aXRsZURlbGV0ZSA9ICRkZWxldGVCdXR0b24uYXR0cihcInRpdGxlXCIpO1xuICAgICAgICB0aXRsZURlbGV0ZSArPSB0aGlzLm9wdGlvbnMubGFiZWxzLmRlbGV0ZUF0dHJpYnV0ZU5hbWVzO1xuICAgICAgfVxuICAgICAgJGRlbGV0ZUJ1dHRvbi5hdHRyKFwidGl0bGVcIiwgdGl0bGVEZWxldGUpO1xuXG4gICAgICB0aGlzLmVsZW1lbnQub24oXG4gICAgICAgIFwiY2xpY2tcIiArIHRoaXMuZXZlbnROYW1lc3BhY2UsXG4gICAgICAgIFwiLmRjcEF0dHJpYnV0ZV9fY29udGVudF9fYnV0dG9uLS1kZWxldGVcIixcbiAgICAgICAgZnVuY3Rpb24gZGVzdHJveVRhYmxlKGV2ZW50KSB7XG4gICAgICAgICAgY3VycmVudFdpZGdldC5fdHJpZ2dlcihcImRlbGV0ZVwiLCBldmVudCwge1xuICAgICAgICAgICAgaW5kZXg6IGN1cnJlbnRXaWRnZXQuX2dldEluZGV4KCksXG4gICAgICAgICAgICBpZDogY3VycmVudFdpZGdldC5vcHRpb25zLmlkXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgLy8gbWFpbiBpbnB1dCBpcyBmb2N1c2VzIGFmdGVyIGRlbGV0aW9uXG4gICAgICAgICAgXy5kZWZlcihmdW5jdGlvbiB3QXR0cmlidXRlRGVmZXJEZWxldGUoKSB7XG4gICAgICAgICAgICBjdXJyZW50V2lkZ2V0LmVsZW1lbnQuZmluZChcImlucHV0XCIpLmZvY3VzKCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuICAgIC8qKlxuICAgICAqIEluaXQgZXZlbnQgZm9yICNhY3Rpb24vIGxpbmtzXG4gICAgICpcbiAgICAgKiBAcHJvdGVjdGVkXG4gICAgICovXG4gICAgX2luaXRBY3Rpb25DbGlja0V2ZW50OiBmdW5jdGlvbiB3QXR0cmlidXRlSW5pdEFjdGlvbkNsaWNrRXZlbnQoKSB7XG4gICAgICB2YXIgc2NvcGVXaWRnZXQgPSB0aGlzO1xuXG4gICAgICB0aGlzLmVsZW1lbnQub24oXG4gICAgICAgIFwiY2xpY2suXCIgKyB0aGlzLmV2ZW50TmFtZXNwYWNlLFxuICAgICAgICAnYVtocmVmXj1cIiNhY3Rpb24vXCJdLCBhW2RhdGEtYWN0aW9uXSwgYnV0dG9uW2RhdGEtYWN0aW9uXScsXG4gICAgICAgIGZ1bmN0aW9uIHdBdHRyaWJ1dGVBY3Rpb25DbGljayhldmVudCkge1xuICAgICAgICAgIHZhciAkdGhpcyA9ICQodGhpcyksXG4gICAgICAgICAgICBhY3Rpb24sXG4gICAgICAgICAgICBvcHRpb25zLFxuICAgICAgICAgICAgZXZlbnRPcHRpb25zO1xuXG4gICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICBpZiAoZXZlbnQuc3RvcFByb3BhZ2F0aW9uKSB7XG4gICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBhY3Rpb24gPSAkdGhpcy5kYXRhKFwiYWN0aW9uXCIpIHx8ICR0aGlzLmF0dHIoXCJocmVmXCIpO1xuICAgICAgICAgIG9wdGlvbnMgPSBhY3Rpb24uc3Vic3RyaW5nKDgpLnNwbGl0KFwiOlwiKTtcbiAgICAgICAgICBldmVudE9wdGlvbnMgPSB7XG4gICAgICAgICAgICB0YXJnZXQ6IGV2ZW50LnRhcmdldCxcbiAgICAgICAgICAgIGluZGV4OiBzY29wZVdpZGdldC5fZ2V0SW5kZXgoKSxcbiAgICAgICAgICAgIGV2ZW50SWQ6IG9wdGlvbnMuc2hpZnQoKSxcbiAgICAgICAgICAgIG9wdGlvbnM6IG9wdGlvbnNcbiAgICAgICAgICB9O1xuXG4gICAgICAgICAgc2NvcGVXaWRnZXQuX3RyaWdnZXIoXCJleHRlcm5hbExpbmtTZWxlY3RlZFwiLCBldmVudCwgZXZlbnRPcHRpb25zKTtcbiAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfVxuICAgICAgKTtcbiAgICB9LFxuICAgIC8qKlxuICAgICAqIEluaXQgZXZlbnQgd2hlbiBhIGh5cGVybGluayBpcyBhc3NvY2lhdGVkIHRvIHRoZSBhdHRyaWJ1dGVcbiAgICAgKlxuICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgKi9cbiAgICBfaW5pdExpbmtFdmVudDogZnVuY3Rpb24gd0F0dHJpYnV0ZUluaXRMaW5rRXZlbnQoKSB7XG4gICAgICB2YXIgaHRtbExpbmsgPSB0aGlzLmdldExpbmsoKTtcbiAgICAgIHZhciBzY29wZVdpZGdldCA9IHRoaXM7XG5cbiAgICAgIGlmIChodG1sTGluaykge1xuICAgICAgICB0aGlzLmVsZW1lbnQub24oXG4gICAgICAgICAgXCJjbGljay5cIiArIHRoaXMuZXZlbnROYW1lc3BhY2UsXG4gICAgICAgICAgXCIuZGNwQXR0cmlidXRlX19jb250ZW50X19saW5rXCIsXG4gICAgICAgICAgZnVuY3Rpb24gd0F0dHJpYnV0ZUF0dHJpYnV0ZUNsaWNrKGV2ZW50KSB7XG4gICAgICAgICAgICB2YXIgJHRoaXMgPSAkKHRoaXMpLFxuICAgICAgICAgICAgICByZW5kZXJUaXRsZSxcbiAgICAgICAgICAgICAgaW5kZXgsXG4gICAgICAgICAgICAgICRkaWFsb2dEaXYsXG4gICAgICAgICAgICAgIGRwY1dpbmRvdyxcbiAgICAgICAgICAgICAgaHJlZiA9ICR0aGlzLmF0dHIoXCJocmVmXCIpO1xuXG4gICAgICAgICAgICBpZiAoaHJlZi5zdWJzdHJpbmcoMCwgOCkgIT09IFwiI2FjdGlvbi9cIiAmJiAhJHRoaXMuZGF0YShcImFjdGlvblwiKSkge1xuICAgICAgICAgICAgICBpZiAoaHRtbExpbmsudGFyZ2V0ID09PSBcIl9kaWFsb2dcIikge1xuICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgICAgICAgICBpbmRleCA9ICQodGhpcykuZGF0YShcImluZGV4XCIpO1xuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgaW5kZXggIT09IFwidW5kZWZpbmVkXCIgJiYgaW5kZXggIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgIHJlbmRlclRpdGxlID0gTXVzdGFjaGUucmVuZGVyKFxuICAgICAgICAgICAgICAgICAgICBodG1sTGluay53aW5kb3dUaXRsZSB8fCBcIlwiLFxuICAgICAgICAgICAgICAgICAgICBzY29wZVdpZGdldC5vcHRpb25zLmF0dHJpYnV0ZVZhbHVlW2luZGV4XVxuICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgcmVuZGVyVGl0bGUgPSBNdXN0YWNoZS5yZW5kZXIoXG4gICAgICAgICAgICAgICAgICAgIGh0bWxMaW5rLndpbmRvd1RpdGxlIHx8IFwiXCIsXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlV2lkZ2V0Lm9wdGlvbnMuYXR0cmlidXRlVmFsdWVcbiAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgJGRpYWxvZ0RpdiA9ICQoXCI8ZGl2Lz5cIik7XG4gICAgICAgICAgICAgICAgJChcImJvZHlcIikuYXBwZW5kKCRkaWFsb2dEaXYpO1xuXG4gICAgICAgICAgICAgICAgZHBjV2luZG93ID0gJGRpYWxvZ0Rpdi5kY3BXaW5kb3coe1xuICAgICAgICAgICAgICAgICAgdGl0bGU6IHJlbmRlclRpdGxlLFxuICAgICAgICAgICAgICAgICAgd2lkdGg6IGh0bWxMaW5rLndpbmRvd1dpZHRoLFxuICAgICAgICAgICAgICAgICAgaGVpZ2h0OiBodG1sTGluay53aW5kb3dIZWlnaHQsXG4gICAgICAgICAgICAgICAgICBjb250ZW50OiBocmVmLFxuICAgICAgICAgICAgICAgICAgaWZyYW1lOiB0cnVlXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBkcGNXaW5kb3dcbiAgICAgICAgICAgICAgICAgIC5kYXRhKFwiZGNwV2luZG93XCIpXG4gICAgICAgICAgICAgICAgICAua2VuZG9XaW5kb3coKVxuICAgICAgICAgICAgICAgICAgLmNlbnRlcigpO1xuICAgICAgICAgICAgICAgIGRwY1dpbmRvdy5kYXRhKFwiZGNwV2luZG93XCIpLm9wZW4oKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgKTtcblxuICAgICAgICB0aGlzLmVsZW1lbnRcbiAgICAgICAgICAuZmluZChcIi5kY3BBdHRyaWJ1dGVfX2NvbnRlbnRfX2xpbmtbdGl0bGVdXCIpXG4gICAgICAgICAgLnRvb2x0aXAoe1xuICAgICAgICAgICAgcGxhY2VtZW50OiBcInRvcFwiLFxuICAgICAgICAgICAgY29udGFpbmVyOiBcIi5kY3BEb2N1bWVudFwiLFxuICAgICAgICAgICAgaHRtbDogdHJ1ZSxcbiAgICAgICAgICAgIHRyaWdnZXI6IFwiaG92ZXJcIlxuICAgICAgICAgIH0pXG4gICAgICAgICAgLmVhY2goZnVuY3Rpb24gd0F0dHJpYnV0ZUluaXRMaW5rVG9vbHRpcCgpIHtcbiAgICAgICAgICAgIGlmICgkKHRoaXMpLmRhdGEoXCJicy50b29sdGlwXCIpLnRpcCkge1xuICAgICAgICAgICAgICAkKHRoaXMpXG4gICAgICAgICAgICAgICAgLmRhdGEoXCJicy50b29sdGlwXCIpXG4gICAgICAgICAgICAgICAgLnRpcCgpXG4gICAgICAgICAgICAgICAgLmFkZENsYXNzKFwiZGNwQXR0cmlidXRlX19saW5rdmFsdWVcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogR2V0IGlucHV0IHRoYXQgY2FuIGhhbmRsZSBmb2N1cyBjbGFzc1xuICAgICAqXG4gICAgICogRm9yIHRoZSBkaXNwbGF5IG9mIHRoZSBmb2N1cyBjbGFzcyAoaW4gaGVscGVycylcbiAgICAgKlxuICAgICAqIEByZXR1cm4ganF1ZXJ5IGVsZW1lbnRzXG4gICAgICpcbiAgICAgKiBAcHJvdGVjdGVkXG4gICAgICovXG4gICAgX2dldEZvY3VzSW5wdXQ6IGZ1bmN0aW9uIHdBdHRyaWJ1dGVGb2N1c0lucHV0KCkge1xuICAgICAgcmV0dXJuIHRoaXMuZWxlbWVudC5maW5kKCdpbnB1dFtuYW1lPVwiJyArIHRoaXMub3B0aW9ucy5pZCArICdcIl0nKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogUmV0dXJuIHRoZSBpbmRleCBvZiB0aGUgYXR0cmlidXRlcyAoZm9yIGF0dHJpYnV0ZSBpbiBhIHdpZGdldCBhcnJheSlcbiAgICAgKlxuICAgICAqIEByZXR1cm5zIGludFxuICAgICAqIEBwcm90ZWN0ZWRcbiAgICAgKi9cbiAgICBfZ2V0SW5kZXg6IGZ1bmN0aW9uIF9nZXRJbmRleCgpIHtcbiAgICAgIGlmICh0aGlzLm9wdGlvbnMuaW5kZXggIT09IC0xKSB7XG4gICAgICAgIHRoaXMub3B0aW9ucy5pbmRleCA9IHRoaXMuZWxlbWVudFxuICAgICAgICAgIC5jbG9zZXN0KFwiLmRjcEFycmF5X19jb250ZW50X19saW5lXCIpXG4gICAgICAgICAgLmRhdGEoXCJsaW5lXCIpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRoaXMub3B0aW9ucy5pbmRleDtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogUmV0dXJuIHRoZSBlbXB0eSB2YWx1ZSAoZGVmYXVsdCB2YWx1ZSBpZiB0aGUgYXR0cmlidXRlIGlzIGVtcHR5KVxuICAgICAqXG4gICAgICogQHJldHVybnMgeyp9XG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfZ2V0RW1wdHlWYWx1ZTogZnVuY3Rpb24gX2dldEVtcHR5VmFsdWUoKSB7XG4gICAgICBpZiAoXG4gICAgICAgIF8uaXNFbXB0eSh0aGlzLm9wdGlvbnMuYXR0cmlidXRlVmFsdWUpIHx8XG4gICAgICAgIHRoaXMub3B0aW9ucy5hdHRyaWJ1dGVWYWx1ZS52YWx1ZSA9PT0gbnVsbFxuICAgICAgKSB7XG4gICAgICAgIGlmIChcbiAgICAgICAgICB0aGlzLm9wdGlvbnMucmVuZGVyT3B0aW9ucyAmJlxuICAgICAgICAgIHRoaXMub3B0aW9ucy5yZW5kZXJPcHRpb25zLnNob3dFbXB0eUNvbnRlbnRcbiAgICAgICAgKSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXMub3B0aW9ucy5yZW5kZXJPcHRpb25zLnNob3dFbXB0eUNvbnRlbnQgPT09IHRydWVcbiAgICAgICAgICAgID8gXCIgXCJcbiAgICAgICAgICAgIDogdGhpcy5vcHRpb25zLnJlbmRlck9wdGlvbnMuc2hvd0VtcHR5Q29udGVudDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gXCJcIjtcbiAgICAgIH1cbiAgICAgIHJldHVybiBcIlwiO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBHZXQgdGhlIHRlbXBsYXRlIG9mIHRoZSBjdXJyZW50IGF0dHJpYnV0ZVxuICAgICAqXG4gICAgICogVGhlIHRlbXBsYXRlIGNhbiBiZSBpbiB0aGUgb3B0aW9ucyBvciBpbiBhIGdsb2JhbCB2YXIgb2YgZGNwIG5hbWVzcGFjZSAoaW5pdGlhdGVkIGJ5IHJlcXVpcmUgZm9yIHdpZGdldClcbiAgICAgKlxuICAgICAqIEBwYXJhbSBrZXlcbiAgICAgKiBAcmV0dXJucyBzdHJpbmdcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9nZXRUZW1wbGF0ZTogZnVuY3Rpb24gX2dldFRlbXBsYXRlKGtleSkge1xuICAgICAgaWYgKHRoaXMub3B0aW9ucy50ZW1wbGF0ZXMgJiYgdGhpcy5vcHRpb25zLnRlbXBsYXRlc1trZXldKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm9wdGlvbnMudGVtcGxhdGVzW2tleV07XG4gICAgICB9XG4gICAgICBpZiAoXG4gICAgICAgIHdpbmRvdy5kY3AgJiZcbiAgICAgICAgd2luZG93LmRjcC50ZW1wbGF0ZXMgJiZcbiAgICAgICAgd2luZG93LmRjcC50ZW1wbGF0ZXNbdGhpcy5nZXRUeXBlKCldICYmXG4gICAgICAgIHdpbmRvdy5kY3AudGVtcGxhdGVzW3RoaXMuZ2V0VHlwZSgpXVtrZXldXG4gICAgICApIHtcbiAgICAgICAgcmV0dXJuIHdpbmRvdy5kY3AudGVtcGxhdGVzW3RoaXMuZ2V0VHlwZSgpXVtrZXldO1xuICAgICAgfVxuICAgICAgaWYgKFxuICAgICAgICB3aW5kb3cuZGNwICYmXG4gICAgICAgIHdpbmRvdy5kY3AudGVtcGxhdGVzICYmXG4gICAgICAgIHdpbmRvdy5kY3AudGVtcGxhdGVzW1wiZGVmYXVsdFwiXSAmJlxuICAgICAgICB3aW5kb3cuZGNwLnRlbXBsYXRlc1tcImRlZmF1bHRcIl1ba2V5XVxuICAgICAgKSB7XG4gICAgICAgIHJldHVybiB3aW5kb3cuZGNwLnRlbXBsYXRlc1tcImRlZmF1bHRcIl1ba2V5XTtcbiAgICAgIH1cbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgXCJVbmtub3duIHRlbXBsYXRlICBcIiArXG4gICAgICAgICAga2V5ICtcbiAgICAgICAgICBcIi9cIiArXG4gICAgICAgICAgdGhpcy5vcHRpb25zLnR5cGUgK1xuICAgICAgICAgIFwiIGZvciBcIiArXG4gICAgICAgICAgdGhpcy5vcHRpb25zLmlkXG4gICAgICApO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBUZXN0IGlmIHRoZSB2YWx1ZSBvZiB0aGUgc2V0VmFsdWUgaXMgY29ycmVjdFxuICAgICAqXG4gICAgICogQHBhcmFtIHZhbHVlXG4gICAgICogQHJldHVybnMge2Jvb2xlYW59XG4gICAgICovXG4gICAgX2NoZWNrVmFsdWU6IGZ1bmN0aW9uIHdBdHRyaWJ1dGVUZXN0VmFsdWUodmFsdWUpIHtcbiAgICAgIC8vbm9pbnNwZWN0aW9uIEpTSGludFxuICAgICAgaWYgKHRoaXMuX2lzTXVsdGlwbGUoKSkge1xuICAgICAgICAvLyBqc2hpbnQgaWdub3JlOmxpbmVcbiAgICAgICAgLy8gVE9ETyA6IFZlcmlmeSBlYWNoIGFycmF5IGVudHJ5XG4gICAgICAgIC8vIGpzY3M6ZGlzYWJsZSBkaXNhbGxvd0VtcHR5QmxvY2tzXG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBqc2NzOmVuYWJsZSBkaXNhbGxvd0VtcHR5QmxvY2tzXG4gICAgICAgIGlmIChcbiAgICAgICAgICAhXy5pc09iamVjdCh2YWx1ZSkgfHxcbiAgICAgICAgICAhXy5oYXModmFsdWUsIFwidmFsdWVcIikgfHxcbiAgICAgICAgICAhXy5oYXModmFsdWUsIFwiZGlzcGxheVZhbHVlXCIpXG4gICAgICAgICkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAgIFwiVGhlIHZhbHVlIG11c3QgYmUgYW4gb2JqZWN0IHdpdGggdmFsdWUgYW5kIGRpc3BsYXlWYWx1ZSBwcm9wZXJ0aWVzIChhdHRyaWQgaWQgOlwiICtcbiAgICAgICAgICAgICAgdGhpcy5vcHRpb25zLmlkICtcbiAgICAgICAgICAgICAgXCIpXCJcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9LFxuICAgIC8qKlxuICAgICAqIENoZWNrIGlmIHRoZSBhdHRyaWJ1dGUgaXMgbXVsdGlwbGVcbiAgICAgKlxuICAgICAqIEByZXR1cm5zIGJvb2xlYW5cbiAgICAgKiBAcHVibGljXG4gICAgICovXG4gICAgX2lzTXVsdGlwbGU6IGZ1bmN0aW9uIF9pc011bHRpcGxlKCkge1xuICAgICAgcmV0dXJuIHRoaXMub3B0aW9ucy5vcHRpb25zICYmIHRoaXMub3B0aW9ucy5vcHRpb25zLm11bHRpcGxlID09PSBcInllc1wiO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBDaGVjayBpZiB0aGUgd2lkZ2V0IGhhcyBidXR0b25zXG4gICAgICpcbiAgICAgKiBVc2VkIGJ5IHRlbXBsYXRlIGZvciByZW5kZXJpbmcgb3B0aW9uc1xuICAgICAqXG4gICAgICogQHJldHVybnMgYm9vbGVhblxuICAgICAqL1xuICAgIF9oYXNCdXR0b25zOiBmdW5jdGlvbiB3QXR0cmlidXRlSGFzQnV0dG9ucygpIHtcbiAgICAgIGlmICh0aGlzLmdldE1vZGUoKSA9PT0gXCJ3cml0ZVwiKSB7XG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgdGhpcy5vcHRpb25zLmhhc0F1dG9jb21wbGV0ZSB8fFxuICAgICAgICAgIHRoaXMub3B0aW9ucy5kZWxldGVCdXR0b24gfHxcbiAgICAgICAgICAodGhpcy5vcHRpb25zLnJlbmRlck9wdGlvbnMgJiZcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucy5yZW5kZXJPcHRpb25zLmJ1dHRvbnMgJiZcbiAgICAgICAgICAgIHRydWUpXG4gICAgICAgICk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgIHRoaXMub3B0aW9ucy5yZW5kZXJPcHRpb25zICYmXG4gICAgICAgICAgdGhpcy5vcHRpb25zLnJlbmRlck9wdGlvbnMuYnV0dG9ucyAmJlxuICAgICAgICAgIHRydWVcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIC8qKlxuICAgICAqIFRyaWdnZXIgYSByZWFkeSBldmVudCB3aGVuIHdpZGdldCBpcyByZW5kZXJcbiAgICAgKi9cbiAgICBfdHJpZ2dlclJlYWR5OiBmdW5jdGlvbiB3QXR0cmlidXRlUmVhZHkoKSB7XG4gICAgICB0aGlzLl90cmlnZ2VyKFwid2lkZ2V0UmVhZHlcIik7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIFRyaWdnZXIgYW4gZXZlbnQgdGhhdCBzaG91bGQgZGlzYWJsZSBzYXZlIG1lbnUgb24gZG9jdW1lbnRcbiAgICAgKlxuICAgICAqIEBwYXJhbSB2aXNpYmlsaXR5XG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfc2V0VmlzaWJpbGl0eVNhdmluZ01lbnU6IGZ1bmN0aW9uIHdBdHRyaWJ1dGVfRGlzYWJsZVNhdmluZ01lbnUoXG4gICAgICB2aXNpYmlsaXR5XG4gICAgKSB7XG4gICAgICB2YXIgZXZlbnQgPSB7IHByZXZlbnQ6IGZhbHNlIH07XG4gICAgICB0aGlzLl90cmlnZ2VyKFwiY2hhbmdlYXR0cm1lbnV2aXNpYmlsaXR5XCIsIGV2ZW50LCB7XG4gICAgICAgIGlkOiBcInNhdmVcIixcbiAgICAgICAgb25seUlmVmlzaWJsZTogdHJ1ZSxcbiAgICAgICAgdmlzaWJpbGl0eTogdmlzaWJpbGl0eVxuICAgICAgfSk7XG4gICAgICB0aGlzLl90cmlnZ2VyKFwiY2hhbmdlYXR0cm1lbnV2aXNpYmlsaXR5XCIsIGV2ZW50LCB7XG4gICAgICAgIGlkOiBcInNhdmVBbmRDbG9zZVwiLFxuICAgICAgICBvbmx5SWZWaXNpYmxlOiB0cnVlLFxuICAgICAgICB2aXNpYmlsaXR5OiB2aXNpYmlsaXR5XG4gICAgICB9KTtcbiAgICAgIHRoaXMuX3RyaWdnZXIoXCJjaGFuZ2VhdHRybWVudXZpc2liaWxpdHlcIiwgZXZlbnQsIHtcbiAgICAgICAgaWQ6IFwiY3JlYXRlQW5kQ2xvc2VcIixcbiAgICAgICAgb25seUlmVmlzaWJsZTogdHJ1ZSxcbiAgICAgICAgdmlzaWJpbGl0eTogdmlzaWJpbGl0eVxuICAgICAgfSk7XG4gICAgICB0aGlzLl90cmlnZ2VyKFwiY2hhbmdlYXR0cm1lbnV2aXNpYmlsaXR5XCIsIGV2ZW50LCB7XG4gICAgICAgIGlkOiBcImNyZWF0ZVwiLFxuICAgICAgICBvbmx5SWZWaXNpYmxlOiB0cnVlLFxuICAgICAgICB2aXNpYmlsaXR5OiB2aXNpYmlsaXR5XG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xufSk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQ0EsV0FHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///d1cffa31e143773735c0\n");

/***/ }),

/***/ "e10c73398bdea22dc801":
/*!**********************************************************************!*\
  !*** ./src/Apps/DOCUMENT/IHM/controllerObjects/constraintHandler.js ***!
  \**********************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/*global define*/\n!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(/*! underscore */ \"8e08e542008e4aef1f58\")], __WEBPACK_AMD_DEFINE_RESULT__ = (function require_constraintHandler(_) {\n  \"use strict\";\n\n  return function ConstraintHandler() {\n    var _messages = [];\n    this.addConstraintMessage = function addConstraintMessage(message, index) {\n      index = _.isNumber(index) ? index : -1;\n      _messages.push({ message: message, index: index });\n    };\n    this.getConstraintMessages = function getConstraintMessages() {\n      return _messages.slice(0);\n    };\n    this.hasConstraintMessages = function hasConstraintMessages() {\n      return _messages.length > 0;\n    };\n    this.deleteConstaintMessages = function deleteConstaintMessages() {\n      _messages = [];\n    };\n  };\n}).apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZTEwYzczMzk4YmRlYTIyZGM4MDEuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvQXBwcy9ET0NVTUVOVC9JSE0vY29udHJvbGxlck9iamVjdHMvY29uc3RyYWludEhhbmRsZXIuanM/YTM5ZiJdLCJzb3VyY2VzQ29udGVudCI6WyIvKmdsb2JhbCBkZWZpbmUqL1xuZGVmaW5lKFtcInVuZGVyc2NvcmVcIl0sIGZ1bmN0aW9uIHJlcXVpcmVfY29uc3RyYWludEhhbmRsZXIoXykge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICByZXR1cm4gZnVuY3Rpb24gQ29uc3RyYWludEhhbmRsZXIoKSB7XG4gICAgdmFyIF9tZXNzYWdlcyA9IFtdO1xuICAgIHRoaXMuYWRkQ29uc3RyYWludE1lc3NhZ2UgPSBmdW5jdGlvbiBhZGRDb25zdHJhaW50TWVzc2FnZShtZXNzYWdlLCBpbmRleCkge1xuICAgICAgaW5kZXggPSBfLmlzTnVtYmVyKGluZGV4KSA/IGluZGV4IDogLTE7XG4gICAgICBfbWVzc2FnZXMucHVzaCh7IG1lc3NhZ2U6IG1lc3NhZ2UsIGluZGV4OiBpbmRleCB9KTtcbiAgICB9O1xuICAgIHRoaXMuZ2V0Q29uc3RyYWludE1lc3NhZ2VzID0gZnVuY3Rpb24gZ2V0Q29uc3RyYWludE1lc3NhZ2VzKCkge1xuICAgICAgcmV0dXJuIF9tZXNzYWdlcy5zbGljZSgwKTtcbiAgICB9O1xuICAgIHRoaXMuaGFzQ29uc3RyYWludE1lc3NhZ2VzID0gZnVuY3Rpb24gaGFzQ29uc3RyYWludE1lc3NhZ2VzKCkge1xuICAgICAgcmV0dXJuIF9tZXNzYWdlcy5sZW5ndGggPiAwO1xuICAgIH07XG4gICAgdGhpcy5kZWxldGVDb25zdGFpbnRNZXNzYWdlcyA9IGZ1bmN0aW9uIGRlbGV0ZUNvbnN0YWludE1lc3NhZ2VzKCkge1xuICAgICAgX21lc3NhZ2VzID0gW107XG4gICAgfTtcbiAgfTtcbn0pO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///e10c73398bdea22dc801\n");

/***/ }),

/***/ "e3b629bb5804c565e69e":
/*!******************************************************!*\
  !*** ./src/Apps/DOCUMENT/IHM/models/mDocumentTab.js ***!
  \******************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(/*! underscore */ \"8e08e542008e4aef1f58\"), __webpack_require__(/*! backbone */ \"1858b45bf48591489d06\")], __WEBPACK_AMD_DEFINE_RESULT__ = (function(_, Backbone) {\n  \"use strict\";\n\n  var url = _.template(\"api/v2/documents/<%- initid %>/usertags/lasttab\");\n\n  return Backbone.Model.extend({\n    typeModel: \"ddui:attributeTab\",\n    idAttribute: \"initid\",\n\n    url: function mDocumentTag_url() {\n      return url({ initid: this.get(\"initid\") });\n    },\n\n    toJSON: function mDocumentTag_toJSON() {\n      return this.get(\"tabId\");\n    }\n  });\n}).apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZTNiNjI5YmI1ODA0YzU2NWU2OWUuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvQXBwcy9ET0NVTUVOVC9JSE0vbW9kZWxzL21Eb2N1bWVudFRhYi5qcz9iNTBmIl0sInNvdXJjZXNDb250ZW50IjpbImRlZmluZShbXCJ1bmRlcnNjb3JlXCIsIFwiYmFja2JvbmVcIl0sIGZ1bmN0aW9uKF8sIEJhY2tib25lKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIHZhciB1cmwgPSBfLnRlbXBsYXRlKFwiYXBpL3YyL2RvY3VtZW50cy88JS0gaW5pdGlkICU+L3VzZXJ0YWdzL2xhc3R0YWJcIik7XG5cbiAgcmV0dXJuIEJhY2tib25lLk1vZGVsLmV4dGVuZCh7XG4gICAgdHlwZU1vZGVsOiBcImRkdWk6YXR0cmlidXRlVGFiXCIsXG4gICAgaWRBdHRyaWJ1dGU6IFwiaW5pdGlkXCIsXG5cbiAgICB1cmw6IGZ1bmN0aW9uIG1Eb2N1bWVudFRhZ191cmwoKSB7XG4gICAgICByZXR1cm4gdXJsKHsgaW5pdGlkOiB0aGlzLmdldChcImluaXRpZFwiKSB9KTtcbiAgICB9LFxuXG4gICAgdG9KU09OOiBmdW5jdGlvbiBtRG9jdW1lbnRUYWdfdG9KU09OKCkge1xuICAgICAgcmV0dXJuIHRoaXMuZ2V0KFwidGFiSWRcIik7XG4gICAgfVxuICB9KTtcbn0pO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///e3b629bb5804c565e69e\n");

/***/ }),

/***/ "e6944ecc13b0862a73e7":
/*!*****************************************************************!*\
  !*** ./src/Apps/DOCUMENT/IHM/widgets/properties/wProperties.js ***!
  \*****************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;!(__WEBPACK_AMD_DEFINE_ARRAY__ = [\n  __webpack_require__(/*! jquery */ \"127c8cf59f228bb01a21\"),\n  __webpack_require__(/*! underscore */ \"8e08e542008e4aef1f58\"),\n  __webpack_require__(/*! mustache */ \"bcd31d01884fc294fd69\"),\n  __webpack_require__(/*! dcpDocument/widgets/widget */ \"f562ab9f022eef93542c\"),\n  __webpack_require__(/*! dcpDocument/widgets/window/wDialog */ \"0bd0aa4c1909a49f67bb\")\n], __WEBPACK_AMD_DEFINE_RESULT__ = (function require_wProperties($, _, Mustache) {\n  \"use strict\";\n\n  $.widget(\"dcp.dcpDocumentProperties\", $.dcp.dcpDialog, {\n    options: {\n      documentId: 0,\n      window: {\n        modal: true,\n        title: \"Document properties\"\n      },\n      labels: {\n        identifier: \"Identifier\",\n        title: \"Title\",\n        logicalName: \"Logical name\",\n        revision: \"Revision number\",\n        version: \"Version\",\n        family: \"Family\",\n        lockedBy: \"Locked by\",\n        createdBy: \"Created by\",\n        notLocked: \"Not locked\",\n        confidential: \"Confidential\",\n        notConfidential: \"Not confidential\",\n        creationDate: \"Creation date\",\n        lastModificationDate: \"Last modification date\",\n        profil: \"Profil\",\n        profilReference: \"Profil reference\",\n        fieldAccess: \"Field access\",\n        viewController: \"View controller\",\n        propertiesTitle: \"Properties of {{title}}\",\n        property: \"Property\",\n        propertyValue: \"Value\",\n        workflow: \"Workflow\",\n        activity: \"Activity\"\n      }\n    },\n    documentProperties: null,\n    htmlCaneva: function wProperties_htmlCaneva() {\n      return (\n        '<table class=\"properties-main table table-condensed table-hover\"><thead>' +\n        '<tr class=\"properties-header\">' +\n        '<th class=\"properties-header--description\">{{labels.property}}</th>' +\n        '<th class=\"properties-header--value\">{{labels.propertyValue}}</th>' +\n        \"</tr></thead>\" +\n        \"<tbody>\" +\n        '<tr><td class=\"properties-description\">{{labels.title}}</td><td class=\"properties-value\">{{title}}</td></tr>' +\n        '<tr><td class=\"properties-description\">{{labels.identifier}}</td><td class=\"properties-value\">{{initid}}</td></tr>' +\n        '<tr><td class=\"properties-description\">{{labels.logicalName}}</td><td class=\"properties-value\">{{name}}</td></tr>' +\n        '<tr><td class=\"properties-description\">{{labels.revision}}</td><td class=\"properties-value\">{{revision}}</td></tr>' +\n        '<tr><td class=\"properties-description\">{{labels.version}}</td><td class=\"properties-value\">{{version}}</td></tr>' +\n        '<tr><td class=\"properties-separator\" colspan=\"2\"></td></tr>' +\n        '<tr><td class=\"properties-description\">{{labels.workflow}}</td><td class=\"properties-value\"><a  data-document-id=\"{{workflow.id}}\" href=\"api/v2/documents/{{workflow.id}}.html\">{{#workflow.icon}}<img src=\"{{workflow.icon}}\"/>{{/workflow.icon}}{{workflow.title}}</a></td></tr>' +\n        '<tr><td class=\"properties-description\">{{labels.activity}}</td><td class=\"properties-value\">{{#state.reference}}<div class=\"properties-value-statecolor\" style=\"background-color:{{state.color}}\"/>{{state.displayValue}}{{/state.reference}}</td></tr>' +\n        '<tr><td class=\"properties-description\">{{labels.family}}</td><td class=\"properties-value\"><a data-document-id=\"{{family.id}}\" href=\"api/v2/documents/{{family.id}}.html\"><img src=\"{{family.icon}}\"/>{{family.title}}</a><br/><div class=\"properties-value--famname\">{{family.name}}</div></td></tr>' +\n        '<tr><td class=\"properties-separator\" colspan=\"2\"></td></tr>' +\n        '<tr><td class=\"properties-description\">{{labels.createdBy}}</td><td class=\"properties-value\"><a data-document-id=\"{{createdBy.id}}\" href=\"api/v2/documents/{{createdBy.id}}.html\"><img src=\"{{createdBy.icon}}\"/>{{createdBy.title}}</a></td></tr>' +\n        '<tr><td class=\"properties-description\">{{labels.lockedBy}}</td><td class=\"properties-value\">' +\n        \"{{#security.lock.lockedBy.id}}\" +\n        '<a data-document-id=\"{{security.lock.lockedBy.id}}\" href=\"api/v2/documents/{{security.lock.lockedBy.id}}.html\"><img src=\"{{security.lock.lockedBy.icon}}\"/>{{security.lock.lockedBy.title}}</a>' +\n        \"{{/security.lock.lockedBy.id}}\" +\n        \"{{^security.lock.lockedBy.id}}{{labels.notLocked}}{{/security.lock.lockedBy.id}}\" +\n        \"</td></tr>\" +\n        '<tr><td class=\"properties-description\">{{labels.confidential}}</td><td class=\"properties-value\">' +\n        \"{{#confidential}}\" +\n        \"{{labels.confidential}}\" +\n        \"{{/confidential}}\" +\n        \"{{^confidential}}{{labels.notConfidential}}{{/confidential}}\" +\n        \"</td></tr>\" +\n        '<tr><td class=\"properties-separator\" colspan=\"2\"></td></tr>' +\n        '<tr><td class=\"properties-description\">{{labels.creationDate}}</td><td class=\"properties-value\">{{#formatDate}}{{creationDate}}{{/formatDate}}</td></tr>' +\n        '<tr><td class=\"properties-description\">{{labels.lastModificationDate}}</td><td class=\"properties-value\">{{#formatDate}}{{lastModificationDate}}{{/formatDate}}</td></tr>' +\n        '<tr><td class=\"properties-separator\" colspan=\"2\"></td></tr>' +\n        '<tr><td class=\"properties-description\">{{labels.profil}}</td><td class=\"properties-value\"><a data-document-id=\"{{security.profil.id}}\" href=\"api/v2/documents/{{security.profil.id}}.html\">{{#security.profil.icon}}<img src=\"{{security.profil.icon}}\"/>{{/security.profil.icon}}{{security.profil.title}}</a></td></tr>' +\n        '<tr><td class=\"properties-description\">{{labels.profilReference}}</td><td class=\"properties-value\"><a data-document-id=\"{{security.profil.reference.id}}\" href=\"api/v2/documents/{{security.profil.reference.id}}.html\">{{#security.profil.reference.icon}}<img src=\"{{security.profil.reference.icon}}\"/>{{/security.profil.reference.icon}}{{security.profil.reference.title}}</a></td></tr>' +\n        '<tr><td class=\"properties-description\">{{labels.fieldAccess}}</td><td class=\"properties-value\"><a data-document-id=\"{{security.fieldAccess.id}}\" href=\"api/v2/documents/{{security.fieldAccess.id}}.html\">{{#security.fieldAccess.icon}}<img src=\"{{security.fieldAccess.icon}}\"/>{{/security.fieldAccess.icon}}{{security.fieldAccess.title}}</a></td></tr>' +\n        '<tr><td class=\"properties-description\">{{labels.viewController}}</td><td class=\"properties-value\"><a data-document-id=\"{{viewController.id}}\" href=\"api/v2/documents/{{viewController.id}}.html\">{{#viewController.icon}}<img src=\"{{viewController.icon}}\"/>{{/viewController.icon}}{{viewController.title}}</a></td></tr>' +\n        \"</tbody></table>\"\n      );\n    },\n\n    _create: function wProperties__create() {\n      var scope = this;\n\n      this._displayProperties();\n\n      this._super();\n\n      this.element.data(\"dcpDocumentProperties\", this);\n      this.element.on(\n        \"click\" + this.eventNamespace,\n        \"a[data-document-id]\",\n        function wProperties_bindClick(event) {\n          var docid = $(this).data(\"document-id\");\n          if (docid) {\n            event.preventDefault();\n            scope.element.trigger(\"viewDocument\", docid);\n          }\n        }\n      );\n    },\n\n    _displayProperties: function wPropertiesGetProperties() {\n      var scope = this;\n      $.getJSON(\n        \"api/v2/documents/\" +\n          this.options.documentId +\n          \".json?fields=document.properties.all&useTrash=true\"\n      )\n        .done(function wProperties_done(data) {\n          var info;\n          scope.documentProperties = data.data.document.properties;\n          info = _.extend(scope.documentProperties, {\n            labels: scope.options.labels\n          });\n          info.formatDate = function wProperties_formatDate() {\n            return function wProperties_formatDate2(text, render) {\n              return kendo.toString(\n                new Date(render(text).replace(\" \", \"T\")),\n                \"G\"\n              );\n            };\n          };\n          scope.element.html(Mustache.render(scope.htmlCaneva() || \"\", info));\n          //scope.dialogWindow.center();\n\n          scope.dialogWindow.setOptions({\n            title: Mustache.render(\n              scope.options.labels.propertiesTitle,\n              data.data.document.properties\n            )\n          });\n        })\n        .fail(function wProperties_fail(xhr) {\n          var result = JSON.parse(xhr.responseText);\n          window.alert(result.exceptionMessage);\n        });\n    }\n  });\n}).apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZTY5NDRlY2MxM2IwODYyYTczZTcuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvQXBwcy9ET0NVTUVOVC9JSE0vd2lkZ2V0cy9wcm9wZXJ0aWVzL3dQcm9wZXJ0aWVzLmpzPzU0NWYiXSwic291cmNlc0NvbnRlbnQiOlsiZGVmaW5lKFtcbiAgXCJqcXVlcnlcIixcbiAgXCJ1bmRlcnNjb3JlXCIsXG4gIFwibXVzdGFjaGVcIixcbiAgXCJkY3BEb2N1bWVudC93aWRnZXRzL3dpZGdldFwiLFxuICBcImRjcERvY3VtZW50L3dpZGdldHMvd2luZG93L3dEaWFsb2dcIlxuXSwgZnVuY3Rpb24gcmVxdWlyZV93UHJvcGVydGllcygkLCBfLCBNdXN0YWNoZSkge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICAkLndpZGdldChcImRjcC5kY3BEb2N1bWVudFByb3BlcnRpZXNcIiwgJC5kY3AuZGNwRGlhbG9nLCB7XG4gICAgb3B0aW9uczoge1xuICAgICAgZG9jdW1lbnRJZDogMCxcbiAgICAgIHdpbmRvdzoge1xuICAgICAgICBtb2RhbDogdHJ1ZSxcbiAgICAgICAgdGl0bGU6IFwiRG9jdW1lbnQgcHJvcGVydGllc1wiXG4gICAgICB9LFxuICAgICAgbGFiZWxzOiB7XG4gICAgICAgIGlkZW50aWZpZXI6IFwiSWRlbnRpZmllclwiLFxuICAgICAgICB0aXRsZTogXCJUaXRsZVwiLFxuICAgICAgICBsb2dpY2FsTmFtZTogXCJMb2dpY2FsIG5hbWVcIixcbiAgICAgICAgcmV2aXNpb246IFwiUmV2aXNpb24gbnVtYmVyXCIsXG4gICAgICAgIHZlcnNpb246IFwiVmVyc2lvblwiLFxuICAgICAgICBmYW1pbHk6IFwiRmFtaWx5XCIsXG4gICAgICAgIGxvY2tlZEJ5OiBcIkxvY2tlZCBieVwiLFxuICAgICAgICBjcmVhdGVkQnk6IFwiQ3JlYXRlZCBieVwiLFxuICAgICAgICBub3RMb2NrZWQ6IFwiTm90IGxvY2tlZFwiLFxuICAgICAgICBjb25maWRlbnRpYWw6IFwiQ29uZmlkZW50aWFsXCIsXG4gICAgICAgIG5vdENvbmZpZGVudGlhbDogXCJOb3QgY29uZmlkZW50aWFsXCIsXG4gICAgICAgIGNyZWF0aW9uRGF0ZTogXCJDcmVhdGlvbiBkYXRlXCIsXG4gICAgICAgIGxhc3RNb2RpZmljYXRpb25EYXRlOiBcIkxhc3QgbW9kaWZpY2F0aW9uIGRhdGVcIixcbiAgICAgICAgcHJvZmlsOiBcIlByb2ZpbFwiLFxuICAgICAgICBwcm9maWxSZWZlcmVuY2U6IFwiUHJvZmlsIHJlZmVyZW5jZVwiLFxuICAgICAgICBmaWVsZEFjY2VzczogXCJGaWVsZCBhY2Nlc3NcIixcbiAgICAgICAgdmlld0NvbnRyb2xsZXI6IFwiVmlldyBjb250cm9sbGVyXCIsXG4gICAgICAgIHByb3BlcnRpZXNUaXRsZTogXCJQcm9wZXJ0aWVzIG9mIHt7dGl0bGV9fVwiLFxuICAgICAgICBwcm9wZXJ0eTogXCJQcm9wZXJ0eVwiLFxuICAgICAgICBwcm9wZXJ0eVZhbHVlOiBcIlZhbHVlXCIsXG4gICAgICAgIHdvcmtmbG93OiBcIldvcmtmbG93XCIsXG4gICAgICAgIGFjdGl2aXR5OiBcIkFjdGl2aXR5XCJcbiAgICAgIH1cbiAgICB9LFxuICAgIGRvY3VtZW50UHJvcGVydGllczogbnVsbCxcbiAgICBodG1sQ2FuZXZhOiBmdW5jdGlvbiB3UHJvcGVydGllc19odG1sQ2FuZXZhKCkge1xuICAgICAgcmV0dXJuIChcbiAgICAgICAgJzx0YWJsZSBjbGFzcz1cInByb3BlcnRpZXMtbWFpbiB0YWJsZSB0YWJsZS1jb25kZW5zZWQgdGFibGUtaG92ZXJcIj48dGhlYWQ+JyArXG4gICAgICAgICc8dHIgY2xhc3M9XCJwcm9wZXJ0aWVzLWhlYWRlclwiPicgK1xuICAgICAgICAnPHRoIGNsYXNzPVwicHJvcGVydGllcy1oZWFkZXItLWRlc2NyaXB0aW9uXCI+e3tsYWJlbHMucHJvcGVydHl9fTwvdGg+JyArXG4gICAgICAgICc8dGggY2xhc3M9XCJwcm9wZXJ0aWVzLWhlYWRlci0tdmFsdWVcIj57e2xhYmVscy5wcm9wZXJ0eVZhbHVlfX08L3RoPicgK1xuICAgICAgICBcIjwvdHI+PC90aGVhZD5cIiArXG4gICAgICAgIFwiPHRib2R5PlwiICtcbiAgICAgICAgJzx0cj48dGQgY2xhc3M9XCJwcm9wZXJ0aWVzLWRlc2NyaXB0aW9uXCI+e3tsYWJlbHMudGl0bGV9fTwvdGQ+PHRkIGNsYXNzPVwicHJvcGVydGllcy12YWx1ZVwiPnt7dGl0bGV9fTwvdGQ+PC90cj4nICtcbiAgICAgICAgJzx0cj48dGQgY2xhc3M9XCJwcm9wZXJ0aWVzLWRlc2NyaXB0aW9uXCI+e3tsYWJlbHMuaWRlbnRpZmllcn19PC90ZD48dGQgY2xhc3M9XCJwcm9wZXJ0aWVzLXZhbHVlXCI+e3tpbml0aWR9fTwvdGQ+PC90cj4nICtcbiAgICAgICAgJzx0cj48dGQgY2xhc3M9XCJwcm9wZXJ0aWVzLWRlc2NyaXB0aW9uXCI+e3tsYWJlbHMubG9naWNhbE5hbWV9fTwvdGQ+PHRkIGNsYXNzPVwicHJvcGVydGllcy12YWx1ZVwiPnt7bmFtZX19PC90ZD48L3RyPicgK1xuICAgICAgICAnPHRyPjx0ZCBjbGFzcz1cInByb3BlcnRpZXMtZGVzY3JpcHRpb25cIj57e2xhYmVscy5yZXZpc2lvbn19PC90ZD48dGQgY2xhc3M9XCJwcm9wZXJ0aWVzLXZhbHVlXCI+e3tyZXZpc2lvbn19PC90ZD48L3RyPicgK1xuICAgICAgICAnPHRyPjx0ZCBjbGFzcz1cInByb3BlcnRpZXMtZGVzY3JpcHRpb25cIj57e2xhYmVscy52ZXJzaW9ufX08L3RkPjx0ZCBjbGFzcz1cInByb3BlcnRpZXMtdmFsdWVcIj57e3ZlcnNpb259fTwvdGQ+PC90cj4nICtcbiAgICAgICAgJzx0cj48dGQgY2xhc3M9XCJwcm9wZXJ0aWVzLXNlcGFyYXRvclwiIGNvbHNwYW49XCIyXCI+PC90ZD48L3RyPicgK1xuICAgICAgICAnPHRyPjx0ZCBjbGFzcz1cInByb3BlcnRpZXMtZGVzY3JpcHRpb25cIj57e2xhYmVscy53b3JrZmxvd319PC90ZD48dGQgY2xhc3M9XCJwcm9wZXJ0aWVzLXZhbHVlXCI+PGEgIGRhdGEtZG9jdW1lbnQtaWQ9XCJ7e3dvcmtmbG93LmlkfX1cIiBocmVmPVwiYXBpL3YyL2RvY3VtZW50cy97e3dvcmtmbG93LmlkfX0uaHRtbFwiPnt7I3dvcmtmbG93Lmljb259fTxpbWcgc3JjPVwie3t3b3JrZmxvdy5pY29ufX1cIi8+e3svd29ya2Zsb3cuaWNvbn19e3t3b3JrZmxvdy50aXRsZX19PC9hPjwvdGQ+PC90cj4nICtcbiAgICAgICAgJzx0cj48dGQgY2xhc3M9XCJwcm9wZXJ0aWVzLWRlc2NyaXB0aW9uXCI+e3tsYWJlbHMuYWN0aXZpdHl9fTwvdGQ+PHRkIGNsYXNzPVwicHJvcGVydGllcy12YWx1ZVwiPnt7I3N0YXRlLnJlZmVyZW5jZX19PGRpdiBjbGFzcz1cInByb3BlcnRpZXMtdmFsdWUtc3RhdGVjb2xvclwiIHN0eWxlPVwiYmFja2dyb3VuZC1jb2xvcjp7e3N0YXRlLmNvbG9yfX1cIi8+e3tzdGF0ZS5kaXNwbGF5VmFsdWV9fXt7L3N0YXRlLnJlZmVyZW5jZX19PC90ZD48L3RyPicgK1xuICAgICAgICAnPHRyPjx0ZCBjbGFzcz1cInByb3BlcnRpZXMtZGVzY3JpcHRpb25cIj57e2xhYmVscy5mYW1pbHl9fTwvdGQ+PHRkIGNsYXNzPVwicHJvcGVydGllcy12YWx1ZVwiPjxhIGRhdGEtZG9jdW1lbnQtaWQ9XCJ7e2ZhbWlseS5pZH19XCIgaHJlZj1cImFwaS92Mi9kb2N1bWVudHMve3tmYW1pbHkuaWR9fS5odG1sXCI+PGltZyBzcmM9XCJ7e2ZhbWlseS5pY29ufX1cIi8+e3tmYW1pbHkudGl0bGV9fTwvYT48YnIvPjxkaXYgY2xhc3M9XCJwcm9wZXJ0aWVzLXZhbHVlLS1mYW1uYW1lXCI+e3tmYW1pbHkubmFtZX19PC9kaXY+PC90ZD48L3RyPicgK1xuICAgICAgICAnPHRyPjx0ZCBjbGFzcz1cInByb3BlcnRpZXMtc2VwYXJhdG9yXCIgY29sc3Bhbj1cIjJcIj48L3RkPjwvdHI+JyArXG4gICAgICAgICc8dHI+PHRkIGNsYXNzPVwicHJvcGVydGllcy1kZXNjcmlwdGlvblwiPnt7bGFiZWxzLmNyZWF0ZWRCeX19PC90ZD48dGQgY2xhc3M9XCJwcm9wZXJ0aWVzLXZhbHVlXCI+PGEgZGF0YS1kb2N1bWVudC1pZD1cInt7Y3JlYXRlZEJ5LmlkfX1cIiBocmVmPVwiYXBpL3YyL2RvY3VtZW50cy97e2NyZWF0ZWRCeS5pZH19Lmh0bWxcIj48aW1nIHNyYz1cInt7Y3JlYXRlZEJ5Lmljb259fVwiLz57e2NyZWF0ZWRCeS50aXRsZX19PC9hPjwvdGQ+PC90cj4nICtcbiAgICAgICAgJzx0cj48dGQgY2xhc3M9XCJwcm9wZXJ0aWVzLWRlc2NyaXB0aW9uXCI+e3tsYWJlbHMubG9ja2VkQnl9fTwvdGQ+PHRkIGNsYXNzPVwicHJvcGVydGllcy12YWx1ZVwiPicgK1xuICAgICAgICBcInt7I3NlY3VyaXR5LmxvY2subG9ja2VkQnkuaWR9fVwiICtcbiAgICAgICAgJzxhIGRhdGEtZG9jdW1lbnQtaWQ9XCJ7e3NlY3VyaXR5LmxvY2subG9ja2VkQnkuaWR9fVwiIGhyZWY9XCJhcGkvdjIvZG9jdW1lbnRzL3t7c2VjdXJpdHkubG9jay5sb2NrZWRCeS5pZH19Lmh0bWxcIj48aW1nIHNyYz1cInt7c2VjdXJpdHkubG9jay5sb2NrZWRCeS5pY29ufX1cIi8+e3tzZWN1cml0eS5sb2NrLmxvY2tlZEJ5LnRpdGxlfX08L2E+JyArXG4gICAgICAgIFwie3svc2VjdXJpdHkubG9jay5sb2NrZWRCeS5pZH19XCIgK1xuICAgICAgICBcInt7XnNlY3VyaXR5LmxvY2subG9ja2VkQnkuaWR9fXt7bGFiZWxzLm5vdExvY2tlZH19e3svc2VjdXJpdHkubG9jay5sb2NrZWRCeS5pZH19XCIgK1xuICAgICAgICBcIjwvdGQ+PC90cj5cIiArXG4gICAgICAgICc8dHI+PHRkIGNsYXNzPVwicHJvcGVydGllcy1kZXNjcmlwdGlvblwiPnt7bGFiZWxzLmNvbmZpZGVudGlhbH19PC90ZD48dGQgY2xhc3M9XCJwcm9wZXJ0aWVzLXZhbHVlXCI+JyArXG4gICAgICAgIFwie3sjY29uZmlkZW50aWFsfX1cIiArXG4gICAgICAgIFwie3tsYWJlbHMuY29uZmlkZW50aWFsfX1cIiArXG4gICAgICAgIFwie3svY29uZmlkZW50aWFsfX1cIiArXG4gICAgICAgIFwie3teY29uZmlkZW50aWFsfX17e2xhYmVscy5ub3RDb25maWRlbnRpYWx9fXt7L2NvbmZpZGVudGlhbH19XCIgK1xuICAgICAgICBcIjwvdGQ+PC90cj5cIiArXG4gICAgICAgICc8dHI+PHRkIGNsYXNzPVwicHJvcGVydGllcy1zZXBhcmF0b3JcIiBjb2xzcGFuPVwiMlwiPjwvdGQ+PC90cj4nICtcbiAgICAgICAgJzx0cj48dGQgY2xhc3M9XCJwcm9wZXJ0aWVzLWRlc2NyaXB0aW9uXCI+e3tsYWJlbHMuY3JlYXRpb25EYXRlfX08L3RkPjx0ZCBjbGFzcz1cInByb3BlcnRpZXMtdmFsdWVcIj57eyNmb3JtYXREYXRlfX17e2NyZWF0aW9uRGF0ZX19e3svZm9ybWF0RGF0ZX19PC90ZD48L3RyPicgK1xuICAgICAgICAnPHRyPjx0ZCBjbGFzcz1cInByb3BlcnRpZXMtZGVzY3JpcHRpb25cIj57e2xhYmVscy5sYXN0TW9kaWZpY2F0aW9uRGF0ZX19PC90ZD48dGQgY2xhc3M9XCJwcm9wZXJ0aWVzLXZhbHVlXCI+e3sjZm9ybWF0RGF0ZX19e3tsYXN0TW9kaWZpY2F0aW9uRGF0ZX19e3svZm9ybWF0RGF0ZX19PC90ZD48L3RyPicgK1xuICAgICAgICAnPHRyPjx0ZCBjbGFzcz1cInByb3BlcnRpZXMtc2VwYXJhdG9yXCIgY29sc3Bhbj1cIjJcIj48L3RkPjwvdHI+JyArXG4gICAgICAgICc8dHI+PHRkIGNsYXNzPVwicHJvcGVydGllcy1kZXNjcmlwdGlvblwiPnt7bGFiZWxzLnByb2ZpbH19PC90ZD48dGQgY2xhc3M9XCJwcm9wZXJ0aWVzLXZhbHVlXCI+PGEgZGF0YS1kb2N1bWVudC1pZD1cInt7c2VjdXJpdHkucHJvZmlsLmlkfX1cIiBocmVmPVwiYXBpL3YyL2RvY3VtZW50cy97e3NlY3VyaXR5LnByb2ZpbC5pZH19Lmh0bWxcIj57eyNzZWN1cml0eS5wcm9maWwuaWNvbn19PGltZyBzcmM9XCJ7e3NlY3VyaXR5LnByb2ZpbC5pY29ufX1cIi8+e3svc2VjdXJpdHkucHJvZmlsLmljb259fXt7c2VjdXJpdHkucHJvZmlsLnRpdGxlfX08L2E+PC90ZD48L3RyPicgK1xuICAgICAgICAnPHRyPjx0ZCBjbGFzcz1cInByb3BlcnRpZXMtZGVzY3JpcHRpb25cIj57e2xhYmVscy5wcm9maWxSZWZlcmVuY2V9fTwvdGQ+PHRkIGNsYXNzPVwicHJvcGVydGllcy12YWx1ZVwiPjxhIGRhdGEtZG9jdW1lbnQtaWQ9XCJ7e3NlY3VyaXR5LnByb2ZpbC5yZWZlcmVuY2UuaWR9fVwiIGhyZWY9XCJhcGkvdjIvZG9jdW1lbnRzL3t7c2VjdXJpdHkucHJvZmlsLnJlZmVyZW5jZS5pZH19Lmh0bWxcIj57eyNzZWN1cml0eS5wcm9maWwucmVmZXJlbmNlLmljb259fTxpbWcgc3JjPVwie3tzZWN1cml0eS5wcm9maWwucmVmZXJlbmNlLmljb259fVwiLz57ey9zZWN1cml0eS5wcm9maWwucmVmZXJlbmNlLmljb259fXt7c2VjdXJpdHkucHJvZmlsLnJlZmVyZW5jZS50aXRsZX19PC9hPjwvdGQ+PC90cj4nICtcbiAgICAgICAgJzx0cj48dGQgY2xhc3M9XCJwcm9wZXJ0aWVzLWRlc2NyaXB0aW9uXCI+e3tsYWJlbHMuZmllbGRBY2Nlc3N9fTwvdGQ+PHRkIGNsYXNzPVwicHJvcGVydGllcy12YWx1ZVwiPjxhIGRhdGEtZG9jdW1lbnQtaWQ9XCJ7e3NlY3VyaXR5LmZpZWxkQWNjZXNzLmlkfX1cIiBocmVmPVwiYXBpL3YyL2RvY3VtZW50cy97e3NlY3VyaXR5LmZpZWxkQWNjZXNzLmlkfX0uaHRtbFwiPnt7I3NlY3VyaXR5LmZpZWxkQWNjZXNzLmljb259fTxpbWcgc3JjPVwie3tzZWN1cml0eS5maWVsZEFjY2Vzcy5pY29ufX1cIi8+e3svc2VjdXJpdHkuZmllbGRBY2Nlc3MuaWNvbn19e3tzZWN1cml0eS5maWVsZEFjY2Vzcy50aXRsZX19PC9hPjwvdGQ+PC90cj4nICtcbiAgICAgICAgJzx0cj48dGQgY2xhc3M9XCJwcm9wZXJ0aWVzLWRlc2NyaXB0aW9uXCI+e3tsYWJlbHMudmlld0NvbnRyb2xsZXJ9fTwvdGQ+PHRkIGNsYXNzPVwicHJvcGVydGllcy12YWx1ZVwiPjxhIGRhdGEtZG9jdW1lbnQtaWQ9XCJ7e3ZpZXdDb250cm9sbGVyLmlkfX1cIiBocmVmPVwiYXBpL3YyL2RvY3VtZW50cy97e3ZpZXdDb250cm9sbGVyLmlkfX0uaHRtbFwiPnt7I3ZpZXdDb250cm9sbGVyLmljb259fTxpbWcgc3JjPVwie3t2aWV3Q29udHJvbGxlci5pY29ufX1cIi8+e3svdmlld0NvbnRyb2xsZXIuaWNvbn19e3t2aWV3Q29udHJvbGxlci50aXRsZX19PC9hPjwvdGQ+PC90cj4nICtcbiAgICAgICAgXCI8L3Rib2R5PjwvdGFibGU+XCJcbiAgICAgICk7XG4gICAgfSxcblxuICAgIF9jcmVhdGU6IGZ1bmN0aW9uIHdQcm9wZXJ0aWVzX19jcmVhdGUoKSB7XG4gICAgICB2YXIgc2NvcGUgPSB0aGlzO1xuXG4gICAgICB0aGlzLl9kaXNwbGF5UHJvcGVydGllcygpO1xuXG4gICAgICB0aGlzLl9zdXBlcigpO1xuXG4gICAgICB0aGlzLmVsZW1lbnQuZGF0YShcImRjcERvY3VtZW50UHJvcGVydGllc1wiLCB0aGlzKTtcbiAgICAgIHRoaXMuZWxlbWVudC5vbihcbiAgICAgICAgXCJjbGlja1wiICsgdGhpcy5ldmVudE5hbWVzcGFjZSxcbiAgICAgICAgXCJhW2RhdGEtZG9jdW1lbnQtaWRdXCIsXG4gICAgICAgIGZ1bmN0aW9uIHdQcm9wZXJ0aWVzX2JpbmRDbGljayhldmVudCkge1xuICAgICAgICAgIHZhciBkb2NpZCA9ICQodGhpcykuZGF0YShcImRvY3VtZW50LWlkXCIpO1xuICAgICAgICAgIGlmIChkb2NpZCkge1xuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIHNjb3BlLmVsZW1lbnQudHJpZ2dlcihcInZpZXdEb2N1bWVudFwiLCBkb2NpZCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICApO1xuICAgIH0sXG5cbiAgICBfZGlzcGxheVByb3BlcnRpZXM6IGZ1bmN0aW9uIHdQcm9wZXJ0aWVzR2V0UHJvcGVydGllcygpIHtcbiAgICAgIHZhciBzY29wZSA9IHRoaXM7XG4gICAgICAkLmdldEpTT04oXG4gICAgICAgIFwiYXBpL3YyL2RvY3VtZW50cy9cIiArXG4gICAgICAgICAgdGhpcy5vcHRpb25zLmRvY3VtZW50SWQgK1xuICAgICAgICAgIFwiLmpzb24/ZmllbGRzPWRvY3VtZW50LnByb3BlcnRpZXMuYWxsJnVzZVRyYXNoPXRydWVcIlxuICAgICAgKVxuICAgICAgICAuZG9uZShmdW5jdGlvbiB3UHJvcGVydGllc19kb25lKGRhdGEpIHtcbiAgICAgICAgICB2YXIgaW5mbztcbiAgICAgICAgICBzY29wZS5kb2N1bWVudFByb3BlcnRpZXMgPSBkYXRhLmRhdGEuZG9jdW1lbnQucHJvcGVydGllcztcbiAgICAgICAgICBpbmZvID0gXy5leHRlbmQoc2NvcGUuZG9jdW1lbnRQcm9wZXJ0aWVzLCB7XG4gICAgICAgICAgICBsYWJlbHM6IHNjb3BlLm9wdGlvbnMubGFiZWxzXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgaW5mby5mb3JtYXREYXRlID0gZnVuY3Rpb24gd1Byb3BlcnRpZXNfZm9ybWF0RGF0ZSgpIHtcbiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiB3UHJvcGVydGllc19mb3JtYXREYXRlMih0ZXh0LCByZW5kZXIpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGtlbmRvLnRvU3RyaW5nKFxuICAgICAgICAgICAgICAgIG5ldyBEYXRlKHJlbmRlcih0ZXh0KS5yZXBsYWNlKFwiIFwiLCBcIlRcIikpLFxuICAgICAgICAgICAgICAgIFwiR1wiXG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH07XG4gICAgICAgICAgc2NvcGUuZWxlbWVudC5odG1sKE11c3RhY2hlLnJlbmRlcihzY29wZS5odG1sQ2FuZXZhKCkgfHwgXCJcIiwgaW5mbykpO1xuICAgICAgICAgIC8vc2NvcGUuZGlhbG9nV2luZG93LmNlbnRlcigpO1xuXG4gICAgICAgICAgc2NvcGUuZGlhbG9nV2luZG93LnNldE9wdGlvbnMoe1xuICAgICAgICAgICAgdGl0bGU6IE11c3RhY2hlLnJlbmRlcihcbiAgICAgICAgICAgICAgc2NvcGUub3B0aW9ucy5sYWJlbHMucHJvcGVydGllc1RpdGxlLFxuICAgICAgICAgICAgICBkYXRhLmRhdGEuZG9jdW1lbnQucHJvcGVydGllc1xuICAgICAgICAgICAgKVxuICAgICAgICAgIH0pO1xuICAgICAgICB9KVxuICAgICAgICAuZmFpbChmdW5jdGlvbiB3UHJvcGVydGllc19mYWlsKHhocikge1xuICAgICAgICAgIHZhciByZXN1bHQgPSBKU09OLnBhcnNlKHhoci5yZXNwb25zZVRleHQpO1xuICAgICAgICAgIHdpbmRvdy5hbGVydChyZXN1bHQuZXhjZXB0aW9uTWVzc2FnZSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG59KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///e6944ecc13b0862a73e7\n");

/***/ }),

/***/ "e795383f953f8380d242":
/*!*****************************************************!*\
  !*** ./src/Apps/DOCUMENT/IHM/models/mTransition.js ***!
  \*****************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/*global define*/\n!(__WEBPACK_AMD_DEFINE_ARRAY__ = [\n  __webpack_require__(/*! underscore */ \"8e08e542008e4aef1f58\"),\n  __webpack_require__(/*! backbone */ \"1858b45bf48591489d06\"),\n  __webpack_require__(/*! dcpDocument/models/mDocument */ \"ab4ce4f91706f6c2712e\")\n], __WEBPACK_AMD_DEFINE_RESULT__ = (function requireModelTransition(_, Backbone, mDocument) {\n  \"use strict\";\n\n  return mDocument.extend({\n    typeModel: \"ddui:transition\",\n    defaults: {\n      documentId: undefined,\n      documentModel: undefined,\n      state: undefined,\n      attributes: []\n    },\n\n    /**\n     * Compute the REST URL for the current document\n     *\n     * Used internally by backbone in fetch, save, destroy\n     *\n     * @returns {string}\n     */\n    url: function mTransition_url() {\n      var urlData =\n        \"api/v2/documents/<%= documentId %>/views/states/<%= state %>\";\n\n      urlData = urlData.replace(\n        \"<%= documentId %>\",\n        encodeURIComponent(this.get(\"documentId\"))\n      );\n      urlData = urlData.replace(\n        \"<%= state %>\",\n        encodeURIComponent(this.get(\"state\"))\n      );\n\n      return urlData;\n    },\n    /**\n     * Parse the return of the REST API\n     * @param response\n     * @returns {{properties: (*|properties|exports.defaults.properties|exports.parse.properties|.createObjectExpression.properties), menus: (app.views.shared.menu|*), locale: *, renderMode: string, attributes: Array, templates: *, renderOptions: *}}\n     */\n    parse: function mTransition_Parse(response) {\n      var values, attributes, templates, renderOptions;\n      var documentModel = this.get(\"documentModel\");\n      if (response.success === false) {\n        throw new Error(\"Unable to get the data from change state\");\n      }\n      attributes = [];\n\n      renderOptions = response.data.renderOptions;\n\n      if (!renderOptions) {\n        renderOptions = documentModel.get(\"renderOptions\");\n      }\n      if (\n        response.data.transition &&\n        response.data.transition.askAttributes.length > 0\n      ) {\n        _.each(\n          response.data.transition.askAttributes,\n          function mTransition_parseAsk(ask) {\n            attributes.push(ask);\n          }\n        );\n      }\n      templates = documentModel.get(\"templates\");\n\n      if (response.data.templates) {\n        templates.body = response.data.templates.body;\n        _.each(\n          response.data.templates.sections,\n          function mTransition_parseTemplate(templateContent, templateIndex) {\n            templates.sections[templateIndex] = templateContent;\n          }\n        );\n      }\n\n      this.initialProperties = {\n        renderMode: \"edit\",\n        viewId: \"!Transition\"\n      };\n\n      values = {\n        initid: null, //response.data.workflow.properties.initid, // set to null to send a POST (create) when save\n        properties: response.data.workflow.properties,\n        menus: [],\n        viewId: \"!Transition\",\n        locale: documentModel.get(\"locale\").culture,\n        renderMode: \"edit\",\n        attributes: attributes,\n        templates: documentModel.get(\"templates\"),\n        renderOptions: renderOptions,\n        customCSS: response.data.css,\n        customJS: response.data.js,\n        messages: response.messages,\n        workflow: {\n          transition: response.data.transition,\n          state: response.data.state,\n          labels: response.data.labels\n        }\n      };\n      return values;\n    },\n\n    /**\n     * Used by backbone for the save part\n     * @returns {{document: {attributes: *, properties : *}}}\n     */\n    toJSON: function mTransition_toJSON() {\n      var values = this.getValues(),\n        returnValues = { parameters: {} };\n\n      _.each(values, function mTransition_analyzeContent(value, aid) {\n        if (aid === \"_workflow_comment_\") {\n          returnValues.comment = _.isObject(value) ? value.value : \"\";\n        } else {\n          if (_.isArray(value)) {\n            if (value.length > 0 && _.isArray(value[0])) {\n              // double multiple\n              returnValues.parameters[aid] = _.map(\n                value,\n                function mTransition_getParameter(aValue) {\n                  return _.pluck(aValue, \"value\");\n                }\n              );\n            } else {\n              returnValues.parameters[aid] = _.pluck(value, \"value\");\n            }\n          } else if (_.isObject(value)) {\n            returnValues.parameters[aid] = value.value;\n          } else {\n            returnValues.parameters[aid] = value;\n          }\n        }\n      });\n      return returnValues;\n    }\n  });\n}).apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZTc5NTM4M2Y5NTNmODM4MGQyNDIuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvQXBwcy9ET0NVTUVOVC9JSE0vbW9kZWxzL21UcmFuc2l0aW9uLmpzPzAyYjUiXSwic291cmNlc0NvbnRlbnQiOlsiLypnbG9iYWwgZGVmaW5lKi9cbmRlZmluZShbXG4gIFwidW5kZXJzY29yZVwiLFxuICBcImJhY2tib25lXCIsXG4gIFwiZGNwRG9jdW1lbnQvbW9kZWxzL21Eb2N1bWVudFwiXG5dLCBmdW5jdGlvbiByZXF1aXJlTW9kZWxUcmFuc2l0aW9uKF8sIEJhY2tib25lLCBtRG9jdW1lbnQpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgcmV0dXJuIG1Eb2N1bWVudC5leHRlbmQoe1xuICAgIHR5cGVNb2RlbDogXCJkZHVpOnRyYW5zaXRpb25cIixcbiAgICBkZWZhdWx0czoge1xuICAgICAgZG9jdW1lbnRJZDogdW5kZWZpbmVkLFxuICAgICAgZG9jdW1lbnRNb2RlbDogdW5kZWZpbmVkLFxuICAgICAgc3RhdGU6IHVuZGVmaW5lZCxcbiAgICAgIGF0dHJpYnV0ZXM6IFtdXG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIENvbXB1dGUgdGhlIFJFU1QgVVJMIGZvciB0aGUgY3VycmVudCBkb2N1bWVudFxuICAgICAqXG4gICAgICogVXNlZCBpbnRlcm5hbGx5IGJ5IGJhY2tib25lIGluIGZldGNoLCBzYXZlLCBkZXN0cm95XG4gICAgICpcbiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfVxuICAgICAqL1xuICAgIHVybDogZnVuY3Rpb24gbVRyYW5zaXRpb25fdXJsKCkge1xuICAgICAgdmFyIHVybERhdGEgPVxuICAgICAgICBcImFwaS92Mi9kb2N1bWVudHMvPCU9IGRvY3VtZW50SWQgJT4vdmlld3Mvc3RhdGVzLzwlPSBzdGF0ZSAlPlwiO1xuXG4gICAgICB1cmxEYXRhID0gdXJsRGF0YS5yZXBsYWNlKFxuICAgICAgICBcIjwlPSBkb2N1bWVudElkICU+XCIsXG4gICAgICAgIGVuY29kZVVSSUNvbXBvbmVudCh0aGlzLmdldChcImRvY3VtZW50SWRcIikpXG4gICAgICApO1xuICAgICAgdXJsRGF0YSA9IHVybERhdGEucmVwbGFjZShcbiAgICAgICAgXCI8JT0gc3RhdGUgJT5cIixcbiAgICAgICAgZW5jb2RlVVJJQ29tcG9uZW50KHRoaXMuZ2V0KFwic3RhdGVcIikpXG4gICAgICApO1xuXG4gICAgICByZXR1cm4gdXJsRGF0YTtcbiAgICB9LFxuICAgIC8qKlxuICAgICAqIFBhcnNlIHRoZSByZXR1cm4gb2YgdGhlIFJFU1QgQVBJXG4gICAgICogQHBhcmFtIHJlc3BvbnNlXG4gICAgICogQHJldHVybnMge3twcm9wZXJ0aWVzOiAoKnxwcm9wZXJ0aWVzfGV4cG9ydHMuZGVmYXVsdHMucHJvcGVydGllc3xleHBvcnRzLnBhcnNlLnByb3BlcnRpZXN8LmNyZWF0ZU9iamVjdEV4cHJlc3Npb24ucHJvcGVydGllcyksIG1lbnVzOiAoYXBwLnZpZXdzLnNoYXJlZC5tZW51fCopLCBsb2NhbGU6ICosIHJlbmRlck1vZGU6IHN0cmluZywgYXR0cmlidXRlczogQXJyYXksIHRlbXBsYXRlczogKiwgcmVuZGVyT3B0aW9uczogKn19XG4gICAgICovXG4gICAgcGFyc2U6IGZ1bmN0aW9uIG1UcmFuc2l0aW9uX1BhcnNlKHJlc3BvbnNlKSB7XG4gICAgICB2YXIgdmFsdWVzLCBhdHRyaWJ1dGVzLCB0ZW1wbGF0ZXMsIHJlbmRlck9wdGlvbnM7XG4gICAgICB2YXIgZG9jdW1lbnRNb2RlbCA9IHRoaXMuZ2V0KFwiZG9jdW1lbnRNb2RlbFwiKTtcbiAgICAgIGlmIChyZXNwb25zZS5zdWNjZXNzID09PSBmYWxzZSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJVbmFibGUgdG8gZ2V0IHRoZSBkYXRhIGZyb20gY2hhbmdlIHN0YXRlXCIpO1xuICAgICAgfVxuICAgICAgYXR0cmlidXRlcyA9IFtdO1xuXG4gICAgICByZW5kZXJPcHRpb25zID0gcmVzcG9uc2UuZGF0YS5yZW5kZXJPcHRpb25zO1xuXG4gICAgICBpZiAoIXJlbmRlck9wdGlvbnMpIHtcbiAgICAgICAgcmVuZGVyT3B0aW9ucyA9IGRvY3VtZW50TW9kZWwuZ2V0KFwicmVuZGVyT3B0aW9uc1wiKTtcbiAgICAgIH1cbiAgICAgIGlmIChcbiAgICAgICAgcmVzcG9uc2UuZGF0YS50cmFuc2l0aW9uICYmXG4gICAgICAgIHJlc3BvbnNlLmRhdGEudHJhbnNpdGlvbi5hc2tBdHRyaWJ1dGVzLmxlbmd0aCA+IDBcbiAgICAgICkge1xuICAgICAgICBfLmVhY2goXG4gICAgICAgICAgcmVzcG9uc2UuZGF0YS50cmFuc2l0aW9uLmFza0F0dHJpYnV0ZXMsXG4gICAgICAgICAgZnVuY3Rpb24gbVRyYW5zaXRpb25fcGFyc2VBc2soYXNrKSB7XG4gICAgICAgICAgICBhdHRyaWJ1dGVzLnB1c2goYXNrKTtcbiAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICB0ZW1wbGF0ZXMgPSBkb2N1bWVudE1vZGVsLmdldChcInRlbXBsYXRlc1wiKTtcblxuICAgICAgaWYgKHJlc3BvbnNlLmRhdGEudGVtcGxhdGVzKSB7XG4gICAgICAgIHRlbXBsYXRlcy5ib2R5ID0gcmVzcG9uc2UuZGF0YS50ZW1wbGF0ZXMuYm9keTtcbiAgICAgICAgXy5lYWNoKFxuICAgICAgICAgIHJlc3BvbnNlLmRhdGEudGVtcGxhdGVzLnNlY3Rpb25zLFxuICAgICAgICAgIGZ1bmN0aW9uIG1UcmFuc2l0aW9uX3BhcnNlVGVtcGxhdGUodGVtcGxhdGVDb250ZW50LCB0ZW1wbGF0ZUluZGV4KSB7XG4gICAgICAgICAgICB0ZW1wbGF0ZXMuc2VjdGlvbnNbdGVtcGxhdGVJbmRleF0gPSB0ZW1wbGF0ZUNvbnRlbnQ7XG4gICAgICAgICAgfVxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICB0aGlzLmluaXRpYWxQcm9wZXJ0aWVzID0ge1xuICAgICAgICByZW5kZXJNb2RlOiBcImVkaXRcIixcbiAgICAgICAgdmlld0lkOiBcIiFUcmFuc2l0aW9uXCJcbiAgICAgIH07XG5cbiAgICAgIHZhbHVlcyA9IHtcbiAgICAgICAgaW5pdGlkOiBudWxsLCAvL3Jlc3BvbnNlLmRhdGEud29ya2Zsb3cucHJvcGVydGllcy5pbml0aWQsIC8vIHNldCB0byBudWxsIHRvIHNlbmQgYSBQT1NUIChjcmVhdGUpIHdoZW4gc2F2ZVxuICAgICAgICBwcm9wZXJ0aWVzOiByZXNwb25zZS5kYXRhLndvcmtmbG93LnByb3BlcnRpZXMsXG4gICAgICAgIG1lbnVzOiBbXSxcbiAgICAgICAgdmlld0lkOiBcIiFUcmFuc2l0aW9uXCIsXG4gICAgICAgIGxvY2FsZTogZG9jdW1lbnRNb2RlbC5nZXQoXCJsb2NhbGVcIikuY3VsdHVyZSxcbiAgICAgICAgcmVuZGVyTW9kZTogXCJlZGl0XCIsXG4gICAgICAgIGF0dHJpYnV0ZXM6IGF0dHJpYnV0ZXMsXG4gICAgICAgIHRlbXBsYXRlczogZG9jdW1lbnRNb2RlbC5nZXQoXCJ0ZW1wbGF0ZXNcIiksXG4gICAgICAgIHJlbmRlck9wdGlvbnM6IHJlbmRlck9wdGlvbnMsXG4gICAgICAgIGN1c3RvbUNTUzogcmVzcG9uc2UuZGF0YS5jc3MsXG4gICAgICAgIGN1c3RvbUpTOiByZXNwb25zZS5kYXRhLmpzLFxuICAgICAgICBtZXNzYWdlczogcmVzcG9uc2UubWVzc2FnZXMsXG4gICAgICAgIHdvcmtmbG93OiB7XG4gICAgICAgICAgdHJhbnNpdGlvbjogcmVzcG9uc2UuZGF0YS50cmFuc2l0aW9uLFxuICAgICAgICAgIHN0YXRlOiByZXNwb25zZS5kYXRhLnN0YXRlLFxuICAgICAgICAgIGxhYmVsczogcmVzcG9uc2UuZGF0YS5sYWJlbHNcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIHJldHVybiB2YWx1ZXM7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIFVzZWQgYnkgYmFja2JvbmUgZm9yIHRoZSBzYXZlIHBhcnRcbiAgICAgKiBAcmV0dXJucyB7e2RvY3VtZW50OiB7YXR0cmlidXRlczogKiwgcHJvcGVydGllcyA6ICp9fX1cbiAgICAgKi9cbiAgICB0b0pTT046IGZ1bmN0aW9uIG1UcmFuc2l0aW9uX3RvSlNPTigpIHtcbiAgICAgIHZhciB2YWx1ZXMgPSB0aGlzLmdldFZhbHVlcygpLFxuICAgICAgICByZXR1cm5WYWx1ZXMgPSB7IHBhcmFtZXRlcnM6IHt9IH07XG5cbiAgICAgIF8uZWFjaCh2YWx1ZXMsIGZ1bmN0aW9uIG1UcmFuc2l0aW9uX2FuYWx5emVDb250ZW50KHZhbHVlLCBhaWQpIHtcbiAgICAgICAgaWYgKGFpZCA9PT0gXCJfd29ya2Zsb3dfY29tbWVudF9cIikge1xuICAgICAgICAgIHJldHVyblZhbHVlcy5jb21tZW50ID0gXy5pc09iamVjdCh2YWx1ZSkgPyB2YWx1ZS52YWx1ZSA6IFwiXCI7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaWYgKF8uaXNBcnJheSh2YWx1ZSkpIHtcbiAgICAgICAgICAgIGlmICh2YWx1ZS5sZW5ndGggPiAwICYmIF8uaXNBcnJheSh2YWx1ZVswXSkpIHtcbiAgICAgICAgICAgICAgLy8gZG91YmxlIG11bHRpcGxlXG4gICAgICAgICAgICAgIHJldHVyblZhbHVlcy5wYXJhbWV0ZXJzW2FpZF0gPSBfLm1hcChcbiAgICAgICAgICAgICAgICB2YWx1ZSxcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiBtVHJhbnNpdGlvbl9nZXRQYXJhbWV0ZXIoYVZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gXy5wbHVjayhhVmFsdWUsIFwidmFsdWVcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgcmV0dXJuVmFsdWVzLnBhcmFtZXRlcnNbYWlkXSA9IF8ucGx1Y2sodmFsdWUsIFwidmFsdWVcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIGlmIChfLmlzT2JqZWN0KHZhbHVlKSkge1xuICAgICAgICAgICAgcmV0dXJuVmFsdWVzLnBhcmFtZXRlcnNbYWlkXSA9IHZhbHVlLnZhbHVlO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm5WYWx1ZXMucGFyYW1ldGVyc1thaWRdID0gdmFsdWU7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIHJldHVybiByZXR1cm5WYWx1ZXM7XG4gICAgfVxuICB9KTtcbn0pO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///e795383f953f8380d242\n");

/***/ }),

/***/ "ea039643a9587ce47509":
/*!********************************************************************!*\
  !*** ./src/Apps/DOCUMENT/IHM/widgets/attributes/double/wDouble.js ***!
  \********************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;(function umdRequire(root, factory) {\n  \"use strict\";\n\n  if (true) {\n    !(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(/*! jquery */ \"127c8cf59f228bb01a21\"), __webpack_require__(/*! dcpDocument/widgets/attributes/int/wInt */ \"0627c604219b27e8bb7c\")], __WEBPACK_AMD_DEFINE_FACTORY__ = (factory),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?\n\t\t\t\t(__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n  } else {}\n})(window, function require_double($) {\n  \"use strict\";\n\n  $.widget(\"dcp.dcpDouble\", $.dcp.dcpInt, {\n    options: {\n      type: \"double\",\n      renderOptions: {\n        decimalPrecision: null, // unlimited precision\n        numberFormat: \"#,#.######################\"\n      }\n    },\n\n    _initDom: function wDoubleInitDom() {\n      if (\n        this.options.renderOptions.decimalPrecision !== null &&\n        this.options.renderOptions.decimalPrecision >= 0\n      ) {\n        // view decimal precision\n        this.options.renderOptions.numberFormat = \"#,#.\";\n        for (\n          var idx = 0;\n          idx < this.options.renderOptions.decimalPrecision;\n          idx++\n        ) {\n          this.options.renderOptions.numberFormat += \"0\";\n        }\n      }\n\n      this._super();\n    },\n    /**\n     * Get kendo option from normal options and from renderOptions.kendoNumeric\n     * @returns {*}\n     */\n    getKendoNumericOptions: function wDoubleGetKendoNumericOptions() {\n      var options = this._super(); // get from wInt\n      //Limits are linked to this bug => https://github.com/telerik/kendo-ui-core/issues/423\n      if (options.max === null) {\n        options.max = 9.99999e19;\n      }\n      if (options.min === null) {\n        options.min = -9.9999e19;\n      }\n      if (this.options.renderOptions.decimalPrecision !== null) {\n        options.decimals = this.options.renderOptions.decimalPrecision;\n      } else {\n        options.decimals = 20;\n      }\n      return options;\n    },\n\n    getType: function wDoubleGetType() {\n      return \"double\";\n    }\n  });\n\n  return $.fn.dcpDouble;\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZWEwMzk2NDNhOTU4N2NlNDc1MDkuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvQXBwcy9ET0NVTUVOVC9JSE0vd2lkZ2V0cy9hdHRyaWJ1dGVzL2RvdWJsZS93RG91YmxlLmpzPzI3NTIiXSwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIHVtZFJlcXVpcmUocm9vdCwgZmFjdG9yeSkge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICBpZiAodHlwZW9mIGRlZmluZSA9PT0gXCJmdW5jdGlvblwiICYmIGRlZmluZS5hbWQpIHtcbiAgICBkZWZpbmUoW1wianF1ZXJ5XCIsIFwiZGNwRG9jdW1lbnQvd2lkZ2V0cy9hdHRyaWJ1dGVzL2ludC93SW50XCJdLCBmYWN0b3J5KTtcbiAgfSBlbHNlIHtcbiAgICAvL25vaW5zcGVjdGlvbiBKU1VucmVzb2x2ZWRWYXJpYWJsZVxuICAgIGZhY3Rvcnkod2luZG93LmpRdWVyeSk7XG4gIH1cbn0pKHdpbmRvdywgZnVuY3Rpb24gcmVxdWlyZV9kb3VibGUoJCkge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICAkLndpZGdldChcImRjcC5kY3BEb3VibGVcIiwgJC5kY3AuZGNwSW50LCB7XG4gICAgb3B0aW9uczoge1xuICAgICAgdHlwZTogXCJkb3VibGVcIixcbiAgICAgIHJlbmRlck9wdGlvbnM6IHtcbiAgICAgICAgZGVjaW1hbFByZWNpc2lvbjogbnVsbCwgLy8gdW5saW1pdGVkIHByZWNpc2lvblxuICAgICAgICBudW1iZXJGb3JtYXQ6IFwiIywjLiMjIyMjIyMjIyMjIyMjIyMjIyMjIyNcIlxuICAgICAgfVxuICAgIH0sXG5cbiAgICBfaW5pdERvbTogZnVuY3Rpb24gd0RvdWJsZUluaXREb20oKSB7XG4gICAgICBpZiAoXG4gICAgICAgIHRoaXMub3B0aW9ucy5yZW5kZXJPcHRpb25zLmRlY2ltYWxQcmVjaXNpb24gIT09IG51bGwgJiZcbiAgICAgICAgdGhpcy5vcHRpb25zLnJlbmRlck9wdGlvbnMuZGVjaW1hbFByZWNpc2lvbiA+PSAwXG4gICAgICApIHtcbiAgICAgICAgLy8gdmlldyBkZWNpbWFsIHByZWNpc2lvblxuICAgICAgICB0aGlzLm9wdGlvbnMucmVuZGVyT3B0aW9ucy5udW1iZXJGb3JtYXQgPSBcIiMsIy5cIjtcbiAgICAgICAgZm9yIChcbiAgICAgICAgICB2YXIgaWR4ID0gMDtcbiAgICAgICAgICBpZHggPCB0aGlzLm9wdGlvbnMucmVuZGVyT3B0aW9ucy5kZWNpbWFsUHJlY2lzaW9uO1xuICAgICAgICAgIGlkeCsrXG4gICAgICAgICkge1xuICAgICAgICAgIHRoaXMub3B0aW9ucy5yZW5kZXJPcHRpb25zLm51bWJlckZvcm1hdCArPSBcIjBcIjtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICB0aGlzLl9zdXBlcigpO1xuICAgIH0sXG4gICAgLyoqXG4gICAgICogR2V0IGtlbmRvIG9wdGlvbiBmcm9tIG5vcm1hbCBvcHRpb25zIGFuZCBmcm9tIHJlbmRlck9wdGlvbnMua2VuZG9OdW1lcmljXG4gICAgICogQHJldHVybnMgeyp9XG4gICAgICovXG4gICAgZ2V0S2VuZG9OdW1lcmljT3B0aW9uczogZnVuY3Rpb24gd0RvdWJsZUdldEtlbmRvTnVtZXJpY09wdGlvbnMoKSB7XG4gICAgICB2YXIgb3B0aW9ucyA9IHRoaXMuX3N1cGVyKCk7IC8vIGdldCBmcm9tIHdJbnRcbiAgICAgIC8vTGltaXRzIGFyZSBsaW5rZWQgdG8gdGhpcyBidWcgPT4gaHR0cHM6Ly9naXRodWIuY29tL3RlbGVyaWsva2VuZG8tdWktY29yZS9pc3N1ZXMvNDIzXG4gICAgICBpZiAob3B0aW9ucy5tYXggPT09IG51bGwpIHtcbiAgICAgICAgb3B0aW9ucy5tYXggPSA5Ljk5OTk5ZTE5O1xuICAgICAgfVxuICAgICAgaWYgKG9wdGlvbnMubWluID09PSBudWxsKSB7XG4gICAgICAgIG9wdGlvbnMubWluID0gLTkuOTk5OWUxOTtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLm9wdGlvbnMucmVuZGVyT3B0aW9ucy5kZWNpbWFsUHJlY2lzaW9uICE9PSBudWxsKSB7XG4gICAgICAgIG9wdGlvbnMuZGVjaW1hbHMgPSB0aGlzLm9wdGlvbnMucmVuZGVyT3B0aW9ucy5kZWNpbWFsUHJlY2lzaW9uO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgb3B0aW9ucy5kZWNpbWFscyA9IDIwO1xuICAgICAgfVxuICAgICAgcmV0dXJuIG9wdGlvbnM7XG4gICAgfSxcblxuICAgIGdldFR5cGU6IGZ1bmN0aW9uIHdEb3VibGVHZXRUeXBlKCkge1xuICAgICAgcmV0dXJuIFwiZG91YmxlXCI7XG4gICAgfVxuICB9KTtcblxuICByZXR1cm4gJC5mbi5kY3BEb3VibGU7XG59KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUNBLFdBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///ea039643a9587ce47509\n");

/***/ }),

/***/ "f562ab9f022eef93542c":
/*!*************************************************!*\
  !*** ./src/Apps/DOCUMENT/IHM/widgets/widget.js ***!
  \*************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/*global define*/\n\n(function umdRequire(root, factory) {\n  \"use strict\";\n\n  if (true) {\n    !(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(/*! jquery */ \"127c8cf59f228bb01a21\")], __WEBPACK_AMD_DEFINE_FACTORY__ = (factory),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?\n\t\t\t\t(__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n  } else {}\n})(window, function documentCatalog(jQuery) {\n  \"use strict\";\n\n  var ErrorNoSuchMethod = function widget_ErrorNoSuchMethod(message) {\n    this.name = \"noSuchMethodError\";\n    this.message = message || \"No such method for current widget instance\";\n  };\n\n  ErrorNoSuchMethod.prototype = Object.create(Error.prototype);\n  ErrorNoSuchMethod.prototype.constructor = ErrorNoSuchMethod;\n\n  (function widget_init($, undefined) {\n    var widgetUuid = 0,\n      slice = Array.prototype.slice,\n      _cleanData = $.cleanData;\n    $.cleanData = function widget_cleanData(elems) {\n      var events,\n        elem = null,\n        i;\n      for (i = 0, elem; (elem = elems[i]) != null; i++) {\n        // jshint ignore:line\n        try {\n          // Only trigger remove when necessary to save time\n          events = $._data(elem, \"events\");\n          if (events && events.remove) {\n            $(elem).triggerHandler(\"remove\");\n          }\n        } catch (e) {\n          //no test here\n        }\n      }\n      _cleanData(elems);\n    };\n\n    $.widget = function widget_initWidget(name, Base, prototype) {\n      var fullName,\n        existingConstructor,\n        Constructor,\n        basePrototype,\n        // proxiedPrototype allows the provided prototype to remain unmodified\n        // so that it can be used as a mixin for multiple widgets (#8876)\n        proxiedPrototype = {},\n        namespace = name.split(\".\")[0];\n\n      name = name.split(\".\")[1];\n      fullName = namespace + \"-\" + name;\n\n      if (!prototype) {\n        prototype = Base;\n        Base = $.Widget;\n      }\n\n      if ($.isArray(prototype)) {\n        prototype = $.extend.apply(null, [{}].concat(prototype));\n      }\n\n      // create selector for plugin\n      // $.expr[ \":\" ] is deprecated with jQuery 3.0.0+ in favor of $.expr.pseudos\n      // $.expr[ \":\" ][ fullName.toLowerCase() ] = function widget_createSelector(elem) {\n      //     return Boolean($(elem).data(fullName));\n      // };\n      $.expr.pseudos[fullName.toLowerCase()] = function widget_createSelector(\n        elem\n      ) {\n        return Boolean($(elem).data(fullName));\n      };\n\n      $[namespace] = $[namespace] || {};\n      existingConstructor = $[namespace][name];\n      Constructor = $[namespace][name] = function widget_Constructor(\n        options,\n        element\n      ) {\n        // allow instantiation without \"new\" keyword\n        if (!this._createWidget) {\n          return new Constructor(options, element);\n        }\n\n        // allow instantiation without initializing for simple inheritance\n        // must use \"new\" keyword (the code above always passes args)\n        if (arguments.length) {\n          this._createWidget(options, element);\n        }\n      };\n      // extend with the existing constructor to carry over any static properties\n      $.extend(Constructor, existingConstructor, {\n        version: prototype.version,\n        // copy the object used to create the prototype in case we need to\n        // redefine the widget later\n        _proto: $.extend({}, prototype),\n        // track widgets that inherit from this widget in case this widget is\n        // redefined after a widget inherits from it\n        _childConstructors: []\n      });\n\n      basePrototype = new Base();\n      // we need to make the options hash a property directly on the new instance\n      // otherwise we'll modify the options hash on the prototype that we're\n      // inheriting from\n      basePrototype.options = $.widget.extend({}, basePrototype.options);\n      $.each(prototype, function widget_proxiedElements(prop, value) {\n        if (!$.isFunction(value)) {\n          proxiedPrototype[prop] = value;\n          return;\n        }\n        proxiedPrototype[prop] = (function widget_proxiedProperties() {\n          var _super = function widget_super() {\n              return Base.prototype[prop].apply(this, arguments);\n            },\n            _superApply = function widget_superApply(args) {\n              return Base.prototype[prop].apply(this, args);\n            };\n          return function widget_proxied() {\n            var __super = this._super,\n              __superApply = this._superApply,\n              returnValue;\n\n            this._super = _super;\n            this._superApply = _superApply;\n\n            returnValue = value.apply(this, arguments);\n\n            this._super = __super;\n            this._superApply = __superApply;\n\n            return returnValue;\n          };\n        })();\n      });\n      Constructor.prototype = $.widget.extend(\n        basePrototype,\n        {},\n        proxiedPrototype,\n        {\n          constructor: Constructor,\n          namespace: namespace,\n          widgetName: name,\n          widgetFullName: fullName\n        }\n      );\n\n      // If this widget is being redefined then we need to find all widgets that\n      // are inheriting from it and redefine all of them so that they inherit from\n      // the new version of this widget. We're essentially trying to replace one\n      // level in the prototype chain.\n      if (existingConstructor) {\n        $.each(\n          existingConstructor._childConstructors,\n          function widget_existingConstructor(i, child) {\n            var childPrototype = child.prototype;\n\n            // redefine the child widget using the same prototype that was\n            // originally used, but inherit from the new version of the base\n            $.widget(\n              childPrototype.namespace + \".\" + childPrototype.widgetName,\n              Constructor,\n              child._proto\n            );\n          }\n        );\n        // remove the list of existing child constructors from the old constructor\n        // so the old child constructors can be garbage collected\n        delete existingConstructor._childConstructors;\n      } else {\n        Base._childConstructors.push(Constructor);\n      }\n\n      $.widget.bridge(name, Constructor);\n\n      return Constructor;\n    };\n\n    $.widget.extend = function widget_extend(target) {\n      var input = slice.call(arguments, 1),\n        inputIndex = 0,\n        inputLength = input.length,\n        key,\n        value;\n      for (; inputIndex < inputLength; inputIndex++) {\n        for (key in input[inputIndex]) {\n          // jshint ignore:line\n          //noinspection JSUnfilteredForInLoop\n          value = input[inputIndex][key];\n          if (input[inputIndex].hasOwnProperty(key) && value !== undefined) {\n            // Clone objects\n            if ($.isPlainObject(value)) {\n              target[key] = $.isPlainObject(target[key])\n                ? $.widget.extend({}, target[key], value)\n                : // Don't extend strings, arrays, etc. with objects\n                  $.widget.extend({}, value);\n              // Copy everything else by reference\n            } else {\n              target[key] = value;\n            }\n          }\n        }\n      }\n      return target;\n    };\n\n    $.widget.bridge = function widget_bridge(name, Object) {\n      var fullName = Object.prototype.widgetFullName || name;\n      $.fn[name] = function widget_callElement(options) {\n        var isMethodCall = typeof options === \"string\",\n          args = slice.call(arguments, 1),\n          returnValue = this;\n\n        // allow multiple hashes to be passed on init\n        options =\n          !isMethodCall && args.length\n            ? $.widget.extend.apply(null, [options].concat(args))\n            : options;\n\n        if (isMethodCall) {\n          this.each(function widget_eachMethodCall() {\n            var methodValue,\n              instance = $(this).data(fullName);\n            if (options === \"instance\") {\n              returnValue = instance;\n              return false;\n            }\n            if (!instance) {\n              return $.error(\n                \"cannot call methods on \" +\n                  name +\n                  \" prior to initialization; \" +\n                  \"attempted to call method '\" +\n                  options +\n                  \"'\"\n              );\n            }\n            if (!$.isFunction(instance[options]) || options.charAt(0) === \"_\") {\n              throw new ErrorNoSuchMethod(\n                \"no such method '\" +\n                  options +\n                  \"' for \" +\n                  name +\n                  \" widget instance\"\n              );\n            }\n            methodValue = instance[options].apply(instance, args);\n            if (methodValue !== instance && methodValue !== undefined) {\n              returnValue =\n                methodValue && methodValue.jquery\n                  ? returnValue.pushStack(methodValue.get())\n                  : methodValue;\n              return false;\n            }\n          });\n        } else {\n          // Allow multiple hashes to be passed on init\n          if (args.length) {\n            options = $.widget.extend.apply(null, [options].concat(args));\n          }\n\n          this.each(function widget_eachDataCall() {\n            var instance = $(this).data(fullName);\n            if (instance) {\n              instance.option(options || {})._init();\n            } else {\n              $(this).data(fullName, new Object(options, this));\n            }\n          });\n        }\n\n        return returnValue;\n      };\n    };\n\n    $.Widget = function widget_Widget(/* options, element */) {};\n    $.Widget._childConstructors = [];\n\n    $.Widget.prototype = {\n      widgetName: \"widget\",\n      defaultElement: \"<div>\",\n      options: {\n        classes: {},\n        disabled: false,\n        eventPrefix: null,\n        // callbacks\n        create: null\n      },\n      _createWidget: function widget_createWidget(options, element) {\n        element = $(element || this.defaultElement || this)[0];\n        this.element = $(element);\n        this.uuid = widgetUuid++;\n        this.eventNamespace = \".\" + this.widgetName + this.uuid;\n        this.options = $.widget.extend(\n          {},\n          this.options,\n          this._getCreateOptions(),\n          options\n        );\n\n        this.bindings = $();\n        this.classesElementLookup = {};\n        if (this.options.eventPrefix === null) {\n          this.options.eventPrefix = this.widgetName;\n        }\n\n        if (element !== this) {\n          $(element).data(this.widgetFullName, this);\n          this._on(true, this.element, {\n            remove: function widget_remove(event) {\n              if (event.target === element) {\n                this.destroy();\n              }\n            }\n          });\n          this.document = $(\n            element.style\n              ? // element within the document\n                element.ownerDocument\n              : // element is window or document\n                element.document || element\n          );\n          this.window = $(\n            this.document[0].defaultView || this.document[0].parentWindow\n          );\n        }\n        this.options = $.widget.extend(\n          {},\n          this.options,\n          this._getCreateOptions(),\n          options\n        );\n\n        this._create();\n\n        if (this.options.disabled) {\n          this._setOptionDisabled(this.options.disabled);\n        }\n\n        this._trigger(\"create\", null, this._getCreateEventData());\n        this._init();\n      },\n      _getCreateOptions: function widget_getCreateOptions() {\n        return {};\n      },\n      _getCreateEventData: $.noop,\n      _create: $.noop,\n      _init: $.noop,\n\n      destroy: function widget_destroy() {\n        var that = this;\n\n        this._destroy();\n        $.each(this.classesElementLookup, function widget_destroyClass(\n          key,\n          value\n        ) {\n          that._removeClass(value, key);\n        });\n\n        // We can probably remove the unbind calls in 2.0\n        // all event bindings should go through this._on()\n        this.element.off(this.eventNamespace).removeData(this.widgetFullName);\n        this.widget()\n          .off(this.eventNamespace)\n          .removeAttr(\"aria-disabled\");\n\n        // Clean up events and states\n        this.bindings.off(this.eventNamespace);\n      },\n      _destroy: $.noop,\n\n      widget: function widget_widget() {\n        return this.element;\n      },\n\n      option: function widget_option(key, value) {\n        var options = key,\n          parts,\n          curOption,\n          i;\n\n        if (arguments.length === 0) {\n          // don't return a reference to the internal hash\n          return $.widget.extend({}, this.options);\n        }\n\n        if (typeof key === \"string\") {\n          // handle nested keys, e.g., \"foo.bar\" => { foo: { bar: ___ } }\n          options = {};\n          parts = key.split(\".\");\n          key = parts.shift();\n          if (parts.length) {\n            curOption = options[key] = $.widget.extend({}, this.options[key]);\n            for (i = 0; i < parts.length - 1; i++) {\n              curOption[parts[i]] = curOption[parts[i]] || {};\n              curOption = curOption[parts[i]];\n            }\n            key = parts.pop();\n            if (arguments.length === 1) {\n              return curOption[key] === undefined ? null : curOption[key];\n            }\n            curOption[key] = value;\n          } else {\n            if (arguments.length === 1) {\n              return this.options[key] === undefined ? null : this.options[key];\n            }\n            options[key] = value;\n          }\n        }\n\n        this._setOptions(options);\n\n        return this;\n      },\n      _setOptions: function widget__setOptions(options) {\n        var key;\n\n        for (key in options) {\n          // jshint ignore:line\n          //noinspection JSUnfilteredForInLoop\n          this._setOption(key, options[key]);\n        }\n\n        return this;\n      },\n      _setOption: function widget__setOption(key, value) {\n        this.options[key] = value;\n\n        return this;\n      },\n\n      _setOptionClasses: function widget__setOptionClasses(value) {\n        var classKey, elements, currentElements;\n\n        for (classKey in value) {\n          // jshint ignore:line\n          //noinspection JSUnfilteredForInLoop\n          currentElements = this.classesElementLookup[classKey];\n          //noinspection JSUnfilteredForInLoop\n          if (\n            value[classKey] === this.options.classes[classKey] ||\n            !currentElements ||\n            !currentElements.length\n          ) {\n            continue;\n          }\n\n          // We are doing this to create a new jQuery object because the _removeClass() call\n          // on the next line is going to destroy the reference to the current elements being\n          // tracked. We need to save a copy of this collection so that we can add the new classes\n          // below.\n          elements = $(currentElements.get());\n          //noinspection JSUnfilteredForInLoop\n          this._removeClass(currentElements, classKey);\n\n          // We don't use _addClass() here, because that uses this.options.classes\n          // for generating the string of classes. We want to use the value passed in from\n          // _setOption(), this is the new value of the classes option which was passed to\n          // _setOption(). We pass this value directly to _classes().\n          //noinspection JSUnfilteredForInLoop\n          elements.addClass(\n            this._classes({\n              element: elements,\n              keys: classKey,\n              classes: value,\n              add: true\n            })\n          );\n        }\n      },\n\n      _classes: function widget__classes(options) {\n        var full = [];\n        var that = this,\n          processClassString;\n\n        options = $.extend(\n          {\n            element: this.element,\n            classes: this.options.classes || {}\n          },\n          options\n        );\n\n        processClassString = function widget_processClassString(\n          classes,\n          checkOption\n        ) {\n          var current, i;\n          for (i = 0; i < classes.length; i++) {\n            current = that.classesElementLookup[classes[i]] || $();\n            if (options.add) {\n              // unique is deprecated in jQuery 3.0.0+ renamed to uniqueSort\n              var jqueryVersion = +$().jquery.split(\".\")[0];\n              if (jqueryVersion >= 3) {\n                current = $(\n                  $.uniqueSort(current.get().concat(options.element.get()))\n                );\n              } else {\n                current = $(\n                  $.unique(current.get().concat(options.element.get()))\n                );\n              }\n            } else {\n              current = $(current.not(options.element).get());\n            }\n            that.classesElementLookup[classes[i]] = current;\n            full.push(classes[i]);\n            if (checkOption && options.classes[classes[i]]) {\n              full.push(options.classes[classes[i]]);\n            }\n          }\n        };\n\n        if (options.keys) {\n          processClassString(options.keys.match(/\\S+/g) || [], true);\n        }\n        if (options.extra) {\n          processClassString(options.extra.match(/\\S+/g) || []);\n        }\n\n        return full.join(\" \");\n      },\n\n      _removeClass: function widget__removeClass(element, keys, extra) {\n        return this._toggleClass(element, keys, extra, false);\n      },\n\n      _addClass: function widget__addClass(element, keys, extra) {\n        return this._toggleClass(element, keys, extra, true);\n      },\n\n      _toggleClass: function widget__toggleClass(element, keys, extra, add) {\n        add = typeof add === \"boolean\" ? add : extra;\n        var shift = typeof element === \"string\" || element === null,\n          options = {\n            extra: shift ? keys : extra,\n            keys: shift ? element : keys,\n            element: shift ? this.element : element,\n            add: add\n          };\n        options.element.toggleClass(this._classes(options), add);\n        return this;\n      },\n\n      _on: function widget__on(suppressDisabledCheck, element, handlers) {\n        var delegateElement,\n          instance = this;\n\n        // no suppressDisabledCheck flag, shuffle arguments\n        if (typeof suppressDisabledCheck !== \"boolean\") {\n          handlers = element;\n          element = suppressDisabledCheck;\n          //suppressDisabledCheck = false;\n        }\n\n        // no element argument, shuffle and use this.element\n        if (!handlers) {\n          handlers = element;\n          element = this.element;\n          delegateElement = this.widget();\n        } else {\n          // accept selectors, DOM elements\n          element = delegateElement = $(element);\n          this.bindings = this.bindings.add(element);\n        }\n\n        $.each(handlers, function widget_iterateHandler(event, handler) {\n          var handlerProxy = function handlerProxy() {\n            // allow widgets to customize the disabled handling\n            // - disabled as an array instead of boolean\n            // - disabled class as method for disabling individual parts\n            return (typeof handler === \"string\"\n              ? instance[handler]\n              : handler\n            ).apply(instance, arguments);\n          };\n\n          // copy the guid so direct unbinding works\n          if (typeof handler !== \"string\") {\n            handlerProxy.guid = handler.guid =\n              handler.guid || handlerProxy.guid || $.guid++;\n          }\n\n          var match = event.match(/^(\\w+)\\s*(.*)$/),\n            eventName = match[1] + instance.eventNamespace,\n            selector = match[2];\n          // delegate is deprecated in jQuery 3.0.0+ in favor of on method\n          var jqueryVersion = +$().jquery.split(\".\")[0];\n          if (selector) {\n            if (jqueryVersion >= 3) {\n              delegateElement.on(eventName, selector, handlerProxy);\n            } else {\n              delegateElement.delegate(selector, eventName, handlerProxy);\n            }\n          } else {\n            // bind is deprecated in jQuery 3.0.0+ in favor of on method\n            if (jqueryVersion >= 3) {\n              element.on(eventName, handlerProxy);\n            } else {\n              element.bind(eventName, handlerProxy);\n            }\n          }\n        });\n      },\n\n      _off: function widget__off(element, eventName) {\n        eventName =\n          (eventName || \"\").split(\" \").join(this.eventNamespace + \" \") +\n          this.eventNamespace;\n        element.unbind(eventName).undelegate(eventName);\n      },\n\n      _delay: function widget__delay(handler, delay) {\n        var handlerProxy = function handlerProxy() {\n          return (typeof handler === \"string\"\n            ? instance[handler]\n            : handler\n          ).apply(instance, arguments);\n        };\n\n        var instance = this;\n        return setTimeout(handlerProxy, delay || 0);\n      },\n\n      _trigger: function widget__trigger(type, event, data) {\n        var prop,\n          orig,\n          callback = this.options[type];\n\n        data = data || {};\n        event = $.Event(event);\n        event.type = this.options.eventPrefix\n          ? this.options.eventPrefix + type\n          : type;\n        event.type = event.type.toLocaleLowerCase();\n        // the original event may come from any element\n        // so we need to reset the target on the new event\n        event.target = this.element[0];\n\n        // copy original event properties over to the new event\n        orig = event.originalEvent;\n        if (orig) {\n          for (prop in orig) {\n            // jshint ignore:line\n            if (!(prop in event)) {\n              //noinspection JSUnfilteredForInLoop\n              event[prop] = orig[prop];\n            }\n          }\n        }\n\n        this.element.trigger(event, data);\n        return !(\n          ($.isFunction(callback) &&\n            callback.apply(this.element[0], [event].concat(data)) === false) ||\n          event.isDefaultPrevented()\n        );\n      }\n    };\n  })(jQuery);\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZjU2MmFiOWYwMjJlZWY5MzU0MmMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvQXBwcy9ET0NVTUVOVC9JSE0vd2lkZ2V0cy93aWRnZXQuanM/YTE1NiJdLCJzb3VyY2VzQ29udGVudCI6WyIvKmdsb2JhbCBkZWZpbmUqL1xuXG4oZnVuY3Rpb24gdW1kUmVxdWlyZShyb290LCBmYWN0b3J5KSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIGlmICh0eXBlb2YgZGVmaW5lID09PSBcImZ1bmN0aW9uXCIgJiYgZGVmaW5lLmFtZCkge1xuICAgIGRlZmluZShbXCJqcXVlcnlcIl0sIGZhY3RvcnkpO1xuICB9IGVsc2Uge1xuICAgIGZhY3Rvcnkod2luZG93LmpRdWVyeSk7XG4gIH1cbn0pKHdpbmRvdywgZnVuY3Rpb24gZG9jdW1lbnRDYXRhbG9nKGpRdWVyeSkge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICB2YXIgRXJyb3JOb1N1Y2hNZXRob2QgPSBmdW5jdGlvbiB3aWRnZXRfRXJyb3JOb1N1Y2hNZXRob2QobWVzc2FnZSkge1xuICAgIHRoaXMubmFtZSA9IFwibm9TdWNoTWV0aG9kRXJyb3JcIjtcbiAgICB0aGlzLm1lc3NhZ2UgPSBtZXNzYWdlIHx8IFwiTm8gc3VjaCBtZXRob2QgZm9yIGN1cnJlbnQgd2lkZ2V0IGluc3RhbmNlXCI7XG4gIH07XG5cbiAgRXJyb3JOb1N1Y2hNZXRob2QucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShFcnJvci5wcm90b3R5cGUpO1xuICBFcnJvck5vU3VjaE1ldGhvZC5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBFcnJvck5vU3VjaE1ldGhvZDtcblxuICAoZnVuY3Rpb24gd2lkZ2V0X2luaXQoJCwgdW5kZWZpbmVkKSB7XG4gICAgdmFyIHdpZGdldFV1aWQgPSAwLFxuICAgICAgc2xpY2UgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UsXG4gICAgICBfY2xlYW5EYXRhID0gJC5jbGVhbkRhdGE7XG4gICAgJC5jbGVhbkRhdGEgPSBmdW5jdGlvbiB3aWRnZXRfY2xlYW5EYXRhKGVsZW1zKSB7XG4gICAgICB2YXIgZXZlbnRzLFxuICAgICAgICBlbGVtID0gbnVsbCxcbiAgICAgICAgaTtcbiAgICAgIGZvciAoaSA9IDAsIGVsZW07IChlbGVtID0gZWxlbXNbaV0pICE9IG51bGw7IGkrKykge1xuICAgICAgICAvLyBqc2hpbnQgaWdub3JlOmxpbmVcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAvLyBPbmx5IHRyaWdnZXIgcmVtb3ZlIHdoZW4gbmVjZXNzYXJ5IHRvIHNhdmUgdGltZVxuICAgICAgICAgIGV2ZW50cyA9ICQuX2RhdGEoZWxlbSwgXCJldmVudHNcIik7XG4gICAgICAgICAgaWYgKGV2ZW50cyAmJiBldmVudHMucmVtb3ZlKSB7XG4gICAgICAgICAgICAkKGVsZW0pLnRyaWdnZXJIYW5kbGVyKFwicmVtb3ZlXCIpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgIC8vbm8gdGVzdCBoZXJlXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIF9jbGVhbkRhdGEoZWxlbXMpO1xuICAgIH07XG5cbiAgICAkLndpZGdldCA9IGZ1bmN0aW9uIHdpZGdldF9pbml0V2lkZ2V0KG5hbWUsIEJhc2UsIHByb3RvdHlwZSkge1xuICAgICAgdmFyIGZ1bGxOYW1lLFxuICAgICAgICBleGlzdGluZ0NvbnN0cnVjdG9yLFxuICAgICAgICBDb25zdHJ1Y3RvcixcbiAgICAgICAgYmFzZVByb3RvdHlwZSxcbiAgICAgICAgLy8gcHJveGllZFByb3RvdHlwZSBhbGxvd3MgdGhlIHByb3ZpZGVkIHByb3RvdHlwZSB0byByZW1haW4gdW5tb2RpZmllZFxuICAgICAgICAvLyBzbyB0aGF0IGl0IGNhbiBiZSB1c2VkIGFzIGEgbWl4aW4gZm9yIG11bHRpcGxlIHdpZGdldHMgKCM4ODc2KVxuICAgICAgICBwcm94aWVkUHJvdG90eXBlID0ge30sXG4gICAgICAgIG5hbWVzcGFjZSA9IG5hbWUuc3BsaXQoXCIuXCIpWzBdO1xuXG4gICAgICBuYW1lID0gbmFtZS5zcGxpdChcIi5cIilbMV07XG4gICAgICBmdWxsTmFtZSA9IG5hbWVzcGFjZSArIFwiLVwiICsgbmFtZTtcblxuICAgICAgaWYgKCFwcm90b3R5cGUpIHtcbiAgICAgICAgcHJvdG90eXBlID0gQmFzZTtcbiAgICAgICAgQmFzZSA9ICQuV2lkZ2V0O1xuICAgICAgfVxuXG4gICAgICBpZiAoJC5pc0FycmF5KHByb3RvdHlwZSkpIHtcbiAgICAgICAgcHJvdG90eXBlID0gJC5leHRlbmQuYXBwbHkobnVsbCwgW3t9XS5jb25jYXQocHJvdG90eXBlKSk7XG4gICAgICB9XG5cbiAgICAgIC8vIGNyZWF0ZSBzZWxlY3RvciBmb3IgcGx1Z2luXG4gICAgICAvLyAkLmV4cHJbIFwiOlwiIF0gaXMgZGVwcmVjYXRlZCB3aXRoIGpRdWVyeSAzLjAuMCsgaW4gZmF2b3Igb2YgJC5leHByLnBzZXVkb3NcbiAgICAgIC8vICQuZXhwclsgXCI6XCIgXVsgZnVsbE5hbWUudG9Mb3dlckNhc2UoKSBdID0gZnVuY3Rpb24gd2lkZ2V0X2NyZWF0ZVNlbGVjdG9yKGVsZW0pIHtcbiAgICAgIC8vICAgICByZXR1cm4gQm9vbGVhbigkKGVsZW0pLmRhdGEoZnVsbE5hbWUpKTtcbiAgICAgIC8vIH07XG4gICAgICAkLmV4cHIucHNldWRvc1tmdWxsTmFtZS50b0xvd2VyQ2FzZSgpXSA9IGZ1bmN0aW9uIHdpZGdldF9jcmVhdGVTZWxlY3RvcihcbiAgICAgICAgZWxlbVxuICAgICAgKSB7XG4gICAgICAgIHJldHVybiBCb29sZWFuKCQoZWxlbSkuZGF0YShmdWxsTmFtZSkpO1xuICAgICAgfTtcblxuICAgICAgJFtuYW1lc3BhY2VdID0gJFtuYW1lc3BhY2VdIHx8IHt9O1xuICAgICAgZXhpc3RpbmdDb25zdHJ1Y3RvciA9ICRbbmFtZXNwYWNlXVtuYW1lXTtcbiAgICAgIENvbnN0cnVjdG9yID0gJFtuYW1lc3BhY2VdW25hbWVdID0gZnVuY3Rpb24gd2lkZ2V0X0NvbnN0cnVjdG9yKFxuICAgICAgICBvcHRpb25zLFxuICAgICAgICBlbGVtZW50XG4gICAgICApIHtcbiAgICAgICAgLy8gYWxsb3cgaW5zdGFudGlhdGlvbiB3aXRob3V0IFwibmV3XCIga2V5d29yZFxuICAgICAgICBpZiAoIXRoaXMuX2NyZWF0ZVdpZGdldCkge1xuICAgICAgICAgIHJldHVybiBuZXcgQ29uc3RydWN0b3Iob3B0aW9ucywgZWxlbWVudCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBhbGxvdyBpbnN0YW50aWF0aW9uIHdpdGhvdXQgaW5pdGlhbGl6aW5nIGZvciBzaW1wbGUgaW5oZXJpdGFuY2VcbiAgICAgICAgLy8gbXVzdCB1c2UgXCJuZXdcIiBrZXl3b3JkICh0aGUgY29kZSBhYm92ZSBhbHdheXMgcGFzc2VzIGFyZ3MpXG4gICAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoKSB7XG4gICAgICAgICAgdGhpcy5fY3JlYXRlV2lkZ2V0KG9wdGlvbnMsIGVsZW1lbnQpO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgLy8gZXh0ZW5kIHdpdGggdGhlIGV4aXN0aW5nIGNvbnN0cnVjdG9yIHRvIGNhcnJ5IG92ZXIgYW55IHN0YXRpYyBwcm9wZXJ0aWVzXG4gICAgICAkLmV4dGVuZChDb25zdHJ1Y3RvciwgZXhpc3RpbmdDb25zdHJ1Y3Rvciwge1xuICAgICAgICB2ZXJzaW9uOiBwcm90b3R5cGUudmVyc2lvbixcbiAgICAgICAgLy8gY29weSB0aGUgb2JqZWN0IHVzZWQgdG8gY3JlYXRlIHRoZSBwcm90b3R5cGUgaW4gY2FzZSB3ZSBuZWVkIHRvXG4gICAgICAgIC8vIHJlZGVmaW5lIHRoZSB3aWRnZXQgbGF0ZXJcbiAgICAgICAgX3Byb3RvOiAkLmV4dGVuZCh7fSwgcHJvdG90eXBlKSxcbiAgICAgICAgLy8gdHJhY2sgd2lkZ2V0cyB0aGF0IGluaGVyaXQgZnJvbSB0aGlzIHdpZGdldCBpbiBjYXNlIHRoaXMgd2lkZ2V0IGlzXG4gICAgICAgIC8vIHJlZGVmaW5lZCBhZnRlciBhIHdpZGdldCBpbmhlcml0cyBmcm9tIGl0XG4gICAgICAgIF9jaGlsZENvbnN0cnVjdG9yczogW11cbiAgICAgIH0pO1xuXG4gICAgICBiYXNlUHJvdG90eXBlID0gbmV3IEJhc2UoKTtcbiAgICAgIC8vIHdlIG5lZWQgdG8gbWFrZSB0aGUgb3B0aW9ucyBoYXNoIGEgcHJvcGVydHkgZGlyZWN0bHkgb24gdGhlIG5ldyBpbnN0YW5jZVxuICAgICAgLy8gb3RoZXJ3aXNlIHdlJ2xsIG1vZGlmeSB0aGUgb3B0aW9ucyBoYXNoIG9uIHRoZSBwcm90b3R5cGUgdGhhdCB3ZSdyZVxuICAgICAgLy8gaW5oZXJpdGluZyBmcm9tXG4gICAgICBiYXNlUHJvdG90eXBlLm9wdGlvbnMgPSAkLndpZGdldC5leHRlbmQoe30sIGJhc2VQcm90b3R5cGUub3B0aW9ucyk7XG4gICAgICAkLmVhY2gocHJvdG90eXBlLCBmdW5jdGlvbiB3aWRnZXRfcHJveGllZEVsZW1lbnRzKHByb3AsIHZhbHVlKSB7XG4gICAgICAgIGlmICghJC5pc0Z1bmN0aW9uKHZhbHVlKSkge1xuICAgICAgICAgIHByb3hpZWRQcm90b3R5cGVbcHJvcF0gPSB2YWx1ZTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgcHJveGllZFByb3RvdHlwZVtwcm9wXSA9IChmdW5jdGlvbiB3aWRnZXRfcHJveGllZFByb3BlcnRpZXMoKSB7XG4gICAgICAgICAgdmFyIF9zdXBlciA9IGZ1bmN0aW9uIHdpZGdldF9zdXBlcigpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIEJhc2UucHJvdG90eXBlW3Byb3BdLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX3N1cGVyQXBwbHkgPSBmdW5jdGlvbiB3aWRnZXRfc3VwZXJBcHBseShhcmdzKSB7XG4gICAgICAgICAgICAgIHJldHVybiBCYXNlLnByb3RvdHlwZVtwcm9wXS5hcHBseSh0aGlzLCBhcmdzKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIHdpZGdldF9wcm94aWVkKCkge1xuICAgICAgICAgICAgdmFyIF9fc3VwZXIgPSB0aGlzLl9zdXBlcixcbiAgICAgICAgICAgICAgX19zdXBlckFwcGx5ID0gdGhpcy5fc3VwZXJBcHBseSxcbiAgICAgICAgICAgICAgcmV0dXJuVmFsdWU7XG5cbiAgICAgICAgICAgIHRoaXMuX3N1cGVyID0gX3N1cGVyO1xuICAgICAgICAgICAgdGhpcy5fc3VwZXJBcHBseSA9IF9zdXBlckFwcGx5O1xuXG4gICAgICAgICAgICByZXR1cm5WYWx1ZSA9IHZhbHVlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG5cbiAgICAgICAgICAgIHRoaXMuX3N1cGVyID0gX19zdXBlcjtcbiAgICAgICAgICAgIHRoaXMuX3N1cGVyQXBwbHkgPSBfX3N1cGVyQXBwbHk7XG5cbiAgICAgICAgICAgIHJldHVybiByZXR1cm5WYWx1ZTtcbiAgICAgICAgICB9O1xuICAgICAgICB9KSgpO1xuICAgICAgfSk7XG4gICAgICBDb25zdHJ1Y3Rvci5wcm90b3R5cGUgPSAkLndpZGdldC5leHRlbmQoXG4gICAgICAgIGJhc2VQcm90b3R5cGUsXG4gICAgICAgIHt9LFxuICAgICAgICBwcm94aWVkUHJvdG90eXBlLFxuICAgICAgICB7XG4gICAgICAgICAgY29uc3RydWN0b3I6IENvbnN0cnVjdG9yLFxuICAgICAgICAgIG5hbWVzcGFjZTogbmFtZXNwYWNlLFxuICAgICAgICAgIHdpZGdldE5hbWU6IG5hbWUsXG4gICAgICAgICAgd2lkZ2V0RnVsbE5hbWU6IGZ1bGxOYW1lXG4gICAgICAgIH1cbiAgICAgICk7XG5cbiAgICAgIC8vIElmIHRoaXMgd2lkZ2V0IGlzIGJlaW5nIHJlZGVmaW5lZCB0aGVuIHdlIG5lZWQgdG8gZmluZCBhbGwgd2lkZ2V0cyB0aGF0XG4gICAgICAvLyBhcmUgaW5oZXJpdGluZyBmcm9tIGl0IGFuZCByZWRlZmluZSBhbGwgb2YgdGhlbSBzbyB0aGF0IHRoZXkgaW5oZXJpdCBmcm9tXG4gICAgICAvLyB0aGUgbmV3IHZlcnNpb24gb2YgdGhpcyB3aWRnZXQuIFdlJ3JlIGVzc2VudGlhbGx5IHRyeWluZyB0byByZXBsYWNlIG9uZVxuICAgICAgLy8gbGV2ZWwgaW4gdGhlIHByb3RvdHlwZSBjaGFpbi5cbiAgICAgIGlmIChleGlzdGluZ0NvbnN0cnVjdG9yKSB7XG4gICAgICAgICQuZWFjaChcbiAgICAgICAgICBleGlzdGluZ0NvbnN0cnVjdG9yLl9jaGlsZENvbnN0cnVjdG9ycyxcbiAgICAgICAgICBmdW5jdGlvbiB3aWRnZXRfZXhpc3RpbmdDb25zdHJ1Y3RvcihpLCBjaGlsZCkge1xuICAgICAgICAgICAgdmFyIGNoaWxkUHJvdG90eXBlID0gY2hpbGQucHJvdG90eXBlO1xuXG4gICAgICAgICAgICAvLyByZWRlZmluZSB0aGUgY2hpbGQgd2lkZ2V0IHVzaW5nIHRoZSBzYW1lIHByb3RvdHlwZSB0aGF0IHdhc1xuICAgICAgICAgICAgLy8gb3JpZ2luYWxseSB1c2VkLCBidXQgaW5oZXJpdCBmcm9tIHRoZSBuZXcgdmVyc2lvbiBvZiB0aGUgYmFzZVxuICAgICAgICAgICAgJC53aWRnZXQoXG4gICAgICAgICAgICAgIGNoaWxkUHJvdG90eXBlLm5hbWVzcGFjZSArIFwiLlwiICsgY2hpbGRQcm90b3R5cGUud2lkZ2V0TmFtZSxcbiAgICAgICAgICAgICAgQ29uc3RydWN0b3IsXG4gICAgICAgICAgICAgIGNoaWxkLl9wcm90b1xuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgICAgIC8vIHJlbW92ZSB0aGUgbGlzdCBvZiBleGlzdGluZyBjaGlsZCBjb25zdHJ1Y3RvcnMgZnJvbSB0aGUgb2xkIGNvbnN0cnVjdG9yXG4gICAgICAgIC8vIHNvIHRoZSBvbGQgY2hpbGQgY29uc3RydWN0b3JzIGNhbiBiZSBnYXJiYWdlIGNvbGxlY3RlZFxuICAgICAgICBkZWxldGUgZXhpc3RpbmdDb25zdHJ1Y3Rvci5fY2hpbGRDb25zdHJ1Y3RvcnM7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBCYXNlLl9jaGlsZENvbnN0cnVjdG9ycy5wdXNoKENvbnN0cnVjdG9yKTtcbiAgICAgIH1cblxuICAgICAgJC53aWRnZXQuYnJpZGdlKG5hbWUsIENvbnN0cnVjdG9yKTtcblxuICAgICAgcmV0dXJuIENvbnN0cnVjdG9yO1xuICAgIH07XG5cbiAgICAkLndpZGdldC5leHRlbmQgPSBmdW5jdGlvbiB3aWRnZXRfZXh0ZW5kKHRhcmdldCkge1xuICAgICAgdmFyIGlucHV0ID0gc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpLFxuICAgICAgICBpbnB1dEluZGV4ID0gMCxcbiAgICAgICAgaW5wdXRMZW5ndGggPSBpbnB1dC5sZW5ndGgsXG4gICAgICAgIGtleSxcbiAgICAgICAgdmFsdWU7XG4gICAgICBmb3IgKDsgaW5wdXRJbmRleCA8IGlucHV0TGVuZ3RoOyBpbnB1dEluZGV4KyspIHtcbiAgICAgICAgZm9yIChrZXkgaW4gaW5wdXRbaW5wdXRJbmRleF0pIHtcbiAgICAgICAgICAvLyBqc2hpbnQgaWdub3JlOmxpbmVcbiAgICAgICAgICAvL25vaW5zcGVjdGlvbiBKU1VuZmlsdGVyZWRGb3JJbkxvb3BcbiAgICAgICAgICB2YWx1ZSA9IGlucHV0W2lucHV0SW5kZXhdW2tleV07XG4gICAgICAgICAgaWYgKGlucHV0W2lucHV0SW5kZXhdLmhhc093blByb3BlcnR5KGtleSkgJiYgdmFsdWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgLy8gQ2xvbmUgb2JqZWN0c1xuICAgICAgICAgICAgaWYgKCQuaXNQbGFpbk9iamVjdCh2YWx1ZSkpIHtcbiAgICAgICAgICAgICAgdGFyZ2V0W2tleV0gPSAkLmlzUGxhaW5PYmplY3QodGFyZ2V0W2tleV0pXG4gICAgICAgICAgICAgICAgPyAkLndpZGdldC5leHRlbmQoe30sIHRhcmdldFtrZXldLCB2YWx1ZSlcbiAgICAgICAgICAgICAgICA6IC8vIERvbid0IGV4dGVuZCBzdHJpbmdzLCBhcnJheXMsIGV0Yy4gd2l0aCBvYmplY3RzXG4gICAgICAgICAgICAgICAgICAkLndpZGdldC5leHRlbmQoe30sIHZhbHVlKTtcbiAgICAgICAgICAgICAgLy8gQ29weSBldmVyeXRoaW5nIGVsc2UgYnkgcmVmZXJlbmNlXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICB0YXJnZXRba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIHRhcmdldDtcbiAgICB9O1xuXG4gICAgJC53aWRnZXQuYnJpZGdlID0gZnVuY3Rpb24gd2lkZ2V0X2JyaWRnZShuYW1lLCBPYmplY3QpIHtcbiAgICAgIHZhciBmdWxsTmFtZSA9IE9iamVjdC5wcm90b3R5cGUud2lkZ2V0RnVsbE5hbWUgfHwgbmFtZTtcbiAgICAgICQuZm5bbmFtZV0gPSBmdW5jdGlvbiB3aWRnZXRfY2FsbEVsZW1lbnQob3B0aW9ucykge1xuICAgICAgICB2YXIgaXNNZXRob2RDYWxsID0gdHlwZW9mIG9wdGlvbnMgPT09IFwic3RyaW5nXCIsXG4gICAgICAgICAgYXJncyA9IHNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSxcbiAgICAgICAgICByZXR1cm5WYWx1ZSA9IHRoaXM7XG5cbiAgICAgICAgLy8gYWxsb3cgbXVsdGlwbGUgaGFzaGVzIHRvIGJlIHBhc3NlZCBvbiBpbml0XG4gICAgICAgIG9wdGlvbnMgPVxuICAgICAgICAgICFpc01ldGhvZENhbGwgJiYgYXJncy5sZW5ndGhcbiAgICAgICAgICAgID8gJC53aWRnZXQuZXh0ZW5kLmFwcGx5KG51bGwsIFtvcHRpb25zXS5jb25jYXQoYXJncykpXG4gICAgICAgICAgICA6IG9wdGlvbnM7XG5cbiAgICAgICAgaWYgKGlzTWV0aG9kQ2FsbCkge1xuICAgICAgICAgIHRoaXMuZWFjaChmdW5jdGlvbiB3aWRnZXRfZWFjaE1ldGhvZENhbGwoKSB7XG4gICAgICAgICAgICB2YXIgbWV0aG9kVmFsdWUsXG4gICAgICAgICAgICAgIGluc3RhbmNlID0gJCh0aGlzKS5kYXRhKGZ1bGxOYW1lKTtcbiAgICAgICAgICAgIGlmIChvcHRpb25zID09PSBcImluc3RhbmNlXCIpIHtcbiAgICAgICAgICAgICAgcmV0dXJuVmFsdWUgPSBpbnN0YW5jZTtcbiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCFpbnN0YW5jZSkge1xuICAgICAgICAgICAgICByZXR1cm4gJC5lcnJvcihcbiAgICAgICAgICAgICAgICBcImNhbm5vdCBjYWxsIG1ldGhvZHMgb24gXCIgK1xuICAgICAgICAgICAgICAgICAgbmFtZSArXG4gICAgICAgICAgICAgICAgICBcIiBwcmlvciB0byBpbml0aWFsaXphdGlvbjsgXCIgK1xuICAgICAgICAgICAgICAgICAgXCJhdHRlbXB0ZWQgdG8gY2FsbCBtZXRob2QgJ1wiICtcbiAgICAgICAgICAgICAgICAgIG9wdGlvbnMgK1xuICAgICAgICAgICAgICAgICAgXCInXCJcbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghJC5pc0Z1bmN0aW9uKGluc3RhbmNlW29wdGlvbnNdKSB8fCBvcHRpb25zLmNoYXJBdCgwKSA9PT0gXCJfXCIpIHtcbiAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yTm9TdWNoTWV0aG9kKFxuICAgICAgICAgICAgICAgIFwibm8gc3VjaCBtZXRob2QgJ1wiICtcbiAgICAgICAgICAgICAgICAgIG9wdGlvbnMgK1xuICAgICAgICAgICAgICAgICAgXCInIGZvciBcIiArXG4gICAgICAgICAgICAgICAgICBuYW1lICtcbiAgICAgICAgICAgICAgICAgIFwiIHdpZGdldCBpbnN0YW5jZVwiXG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBtZXRob2RWYWx1ZSA9IGluc3RhbmNlW29wdGlvbnNdLmFwcGx5KGluc3RhbmNlLCBhcmdzKTtcbiAgICAgICAgICAgIGlmIChtZXRob2RWYWx1ZSAhPT0gaW5zdGFuY2UgJiYgbWV0aG9kVmFsdWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICByZXR1cm5WYWx1ZSA9XG4gICAgICAgICAgICAgICAgbWV0aG9kVmFsdWUgJiYgbWV0aG9kVmFsdWUuanF1ZXJ5XG4gICAgICAgICAgICAgICAgICA/IHJldHVyblZhbHVlLnB1c2hTdGFjayhtZXRob2RWYWx1ZS5nZXQoKSlcbiAgICAgICAgICAgICAgICAgIDogbWV0aG9kVmFsdWU7XG4gICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBBbGxvdyBtdWx0aXBsZSBoYXNoZXMgdG8gYmUgcGFzc2VkIG9uIGluaXRcbiAgICAgICAgICBpZiAoYXJncy5sZW5ndGgpIHtcbiAgICAgICAgICAgIG9wdGlvbnMgPSAkLndpZGdldC5leHRlbmQuYXBwbHkobnVsbCwgW29wdGlvbnNdLmNvbmNhdChhcmdzKSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgdGhpcy5lYWNoKGZ1bmN0aW9uIHdpZGdldF9lYWNoRGF0YUNhbGwoKSB7XG4gICAgICAgICAgICB2YXIgaW5zdGFuY2UgPSAkKHRoaXMpLmRhdGEoZnVsbE5hbWUpO1xuICAgICAgICAgICAgaWYgKGluc3RhbmNlKSB7XG4gICAgICAgICAgICAgIGluc3RhbmNlLm9wdGlvbihvcHRpb25zIHx8IHt9KS5faW5pdCgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgJCh0aGlzKS5kYXRhKGZ1bGxOYW1lLCBuZXcgT2JqZWN0KG9wdGlvbnMsIHRoaXMpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiByZXR1cm5WYWx1ZTtcbiAgICAgIH07XG4gICAgfTtcblxuICAgICQuV2lkZ2V0ID0gZnVuY3Rpb24gd2lkZ2V0X1dpZGdldCgvKiBvcHRpb25zLCBlbGVtZW50ICovKSB7fTtcbiAgICAkLldpZGdldC5fY2hpbGRDb25zdHJ1Y3RvcnMgPSBbXTtcblxuICAgICQuV2lkZ2V0LnByb3RvdHlwZSA9IHtcbiAgICAgIHdpZGdldE5hbWU6IFwid2lkZ2V0XCIsXG4gICAgICBkZWZhdWx0RWxlbWVudDogXCI8ZGl2PlwiLFxuICAgICAgb3B0aW9uczoge1xuICAgICAgICBjbGFzc2VzOiB7fSxcbiAgICAgICAgZGlzYWJsZWQ6IGZhbHNlLFxuICAgICAgICBldmVudFByZWZpeDogbnVsbCxcbiAgICAgICAgLy8gY2FsbGJhY2tzXG4gICAgICAgIGNyZWF0ZTogbnVsbFxuICAgICAgfSxcbiAgICAgIF9jcmVhdGVXaWRnZXQ6IGZ1bmN0aW9uIHdpZGdldF9jcmVhdGVXaWRnZXQob3B0aW9ucywgZWxlbWVudCkge1xuICAgICAgICBlbGVtZW50ID0gJChlbGVtZW50IHx8IHRoaXMuZGVmYXVsdEVsZW1lbnQgfHwgdGhpcylbMF07XG4gICAgICAgIHRoaXMuZWxlbWVudCA9ICQoZWxlbWVudCk7XG4gICAgICAgIHRoaXMudXVpZCA9IHdpZGdldFV1aWQrKztcbiAgICAgICAgdGhpcy5ldmVudE5hbWVzcGFjZSA9IFwiLlwiICsgdGhpcy53aWRnZXROYW1lICsgdGhpcy51dWlkO1xuICAgICAgICB0aGlzLm9wdGlvbnMgPSAkLndpZGdldC5leHRlbmQoXG4gICAgICAgICAge30sXG4gICAgICAgICAgdGhpcy5vcHRpb25zLFxuICAgICAgICAgIHRoaXMuX2dldENyZWF0ZU9wdGlvbnMoKSxcbiAgICAgICAgICBvcHRpb25zXG4gICAgICAgICk7XG5cbiAgICAgICAgdGhpcy5iaW5kaW5ncyA9ICQoKTtcbiAgICAgICAgdGhpcy5jbGFzc2VzRWxlbWVudExvb2t1cCA9IHt9O1xuICAgICAgICBpZiAodGhpcy5vcHRpb25zLmV2ZW50UHJlZml4ID09PSBudWxsKSB7XG4gICAgICAgICAgdGhpcy5vcHRpb25zLmV2ZW50UHJlZml4ID0gdGhpcy53aWRnZXROYW1lO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGVsZW1lbnQgIT09IHRoaXMpIHtcbiAgICAgICAgICAkKGVsZW1lbnQpLmRhdGEodGhpcy53aWRnZXRGdWxsTmFtZSwgdGhpcyk7XG4gICAgICAgICAgdGhpcy5fb24odHJ1ZSwgdGhpcy5lbGVtZW50LCB7XG4gICAgICAgICAgICByZW1vdmU6IGZ1bmN0aW9uIHdpZGdldF9yZW1vdmUoZXZlbnQpIHtcbiAgICAgICAgICAgICAgaWYgKGV2ZW50LnRhcmdldCA9PT0gZWxlbWVudCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZGVzdHJveSgpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgdGhpcy5kb2N1bWVudCA9ICQoXG4gICAgICAgICAgICBlbGVtZW50LnN0eWxlXG4gICAgICAgICAgICAgID8gLy8gZWxlbWVudCB3aXRoaW4gdGhlIGRvY3VtZW50XG4gICAgICAgICAgICAgICAgZWxlbWVudC5vd25lckRvY3VtZW50XG4gICAgICAgICAgICAgIDogLy8gZWxlbWVudCBpcyB3aW5kb3cgb3IgZG9jdW1lbnRcbiAgICAgICAgICAgICAgICBlbGVtZW50LmRvY3VtZW50IHx8IGVsZW1lbnRcbiAgICAgICAgICApO1xuICAgICAgICAgIHRoaXMud2luZG93ID0gJChcbiAgICAgICAgICAgIHRoaXMuZG9jdW1lbnRbMF0uZGVmYXVsdFZpZXcgfHwgdGhpcy5kb2N1bWVudFswXS5wYXJlbnRXaW5kb3dcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMub3B0aW9ucyA9ICQud2lkZ2V0LmV4dGVuZChcbiAgICAgICAgICB7fSxcbiAgICAgICAgICB0aGlzLm9wdGlvbnMsXG4gICAgICAgICAgdGhpcy5fZ2V0Q3JlYXRlT3B0aW9ucygpLFxuICAgICAgICAgIG9wdGlvbnNcbiAgICAgICAgKTtcblxuICAgICAgICB0aGlzLl9jcmVhdGUoKTtcblxuICAgICAgICBpZiAodGhpcy5vcHRpb25zLmRpc2FibGVkKSB7XG4gICAgICAgICAgdGhpcy5fc2V0T3B0aW9uRGlzYWJsZWQodGhpcy5vcHRpb25zLmRpc2FibGVkKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuX3RyaWdnZXIoXCJjcmVhdGVcIiwgbnVsbCwgdGhpcy5fZ2V0Q3JlYXRlRXZlbnREYXRhKCkpO1xuICAgICAgICB0aGlzLl9pbml0KCk7XG4gICAgICB9LFxuICAgICAgX2dldENyZWF0ZU9wdGlvbnM6IGZ1bmN0aW9uIHdpZGdldF9nZXRDcmVhdGVPcHRpb25zKCkge1xuICAgICAgICByZXR1cm4ge307XG4gICAgICB9LFxuICAgICAgX2dldENyZWF0ZUV2ZW50RGF0YTogJC5ub29wLFxuICAgICAgX2NyZWF0ZTogJC5ub29wLFxuICAgICAgX2luaXQ6ICQubm9vcCxcblxuICAgICAgZGVzdHJveTogZnVuY3Rpb24gd2lkZ2V0X2Rlc3Ryb3koKSB7XG4gICAgICAgIHZhciB0aGF0ID0gdGhpcztcblxuICAgICAgICB0aGlzLl9kZXN0cm95KCk7XG4gICAgICAgICQuZWFjaCh0aGlzLmNsYXNzZXNFbGVtZW50TG9va3VwLCBmdW5jdGlvbiB3aWRnZXRfZGVzdHJveUNsYXNzKFxuICAgICAgICAgIGtleSxcbiAgICAgICAgICB2YWx1ZVxuICAgICAgICApIHtcbiAgICAgICAgICB0aGF0Ll9yZW1vdmVDbGFzcyh2YWx1ZSwga2V5KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gV2UgY2FuIHByb2JhYmx5IHJlbW92ZSB0aGUgdW5iaW5kIGNhbGxzIGluIDIuMFxuICAgICAgICAvLyBhbGwgZXZlbnQgYmluZGluZ3Mgc2hvdWxkIGdvIHRocm91Z2ggdGhpcy5fb24oKVxuICAgICAgICB0aGlzLmVsZW1lbnQub2ZmKHRoaXMuZXZlbnROYW1lc3BhY2UpLnJlbW92ZURhdGEodGhpcy53aWRnZXRGdWxsTmFtZSk7XG4gICAgICAgIHRoaXMud2lkZ2V0KClcbiAgICAgICAgICAub2ZmKHRoaXMuZXZlbnROYW1lc3BhY2UpXG4gICAgICAgICAgLnJlbW92ZUF0dHIoXCJhcmlhLWRpc2FibGVkXCIpO1xuXG4gICAgICAgIC8vIENsZWFuIHVwIGV2ZW50cyBhbmQgc3RhdGVzXG4gICAgICAgIHRoaXMuYmluZGluZ3Mub2ZmKHRoaXMuZXZlbnROYW1lc3BhY2UpO1xuICAgICAgfSxcbiAgICAgIF9kZXN0cm95OiAkLm5vb3AsXG5cbiAgICAgIHdpZGdldDogZnVuY3Rpb24gd2lkZ2V0X3dpZGdldCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZWxlbWVudDtcbiAgICAgIH0sXG5cbiAgICAgIG9wdGlvbjogZnVuY3Rpb24gd2lkZ2V0X29wdGlvbihrZXksIHZhbHVlKSB7XG4gICAgICAgIHZhciBvcHRpb25zID0ga2V5LFxuICAgICAgICAgIHBhcnRzLFxuICAgICAgICAgIGN1ck9wdGlvbixcbiAgICAgICAgICBpO1xuXG4gICAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgLy8gZG9uJ3QgcmV0dXJuIGEgcmVmZXJlbmNlIHRvIHRoZSBpbnRlcm5hbCBoYXNoXG4gICAgICAgICAgcmV0dXJuICQud2lkZ2V0LmV4dGVuZCh7fSwgdGhpcy5vcHRpb25zKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0eXBlb2Yga2V5ID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgLy8gaGFuZGxlIG5lc3RlZCBrZXlzLCBlLmcuLCBcImZvby5iYXJcIiA9PiB7IGZvbzogeyBiYXI6IF9fXyB9IH1cbiAgICAgICAgICBvcHRpb25zID0ge307XG4gICAgICAgICAgcGFydHMgPSBrZXkuc3BsaXQoXCIuXCIpO1xuICAgICAgICAgIGtleSA9IHBhcnRzLnNoaWZ0KCk7XG4gICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCkge1xuICAgICAgICAgICAgY3VyT3B0aW9uID0gb3B0aW9uc1trZXldID0gJC53aWRnZXQuZXh0ZW5kKHt9LCB0aGlzLm9wdGlvbnNba2V5XSk7XG4gICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgcGFydHMubGVuZ3RoIC0gMTsgaSsrKSB7XG4gICAgICAgICAgICAgIGN1ck9wdGlvbltwYXJ0c1tpXV0gPSBjdXJPcHRpb25bcGFydHNbaV1dIHx8IHt9O1xuICAgICAgICAgICAgICBjdXJPcHRpb24gPSBjdXJPcHRpb25bcGFydHNbaV1dO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAga2V5ID0gcGFydHMucG9wKCk7XG4gICAgICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgICAgICByZXR1cm4gY3VyT3B0aW9uW2tleV0gPT09IHVuZGVmaW5lZCA/IG51bGwgOiBjdXJPcHRpb25ba2V5XTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGN1ck9wdGlvbltrZXldID0gdmFsdWU7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAxKSB7XG4gICAgICAgICAgICAgIHJldHVybiB0aGlzLm9wdGlvbnNba2V5XSA9PT0gdW5kZWZpbmVkID8gbnVsbCA6IHRoaXMub3B0aW9uc1trZXldO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgb3B0aW9uc1trZXldID0gdmFsdWU7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5fc2V0T3B0aW9ucyhvcHRpb25zKTtcblxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgIH0sXG4gICAgICBfc2V0T3B0aW9uczogZnVuY3Rpb24gd2lkZ2V0X19zZXRPcHRpb25zKG9wdGlvbnMpIHtcbiAgICAgICAgdmFyIGtleTtcblxuICAgICAgICBmb3IgKGtleSBpbiBvcHRpb25zKSB7XG4gICAgICAgICAgLy8ganNoaW50IGlnbm9yZTpsaW5lXG4gICAgICAgICAgLy9ub2luc3BlY3Rpb24gSlNVbmZpbHRlcmVkRm9ySW5Mb29wXG4gICAgICAgICAgdGhpcy5fc2V0T3B0aW9uKGtleSwgb3B0aW9uc1trZXldKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgfSxcbiAgICAgIF9zZXRPcHRpb246IGZ1bmN0aW9uIHdpZGdldF9fc2V0T3B0aW9uKGtleSwgdmFsdWUpIHtcbiAgICAgICAgdGhpcy5vcHRpb25zW2tleV0gPSB2YWx1ZTtcblxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgIH0sXG5cbiAgICAgIF9zZXRPcHRpb25DbGFzc2VzOiBmdW5jdGlvbiB3aWRnZXRfX3NldE9wdGlvbkNsYXNzZXModmFsdWUpIHtcbiAgICAgICAgdmFyIGNsYXNzS2V5LCBlbGVtZW50cywgY3VycmVudEVsZW1lbnRzO1xuXG4gICAgICAgIGZvciAoY2xhc3NLZXkgaW4gdmFsdWUpIHtcbiAgICAgICAgICAvLyBqc2hpbnQgaWdub3JlOmxpbmVcbiAgICAgICAgICAvL25vaW5zcGVjdGlvbiBKU1VuZmlsdGVyZWRGb3JJbkxvb3BcbiAgICAgICAgICBjdXJyZW50RWxlbWVudHMgPSB0aGlzLmNsYXNzZXNFbGVtZW50TG9va3VwW2NsYXNzS2V5XTtcbiAgICAgICAgICAvL25vaW5zcGVjdGlvbiBKU1VuZmlsdGVyZWRGb3JJbkxvb3BcbiAgICAgICAgICBpZiAoXG4gICAgICAgICAgICB2YWx1ZVtjbGFzc0tleV0gPT09IHRoaXMub3B0aW9ucy5jbGFzc2VzW2NsYXNzS2V5XSB8fFxuICAgICAgICAgICAgIWN1cnJlbnRFbGVtZW50cyB8fFxuICAgICAgICAgICAgIWN1cnJlbnRFbGVtZW50cy5sZW5ndGhcbiAgICAgICAgICApIHtcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIFdlIGFyZSBkb2luZyB0aGlzIHRvIGNyZWF0ZSBhIG5ldyBqUXVlcnkgb2JqZWN0IGJlY2F1c2UgdGhlIF9yZW1vdmVDbGFzcygpIGNhbGxcbiAgICAgICAgICAvLyBvbiB0aGUgbmV4dCBsaW5lIGlzIGdvaW5nIHRvIGRlc3Ryb3kgdGhlIHJlZmVyZW5jZSB0byB0aGUgY3VycmVudCBlbGVtZW50cyBiZWluZ1xuICAgICAgICAgIC8vIHRyYWNrZWQuIFdlIG5lZWQgdG8gc2F2ZSBhIGNvcHkgb2YgdGhpcyBjb2xsZWN0aW9uIHNvIHRoYXQgd2UgY2FuIGFkZCB0aGUgbmV3IGNsYXNzZXNcbiAgICAgICAgICAvLyBiZWxvdy5cbiAgICAgICAgICBlbGVtZW50cyA9ICQoY3VycmVudEVsZW1lbnRzLmdldCgpKTtcbiAgICAgICAgICAvL25vaW5zcGVjdGlvbiBKU1VuZmlsdGVyZWRGb3JJbkxvb3BcbiAgICAgICAgICB0aGlzLl9yZW1vdmVDbGFzcyhjdXJyZW50RWxlbWVudHMsIGNsYXNzS2V5KTtcblxuICAgICAgICAgIC8vIFdlIGRvbid0IHVzZSBfYWRkQ2xhc3MoKSBoZXJlLCBiZWNhdXNlIHRoYXQgdXNlcyB0aGlzLm9wdGlvbnMuY2xhc3Nlc1xuICAgICAgICAgIC8vIGZvciBnZW5lcmF0aW5nIHRoZSBzdHJpbmcgb2YgY2xhc3Nlcy4gV2Ugd2FudCB0byB1c2UgdGhlIHZhbHVlIHBhc3NlZCBpbiBmcm9tXG4gICAgICAgICAgLy8gX3NldE9wdGlvbigpLCB0aGlzIGlzIHRoZSBuZXcgdmFsdWUgb2YgdGhlIGNsYXNzZXMgb3B0aW9uIHdoaWNoIHdhcyBwYXNzZWQgdG9cbiAgICAgICAgICAvLyBfc2V0T3B0aW9uKCkuIFdlIHBhc3MgdGhpcyB2YWx1ZSBkaXJlY3RseSB0byBfY2xhc3NlcygpLlxuICAgICAgICAgIC8vbm9pbnNwZWN0aW9uIEpTVW5maWx0ZXJlZEZvckluTG9vcFxuICAgICAgICAgIGVsZW1lbnRzLmFkZENsYXNzKFxuICAgICAgICAgICAgdGhpcy5fY2xhc3Nlcyh7XG4gICAgICAgICAgICAgIGVsZW1lbnQ6IGVsZW1lbnRzLFxuICAgICAgICAgICAgICBrZXlzOiBjbGFzc0tleSxcbiAgICAgICAgICAgICAgY2xhc3NlczogdmFsdWUsXG4gICAgICAgICAgICAgIGFkZDogdHJ1ZVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9LFxuXG4gICAgICBfY2xhc3NlczogZnVuY3Rpb24gd2lkZ2V0X19jbGFzc2VzKG9wdGlvbnMpIHtcbiAgICAgICAgdmFyIGZ1bGwgPSBbXTtcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzLFxuICAgICAgICAgIHByb2Nlc3NDbGFzc1N0cmluZztcblxuICAgICAgICBvcHRpb25zID0gJC5leHRlbmQoXG4gICAgICAgICAge1xuICAgICAgICAgICAgZWxlbWVudDogdGhpcy5lbGVtZW50LFxuICAgICAgICAgICAgY2xhc3NlczogdGhpcy5vcHRpb25zLmNsYXNzZXMgfHwge31cbiAgICAgICAgICB9LFxuICAgICAgICAgIG9wdGlvbnNcbiAgICAgICAgKTtcblxuICAgICAgICBwcm9jZXNzQ2xhc3NTdHJpbmcgPSBmdW5jdGlvbiB3aWRnZXRfcHJvY2Vzc0NsYXNzU3RyaW5nKFxuICAgICAgICAgIGNsYXNzZXMsXG4gICAgICAgICAgY2hlY2tPcHRpb25cbiAgICAgICAgKSB7XG4gICAgICAgICAgdmFyIGN1cnJlbnQsIGk7XG4gICAgICAgICAgZm9yIChpID0gMDsgaSA8IGNsYXNzZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGN1cnJlbnQgPSB0aGF0LmNsYXNzZXNFbGVtZW50TG9va3VwW2NsYXNzZXNbaV1dIHx8ICQoKTtcbiAgICAgICAgICAgIGlmIChvcHRpb25zLmFkZCkge1xuICAgICAgICAgICAgICAvLyB1bmlxdWUgaXMgZGVwcmVjYXRlZCBpbiBqUXVlcnkgMy4wLjArIHJlbmFtZWQgdG8gdW5pcXVlU29ydFxuICAgICAgICAgICAgICB2YXIganF1ZXJ5VmVyc2lvbiA9ICskKCkuanF1ZXJ5LnNwbGl0KFwiLlwiKVswXTtcbiAgICAgICAgICAgICAgaWYgKGpxdWVyeVZlcnNpb24gPj0gMykge1xuICAgICAgICAgICAgICAgIGN1cnJlbnQgPSAkKFxuICAgICAgICAgICAgICAgICAgJC51bmlxdWVTb3J0KGN1cnJlbnQuZ2V0KCkuY29uY2F0KG9wdGlvbnMuZWxlbWVudC5nZXQoKSkpXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjdXJyZW50ID0gJChcbiAgICAgICAgICAgICAgICAgICQudW5pcXVlKGN1cnJlbnQuZ2V0KCkuY29uY2F0KG9wdGlvbnMuZWxlbWVudC5nZXQoKSkpXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgY3VycmVudCA9ICQoY3VycmVudC5ub3Qob3B0aW9ucy5lbGVtZW50KS5nZXQoKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGF0LmNsYXNzZXNFbGVtZW50TG9va3VwW2NsYXNzZXNbaV1dID0gY3VycmVudDtcbiAgICAgICAgICAgIGZ1bGwucHVzaChjbGFzc2VzW2ldKTtcbiAgICAgICAgICAgIGlmIChjaGVja09wdGlvbiAmJiBvcHRpb25zLmNsYXNzZXNbY2xhc3Nlc1tpXV0pIHtcbiAgICAgICAgICAgICAgZnVsbC5wdXNoKG9wdGlvbnMuY2xhc3Nlc1tjbGFzc2VzW2ldXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIGlmIChvcHRpb25zLmtleXMpIHtcbiAgICAgICAgICBwcm9jZXNzQ2xhc3NTdHJpbmcob3B0aW9ucy5rZXlzLm1hdGNoKC9cXFMrL2cpIHx8IFtdLCB0cnVlKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAob3B0aW9ucy5leHRyYSkge1xuICAgICAgICAgIHByb2Nlc3NDbGFzc1N0cmluZyhvcHRpb25zLmV4dHJhLm1hdGNoKC9cXFMrL2cpIHx8IFtdKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBmdWxsLmpvaW4oXCIgXCIpO1xuICAgICAgfSxcblxuICAgICAgX3JlbW92ZUNsYXNzOiBmdW5jdGlvbiB3aWRnZXRfX3JlbW92ZUNsYXNzKGVsZW1lbnQsIGtleXMsIGV4dHJhKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl90b2dnbGVDbGFzcyhlbGVtZW50LCBrZXlzLCBleHRyYSwgZmFsc2UpO1xuICAgICAgfSxcblxuICAgICAgX2FkZENsYXNzOiBmdW5jdGlvbiB3aWRnZXRfX2FkZENsYXNzKGVsZW1lbnQsIGtleXMsIGV4dHJhKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl90b2dnbGVDbGFzcyhlbGVtZW50LCBrZXlzLCBleHRyYSwgdHJ1ZSk7XG4gICAgICB9LFxuXG4gICAgICBfdG9nZ2xlQ2xhc3M6IGZ1bmN0aW9uIHdpZGdldF9fdG9nZ2xlQ2xhc3MoZWxlbWVudCwga2V5cywgZXh0cmEsIGFkZCkge1xuICAgICAgICBhZGQgPSB0eXBlb2YgYWRkID09PSBcImJvb2xlYW5cIiA/IGFkZCA6IGV4dHJhO1xuICAgICAgICB2YXIgc2hpZnQgPSB0eXBlb2YgZWxlbWVudCA9PT0gXCJzdHJpbmdcIiB8fCBlbGVtZW50ID09PSBudWxsLFxuICAgICAgICAgIG9wdGlvbnMgPSB7XG4gICAgICAgICAgICBleHRyYTogc2hpZnQgPyBrZXlzIDogZXh0cmEsXG4gICAgICAgICAgICBrZXlzOiBzaGlmdCA/IGVsZW1lbnQgOiBrZXlzLFxuICAgICAgICAgICAgZWxlbWVudDogc2hpZnQgPyB0aGlzLmVsZW1lbnQgOiBlbGVtZW50LFxuICAgICAgICAgICAgYWRkOiBhZGRcbiAgICAgICAgICB9O1xuICAgICAgICBvcHRpb25zLmVsZW1lbnQudG9nZ2xlQ2xhc3ModGhpcy5fY2xhc3NlcyhvcHRpb25zKSwgYWRkKTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICB9LFxuXG4gICAgICBfb246IGZ1bmN0aW9uIHdpZGdldF9fb24oc3VwcHJlc3NEaXNhYmxlZENoZWNrLCBlbGVtZW50LCBoYW5kbGVycykge1xuICAgICAgICB2YXIgZGVsZWdhdGVFbGVtZW50LFxuICAgICAgICAgIGluc3RhbmNlID0gdGhpcztcblxuICAgICAgICAvLyBubyBzdXBwcmVzc0Rpc2FibGVkQ2hlY2sgZmxhZywgc2h1ZmZsZSBhcmd1bWVudHNcbiAgICAgICAgaWYgKHR5cGVvZiBzdXBwcmVzc0Rpc2FibGVkQ2hlY2sgIT09IFwiYm9vbGVhblwiKSB7XG4gICAgICAgICAgaGFuZGxlcnMgPSBlbGVtZW50O1xuICAgICAgICAgIGVsZW1lbnQgPSBzdXBwcmVzc0Rpc2FibGVkQ2hlY2s7XG4gICAgICAgICAgLy9zdXBwcmVzc0Rpc2FibGVkQ2hlY2sgPSBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIG5vIGVsZW1lbnQgYXJndW1lbnQsIHNodWZmbGUgYW5kIHVzZSB0aGlzLmVsZW1lbnRcbiAgICAgICAgaWYgKCFoYW5kbGVycykge1xuICAgICAgICAgIGhhbmRsZXJzID0gZWxlbWVudDtcbiAgICAgICAgICBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xuICAgICAgICAgIGRlbGVnYXRlRWxlbWVudCA9IHRoaXMud2lkZ2V0KCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gYWNjZXB0IHNlbGVjdG9ycywgRE9NIGVsZW1lbnRzXG4gICAgICAgICAgZWxlbWVudCA9IGRlbGVnYXRlRWxlbWVudCA9ICQoZWxlbWVudCk7XG4gICAgICAgICAgdGhpcy5iaW5kaW5ncyA9IHRoaXMuYmluZGluZ3MuYWRkKGVsZW1lbnQpO1xuICAgICAgICB9XG5cbiAgICAgICAgJC5lYWNoKGhhbmRsZXJzLCBmdW5jdGlvbiB3aWRnZXRfaXRlcmF0ZUhhbmRsZXIoZXZlbnQsIGhhbmRsZXIpIHtcbiAgICAgICAgICB2YXIgaGFuZGxlclByb3h5ID0gZnVuY3Rpb24gaGFuZGxlclByb3h5KCkge1xuICAgICAgICAgICAgLy8gYWxsb3cgd2lkZ2V0cyB0byBjdXN0b21pemUgdGhlIGRpc2FibGVkIGhhbmRsaW5nXG4gICAgICAgICAgICAvLyAtIGRpc2FibGVkIGFzIGFuIGFycmF5IGluc3RlYWQgb2YgYm9vbGVhblxuICAgICAgICAgICAgLy8gLSBkaXNhYmxlZCBjbGFzcyBhcyBtZXRob2QgZm9yIGRpc2FibGluZyBpbmRpdmlkdWFsIHBhcnRzXG4gICAgICAgICAgICByZXR1cm4gKHR5cGVvZiBoYW5kbGVyID09PSBcInN0cmluZ1wiXG4gICAgICAgICAgICAgID8gaW5zdGFuY2VbaGFuZGxlcl1cbiAgICAgICAgICAgICAgOiBoYW5kbGVyXG4gICAgICAgICAgICApLmFwcGx5KGluc3RhbmNlLCBhcmd1bWVudHMpO1xuICAgICAgICAgIH07XG5cbiAgICAgICAgICAvLyBjb3B5IHRoZSBndWlkIHNvIGRpcmVjdCB1bmJpbmRpbmcgd29ya3NcbiAgICAgICAgICBpZiAodHlwZW9mIGhhbmRsZXIgIT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgICAgIGhhbmRsZXJQcm94eS5ndWlkID0gaGFuZGxlci5ndWlkID1cbiAgICAgICAgICAgICAgaGFuZGxlci5ndWlkIHx8IGhhbmRsZXJQcm94eS5ndWlkIHx8ICQuZ3VpZCsrO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHZhciBtYXRjaCA9IGV2ZW50Lm1hdGNoKC9eKFxcdyspXFxzKiguKikkLyksXG4gICAgICAgICAgICBldmVudE5hbWUgPSBtYXRjaFsxXSArIGluc3RhbmNlLmV2ZW50TmFtZXNwYWNlLFxuICAgICAgICAgICAgc2VsZWN0b3IgPSBtYXRjaFsyXTtcbiAgICAgICAgICAvLyBkZWxlZ2F0ZSBpcyBkZXByZWNhdGVkIGluIGpRdWVyeSAzLjAuMCsgaW4gZmF2b3Igb2Ygb24gbWV0aG9kXG4gICAgICAgICAgdmFyIGpxdWVyeVZlcnNpb24gPSArJCgpLmpxdWVyeS5zcGxpdChcIi5cIilbMF07XG4gICAgICAgICAgaWYgKHNlbGVjdG9yKSB7XG4gICAgICAgICAgICBpZiAoanF1ZXJ5VmVyc2lvbiA+PSAzKSB7XG4gICAgICAgICAgICAgIGRlbGVnYXRlRWxlbWVudC5vbihldmVudE5hbWUsIHNlbGVjdG9yLCBoYW5kbGVyUHJveHkpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgZGVsZWdhdGVFbGVtZW50LmRlbGVnYXRlKHNlbGVjdG9yLCBldmVudE5hbWUsIGhhbmRsZXJQcm94eSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIGJpbmQgaXMgZGVwcmVjYXRlZCBpbiBqUXVlcnkgMy4wLjArIGluIGZhdm9yIG9mIG9uIG1ldGhvZFxuICAgICAgICAgICAgaWYgKGpxdWVyeVZlcnNpb24gPj0gMykge1xuICAgICAgICAgICAgICBlbGVtZW50Lm9uKGV2ZW50TmFtZSwgaGFuZGxlclByb3h5KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGVsZW1lbnQuYmluZChldmVudE5hbWUsIGhhbmRsZXJQcm94eSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH0sXG5cbiAgICAgIF9vZmY6IGZ1bmN0aW9uIHdpZGdldF9fb2ZmKGVsZW1lbnQsIGV2ZW50TmFtZSkge1xuICAgICAgICBldmVudE5hbWUgPVxuICAgICAgICAgIChldmVudE5hbWUgfHwgXCJcIikuc3BsaXQoXCIgXCIpLmpvaW4odGhpcy5ldmVudE5hbWVzcGFjZSArIFwiIFwiKSArXG4gICAgICAgICAgdGhpcy5ldmVudE5hbWVzcGFjZTtcbiAgICAgICAgZWxlbWVudC51bmJpbmQoZXZlbnROYW1lKS51bmRlbGVnYXRlKGV2ZW50TmFtZSk7XG4gICAgICB9LFxuXG4gICAgICBfZGVsYXk6IGZ1bmN0aW9uIHdpZGdldF9fZGVsYXkoaGFuZGxlciwgZGVsYXkpIHtcbiAgICAgICAgdmFyIGhhbmRsZXJQcm94eSA9IGZ1bmN0aW9uIGhhbmRsZXJQcm94eSgpIHtcbiAgICAgICAgICByZXR1cm4gKHR5cGVvZiBoYW5kbGVyID09PSBcInN0cmluZ1wiXG4gICAgICAgICAgICA/IGluc3RhbmNlW2hhbmRsZXJdXG4gICAgICAgICAgICA6IGhhbmRsZXJcbiAgICAgICAgICApLmFwcGx5KGluc3RhbmNlLCBhcmd1bWVudHMpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBpbnN0YW5jZSA9IHRoaXM7XG4gICAgICAgIHJldHVybiBzZXRUaW1lb3V0KGhhbmRsZXJQcm94eSwgZGVsYXkgfHwgMCk7XG4gICAgICB9LFxuXG4gICAgICBfdHJpZ2dlcjogZnVuY3Rpb24gd2lkZ2V0X190cmlnZ2VyKHR5cGUsIGV2ZW50LCBkYXRhKSB7XG4gICAgICAgIHZhciBwcm9wLFxuICAgICAgICAgIG9yaWcsXG4gICAgICAgICAgY2FsbGJhY2sgPSB0aGlzLm9wdGlvbnNbdHlwZV07XG5cbiAgICAgICAgZGF0YSA9IGRhdGEgfHwge307XG4gICAgICAgIGV2ZW50ID0gJC5FdmVudChldmVudCk7XG4gICAgICAgIGV2ZW50LnR5cGUgPSB0aGlzLm9wdGlvbnMuZXZlbnRQcmVmaXhcbiAgICAgICAgICA/IHRoaXMub3B0aW9ucy5ldmVudFByZWZpeCArIHR5cGVcbiAgICAgICAgICA6IHR5cGU7XG4gICAgICAgIGV2ZW50LnR5cGUgPSBldmVudC50eXBlLnRvTG9jYWxlTG93ZXJDYXNlKCk7XG4gICAgICAgIC8vIHRoZSBvcmlnaW5hbCBldmVudCBtYXkgY29tZSBmcm9tIGFueSBlbGVtZW50XG4gICAgICAgIC8vIHNvIHdlIG5lZWQgdG8gcmVzZXQgdGhlIHRhcmdldCBvbiB0aGUgbmV3IGV2ZW50XG4gICAgICAgIGV2ZW50LnRhcmdldCA9IHRoaXMuZWxlbWVudFswXTtcblxuICAgICAgICAvLyBjb3B5IG9yaWdpbmFsIGV2ZW50IHByb3BlcnRpZXMgb3ZlciB0byB0aGUgbmV3IGV2ZW50XG4gICAgICAgIG9yaWcgPSBldmVudC5vcmlnaW5hbEV2ZW50O1xuICAgICAgICBpZiAob3JpZykge1xuICAgICAgICAgIGZvciAocHJvcCBpbiBvcmlnKSB7XG4gICAgICAgICAgICAvLyBqc2hpbnQgaWdub3JlOmxpbmVcbiAgICAgICAgICAgIGlmICghKHByb3AgaW4gZXZlbnQpKSB7XG4gICAgICAgICAgICAgIC8vbm9pbnNwZWN0aW9uIEpTVW5maWx0ZXJlZEZvckluTG9vcFxuICAgICAgICAgICAgICBldmVudFtwcm9wXSA9IG9yaWdbcHJvcF07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5lbGVtZW50LnRyaWdnZXIoZXZlbnQsIGRhdGEpO1xuICAgICAgICByZXR1cm4gIShcbiAgICAgICAgICAoJC5pc0Z1bmN0aW9uKGNhbGxiYWNrKSAmJlxuICAgICAgICAgICAgY2FsbGJhY2suYXBwbHkodGhpcy5lbGVtZW50WzBdLCBbZXZlbnRdLmNvbmNhdChkYXRhKSkgPT09IGZhbHNlKSB8fFxuICAgICAgICAgIGV2ZW50LmlzRGVmYXVsdFByZXZlbnRlZCgpXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfTtcbiAgfSkoalF1ZXJ5KTtcbn0pO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUNBLFdBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///f562ab9f022eef93542c\n");

/***/ }),

/***/ "f586cf5b9f4b7719b2c1":
/*!***********************************!*\
  !*** (webpack)/buildin/module.js ***!
  \***********************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("module.exports = function(module) {\n\tif (!module.webpackPolyfill) {\n\t\tmodule.deprecate = function() {};\n\t\tmodule.paths = [];\n\t\t// module.parent = undefined by default\n\t\tif (!module.children) module.children = [];\n\t\tObject.defineProperty(module, \"loaded\", {\n\t\t\tenumerable: true,\n\t\t\tget: function() {\n\t\t\t\treturn module.l;\n\t\t\t}\n\t\t});\n\t\tObject.defineProperty(module, \"id\", {\n\t\t\tenumerable: true,\n\t\t\tget: function() {\n\t\t\t\treturn module.i;\n\t\t\t}\n\t\t});\n\t\tmodule.webpackPolyfill = 1;\n\t}\n\treturn module;\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZjU4NmNmNWI5ZjRiNzcxOWIyYzEuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vKHdlYnBhY2spL2J1aWxkaW4vbW9kdWxlLmpzP2NlZDIiXSwic291cmNlc0NvbnRlbnQiOlsibW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihtb2R1bGUpIHtcblx0aWYgKCFtb2R1bGUud2VicGFja1BvbHlmaWxsKSB7XG5cdFx0bW9kdWxlLmRlcHJlY2F0ZSA9IGZ1bmN0aW9uKCkge307XG5cdFx0bW9kdWxlLnBhdGhzID0gW107XG5cdFx0Ly8gbW9kdWxlLnBhcmVudCA9IHVuZGVmaW5lZCBieSBkZWZhdWx0XG5cdFx0aWYgKCFtb2R1bGUuY2hpbGRyZW4pIG1vZHVsZS5jaGlsZHJlbiA9IFtdO1xuXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShtb2R1bGUsIFwibG9hZGVkXCIsIHtcblx0XHRcdGVudW1lcmFibGU6IHRydWUsXG5cdFx0XHRnZXQ6IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRyZXR1cm4gbW9kdWxlLmw7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG1vZHVsZSwgXCJpZFwiLCB7XG5cdFx0XHRlbnVtZXJhYmxlOiB0cnVlLFxuXHRcdFx0Z2V0OiBmdW5jdGlvbigpIHtcblx0XHRcdFx0cmV0dXJuIG1vZHVsZS5pO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHRcdG1vZHVsZS53ZWJwYWNrUG9seWZpbGwgPSAxO1xuXHR9XG5cdHJldHVybiBtb2R1bGU7XG59O1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///f586cf5b9f4b7719b2c1\n");

/***/ }),

/***/ "f845389cd549ce7299bb":
/*!*************************************************!*\
  !*** ./src/Apps/DOCUMENT/IHM/routers/router.js ***!
  \*************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/*global define*/\n!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(/*! underscore */ \"8e08e542008e4aef1f58\"), __webpack_require__(/*! backbone */ \"1858b45bf48591489d06\")], __WEBPACK_AMD_DEFINE_RESULT__ = (function define_router(_, Backbone) {\n  \"use strict\";\n\n  return Backbone.Router.extend({\n    initialize: function router_initialize(options) {\n      var currentRouter = this;\n      this.useHistory = options.useHistory;\n\n      this.document = options.document;\n\n      //  eslint-disable-next-line no-useless-escape\n      this.route(/api\\/v2\\/documents\\/([^\\/]+)\\.html/, \"viewDocument\");\n      this.route(\n        //  eslint-disable-next-line no-useless-escape\n        /api\\/v2\\/documents\\/(.+)\\/revisions\\/([^\\/]+)\\.html/,\n        \"viewRevision\"\n      );\n      //  eslint-disable-next-line no-useless-escape\n      this.route(/api\\/v2\\/documents\\/(.+)\\/views\\/([^\\/]+)\\.html/, \"viewView\");\n      this.route(\n        //  eslint-disable-next-line no-useless-escape\n        /api\\/v2\\/documents\\/(.+)\\/revisions\\/([^\\/]+)\\/views\\/([^\\/]+)\\.html/,\n        \"viewRevisionView\"\n      );\n\n      this.route(/[^?]*\\?app=DOCUMENT([^#]+)/, \"fetch\");\n\n      // Listen to document sync and update url\n      this.document.listenTo(this.document, \"sync\", function sync() {\n        var searchArguments;\n\n        var viewId = currentRouter.document.get(\"viewId\"),\n          options = {\n            path: window.location.pathname,\n            initid: currentRouter.document.get(\"initid\"),\n            revision:\n              currentRouter.document.get(\"revision\") >= 0\n                ? currentRouter.document.get(\"revision\")\n                : undefined,\n            viewId: undefined\n          };\n        var docProperties = currentRouter.document.getServerProperties();\n\n        if (!options.initid) {\n          if (docProperties.renderMode === \"edit\") {\n            options.initid = docProperties.family.name;\n          }\n        }\n        options.viewId = viewId;\n        if (docProperties && docProperties.status === \"alive\") {\n          // No write revision if not a fixed one\n          options.revision = -1;\n        }\n\n        searchArguments = currentRouter.getUrlParameters(\n          window.location.search\n        );\n        if (searchArguments.app) {\n          // old school url\n          currentRouter.rewriteAppUrl(searchArguments, options);\n        } else {\n          // api url\n          currentRouter.rewriteApiUrl(options);\n        }\n      });\n    },\n\n    /**\n     * Rewrite access document render HTML page from url like ?app=DOCUMENT&initid=1456&revision=45\n     * @param searchArguments\n     * @param options\n     */\n    rewriteAppUrl: function router_rewriteAppUrl(searchArguments, options) {\n      var searchPart,\n        urlSecondPart = \"\",\n        newUrl;\n      if (searchArguments.app) {\n        if (options.initid) {\n          // Extract all GET parameters and rewrite if needed\n          _.each(searchArguments, function routerGetUrl(getParameter, getKey) {\n            if (\n              [\"id\", \"initid\", \"app\", \"viewId\", \"revision\"].indexOf(getKey) >= 0\n            ) {\n              searchArguments[getKey] = null;\n            }\n          });\n\n          searchPart = _.compact(\n            _.map(searchArguments, function router_composeSearchLocation(\n              GETValue,\n              GETKey\n            ) {\n              if (GETValue === null) {\n                return null;\n              }\n              return GETKey + \"=\" + encodeURIComponent(GETValue);\n            })\n          );\n\n          if (options.viewId !== \"!defaultConsultation\") {\n            urlSecondPart = \"/views/\" + encodeURIComponent(options.viewId);\n            if (options.revision >= 0) {\n              urlSecondPart +=\n                \"/revisions/\" + encodeURIComponent(options.revision);\n            }\n          } else {\n            if (options.revision >= 0) {\n              urlSecondPart =\n                \"/revisions/\" + encodeURIComponent(options.revision);\n            }\n          }\n          newUrl =\n            window.location.pathname +\n            \"api/v2/documents/\" +\n            options.initid +\n            urlSecondPart +\n            \".html\";\n          if (searchPart.length > 0) {\n            newUrl += \"?\" + searchPart.join(\"&\");\n          }\n          newUrl += window.location.hash;\n          this.navigate(newUrl, { replace: !this.useHistory });\n        }\n      }\n    },\n\n    /**\n     * Rewrite URL if mismatches detected between server information and url access\n     * @param options\n     */\n    rewriteApiUrl: function router_rewriteApiUrl(options) {\n      var parsePath = false,\n        parseHash = false,\n        beginPath = \"\",\n        urlSecondPart = \"\",\n        locationSearch = window.location.search,\n        locationHash = window.location.hash;\n      var noRecordHistory;\n      if (options.initid) {\n        parsePath = window.location.pathname.match(\n          \"(.*)api\\\\/v2\\\\/documents\\\\/(.*)\"\n        );\n        if (parsePath) {\n          beginPath = parsePath[1];\n\n          if (options.viewId !== \"!defaultConsultation\") {\n            urlSecondPart = \"/views/\" + encodeURIComponent(options.viewId);\n            if (options.revision >= 0) {\n              urlSecondPart +=\n                \"/revisions/\" + encodeURIComponent(options.revision);\n            }\n          } else {\n            if (options.revision >= 0) {\n              urlSecondPart =\n                \"/revisions/\" + encodeURIComponent(options.revision);\n            }\n          }\n\n          noRecordHistory = /documents\\/0\\.html$/.test(options.path);\n\n          parseHash = /#widgetValue{(.*)}/.exec(locationHash);\n          if (parseHash) {\n            try {\n              var hashData = JSON.parse(\"{\" + parseHash[1] + \"}\");\n\n              delete hashData.viewId;\n              delete hashData.initid;\n              delete hashData.revision;\n\n              if (hashData.customClientData) {\n                locationSearch += locationSearch ? \"&\" : \"?\";\n                locationSearch += \"customClientData=\";\n                locationSearch += encodeURIComponent(\n                  JSON.stringify(hashData.customClientData)\n                );\n                delete hashData.customClientData;\n              }\n              if (noRecordHistory) {\n                locationHash = \"\";\n              } else {\n                locationHash = \"#widgetValue\" + JSON.stringify(hashData);\n              }\n            } catch (e) {\n              //no test here\n            }\n          }\n\n          if (!this.useHistory) {\n            noRecordHistory = true;\n          }\n\n          this.navigate(\n            beginPath +\n              \"api/v2/documents/\" +\n              options.initid +\n              urlSecondPart +\n              \".html\" +\n              locationSearch +\n              locationHash,\n            { replace: noRecordHistory }\n          );\n        }\n      }\n    },\n    viewDocument: function router_viewDocument(initid) {\n      this.document.fetchDocument({ initid: initid });\n    },\n    viewRevision: function router_viewRevision(initid, revision) {\n      this.document.fetchDocument({\n        initid: initid,\n        revision: revision\n      });\n    },\n\n    viewView: function router_viewView(initid, viewId) {\n      this.document.fetchDocument({\n        initid: initid,\n        viewId: viewId\n      });\n    },\n\n    viewRevisionView: function router_viewRevisionView(\n      initid,\n      revision,\n      viewId\n    ) {\n      this.document.fetchDocument({\n        initid: initid,\n        revision: revision,\n        viewId: viewId\n      });\n    },\n    fetch: function router_fetch(searchPart) {\n      var searchObject,\n        newValues = {};\n      searchObject = this.getUrlParameters(searchPart);\n\n      if (!_.isUndefined(searchObject.id)) {\n        newValues.initid = searchObject.id;\n      }\n      if (!_.isUndefined(searchObject.initid)) {\n        newValues.initid = searchObject.initid;\n      }\n      if (!_.isUndefined(searchObject.revision)) {\n        newValues.revision = parseInt(searchObject.revision, 10);\n      } else {\n        newValues.revision = -1;\n      }\n      if (!_.isUndefined(searchObject.viewId)) {\n        newValues.viewId = searchObject.viewId;\n      } else {\n        newValues.viewId = undefined;\n      }\n      this.document.fetchDocument(newValues);\n    },\n\n    /**\n     * extract url parameters and return an simple object indexed by parameters keys\n     * @param searchPart\n     * @returns {{}}\n     */\n    getUrlParameters: function router_getUrlParameters(searchPart) {\n      var extract,\n        getParameters,\n        result = {};\n\n      if (searchPart) {\n        getParameters = searchPart.substr(1).split(\"&\");\n        for (var i = 0; i < getParameters.length; i++) {\n          extract = getParameters[i].match(/^([^=]+)=(.*)$/);\n          if (extract) {\n            result[extract[1]] = decodeURIComponent(extract[2]);\n          } else {\n            result[getParameters[i]] = \"\";\n          }\n        }\n      }\n      return result;\n    }\n  });\n}).apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZjg0NTM4OWNkNTQ5Y2U3Mjk5YmIuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvQXBwcy9ET0NVTUVOVC9JSE0vcm91dGVycy9yb3V0ZXIuanM/NzE4OSJdLCJzb3VyY2VzQ29udGVudCI6WyIvKmdsb2JhbCBkZWZpbmUqL1xuZGVmaW5lKFtcInVuZGVyc2NvcmVcIiwgXCJiYWNrYm9uZVwiXSwgZnVuY3Rpb24gZGVmaW5lX3JvdXRlcihfLCBCYWNrYm9uZSkge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICByZXR1cm4gQmFja2JvbmUuUm91dGVyLmV4dGVuZCh7XG4gICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gcm91dGVyX2luaXRpYWxpemUob3B0aW9ucykge1xuICAgICAgdmFyIGN1cnJlbnRSb3V0ZXIgPSB0aGlzO1xuICAgICAgdGhpcy51c2VIaXN0b3J5ID0gb3B0aW9ucy51c2VIaXN0b3J5O1xuXG4gICAgICB0aGlzLmRvY3VtZW50ID0gb3B0aW9ucy5kb2N1bWVudDtcblxuICAgICAgLy8gIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby11c2VsZXNzLWVzY2FwZVxuICAgICAgdGhpcy5yb3V0ZSgvYXBpXFwvdjJcXC9kb2N1bWVudHNcXC8oW15cXC9dKylcXC5odG1sLywgXCJ2aWV3RG9jdW1lbnRcIik7XG4gICAgICB0aGlzLnJvdXRlKFxuICAgICAgICAvLyAgZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXVzZWxlc3MtZXNjYXBlXG4gICAgICAgIC9hcGlcXC92MlxcL2RvY3VtZW50c1xcLyguKylcXC9yZXZpc2lvbnNcXC8oW15cXC9dKylcXC5odG1sLyxcbiAgICAgICAgXCJ2aWV3UmV2aXNpb25cIlxuICAgICAgKTtcbiAgICAgIC8vICBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdXNlbGVzcy1lc2NhcGVcbiAgICAgIHRoaXMucm91dGUoL2FwaVxcL3YyXFwvZG9jdW1lbnRzXFwvKC4rKVxcL3ZpZXdzXFwvKFteXFwvXSspXFwuaHRtbC8sIFwidmlld1ZpZXdcIik7XG4gICAgICB0aGlzLnJvdXRlKFxuICAgICAgICAvLyAgZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXVzZWxlc3MtZXNjYXBlXG4gICAgICAgIC9hcGlcXC92MlxcL2RvY3VtZW50c1xcLyguKylcXC9yZXZpc2lvbnNcXC8oW15cXC9dKylcXC92aWV3c1xcLyhbXlxcL10rKVxcLmh0bWwvLFxuICAgICAgICBcInZpZXdSZXZpc2lvblZpZXdcIlxuICAgICAgKTtcblxuICAgICAgdGhpcy5yb3V0ZSgvW14/XSpcXD9hcHA9RE9DVU1FTlQoW14jXSspLywgXCJmZXRjaFwiKTtcblxuICAgICAgLy8gTGlzdGVuIHRvIGRvY3VtZW50IHN5bmMgYW5kIHVwZGF0ZSB1cmxcbiAgICAgIHRoaXMuZG9jdW1lbnQubGlzdGVuVG8odGhpcy5kb2N1bWVudCwgXCJzeW5jXCIsIGZ1bmN0aW9uIHN5bmMoKSB7XG4gICAgICAgIHZhciBzZWFyY2hBcmd1bWVudHM7XG5cbiAgICAgICAgdmFyIHZpZXdJZCA9IGN1cnJlbnRSb3V0ZXIuZG9jdW1lbnQuZ2V0KFwidmlld0lkXCIpLFxuICAgICAgICAgIG9wdGlvbnMgPSB7XG4gICAgICAgICAgICBwYXRoOiB3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUsXG4gICAgICAgICAgICBpbml0aWQ6IGN1cnJlbnRSb3V0ZXIuZG9jdW1lbnQuZ2V0KFwiaW5pdGlkXCIpLFxuICAgICAgICAgICAgcmV2aXNpb246XG4gICAgICAgICAgICAgIGN1cnJlbnRSb3V0ZXIuZG9jdW1lbnQuZ2V0KFwicmV2aXNpb25cIikgPj0gMFxuICAgICAgICAgICAgICAgID8gY3VycmVudFJvdXRlci5kb2N1bWVudC5nZXQoXCJyZXZpc2lvblwiKVxuICAgICAgICAgICAgICAgIDogdW5kZWZpbmVkLFxuICAgICAgICAgICAgdmlld0lkOiB1bmRlZmluZWRcbiAgICAgICAgICB9O1xuICAgICAgICB2YXIgZG9jUHJvcGVydGllcyA9IGN1cnJlbnRSb3V0ZXIuZG9jdW1lbnQuZ2V0U2VydmVyUHJvcGVydGllcygpO1xuXG4gICAgICAgIGlmICghb3B0aW9ucy5pbml0aWQpIHtcbiAgICAgICAgICBpZiAoZG9jUHJvcGVydGllcy5yZW5kZXJNb2RlID09PSBcImVkaXRcIikge1xuICAgICAgICAgICAgb3B0aW9ucy5pbml0aWQgPSBkb2NQcm9wZXJ0aWVzLmZhbWlseS5uYW1lO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBvcHRpb25zLnZpZXdJZCA9IHZpZXdJZDtcbiAgICAgICAgaWYgKGRvY1Byb3BlcnRpZXMgJiYgZG9jUHJvcGVydGllcy5zdGF0dXMgPT09IFwiYWxpdmVcIikge1xuICAgICAgICAgIC8vIE5vIHdyaXRlIHJldmlzaW9uIGlmIG5vdCBhIGZpeGVkIG9uZVxuICAgICAgICAgIG9wdGlvbnMucmV2aXNpb24gPSAtMTtcbiAgICAgICAgfVxuXG4gICAgICAgIHNlYXJjaEFyZ3VtZW50cyA9IGN1cnJlbnRSb3V0ZXIuZ2V0VXJsUGFyYW1ldGVycyhcbiAgICAgICAgICB3aW5kb3cubG9jYXRpb24uc2VhcmNoXG4gICAgICAgICk7XG4gICAgICAgIGlmIChzZWFyY2hBcmd1bWVudHMuYXBwKSB7XG4gICAgICAgICAgLy8gb2xkIHNjaG9vbCB1cmxcbiAgICAgICAgICBjdXJyZW50Um91dGVyLnJld3JpdGVBcHBVcmwoc2VhcmNoQXJndW1lbnRzLCBvcHRpb25zKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBhcGkgdXJsXG4gICAgICAgICAgY3VycmVudFJvdXRlci5yZXdyaXRlQXBpVXJsKG9wdGlvbnMpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogUmV3cml0ZSBhY2Nlc3MgZG9jdW1lbnQgcmVuZGVyIEhUTUwgcGFnZSBmcm9tIHVybCBsaWtlID9hcHA9RE9DVU1FTlQmaW5pdGlkPTE0NTYmcmV2aXNpb249NDVcbiAgICAgKiBAcGFyYW0gc2VhcmNoQXJndW1lbnRzXG4gICAgICogQHBhcmFtIG9wdGlvbnNcbiAgICAgKi9cbiAgICByZXdyaXRlQXBwVXJsOiBmdW5jdGlvbiByb3V0ZXJfcmV3cml0ZUFwcFVybChzZWFyY2hBcmd1bWVudHMsIG9wdGlvbnMpIHtcbiAgICAgIHZhciBzZWFyY2hQYXJ0LFxuICAgICAgICB1cmxTZWNvbmRQYXJ0ID0gXCJcIixcbiAgICAgICAgbmV3VXJsO1xuICAgICAgaWYgKHNlYXJjaEFyZ3VtZW50cy5hcHApIHtcbiAgICAgICAgaWYgKG9wdGlvbnMuaW5pdGlkKSB7XG4gICAgICAgICAgLy8gRXh0cmFjdCBhbGwgR0VUIHBhcmFtZXRlcnMgYW5kIHJld3JpdGUgaWYgbmVlZGVkXG4gICAgICAgICAgXy5lYWNoKHNlYXJjaEFyZ3VtZW50cywgZnVuY3Rpb24gcm91dGVyR2V0VXJsKGdldFBhcmFtZXRlciwgZ2V0S2V5KSB7XG4gICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgIFtcImlkXCIsIFwiaW5pdGlkXCIsIFwiYXBwXCIsIFwidmlld0lkXCIsIFwicmV2aXNpb25cIl0uaW5kZXhPZihnZXRLZXkpID49IDBcbiAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICBzZWFyY2hBcmd1bWVudHNbZ2V0S2V5XSA9IG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICBzZWFyY2hQYXJ0ID0gXy5jb21wYWN0KFxuICAgICAgICAgICAgXy5tYXAoc2VhcmNoQXJndW1lbnRzLCBmdW5jdGlvbiByb3V0ZXJfY29tcG9zZVNlYXJjaExvY2F0aW9uKFxuICAgICAgICAgICAgICBHRVRWYWx1ZSxcbiAgICAgICAgICAgICAgR0VUS2V5XG4gICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgaWYgKEdFVFZhbHVlID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgcmV0dXJuIEdFVEtleSArIFwiPVwiICsgZW5jb2RlVVJJQ29tcG9uZW50KEdFVFZhbHVlKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgKTtcblxuICAgICAgICAgIGlmIChvcHRpb25zLnZpZXdJZCAhPT0gXCIhZGVmYXVsdENvbnN1bHRhdGlvblwiKSB7XG4gICAgICAgICAgICB1cmxTZWNvbmRQYXJ0ID0gXCIvdmlld3MvXCIgKyBlbmNvZGVVUklDb21wb25lbnQob3B0aW9ucy52aWV3SWQpO1xuICAgICAgICAgICAgaWYgKG9wdGlvbnMucmV2aXNpb24gPj0gMCkge1xuICAgICAgICAgICAgICB1cmxTZWNvbmRQYXJ0ICs9XG4gICAgICAgICAgICAgICAgXCIvcmV2aXNpb25zL1wiICsgZW5jb2RlVVJJQ29tcG9uZW50KG9wdGlvbnMucmV2aXNpb24pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAob3B0aW9ucy5yZXZpc2lvbiA+PSAwKSB7XG4gICAgICAgICAgICAgIHVybFNlY29uZFBhcnQgPVxuICAgICAgICAgICAgICAgIFwiL3JldmlzaW9ucy9cIiArIGVuY29kZVVSSUNvbXBvbmVudChvcHRpb25zLnJldmlzaW9uKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgbmV3VXJsID1cbiAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZSArXG4gICAgICAgICAgICBcImFwaS92Mi9kb2N1bWVudHMvXCIgK1xuICAgICAgICAgICAgb3B0aW9ucy5pbml0aWQgK1xuICAgICAgICAgICAgdXJsU2Vjb25kUGFydCArXG4gICAgICAgICAgICBcIi5odG1sXCI7XG4gICAgICAgICAgaWYgKHNlYXJjaFBhcnQubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgbmV3VXJsICs9IFwiP1wiICsgc2VhcmNoUGFydC5qb2luKFwiJlwiKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgbmV3VXJsICs9IHdpbmRvdy5sb2NhdGlvbi5oYXNoO1xuICAgICAgICAgIHRoaXMubmF2aWdhdGUobmV3VXJsLCB7IHJlcGxhY2U6ICF0aGlzLnVzZUhpc3RvcnkgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogUmV3cml0ZSBVUkwgaWYgbWlzbWF0Y2hlcyBkZXRlY3RlZCBiZXR3ZWVuIHNlcnZlciBpbmZvcm1hdGlvbiBhbmQgdXJsIGFjY2Vzc1xuICAgICAqIEBwYXJhbSBvcHRpb25zXG4gICAgICovXG4gICAgcmV3cml0ZUFwaVVybDogZnVuY3Rpb24gcm91dGVyX3Jld3JpdGVBcGlVcmwob3B0aW9ucykge1xuICAgICAgdmFyIHBhcnNlUGF0aCA9IGZhbHNlLFxuICAgICAgICBwYXJzZUhhc2ggPSBmYWxzZSxcbiAgICAgICAgYmVnaW5QYXRoID0gXCJcIixcbiAgICAgICAgdXJsU2Vjb25kUGFydCA9IFwiXCIsXG4gICAgICAgIGxvY2F0aW9uU2VhcmNoID0gd2luZG93LmxvY2F0aW9uLnNlYXJjaCxcbiAgICAgICAgbG9jYXRpb25IYXNoID0gd2luZG93LmxvY2F0aW9uLmhhc2g7XG4gICAgICB2YXIgbm9SZWNvcmRIaXN0b3J5O1xuICAgICAgaWYgKG9wdGlvbnMuaW5pdGlkKSB7XG4gICAgICAgIHBhcnNlUGF0aCA9IHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZS5tYXRjaChcbiAgICAgICAgICBcIiguKilhcGlcXFxcL3YyXFxcXC9kb2N1bWVudHNcXFxcLyguKilcIlxuICAgICAgICApO1xuICAgICAgICBpZiAocGFyc2VQYXRoKSB7XG4gICAgICAgICAgYmVnaW5QYXRoID0gcGFyc2VQYXRoWzFdO1xuXG4gICAgICAgICAgaWYgKG9wdGlvbnMudmlld0lkICE9PSBcIiFkZWZhdWx0Q29uc3VsdGF0aW9uXCIpIHtcbiAgICAgICAgICAgIHVybFNlY29uZFBhcnQgPSBcIi92aWV3cy9cIiArIGVuY29kZVVSSUNvbXBvbmVudChvcHRpb25zLnZpZXdJZCk7XG4gICAgICAgICAgICBpZiAob3B0aW9ucy5yZXZpc2lvbiA+PSAwKSB7XG4gICAgICAgICAgICAgIHVybFNlY29uZFBhcnQgKz1cbiAgICAgICAgICAgICAgICBcIi9yZXZpc2lvbnMvXCIgKyBlbmNvZGVVUklDb21wb25lbnQob3B0aW9ucy5yZXZpc2lvbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmIChvcHRpb25zLnJldmlzaW9uID49IDApIHtcbiAgICAgICAgICAgICAgdXJsU2Vjb25kUGFydCA9XG4gICAgICAgICAgICAgICAgXCIvcmV2aXNpb25zL1wiICsgZW5jb2RlVVJJQ29tcG9uZW50KG9wdGlvbnMucmV2aXNpb24pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cblxuICAgICAgICAgIG5vUmVjb3JkSGlzdG9yeSA9IC9kb2N1bWVudHNcXC8wXFwuaHRtbCQvLnRlc3Qob3B0aW9ucy5wYXRoKTtcblxuICAgICAgICAgIHBhcnNlSGFzaCA9IC8jd2lkZ2V0VmFsdWV7KC4qKX0vLmV4ZWMobG9jYXRpb25IYXNoKTtcbiAgICAgICAgICBpZiAocGFyc2VIYXNoKSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICB2YXIgaGFzaERhdGEgPSBKU09OLnBhcnNlKFwie1wiICsgcGFyc2VIYXNoWzFdICsgXCJ9XCIpO1xuXG4gICAgICAgICAgICAgIGRlbGV0ZSBoYXNoRGF0YS52aWV3SWQ7XG4gICAgICAgICAgICAgIGRlbGV0ZSBoYXNoRGF0YS5pbml0aWQ7XG4gICAgICAgICAgICAgIGRlbGV0ZSBoYXNoRGF0YS5yZXZpc2lvbjtcblxuICAgICAgICAgICAgICBpZiAoaGFzaERhdGEuY3VzdG9tQ2xpZW50RGF0YSkge1xuICAgICAgICAgICAgICAgIGxvY2F0aW9uU2VhcmNoICs9IGxvY2F0aW9uU2VhcmNoID8gXCImXCIgOiBcIj9cIjtcbiAgICAgICAgICAgICAgICBsb2NhdGlvblNlYXJjaCArPSBcImN1c3RvbUNsaWVudERhdGE9XCI7XG4gICAgICAgICAgICAgICAgbG9jYXRpb25TZWFyY2ggKz0gZW5jb2RlVVJJQ29tcG9uZW50KFxuICAgICAgICAgICAgICAgICAgSlNPTi5zdHJpbmdpZnkoaGFzaERhdGEuY3VzdG9tQ2xpZW50RGF0YSlcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIGRlbGV0ZSBoYXNoRGF0YS5jdXN0b21DbGllbnREYXRhO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGlmIChub1JlY29yZEhpc3RvcnkpIHtcbiAgICAgICAgICAgICAgICBsb2NhdGlvbkhhc2ggPSBcIlwiO1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGxvY2F0aW9uSGFzaCA9IFwiI3dpZGdldFZhbHVlXCIgKyBKU09OLnN0cmluZ2lmeShoYXNoRGF0YSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgLy9ubyB0ZXN0IGhlcmVcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpZiAoIXRoaXMudXNlSGlzdG9yeSkge1xuICAgICAgICAgICAgbm9SZWNvcmRIaXN0b3J5ID0gdHJ1ZTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICB0aGlzLm5hdmlnYXRlKFxuICAgICAgICAgICAgYmVnaW5QYXRoICtcbiAgICAgICAgICAgICAgXCJhcGkvdjIvZG9jdW1lbnRzL1wiICtcbiAgICAgICAgICAgICAgb3B0aW9ucy5pbml0aWQgK1xuICAgICAgICAgICAgICB1cmxTZWNvbmRQYXJ0ICtcbiAgICAgICAgICAgICAgXCIuaHRtbFwiICtcbiAgICAgICAgICAgICAgbG9jYXRpb25TZWFyY2ggK1xuICAgICAgICAgICAgICBsb2NhdGlvbkhhc2gsXG4gICAgICAgICAgICB7IHJlcGxhY2U6IG5vUmVjb3JkSGlzdG9yeSB9XG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sXG4gICAgdmlld0RvY3VtZW50OiBmdW5jdGlvbiByb3V0ZXJfdmlld0RvY3VtZW50KGluaXRpZCkge1xuICAgICAgdGhpcy5kb2N1bWVudC5mZXRjaERvY3VtZW50KHsgaW5pdGlkOiBpbml0aWQgfSk7XG4gICAgfSxcbiAgICB2aWV3UmV2aXNpb246IGZ1bmN0aW9uIHJvdXRlcl92aWV3UmV2aXNpb24oaW5pdGlkLCByZXZpc2lvbikge1xuICAgICAgdGhpcy5kb2N1bWVudC5mZXRjaERvY3VtZW50KHtcbiAgICAgICAgaW5pdGlkOiBpbml0aWQsXG4gICAgICAgIHJldmlzaW9uOiByZXZpc2lvblxuICAgICAgfSk7XG4gICAgfSxcblxuICAgIHZpZXdWaWV3OiBmdW5jdGlvbiByb3V0ZXJfdmlld1ZpZXcoaW5pdGlkLCB2aWV3SWQpIHtcbiAgICAgIHRoaXMuZG9jdW1lbnQuZmV0Y2hEb2N1bWVudCh7XG4gICAgICAgIGluaXRpZDogaW5pdGlkLFxuICAgICAgICB2aWV3SWQ6IHZpZXdJZFxuICAgICAgfSk7XG4gICAgfSxcblxuICAgIHZpZXdSZXZpc2lvblZpZXc6IGZ1bmN0aW9uIHJvdXRlcl92aWV3UmV2aXNpb25WaWV3KFxuICAgICAgaW5pdGlkLFxuICAgICAgcmV2aXNpb24sXG4gICAgICB2aWV3SWRcbiAgICApIHtcbiAgICAgIHRoaXMuZG9jdW1lbnQuZmV0Y2hEb2N1bWVudCh7XG4gICAgICAgIGluaXRpZDogaW5pdGlkLFxuICAgICAgICByZXZpc2lvbjogcmV2aXNpb24sXG4gICAgICAgIHZpZXdJZDogdmlld0lkXG4gICAgICB9KTtcbiAgICB9LFxuICAgIGZldGNoOiBmdW5jdGlvbiByb3V0ZXJfZmV0Y2goc2VhcmNoUGFydCkge1xuICAgICAgdmFyIHNlYXJjaE9iamVjdCxcbiAgICAgICAgbmV3VmFsdWVzID0ge307XG4gICAgICBzZWFyY2hPYmplY3QgPSB0aGlzLmdldFVybFBhcmFtZXRlcnMoc2VhcmNoUGFydCk7XG5cbiAgICAgIGlmICghXy5pc1VuZGVmaW5lZChzZWFyY2hPYmplY3QuaWQpKSB7XG4gICAgICAgIG5ld1ZhbHVlcy5pbml0aWQgPSBzZWFyY2hPYmplY3QuaWQ7XG4gICAgICB9XG4gICAgICBpZiAoIV8uaXNVbmRlZmluZWQoc2VhcmNoT2JqZWN0LmluaXRpZCkpIHtcbiAgICAgICAgbmV3VmFsdWVzLmluaXRpZCA9IHNlYXJjaE9iamVjdC5pbml0aWQ7XG4gICAgICB9XG4gICAgICBpZiAoIV8uaXNVbmRlZmluZWQoc2VhcmNoT2JqZWN0LnJldmlzaW9uKSkge1xuICAgICAgICBuZXdWYWx1ZXMucmV2aXNpb24gPSBwYXJzZUludChzZWFyY2hPYmplY3QucmV2aXNpb24sIDEwKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG5ld1ZhbHVlcy5yZXZpc2lvbiA9IC0xO1xuICAgICAgfVxuICAgICAgaWYgKCFfLmlzVW5kZWZpbmVkKHNlYXJjaE9iamVjdC52aWV3SWQpKSB7XG4gICAgICAgIG5ld1ZhbHVlcy52aWV3SWQgPSBzZWFyY2hPYmplY3Qudmlld0lkO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbmV3VmFsdWVzLnZpZXdJZCA9IHVuZGVmaW5lZDtcbiAgICAgIH1cbiAgICAgIHRoaXMuZG9jdW1lbnQuZmV0Y2hEb2N1bWVudChuZXdWYWx1ZXMpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBleHRyYWN0IHVybCBwYXJhbWV0ZXJzIGFuZCByZXR1cm4gYW4gc2ltcGxlIG9iamVjdCBpbmRleGVkIGJ5IHBhcmFtZXRlcnMga2V5c1xuICAgICAqIEBwYXJhbSBzZWFyY2hQYXJ0XG4gICAgICogQHJldHVybnMge3t9fVxuICAgICAqL1xuICAgIGdldFVybFBhcmFtZXRlcnM6IGZ1bmN0aW9uIHJvdXRlcl9nZXRVcmxQYXJhbWV0ZXJzKHNlYXJjaFBhcnQpIHtcbiAgICAgIHZhciBleHRyYWN0LFxuICAgICAgICBnZXRQYXJhbWV0ZXJzLFxuICAgICAgICByZXN1bHQgPSB7fTtcblxuICAgICAgaWYgKHNlYXJjaFBhcnQpIHtcbiAgICAgICAgZ2V0UGFyYW1ldGVycyA9IHNlYXJjaFBhcnQuc3Vic3RyKDEpLnNwbGl0KFwiJlwiKTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBnZXRQYXJhbWV0ZXJzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgZXh0cmFjdCA9IGdldFBhcmFtZXRlcnNbaV0ubWF0Y2goL14oW149XSspPSguKikkLyk7XG4gICAgICAgICAgaWYgKGV4dHJhY3QpIHtcbiAgICAgICAgICAgIHJlc3VsdFtleHRyYWN0WzFdXSA9IGRlY29kZVVSSUNvbXBvbmVudChleHRyYWN0WzJdKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmVzdWx0W2dldFBhcmFtZXRlcnNbaV1dID0gXCJcIjtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuICB9KTtcbn0pO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///f845389cd549ce7299bb\n");

/***/ }),

/***/ "fb3f606ecd8a48d7cad0":
/*!*********************************************************!*\
  !*** ./src/Apps/DOCUMENT/IHM/collections/attributes.js ***!
  \*********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/*global define*/\n!(__WEBPACK_AMD_DEFINE_ARRAY__ = [\n  __webpack_require__(/*! underscore */ \"8e08e542008e4aef1f58\"),\n  __webpack_require__(/*! backbone */ \"1858b45bf48591489d06\"),\n  __webpack_require__(/*! dcpDocument/models/mAttributeData */ \"72335e037ab5116fdf0c\"),\n  __webpack_require__(/*! dcpDocument/models/mAttributeStructural */ \"512dac7279589ee7db96\"),\n  __webpack_require__(/*! dcpDocument/models/mAttributeArray */ \"0ed68aa34b095f87d8dd\")\n], __WEBPACK_AMD_DEFINE_RESULT__ = (function(\n  _,\n  Backbone,\n  ModelAttributeData,\n  ModelAttributeStructural,\n  ModelAttributeArray\n) {\n  \"use strict\";\n\n  return Backbone.Collection.extend({\n    comparator: \"logicalOrder\",\n\n    model: function CollectionAttributesSelectModel(attributes, options) {\n      if (attributes.type === \"array\") {\n        return new ModelAttributeArray(attributes, options);\n      }\n      if (attributes.type === \"tab\" || attributes.type === \"frame\") {\n        return new ModelAttributeStructural(attributes, options);\n      }\n      return new ModelAttributeData(attributes, options);\n    },\n\n    initialize: function CollectionAttributes_initialize(values, options) {\n      this.documentModel = options.documentModel;\n      this.renderOptions = options.renderOptions;\n      this.renderMode = options.renderMode;\n    },\n\n    destroy: function CollectionAttributes_destroy() {\n      var model;\n      while ((model = this.first())) {\n        // jshint ignore:line\n        model.destroy();\n      }\n      delete this.documentModel;\n      delete this.renderOptions;\n      delete this.renderMode;\n    }\n  });\n}).apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmIzZjYwNmVjZDhhNDhkN2NhZDAuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvQXBwcy9ET0NVTUVOVC9JSE0vY29sbGVjdGlvbnMvYXR0cmlidXRlcy5qcz9jODVlIl0sInNvdXJjZXNDb250ZW50IjpbIi8qZ2xvYmFsIGRlZmluZSovXG5kZWZpbmUoW1xuICBcInVuZGVyc2NvcmVcIixcbiAgXCJiYWNrYm9uZVwiLFxuICBcImRjcERvY3VtZW50L21vZGVscy9tQXR0cmlidXRlRGF0YVwiLFxuICBcImRjcERvY3VtZW50L21vZGVscy9tQXR0cmlidXRlU3RydWN0dXJhbFwiLFxuICBcImRjcERvY3VtZW50L21vZGVscy9tQXR0cmlidXRlQXJyYXlcIlxuXSwgZnVuY3Rpb24oXG4gIF8sXG4gIEJhY2tib25lLFxuICBNb2RlbEF0dHJpYnV0ZURhdGEsXG4gIE1vZGVsQXR0cmlidXRlU3RydWN0dXJhbCxcbiAgTW9kZWxBdHRyaWJ1dGVBcnJheVxuKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIHJldHVybiBCYWNrYm9uZS5Db2xsZWN0aW9uLmV4dGVuZCh7XG4gICAgY29tcGFyYXRvcjogXCJsb2dpY2FsT3JkZXJcIixcblxuICAgIG1vZGVsOiBmdW5jdGlvbiBDb2xsZWN0aW9uQXR0cmlidXRlc1NlbGVjdE1vZGVsKGF0dHJpYnV0ZXMsIG9wdGlvbnMpIHtcbiAgICAgIGlmIChhdHRyaWJ1dGVzLnR5cGUgPT09IFwiYXJyYXlcIikge1xuICAgICAgICByZXR1cm4gbmV3IE1vZGVsQXR0cmlidXRlQXJyYXkoYXR0cmlidXRlcywgb3B0aW9ucyk7XG4gICAgICB9XG4gICAgICBpZiAoYXR0cmlidXRlcy50eXBlID09PSBcInRhYlwiIHx8IGF0dHJpYnV0ZXMudHlwZSA9PT0gXCJmcmFtZVwiKSB7XG4gICAgICAgIHJldHVybiBuZXcgTW9kZWxBdHRyaWJ1dGVTdHJ1Y3R1cmFsKGF0dHJpYnV0ZXMsIG9wdGlvbnMpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIG5ldyBNb2RlbEF0dHJpYnV0ZURhdGEoYXR0cmlidXRlcywgb3B0aW9ucyk7XG4gICAgfSxcblxuICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uIENvbGxlY3Rpb25BdHRyaWJ1dGVzX2luaXRpYWxpemUodmFsdWVzLCBvcHRpb25zKSB7XG4gICAgICB0aGlzLmRvY3VtZW50TW9kZWwgPSBvcHRpb25zLmRvY3VtZW50TW9kZWw7XG4gICAgICB0aGlzLnJlbmRlck9wdGlvbnMgPSBvcHRpb25zLnJlbmRlck9wdGlvbnM7XG4gICAgICB0aGlzLnJlbmRlck1vZGUgPSBvcHRpb25zLnJlbmRlck1vZGU7XG4gICAgfSxcblxuICAgIGRlc3Ryb3k6IGZ1bmN0aW9uIENvbGxlY3Rpb25BdHRyaWJ1dGVzX2Rlc3Ryb3koKSB7XG4gICAgICB2YXIgbW9kZWw7XG4gICAgICB3aGlsZSAoKG1vZGVsID0gdGhpcy5maXJzdCgpKSkge1xuICAgICAgICAvLyBqc2hpbnQgaWdub3JlOmxpbmVcbiAgICAgICAgbW9kZWwuZGVzdHJveSgpO1xuICAgICAgfVxuICAgICAgZGVsZXRlIHRoaXMuZG9jdW1lbnRNb2RlbDtcbiAgICAgIGRlbGV0ZSB0aGlzLnJlbmRlck9wdGlvbnM7XG4gICAgICBkZWxldGUgdGhpcy5yZW5kZXJNb2RlO1xuICAgIH1cbiAgfSk7XG59KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///fb3f606ecd8a48d7cad0\n");

/***/ }),

/***/ "fb99e2d47db08d4c57e2":
/*!******************************************************************!*\
  !*** ./src/Apps/DOCUMENT/IHM/widgets/attributes/money/wMoney.js ***!
  \******************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;(function umdRequire(root, factory) {\n  \"use strict\";\n\n  if (true) {\n    !(__WEBPACK_AMD_DEFINE_ARRAY__ = [\n      __webpack_require__(/*! jquery */ \"127c8cf59f228bb01a21\"),\n      __webpack_require__(/*! dcpDocument/widgets/attributes/double/wDouble */ \"ea039643a9587ce47509\")\n    ], __WEBPACK_AMD_DEFINE_FACTORY__ = (factory),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?\n\t\t\t\t(__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n  } else {}\n})(window, function require_money($) {\n  \"use strict\";\n\n  $.widget(\"dcp.dcpMoney\", $.dcp.dcpDouble, {\n    options: {\n      type: \"money\",\n      renderOptions: {\n        currency: \"\",\n        numberFormat: \"#,#.00\"\n      }\n    },\n\n    /**\n     * Get kendo option from normal options and from renderOptions.kendoNumeric\n     * @returns {*}\n     */\n    getKendoNumericOptions: function wMoneyGetKendoNumericOptions() {\n      var options = this._super(); // get from wDouble\n      if (this.options.renderOptions.currency) {\n        // view decimal precision\n        switch (this.options.locale.substr(0, 2)) {\n          case \"en\":\n          case \"ga\": // Ireland Irish\n            // currency before\n            options.format =\n              this.options.renderOptions.currency.replace(\"$\", \"\\\\$\") +\n              options.format;\n            break;\n          default:\n            options.format +=\n              \" \" + this.options.renderOptions.currency.replace(\"$\", \"\\\\$\");\n        }\n      }\n\n      return options;\n    },\n\n    getType: function wMoneyGetType() {\n      return \"money\";\n    }\n  });\n\n  return $.fn.dcpMoney;\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmI5OWUyZDQ3ZGIwOGQ0YzU3ZTIuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvQXBwcy9ET0NVTUVOVC9JSE0vd2lkZ2V0cy9hdHRyaWJ1dGVzL21vbmV5L3dNb25leS5qcz9hNDllIl0sInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiB1bWRSZXF1aXJlKHJvb3QsIGZhY3RvcnkpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgaWYgKHR5cGVvZiBkZWZpbmUgPT09IFwiZnVuY3Rpb25cIiAmJiBkZWZpbmUuYW1kKSB7XG4gICAgZGVmaW5lKFtcbiAgICAgIFwianF1ZXJ5XCIsXG4gICAgICBcImRjcERvY3VtZW50L3dpZGdldHMvYXR0cmlidXRlcy9kb3VibGUvd0RvdWJsZVwiXG4gICAgXSwgZmFjdG9yeSk7XG4gIH0gZWxzZSB7XG4gICAgLy9ub2luc3BlY3Rpb24gSlNVbnJlc29sdmVkVmFyaWFibGVcbiAgICBmYWN0b3J5KHdpbmRvdy5qUXVlcnkpO1xuICB9XG59KSh3aW5kb3csIGZ1bmN0aW9uIHJlcXVpcmVfbW9uZXkoJCkge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICAkLndpZGdldChcImRjcC5kY3BNb25leVwiLCAkLmRjcC5kY3BEb3VibGUsIHtcbiAgICBvcHRpb25zOiB7XG4gICAgICB0eXBlOiBcIm1vbmV5XCIsXG4gICAgICByZW5kZXJPcHRpb25zOiB7XG4gICAgICAgIGN1cnJlbmN5OiBcIuKCrFwiLFxuICAgICAgICBudW1iZXJGb3JtYXQ6IFwiIywjLjAwXCJcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogR2V0IGtlbmRvIG9wdGlvbiBmcm9tIG5vcm1hbCBvcHRpb25zIGFuZCBmcm9tIHJlbmRlck9wdGlvbnMua2VuZG9OdW1lcmljXG4gICAgICogQHJldHVybnMgeyp9XG4gICAgICovXG4gICAgZ2V0S2VuZG9OdW1lcmljT3B0aW9uczogZnVuY3Rpb24gd01vbmV5R2V0S2VuZG9OdW1lcmljT3B0aW9ucygpIHtcbiAgICAgIHZhciBvcHRpb25zID0gdGhpcy5fc3VwZXIoKTsgLy8gZ2V0IGZyb20gd0RvdWJsZVxuICAgICAgaWYgKHRoaXMub3B0aW9ucy5yZW5kZXJPcHRpb25zLmN1cnJlbmN5KSB7XG4gICAgICAgIC8vIHZpZXcgZGVjaW1hbCBwcmVjaXNpb25cbiAgICAgICAgc3dpdGNoICh0aGlzLm9wdGlvbnMubG9jYWxlLnN1YnN0cigwLCAyKSkge1xuICAgICAgICAgIGNhc2UgXCJlblwiOlxuICAgICAgICAgIGNhc2UgXCJnYVwiOiAvLyBJcmVsYW5kIElyaXNoXG4gICAgICAgICAgICAvLyBjdXJyZW5jeSBiZWZvcmVcbiAgICAgICAgICAgIG9wdGlvbnMuZm9ybWF0ID1cbiAgICAgICAgICAgICAgdGhpcy5vcHRpb25zLnJlbmRlck9wdGlvbnMuY3VycmVuY3kucmVwbGFjZShcIiRcIiwgXCJcXFxcJFwiKSArXG4gICAgICAgICAgICAgIG9wdGlvbnMuZm9ybWF0O1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIG9wdGlvbnMuZm9ybWF0ICs9XG4gICAgICAgICAgICAgIFwiIFwiICsgdGhpcy5vcHRpb25zLnJlbmRlck9wdGlvbnMuY3VycmVuY3kucmVwbGFjZShcIiRcIiwgXCJcXFxcJFwiKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gb3B0aW9ucztcbiAgICB9LFxuXG4gICAgZ2V0VHlwZTogZnVuY3Rpb24gd01vbmV5R2V0VHlwZSgpIHtcbiAgICAgIHJldHVybiBcIm1vbmV5XCI7XG4gICAgfVxuICB9KTtcblxuICByZXR1cm4gJC5mbi5kY3BNb25leTtcbn0pO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQ0EsV0FHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///fb99e2d47db08d4c57e2\n");

/***/ }),

/***/ "fde693488ffc947d1881":
/*!**************************************************************!*\
  !*** ./src/Apps/DOCUMENT/IHM/views/attributes/vAttribute.js ***!
  \**************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/*global define, console*/\n!(__WEBPACK_AMD_DEFINE_ARRAY__ = [\n  __webpack_require__(/*! jquery */ \"127c8cf59f228bb01a21\"),\n  __webpack_require__(/*! underscore */ \"8e08e542008e4aef1f58\"),\n  __webpack_require__(/*! backbone */ \"1858b45bf48591489d06\"),\n  __webpack_require__(/*! mustache */ \"bcd31d01884fc294fd69\"),\n  __webpack_require__(/*! dcpDocument/views/document/attributeTemplate */ \"593c8c94ba4399020f79\"),\n  __webpack_require__(/*! dcpDocument/widgets/attributes/label/wLabel */ \"25094ffcb8bcd2bb587c\"),\n  __webpack_require__(/*! dcpDocument/widgets/attributes/text/wText */ \"61b480911316cdda77a4\"),\n  __webpack_require__(/*! dcpDocument/widgets/attributes/int/wInt */ \"0627c604219b27e8bb7c\"),\n  __webpack_require__(/*! dcpDocument/widgets/attributes/longtext/wLongtext */ \"44a0b71fc2e02754c2f8\"),\n  __webpack_require__(/*! dcpDocument/widgets/attributes/htmltext/wHtmltext */ \"98221531f3fb9af2dff1\"),\n  __webpack_require__(/*! dcpDocument/widgets/attributes/timestamp/wTimestamp */ \"6dbe3b90603a8175dd85\"),\n  __webpack_require__(/*! dcpDocument/widgets/attributes/time/wTime */ \"568d4145cebb6959279c\"),\n  __webpack_require__(/*! dcpDocument/widgets/attributes/image/wImage */ \"6ae127aafe284bc9addc\"),\n  __webpack_require__(/*! dcpDocument/widgets/attributes/money/wMoney */ \"fb99e2d47db08d4c57e2\"),\n  __webpack_require__(/*! dcpDocument/widgets/attributes/enum/wEnum */ \"8df78adf9774feae5b6e\"),\n  __webpack_require__(/*! dcpDocument/widgets/attributes/color/wColor */ \"061678c35a7b82df6628\"),\n  __webpack_require__(/*! dcpDocument/widgets/attributes/password/wPassword */ \"7bf0c39069ca070152a3\"),\n  __webpack_require__(/*! dcpDocument/widgets/attributes/file/wFile */ \"af25306fd60189c120f8\"),\n  __webpack_require__(/*! dcpDocument/widgets/attributes/double/wDouble */ \"ea039643a9587ce47509\"),\n  __webpack_require__(/*! dcpDocument/widgets/attributes/docid/wDocid */ \"ff69e46ed202585764e9\")\n], __WEBPACK_AMD_DEFINE_RESULT__ = (function vAttribute($, _, Backbone, Mustache, attributeTemplate) {\n  \"use strict\";\n\n  return Backbone.View.extend({\n    className: \"row dcpAttribute form-group\",\n    customView: false,\n    displayLabel: true,\n    //Don't use standard event to launch the event only when there is no template\n    //********************************************************************************************\n    // If you add an event here, you probably want to add it in vColumn.js and test it in an array\n    //********************************************************************************************\n    attributeEvents: {\n      \"dcpattributechange .dcpAttribute__content,[data-dcpattribute_content]\":\n        \"updateValue\",\n      \"dcpattributedelete .dcpAttribute__content\": \"deleteValue\",\n      \"dcpattributechangeattrmenuvisibility .dcpAttribute__content\":\n        \"changeMenuVisibility\",\n      \"dcpattributechangeattrsvalue .dcpAttribute__content\":\n        \"changeAttributesValue\",\n      \"dcpattributefetchdocument .dcpAttribute__content\": \"loadDocument\",\n      \"dcpattributeexternallinkselected .dcpAttribute__content\":\n        \"externalLinkSelected\",\n      dcplabelexternallinkselected: \"externalLinkSelected\",\n      \"dcpattributedownloadfile  .dcpAttribute__content\": \"downloadFileSelect\",\n      \"dcpattributeuploadfile  .dcpAttribute__content\": \"uploadFileSelect\",\n      \"dcpattributeuploadfiledone  .dcpAttribute__content\": \"uploadFileDone\",\n      \"dcpattributeanchorclick .dcpAttribute__content\": \"anchorClick\",\n      \"dcpattributewidgetready .dcpAttribute__content\": \"setWidgetReady\"\n    },\n\n    initialize: function vAttributeInitialize(options) {\n      var events;\n      this.listenTo(this.model, \"change:label\", this.refreshLabel);\n      this.listenTo(this.model, \"change:attributeValue\", this.refreshValue);\n      this.listenTo(this.model, \"change:errorMessage\", this.refreshError);\n      this.listenTo(this.model, \"moved\", this.moveValueIndex);\n      this.listenTo(this.model, \"destroy\", this.remove);\n      this.listenTo(this.model, \"showTab\", this.afterShow);\n      this.listenTo(this.model, \"hide\", this.hide);\n      this.listenTo(this.model, \"show\", this.show);\n      this.listenTo(this.model, \"haveView\", this._identifyView);\n      this.listenTo(this.model, \"closeWidget\", this._closeWidget);\n      this.templateWrapper = this.model.getTemplates().attribute.simpleWrapper;\n\n      options = options || {};\n\n      if (\n        options.displayLabel === false ||\n        this.model.getOption(\"labelPosition\") === \"none\"\n      ) {\n        this.displayLabel = false;\n      }\n\n      if (options.originalView === undefined) {\n        options.originalView = _.isEmpty(this.model.getOption(\"template\"));\n      }\n\n      //Attribute without custom template so we bind event\n      if (options.originalView === true) {\n        events = this.attributeEvents;\n        //For vColumn events\n        if (_.isFunction(events)) {\n          events = events.apply(this);\n        }\n        this.delegateEvents(events);\n      }\n\n      this.options = options;\n    },\n\n    /**\n     * The Data are the source of data shared with widget and templates\n     *\n     * @param index\n     * @returns {*}\n     */\n    getData: function vAttributeGetData(index) {\n      var data;\n\n      //Made to JSON for all the values, or to data for value indexed (in cas of multiple)\n      data = this.model.toData(index, true);\n      data.viewCid = this.cid + \"-\" + this.model.id;\n      data.labels.deleteAttributeNames = this.getDeleteLabels();\n      // autoComplete detected\n      data.autocompleteRequest = _.bind(this.autocompleteRequestRead, this);\n\n      return data;\n    },\n\n    render: function vAttributeRender() {\n      var currentView = this;\n      var renderPromise = new Promise(\n        _.bind(function vAttributeRender_Promise(resolve, reject) {\n          var data,\n            event = { prevent: false },\n            customRender;\n\n          currentView.model.trigger(\"beforeRender\", event, {\n            model: currentView.model,\n            $el: currentView.$el\n          });\n          if (event.prevent) {\n            resolve();\n            return currentView;\n          }\n\n          //We fetch data after beforeRender, if some data is modified by beforeRender we get it\n          data = currentView.getData();\n\n          currentView.$el.addClass(\n            \"dcpAttribute--type--\" + currentView.model.get(\"type\")\n          );\n          currentView.$el.addClass(\n            \"dcpAttribute--visibility--\" + currentView.model.get(\"visibility\")\n          );\n          currentView.$el.attr(\"data-attrid\", currentView.model.get(\"id\"));\n          if (currentView.model.get(\"needed\")) {\n            currentView.$el.addClass(\"dcpAttribute--needed\");\n          }\n\n          currentView.$el.append(\n            $(Mustache.render(currentView.templateWrapper || \"\", data))\n          );\n\n          attributeTemplate.insertDescription(currentView);\n\n          //analyze the display label and add display class\n          if (currentView.displayLabel === false) {\n            currentView.$el.find(\".dcpAttribute__label\").remove();\n            // set to 100% width\n            currentView.$el\n              .find(\".dcpAttribute__right\")\n              .addClass(\"dcpAttribute__right--full\");\n          } else {\n            if (currentView.model.getOption(\"labelPosition\") === \"left\") {\n              currentView.$el.addClass(\"dcpAttribute__labelPosition--left\");\n              currentView.$el\n                .find(\".dcpAttribute__right\")\n                .not(\".dcpAttribute__description\")\n                .addClass(\"dcpAttribute__labelPosition--left\");\n              currentView.$el\n                .find(\".dcpAttribute__left\")\n                .not(\".dcpAttribute__description\")\n                .addClass(\"dcpAttribute__labelPosition--left\");\n            }\n            if (currentView.model.getOption(\"labelPosition\") === \"up\") {\n              currentView.$el.addClass(\"dcpAttribute__labelPosition--up\");\n              currentView.$el\n                .find(\".dcpAttribute__right\")\n                .not(\".dcpAttribute__description\")\n                .addClass(\"dcpAttribute__labelPosition--up\");\n              currentView.$el\n                .find(\".dcpAttribute__left\")\n                .not(\".dcpAttribute__description\")\n                .addClass(\"dcpAttribute__labelPosition--up\");\n            }\n            if (currentView.model.getOption(\"labelPosition\") === \"auto\") {\n              currentView.$el.addClass(\"dcpAttribute__labelPosition--auto\");\n              currentView.$el\n                .find(\".dcpAttribute__right\")\n                .addClass(\"dcpAttribute__labelPosition--auto\");\n              currentView.$el\n                .find(\".dcpAttribute__left\")\n                .addClass(\"dcpAttribute__labelPosition--auto\");\n            }\n            currentView.$el.find(\".dcpAttribute__label\").dcpLabel(data);\n          }\n\n          //If there is a template render it\n          if (\n            currentView.options.originalView !== true &&\n            currentView.model.getOption(\"template\")\n          ) {\n            customRender = attributeTemplate.renderCustomView(\n              currentView.model\n            );\n            currentView.customView = customRender.$el;\n            currentView.$el\n              .find(\".dcpAttribute__content\")\n              .append(currentView.customView);\n            customRender.promise.then(resolve);\n            customRender.promise[\"catch\"](reject);\n          } else {\n            //there is not template render (default)\n            currentView.$el.one(\n              \"dcpattributewidgetready .dcpAttribute__content\",\n              function vattributeRender_widgetready() {\n                resolve();\n              }\n            );\n            currentView.currentDcpWidget = currentView.widgetInit(\n              currentView.$el.find(\".dcpAttribute__content\"),\n              data\n            );\n          }\n\n          currentView.renderDone = true;\n          if (currentView.customView) {\n            currentView.widgetReady = true;\n          }\n\n          currentView.triggerRenderDone();\n          return currentView;\n        }, this)\n      );\n      return renderPromise;\n    },\n\n    refreshLabel: function vAttributeRefreshLabel() {\n      var label = this.model.get(\"label\"),\n        labelDom = this.getDOMElements().find(\".dcpAttribute__label\");\n      if (this.model.getOption(\"attributeLabel\")) {\n        label = this.model.getOption(\"attributeLabel\");\n      }\n      if (labelDom.data(\"dcpDcpLabel\")) {\n        this.getDOMElements()\n          .find(\".dcpAttribute__label\")\n          .dcpLabel(\"setLabel\", label);\n      }\n    },\n\n    /**\n     * Autorefresh value when model change\n     */\n    refreshValue: function vAttributeRefreshValue(model, values, options) {\n      var scope = this,\n        allWrapper,\n        arrayWrapper;\n      if (options.notUpdateArray) {\n        return this;\n      }\n\n      allWrapper = this.getDOMElements();\n\n      if (this.model.isInArray()) {\n        // adjust line number to column length\n        arrayWrapper = this.$el;\n        arrayWrapper.dcpArray(\"setLines\", values.length, options).then(\n          _.bind(function vAttributeDrawValue() {\n            values = _.toArray(values);\n\n            if (_.isEqual(values, scope.model.getValue())) {\n              _.each(values, function analyzeValues(currentValue, index) {\n                if (_.isUndefined(currentValue)) {\n                  return;\n                }\n                var cssIndex =\n                  '.dcpAttribute__content--widget[data-attrid=\"' +\n                  model.id +\n                  '\"]';\n                $(allWrapper[index])\n                  .find(cssIndex)\n                  .addBack(cssIndex)\n                  .each(function vAttributeRefreshOneValue(index, element) {\n                    scope.widgetApply($(element), \"setValue\", currentValue);\n                  });\n              });\n            }\n          }, this)\n        );\n      } else {\n        this.widgetApply(\n          allWrapper.find(\n            '.dcpAttribute__content--widget[data-attrid=\"' + model.id + '\"]'\n          ),\n          \"setValue\",\n          values\n        );\n      }\n    },\n\n    /**\n     * Display error message around the widget if needed\n     * @param event\n     */\n    refreshError: function vAttributeRefreshError() {\n      this.$el\n        .find(\".dcpAttribute__label\")\n        .dcpLabel(\"setError\", this.model.get(\"errorMessage\"));\n      // andSelf method was removed from jQuery 3.0.0+ use addBack instead\n      var jqueryVersion = +$().jquery.split(\".\")[0];\n      if (jqueryVersion >= 3) {\n        this.widgetApply(\n          this.getDOMElements()\n            .find(\".dcpAttribute__content--widget\")\n            .addBack()\n            .filter(\".dcpAttribute__content--widget\"),\n          \"setError\",\n          this.model.get(\"errorMessage\")\n        );\n      } else {\n        this.widgetApply(\n          this.getDOMElements()\n            .find(\".dcpAttribute__content--widget\")\n            .andSelf()\n            .filter(\".dcpAttribute__content--widget\"),\n          \"setError\",\n          this.model.get(\"errorMessage\")\n        );\n      }\n    },\n\n    /**\n     * Modify several attribute\n     * @param event event object\n     * @param index the value rank in case of multiple\n     * @param options object {dataItem :, valueIndex :}\n     */\n    changeAttributesValue: function vAttributeChangeAttributesValue(\n      event,\n      options,\n      index\n    ) {\n      var externalEvent = { prevent: false },\n        currentView = this,\n        dataItem = options.dataItem,\n        valueIndex = options.valueIndex,\n        currentValue;\n      this.model.trigger(\n        \"helperSelect\",\n        externalEvent,\n        this.model.id,\n        dataItem,\n        index\n      );\n      if (externalEvent.prevent) {\n        return this;\n      }\n      _.each(dataItem.values, function vAttributeChangeAttributeValue(\n        attributeValue,\n        attributeId\n      ) {\n        if (typeof attributeValue === \"object\") {\n          if (attributeValue.value === null) {\n            //Value not completed by helper so don't use it\n            return;\n          }\n\n          var attrModel = currentView.model\n            .getDocumentModel()\n            .get(\"attributes\")\n            .get(attributeId);\n          if (attrModel) {\n            if (attrModel.hasMultipleOption()) {\n              currentValue = attrModel.getValue();\n              if (valueIndex >= 0) {\n                currentValue = currentValue[valueIndex];\n              }\n              // No add same value twice\n              if (\n                !_.some(currentValue, function vAttributeNoDouble(itemValue) {\n                  return itemValue.value === attributeValue.value;\n                })\n              ) {\n                attrModel.addValue(\n                  {\n                    value: attributeValue.value,\n                    displayValue: attributeValue.displayValue\n                  },\n                  valueIndex\n                );\n              }\n            } else {\n              attrModel.setValue(\n                {\n                  value: attributeValue.value,\n                  displayValue: attributeValue.displayValue\n                },\n                valueIndex\n              );\n            }\n          } else {\n            console.error(\"Unable to find \" + attributeId);\n          }\n        }\n      });\n    },\n\n    /**\n     * Modify view : triggered by wDocid\n     * @param event\n     * @param options\n     * @returns {*}\n     */\n    loadDocument: function changeAttributesValueLoadDocument(event, options) {\n      var index = options.index,\n        initid = null,\n        attributeValue = this.model.get(\"attributeValue\"),\n        documentModel = this.model.getDocumentModel(),\n        revision = -1;\n      if (_.isUndefined(index)) {\n        initid = attributeValue.value;\n        revision = attributeValue.revision;\n      } else {\n        initid = attributeValue[index].value;\n        revision = attributeValue[index].revision;\n      }\n\n      this.model.trigger(\"internalLinkSelected\", event, {\n        eventId: \"document.load\",\n        target: event.target,\n        attrid: this.model.id,\n        options: [initid, \"!defaultConsultation\"],\n        index: options.index\n      });\n\n      if (event.prevent) {\n        return this;\n      }\n\n      documentModel.trigger(\"loadDocument\", {\n        initid: initid,\n        viewId: \"!defaultConsultation\",\n        revision: revision\n      });\n    },\n\n    /**\n     * Create dialog window to create and insert document\n     */\n    displayFormDocument: function vAttributedisplayFormDocument(\n      event,\n      buttonConfig,\n      index\n    ) {\n      var attrid = this.model.id;\n      if (buttonConfig.createLabel) {\n        var documentModel = this.model.getDocumentModel();\n\n        Promise.all(/*! require.ensure | wCreateDocument */[__webpack_require__.e(\"wDocument\"), __webpack_require__.e(\"wCreateDocument\")]).then((function vDocumentCreateDocument() {\n            __webpack_require__(/*! dcpDocument/widgets/attributes/docid/wCreateDocument */ \"eeea49593fdad50c9212\");\n            var $bdw = $('<div class=\"dcpDocid-create-window\"/>');\n            var $dcp = $bdw\n              .dcpCreateDocument(\n                _.extend(buttonConfig, {\n                  originDocumentModel: documentModel,\n                  attributeId: attrid,\n                  index: index,\n                  listener: function vDocumentCreateListener(\n                    event,\n                    triggerId,\n                    options\n                  ) {\n                    options.dialogDocument = this;\n                    options.triggerId = triggerId;\n                    documentModel.trigger(\n                      \"createDialogListener\",\n                      event,\n                      attrid,\n                      options\n                    );\n                  }\n                })\n              )\n              .data(\"dcpCreateDocument\");\n            $dcp.open();\n          }).bind(null, __webpack_require__)).catch(__webpack_require__.oe);\n      }\n    },\n\n    externalLinkSelected: function vAttributeExternalLinkSelected(\n      event,\n      options\n    ) {\n      var documentModel = this.model.getDocumentModel();\n      options.attrid = this.model.id;\n      this.model.trigger(\"internalLinkSelected\", event, options);\n      if (event.prevent) {\n        return this;\n      }\n      if (options.eventId === \"attribute.createDocumentRelation\") {\n        this.displayFormDocument(event, options.buttonConfig, options.index);\n      } else {\n        documentModel.trigger(\"actionAttributeLink\", event, options);\n      }\n    },\n    downloadFileSelect: function vAttributedownloadFileSelect(\n      widgetEvent,\n      options\n    ) {\n      this.model.trigger(\"downloadFile\", widgetEvent, this.model.id, options);\n    },\n    uploadFileSelect: function vAttributeuploadFileSelect(\n      widgetEvent,\n      options\n    ) {\n      this.model.trigger(\"uploadFile\", widgetEvent, this.model.id, options);\n    },\n    uploadFileDone: function vAttributeuploadFileSEnd(widgetEvent, options) {\n      this.model.trigger(\"uploadFileDone\", widgetEvent, this.model.id, options);\n    },\n\n    anchorClick: function vAttributeAnchorClick(widgetEvent, options) {\n      this.model.trigger(\"anchorClick\", widgetEvent, this.model.id, options);\n    },\n\n    /**\n     * Delete value,\n     * If has help, clear also target attributes\n     * @param event\n     * @param data index info {index:\"the index}\n     */\n    deleteValue: function changeAttributesValueDeleteValue(event, data) {\n      if (data.id === this.model.id) {\n        var attrToClear = this.model.get(\"helpOutputs\"),\n          docModel = this.model.getDocumentModel();\n        if (!attrToClear || typeof attrToClear === \"undefined\") {\n          attrToClear = [this.model.id];\n        } else {\n          attrToClear = _.toArray(attrToClear);\n        }\n        _.each(attrToClear, function vAttributeCleanAssociatedElement(aid) {\n          var attr = docModel.get(\"attributes\").get(aid);\n          if (attr) {\n            if (attr.hasMultipleOption()) {\n              attr.setValue([], data.index);\n            } else {\n              attr.setValue({ value: null, displayValue: \"\" }, data.index);\n            }\n          }\n        });\n      }\n    },\n\n    /**\n     * Return another attribute model\n     *\n     * @param attributeId\n     * @returns {*}\n     */\n    getAttributeModel: function vAttributeGetAttributeModel(attributeId) {\n      var docModel = this.model.getDocumentModel();\n      return docModel.get(\"attributes\").get(attributeId);\n    },\n\n    /**\n     * Used for render attribute\n     *\n     * @returns {Array}\n     */\n    getDeleteLabels: function vAttributeGetDeleteLabels() {\n      var attrToClear = this.model.get(\"helpOutputs\"),\n        scope = this,\n        attrLabels;\n      if (!attrToClear || typeof attrToClear === \"undefined\") {\n        attrToClear = [this.model.id];\n      } else {\n        attrToClear = _.toArray(attrToClear);\n      }\n      attrLabels = _.map(attrToClear, function vAttributeGetAssociatedLabel(\n        aid\n      ) {\n        var attr = scope.getAttributeModel(aid);\n        if (attr) {\n          return attr.attributes.label;\n        }\n        return \"\";\n      });\n      return attrLabels;\n    },\n\n    /**\n     * Propagate move value event to widgets\n     * @param eventData\n     */\n    moveValueIndex: function vAttributeMoveValueIndex(eventData) {\n      this.getDOMElements().trigger(\"postMoved\", eventData);\n    },\n\n    /**\n     * method use for transport multiselect widget\n     * @param index the row index of autocomplete when it is in array\n     * @param options\n     */\n    autocompleteRequestRead: function vAttributeAutocompleteRequestRead(\n      options,\n      index\n    ) {\n      var currentView = this,\n        documentModel = this.model.getDocumentModel(),\n        success = options.success,\n        externalOptions = {\n          setResult: function vAttributeAutoCompleteSet(content) {\n            _.each(content, function(item) {\n              if (item.message) {\n                item.message.contentText = item.message.contentText || \"\";\n                item.message.contentHtml = item.message.contentHtml || \"\";\n                item.message.type = item.message.type || \"message\";\n              } else if (item.error) {\n                item.message = {\n                  contentHtml: \"\",\n                  contentText: item.error,\n                  type: \"error\"\n                };\n              }\n              item.title = item.title || \"\";\n            });\n            success(content);\n          },\n          data: options.data\n        },\n        autocompleteUrl,\n        event = { prevent: false };\n      //Add helperResonse event (can be used to reprocess the content of the request)\n      success = _.wrap(success, function vAttributeAutoCompleteSuccess(\n        success,\n        content\n      ) {\n        var options = {},\n          event = { prevent: false };\n        options.data = content;\n        currentView.model.trigger(\n          \"helperResponse\",\n          event,\n          currentView.model.id,\n          options,\n          index\n        );\n        if (event.prevent) {\n          return success([]);\n        }\n        success(content);\n      });\n\n      //Add helperSearch event (can prevent default ajax request)\n      options.data.attributes = documentModel.getValues();\n      this.model.trigger(\n        \"helperSearch\",\n        event,\n        this.model.id,\n        externalOptions,\n        index\n      );\n      if (event.prevent) {\n        return this;\n      }\n      autocompleteUrl =\n        \"api/v2/documents/\" +\n        (documentModel.id || \"0\") +\n        \"/autocomplete/\" +\n        this.model.id;\n\n      options.data.fromid = documentModel.get(\"properties\").get(\"family\").id;\n\n      $.ajax({\n        type: \"POST\",\n        url: autocompleteUrl,\n        data: options.data,\n\n        dataType: \"json\" // \"jsonp\" is required for cross-domain requests; use \"json\" for same-domain requestsons.error(result);\n      })\n        .pipe(\n          function vAttributeAutocompletehandleSuccessRequest(response) {\n            if (response.success) {\n              return response;\n            } else {\n              return $.Deferred().reject(response);\n            }\n          },\n          function vAttributeAutocompletehandleErrorRequest(response) {\n            if (response.status === 0) {\n              return {\n                success: false,\n                error: \"Your navigator seems offline, try later\"\n              };\n            }\n            if (\n              response.responseJSON &&\n              response.responseJSON.exceptionMessage\n            ) {\n              return {\n                success: false,\n                error: response.responseJSON.exceptionMessage\n              };\n            }\n            return {\n              success: false,\n              error:\n                \"Unexpected error: \" +\n                response.status +\n                \" \" +\n                response.statusText\n            };\n          }\n        )\n        .then(\n          function vAttributeAutocompleteSuccessResult(result) {\n            // notify the data source that the request succeeded\n            _.each(result.messages, function(message) {\n              message.contentText = message.contentText || \"\";\n              message.contentHtml = message.contentHtml || \"\";\n              result.data.unshift({\n                message: message,\n                title: \"\"\n              });\n            });\n            success(result.data);\n          },\n          function vAttributeAutocompleteErrorResult(result) {\n            // notify the data source that the request failed\n            if (_.isArray(result.error)) {\n              result.error = result.error.join(\" \");\n            }\n            //use the success callback because http error are handling by the pipe\n            success([\n              {\n                title: \"\",\n                message: {\n                  type: \"error\",\n                  contentHtml: \"\",\n                  contentText: result.error\n                }\n              }\n            ]);\n          }\n        );\n    },\n\n    /**\n     * Modify visibility access of an item menu\n     * @param event event object\n     * @param data menu config {id: menuId, visibility: \"disabled\", \"visible\", \"hidden\"}\n     */\n    changeMenuVisibility: function vAttributeChangeMenuVisibility(event, data) {\n      this.model.trigger(\"changeMenuVisibility\", event, data);\n    },\n\n    getDOMElements: function vAttributeGetDOMElements() {\n      if (this.options && this.options.els) {\n        return this.options.els();\n      } else {\n        return this.$el;\n      }\n    },\n\n    afterShow: function vAttributeAfterShow(/*event, data*/) {\n      // propagate event to widgets\n      this.getDOMElements().trigger(\"show\");\n    },\n    /**\n     *\n     * @param event\n     * @param data\n     */\n    updateValue: function vAttributeUpdateValue(event, data) {\n      this.model.setValue(data.value, data.index);\n    },\n\n    widgetInit: function vAttributeWidgetInit($element, data) {\n      $element.addClass(\"dcpAttribute__content--widget\");\n      return this.getWidgetClass($element).call($element, data);\n    },\n\n    widgetApply: function vAttributeWidgetApply($element, method, argument) {\n      try {\n        if (_.isString(method) && $element && this.getWidgetClass($element)) {\n          this.getWidgetClass($element).call($element, method, argument);\n        }\n      } catch (e) {\n        if (window.dcp.logger) {\n          window.dcp.logger(e);\n        } else {\n          console.error(e);\n        }\n      }\n      return this;\n    },\n\n    getWidgetClass: function vAttributeGetWidgetClass($element) {\n      $element = $element || this.$el;\n      if (!$element.data(\"currentWidgetClass\")) {\n        $element.data(\n          \"currentWidgetClass\",\n          this.getTypedWidgetClass(this.model.get(\"type\"))\n        );\n      }\n      return $element.data(\"currentWidgetClass\");\n    },\n\n    getTypedWidgetClass: function vAttributeGetTypedWidgetClass(type) {\n      var error = \"\",\n        customWidgetClass = this.model.getOption(\n          \"customWidgetAttributeFunction\"\n        );\n      if (customWidgetClass) {\n        if (_.isFunction($.fn[customWidgetClass])) {\n          return $.fn[customWidgetClass];\n        }\n        error =\n          \"Custom Widget Function : $.fn.\" +\n          customWidgetClass +\n          \" is not a function. Attribute : \" +\n          this.model.id;\n        console.error(error);\n        throw new Error(error);\n      }\n      switch (type) {\n        case \"text\":\n          return $.fn.dcpText;\n        case \"int\":\n          return $.fn.dcpInt;\n        case \"double\":\n          return $.fn.dcpDouble;\n        case \"money\":\n          return $.fn.dcpMoney;\n        case \"longtext\":\n          return $.fn.dcpLongtext;\n        case \"htmltext\":\n          return $.fn.dcpHtmltext;\n        case \"date\":\n          return $.fn.dcpDate;\n        case \"timestamp\":\n          return $.fn.dcpTimestamp;\n        case \"time\":\n          return $.fn.dcpTime;\n        case \"image\":\n          return $.fn.dcpImage;\n        case \"color\":\n          return $.fn.dcpColor;\n        case \"file\":\n          return $.fn.dcpFile;\n        case \"enum\":\n          return $.fn.dcpEnum;\n        case \"password\":\n          return $.fn.dcpPassword;\n        case \"thesaurus\":\n        case \"account\":\n        case \"docid\":\n          return $.fn.dcpDocid;\n        default:\n          return $.fn.dcpText;\n      }\n    },\n\n    setWidgetReady: function Vattribute_setWidgetReady() {\n      this.widgetReady = true;\n      this.triggerRenderDone();\n    },\n\n    triggerRenderDone: function vAttribute_triggerRenderDone() {\n      if (\n        this.noRenderEvent !== false &&\n        this.renderDone &&\n        this.widgetReady &&\n        !this.triggerRender\n      ) {\n        this.model.trigger(\"renderDone\", { model: this.model, $el: this.$el });\n        this.triggerRender = true;\n      }\n    },\n\n    remove: function vAttributeRemove() {\n      try {\n        if (\n          this.currentDcpWidget &&\n          this.getWidgetClass(this.currentDcpWidget) &&\n          this._findWidgetName(this.$el)\n        ) {\n          this.getWidgetClass(this.currentDcpWidget).call(this.$el, \"destroy\");\n        }\n      } catch (e) {\n        if (window.dcp.logger) {\n          window.dcp.logger(e);\n        } else {\n          console.error(e);\n        }\n      }\n      return Backbone.View.prototype.remove.call(this);\n    },\n\n    hide: function vAttributeHide() {\n      this.$el.hide();\n    },\n\n    show: function vAttributeShow() {\n      this.$el.show();\n    },\n\n    _closeWidget: function vAttribute__closeWidget() {\n      try {\n        if (\n          this.currentDcpWidget &&\n          this.getWidgetClass(this.currentDcpWidget) &&\n          this._findWidgetName(this.currentDcpWidget)\n        ) {\n          this.getWidgetClass(this.currentDcpWidget).call(\n            this.currentDcpWidget,\n            \"close\"\n          );\n        }\n      } catch (e) {\n        if (window.dcp.logger) {\n          window.dcp.logger(e);\n        } else {\n          console.error(e);\n        }\n      }\n    },\n\n    _findWidgetName: function vAttribute_findWidgetName($element) {\n      return _.find(\n        _.keys($element.data()),\n        function vAttribute_findWidgetNameFind(currentKey) {\n          return currentKey.indexOf(\"dcpDcp\") !== -1;\n        }\n      );\n    },\n\n    _identifyView: function vAttribute_identifyView(event) {\n      event.haveView = true;\n      //Add the pointer to the current jquery element to a list passed by the event\n      event.elements = event.elements.add(this.$el);\n    }\n  });\n}).apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmRlNjkzNDg4ZmZjOTQ3ZDE4ODEuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvQXBwcy9ET0NVTUVOVC9JSE0vdmlld3MvYXR0cmlidXRlcy92QXR0cmlidXRlLmpzPzc0YzUiXSwic291cmNlc0NvbnRlbnQiOlsiLypnbG9iYWwgZGVmaW5lLCBjb25zb2xlKi9cbmRlZmluZShbXG4gIFwianF1ZXJ5XCIsXG4gIFwidW5kZXJzY29yZVwiLFxuICBcImJhY2tib25lXCIsXG4gIFwibXVzdGFjaGVcIixcbiAgXCJkY3BEb2N1bWVudC92aWV3cy9kb2N1bWVudC9hdHRyaWJ1dGVUZW1wbGF0ZVwiLFxuICBcImRjcERvY3VtZW50L3dpZGdldHMvYXR0cmlidXRlcy9sYWJlbC93TGFiZWxcIixcbiAgXCJkY3BEb2N1bWVudC93aWRnZXRzL2F0dHJpYnV0ZXMvdGV4dC93VGV4dFwiLFxuICBcImRjcERvY3VtZW50L3dpZGdldHMvYXR0cmlidXRlcy9pbnQvd0ludFwiLFxuICBcImRjcERvY3VtZW50L3dpZGdldHMvYXR0cmlidXRlcy9sb25ndGV4dC93TG9uZ3RleHRcIixcbiAgXCJkY3BEb2N1bWVudC93aWRnZXRzL2F0dHJpYnV0ZXMvaHRtbHRleHQvd0h0bWx0ZXh0XCIsXG4gIFwiZGNwRG9jdW1lbnQvd2lkZ2V0cy9hdHRyaWJ1dGVzL3RpbWVzdGFtcC93VGltZXN0YW1wXCIsXG4gIFwiZGNwRG9jdW1lbnQvd2lkZ2V0cy9hdHRyaWJ1dGVzL3RpbWUvd1RpbWVcIixcbiAgXCJkY3BEb2N1bWVudC93aWRnZXRzL2F0dHJpYnV0ZXMvaW1hZ2Uvd0ltYWdlXCIsXG4gIFwiZGNwRG9jdW1lbnQvd2lkZ2V0cy9hdHRyaWJ1dGVzL21vbmV5L3dNb25leVwiLFxuICBcImRjcERvY3VtZW50L3dpZGdldHMvYXR0cmlidXRlcy9lbnVtL3dFbnVtXCIsXG4gIFwiZGNwRG9jdW1lbnQvd2lkZ2V0cy9hdHRyaWJ1dGVzL2NvbG9yL3dDb2xvclwiLFxuICBcImRjcERvY3VtZW50L3dpZGdldHMvYXR0cmlidXRlcy9wYXNzd29yZC93UGFzc3dvcmRcIixcbiAgXCJkY3BEb2N1bWVudC93aWRnZXRzL2F0dHJpYnV0ZXMvZmlsZS93RmlsZVwiLFxuICBcImRjcERvY3VtZW50L3dpZGdldHMvYXR0cmlidXRlcy9kb3VibGUvd0RvdWJsZVwiLFxuICBcImRjcERvY3VtZW50L3dpZGdldHMvYXR0cmlidXRlcy9kb2NpZC93RG9jaWRcIlxuXSwgZnVuY3Rpb24gdkF0dHJpYnV0ZSgkLCBfLCBCYWNrYm9uZSwgTXVzdGFjaGUsIGF0dHJpYnV0ZVRlbXBsYXRlKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIHJldHVybiBCYWNrYm9uZS5WaWV3LmV4dGVuZCh7XG4gICAgY2xhc3NOYW1lOiBcInJvdyBkY3BBdHRyaWJ1dGUgZm9ybS1ncm91cFwiLFxuICAgIGN1c3RvbVZpZXc6IGZhbHNlLFxuICAgIGRpc3BsYXlMYWJlbDogdHJ1ZSxcbiAgICAvL0Rvbid0IHVzZSBzdGFuZGFyZCBldmVudCB0byBsYXVuY2ggdGhlIGV2ZW50IG9ubHkgd2hlbiB0aGVyZSBpcyBubyB0ZW1wbGF0ZVxuICAgIC8vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcbiAgICAvLyBJZiB5b3UgYWRkIGFuIGV2ZW50IGhlcmUsIHlvdSBwcm9iYWJseSB3YW50IHRvIGFkZCBpdCBpbiB2Q29sdW1uLmpzIGFuZCB0ZXN0IGl0IGluIGFuIGFycmF5XG4gICAgLy8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxuICAgIGF0dHJpYnV0ZUV2ZW50czoge1xuICAgICAgXCJkY3BhdHRyaWJ1dGVjaGFuZ2UgLmRjcEF0dHJpYnV0ZV9fY29udGVudCxbZGF0YS1kY3BhdHRyaWJ1dGVfY29udGVudF1cIjpcbiAgICAgICAgXCJ1cGRhdGVWYWx1ZVwiLFxuICAgICAgXCJkY3BhdHRyaWJ1dGVkZWxldGUgLmRjcEF0dHJpYnV0ZV9fY29udGVudFwiOiBcImRlbGV0ZVZhbHVlXCIsXG4gICAgICBcImRjcGF0dHJpYnV0ZWNoYW5nZWF0dHJtZW51dmlzaWJpbGl0eSAuZGNwQXR0cmlidXRlX19jb250ZW50XCI6XG4gICAgICAgIFwiY2hhbmdlTWVudVZpc2liaWxpdHlcIixcbiAgICAgIFwiZGNwYXR0cmlidXRlY2hhbmdlYXR0cnN2YWx1ZSAuZGNwQXR0cmlidXRlX19jb250ZW50XCI6XG4gICAgICAgIFwiY2hhbmdlQXR0cmlidXRlc1ZhbHVlXCIsXG4gICAgICBcImRjcGF0dHJpYnV0ZWZldGNoZG9jdW1lbnQgLmRjcEF0dHJpYnV0ZV9fY29udGVudFwiOiBcImxvYWREb2N1bWVudFwiLFxuICAgICAgXCJkY3BhdHRyaWJ1dGVleHRlcm5hbGxpbmtzZWxlY3RlZCAuZGNwQXR0cmlidXRlX19jb250ZW50XCI6XG4gICAgICAgIFwiZXh0ZXJuYWxMaW5rU2VsZWN0ZWRcIixcbiAgICAgIGRjcGxhYmVsZXh0ZXJuYWxsaW5rc2VsZWN0ZWQ6IFwiZXh0ZXJuYWxMaW5rU2VsZWN0ZWRcIixcbiAgICAgIFwiZGNwYXR0cmlidXRlZG93bmxvYWRmaWxlICAuZGNwQXR0cmlidXRlX19jb250ZW50XCI6IFwiZG93bmxvYWRGaWxlU2VsZWN0XCIsXG4gICAgICBcImRjcGF0dHJpYnV0ZXVwbG9hZGZpbGUgIC5kY3BBdHRyaWJ1dGVfX2NvbnRlbnRcIjogXCJ1cGxvYWRGaWxlU2VsZWN0XCIsXG4gICAgICBcImRjcGF0dHJpYnV0ZXVwbG9hZGZpbGVkb25lICAuZGNwQXR0cmlidXRlX19jb250ZW50XCI6IFwidXBsb2FkRmlsZURvbmVcIixcbiAgICAgIFwiZGNwYXR0cmlidXRlYW5jaG9yY2xpY2sgLmRjcEF0dHJpYnV0ZV9fY29udGVudFwiOiBcImFuY2hvckNsaWNrXCIsXG4gICAgICBcImRjcGF0dHJpYnV0ZXdpZGdldHJlYWR5IC5kY3BBdHRyaWJ1dGVfX2NvbnRlbnRcIjogXCJzZXRXaWRnZXRSZWFkeVwiXG4gICAgfSxcblxuICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uIHZBdHRyaWJ1dGVJbml0aWFsaXplKG9wdGlvbnMpIHtcbiAgICAgIHZhciBldmVudHM7XG4gICAgICB0aGlzLmxpc3RlblRvKHRoaXMubW9kZWwsIFwiY2hhbmdlOmxhYmVsXCIsIHRoaXMucmVmcmVzaExhYmVsKTtcbiAgICAgIHRoaXMubGlzdGVuVG8odGhpcy5tb2RlbCwgXCJjaGFuZ2U6YXR0cmlidXRlVmFsdWVcIiwgdGhpcy5yZWZyZXNoVmFsdWUpO1xuICAgICAgdGhpcy5saXN0ZW5Ubyh0aGlzLm1vZGVsLCBcImNoYW5nZTplcnJvck1lc3NhZ2VcIiwgdGhpcy5yZWZyZXNoRXJyb3IpO1xuICAgICAgdGhpcy5saXN0ZW5Ubyh0aGlzLm1vZGVsLCBcIm1vdmVkXCIsIHRoaXMubW92ZVZhbHVlSW5kZXgpO1xuICAgICAgdGhpcy5saXN0ZW5Ubyh0aGlzLm1vZGVsLCBcImRlc3Ryb3lcIiwgdGhpcy5yZW1vdmUpO1xuICAgICAgdGhpcy5saXN0ZW5Ubyh0aGlzLm1vZGVsLCBcInNob3dUYWJcIiwgdGhpcy5hZnRlclNob3cpO1xuICAgICAgdGhpcy5saXN0ZW5Ubyh0aGlzLm1vZGVsLCBcImhpZGVcIiwgdGhpcy5oaWRlKTtcbiAgICAgIHRoaXMubGlzdGVuVG8odGhpcy5tb2RlbCwgXCJzaG93XCIsIHRoaXMuc2hvdyk7XG4gICAgICB0aGlzLmxpc3RlblRvKHRoaXMubW9kZWwsIFwiaGF2ZVZpZXdcIiwgdGhpcy5faWRlbnRpZnlWaWV3KTtcbiAgICAgIHRoaXMubGlzdGVuVG8odGhpcy5tb2RlbCwgXCJjbG9zZVdpZGdldFwiLCB0aGlzLl9jbG9zZVdpZGdldCk7XG4gICAgICB0aGlzLnRlbXBsYXRlV3JhcHBlciA9IHRoaXMubW9kZWwuZ2V0VGVtcGxhdGVzKCkuYXR0cmlidXRlLnNpbXBsZVdyYXBwZXI7XG5cbiAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuXG4gICAgICBpZiAoXG4gICAgICAgIG9wdGlvbnMuZGlzcGxheUxhYmVsID09PSBmYWxzZSB8fFxuICAgICAgICB0aGlzLm1vZGVsLmdldE9wdGlvbihcImxhYmVsUG9zaXRpb25cIikgPT09IFwibm9uZVwiXG4gICAgICApIHtcbiAgICAgICAgdGhpcy5kaXNwbGF5TGFiZWwgPSBmYWxzZTtcbiAgICAgIH1cblxuICAgICAgaWYgKG9wdGlvbnMub3JpZ2luYWxWaWV3ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgb3B0aW9ucy5vcmlnaW5hbFZpZXcgPSBfLmlzRW1wdHkodGhpcy5tb2RlbC5nZXRPcHRpb24oXCJ0ZW1wbGF0ZVwiKSk7XG4gICAgICB9XG5cbiAgICAgIC8vQXR0cmlidXRlIHdpdGhvdXQgY3VzdG9tIHRlbXBsYXRlIHNvIHdlIGJpbmQgZXZlbnRcbiAgICAgIGlmIChvcHRpb25zLm9yaWdpbmFsVmlldyA9PT0gdHJ1ZSkge1xuICAgICAgICBldmVudHMgPSB0aGlzLmF0dHJpYnV0ZUV2ZW50cztcbiAgICAgICAgLy9Gb3IgdkNvbHVtbiBldmVudHNcbiAgICAgICAgaWYgKF8uaXNGdW5jdGlvbihldmVudHMpKSB7XG4gICAgICAgICAgZXZlbnRzID0gZXZlbnRzLmFwcGx5KHRoaXMpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZGVsZWdhdGVFdmVudHMoZXZlbnRzKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucztcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogVGhlIERhdGEgYXJlIHRoZSBzb3VyY2Ugb2YgZGF0YSBzaGFyZWQgd2l0aCB3aWRnZXQgYW5kIHRlbXBsYXRlc1xuICAgICAqXG4gICAgICogQHBhcmFtIGluZGV4XG4gICAgICogQHJldHVybnMgeyp9XG4gICAgICovXG4gICAgZ2V0RGF0YTogZnVuY3Rpb24gdkF0dHJpYnV0ZUdldERhdGEoaW5kZXgpIHtcbiAgICAgIHZhciBkYXRhO1xuXG4gICAgICAvL01hZGUgdG8gSlNPTiBmb3IgYWxsIHRoZSB2YWx1ZXMsIG9yIHRvIGRhdGEgZm9yIHZhbHVlIGluZGV4ZWQgKGluIGNhcyBvZiBtdWx0aXBsZSlcbiAgICAgIGRhdGEgPSB0aGlzLm1vZGVsLnRvRGF0YShpbmRleCwgdHJ1ZSk7XG4gICAgICBkYXRhLnZpZXdDaWQgPSB0aGlzLmNpZCArIFwiLVwiICsgdGhpcy5tb2RlbC5pZDtcbiAgICAgIGRhdGEubGFiZWxzLmRlbGV0ZUF0dHJpYnV0ZU5hbWVzID0gdGhpcy5nZXREZWxldGVMYWJlbHMoKTtcbiAgICAgIC8vIGF1dG9Db21wbGV0ZSBkZXRlY3RlZFxuICAgICAgZGF0YS5hdXRvY29tcGxldGVSZXF1ZXN0ID0gXy5iaW5kKHRoaXMuYXV0b2NvbXBsZXRlUmVxdWVzdFJlYWQsIHRoaXMpO1xuXG4gICAgICByZXR1cm4gZGF0YTtcbiAgICB9LFxuXG4gICAgcmVuZGVyOiBmdW5jdGlvbiB2QXR0cmlidXRlUmVuZGVyKCkge1xuICAgICAgdmFyIGN1cnJlbnRWaWV3ID0gdGhpcztcbiAgICAgIHZhciByZW5kZXJQcm9taXNlID0gbmV3IFByb21pc2UoXG4gICAgICAgIF8uYmluZChmdW5jdGlvbiB2QXR0cmlidXRlUmVuZGVyX1Byb21pc2UocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgICAgdmFyIGRhdGEsXG4gICAgICAgICAgICBldmVudCA9IHsgcHJldmVudDogZmFsc2UgfSxcbiAgICAgICAgICAgIGN1c3RvbVJlbmRlcjtcblxuICAgICAgICAgIGN1cnJlbnRWaWV3Lm1vZGVsLnRyaWdnZXIoXCJiZWZvcmVSZW5kZXJcIiwgZXZlbnQsIHtcbiAgICAgICAgICAgIG1vZGVsOiBjdXJyZW50Vmlldy5tb2RlbCxcbiAgICAgICAgICAgICRlbDogY3VycmVudFZpZXcuJGVsXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgaWYgKGV2ZW50LnByZXZlbnQpIHtcbiAgICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgICAgIHJldHVybiBjdXJyZW50VmlldztcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvL1dlIGZldGNoIGRhdGEgYWZ0ZXIgYmVmb3JlUmVuZGVyLCBpZiBzb21lIGRhdGEgaXMgbW9kaWZpZWQgYnkgYmVmb3JlUmVuZGVyIHdlIGdldCBpdFxuICAgICAgICAgIGRhdGEgPSBjdXJyZW50Vmlldy5nZXREYXRhKCk7XG5cbiAgICAgICAgICBjdXJyZW50Vmlldy4kZWwuYWRkQ2xhc3MoXG4gICAgICAgICAgICBcImRjcEF0dHJpYnV0ZS0tdHlwZS0tXCIgKyBjdXJyZW50Vmlldy5tb2RlbC5nZXQoXCJ0eXBlXCIpXG4gICAgICAgICAgKTtcbiAgICAgICAgICBjdXJyZW50Vmlldy4kZWwuYWRkQ2xhc3MoXG4gICAgICAgICAgICBcImRjcEF0dHJpYnV0ZS0tdmlzaWJpbGl0eS0tXCIgKyBjdXJyZW50Vmlldy5tb2RlbC5nZXQoXCJ2aXNpYmlsaXR5XCIpXG4gICAgICAgICAgKTtcbiAgICAgICAgICBjdXJyZW50Vmlldy4kZWwuYXR0cihcImRhdGEtYXR0cmlkXCIsIGN1cnJlbnRWaWV3Lm1vZGVsLmdldChcImlkXCIpKTtcbiAgICAgICAgICBpZiAoY3VycmVudFZpZXcubW9kZWwuZ2V0KFwibmVlZGVkXCIpKSB7XG4gICAgICAgICAgICBjdXJyZW50Vmlldy4kZWwuYWRkQ2xhc3MoXCJkY3BBdHRyaWJ1dGUtLW5lZWRlZFwiKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBjdXJyZW50Vmlldy4kZWwuYXBwZW5kKFxuICAgICAgICAgICAgJChNdXN0YWNoZS5yZW5kZXIoY3VycmVudFZpZXcudGVtcGxhdGVXcmFwcGVyIHx8IFwiXCIsIGRhdGEpKVxuICAgICAgICAgICk7XG5cbiAgICAgICAgICBhdHRyaWJ1dGVUZW1wbGF0ZS5pbnNlcnREZXNjcmlwdGlvbihjdXJyZW50Vmlldyk7XG5cbiAgICAgICAgICAvL2FuYWx5emUgdGhlIGRpc3BsYXkgbGFiZWwgYW5kIGFkZCBkaXNwbGF5IGNsYXNzXG4gICAgICAgICAgaWYgKGN1cnJlbnRWaWV3LmRpc3BsYXlMYWJlbCA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgIGN1cnJlbnRWaWV3LiRlbC5maW5kKFwiLmRjcEF0dHJpYnV0ZV9fbGFiZWxcIikucmVtb3ZlKCk7XG4gICAgICAgICAgICAvLyBzZXQgdG8gMTAwJSB3aWR0aFxuICAgICAgICAgICAgY3VycmVudFZpZXcuJGVsXG4gICAgICAgICAgICAgIC5maW5kKFwiLmRjcEF0dHJpYnV0ZV9fcmlnaHRcIilcbiAgICAgICAgICAgICAgLmFkZENsYXNzKFwiZGNwQXR0cmlidXRlX19yaWdodC0tZnVsbFwiKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKGN1cnJlbnRWaWV3Lm1vZGVsLmdldE9wdGlvbihcImxhYmVsUG9zaXRpb25cIikgPT09IFwibGVmdFwiKSB7XG4gICAgICAgICAgICAgIGN1cnJlbnRWaWV3LiRlbC5hZGRDbGFzcyhcImRjcEF0dHJpYnV0ZV9fbGFiZWxQb3NpdGlvbi0tbGVmdFwiKTtcbiAgICAgICAgICAgICAgY3VycmVudFZpZXcuJGVsXG4gICAgICAgICAgICAgICAgLmZpbmQoXCIuZGNwQXR0cmlidXRlX19yaWdodFwiKVxuICAgICAgICAgICAgICAgIC5ub3QoXCIuZGNwQXR0cmlidXRlX19kZXNjcmlwdGlvblwiKVxuICAgICAgICAgICAgICAgIC5hZGRDbGFzcyhcImRjcEF0dHJpYnV0ZV9fbGFiZWxQb3NpdGlvbi0tbGVmdFwiKTtcbiAgICAgICAgICAgICAgY3VycmVudFZpZXcuJGVsXG4gICAgICAgICAgICAgICAgLmZpbmQoXCIuZGNwQXR0cmlidXRlX19sZWZ0XCIpXG4gICAgICAgICAgICAgICAgLm5vdChcIi5kY3BBdHRyaWJ1dGVfX2Rlc2NyaXB0aW9uXCIpXG4gICAgICAgICAgICAgICAgLmFkZENsYXNzKFwiZGNwQXR0cmlidXRlX19sYWJlbFBvc2l0aW9uLS1sZWZ0XCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGN1cnJlbnRWaWV3Lm1vZGVsLmdldE9wdGlvbihcImxhYmVsUG9zaXRpb25cIikgPT09IFwidXBcIikge1xuICAgICAgICAgICAgICBjdXJyZW50Vmlldy4kZWwuYWRkQ2xhc3MoXCJkY3BBdHRyaWJ1dGVfX2xhYmVsUG9zaXRpb24tLXVwXCIpO1xuICAgICAgICAgICAgICBjdXJyZW50Vmlldy4kZWxcbiAgICAgICAgICAgICAgICAuZmluZChcIi5kY3BBdHRyaWJ1dGVfX3JpZ2h0XCIpXG4gICAgICAgICAgICAgICAgLm5vdChcIi5kY3BBdHRyaWJ1dGVfX2Rlc2NyaXB0aW9uXCIpXG4gICAgICAgICAgICAgICAgLmFkZENsYXNzKFwiZGNwQXR0cmlidXRlX19sYWJlbFBvc2l0aW9uLS11cFwiKTtcbiAgICAgICAgICAgICAgY3VycmVudFZpZXcuJGVsXG4gICAgICAgICAgICAgICAgLmZpbmQoXCIuZGNwQXR0cmlidXRlX19sZWZ0XCIpXG4gICAgICAgICAgICAgICAgLm5vdChcIi5kY3BBdHRyaWJ1dGVfX2Rlc2NyaXB0aW9uXCIpXG4gICAgICAgICAgICAgICAgLmFkZENsYXNzKFwiZGNwQXR0cmlidXRlX19sYWJlbFBvc2l0aW9uLS11cFwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChjdXJyZW50Vmlldy5tb2RlbC5nZXRPcHRpb24oXCJsYWJlbFBvc2l0aW9uXCIpID09PSBcImF1dG9cIikge1xuICAgICAgICAgICAgICBjdXJyZW50Vmlldy4kZWwuYWRkQ2xhc3MoXCJkY3BBdHRyaWJ1dGVfX2xhYmVsUG9zaXRpb24tLWF1dG9cIik7XG4gICAgICAgICAgICAgIGN1cnJlbnRWaWV3LiRlbFxuICAgICAgICAgICAgICAgIC5maW5kKFwiLmRjcEF0dHJpYnV0ZV9fcmlnaHRcIilcbiAgICAgICAgICAgICAgICAuYWRkQ2xhc3MoXCJkY3BBdHRyaWJ1dGVfX2xhYmVsUG9zaXRpb24tLWF1dG9cIik7XG4gICAgICAgICAgICAgIGN1cnJlbnRWaWV3LiRlbFxuICAgICAgICAgICAgICAgIC5maW5kKFwiLmRjcEF0dHJpYnV0ZV9fbGVmdFwiKVxuICAgICAgICAgICAgICAgIC5hZGRDbGFzcyhcImRjcEF0dHJpYnV0ZV9fbGFiZWxQb3NpdGlvbi0tYXV0b1wiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGN1cnJlbnRWaWV3LiRlbC5maW5kKFwiLmRjcEF0dHJpYnV0ZV9fbGFiZWxcIikuZGNwTGFiZWwoZGF0YSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy9JZiB0aGVyZSBpcyBhIHRlbXBsYXRlIHJlbmRlciBpdFxuICAgICAgICAgIGlmIChcbiAgICAgICAgICAgIGN1cnJlbnRWaWV3Lm9wdGlvbnMub3JpZ2luYWxWaWV3ICE9PSB0cnVlICYmXG4gICAgICAgICAgICBjdXJyZW50Vmlldy5tb2RlbC5nZXRPcHRpb24oXCJ0ZW1wbGF0ZVwiKVxuICAgICAgICAgICkge1xuICAgICAgICAgICAgY3VzdG9tUmVuZGVyID0gYXR0cmlidXRlVGVtcGxhdGUucmVuZGVyQ3VzdG9tVmlldyhcbiAgICAgICAgICAgICAgY3VycmVudFZpZXcubW9kZWxcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBjdXJyZW50Vmlldy5jdXN0b21WaWV3ID0gY3VzdG9tUmVuZGVyLiRlbDtcbiAgICAgICAgICAgIGN1cnJlbnRWaWV3LiRlbFxuICAgICAgICAgICAgICAuZmluZChcIi5kY3BBdHRyaWJ1dGVfX2NvbnRlbnRcIilcbiAgICAgICAgICAgICAgLmFwcGVuZChjdXJyZW50Vmlldy5jdXN0b21WaWV3KTtcbiAgICAgICAgICAgIGN1c3RvbVJlbmRlci5wcm9taXNlLnRoZW4ocmVzb2x2ZSk7XG4gICAgICAgICAgICBjdXN0b21SZW5kZXIucHJvbWlzZVtcImNhdGNoXCJdKHJlamVjdCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vdGhlcmUgaXMgbm90IHRlbXBsYXRlIHJlbmRlciAoZGVmYXVsdClcbiAgICAgICAgICAgIGN1cnJlbnRWaWV3LiRlbC5vbmUoXG4gICAgICAgICAgICAgIFwiZGNwYXR0cmlidXRld2lkZ2V0cmVhZHkgLmRjcEF0dHJpYnV0ZV9fY29udGVudFwiLFxuICAgICAgICAgICAgICBmdW5jdGlvbiB2YXR0cmlidXRlUmVuZGVyX3dpZGdldHJlYWR5KCkge1xuICAgICAgICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIGN1cnJlbnRWaWV3LmN1cnJlbnREY3BXaWRnZXQgPSBjdXJyZW50Vmlldy53aWRnZXRJbml0KFxuICAgICAgICAgICAgICBjdXJyZW50Vmlldy4kZWwuZmluZChcIi5kY3BBdHRyaWJ1dGVfX2NvbnRlbnRcIiksXG4gICAgICAgICAgICAgIGRhdGFcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgY3VycmVudFZpZXcucmVuZGVyRG9uZSA9IHRydWU7XG4gICAgICAgICAgaWYgKGN1cnJlbnRWaWV3LmN1c3RvbVZpZXcpIHtcbiAgICAgICAgICAgIGN1cnJlbnRWaWV3LndpZGdldFJlYWR5ID0gdHJ1ZTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBjdXJyZW50Vmlldy50cmlnZ2VyUmVuZGVyRG9uZSgpO1xuICAgICAgICAgIHJldHVybiBjdXJyZW50VmlldztcbiAgICAgICAgfSwgdGhpcylcbiAgICAgICk7XG4gICAgICByZXR1cm4gcmVuZGVyUHJvbWlzZTtcbiAgICB9LFxuXG4gICAgcmVmcmVzaExhYmVsOiBmdW5jdGlvbiB2QXR0cmlidXRlUmVmcmVzaExhYmVsKCkge1xuICAgICAgdmFyIGxhYmVsID0gdGhpcy5tb2RlbC5nZXQoXCJsYWJlbFwiKSxcbiAgICAgICAgbGFiZWxEb20gPSB0aGlzLmdldERPTUVsZW1lbnRzKCkuZmluZChcIi5kY3BBdHRyaWJ1dGVfX2xhYmVsXCIpO1xuICAgICAgaWYgKHRoaXMubW9kZWwuZ2V0T3B0aW9uKFwiYXR0cmlidXRlTGFiZWxcIikpIHtcbiAgICAgICAgbGFiZWwgPSB0aGlzLm1vZGVsLmdldE9wdGlvbihcImF0dHJpYnV0ZUxhYmVsXCIpO1xuICAgICAgfVxuICAgICAgaWYgKGxhYmVsRG9tLmRhdGEoXCJkY3BEY3BMYWJlbFwiKSkge1xuICAgICAgICB0aGlzLmdldERPTUVsZW1lbnRzKClcbiAgICAgICAgICAuZmluZChcIi5kY3BBdHRyaWJ1dGVfX2xhYmVsXCIpXG4gICAgICAgICAgLmRjcExhYmVsKFwic2V0TGFiZWxcIiwgbGFiZWwpO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBBdXRvcmVmcmVzaCB2YWx1ZSB3aGVuIG1vZGVsIGNoYW5nZVxuICAgICAqL1xuICAgIHJlZnJlc2hWYWx1ZTogZnVuY3Rpb24gdkF0dHJpYnV0ZVJlZnJlc2hWYWx1ZShtb2RlbCwgdmFsdWVzLCBvcHRpb25zKSB7XG4gICAgICB2YXIgc2NvcGUgPSB0aGlzLFxuICAgICAgICBhbGxXcmFwcGVyLFxuICAgICAgICBhcnJheVdyYXBwZXI7XG4gICAgICBpZiAob3B0aW9ucy5ub3RVcGRhdGVBcnJheSkge1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgIH1cblxuICAgICAgYWxsV3JhcHBlciA9IHRoaXMuZ2V0RE9NRWxlbWVudHMoKTtcblxuICAgICAgaWYgKHRoaXMubW9kZWwuaXNJbkFycmF5KCkpIHtcbiAgICAgICAgLy8gYWRqdXN0IGxpbmUgbnVtYmVyIHRvIGNvbHVtbiBsZW5ndGhcbiAgICAgICAgYXJyYXlXcmFwcGVyID0gdGhpcy4kZWw7XG4gICAgICAgIGFycmF5V3JhcHBlci5kY3BBcnJheShcInNldExpbmVzXCIsIHZhbHVlcy5sZW5ndGgsIG9wdGlvbnMpLnRoZW4oXG4gICAgICAgICAgXy5iaW5kKGZ1bmN0aW9uIHZBdHRyaWJ1dGVEcmF3VmFsdWUoKSB7XG4gICAgICAgICAgICB2YWx1ZXMgPSBfLnRvQXJyYXkodmFsdWVzKTtcblxuICAgICAgICAgICAgaWYgKF8uaXNFcXVhbCh2YWx1ZXMsIHNjb3BlLm1vZGVsLmdldFZhbHVlKCkpKSB7XG4gICAgICAgICAgICAgIF8uZWFjaCh2YWx1ZXMsIGZ1bmN0aW9uIGFuYWx5emVWYWx1ZXMoY3VycmVudFZhbHVlLCBpbmRleCkge1xuICAgICAgICAgICAgICAgIGlmIChfLmlzVW5kZWZpbmVkKGN1cnJlbnRWYWx1ZSkpIHtcbiAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdmFyIGNzc0luZGV4ID1cbiAgICAgICAgICAgICAgICAgICcuZGNwQXR0cmlidXRlX19jb250ZW50LS13aWRnZXRbZGF0YS1hdHRyaWQ9XCInICtcbiAgICAgICAgICAgICAgICAgIG1vZGVsLmlkICtcbiAgICAgICAgICAgICAgICAgICdcIl0nO1xuICAgICAgICAgICAgICAgICQoYWxsV3JhcHBlcltpbmRleF0pXG4gICAgICAgICAgICAgICAgICAuZmluZChjc3NJbmRleClcbiAgICAgICAgICAgICAgICAgIC5hZGRCYWNrKGNzc0luZGV4KVxuICAgICAgICAgICAgICAgICAgLmVhY2goZnVuY3Rpb24gdkF0dHJpYnV0ZVJlZnJlc2hPbmVWYWx1ZShpbmRleCwgZWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICBzY29wZS53aWRnZXRBcHBseSgkKGVsZW1lbnQpLCBcInNldFZhbHVlXCIsIGN1cnJlbnRWYWx1ZSk7XG4gICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSwgdGhpcylcbiAgICAgICAgKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMud2lkZ2V0QXBwbHkoXG4gICAgICAgICAgYWxsV3JhcHBlci5maW5kKFxuICAgICAgICAgICAgJy5kY3BBdHRyaWJ1dGVfX2NvbnRlbnQtLXdpZGdldFtkYXRhLWF0dHJpZD1cIicgKyBtb2RlbC5pZCArICdcIl0nXG4gICAgICAgICAgKSxcbiAgICAgICAgICBcInNldFZhbHVlXCIsXG4gICAgICAgICAgdmFsdWVzXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIERpc3BsYXkgZXJyb3IgbWVzc2FnZSBhcm91bmQgdGhlIHdpZGdldCBpZiBuZWVkZWRcbiAgICAgKiBAcGFyYW0gZXZlbnRcbiAgICAgKi9cbiAgICByZWZyZXNoRXJyb3I6IGZ1bmN0aW9uIHZBdHRyaWJ1dGVSZWZyZXNoRXJyb3IoKSB7XG4gICAgICB0aGlzLiRlbFxuICAgICAgICAuZmluZChcIi5kY3BBdHRyaWJ1dGVfX2xhYmVsXCIpXG4gICAgICAgIC5kY3BMYWJlbChcInNldEVycm9yXCIsIHRoaXMubW9kZWwuZ2V0KFwiZXJyb3JNZXNzYWdlXCIpKTtcbiAgICAgIC8vIGFuZFNlbGYgbWV0aG9kIHdhcyByZW1vdmVkIGZyb20galF1ZXJ5IDMuMC4wKyB1c2UgYWRkQmFjayBpbnN0ZWFkXG4gICAgICB2YXIganF1ZXJ5VmVyc2lvbiA9ICskKCkuanF1ZXJ5LnNwbGl0KFwiLlwiKVswXTtcbiAgICAgIGlmIChqcXVlcnlWZXJzaW9uID49IDMpIHtcbiAgICAgICAgdGhpcy53aWRnZXRBcHBseShcbiAgICAgICAgICB0aGlzLmdldERPTUVsZW1lbnRzKClcbiAgICAgICAgICAgIC5maW5kKFwiLmRjcEF0dHJpYnV0ZV9fY29udGVudC0td2lkZ2V0XCIpXG4gICAgICAgICAgICAuYWRkQmFjaygpXG4gICAgICAgICAgICAuZmlsdGVyKFwiLmRjcEF0dHJpYnV0ZV9fY29udGVudC0td2lkZ2V0XCIpLFxuICAgICAgICAgIFwic2V0RXJyb3JcIixcbiAgICAgICAgICB0aGlzLm1vZGVsLmdldChcImVycm9yTWVzc2FnZVwiKVxuICAgICAgICApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy53aWRnZXRBcHBseShcbiAgICAgICAgICB0aGlzLmdldERPTUVsZW1lbnRzKClcbiAgICAgICAgICAgIC5maW5kKFwiLmRjcEF0dHJpYnV0ZV9fY29udGVudC0td2lkZ2V0XCIpXG4gICAgICAgICAgICAuYW5kU2VsZigpXG4gICAgICAgICAgICAuZmlsdGVyKFwiLmRjcEF0dHJpYnV0ZV9fY29udGVudC0td2lkZ2V0XCIpLFxuICAgICAgICAgIFwic2V0RXJyb3JcIixcbiAgICAgICAgICB0aGlzLm1vZGVsLmdldChcImVycm9yTWVzc2FnZVwiKVxuICAgICAgICApO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBNb2RpZnkgc2V2ZXJhbCBhdHRyaWJ1dGVcbiAgICAgKiBAcGFyYW0gZXZlbnQgZXZlbnQgb2JqZWN0XG4gICAgICogQHBhcmFtIGluZGV4IHRoZSB2YWx1ZSByYW5rIGluIGNhc2Ugb2YgbXVsdGlwbGVcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyBvYmplY3Qge2RhdGFJdGVtIDosIHZhbHVlSW5kZXggOn1cbiAgICAgKi9cbiAgICBjaGFuZ2VBdHRyaWJ1dGVzVmFsdWU6IGZ1bmN0aW9uIHZBdHRyaWJ1dGVDaGFuZ2VBdHRyaWJ1dGVzVmFsdWUoXG4gICAgICBldmVudCxcbiAgICAgIG9wdGlvbnMsXG4gICAgICBpbmRleFxuICAgICkge1xuICAgICAgdmFyIGV4dGVybmFsRXZlbnQgPSB7IHByZXZlbnQ6IGZhbHNlIH0sXG4gICAgICAgIGN1cnJlbnRWaWV3ID0gdGhpcyxcbiAgICAgICAgZGF0YUl0ZW0gPSBvcHRpb25zLmRhdGFJdGVtLFxuICAgICAgICB2YWx1ZUluZGV4ID0gb3B0aW9ucy52YWx1ZUluZGV4LFxuICAgICAgICBjdXJyZW50VmFsdWU7XG4gICAgICB0aGlzLm1vZGVsLnRyaWdnZXIoXG4gICAgICAgIFwiaGVscGVyU2VsZWN0XCIsXG4gICAgICAgIGV4dGVybmFsRXZlbnQsXG4gICAgICAgIHRoaXMubW9kZWwuaWQsXG4gICAgICAgIGRhdGFJdGVtLFxuICAgICAgICBpbmRleFxuICAgICAgKTtcbiAgICAgIGlmIChleHRlcm5hbEV2ZW50LnByZXZlbnQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICB9XG4gICAgICBfLmVhY2goZGF0YUl0ZW0udmFsdWVzLCBmdW5jdGlvbiB2QXR0cmlidXRlQ2hhbmdlQXR0cmlidXRlVmFsdWUoXG4gICAgICAgIGF0dHJpYnV0ZVZhbHVlLFxuICAgICAgICBhdHRyaWJ1dGVJZFxuICAgICAgKSB7XG4gICAgICAgIGlmICh0eXBlb2YgYXR0cmlidXRlVmFsdWUgPT09IFwib2JqZWN0XCIpIHtcbiAgICAgICAgICBpZiAoYXR0cmlidXRlVmFsdWUudmFsdWUgPT09IG51bGwpIHtcbiAgICAgICAgICAgIC8vVmFsdWUgbm90IGNvbXBsZXRlZCBieSBoZWxwZXIgc28gZG9uJ3QgdXNlIGl0XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgdmFyIGF0dHJNb2RlbCA9IGN1cnJlbnRWaWV3Lm1vZGVsXG4gICAgICAgICAgICAuZ2V0RG9jdW1lbnRNb2RlbCgpXG4gICAgICAgICAgICAuZ2V0KFwiYXR0cmlidXRlc1wiKVxuICAgICAgICAgICAgLmdldChhdHRyaWJ1dGVJZCk7XG4gICAgICAgICAgaWYgKGF0dHJNb2RlbCkge1xuICAgICAgICAgICAgaWYgKGF0dHJNb2RlbC5oYXNNdWx0aXBsZU9wdGlvbigpKSB7XG4gICAgICAgICAgICAgIGN1cnJlbnRWYWx1ZSA9IGF0dHJNb2RlbC5nZXRWYWx1ZSgpO1xuICAgICAgICAgICAgICBpZiAodmFsdWVJbmRleCA+PSAwKSB7XG4gICAgICAgICAgICAgICAgY3VycmVudFZhbHVlID0gY3VycmVudFZhbHVlW3ZhbHVlSW5kZXhdO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIC8vIE5vIGFkZCBzYW1lIHZhbHVlIHR3aWNlXG4gICAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgICAhXy5zb21lKGN1cnJlbnRWYWx1ZSwgZnVuY3Rpb24gdkF0dHJpYnV0ZU5vRG91YmxlKGl0ZW1WYWx1ZSkge1xuICAgICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW1WYWx1ZS52YWx1ZSA9PT0gYXR0cmlidXRlVmFsdWUudmFsdWU7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgYXR0ck1vZGVsLmFkZFZhbHVlKFxuICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogYXR0cmlidXRlVmFsdWUudmFsdWUsXG4gICAgICAgICAgICAgICAgICAgIGRpc3BsYXlWYWx1ZTogYXR0cmlidXRlVmFsdWUuZGlzcGxheVZhbHVlXG4gICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgdmFsdWVJbmRleFxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGF0dHJNb2RlbC5zZXRWYWx1ZShcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICB2YWx1ZTogYXR0cmlidXRlVmFsdWUudmFsdWUsXG4gICAgICAgICAgICAgICAgICBkaXNwbGF5VmFsdWU6IGF0dHJpYnV0ZVZhbHVlLmRpc3BsYXlWYWx1ZVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgdmFsdWVJbmRleFxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiVW5hYmxlIHRvIGZpbmQgXCIgKyBhdHRyaWJ1dGVJZCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogTW9kaWZ5IHZpZXcgOiB0cmlnZ2VyZWQgYnkgd0RvY2lkXG4gICAgICogQHBhcmFtIGV2ZW50XG4gICAgICogQHBhcmFtIG9wdGlvbnNcbiAgICAgKiBAcmV0dXJucyB7Kn1cbiAgICAgKi9cbiAgICBsb2FkRG9jdW1lbnQ6IGZ1bmN0aW9uIGNoYW5nZUF0dHJpYnV0ZXNWYWx1ZUxvYWREb2N1bWVudChldmVudCwgb3B0aW9ucykge1xuICAgICAgdmFyIGluZGV4ID0gb3B0aW9ucy5pbmRleCxcbiAgICAgICAgaW5pdGlkID0gbnVsbCxcbiAgICAgICAgYXR0cmlidXRlVmFsdWUgPSB0aGlzLm1vZGVsLmdldChcImF0dHJpYnV0ZVZhbHVlXCIpLFxuICAgICAgICBkb2N1bWVudE1vZGVsID0gdGhpcy5tb2RlbC5nZXREb2N1bWVudE1vZGVsKCksXG4gICAgICAgIHJldmlzaW9uID0gLTE7XG4gICAgICBpZiAoXy5pc1VuZGVmaW5lZChpbmRleCkpIHtcbiAgICAgICAgaW5pdGlkID0gYXR0cmlidXRlVmFsdWUudmFsdWU7XG4gICAgICAgIHJldmlzaW9uID0gYXR0cmlidXRlVmFsdWUucmV2aXNpb247XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpbml0aWQgPSBhdHRyaWJ1dGVWYWx1ZVtpbmRleF0udmFsdWU7XG4gICAgICAgIHJldmlzaW9uID0gYXR0cmlidXRlVmFsdWVbaW5kZXhdLnJldmlzaW9uO1xuICAgICAgfVxuXG4gICAgICB0aGlzLm1vZGVsLnRyaWdnZXIoXCJpbnRlcm5hbExpbmtTZWxlY3RlZFwiLCBldmVudCwge1xuICAgICAgICBldmVudElkOiBcImRvY3VtZW50LmxvYWRcIixcbiAgICAgICAgdGFyZ2V0OiBldmVudC50YXJnZXQsXG4gICAgICAgIGF0dHJpZDogdGhpcy5tb2RlbC5pZCxcbiAgICAgICAgb3B0aW9uczogW2luaXRpZCwgXCIhZGVmYXVsdENvbnN1bHRhdGlvblwiXSxcbiAgICAgICAgaW5kZXg6IG9wdGlvbnMuaW5kZXhcbiAgICAgIH0pO1xuXG4gICAgICBpZiAoZXZlbnQucHJldmVudCkge1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgIH1cblxuICAgICAgZG9jdW1lbnRNb2RlbC50cmlnZ2VyKFwibG9hZERvY3VtZW50XCIsIHtcbiAgICAgICAgaW5pdGlkOiBpbml0aWQsXG4gICAgICAgIHZpZXdJZDogXCIhZGVmYXVsdENvbnN1bHRhdGlvblwiLFxuICAgICAgICByZXZpc2lvbjogcmV2aXNpb25cbiAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGUgZGlhbG9nIHdpbmRvdyB0byBjcmVhdGUgYW5kIGluc2VydCBkb2N1bWVudFxuICAgICAqL1xuICAgIGRpc3BsYXlGb3JtRG9jdW1lbnQ6IGZ1bmN0aW9uIHZBdHRyaWJ1dGVkaXNwbGF5Rm9ybURvY3VtZW50KFxuICAgICAgZXZlbnQsXG4gICAgICBidXR0b25Db25maWcsXG4gICAgICBpbmRleFxuICAgICkge1xuICAgICAgdmFyIGF0dHJpZCA9IHRoaXMubW9kZWwuaWQ7XG4gICAgICBpZiAoYnV0dG9uQ29uZmlnLmNyZWF0ZUxhYmVsKSB7XG4gICAgICAgIHZhciBkb2N1bWVudE1vZGVsID0gdGhpcy5tb2RlbC5nZXREb2N1bWVudE1vZGVsKCk7XG5cbiAgICAgICAgcmVxdWlyZS5lbnN1cmUoXG4gICAgICAgICAgW1wiZGNwRG9jdW1lbnQvd2lkZ2V0cy9hdHRyaWJ1dGVzL2RvY2lkL3dDcmVhdGVEb2N1bWVudFwiXSxcbiAgICAgICAgICBmdW5jdGlvbiB2RG9jdW1lbnRDcmVhdGVEb2N1bWVudCgpIHtcbiAgICAgICAgICAgIHJlcXVpcmUoXCJkY3BEb2N1bWVudC93aWRnZXRzL2F0dHJpYnV0ZXMvZG9jaWQvd0NyZWF0ZURvY3VtZW50XCIpO1xuICAgICAgICAgICAgdmFyICRiZHcgPSAkKCc8ZGl2IGNsYXNzPVwiZGNwRG9jaWQtY3JlYXRlLXdpbmRvd1wiLz4nKTtcbiAgICAgICAgICAgIHZhciAkZGNwID0gJGJkd1xuICAgICAgICAgICAgICAuZGNwQ3JlYXRlRG9jdW1lbnQoXG4gICAgICAgICAgICAgICAgXy5leHRlbmQoYnV0dG9uQ29uZmlnLCB7XG4gICAgICAgICAgICAgICAgICBvcmlnaW5Eb2N1bWVudE1vZGVsOiBkb2N1bWVudE1vZGVsLFxuICAgICAgICAgICAgICAgICAgYXR0cmlidXRlSWQ6IGF0dHJpZCxcbiAgICAgICAgICAgICAgICAgIGluZGV4OiBpbmRleCxcbiAgICAgICAgICAgICAgICAgIGxpc3RlbmVyOiBmdW5jdGlvbiB2RG9jdW1lbnRDcmVhdGVMaXN0ZW5lcihcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQsXG4gICAgICAgICAgICAgICAgICAgIHRyaWdnZXJJZCxcbiAgICAgICAgICAgICAgICAgICAgb3B0aW9uc1xuICAgICAgICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZGlhbG9nRG9jdW1lbnQgPSB0aGlzO1xuICAgICAgICAgICAgICAgICAgICBvcHRpb25zLnRyaWdnZXJJZCA9IHRyaWdnZXJJZDtcbiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnRNb2RlbC50cmlnZ2VyKFxuICAgICAgICAgICAgICAgICAgICAgIFwiY3JlYXRlRGlhbG9nTGlzdGVuZXJcIixcbiAgICAgICAgICAgICAgICAgICAgICBldmVudCxcbiAgICAgICAgICAgICAgICAgICAgICBhdHRyaWQsXG4gICAgICAgICAgICAgICAgICAgICAgb3B0aW9uc1xuICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgLmRhdGEoXCJkY3BDcmVhdGVEb2N1bWVudFwiKTtcbiAgICAgICAgICAgICRkY3Aub3BlbigpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJ3Q3JlYXRlRG9jdW1lbnRcIlxuICAgICAgICApO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICBleHRlcm5hbExpbmtTZWxlY3RlZDogZnVuY3Rpb24gdkF0dHJpYnV0ZUV4dGVybmFsTGlua1NlbGVjdGVkKFxuICAgICAgZXZlbnQsXG4gICAgICBvcHRpb25zXG4gICAgKSB7XG4gICAgICB2YXIgZG9jdW1lbnRNb2RlbCA9IHRoaXMubW9kZWwuZ2V0RG9jdW1lbnRNb2RlbCgpO1xuICAgICAgb3B0aW9ucy5hdHRyaWQgPSB0aGlzLm1vZGVsLmlkO1xuICAgICAgdGhpcy5tb2RlbC50cmlnZ2VyKFwiaW50ZXJuYWxMaW5rU2VsZWN0ZWRcIiwgZXZlbnQsIG9wdGlvbnMpO1xuICAgICAgaWYgKGV2ZW50LnByZXZlbnQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICB9XG4gICAgICBpZiAob3B0aW9ucy5ldmVudElkID09PSBcImF0dHJpYnV0ZS5jcmVhdGVEb2N1bWVudFJlbGF0aW9uXCIpIHtcbiAgICAgICAgdGhpcy5kaXNwbGF5Rm9ybURvY3VtZW50KGV2ZW50LCBvcHRpb25zLmJ1dHRvbkNvbmZpZywgb3B0aW9ucy5pbmRleCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBkb2N1bWVudE1vZGVsLnRyaWdnZXIoXCJhY3Rpb25BdHRyaWJ1dGVMaW5rXCIsIGV2ZW50LCBvcHRpb25zKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIGRvd25sb2FkRmlsZVNlbGVjdDogZnVuY3Rpb24gdkF0dHJpYnV0ZWRvd25sb2FkRmlsZVNlbGVjdChcbiAgICAgIHdpZGdldEV2ZW50LFxuICAgICAgb3B0aW9uc1xuICAgICkge1xuICAgICAgdGhpcy5tb2RlbC50cmlnZ2VyKFwiZG93bmxvYWRGaWxlXCIsIHdpZGdldEV2ZW50LCB0aGlzLm1vZGVsLmlkLCBvcHRpb25zKTtcbiAgICB9LFxuICAgIHVwbG9hZEZpbGVTZWxlY3Q6IGZ1bmN0aW9uIHZBdHRyaWJ1dGV1cGxvYWRGaWxlU2VsZWN0KFxuICAgICAgd2lkZ2V0RXZlbnQsXG4gICAgICBvcHRpb25zXG4gICAgKSB7XG4gICAgICB0aGlzLm1vZGVsLnRyaWdnZXIoXCJ1cGxvYWRGaWxlXCIsIHdpZGdldEV2ZW50LCB0aGlzLm1vZGVsLmlkLCBvcHRpb25zKTtcbiAgICB9LFxuICAgIHVwbG9hZEZpbGVEb25lOiBmdW5jdGlvbiB2QXR0cmlidXRldXBsb2FkRmlsZVNFbmQod2lkZ2V0RXZlbnQsIG9wdGlvbnMpIHtcbiAgICAgIHRoaXMubW9kZWwudHJpZ2dlcihcInVwbG9hZEZpbGVEb25lXCIsIHdpZGdldEV2ZW50LCB0aGlzLm1vZGVsLmlkLCBvcHRpb25zKTtcbiAgICB9LFxuXG4gICAgYW5jaG9yQ2xpY2s6IGZ1bmN0aW9uIHZBdHRyaWJ1dGVBbmNob3JDbGljayh3aWRnZXRFdmVudCwgb3B0aW9ucykge1xuICAgICAgdGhpcy5tb2RlbC50cmlnZ2VyKFwiYW5jaG9yQ2xpY2tcIiwgd2lkZ2V0RXZlbnQsIHRoaXMubW9kZWwuaWQsIG9wdGlvbnMpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBEZWxldGUgdmFsdWUsXG4gICAgICogSWYgaGFzIGhlbHAsIGNsZWFyIGFsc28gdGFyZ2V0IGF0dHJpYnV0ZXNcbiAgICAgKiBAcGFyYW0gZXZlbnRcbiAgICAgKiBAcGFyYW0gZGF0YSBpbmRleCBpbmZvIHtpbmRleDpcInRoZSBpbmRleH1cbiAgICAgKi9cbiAgICBkZWxldGVWYWx1ZTogZnVuY3Rpb24gY2hhbmdlQXR0cmlidXRlc1ZhbHVlRGVsZXRlVmFsdWUoZXZlbnQsIGRhdGEpIHtcbiAgICAgIGlmIChkYXRhLmlkID09PSB0aGlzLm1vZGVsLmlkKSB7XG4gICAgICAgIHZhciBhdHRyVG9DbGVhciA9IHRoaXMubW9kZWwuZ2V0KFwiaGVscE91dHB1dHNcIiksXG4gICAgICAgICAgZG9jTW9kZWwgPSB0aGlzLm1vZGVsLmdldERvY3VtZW50TW9kZWwoKTtcbiAgICAgICAgaWYgKCFhdHRyVG9DbGVhciB8fCB0eXBlb2YgYXR0clRvQ2xlYXIgPT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgICBhdHRyVG9DbGVhciA9IFt0aGlzLm1vZGVsLmlkXTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBhdHRyVG9DbGVhciA9IF8udG9BcnJheShhdHRyVG9DbGVhcik7XG4gICAgICAgIH1cbiAgICAgICAgXy5lYWNoKGF0dHJUb0NsZWFyLCBmdW5jdGlvbiB2QXR0cmlidXRlQ2xlYW5Bc3NvY2lhdGVkRWxlbWVudChhaWQpIHtcbiAgICAgICAgICB2YXIgYXR0ciA9IGRvY01vZGVsLmdldChcImF0dHJpYnV0ZXNcIikuZ2V0KGFpZCk7XG4gICAgICAgICAgaWYgKGF0dHIpIHtcbiAgICAgICAgICAgIGlmIChhdHRyLmhhc011bHRpcGxlT3B0aW9uKCkpIHtcbiAgICAgICAgICAgICAgYXR0ci5zZXRWYWx1ZShbXSwgZGF0YS5pbmRleCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBhdHRyLnNldFZhbHVlKHsgdmFsdWU6IG51bGwsIGRpc3BsYXlWYWx1ZTogXCJcIiB9LCBkYXRhLmluZGV4KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm4gYW5vdGhlciBhdHRyaWJ1dGUgbW9kZWxcbiAgICAgKlxuICAgICAqIEBwYXJhbSBhdHRyaWJ1dGVJZFxuICAgICAqIEByZXR1cm5zIHsqfVxuICAgICAqL1xuICAgIGdldEF0dHJpYnV0ZU1vZGVsOiBmdW5jdGlvbiB2QXR0cmlidXRlR2V0QXR0cmlidXRlTW9kZWwoYXR0cmlidXRlSWQpIHtcbiAgICAgIHZhciBkb2NNb2RlbCA9IHRoaXMubW9kZWwuZ2V0RG9jdW1lbnRNb2RlbCgpO1xuICAgICAgcmV0dXJuIGRvY01vZGVsLmdldChcImF0dHJpYnV0ZXNcIikuZ2V0KGF0dHJpYnV0ZUlkKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogVXNlZCBmb3IgcmVuZGVyIGF0dHJpYnV0ZVxuICAgICAqXG4gICAgICogQHJldHVybnMge0FycmF5fVxuICAgICAqL1xuICAgIGdldERlbGV0ZUxhYmVsczogZnVuY3Rpb24gdkF0dHJpYnV0ZUdldERlbGV0ZUxhYmVscygpIHtcbiAgICAgIHZhciBhdHRyVG9DbGVhciA9IHRoaXMubW9kZWwuZ2V0KFwiaGVscE91dHB1dHNcIiksXG4gICAgICAgIHNjb3BlID0gdGhpcyxcbiAgICAgICAgYXR0ckxhYmVscztcbiAgICAgIGlmICghYXR0clRvQ2xlYXIgfHwgdHlwZW9mIGF0dHJUb0NsZWFyID09PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgIGF0dHJUb0NsZWFyID0gW3RoaXMubW9kZWwuaWRdO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgYXR0clRvQ2xlYXIgPSBfLnRvQXJyYXkoYXR0clRvQ2xlYXIpO1xuICAgICAgfVxuICAgICAgYXR0ckxhYmVscyA9IF8ubWFwKGF0dHJUb0NsZWFyLCBmdW5jdGlvbiB2QXR0cmlidXRlR2V0QXNzb2NpYXRlZExhYmVsKFxuICAgICAgICBhaWRcbiAgICAgICkge1xuICAgICAgICB2YXIgYXR0ciA9IHNjb3BlLmdldEF0dHJpYnV0ZU1vZGVsKGFpZCk7XG4gICAgICAgIGlmIChhdHRyKSB7XG4gICAgICAgICAgcmV0dXJuIGF0dHIuYXR0cmlidXRlcy5sYWJlbDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gXCJcIjtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGF0dHJMYWJlbHM7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIFByb3BhZ2F0ZSBtb3ZlIHZhbHVlIGV2ZW50IHRvIHdpZGdldHNcbiAgICAgKiBAcGFyYW0gZXZlbnREYXRhXG4gICAgICovXG4gICAgbW92ZVZhbHVlSW5kZXg6IGZ1bmN0aW9uIHZBdHRyaWJ1dGVNb3ZlVmFsdWVJbmRleChldmVudERhdGEpIHtcbiAgICAgIHRoaXMuZ2V0RE9NRWxlbWVudHMoKS50cmlnZ2VyKFwicG9zdE1vdmVkXCIsIGV2ZW50RGF0YSk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIG1ldGhvZCB1c2UgZm9yIHRyYW5zcG9ydCBtdWx0aXNlbGVjdCB3aWRnZXRcbiAgICAgKiBAcGFyYW0gaW5kZXggdGhlIHJvdyBpbmRleCBvZiBhdXRvY29tcGxldGUgd2hlbiBpdCBpcyBpbiBhcnJheVxuICAgICAqIEBwYXJhbSBvcHRpb25zXG4gICAgICovXG4gICAgYXV0b2NvbXBsZXRlUmVxdWVzdFJlYWQ6IGZ1bmN0aW9uIHZBdHRyaWJ1dGVBdXRvY29tcGxldGVSZXF1ZXN0UmVhZChcbiAgICAgIG9wdGlvbnMsXG4gICAgICBpbmRleFxuICAgICkge1xuICAgICAgdmFyIGN1cnJlbnRWaWV3ID0gdGhpcyxcbiAgICAgICAgZG9jdW1lbnRNb2RlbCA9IHRoaXMubW9kZWwuZ2V0RG9jdW1lbnRNb2RlbCgpLFxuICAgICAgICBzdWNjZXNzID0gb3B0aW9ucy5zdWNjZXNzLFxuICAgICAgICBleHRlcm5hbE9wdGlvbnMgPSB7XG4gICAgICAgICAgc2V0UmVzdWx0OiBmdW5jdGlvbiB2QXR0cmlidXRlQXV0b0NvbXBsZXRlU2V0KGNvbnRlbnQpIHtcbiAgICAgICAgICAgIF8uZWFjaChjb250ZW50LCBmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgICAgIGlmIChpdGVtLm1lc3NhZ2UpIHtcbiAgICAgICAgICAgICAgICBpdGVtLm1lc3NhZ2UuY29udGVudFRleHQgPSBpdGVtLm1lc3NhZ2UuY29udGVudFRleHQgfHwgXCJcIjtcbiAgICAgICAgICAgICAgICBpdGVtLm1lc3NhZ2UuY29udGVudEh0bWwgPSBpdGVtLm1lc3NhZ2UuY29udGVudEh0bWwgfHwgXCJcIjtcbiAgICAgICAgICAgICAgICBpdGVtLm1lc3NhZ2UudHlwZSA9IGl0ZW0ubWVzc2FnZS50eXBlIHx8IFwibWVzc2FnZVwiO1xuICAgICAgICAgICAgICB9IGVsc2UgaWYgKGl0ZW0uZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBpdGVtLm1lc3NhZ2UgPSB7XG4gICAgICAgICAgICAgICAgICBjb250ZW50SHRtbDogXCJcIixcbiAgICAgICAgICAgICAgICAgIGNvbnRlbnRUZXh0OiBpdGVtLmVycm9yLFxuICAgICAgICAgICAgICAgICAgdHlwZTogXCJlcnJvclwiXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBpdGVtLnRpdGxlID0gaXRlbS50aXRsZSB8fCBcIlwiO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBzdWNjZXNzKGNvbnRlbnQpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZGF0YTogb3B0aW9ucy5kYXRhXG4gICAgICAgIH0sXG4gICAgICAgIGF1dG9jb21wbGV0ZVVybCxcbiAgICAgICAgZXZlbnQgPSB7IHByZXZlbnQ6IGZhbHNlIH07XG4gICAgICAvL0FkZCBoZWxwZXJSZXNvbnNlIGV2ZW50IChjYW4gYmUgdXNlZCB0byByZXByb2Nlc3MgdGhlIGNvbnRlbnQgb2YgdGhlIHJlcXVlc3QpXG4gICAgICBzdWNjZXNzID0gXy53cmFwKHN1Y2Nlc3MsIGZ1bmN0aW9uIHZBdHRyaWJ1dGVBdXRvQ29tcGxldGVTdWNjZXNzKFxuICAgICAgICBzdWNjZXNzLFxuICAgICAgICBjb250ZW50XG4gICAgICApIHtcbiAgICAgICAgdmFyIG9wdGlvbnMgPSB7fSxcbiAgICAgICAgICBldmVudCA9IHsgcHJldmVudDogZmFsc2UgfTtcbiAgICAgICAgb3B0aW9ucy5kYXRhID0gY29udGVudDtcbiAgICAgICAgY3VycmVudFZpZXcubW9kZWwudHJpZ2dlcihcbiAgICAgICAgICBcImhlbHBlclJlc3BvbnNlXCIsXG4gICAgICAgICAgZXZlbnQsXG4gICAgICAgICAgY3VycmVudFZpZXcubW9kZWwuaWQsXG4gICAgICAgICAgb3B0aW9ucyxcbiAgICAgICAgICBpbmRleFxuICAgICAgICApO1xuICAgICAgICBpZiAoZXZlbnQucHJldmVudCkge1xuICAgICAgICAgIHJldHVybiBzdWNjZXNzKFtdKTtcbiAgICAgICAgfVxuICAgICAgICBzdWNjZXNzKGNvbnRlbnQpO1xuICAgICAgfSk7XG5cbiAgICAgIC8vQWRkIGhlbHBlclNlYXJjaCBldmVudCAoY2FuIHByZXZlbnQgZGVmYXVsdCBhamF4IHJlcXVlc3QpXG4gICAgICBvcHRpb25zLmRhdGEuYXR0cmlidXRlcyA9IGRvY3VtZW50TW9kZWwuZ2V0VmFsdWVzKCk7XG4gICAgICB0aGlzLm1vZGVsLnRyaWdnZXIoXG4gICAgICAgIFwiaGVscGVyU2VhcmNoXCIsXG4gICAgICAgIGV2ZW50LFxuICAgICAgICB0aGlzLm1vZGVsLmlkLFxuICAgICAgICBleHRlcm5hbE9wdGlvbnMsXG4gICAgICAgIGluZGV4XG4gICAgICApO1xuICAgICAgaWYgKGV2ZW50LnByZXZlbnQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICB9XG4gICAgICBhdXRvY29tcGxldGVVcmwgPVxuICAgICAgICBcImFwaS92Mi9kb2N1bWVudHMvXCIgK1xuICAgICAgICAoZG9jdW1lbnRNb2RlbC5pZCB8fCBcIjBcIikgK1xuICAgICAgICBcIi9hdXRvY29tcGxldGUvXCIgK1xuICAgICAgICB0aGlzLm1vZGVsLmlkO1xuXG4gICAgICBvcHRpb25zLmRhdGEuZnJvbWlkID0gZG9jdW1lbnRNb2RlbC5nZXQoXCJwcm9wZXJ0aWVzXCIpLmdldChcImZhbWlseVwiKS5pZDtcblxuICAgICAgJC5hamF4KHtcbiAgICAgICAgdHlwZTogXCJQT1NUXCIsXG4gICAgICAgIHVybDogYXV0b2NvbXBsZXRlVXJsLFxuICAgICAgICBkYXRhOiBvcHRpb25zLmRhdGEsXG5cbiAgICAgICAgZGF0YVR5cGU6IFwianNvblwiIC8vIFwianNvbnBcIiBpcyByZXF1aXJlZCBmb3IgY3Jvc3MtZG9tYWluIHJlcXVlc3RzOyB1c2UgXCJqc29uXCIgZm9yIHNhbWUtZG9tYWluIHJlcXVlc3Rzb25zLmVycm9yKHJlc3VsdCk7XG4gICAgICB9KVxuICAgICAgICAucGlwZShcbiAgICAgICAgICBmdW5jdGlvbiB2QXR0cmlidXRlQXV0b2NvbXBsZXRlaGFuZGxlU3VjY2Vzc1JlcXVlc3QocmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHJldHVybiAkLkRlZmVycmVkKCkucmVqZWN0KHJlc3BvbnNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIGZ1bmN0aW9uIHZBdHRyaWJ1dGVBdXRvY29tcGxldGVoYW5kbGVFcnJvclJlcXVlc3QocmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDApIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBlcnJvcjogXCJZb3VyIG5hdmlnYXRvciBzZWVtcyBvZmZsaW5lLCB0cnkgbGF0ZXJcIlxuICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICByZXNwb25zZS5yZXNwb25zZUpTT04gJiZcbiAgICAgICAgICAgICAgcmVzcG9uc2UucmVzcG9uc2VKU09OLmV4Y2VwdGlvbk1lc3NhZ2VcbiAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGVycm9yOiByZXNwb25zZS5yZXNwb25zZUpTT04uZXhjZXB0aW9uTWVzc2FnZVxuICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgICAgIGVycm9yOlxuICAgICAgICAgICAgICAgIFwiVW5leHBlY3RlZCBlcnJvcjogXCIgK1xuICAgICAgICAgICAgICAgIHJlc3BvbnNlLnN0YXR1cyArXG4gICAgICAgICAgICAgICAgXCIgXCIgK1xuICAgICAgICAgICAgICAgIHJlc3BvbnNlLnN0YXR1c1RleHRcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfVxuICAgICAgICApXG4gICAgICAgIC50aGVuKFxuICAgICAgICAgIGZ1bmN0aW9uIHZBdHRyaWJ1dGVBdXRvY29tcGxldGVTdWNjZXNzUmVzdWx0KHJlc3VsdCkge1xuICAgICAgICAgICAgLy8gbm90aWZ5IHRoZSBkYXRhIHNvdXJjZSB0aGF0IHRoZSByZXF1ZXN0IHN1Y2NlZWRlZFxuICAgICAgICAgICAgXy5lYWNoKHJlc3VsdC5tZXNzYWdlcywgZnVuY3Rpb24obWVzc2FnZSkge1xuICAgICAgICAgICAgICBtZXNzYWdlLmNvbnRlbnRUZXh0ID0gbWVzc2FnZS5jb250ZW50VGV4dCB8fCBcIlwiO1xuICAgICAgICAgICAgICBtZXNzYWdlLmNvbnRlbnRIdG1sID0gbWVzc2FnZS5jb250ZW50SHRtbCB8fCBcIlwiO1xuICAgICAgICAgICAgICByZXN1bHQuZGF0YS51bnNoaWZ0KHtcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiBtZXNzYWdlLFxuICAgICAgICAgICAgICAgIHRpdGxlOiBcIlwiXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBzdWNjZXNzKHJlc3VsdC5kYXRhKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGZ1bmN0aW9uIHZBdHRyaWJ1dGVBdXRvY29tcGxldGVFcnJvclJlc3VsdChyZXN1bHQpIHtcbiAgICAgICAgICAgIC8vIG5vdGlmeSB0aGUgZGF0YSBzb3VyY2UgdGhhdCB0aGUgcmVxdWVzdCBmYWlsZWRcbiAgICAgICAgICAgIGlmIChfLmlzQXJyYXkocmVzdWx0LmVycm9yKSkge1xuICAgICAgICAgICAgICByZXN1bHQuZXJyb3IgPSByZXN1bHQuZXJyb3Iuam9pbihcIiBcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvL3VzZSB0aGUgc3VjY2VzcyBjYWxsYmFjayBiZWNhdXNlIGh0dHAgZXJyb3IgYXJlIGhhbmRsaW5nIGJ5IHRoZSBwaXBlXG4gICAgICAgICAgICBzdWNjZXNzKFtcbiAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHRpdGxlOiBcIlwiLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6IHtcbiAgICAgICAgICAgICAgICAgIHR5cGU6IFwiZXJyb3JcIixcbiAgICAgICAgICAgICAgICAgIGNvbnRlbnRIdG1sOiBcIlwiLFxuICAgICAgICAgICAgICAgICAgY29udGVudFRleHQ6IHJlc3VsdC5lcnJvclxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgXSk7XG4gICAgICAgICAgfVxuICAgICAgICApO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBNb2RpZnkgdmlzaWJpbGl0eSBhY2Nlc3Mgb2YgYW4gaXRlbSBtZW51XG4gICAgICogQHBhcmFtIGV2ZW50IGV2ZW50IG9iamVjdFxuICAgICAqIEBwYXJhbSBkYXRhIG1lbnUgY29uZmlnIHtpZDogbWVudUlkLCB2aXNpYmlsaXR5OiBcImRpc2FibGVkXCIsIFwidmlzaWJsZVwiLCBcImhpZGRlblwifVxuICAgICAqL1xuICAgIGNoYW5nZU1lbnVWaXNpYmlsaXR5OiBmdW5jdGlvbiB2QXR0cmlidXRlQ2hhbmdlTWVudVZpc2liaWxpdHkoZXZlbnQsIGRhdGEpIHtcbiAgICAgIHRoaXMubW9kZWwudHJpZ2dlcihcImNoYW5nZU1lbnVWaXNpYmlsaXR5XCIsIGV2ZW50LCBkYXRhKTtcbiAgICB9LFxuXG4gICAgZ2V0RE9NRWxlbWVudHM6IGZ1bmN0aW9uIHZBdHRyaWJ1dGVHZXRET01FbGVtZW50cygpIHtcbiAgICAgIGlmICh0aGlzLm9wdGlvbnMgJiYgdGhpcy5vcHRpb25zLmVscykge1xuICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zLmVscygpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJGVsO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICBhZnRlclNob3c6IGZ1bmN0aW9uIHZBdHRyaWJ1dGVBZnRlclNob3coLypldmVudCwgZGF0YSovKSB7XG4gICAgICAvLyBwcm9wYWdhdGUgZXZlbnQgdG8gd2lkZ2V0c1xuICAgICAgdGhpcy5nZXRET01FbGVtZW50cygpLnRyaWdnZXIoXCJzaG93XCIpO1xuICAgIH0sXG4gICAgLyoqXG4gICAgICpcbiAgICAgKiBAcGFyYW0gZXZlbnRcbiAgICAgKiBAcGFyYW0gZGF0YVxuICAgICAqL1xuICAgIHVwZGF0ZVZhbHVlOiBmdW5jdGlvbiB2QXR0cmlidXRlVXBkYXRlVmFsdWUoZXZlbnQsIGRhdGEpIHtcbiAgICAgIHRoaXMubW9kZWwuc2V0VmFsdWUoZGF0YS52YWx1ZSwgZGF0YS5pbmRleCk7XG4gICAgfSxcblxuICAgIHdpZGdldEluaXQ6IGZ1bmN0aW9uIHZBdHRyaWJ1dGVXaWRnZXRJbml0KCRlbGVtZW50LCBkYXRhKSB7XG4gICAgICAkZWxlbWVudC5hZGRDbGFzcyhcImRjcEF0dHJpYnV0ZV9fY29udGVudC0td2lkZ2V0XCIpO1xuICAgICAgcmV0dXJuIHRoaXMuZ2V0V2lkZ2V0Q2xhc3MoJGVsZW1lbnQpLmNhbGwoJGVsZW1lbnQsIGRhdGEpO1xuICAgIH0sXG5cbiAgICB3aWRnZXRBcHBseTogZnVuY3Rpb24gdkF0dHJpYnV0ZVdpZGdldEFwcGx5KCRlbGVtZW50LCBtZXRob2QsIGFyZ3VtZW50KSB7XG4gICAgICB0cnkge1xuICAgICAgICBpZiAoXy5pc1N0cmluZyhtZXRob2QpICYmICRlbGVtZW50ICYmIHRoaXMuZ2V0V2lkZ2V0Q2xhc3MoJGVsZW1lbnQpKSB7XG4gICAgICAgICAgdGhpcy5nZXRXaWRnZXRDbGFzcygkZWxlbWVudCkuY2FsbCgkZWxlbWVudCwgbWV0aG9kLCBhcmd1bWVudCk7XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgaWYgKHdpbmRvdy5kY3AubG9nZ2VyKSB7XG4gICAgICAgICAgd2luZG93LmRjcC5sb2dnZXIoZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihlKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIGdldFdpZGdldENsYXNzOiBmdW5jdGlvbiB2QXR0cmlidXRlR2V0V2lkZ2V0Q2xhc3MoJGVsZW1lbnQpIHtcbiAgICAgICRlbGVtZW50ID0gJGVsZW1lbnQgfHwgdGhpcy4kZWw7XG4gICAgICBpZiAoISRlbGVtZW50LmRhdGEoXCJjdXJyZW50V2lkZ2V0Q2xhc3NcIikpIHtcbiAgICAgICAgJGVsZW1lbnQuZGF0YShcbiAgICAgICAgICBcImN1cnJlbnRXaWRnZXRDbGFzc1wiLFxuICAgICAgICAgIHRoaXMuZ2V0VHlwZWRXaWRnZXRDbGFzcyh0aGlzLm1vZGVsLmdldChcInR5cGVcIikpXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICByZXR1cm4gJGVsZW1lbnQuZGF0YShcImN1cnJlbnRXaWRnZXRDbGFzc1wiKTtcbiAgICB9LFxuXG4gICAgZ2V0VHlwZWRXaWRnZXRDbGFzczogZnVuY3Rpb24gdkF0dHJpYnV0ZUdldFR5cGVkV2lkZ2V0Q2xhc3ModHlwZSkge1xuICAgICAgdmFyIGVycm9yID0gXCJcIixcbiAgICAgICAgY3VzdG9tV2lkZ2V0Q2xhc3MgPSB0aGlzLm1vZGVsLmdldE9wdGlvbihcbiAgICAgICAgICBcImN1c3RvbVdpZGdldEF0dHJpYnV0ZUZ1bmN0aW9uXCJcbiAgICAgICAgKTtcbiAgICAgIGlmIChjdXN0b21XaWRnZXRDbGFzcykge1xuICAgICAgICBpZiAoXy5pc0Z1bmN0aW9uKCQuZm5bY3VzdG9tV2lkZ2V0Q2xhc3NdKSkge1xuICAgICAgICAgIHJldHVybiAkLmZuW2N1c3RvbVdpZGdldENsYXNzXTtcbiAgICAgICAgfVxuICAgICAgICBlcnJvciA9XG4gICAgICAgICAgXCJDdXN0b20gV2lkZ2V0IEZ1bmN0aW9uIDogJC5mbi5cIiArXG4gICAgICAgICAgY3VzdG9tV2lkZ2V0Q2xhc3MgK1xuICAgICAgICAgIFwiIGlzIG5vdCBhIGZ1bmN0aW9uLiBBdHRyaWJ1dGUgOiBcIiArXG4gICAgICAgICAgdGhpcy5tb2RlbC5pZDtcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihlcnJvcik7XG4gICAgICB9XG4gICAgICBzd2l0Y2ggKHR5cGUpIHtcbiAgICAgICAgY2FzZSBcInRleHRcIjpcbiAgICAgICAgICByZXR1cm4gJC5mbi5kY3BUZXh0O1xuICAgICAgICBjYXNlIFwiaW50XCI6XG4gICAgICAgICAgcmV0dXJuICQuZm4uZGNwSW50O1xuICAgICAgICBjYXNlIFwiZG91YmxlXCI6XG4gICAgICAgICAgcmV0dXJuICQuZm4uZGNwRG91YmxlO1xuICAgICAgICBjYXNlIFwibW9uZXlcIjpcbiAgICAgICAgICByZXR1cm4gJC5mbi5kY3BNb25leTtcbiAgICAgICAgY2FzZSBcImxvbmd0ZXh0XCI6XG4gICAgICAgICAgcmV0dXJuICQuZm4uZGNwTG9uZ3RleHQ7XG4gICAgICAgIGNhc2UgXCJodG1sdGV4dFwiOlxuICAgICAgICAgIHJldHVybiAkLmZuLmRjcEh0bWx0ZXh0O1xuICAgICAgICBjYXNlIFwiZGF0ZVwiOlxuICAgICAgICAgIHJldHVybiAkLmZuLmRjcERhdGU7XG4gICAgICAgIGNhc2UgXCJ0aW1lc3RhbXBcIjpcbiAgICAgICAgICByZXR1cm4gJC5mbi5kY3BUaW1lc3RhbXA7XG4gICAgICAgIGNhc2UgXCJ0aW1lXCI6XG4gICAgICAgICAgcmV0dXJuICQuZm4uZGNwVGltZTtcbiAgICAgICAgY2FzZSBcImltYWdlXCI6XG4gICAgICAgICAgcmV0dXJuICQuZm4uZGNwSW1hZ2U7XG4gICAgICAgIGNhc2UgXCJjb2xvclwiOlxuICAgICAgICAgIHJldHVybiAkLmZuLmRjcENvbG9yO1xuICAgICAgICBjYXNlIFwiZmlsZVwiOlxuICAgICAgICAgIHJldHVybiAkLmZuLmRjcEZpbGU7XG4gICAgICAgIGNhc2UgXCJlbnVtXCI6XG4gICAgICAgICAgcmV0dXJuICQuZm4uZGNwRW51bTtcbiAgICAgICAgY2FzZSBcInBhc3N3b3JkXCI6XG4gICAgICAgICAgcmV0dXJuICQuZm4uZGNwUGFzc3dvcmQ7XG4gICAgICAgIGNhc2UgXCJ0aGVzYXVydXNcIjpcbiAgICAgICAgY2FzZSBcImFjY291bnRcIjpcbiAgICAgICAgY2FzZSBcImRvY2lkXCI6XG4gICAgICAgICAgcmV0dXJuICQuZm4uZGNwRG9jaWQ7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgcmV0dXJuICQuZm4uZGNwVGV4dDtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgc2V0V2lkZ2V0UmVhZHk6IGZ1bmN0aW9uIFZhdHRyaWJ1dGVfc2V0V2lkZ2V0UmVhZHkoKSB7XG4gICAgICB0aGlzLndpZGdldFJlYWR5ID0gdHJ1ZTtcbiAgICAgIHRoaXMudHJpZ2dlclJlbmRlckRvbmUoKTtcbiAgICB9LFxuXG4gICAgdHJpZ2dlclJlbmRlckRvbmU6IGZ1bmN0aW9uIHZBdHRyaWJ1dGVfdHJpZ2dlclJlbmRlckRvbmUoKSB7XG4gICAgICBpZiAoXG4gICAgICAgIHRoaXMubm9SZW5kZXJFdmVudCAhPT0gZmFsc2UgJiZcbiAgICAgICAgdGhpcy5yZW5kZXJEb25lICYmXG4gICAgICAgIHRoaXMud2lkZ2V0UmVhZHkgJiZcbiAgICAgICAgIXRoaXMudHJpZ2dlclJlbmRlclxuICAgICAgKSB7XG4gICAgICAgIHRoaXMubW9kZWwudHJpZ2dlcihcInJlbmRlckRvbmVcIiwgeyBtb2RlbDogdGhpcy5tb2RlbCwgJGVsOiB0aGlzLiRlbCB9KTtcbiAgICAgICAgdGhpcy50cmlnZ2VyUmVuZGVyID0gdHJ1ZTtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgcmVtb3ZlOiBmdW5jdGlvbiB2QXR0cmlidXRlUmVtb3ZlKCkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgaWYgKFxuICAgICAgICAgIHRoaXMuY3VycmVudERjcFdpZGdldCAmJlxuICAgICAgICAgIHRoaXMuZ2V0V2lkZ2V0Q2xhc3ModGhpcy5jdXJyZW50RGNwV2lkZ2V0KSAmJlxuICAgICAgICAgIHRoaXMuX2ZpbmRXaWRnZXROYW1lKHRoaXMuJGVsKVxuICAgICAgICApIHtcbiAgICAgICAgICB0aGlzLmdldFdpZGdldENsYXNzKHRoaXMuY3VycmVudERjcFdpZGdldCkuY2FsbCh0aGlzLiRlbCwgXCJkZXN0cm95XCIpO1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIGlmICh3aW5kb3cuZGNwLmxvZ2dlcikge1xuICAgICAgICAgIHdpbmRvdy5kY3AubG9nZ2VyKGUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBCYWNrYm9uZS5WaWV3LnByb3RvdHlwZS5yZW1vdmUuY2FsbCh0aGlzKTtcbiAgICB9LFxuXG4gICAgaGlkZTogZnVuY3Rpb24gdkF0dHJpYnV0ZUhpZGUoKSB7XG4gICAgICB0aGlzLiRlbC5oaWRlKCk7XG4gICAgfSxcblxuICAgIHNob3c6IGZ1bmN0aW9uIHZBdHRyaWJ1dGVTaG93KCkge1xuICAgICAgdGhpcy4kZWwuc2hvdygpO1xuICAgIH0sXG5cbiAgICBfY2xvc2VXaWRnZXQ6IGZ1bmN0aW9uIHZBdHRyaWJ1dGVfX2Nsb3NlV2lkZ2V0KCkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgaWYgKFxuICAgICAgICAgIHRoaXMuY3VycmVudERjcFdpZGdldCAmJlxuICAgICAgICAgIHRoaXMuZ2V0V2lkZ2V0Q2xhc3ModGhpcy5jdXJyZW50RGNwV2lkZ2V0KSAmJlxuICAgICAgICAgIHRoaXMuX2ZpbmRXaWRnZXROYW1lKHRoaXMuY3VycmVudERjcFdpZGdldClcbiAgICAgICAgKSB7XG4gICAgICAgICAgdGhpcy5nZXRXaWRnZXRDbGFzcyh0aGlzLmN1cnJlbnREY3BXaWRnZXQpLmNhbGwoXG4gICAgICAgICAgICB0aGlzLmN1cnJlbnREY3BXaWRnZXQsXG4gICAgICAgICAgICBcImNsb3NlXCJcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIGlmICh3aW5kb3cuZGNwLmxvZ2dlcikge1xuICAgICAgICAgIHdpbmRvdy5kY3AubG9nZ2VyKGUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuXG4gICAgX2ZpbmRXaWRnZXROYW1lOiBmdW5jdGlvbiB2QXR0cmlidXRlX2ZpbmRXaWRnZXROYW1lKCRlbGVtZW50KSB7XG4gICAgICByZXR1cm4gXy5maW5kKFxuICAgICAgICBfLmtleXMoJGVsZW1lbnQuZGF0YSgpKSxcbiAgICAgICAgZnVuY3Rpb24gdkF0dHJpYnV0ZV9maW5kV2lkZ2V0TmFtZUZpbmQoY3VycmVudEtleSkge1xuICAgICAgICAgIHJldHVybiBjdXJyZW50S2V5LmluZGV4T2YoXCJkY3BEY3BcIikgIT09IC0xO1xuICAgICAgICB9XG4gICAgICApO1xuICAgIH0sXG5cbiAgICBfaWRlbnRpZnlWaWV3OiBmdW5jdGlvbiB2QXR0cmlidXRlX2lkZW50aWZ5VmlldyhldmVudCkge1xuICAgICAgZXZlbnQuaGF2ZVZpZXcgPSB0cnVlO1xuICAgICAgLy9BZGQgdGhlIHBvaW50ZXIgdG8gdGhlIGN1cnJlbnQganF1ZXJ5IGVsZW1lbnQgdG8gYSBsaXN0IHBhc3NlZCBieSB0aGUgZXZlbnRcbiAgICAgIGV2ZW50LmVsZW1lbnRzID0gZXZlbnQuZWxlbWVudHMuYWRkKHRoaXMuJGVsKTtcbiAgICB9XG4gIH0pO1xufSk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUpBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkVBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///fde693488ffc947d1881\n");

/***/ }),

/***/ "ff69e46ed202585764e9":
/*!******************************************************************!*\
  !*** ./src/Apps/DOCUMENT/IHM/widgets/attributes/docid/wDocid.js ***!
  \******************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/*global define*/\n\n(function umdRequire(root, factory) {\n  \"use strict\";\n\n  if (true) {\n    !(__WEBPACK_AMD_DEFINE_ARRAY__ = [\n      __webpack_require__(/*! jquery */ \"127c8cf59f228bb01a21\"),\n      __webpack_require__(/*! underscore */ \"8e08e542008e4aef1f58\"),\n      __webpack_require__(/*! mustache */ \"bcd31d01884fc294fd69\"),\n      __webpack_require__(/*! dcpDocument/widgets/attributes/wAttribute */ \"d1cffa31e143773735c0\")\n    ], __WEBPACK_AMD_DEFINE_FACTORY__ = (factory),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?\n\t\t\t\t(__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n  } else {}\n})(window, function require_wDocid($, _, Mustache) {\n  \"use strict\";\n\n  //noinspection JSUnusedGlobalSymbols\n  $.widget(\"dcp.dcpDocid\", $.dcp.dcpAttribute, {\n    options: {\n      type: \"docid\",\n      renderOptions: {\n        kendoMultiSelectConfiguration: {\n          minLength: 1,\n          itemTemplate:\n            '<div class=\"dcpAutocomplete\"><span class=\"k-state-default\">#= data.title#</span>' +\n            \"#if (data.message) {#\" +\n            '<div class=\"dcpAutocomplete--#= data.message.type#\">#: data.message.contentText# #= data.message.contentHtml#</div>' +\n            \"#}# </div>\"\n        },\n        kendoComboBoxConfiguration: {\n          template:\n            '<div class=\"dcpAutocomplete\"><span class=\"k-state-default\">#= data.title#</span>' +\n            \"#if (data.message) {#\" +\n            '<div class=\"dcpAutocomplete--#= data.message.type#\">#: data.message.contentText# #= data.message.contentHtml#</div>' +\n            \"#}# </div>\"\n        },\n        editDisplay: \"autoCompletion\"\n      },\n      labels: {\n        allSelectedDocument: \"No more matching\"\n      }\n    },\n\n    kendoWidget: null,\n\n    _initDom: function wDocidInitDom() {\n      var scope = this;\n      this.element.addClass(\"dcpAttribute__content\");\n      this.element.attr(\"data-type\", this.getType());\n      this.element.attr(\"data-attrid\", this.options.id);\n\n      if (this._isMultiple()) {\n        this.options.attributeValues = _.toArray(this.options.attributeValue);\n        this.options.isMultiple = true;\n      }\n\n      if (this.getMode() === \"read\") {\n        if (this.options.renderOptions.format) {\n          if (this._isMultiple()) {\n            _.each(this.options.attributeValues, function wDocidinitDomFormat(\n              singleValue\n            ) {\n              singleValue.formatValue = Mustache.render(\n                scope.options.renderOptions.format,\n                singleValue\n              );\n            });\n          } else {\n            this.options.attributeValue.formatValue = Mustache.render(\n              this.options.renderOptions.format,\n              this.options.attributeValue\n            );\n          }\n        }\n        if (this.options.renderOptions.documentIconSize) {\n          var reSize = /sizes\\/([0-9xcfs]+)/;\n          var noIcon =\n            [\"0\", \"0x0\", \"x0\"].indexOf(\n              this.options.renderOptions.documentIconSize\n            ) !== -1;\n          if (this._isMultiple()) {\n            _.each(this.options.attributeValues, function wDocidResizeIcons(\n              singleValue\n            ) {\n              if (noIcon) {\n                singleValue.icon = null;\n              } else if (singleValue.icon) {\n                singleValue.icon = singleValue.icon.replace(\n                  reSize,\n                  \"sizes/\" + scope.options.renderOptions.documentIconSize\n                );\n              }\n            });\n          } else if (noIcon) {\n            this.options.attributeValue.icon = null;\n          } else if (this.options.attributeValue.icon) {\n            this.options.attributeValue.icon = this.options.attributeValue.icon.replace(\n              reSize,\n              \"sizes/\" + this.options.renderOptions.documentIconSize\n            );\n          }\n        }\n\n        //noinspection JSPotentiallyInvalidConstructorUsage,JSAccessibilityCheck\n        $.dcp.dcpAttribute.prototype._initDom.apply(this, []);\n      } else if (this.getMode() === \"write\") {\n        //noinspection JSPotentiallyInvalidConstructorUsage,JSAccessibilityCheck\n        $.dcp.dcpAttribute.prototype._initDom.apply(this, []);\n        this.kendoWidget = this.element.find(\".dcpAttribute__value--docid\");\n        if (this.options.renderOptions.placeHolder) {\n          this.options.renderOptions.kendoMultiSelectConfiguration.placeholder = this.options.renderOptions.placeHolder;\n          this.options.renderOptions.kendoComboBoxConfiguration.placeholder = this.options.renderOptions.placeHolder;\n        }\n        if (this._isMultiple()) {\n          this._decorateMultipleValue(this.kendoWidget);\n        } else {\n          switch (this.options.renderOptions.editDisplay) {\n            case \"singleMultiple\":\n              this._decorateSingleValue(this.kendoWidget);\n\n              break;\n            case \"autoCompletion\":\n              this.singleCombobox(this.kendoWidget);\n              break;\n            case \"list\":\n              this.singleDropdown(this.kendoWidget);\n              break;\n            default:\n              this.singleCombobox(this.kendoWidget);\n          }\n        }\n        this._updateCreateButton();\n      }\n    },\n\n    _updateCreateButton: function wDocid_updateCreateButton() {\n      var currentValue = this.options.attributeValue;\n      var buttonsConfig = this.options.renderOptions.buttons;\n\n      this.element\n        .find(\".dcpAttribute__content__button--create\")\n        .each(function wDocid_updateCreateButtonEach() {\n          var $button = $(this);\n          var buttonIndex = $button.data(\"index\");\n          var buttonConfig = buttonsConfig[buttonIndex];\n\n          $button.prop(\"disabled\", false);\n          if (currentValue.value) {\n            $button.html(\n              buttonConfig.renderHtmlContent + buttonConfig.htmlEditContent\n            );\n            // @TODO Find an efficient way to verify edit access of target\n            /*\n                     if (!currentValue.value) {\n                     $button.prop(\"disabled\", true);\n                     }*/\n          } else {\n            // also when mutiple always create\n            $button.html(\n              buttonConfig.renderHtmlContent + buttonConfig.htmlCreateContent\n            );\n          }\n        });\n    },\n\n    /**\n     * Init event when a hyperlink is associated to the attribute\n     *\n     * @protected\n     */\n    _initLinkEvent: function wDocidInitLinkEvent() {\n      this._super();\n      var htmlLink = this.getLink();\n      var currentWidget = this;\n      if (htmlLink) {\n        this.element.on(\n          \"click.\" + this.eventNamespace,\n          \".dcpAttribute__content__link\",\n          function wDocidInitLinkOnClick(event) {\n            var $this = $(this);\n            if (htmlLink.target === \"_render\") {\n              event.preventDefault();\n              currentWidget._trigger(\"fetchdocument\", event, {\n                index: $this.data(\"index\"),\n                tableLine: $this\n                  .closest(\".dcpArray__content__line\")\n                  .data(\"line\")\n              });\n            }\n          }\n        );\n      }\n      return this;\n    },\n    _initButtonsEvent: function _initButtonsEvent() {\n      var currentWidget = this;\n      this._super();\n\n      this.element.on(\n        \"click\" + this.eventNamespace,\n        \".dcpAttribute__content__button--create\",\n        function wAttributeButtonClick(event) {\n          var buttonsConfig = currentWidget.options.renderOptions.buttons;\n          var $button = $(this);\n          var buttonIndex = $button.data(\"index\");\n          var buttonConfig = buttonsConfig[buttonIndex];\n\n          currentWidget._trigger(\"externalLinkSelected\", event, {\n            target: event.target,\n            eventId: \"attribute.createDocumentRelation\",\n            index: currentWidget._getIndex(),\n            buttonConfig: buttonConfig\n          });\n        }\n      );\n      this.element.tooltip({\n        selector: \".dcpAttribute__content__buttons button\",\n        placement: \"top\",\n        trigger: \"hover\",\n        html: true,\n        title: function wAttributeGetButtonTitle() {\n          var title = $(this).data(\"title\");\n          var attrValue = currentWidget.getValue();\n          return Mustache.render(title || \"\", attrValue);\n        },\n        container: this.element\n      });\n\n      return this;\n    },\n    /**\n     * Define inputs for focus\n     * @protected\n     */\n    _getFocusInput: function wDocidFocusInput() {\n      return this.element.find(\"input\");\n    },\n\n    /**\n     * Get kendo option from normal options and from renderOptions.kendoMultiSelectConfiguration\n     * @returns {*}\n     */\n    getKendoOptions: function wDocidGetKendoOptions(inputValue, extraOptions) {\n      var currentWidget = this;\n      var options = {\n        autoBind: false,\n        clearButton: false,\n        dataTextField: \"docTitle\",\n        dataValueField: \"docId\",\n        highlightFirst: true,\n        //value: values,\n        dataSource: {\n          // type: \"json\",\n          serverFiltering: true,\n          transport: {\n            read: function wDocidSelectRead(options) {\n              currentWidget._hasBeenRequested = true;\n              options.data.index = currentWidget._getIndex();\n              return currentWidget.options.autocompleteRequest.call(\n                null,\n                options,\n                currentWidget._getIndex()\n              );\n            }\n          },\n          schema: {\n            // Add already recorded data to items\n            data: function wDocidSelectSchema(items) {\n              //Add new elements\n              _.each(items, function wDocidDataCompose(currentItem) {\n                if (\n                  currentItem.values &&\n                  currentItem.values[currentWidget.options.id]\n                ) {\n                  currentItem.docId =\n                    currentItem.values[currentWidget.options.id].value;\n                  currentItem.docTitle =\n                    currentItem.values[currentWidget.options.id].displayValue;\n                }\n              });\n\n              //Suppress multiple items\n              return _.uniq(items, false, function wDocidDataUniq(currentItem) {\n                return currentItem.docId || currentItem.message;\n              });\n            }\n          }\n        },\n        select: function kendoDocidSelect(event) {\n          if (!event.item || _.isUndefined(event.item.index())) {\n            return;\n          }\n\n          var valueIndex = currentWidget._getIndex();\n          var dataItem = this.dataSource.at(event.item.index()).toJSON();\n\n          if (dataItem.message) {\n            event.preventDefault();\n          } else {\n            //The object returned by dataSource.at are internal kendo object so I clean it with toJSON\n\n            _.defer(function wDocidChangeOnSelect() {\n              // Change others attributes designed by help returns\n              currentWidget._trigger(\n                \"changeattrsvalue\",\n                event,\n                {\n                  dataItem: dataItem,\n                  valueIndex: valueIndex\n                },\n                currentWidget._getIndex()\n              );\n            });\n          }\n        },\n        change: function kendoChangeSelect(event) {\n          // set in case of delete item\n          var oldValues = currentWidget.options.attributeValue;\n          var displayValue;\n          var newValues = [];\n          var kMultiSelect = this;\n          var widgetValue = this.value();\n\n          if (_.isArray(widgetValue)) {\n            _.each(widgetValue, function wDocidSelectChange(val) {\n              if (!_.isUndefined(val)) {\n                displayValue = _.where(oldValues, { value: val });\n                if (displayValue.length === 0) {\n                  displayValue = _.where(kMultiSelect.dataSource.data(), {\n                    docId: val\n                  });\n                  if (displayValue.length > 0) {\n                    displayValue = displayValue[0].docTitle;\n                  } else {\n                    displayValue = \"-\";\n                  }\n                } else {\n                  displayValue = displayValue[0].displayValue;\n                }\n\n                newValues.push({ value: val, displayValue: displayValue });\n              }\n            });\n\n            if (!currentWidget._isMultiple()) {\n              if (newValues.length > 0) {\n                newValues = newValues[0];\n              } else {\n                newValues = { value: null, displayValue: \"\" };\n              }\n            }\n          } else {\n            if (widgetValue) {\n              displayValue = _.where(kMultiSelect.dataSource.data(), {\n                docId: widgetValue\n              });\n              if (displayValue.length > 0) {\n                displayValue = displayValue[0].docTitle;\n                newValues = { value: widgetValue, displayValue: displayValue };\n              } else {\n                newValues = { value: null, displayValue: \"\" };\n              }\n            } else {\n              newValues = { value: null, displayValue: \"\" };\n            }\n          }\n\n          currentWidget.setValue(newValues, event);\n        },\n        open: function wDocidSelectOpen(event) {\n          if (currentWidget._hasBeenRequested !== true) {\n            event.preventDefault();\n            currentWidget.kendoWidgetObject.search(\"\");\n          }\n          this.ul.addClass(\"dcpAttribute__select--docid\");\n        },\n        close: function wDocidSelectClose() {\n          if (this.ns !== \".kendoDropDownList\") {\n            currentWidget._hasBeenRequested = false;\n          }\n        },\n        filtering: function wDocidSelectOpen() {\n          this._isFiltering = true;\n        },\n        dataBound: function wDocidFilteringNoOne() {\n          if (this._isFiltering) {\n            if (\n              this.ul.find(\"li:not(.k-state-selected)\").length === 0 &&\n              this.ul.find(\"li.k-state-selected\").length > 0\n            ) {\n              // No one more : display\n              var $noOne = $('<li class=\"k-item\"/>')\n                .append('<span class=\"k-state-default\"/>')\n                .append(\n                  $(\n                    '<span class=\"k-state-error dcpAttribute__select--docid-none\"/>'\n                  ).text(currentWidget.options.labels.allSelectedDocument)\n                );\n              this.ul.append($noOne);\n            }\n            this._isFiltering = false;\n          }\n        }\n      };\n\n      if (extraOptions) {\n        options = _.extend(options, extraOptions);\n      }\n      if (this.options.renderOptions.kendoComboBoxConfiguration) {\n        options = _.extend(\n          this.options.renderOptions.kendoComboBoxConfiguration,\n          options\n        );\n      }\n\n      return options;\n    },\n\n    /**\n     * When docid is not multiple, it is a multiselect limited to one element\n     * @param inputValue select  element\n     */\n    _decorateSingleValue: function wDocidDecorateSingleValue(inputValue) {\n      this.options.attributeValues = [];\n      if (this.options.attributeValue) {\n        this.options.attributeValues.push(this.options.attributeValue);\n      }\n\n      this._decorateMultipleValue(inputValue, {\n        maxSelectedItems: 1\n      });\n\n      if (\n        this.options.attributeValue &&\n        this.options.attributeValue.value !== null\n      ) {\n        this.element\n          .find(\".dcpAttribute__value--docid--button\")\n          .attr(\"disabled\", \"disabled\");\n        this.element.find(\"input.k-input\").attr(\"disabled\", \"disabled\");\n      }\n    },\n\n    _decorateMultipleValue: function wDocidDecorateMultipleValue(\n      inputValue,\n      extraOptions\n    ) {\n      var options = this.getKendoOptions(inputValue, {\n        filter: \"contains\"\n      });\n      var currentWidget = this,\n        values = _.map(this.options.attributeValues, function wDocidSelectMap(\n          val\n        ) {\n          var info = {};\n          info.docTitle = val.displayValue;\n          info.docId = val.value;\n          return info;\n        });\n\n      if (extraOptions) {\n        options = _.extend(options, extraOptions);\n      }\n\n      if (this.options.renderOptions.kendoMultiSelectConfiguration) {\n        options = _.extend(\n          this.options.renderOptions.kendoMultiSelectConfiguration,\n          options\n        );\n      }\n      //noinspection JSUnresolvedFunction\n      inputValue.kendoMultiSelect(options);\n      this.kendoWidgetObject = inputValue.data(\"kendoMultiSelect\");\n      this.kendoWidgetObject.dataSource.data(values);\n\n      if (this.options.attributeValues.value !== null) {\n        // Init kendo widget with identifier array\n        this.kendoWidgetObject.value(\n          _.filter(\n            _.map(values, function wDocidInitValue(item) {\n              return item.docId;\n            }),\n            function wDocidFilterEmpty(item) {\n              return !_.isEmpty(item);\n            }\n          )\n        );\n      }\n      this.element.on(\n        \"click\" + this.eventNamespace,\n        \".dcpAttribute__value--docid--button\",\n        function wDocidSelectClick(event) {\n          event.preventDefault();\n          currentWidget.kendoWidgetObject.search(\"\");\n        }\n      );\n\n      this.element.find(\".dcpAttribute__value--docid--button[title]\").tooltip({\n        html: true\n      });\n    },\n\n    singleDropdown: function wDocidSingleDropdown(inputValue) {\n      var kendoOptions = this.getKendoOptions(inputValue);\n\n      this.kendoWidgetObject = inputValue\n        .kendoDropDownList(kendoOptions)\n        .data(\"kendoDropDownList\");\n\n      this.kendoWidgetObject.list\n        .find(\".k-list-optionlabel\")\n        .addClass(\"placeholder--clear\");\n      this.kendoWidgetObject.value(this.options.attributeValue.value);\n      this.element\n        .find(\".dcpAttribute__value--docid--button\")\n        .parent()\n        .hide();\n    },\n\n    singleCombobox: function wDocidSingleCombobox(inputValue) {\n      var kendoOptions = this.getKendoOptions(inputValue, {\n        filter: \"startswith\" //@TODO use filter option in standard auto complete\n      });\n      var kendoSelect;\n\n      this.kendoWidgetObject = inputValue\n        .kendoComboBox(kendoOptions)\n        .data(\"kendoComboBox\");\n      kendoSelect = this.kendoWidgetObject;\n      this.kendoWidgetObject.list\n        .find(\".k-list-optionlabel\")\n        .addClass(\"placeholder--clear\");\n\n      if (this.options.attributeValue && this.options.attributeValue.value) {\n        kendoSelect.dataSource.add({\n          docId: this.options.attributeValue.value,\n          docTitle: this.options.attributeValue.displayValue\n        });\n      }\n\n      if (this.options.attributeValue.value) {\n        // Init value in kendo only if any : if not call to server is performed\n        this.kendoWidgetObject.value(this.options.attributeValue.value);\n      }\n      this.element\n        .find(\".dcpAttribute__value--docid--button\")\n        .parent()\n        .hide();\n    },\n\n    /**\n     * Return true if attribut has multiple option\n     * @returns bool\n     */\n    hasMultipleOption: function wDocidHasMultipleOption() {\n      return this.options.options && this.options.options.multiple === \"yes\";\n    },\n\n    setValue: function wDocidSetValue(value, event) {\n      var newValues;\n      this._super(value, event);\n      if (this.getMode() === \"write\") {\n        if (\n          !this.hasMultipleOption() &&\n          this.options.renderOptions.editDisplay === \"singleMultiple\"\n        ) {\n          if (!_.isArray(value)) {\n            if (value.value !== null) {\n              value = [value];\n            } else {\n              value = [];\n            }\n          } else if (value.length === 1 && value.value === null) {\n            value = [];\n          }\n          if (value.length === 0) {\n            this.element\n              .find(\".dcpAttribute__value--docid--button\")\n              .removeAttr(\"disabled\");\n            this.element.find(\"input.k-input\").removeAttr(\"disabled\");\n          } else {\n            this.element\n              .find(\".dcpAttribute__value--docid--button\")\n              .attr(\"disabled\", \"disabled\");\n            this.element.find(\"input.k-input\").attr(\"disabled\", \"disabled\");\n          }\n        }\n\n        if (\n          this.hasMultipleOption() ||\n          this.options.renderOptions.editDisplay === \"singleMultiple\"\n        ) {\n          newValues = _.map(value, function wDocidMapValue(val) {\n            return val.value;\n          });\n        } else {\n          newValues = value.value;\n        }\n        var kendoSelect = this.kendoWidgetObject;\n        var originalValues = _.clone(kendoSelect.value());\n        // update values in kendo widget\n\n        var dataOri = _.map(\n          _.filter(kendoSelect.dataSource.data(), function wDocIdFilter(item) {\n            return !_.isEmpty(item.docId);\n          }),\n          function wDocidFilterEmpty(currentElement) {\n            return {\n              docId: currentElement.docId,\n              docTitle: currentElement.docTitle\n            };\n          }\n        );\n\n        if (!_.isArray(value)) {\n          value = [value];\n        }\n        _.each(value, function wDocidEachData(val) {\n          var info = {};\n\n          if (\n            !_.some(dataOri, function wDocidEachUniq(elt) {\n              return val && elt.docId === val.value;\n            })\n          ) {\n            // add more static data in dataSource\n            if (val.value !== null) {\n              info.docTitle = val.displayValue;\n              info.docId = val.value;\n              kendoSelect.dataSource.add(info);\n            }\n          }\n        });\n\n        if (!this._isEqual(originalValues, newValues)) {\n          kendoSelect.value(newValues);\n          this.flashElement();\n        }\n        this._updateCreateButton();\n      } else if (this.getMode() === \"read\") {\n        this.redraw();\n      } else {\n        throw new Error(\n          \"Attribute \" + this.options.id + \" unkown mode \" + this.getMode()\n        );\n      }\n    },\n\n    _isEqual: function(values1, values2) {\n      var convertToString = function(currentValue) {\n        if (!currentValue || !currentValue.toString) {\n          currentValue = \"\";\n        }\n        return currentValue.toString();\n      };\n      if (!_.isArray(values1)) {\n        values1 = [values1];\n      }\n      if (!_.isArray(values2)) {\n        values2 = [values2];\n      }\n      values1 = _.filter(_.uniq(_.map(values1, convertToString)), function(\n        value\n      ) {\n        return !!value;\n      });\n      values2 = _.filter(_.uniq(_.map(values2, convertToString)), function(\n        value\n      ) {\n        return !!value;\n      });\n      return _.isEqual(values1, values2);\n    },\n\n    close: function wDocid_close() {\n      if (this.kendoWidget && this.kendoWidgetObject) {\n        this.kendoWidgetObject.close();\n      }\n    },\n\n    getType: function wDocid_getType() {\n      return \"docid\";\n    },\n\n    _destroy: function wDocid__destroy() {\n      if (this.kendoWidget && this.kendoWidgetObject) {\n        this.kendoWidgetObject.destroy();\n      }\n      $(\".dcpDocid-create-window\").each(function wDocid_destroyWindow() {\n        var kWindow = $(this).data(\"dcpWindow\");\n        if (kWindow) {\n          kWindow.destroy();\n        }\n      });\n      this._super();\n    }\n  });\n\n  return $.fn.dcpDocid;\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmY2OWU0NmVkMjAyNTg1NzY0ZTkuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvQXBwcy9ET0NVTUVOVC9JSE0vd2lkZ2V0cy9hdHRyaWJ1dGVzL2RvY2lkL3dEb2NpZC5qcz9kZWE5Il0sInNvdXJjZXNDb250ZW50IjpbIi8qZ2xvYmFsIGRlZmluZSovXG5cbihmdW5jdGlvbiB1bWRSZXF1aXJlKHJvb3QsIGZhY3RvcnkpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgaWYgKHR5cGVvZiBkZWZpbmUgPT09IFwiZnVuY3Rpb25cIiAmJiBkZWZpbmUuYW1kKSB7XG4gICAgZGVmaW5lKFtcbiAgICAgIFwianF1ZXJ5XCIsXG4gICAgICBcInVuZGVyc2NvcmVcIixcbiAgICAgIFwibXVzdGFjaGVcIixcbiAgICAgIFwiZGNwRG9jdW1lbnQvd2lkZ2V0cy9hdHRyaWJ1dGVzL3dBdHRyaWJ1dGVcIlxuICAgIF0sIGZhY3RvcnkpO1xuICB9IGVsc2Uge1xuICAgIC8vbm9pbnNwZWN0aW9uIEpTVW5yZXNvbHZlZFZhcmlhYmxlXG4gICAgZmFjdG9yeSh3aW5kb3cualF1ZXJ5LCB3aW5kb3cuXywgd2luZG93Lk11c3RhY2hlKTtcbiAgfVxufSkod2luZG93LCBmdW5jdGlvbiByZXF1aXJlX3dEb2NpZCgkLCBfLCBNdXN0YWNoZSkge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICAvL25vaW5zcGVjdGlvbiBKU1VudXNlZEdsb2JhbFN5bWJvbHNcbiAgJC53aWRnZXQoXCJkY3AuZGNwRG9jaWRcIiwgJC5kY3AuZGNwQXR0cmlidXRlLCB7XG4gICAgb3B0aW9uczoge1xuICAgICAgdHlwZTogXCJkb2NpZFwiLFxuICAgICAgcmVuZGVyT3B0aW9uczoge1xuICAgICAgICBrZW5kb011bHRpU2VsZWN0Q29uZmlndXJhdGlvbjoge1xuICAgICAgICAgIG1pbkxlbmd0aDogMSxcbiAgICAgICAgICBpdGVtVGVtcGxhdGU6XG4gICAgICAgICAgICAnPGRpdiBjbGFzcz1cImRjcEF1dG9jb21wbGV0ZVwiPjxzcGFuIGNsYXNzPVwiay1zdGF0ZS1kZWZhdWx0XCI+Iz0gZGF0YS50aXRsZSM8L3NwYW4+JyArXG4gICAgICAgICAgICBcIiNpZiAoZGF0YS5tZXNzYWdlKSB7I1wiICtcbiAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwiZGNwQXV0b2NvbXBsZXRlLS0jPSBkYXRhLm1lc3NhZ2UudHlwZSNcIj4jOiBkYXRhLm1lc3NhZ2UuY29udGVudFRleHQjICM9IGRhdGEubWVzc2FnZS5jb250ZW50SHRtbCM8L2Rpdj4nICtcbiAgICAgICAgICAgIFwiI30jIDwvZGl2PlwiXG4gICAgICAgIH0sXG4gICAgICAgIGtlbmRvQ29tYm9Cb3hDb25maWd1cmF0aW9uOiB7XG4gICAgICAgICAgdGVtcGxhdGU6XG4gICAgICAgICAgICAnPGRpdiBjbGFzcz1cImRjcEF1dG9jb21wbGV0ZVwiPjxzcGFuIGNsYXNzPVwiay1zdGF0ZS1kZWZhdWx0XCI+Iz0gZGF0YS50aXRsZSM8L3NwYW4+JyArXG4gICAgICAgICAgICBcIiNpZiAoZGF0YS5tZXNzYWdlKSB7I1wiICtcbiAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwiZGNwQXV0b2NvbXBsZXRlLS0jPSBkYXRhLm1lc3NhZ2UudHlwZSNcIj4jOiBkYXRhLm1lc3NhZ2UuY29udGVudFRleHQjICM9IGRhdGEubWVzc2FnZS5jb250ZW50SHRtbCM8L2Rpdj4nICtcbiAgICAgICAgICAgIFwiI30jIDwvZGl2PlwiXG4gICAgICAgIH0sXG4gICAgICAgIGVkaXREaXNwbGF5OiBcImF1dG9Db21wbGV0aW9uXCJcbiAgICAgIH0sXG4gICAgICBsYWJlbHM6IHtcbiAgICAgICAgYWxsU2VsZWN0ZWREb2N1bWVudDogXCJObyBtb3JlIG1hdGNoaW5nXCJcbiAgICAgIH1cbiAgICB9LFxuXG4gICAga2VuZG9XaWRnZXQ6IG51bGwsXG5cbiAgICBfaW5pdERvbTogZnVuY3Rpb24gd0RvY2lkSW5pdERvbSgpIHtcbiAgICAgIHZhciBzY29wZSA9IHRoaXM7XG4gICAgICB0aGlzLmVsZW1lbnQuYWRkQ2xhc3MoXCJkY3BBdHRyaWJ1dGVfX2NvbnRlbnRcIik7XG4gICAgICB0aGlzLmVsZW1lbnQuYXR0cihcImRhdGEtdHlwZVwiLCB0aGlzLmdldFR5cGUoKSk7XG4gICAgICB0aGlzLmVsZW1lbnQuYXR0cihcImRhdGEtYXR0cmlkXCIsIHRoaXMub3B0aW9ucy5pZCk7XG5cbiAgICAgIGlmICh0aGlzLl9pc011bHRpcGxlKCkpIHtcbiAgICAgICAgdGhpcy5vcHRpb25zLmF0dHJpYnV0ZVZhbHVlcyA9IF8udG9BcnJheSh0aGlzLm9wdGlvbnMuYXR0cmlidXRlVmFsdWUpO1xuICAgICAgICB0aGlzLm9wdGlvbnMuaXNNdWx0aXBsZSA9IHRydWU7XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLmdldE1vZGUoKSA9PT0gXCJyZWFkXCIpIHtcbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5yZW5kZXJPcHRpb25zLmZvcm1hdCkge1xuICAgICAgICAgIGlmICh0aGlzLl9pc011bHRpcGxlKCkpIHtcbiAgICAgICAgICAgIF8uZWFjaCh0aGlzLm9wdGlvbnMuYXR0cmlidXRlVmFsdWVzLCBmdW5jdGlvbiB3RG9jaWRpbml0RG9tRm9ybWF0KFxuICAgICAgICAgICAgICBzaW5nbGVWYWx1ZVxuICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgIHNpbmdsZVZhbHVlLmZvcm1hdFZhbHVlID0gTXVzdGFjaGUucmVuZGVyKFxuICAgICAgICAgICAgICAgIHNjb3BlLm9wdGlvbnMucmVuZGVyT3B0aW9ucy5mb3JtYXQsXG4gICAgICAgICAgICAgICAgc2luZ2xlVmFsdWVcbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMuYXR0cmlidXRlVmFsdWUuZm9ybWF0VmFsdWUgPSBNdXN0YWNoZS5yZW5kZXIoXG4gICAgICAgICAgICAgIHRoaXMub3B0aW9ucy5yZW5kZXJPcHRpb25zLmZvcm1hdCxcbiAgICAgICAgICAgICAgdGhpcy5vcHRpb25zLmF0dHJpYnV0ZVZhbHVlXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5vcHRpb25zLnJlbmRlck9wdGlvbnMuZG9jdW1lbnRJY29uU2l6ZSkge1xuICAgICAgICAgIHZhciByZVNpemUgPSAvc2l6ZXNcXC8oWzAtOXhjZnNdKykvO1xuICAgICAgICAgIHZhciBub0ljb24gPVxuICAgICAgICAgICAgW1wiMFwiLCBcIjB4MFwiLCBcIngwXCJdLmluZGV4T2YoXG4gICAgICAgICAgICAgIHRoaXMub3B0aW9ucy5yZW5kZXJPcHRpb25zLmRvY3VtZW50SWNvblNpemVcbiAgICAgICAgICAgICkgIT09IC0xO1xuICAgICAgICAgIGlmICh0aGlzLl9pc011bHRpcGxlKCkpIHtcbiAgICAgICAgICAgIF8uZWFjaCh0aGlzLm9wdGlvbnMuYXR0cmlidXRlVmFsdWVzLCBmdW5jdGlvbiB3RG9jaWRSZXNpemVJY29ucyhcbiAgICAgICAgICAgICAgc2luZ2xlVmFsdWVcbiAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICBpZiAobm9JY29uKSB7XG4gICAgICAgICAgICAgICAgc2luZ2xlVmFsdWUuaWNvbiA9IG51bGw7XG4gICAgICAgICAgICAgIH0gZWxzZSBpZiAoc2luZ2xlVmFsdWUuaWNvbikge1xuICAgICAgICAgICAgICAgIHNpbmdsZVZhbHVlLmljb24gPSBzaW5nbGVWYWx1ZS5pY29uLnJlcGxhY2UoXG4gICAgICAgICAgICAgICAgICByZVNpemUsXG4gICAgICAgICAgICAgICAgICBcInNpemVzL1wiICsgc2NvcGUub3B0aW9ucy5yZW5kZXJPcHRpb25zLmRvY3VtZW50SWNvblNpemVcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9IGVsc2UgaWYgKG5vSWNvbikge1xuICAgICAgICAgICAgdGhpcy5vcHRpb25zLmF0dHJpYnV0ZVZhbHVlLmljb24gPSBudWxsO1xuICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5vcHRpb25zLmF0dHJpYnV0ZVZhbHVlLmljb24pIHtcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucy5hdHRyaWJ1dGVWYWx1ZS5pY29uID0gdGhpcy5vcHRpb25zLmF0dHJpYnV0ZVZhbHVlLmljb24ucmVwbGFjZShcbiAgICAgICAgICAgICAgcmVTaXplLFxuICAgICAgICAgICAgICBcInNpemVzL1wiICsgdGhpcy5vcHRpb25zLnJlbmRlck9wdGlvbnMuZG9jdW1lbnRJY29uU2l6ZVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvL25vaW5zcGVjdGlvbiBKU1BvdGVudGlhbGx5SW52YWxpZENvbnN0cnVjdG9yVXNhZ2UsSlNBY2Nlc3NpYmlsaXR5Q2hlY2tcbiAgICAgICAgJC5kY3AuZGNwQXR0cmlidXRlLnByb3RvdHlwZS5faW5pdERvbS5hcHBseSh0aGlzLCBbXSk7XG4gICAgICB9IGVsc2UgaWYgKHRoaXMuZ2V0TW9kZSgpID09PSBcIndyaXRlXCIpIHtcbiAgICAgICAgLy9ub2luc3BlY3Rpb24gSlNQb3RlbnRpYWxseUludmFsaWRDb25zdHJ1Y3RvclVzYWdlLEpTQWNjZXNzaWJpbGl0eUNoZWNrXG4gICAgICAgICQuZGNwLmRjcEF0dHJpYnV0ZS5wcm90b3R5cGUuX2luaXREb20uYXBwbHkodGhpcywgW10pO1xuICAgICAgICB0aGlzLmtlbmRvV2lkZ2V0ID0gdGhpcy5lbGVtZW50LmZpbmQoXCIuZGNwQXR0cmlidXRlX192YWx1ZS0tZG9jaWRcIik7XG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMucmVuZGVyT3B0aW9ucy5wbGFjZUhvbGRlcikge1xuICAgICAgICAgIHRoaXMub3B0aW9ucy5yZW5kZXJPcHRpb25zLmtlbmRvTXVsdGlTZWxlY3RDb25maWd1cmF0aW9uLnBsYWNlaG9sZGVyID0gdGhpcy5vcHRpb25zLnJlbmRlck9wdGlvbnMucGxhY2VIb2xkZXI7XG4gICAgICAgICAgdGhpcy5vcHRpb25zLnJlbmRlck9wdGlvbnMua2VuZG9Db21ib0JveENvbmZpZ3VyYXRpb24ucGxhY2Vob2xkZXIgPSB0aGlzLm9wdGlvbnMucmVuZGVyT3B0aW9ucy5wbGFjZUhvbGRlcjtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5faXNNdWx0aXBsZSgpKSB7XG4gICAgICAgICAgdGhpcy5fZGVjb3JhdGVNdWx0aXBsZVZhbHVlKHRoaXMua2VuZG9XaWRnZXQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHN3aXRjaCAodGhpcy5vcHRpb25zLnJlbmRlck9wdGlvbnMuZWRpdERpc3BsYXkpIHtcbiAgICAgICAgICAgIGNhc2UgXCJzaW5nbGVNdWx0aXBsZVwiOlxuICAgICAgICAgICAgICB0aGlzLl9kZWNvcmF0ZVNpbmdsZVZhbHVlKHRoaXMua2VuZG9XaWRnZXQpO1xuXG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcImF1dG9Db21wbGV0aW9uXCI6XG4gICAgICAgICAgICAgIHRoaXMuc2luZ2xlQ29tYm9ib3godGhpcy5rZW5kb1dpZGdldCk7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcImxpc3RcIjpcbiAgICAgICAgICAgICAgdGhpcy5zaW5nbGVEcm9wZG93bih0aGlzLmtlbmRvV2lkZ2V0KTtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICB0aGlzLnNpbmdsZUNvbWJvYm94KHRoaXMua2VuZG9XaWRnZXQpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLl91cGRhdGVDcmVhdGVCdXR0b24oKTtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgX3VwZGF0ZUNyZWF0ZUJ1dHRvbjogZnVuY3Rpb24gd0RvY2lkX3VwZGF0ZUNyZWF0ZUJ1dHRvbigpIHtcbiAgICAgIHZhciBjdXJyZW50VmFsdWUgPSB0aGlzLm9wdGlvbnMuYXR0cmlidXRlVmFsdWU7XG4gICAgICB2YXIgYnV0dG9uc0NvbmZpZyA9IHRoaXMub3B0aW9ucy5yZW5kZXJPcHRpb25zLmJ1dHRvbnM7XG5cbiAgICAgIHRoaXMuZWxlbWVudFxuICAgICAgICAuZmluZChcIi5kY3BBdHRyaWJ1dGVfX2NvbnRlbnRfX2J1dHRvbi0tY3JlYXRlXCIpXG4gICAgICAgIC5lYWNoKGZ1bmN0aW9uIHdEb2NpZF91cGRhdGVDcmVhdGVCdXR0b25FYWNoKCkge1xuICAgICAgICAgIHZhciAkYnV0dG9uID0gJCh0aGlzKTtcbiAgICAgICAgICB2YXIgYnV0dG9uSW5kZXggPSAkYnV0dG9uLmRhdGEoXCJpbmRleFwiKTtcbiAgICAgICAgICB2YXIgYnV0dG9uQ29uZmlnID0gYnV0dG9uc0NvbmZpZ1tidXR0b25JbmRleF07XG5cbiAgICAgICAgICAkYnV0dG9uLnByb3AoXCJkaXNhYmxlZFwiLCBmYWxzZSk7XG4gICAgICAgICAgaWYgKGN1cnJlbnRWYWx1ZS52YWx1ZSkge1xuICAgICAgICAgICAgJGJ1dHRvbi5odG1sKFxuICAgICAgICAgICAgICBidXR0b25Db25maWcucmVuZGVySHRtbENvbnRlbnQgKyBidXR0b25Db25maWcuaHRtbEVkaXRDb250ZW50XG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgLy8gQFRPRE8gRmluZCBhbiBlZmZpY2llbnQgd2F5IHRvIHZlcmlmeSBlZGl0IGFjY2VzcyBvZiB0YXJnZXRcbiAgICAgICAgICAgIC8qXG4gICAgICAgICAgICAgICAgICAgICBpZiAoIWN1cnJlbnRWYWx1ZS52YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgJGJ1dHRvbi5wcm9wKFwiZGlzYWJsZWRcIiwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgICB9Ki9cbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gYWxzbyB3aGVuIG11dGlwbGUgYWx3YXlzIGNyZWF0ZVxuICAgICAgICAgICAgJGJ1dHRvbi5odG1sKFxuICAgICAgICAgICAgICBidXR0b25Db25maWcucmVuZGVySHRtbENvbnRlbnQgKyBidXR0b25Db25maWcuaHRtbENyZWF0ZUNvbnRlbnRcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogSW5pdCBldmVudCB3aGVuIGEgaHlwZXJsaW5rIGlzIGFzc29jaWF0ZWQgdG8gdGhlIGF0dHJpYnV0ZVxuICAgICAqXG4gICAgICogQHByb3RlY3RlZFxuICAgICAqL1xuICAgIF9pbml0TGlua0V2ZW50OiBmdW5jdGlvbiB3RG9jaWRJbml0TGlua0V2ZW50KCkge1xuICAgICAgdGhpcy5fc3VwZXIoKTtcbiAgICAgIHZhciBodG1sTGluayA9IHRoaXMuZ2V0TGluaygpO1xuICAgICAgdmFyIGN1cnJlbnRXaWRnZXQgPSB0aGlzO1xuICAgICAgaWYgKGh0bWxMaW5rKSB7XG4gICAgICAgIHRoaXMuZWxlbWVudC5vbihcbiAgICAgICAgICBcImNsaWNrLlwiICsgdGhpcy5ldmVudE5hbWVzcGFjZSxcbiAgICAgICAgICBcIi5kY3BBdHRyaWJ1dGVfX2NvbnRlbnRfX2xpbmtcIixcbiAgICAgICAgICBmdW5jdGlvbiB3RG9jaWRJbml0TGlua09uQ2xpY2soZXZlbnQpIHtcbiAgICAgICAgICAgIHZhciAkdGhpcyA9ICQodGhpcyk7XG4gICAgICAgICAgICBpZiAoaHRtbExpbmsudGFyZ2V0ID09PSBcIl9yZW5kZXJcIikge1xuICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICBjdXJyZW50V2lkZ2V0Ll90cmlnZ2VyKFwiZmV0Y2hkb2N1bWVudFwiLCBldmVudCwge1xuICAgICAgICAgICAgICAgIGluZGV4OiAkdGhpcy5kYXRhKFwiaW5kZXhcIiksXG4gICAgICAgICAgICAgICAgdGFibGVMaW5lOiAkdGhpc1xuICAgICAgICAgICAgICAgICAgLmNsb3Nlc3QoXCIuZGNwQXJyYXlfX2NvbnRlbnRfX2xpbmVcIilcbiAgICAgICAgICAgICAgICAgIC5kYXRhKFwibGluZVwiKVxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuICAgIF9pbml0QnV0dG9uc0V2ZW50OiBmdW5jdGlvbiBfaW5pdEJ1dHRvbnNFdmVudCgpIHtcbiAgICAgIHZhciBjdXJyZW50V2lkZ2V0ID0gdGhpcztcbiAgICAgIHRoaXMuX3N1cGVyKCk7XG5cbiAgICAgIHRoaXMuZWxlbWVudC5vbihcbiAgICAgICAgXCJjbGlja1wiICsgdGhpcy5ldmVudE5hbWVzcGFjZSxcbiAgICAgICAgXCIuZGNwQXR0cmlidXRlX19jb250ZW50X19idXR0b24tLWNyZWF0ZVwiLFxuICAgICAgICBmdW5jdGlvbiB3QXR0cmlidXRlQnV0dG9uQ2xpY2soZXZlbnQpIHtcbiAgICAgICAgICB2YXIgYnV0dG9uc0NvbmZpZyA9IGN1cnJlbnRXaWRnZXQub3B0aW9ucy5yZW5kZXJPcHRpb25zLmJ1dHRvbnM7XG4gICAgICAgICAgdmFyICRidXR0b24gPSAkKHRoaXMpO1xuICAgICAgICAgIHZhciBidXR0b25JbmRleCA9ICRidXR0b24uZGF0YShcImluZGV4XCIpO1xuICAgICAgICAgIHZhciBidXR0b25Db25maWcgPSBidXR0b25zQ29uZmlnW2J1dHRvbkluZGV4XTtcblxuICAgICAgICAgIGN1cnJlbnRXaWRnZXQuX3RyaWdnZXIoXCJleHRlcm5hbExpbmtTZWxlY3RlZFwiLCBldmVudCwge1xuICAgICAgICAgICAgdGFyZ2V0OiBldmVudC50YXJnZXQsXG4gICAgICAgICAgICBldmVudElkOiBcImF0dHJpYnV0ZS5jcmVhdGVEb2N1bWVudFJlbGF0aW9uXCIsXG4gICAgICAgICAgICBpbmRleDogY3VycmVudFdpZGdldC5fZ2V0SW5kZXgoKSxcbiAgICAgICAgICAgIGJ1dHRvbkNvbmZpZzogYnV0dG9uQ29uZmlnXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgICB0aGlzLmVsZW1lbnQudG9vbHRpcCh7XG4gICAgICAgIHNlbGVjdG9yOiBcIi5kY3BBdHRyaWJ1dGVfX2NvbnRlbnRfX2J1dHRvbnMgYnV0dG9uXCIsXG4gICAgICAgIHBsYWNlbWVudDogXCJ0b3BcIixcbiAgICAgICAgdHJpZ2dlcjogXCJob3ZlclwiLFxuICAgICAgICBodG1sOiB0cnVlLFxuICAgICAgICB0aXRsZTogZnVuY3Rpb24gd0F0dHJpYnV0ZUdldEJ1dHRvblRpdGxlKCkge1xuICAgICAgICAgIHZhciB0aXRsZSA9ICQodGhpcykuZGF0YShcInRpdGxlXCIpO1xuICAgICAgICAgIHZhciBhdHRyVmFsdWUgPSBjdXJyZW50V2lkZ2V0LmdldFZhbHVlKCk7XG4gICAgICAgICAgcmV0dXJuIE11c3RhY2hlLnJlbmRlcih0aXRsZSB8fCBcIlwiLCBhdHRyVmFsdWUpO1xuICAgICAgICB9LFxuICAgICAgICBjb250YWluZXI6IHRoaXMuZWxlbWVudFxuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG4gICAgLyoqXG4gICAgICogRGVmaW5lIGlucHV0cyBmb3IgZm9jdXNcbiAgICAgKiBAcHJvdGVjdGVkXG4gICAgICovXG4gICAgX2dldEZvY3VzSW5wdXQ6IGZ1bmN0aW9uIHdEb2NpZEZvY3VzSW5wdXQoKSB7XG4gICAgICByZXR1cm4gdGhpcy5lbGVtZW50LmZpbmQoXCJpbnB1dFwiKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogR2V0IGtlbmRvIG9wdGlvbiBmcm9tIG5vcm1hbCBvcHRpb25zIGFuZCBmcm9tIHJlbmRlck9wdGlvbnMua2VuZG9NdWx0aVNlbGVjdENvbmZpZ3VyYXRpb25cbiAgICAgKiBAcmV0dXJucyB7Kn1cbiAgICAgKi9cbiAgICBnZXRLZW5kb09wdGlvbnM6IGZ1bmN0aW9uIHdEb2NpZEdldEtlbmRvT3B0aW9ucyhpbnB1dFZhbHVlLCBleHRyYU9wdGlvbnMpIHtcbiAgICAgIHZhciBjdXJyZW50V2lkZ2V0ID0gdGhpcztcbiAgICAgIHZhciBvcHRpb25zID0ge1xuICAgICAgICBhdXRvQmluZDogZmFsc2UsXG4gICAgICAgIGNsZWFyQnV0dG9uOiBmYWxzZSxcbiAgICAgICAgZGF0YVRleHRGaWVsZDogXCJkb2NUaXRsZVwiLFxuICAgICAgICBkYXRhVmFsdWVGaWVsZDogXCJkb2NJZFwiLFxuICAgICAgICBoaWdobGlnaHRGaXJzdDogdHJ1ZSxcbiAgICAgICAgLy92YWx1ZTogdmFsdWVzLFxuICAgICAgICBkYXRhU291cmNlOiB7XG4gICAgICAgICAgLy8gdHlwZTogXCJqc29uXCIsXG4gICAgICAgICAgc2VydmVyRmlsdGVyaW5nOiB0cnVlLFxuICAgICAgICAgIHRyYW5zcG9ydDoge1xuICAgICAgICAgICAgcmVhZDogZnVuY3Rpb24gd0RvY2lkU2VsZWN0UmVhZChvcHRpb25zKSB7XG4gICAgICAgICAgICAgIGN1cnJlbnRXaWRnZXQuX2hhc0JlZW5SZXF1ZXN0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgICBvcHRpb25zLmRhdGEuaW5kZXggPSBjdXJyZW50V2lkZ2V0Ll9nZXRJbmRleCgpO1xuICAgICAgICAgICAgICByZXR1cm4gY3VycmVudFdpZGdldC5vcHRpb25zLmF1dG9jb21wbGV0ZVJlcXVlc3QuY2FsbChcbiAgICAgICAgICAgICAgICBudWxsLFxuICAgICAgICAgICAgICAgIG9wdGlvbnMsXG4gICAgICAgICAgICAgICAgY3VycmVudFdpZGdldC5fZ2V0SW5kZXgoKVxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgc2NoZW1hOiB7XG4gICAgICAgICAgICAvLyBBZGQgYWxyZWFkeSByZWNvcmRlZCBkYXRhIHRvIGl0ZW1zXG4gICAgICAgICAgICBkYXRhOiBmdW5jdGlvbiB3RG9jaWRTZWxlY3RTY2hlbWEoaXRlbXMpIHtcbiAgICAgICAgICAgICAgLy9BZGQgbmV3IGVsZW1lbnRzXG4gICAgICAgICAgICAgIF8uZWFjaChpdGVtcywgZnVuY3Rpb24gd0RvY2lkRGF0YUNvbXBvc2UoY3VycmVudEl0ZW0pIHtcbiAgICAgICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgICBjdXJyZW50SXRlbS52YWx1ZXMgJiZcbiAgICAgICAgICAgICAgICAgIGN1cnJlbnRJdGVtLnZhbHVlc1tjdXJyZW50V2lkZ2V0Lm9wdGlvbnMuaWRdXG4gICAgICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgICBjdXJyZW50SXRlbS5kb2NJZCA9XG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnRJdGVtLnZhbHVlc1tjdXJyZW50V2lkZ2V0Lm9wdGlvbnMuaWRdLnZhbHVlO1xuICAgICAgICAgICAgICAgICAgY3VycmVudEl0ZW0uZG9jVGl0bGUgPVxuICAgICAgICAgICAgICAgICAgICBjdXJyZW50SXRlbS52YWx1ZXNbY3VycmVudFdpZGdldC5vcHRpb25zLmlkXS5kaXNwbGF5VmFsdWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAvL1N1cHByZXNzIG11bHRpcGxlIGl0ZW1zXG4gICAgICAgICAgICAgIHJldHVybiBfLnVuaXEoaXRlbXMsIGZhbHNlLCBmdW5jdGlvbiB3RG9jaWREYXRhVW5pcShjdXJyZW50SXRlbSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBjdXJyZW50SXRlbS5kb2NJZCB8fCBjdXJyZW50SXRlbS5tZXNzYWdlO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHNlbGVjdDogZnVuY3Rpb24ga2VuZG9Eb2NpZFNlbGVjdChldmVudCkge1xuICAgICAgICAgIGlmICghZXZlbnQuaXRlbSB8fCBfLmlzVW5kZWZpbmVkKGV2ZW50Lml0ZW0uaW5kZXgoKSkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICB2YXIgdmFsdWVJbmRleCA9IGN1cnJlbnRXaWRnZXQuX2dldEluZGV4KCk7XG4gICAgICAgICAgdmFyIGRhdGFJdGVtID0gdGhpcy5kYXRhU291cmNlLmF0KGV2ZW50Lml0ZW0uaW5kZXgoKSkudG9KU09OKCk7XG5cbiAgICAgICAgICBpZiAoZGF0YUl0ZW0ubWVzc2FnZSkge1xuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy9UaGUgb2JqZWN0IHJldHVybmVkIGJ5IGRhdGFTb3VyY2UuYXQgYXJlIGludGVybmFsIGtlbmRvIG9iamVjdCBzbyBJIGNsZWFuIGl0IHdpdGggdG9KU09OXG5cbiAgICAgICAgICAgIF8uZGVmZXIoZnVuY3Rpb24gd0RvY2lkQ2hhbmdlT25TZWxlY3QoKSB7XG4gICAgICAgICAgICAgIC8vIENoYW5nZSBvdGhlcnMgYXR0cmlidXRlcyBkZXNpZ25lZCBieSBoZWxwIHJldHVybnNcbiAgICAgICAgICAgICAgY3VycmVudFdpZGdldC5fdHJpZ2dlcihcbiAgICAgICAgICAgICAgICBcImNoYW5nZWF0dHJzdmFsdWVcIixcbiAgICAgICAgICAgICAgICBldmVudCxcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICBkYXRhSXRlbTogZGF0YUl0ZW0sXG4gICAgICAgICAgICAgICAgICB2YWx1ZUluZGV4OiB2YWx1ZUluZGV4XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBjdXJyZW50V2lkZ2V0Ll9nZXRJbmRleCgpXG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGNoYW5nZTogZnVuY3Rpb24ga2VuZG9DaGFuZ2VTZWxlY3QoZXZlbnQpIHtcbiAgICAgICAgICAvLyBzZXQgaW4gY2FzZSBvZiBkZWxldGUgaXRlbVxuICAgICAgICAgIHZhciBvbGRWYWx1ZXMgPSBjdXJyZW50V2lkZ2V0Lm9wdGlvbnMuYXR0cmlidXRlVmFsdWU7XG4gICAgICAgICAgdmFyIGRpc3BsYXlWYWx1ZTtcbiAgICAgICAgICB2YXIgbmV3VmFsdWVzID0gW107XG4gICAgICAgICAgdmFyIGtNdWx0aVNlbGVjdCA9IHRoaXM7XG4gICAgICAgICAgdmFyIHdpZGdldFZhbHVlID0gdGhpcy52YWx1ZSgpO1xuXG4gICAgICAgICAgaWYgKF8uaXNBcnJheSh3aWRnZXRWYWx1ZSkpIHtcbiAgICAgICAgICAgIF8uZWFjaCh3aWRnZXRWYWx1ZSwgZnVuY3Rpb24gd0RvY2lkU2VsZWN0Q2hhbmdlKHZhbCkge1xuICAgICAgICAgICAgICBpZiAoIV8uaXNVbmRlZmluZWQodmFsKSkge1xuICAgICAgICAgICAgICAgIGRpc3BsYXlWYWx1ZSA9IF8ud2hlcmUob2xkVmFsdWVzLCB7IHZhbHVlOiB2YWwgfSk7XG4gICAgICAgICAgICAgICAgaWYgKGRpc3BsYXlWYWx1ZS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgIGRpc3BsYXlWYWx1ZSA9IF8ud2hlcmUoa011bHRpU2VsZWN0LmRhdGFTb3VyY2UuZGF0YSgpLCB7XG4gICAgICAgICAgICAgICAgICAgIGRvY0lkOiB2YWxcbiAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgaWYgKGRpc3BsYXlWYWx1ZS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGRpc3BsYXlWYWx1ZSA9IGRpc3BsYXlWYWx1ZVswXS5kb2NUaXRsZTtcbiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGRpc3BsYXlWYWx1ZSA9IFwiLVwiO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICBkaXNwbGF5VmFsdWUgPSBkaXNwbGF5VmFsdWVbMF0uZGlzcGxheVZhbHVlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIG5ld1ZhbHVlcy5wdXNoKHsgdmFsdWU6IHZhbCwgZGlzcGxheVZhbHVlOiBkaXNwbGF5VmFsdWUgfSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpZiAoIWN1cnJlbnRXaWRnZXQuX2lzTXVsdGlwbGUoKSkge1xuICAgICAgICAgICAgICBpZiAobmV3VmFsdWVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICBuZXdWYWx1ZXMgPSBuZXdWYWx1ZXNbMF07XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgbmV3VmFsdWVzID0geyB2YWx1ZTogbnVsbCwgZGlzcGxheVZhbHVlOiBcIlwiIH07XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKHdpZGdldFZhbHVlKSB7XG4gICAgICAgICAgICAgIGRpc3BsYXlWYWx1ZSA9IF8ud2hlcmUoa011bHRpU2VsZWN0LmRhdGFTb3VyY2UuZGF0YSgpLCB7XG4gICAgICAgICAgICAgICAgZG9jSWQ6IHdpZGdldFZhbHVlXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICBpZiAoZGlzcGxheVZhbHVlLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICBkaXNwbGF5VmFsdWUgPSBkaXNwbGF5VmFsdWVbMF0uZG9jVGl0bGU7XG4gICAgICAgICAgICAgICAgbmV3VmFsdWVzID0geyB2YWx1ZTogd2lkZ2V0VmFsdWUsIGRpc3BsYXlWYWx1ZTogZGlzcGxheVZhbHVlIH07XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgbmV3VmFsdWVzID0geyB2YWx1ZTogbnVsbCwgZGlzcGxheVZhbHVlOiBcIlwiIH07XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIG5ld1ZhbHVlcyA9IHsgdmFsdWU6IG51bGwsIGRpc3BsYXlWYWx1ZTogXCJcIiB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cblxuICAgICAgICAgIGN1cnJlbnRXaWRnZXQuc2V0VmFsdWUobmV3VmFsdWVzLCBldmVudCk7XG4gICAgICAgIH0sXG4gICAgICAgIG9wZW46IGZ1bmN0aW9uIHdEb2NpZFNlbGVjdE9wZW4oZXZlbnQpIHtcbiAgICAgICAgICBpZiAoY3VycmVudFdpZGdldC5faGFzQmVlblJlcXVlc3RlZCAhPT0gdHJ1ZSkge1xuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIGN1cnJlbnRXaWRnZXQua2VuZG9XaWRnZXRPYmplY3Quc2VhcmNoKFwiXCIpO1xuICAgICAgICAgIH1cbiAgICAgICAgICB0aGlzLnVsLmFkZENsYXNzKFwiZGNwQXR0cmlidXRlX19zZWxlY3QtLWRvY2lkXCIpO1xuICAgICAgICB9LFxuICAgICAgICBjbG9zZTogZnVuY3Rpb24gd0RvY2lkU2VsZWN0Q2xvc2UoKSB7XG4gICAgICAgICAgaWYgKHRoaXMubnMgIT09IFwiLmtlbmRvRHJvcERvd25MaXN0XCIpIHtcbiAgICAgICAgICAgIGN1cnJlbnRXaWRnZXQuX2hhc0JlZW5SZXF1ZXN0ZWQgPSBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGZpbHRlcmluZzogZnVuY3Rpb24gd0RvY2lkU2VsZWN0T3BlbigpIHtcbiAgICAgICAgICB0aGlzLl9pc0ZpbHRlcmluZyA9IHRydWU7XG4gICAgICAgIH0sXG4gICAgICAgIGRhdGFCb3VuZDogZnVuY3Rpb24gd0RvY2lkRmlsdGVyaW5nTm9PbmUoKSB7XG4gICAgICAgICAgaWYgKHRoaXMuX2lzRmlsdGVyaW5nKSB7XG4gICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgIHRoaXMudWwuZmluZChcImxpOm5vdCguay1zdGF0ZS1zZWxlY3RlZClcIikubGVuZ3RoID09PSAwICYmXG4gICAgICAgICAgICAgIHRoaXMudWwuZmluZChcImxpLmstc3RhdGUtc2VsZWN0ZWRcIikubGVuZ3RoID4gMFxuICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgIC8vIE5vIG9uZSBtb3JlIDogZGlzcGxheVxuICAgICAgICAgICAgICB2YXIgJG5vT25lID0gJCgnPGxpIGNsYXNzPVwiay1pdGVtXCIvPicpXG4gICAgICAgICAgICAgICAgLmFwcGVuZCgnPHNwYW4gY2xhc3M9XCJrLXN0YXRlLWRlZmF1bHRcIi8+JylcbiAgICAgICAgICAgICAgICAuYXBwZW5kKFxuICAgICAgICAgICAgICAgICAgJChcbiAgICAgICAgICAgICAgICAgICAgJzxzcGFuIGNsYXNzPVwiay1zdGF0ZS1lcnJvciBkY3BBdHRyaWJ1dGVfX3NlbGVjdC0tZG9jaWQtbm9uZVwiLz4nXG4gICAgICAgICAgICAgICAgICApLnRleHQoY3VycmVudFdpZGdldC5vcHRpb25zLmxhYmVscy5hbGxTZWxlY3RlZERvY3VtZW50KVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgIHRoaXMudWwuYXBwZW5kKCRub09uZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLl9pc0ZpbHRlcmluZyA9IGZhbHNlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgaWYgKGV4dHJhT3B0aW9ucykge1xuICAgICAgICBvcHRpb25zID0gXy5leHRlbmQob3B0aW9ucywgZXh0cmFPcHRpb25zKTtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLm9wdGlvbnMucmVuZGVyT3B0aW9ucy5rZW5kb0NvbWJvQm94Q29uZmlndXJhdGlvbikge1xuICAgICAgICBvcHRpb25zID0gXy5leHRlbmQoXG4gICAgICAgICAgdGhpcy5vcHRpb25zLnJlbmRlck9wdGlvbnMua2VuZG9Db21ib0JveENvbmZpZ3VyYXRpb24sXG4gICAgICAgICAgb3B0aW9uc1xuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gb3B0aW9ucztcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogV2hlbiBkb2NpZCBpcyBub3QgbXVsdGlwbGUsIGl0IGlzIGEgbXVsdGlzZWxlY3QgbGltaXRlZCB0byBvbmUgZWxlbWVudFxuICAgICAqIEBwYXJhbSBpbnB1dFZhbHVlIHNlbGVjdCAgZWxlbWVudFxuICAgICAqL1xuICAgIF9kZWNvcmF0ZVNpbmdsZVZhbHVlOiBmdW5jdGlvbiB3RG9jaWREZWNvcmF0ZVNpbmdsZVZhbHVlKGlucHV0VmFsdWUpIHtcbiAgICAgIHRoaXMub3B0aW9ucy5hdHRyaWJ1dGVWYWx1ZXMgPSBbXTtcbiAgICAgIGlmICh0aGlzLm9wdGlvbnMuYXR0cmlidXRlVmFsdWUpIHtcbiAgICAgICAgdGhpcy5vcHRpb25zLmF0dHJpYnV0ZVZhbHVlcy5wdXNoKHRoaXMub3B0aW9ucy5hdHRyaWJ1dGVWYWx1ZSk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuX2RlY29yYXRlTXVsdGlwbGVWYWx1ZShpbnB1dFZhbHVlLCB7XG4gICAgICAgIG1heFNlbGVjdGVkSXRlbXM6IDFcbiAgICAgIH0pO1xuXG4gICAgICBpZiAoXG4gICAgICAgIHRoaXMub3B0aW9ucy5hdHRyaWJ1dGVWYWx1ZSAmJlxuICAgICAgICB0aGlzLm9wdGlvbnMuYXR0cmlidXRlVmFsdWUudmFsdWUgIT09IG51bGxcbiAgICAgICkge1xuICAgICAgICB0aGlzLmVsZW1lbnRcbiAgICAgICAgICAuZmluZChcIi5kY3BBdHRyaWJ1dGVfX3ZhbHVlLS1kb2NpZC0tYnV0dG9uXCIpXG4gICAgICAgICAgLmF0dHIoXCJkaXNhYmxlZFwiLCBcImRpc2FibGVkXCIpO1xuICAgICAgICB0aGlzLmVsZW1lbnQuZmluZChcImlucHV0LmstaW5wdXRcIikuYXR0cihcImRpc2FibGVkXCIsIFwiZGlzYWJsZWRcIik7XG4gICAgICB9XG4gICAgfSxcblxuICAgIF9kZWNvcmF0ZU11bHRpcGxlVmFsdWU6IGZ1bmN0aW9uIHdEb2NpZERlY29yYXRlTXVsdGlwbGVWYWx1ZShcbiAgICAgIGlucHV0VmFsdWUsXG4gICAgICBleHRyYU9wdGlvbnNcbiAgICApIHtcbiAgICAgIHZhciBvcHRpb25zID0gdGhpcy5nZXRLZW5kb09wdGlvbnMoaW5wdXRWYWx1ZSwge1xuICAgICAgICBmaWx0ZXI6IFwiY29udGFpbnNcIlxuICAgICAgfSk7XG4gICAgICB2YXIgY3VycmVudFdpZGdldCA9IHRoaXMsXG4gICAgICAgIHZhbHVlcyA9IF8ubWFwKHRoaXMub3B0aW9ucy5hdHRyaWJ1dGVWYWx1ZXMsIGZ1bmN0aW9uIHdEb2NpZFNlbGVjdE1hcChcbiAgICAgICAgICB2YWxcbiAgICAgICAgKSB7XG4gICAgICAgICAgdmFyIGluZm8gPSB7fTtcbiAgICAgICAgICBpbmZvLmRvY1RpdGxlID0gdmFsLmRpc3BsYXlWYWx1ZTtcbiAgICAgICAgICBpbmZvLmRvY0lkID0gdmFsLnZhbHVlO1xuICAgICAgICAgIHJldHVybiBpbmZvO1xuICAgICAgICB9KTtcblxuICAgICAgaWYgKGV4dHJhT3B0aW9ucykge1xuICAgICAgICBvcHRpb25zID0gXy5leHRlbmQob3B0aW9ucywgZXh0cmFPcHRpb25zKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHRoaXMub3B0aW9ucy5yZW5kZXJPcHRpb25zLmtlbmRvTXVsdGlTZWxlY3RDb25maWd1cmF0aW9uKSB7XG4gICAgICAgIG9wdGlvbnMgPSBfLmV4dGVuZChcbiAgICAgICAgICB0aGlzLm9wdGlvbnMucmVuZGVyT3B0aW9ucy5rZW5kb011bHRpU2VsZWN0Q29uZmlndXJhdGlvbixcbiAgICAgICAgICBvcHRpb25zXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICAvL25vaW5zcGVjdGlvbiBKU1VucmVzb2x2ZWRGdW5jdGlvblxuICAgICAgaW5wdXRWYWx1ZS5rZW5kb011bHRpU2VsZWN0KG9wdGlvbnMpO1xuICAgICAgdGhpcy5rZW5kb1dpZGdldE9iamVjdCA9IGlucHV0VmFsdWUuZGF0YShcImtlbmRvTXVsdGlTZWxlY3RcIik7XG4gICAgICB0aGlzLmtlbmRvV2lkZ2V0T2JqZWN0LmRhdGFTb3VyY2UuZGF0YSh2YWx1ZXMpO1xuXG4gICAgICBpZiAodGhpcy5vcHRpb25zLmF0dHJpYnV0ZVZhbHVlcy52YWx1ZSAhPT0gbnVsbCkge1xuICAgICAgICAvLyBJbml0IGtlbmRvIHdpZGdldCB3aXRoIGlkZW50aWZpZXIgYXJyYXlcbiAgICAgICAgdGhpcy5rZW5kb1dpZGdldE9iamVjdC52YWx1ZShcbiAgICAgICAgICBfLmZpbHRlcihcbiAgICAgICAgICAgIF8ubWFwKHZhbHVlcywgZnVuY3Rpb24gd0RvY2lkSW5pdFZhbHVlKGl0ZW0pIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGl0ZW0uZG9jSWQ7XG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIGZ1bmN0aW9uIHdEb2NpZEZpbHRlckVtcHR5KGl0ZW0pIHtcbiAgICAgICAgICAgICAgcmV0dXJuICFfLmlzRW1wdHkoaXRlbSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgKVxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgdGhpcy5lbGVtZW50Lm9uKFxuICAgICAgICBcImNsaWNrXCIgKyB0aGlzLmV2ZW50TmFtZXNwYWNlLFxuICAgICAgICBcIi5kY3BBdHRyaWJ1dGVfX3ZhbHVlLS1kb2NpZC0tYnV0dG9uXCIsXG4gICAgICAgIGZ1bmN0aW9uIHdEb2NpZFNlbGVjdENsaWNrKGV2ZW50KSB7XG4gICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICBjdXJyZW50V2lkZ2V0LmtlbmRvV2lkZ2V0T2JqZWN0LnNlYXJjaChcIlwiKTtcbiAgICAgICAgfVxuICAgICAgKTtcblxuICAgICAgdGhpcy5lbGVtZW50LmZpbmQoXCIuZGNwQXR0cmlidXRlX192YWx1ZS0tZG9jaWQtLWJ1dHRvblt0aXRsZV1cIikudG9vbHRpcCh7XG4gICAgICAgIGh0bWw6IHRydWVcbiAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBzaW5nbGVEcm9wZG93bjogZnVuY3Rpb24gd0RvY2lkU2luZ2xlRHJvcGRvd24oaW5wdXRWYWx1ZSkge1xuICAgICAgdmFyIGtlbmRvT3B0aW9ucyA9IHRoaXMuZ2V0S2VuZG9PcHRpb25zKGlucHV0VmFsdWUpO1xuXG4gICAgICB0aGlzLmtlbmRvV2lkZ2V0T2JqZWN0ID0gaW5wdXRWYWx1ZVxuICAgICAgICAua2VuZG9Ecm9wRG93bkxpc3Qoa2VuZG9PcHRpb25zKVxuICAgICAgICAuZGF0YShcImtlbmRvRHJvcERvd25MaXN0XCIpO1xuXG4gICAgICB0aGlzLmtlbmRvV2lkZ2V0T2JqZWN0Lmxpc3RcbiAgICAgICAgLmZpbmQoXCIuay1saXN0LW9wdGlvbmxhYmVsXCIpXG4gICAgICAgIC5hZGRDbGFzcyhcInBsYWNlaG9sZGVyLS1jbGVhclwiKTtcbiAgICAgIHRoaXMua2VuZG9XaWRnZXRPYmplY3QudmFsdWUodGhpcy5vcHRpb25zLmF0dHJpYnV0ZVZhbHVlLnZhbHVlKTtcbiAgICAgIHRoaXMuZWxlbWVudFxuICAgICAgICAuZmluZChcIi5kY3BBdHRyaWJ1dGVfX3ZhbHVlLS1kb2NpZC0tYnV0dG9uXCIpXG4gICAgICAgIC5wYXJlbnQoKVxuICAgICAgICAuaGlkZSgpO1xuICAgIH0sXG5cbiAgICBzaW5nbGVDb21ib2JveDogZnVuY3Rpb24gd0RvY2lkU2luZ2xlQ29tYm9ib3goaW5wdXRWYWx1ZSkge1xuICAgICAgdmFyIGtlbmRvT3B0aW9ucyA9IHRoaXMuZ2V0S2VuZG9PcHRpb25zKGlucHV0VmFsdWUsIHtcbiAgICAgICAgZmlsdGVyOiBcInN0YXJ0c3dpdGhcIiAvL0BUT0RPIHVzZSBmaWx0ZXIgb3B0aW9uIGluIHN0YW5kYXJkIGF1dG8gY29tcGxldGVcbiAgICAgIH0pO1xuICAgICAgdmFyIGtlbmRvU2VsZWN0O1xuXG4gICAgICB0aGlzLmtlbmRvV2lkZ2V0T2JqZWN0ID0gaW5wdXRWYWx1ZVxuICAgICAgICAua2VuZG9Db21ib0JveChrZW5kb09wdGlvbnMpXG4gICAgICAgIC5kYXRhKFwia2VuZG9Db21ib0JveFwiKTtcbiAgICAgIGtlbmRvU2VsZWN0ID0gdGhpcy5rZW5kb1dpZGdldE9iamVjdDtcbiAgICAgIHRoaXMua2VuZG9XaWRnZXRPYmplY3QubGlzdFxuICAgICAgICAuZmluZChcIi5rLWxpc3Qtb3B0aW9ubGFiZWxcIilcbiAgICAgICAgLmFkZENsYXNzKFwicGxhY2Vob2xkZXItLWNsZWFyXCIpO1xuXG4gICAgICBpZiAodGhpcy5vcHRpb25zLmF0dHJpYnV0ZVZhbHVlICYmIHRoaXMub3B0aW9ucy5hdHRyaWJ1dGVWYWx1ZS52YWx1ZSkge1xuICAgICAgICBrZW5kb1NlbGVjdC5kYXRhU291cmNlLmFkZCh7XG4gICAgICAgICAgZG9jSWQ6IHRoaXMub3B0aW9ucy5hdHRyaWJ1dGVWYWx1ZS52YWx1ZSxcbiAgICAgICAgICBkb2NUaXRsZTogdGhpcy5vcHRpb25zLmF0dHJpYnV0ZVZhbHVlLmRpc3BsYXlWYWx1ZVxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgaWYgKHRoaXMub3B0aW9ucy5hdHRyaWJ1dGVWYWx1ZS52YWx1ZSkge1xuICAgICAgICAvLyBJbml0IHZhbHVlIGluIGtlbmRvIG9ubHkgaWYgYW55IDogaWYgbm90IGNhbGwgdG8gc2VydmVyIGlzIHBlcmZvcm1lZFxuICAgICAgICB0aGlzLmtlbmRvV2lkZ2V0T2JqZWN0LnZhbHVlKHRoaXMub3B0aW9ucy5hdHRyaWJ1dGVWYWx1ZS52YWx1ZSk7XG4gICAgICB9XG4gICAgICB0aGlzLmVsZW1lbnRcbiAgICAgICAgLmZpbmQoXCIuZGNwQXR0cmlidXRlX192YWx1ZS0tZG9jaWQtLWJ1dHRvblwiKVxuICAgICAgICAucGFyZW50KClcbiAgICAgICAgLmhpZGUoKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogUmV0dXJuIHRydWUgaWYgYXR0cmlidXQgaGFzIG11bHRpcGxlIG9wdGlvblxuICAgICAqIEByZXR1cm5zIGJvb2xcbiAgICAgKi9cbiAgICBoYXNNdWx0aXBsZU9wdGlvbjogZnVuY3Rpb24gd0RvY2lkSGFzTXVsdGlwbGVPcHRpb24oKSB7XG4gICAgICByZXR1cm4gdGhpcy5vcHRpb25zLm9wdGlvbnMgJiYgdGhpcy5vcHRpb25zLm9wdGlvbnMubXVsdGlwbGUgPT09IFwieWVzXCI7XG4gICAgfSxcblxuICAgIHNldFZhbHVlOiBmdW5jdGlvbiB3RG9jaWRTZXRWYWx1ZSh2YWx1ZSwgZXZlbnQpIHtcbiAgICAgIHZhciBuZXdWYWx1ZXM7XG4gICAgICB0aGlzLl9zdXBlcih2YWx1ZSwgZXZlbnQpO1xuICAgICAgaWYgKHRoaXMuZ2V0TW9kZSgpID09PSBcIndyaXRlXCIpIHtcbiAgICAgICAgaWYgKFxuICAgICAgICAgICF0aGlzLmhhc011bHRpcGxlT3B0aW9uKCkgJiZcbiAgICAgICAgICB0aGlzLm9wdGlvbnMucmVuZGVyT3B0aW9ucy5lZGl0RGlzcGxheSA9PT0gXCJzaW5nbGVNdWx0aXBsZVwiXG4gICAgICAgICkge1xuICAgICAgICAgIGlmICghXy5pc0FycmF5KHZhbHVlKSkge1xuICAgICAgICAgICAgaWYgKHZhbHVlLnZhbHVlICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgIHZhbHVlID0gW3ZhbHVlXTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHZhbHVlID0gW107XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIGlmICh2YWx1ZS5sZW5ndGggPT09IDEgJiYgdmFsdWUudmFsdWUgPT09IG51bGwpIHtcbiAgICAgICAgICAgIHZhbHVlID0gW107XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmICh2YWx1ZS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudFxuICAgICAgICAgICAgICAuZmluZChcIi5kY3BBdHRyaWJ1dGVfX3ZhbHVlLS1kb2NpZC0tYnV0dG9uXCIpXG4gICAgICAgICAgICAgIC5yZW1vdmVBdHRyKFwiZGlzYWJsZWRcIik7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQuZmluZChcImlucHV0LmstaW5wdXRcIikucmVtb3ZlQXR0cihcImRpc2FibGVkXCIpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnRcbiAgICAgICAgICAgICAgLmZpbmQoXCIuZGNwQXR0cmlidXRlX192YWx1ZS0tZG9jaWQtLWJ1dHRvblwiKVxuICAgICAgICAgICAgICAuYXR0cihcImRpc2FibGVkXCIsIFwiZGlzYWJsZWRcIik7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQuZmluZChcImlucHV0LmstaW5wdXRcIikuYXR0cihcImRpc2FibGVkXCIsIFwiZGlzYWJsZWRcIik7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKFxuICAgICAgICAgIHRoaXMuaGFzTXVsdGlwbGVPcHRpb24oKSB8fFxuICAgICAgICAgIHRoaXMub3B0aW9ucy5yZW5kZXJPcHRpb25zLmVkaXREaXNwbGF5ID09PSBcInNpbmdsZU11bHRpcGxlXCJcbiAgICAgICAgKSB7XG4gICAgICAgICAgbmV3VmFsdWVzID0gXy5tYXAodmFsdWUsIGZ1bmN0aW9uIHdEb2NpZE1hcFZhbHVlKHZhbCkge1xuICAgICAgICAgICAgcmV0dXJuIHZhbC52YWx1ZTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBuZXdWYWx1ZXMgPSB2YWx1ZS52YWx1ZTtcbiAgICAgICAgfVxuICAgICAgICB2YXIga2VuZG9TZWxlY3QgPSB0aGlzLmtlbmRvV2lkZ2V0T2JqZWN0O1xuICAgICAgICB2YXIgb3JpZ2luYWxWYWx1ZXMgPSBfLmNsb25lKGtlbmRvU2VsZWN0LnZhbHVlKCkpO1xuICAgICAgICAvLyB1cGRhdGUgdmFsdWVzIGluIGtlbmRvIHdpZGdldFxuXG4gICAgICAgIHZhciBkYXRhT3JpID0gXy5tYXAoXG4gICAgICAgICAgXy5maWx0ZXIoa2VuZG9TZWxlY3QuZGF0YVNvdXJjZS5kYXRhKCksIGZ1bmN0aW9uIHdEb2NJZEZpbHRlcihpdGVtKSB7XG4gICAgICAgICAgICByZXR1cm4gIV8uaXNFbXB0eShpdGVtLmRvY0lkKTtcbiAgICAgICAgICB9KSxcbiAgICAgICAgICBmdW5jdGlvbiB3RG9jaWRGaWx0ZXJFbXB0eShjdXJyZW50RWxlbWVudCkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgZG9jSWQ6IGN1cnJlbnRFbGVtZW50LmRvY0lkLFxuICAgICAgICAgICAgICBkb2NUaXRsZTogY3VycmVudEVsZW1lbnQuZG9jVGl0bGVcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfVxuICAgICAgICApO1xuXG4gICAgICAgIGlmICghXy5pc0FycmF5KHZhbHVlKSkge1xuICAgICAgICAgIHZhbHVlID0gW3ZhbHVlXTtcbiAgICAgICAgfVxuICAgICAgICBfLmVhY2godmFsdWUsIGZ1bmN0aW9uIHdEb2NpZEVhY2hEYXRhKHZhbCkge1xuICAgICAgICAgIHZhciBpbmZvID0ge307XG5cbiAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAhXy5zb21lKGRhdGFPcmksIGZ1bmN0aW9uIHdEb2NpZEVhY2hVbmlxKGVsdCkge1xuICAgICAgICAgICAgICByZXR1cm4gdmFsICYmIGVsdC5kb2NJZCA9PT0gdmFsLnZhbHVlO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICApIHtcbiAgICAgICAgICAgIC8vIGFkZCBtb3JlIHN0YXRpYyBkYXRhIGluIGRhdGFTb3VyY2VcbiAgICAgICAgICAgIGlmICh2YWwudmFsdWUgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgaW5mby5kb2NUaXRsZSA9IHZhbC5kaXNwbGF5VmFsdWU7XG4gICAgICAgICAgICAgIGluZm8uZG9jSWQgPSB2YWwudmFsdWU7XG4gICAgICAgICAgICAgIGtlbmRvU2VsZWN0LmRhdGFTb3VyY2UuYWRkKGluZm8pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKCF0aGlzLl9pc0VxdWFsKG9yaWdpbmFsVmFsdWVzLCBuZXdWYWx1ZXMpKSB7XG4gICAgICAgICAga2VuZG9TZWxlY3QudmFsdWUobmV3VmFsdWVzKTtcbiAgICAgICAgICB0aGlzLmZsYXNoRWxlbWVudCgpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3VwZGF0ZUNyZWF0ZUJ1dHRvbigpO1xuICAgICAgfSBlbHNlIGlmICh0aGlzLmdldE1vZGUoKSA9PT0gXCJyZWFkXCIpIHtcbiAgICAgICAgdGhpcy5yZWRyYXcoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICBcIkF0dHJpYnV0ZSBcIiArIHRoaXMub3B0aW9ucy5pZCArIFwiIHVua293biBtb2RlIFwiICsgdGhpcy5nZXRNb2RlKClcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgX2lzRXF1YWw6IGZ1bmN0aW9uKHZhbHVlczEsIHZhbHVlczIpIHtcbiAgICAgIHZhciBjb252ZXJ0VG9TdHJpbmcgPSBmdW5jdGlvbihjdXJyZW50VmFsdWUpIHtcbiAgICAgICAgaWYgKCFjdXJyZW50VmFsdWUgfHwgIWN1cnJlbnRWYWx1ZS50b1N0cmluZykge1xuICAgICAgICAgIGN1cnJlbnRWYWx1ZSA9IFwiXCI7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGN1cnJlbnRWYWx1ZS50b1N0cmluZygpO1xuICAgICAgfTtcbiAgICAgIGlmICghXy5pc0FycmF5KHZhbHVlczEpKSB7XG4gICAgICAgIHZhbHVlczEgPSBbdmFsdWVzMV07XG4gICAgICB9XG4gICAgICBpZiAoIV8uaXNBcnJheSh2YWx1ZXMyKSkge1xuICAgICAgICB2YWx1ZXMyID0gW3ZhbHVlczJdO1xuICAgICAgfVxuICAgICAgdmFsdWVzMSA9IF8uZmlsdGVyKF8udW5pcShfLm1hcCh2YWx1ZXMxLCBjb252ZXJ0VG9TdHJpbmcpKSwgZnVuY3Rpb24oXG4gICAgICAgIHZhbHVlXG4gICAgICApIHtcbiAgICAgICAgcmV0dXJuICEhdmFsdWU7XG4gICAgICB9KTtcbiAgICAgIHZhbHVlczIgPSBfLmZpbHRlcihfLnVuaXEoXy5tYXAodmFsdWVzMiwgY29udmVydFRvU3RyaW5nKSksIGZ1bmN0aW9uKFxuICAgICAgICB2YWx1ZVxuICAgICAgKSB7XG4gICAgICAgIHJldHVybiAhIXZhbHVlO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gXy5pc0VxdWFsKHZhbHVlczEsIHZhbHVlczIpO1xuICAgIH0sXG5cbiAgICBjbG9zZTogZnVuY3Rpb24gd0RvY2lkX2Nsb3NlKCkge1xuICAgICAgaWYgKHRoaXMua2VuZG9XaWRnZXQgJiYgdGhpcy5rZW5kb1dpZGdldE9iamVjdCkge1xuICAgICAgICB0aGlzLmtlbmRvV2lkZ2V0T2JqZWN0LmNsb3NlKCk7XG4gICAgICB9XG4gICAgfSxcblxuICAgIGdldFR5cGU6IGZ1bmN0aW9uIHdEb2NpZF9nZXRUeXBlKCkge1xuICAgICAgcmV0dXJuIFwiZG9jaWRcIjtcbiAgICB9LFxuXG4gICAgX2Rlc3Ryb3k6IGZ1bmN0aW9uIHdEb2NpZF9fZGVzdHJveSgpIHtcbiAgICAgIGlmICh0aGlzLmtlbmRvV2lkZ2V0ICYmIHRoaXMua2VuZG9XaWRnZXRPYmplY3QpIHtcbiAgICAgICAgdGhpcy5rZW5kb1dpZGdldE9iamVjdC5kZXN0cm95KCk7XG4gICAgICB9XG4gICAgICAkKFwiLmRjcERvY2lkLWNyZWF0ZS13aW5kb3dcIikuZWFjaChmdW5jdGlvbiB3RG9jaWRfZGVzdHJveVdpbmRvdygpIHtcbiAgICAgICAgdmFyIGtXaW5kb3cgPSAkKHRoaXMpLmRhdGEoXCJkY3BXaW5kb3dcIik7XG4gICAgICAgIGlmIChrV2luZG93KSB7XG4gICAgICAgICAga1dpbmRvdy5kZXN0cm95KCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgdGhpcy5fc3VwZXIoKTtcbiAgICB9XG4gIH0pO1xuXG4gIHJldHVybiAkLmZuLmRjcERvY2lkO1xufSk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUNBLFdBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///ff69e46ed202585764e9\n");

/***/ }),

/***/ "ff769b61d7927dad04ed":
/*!****************************************************!*\
  !*** ./src/Apps/DOCUMENT/IHM/collections/menus.js ***!
  \****************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/*global define*/\n!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(/*! underscore */ \"8e08e542008e4aef1f58\"), __webpack_require__(/*! backbone */ \"1858b45bf48591489d06\"), __webpack_require__(/*! dcpDocument/models/mMenu */ \"8c1928b0f0f644cba374\")], __WEBPACK_AMD_DEFINE_RESULT__ = (function(\n  _,\n  Backbone,\n  ModelMenu\n) {\n  \"use strict\";\n\n  return Backbone.Collection.extend({\n    model: ModelMenu,\n\n    destroy: function CollectionMenu_destroy() {\n      var model;\n      while ((model = this.first())) {\n        // jshint ignore:line\n        model.destroy();\n      }\n    },\n\n    _deepSearchMenu: function CollectionMenu__deepSearchMenu(\n      contents,\n      id,\n      key,\n      value\n    ) {\n      var scope = this,\n        subMenu,\n        i,\n        subSubMenu;\n      if (contents) {\n        for (i = 0; i < contents.length; i++) {\n          subMenu = contents[i];\n          if (subMenu.id === id) {\n            if (key) {\n              subMenu[key] = value;\n            }\n            return subMenu;\n          } else {\n            subSubMenu = scope._deepSearchMenu(subMenu.content, id, key, value);\n            if (subSubMenu) {\n              return subSubMenu;\n            }\n          }\n        }\n      }\n      return null;\n    },\n\n    getMenu: function CollectionMenu_getMenu(id) {\n      var menuInfo = null,\n        menuInfoItem = null,\n        scope = this;\n\n      if (this.get(id)) {\n        return this.get(id).attributes;\n      } else {\n        this.each(function(oneMenu) {\n          if (oneMenu.get(\"content\")) {\n            menuInfoItem = scope._deepSearchMenu(oneMenu.get(\"content\"), id);\n            if (menuInfoItem) {\n              menuInfo = menuInfoItem;\n            }\n          }\n        });\n        return menuInfo;\n      }\n    },\n\n    setMenu: function CollectionMenu_setMenu(id, key, value) {\n      var menuInfo = null,\n        menuInfoItem = null,\n        scope = this,\n        menuModel = null,\n        newContent = {};\n\n      if (this.get(id)) {\n        menuModel = this.get(id);\n        menuModel.set(key, value);\n        return menuModel.attributes;\n      } else {\n        this.each(function(oneMenu) {\n          if (oneMenu.get(\"content\")) {\n            menuInfoItem = scope._deepSearchMenu(\n              oneMenu.get(\"content\"),\n              id,\n              key,\n              value\n            );\n            if (menuInfoItem) {\n              newContent = oneMenu.get(\"content\");\n              oneMenu.set(\"content\", newContent);\n              menuInfo = newContent;\n              oneMenu.trigger(\"change\");\n            }\n          }\n        });\n        return menuInfo;\n      }\n    }\n  });\n}).apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmY3NjliNjFkNzkyN2RhZDA0ZWQuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvQXBwcy9ET0NVTUVOVC9JSE0vY29sbGVjdGlvbnMvbWVudXMuanM/MGRjNSJdLCJzb3VyY2VzQ29udGVudCI6WyIvKmdsb2JhbCBkZWZpbmUqL1xuZGVmaW5lKFtcInVuZGVyc2NvcmVcIiwgXCJiYWNrYm9uZVwiLCBcImRjcERvY3VtZW50L21vZGVscy9tTWVudVwiXSwgZnVuY3Rpb24oXG4gIF8sXG4gIEJhY2tib25lLFxuICBNb2RlbE1lbnVcbikge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICByZXR1cm4gQmFja2JvbmUuQ29sbGVjdGlvbi5leHRlbmQoe1xuICAgIG1vZGVsOiBNb2RlbE1lbnUsXG5cbiAgICBkZXN0cm95OiBmdW5jdGlvbiBDb2xsZWN0aW9uTWVudV9kZXN0cm95KCkge1xuICAgICAgdmFyIG1vZGVsO1xuICAgICAgd2hpbGUgKChtb2RlbCA9IHRoaXMuZmlyc3QoKSkpIHtcbiAgICAgICAgLy8ganNoaW50IGlnbm9yZTpsaW5lXG4gICAgICAgIG1vZGVsLmRlc3Ryb3koKTtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgX2RlZXBTZWFyY2hNZW51OiBmdW5jdGlvbiBDb2xsZWN0aW9uTWVudV9fZGVlcFNlYXJjaE1lbnUoXG4gICAgICBjb250ZW50cyxcbiAgICAgIGlkLFxuICAgICAga2V5LFxuICAgICAgdmFsdWVcbiAgICApIHtcbiAgICAgIHZhciBzY29wZSA9IHRoaXMsXG4gICAgICAgIHN1Yk1lbnUsXG4gICAgICAgIGksXG4gICAgICAgIHN1YlN1Yk1lbnU7XG4gICAgICBpZiAoY29udGVudHMpIHtcbiAgICAgICAgZm9yIChpID0gMDsgaSA8IGNvbnRlbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgc3ViTWVudSA9IGNvbnRlbnRzW2ldO1xuICAgICAgICAgIGlmIChzdWJNZW51LmlkID09PSBpZCkge1xuICAgICAgICAgICAgaWYgKGtleSkge1xuICAgICAgICAgICAgICBzdWJNZW51W2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBzdWJNZW51O1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBzdWJTdWJNZW51ID0gc2NvcGUuX2RlZXBTZWFyY2hNZW51KHN1Yk1lbnUuY29udGVudCwgaWQsIGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgaWYgKHN1YlN1Yk1lbnUpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHN1YlN1Yk1lbnU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9LFxuXG4gICAgZ2V0TWVudTogZnVuY3Rpb24gQ29sbGVjdGlvbk1lbnVfZ2V0TWVudShpZCkge1xuICAgICAgdmFyIG1lbnVJbmZvID0gbnVsbCxcbiAgICAgICAgbWVudUluZm9JdGVtID0gbnVsbCxcbiAgICAgICAgc2NvcGUgPSB0aGlzO1xuXG4gICAgICBpZiAodGhpcy5nZXQoaWQpKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldChpZCkuYXR0cmlidXRlcztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuZWFjaChmdW5jdGlvbihvbmVNZW51KSB7XG4gICAgICAgICAgaWYgKG9uZU1lbnUuZ2V0KFwiY29udGVudFwiKSkge1xuICAgICAgICAgICAgbWVudUluZm9JdGVtID0gc2NvcGUuX2RlZXBTZWFyY2hNZW51KG9uZU1lbnUuZ2V0KFwiY29udGVudFwiKSwgaWQpO1xuICAgICAgICAgICAgaWYgKG1lbnVJbmZvSXRlbSkge1xuICAgICAgICAgICAgICBtZW51SW5mbyA9IG1lbnVJbmZvSXRlbTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gbWVudUluZm87XG4gICAgICB9XG4gICAgfSxcblxuICAgIHNldE1lbnU6IGZ1bmN0aW9uIENvbGxlY3Rpb25NZW51X3NldE1lbnUoaWQsIGtleSwgdmFsdWUpIHtcbiAgICAgIHZhciBtZW51SW5mbyA9IG51bGwsXG4gICAgICAgIG1lbnVJbmZvSXRlbSA9IG51bGwsXG4gICAgICAgIHNjb3BlID0gdGhpcyxcbiAgICAgICAgbWVudU1vZGVsID0gbnVsbCxcbiAgICAgICAgbmV3Q29udGVudCA9IHt9O1xuXG4gICAgICBpZiAodGhpcy5nZXQoaWQpKSB7XG4gICAgICAgIG1lbnVNb2RlbCA9IHRoaXMuZ2V0KGlkKTtcbiAgICAgICAgbWVudU1vZGVsLnNldChrZXksIHZhbHVlKTtcbiAgICAgICAgcmV0dXJuIG1lbnVNb2RlbC5hdHRyaWJ1dGVzO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5lYWNoKGZ1bmN0aW9uKG9uZU1lbnUpIHtcbiAgICAgICAgICBpZiAob25lTWVudS5nZXQoXCJjb250ZW50XCIpKSB7XG4gICAgICAgICAgICBtZW51SW5mb0l0ZW0gPSBzY29wZS5fZGVlcFNlYXJjaE1lbnUoXG4gICAgICAgICAgICAgIG9uZU1lbnUuZ2V0KFwiY29udGVudFwiKSxcbiAgICAgICAgICAgICAgaWQsXG4gICAgICAgICAgICAgIGtleSxcbiAgICAgICAgICAgICAgdmFsdWVcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBpZiAobWVudUluZm9JdGVtKSB7XG4gICAgICAgICAgICAgIG5ld0NvbnRlbnQgPSBvbmVNZW51LmdldChcImNvbnRlbnRcIik7XG4gICAgICAgICAgICAgIG9uZU1lbnUuc2V0KFwiY29udGVudFwiLCBuZXdDb250ZW50KTtcbiAgICAgICAgICAgICAgbWVudUluZm8gPSBuZXdDb250ZW50O1xuICAgICAgICAgICAgICBvbmVNZW51LnRyaWdnZXIoXCJjaGFuZ2VcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIG1lbnVJbmZvO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG59KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///ff769b61d7927dad04ed\n");

/***/ })

/******/ });