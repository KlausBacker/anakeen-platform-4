PACKAGE = @PACKAGE@
VERSION = @VERSION@
RELEASE = @RELEASE@

localpub=$(shell pwd)/localpub

stub:
	./dynacase-devtool.phar generateStub -s Document-uis -o ./stubs/


webinst-selenium:
	-rm -fr $(localpub)
	cp -ra Document-uis-selenium $(localpub)
	sed -i -e "s/{{VERSION}}/$(VERSION)/" -e "s/{{RELEASE}}/$(RELEASE)/" $(localpub)/build.json $(localpub)/TEST_DOCUMENT_SELENIUM/TEST_DOCUMENT_SELENIUM_init.php
	./dynacase-devtool.phar generateWebinst -s $(localpub) -o .
	-rm -fr $(localpub)

webinst-test:
	-rm -fr $(localpub)
	cp -ra Document-uis-test $(localpub)
	sed -i -e "s/{{VERSION}}/$(VERSION)/" -e "s/{{RELEASE}}/$(RELEASE)/" $(localpub)/build.json $(localpub)/TEST_DOCUMENT/TEST_DOCUMENT_init.php
	./dynacase-devtool.phar generateWebinst -s $(localpub) -o .
	-rm -fr $(localpub)

webinst-full:
	-rm -fr $(localpub)
	cp -ra Document-uis $(localpub)
	sed -i -e "s/{{VERSION}}/$(VERSION)/" -e "s/{{RELEASE}}/$(RELEASE)/" $(localpub)/build.json $(localpub)/DOCUMENT/DOCUMENT_init.php
	r.js -o $(localpub)/DOCUMENT/IHM/build.js
	r.js -o $(localpub)/DOCUMENT/IHM/widgets/buildWidget.js
	php ./prepareElementForLight.php --modeFull -f $(localpub)/info.xml
	./dynacase-devtool.phar generateWebinst -s $(localpub) -o .
	-rm -fr $(localpub)


webinst-light: 
	-rm -fr $(localpub)
	cp -ra Document-uis $(localpub)
	sed -i -e "s/{{VERSION}}/$(VERSION)/" -e "s/{{RELEASE}}/$(RELEASE)/" $(localpub)/build.json $(localpub/DOCUMENT/DOCUMENT_init.php
	sed -i -e "s/$(PACKAGE)/$(PACKAGE)-light/" $(localpub)/build.json
	php ./prepareElementForLight.php -f $(localpub)/info.xml
	php ./prepareElementForLight.php -f $(localpub)/DOCUMENT/DOCUMENT_init.php
	php ./prepareElementForLight.php -f $(localpub)/DOCUMENT/DOCUMENT.app
	find $(localpub)/DOCUMENT/IHM/ -mindepth 2 -name "*.js" -type f -delete
	find $(localpub)/DOCUMENT/IHM/ -name "*.less" -type f -delete
	./dynacase-devtool.phar generateWebinst -s $(localpub) -o .
	-rm -fr $(localpub)

webinst-all: webinst webinst-test webinst-selenium

webinst:
	make webinst-full

po:
	./development-tools/dynacase-devtool.phar extractPo -s Document-uis

clean: 
	/bin/rm -f *.*~ config.* Makefile configure \
		Document-uis/DOCUMENT/IHM/main-built.js	\
		Document-uis/DOCUMENT/IHM/main-built.js.map \
		Document-uis/DOCUMENT/IHM/widgets/mainWidget-min.js \
		Document-uis/DOCUMENT/IHM/widgets/mainWidget-min.js.map \
		 *.webinst
	/bin/rm -fr autom4te.cache

